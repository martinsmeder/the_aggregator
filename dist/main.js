/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let i=0;for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):55296==(64512&r)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++n)),e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,l=r>>2,c=(3&r)<<4|o>>4;let u=(15&o)<<2|h>>6,f=63&h;a||(f=64,s||(u=64)),n.push(i[l],i[c],i[u],i[f])}return n.join("")},encodeString(t,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(t):this.encodeByteArray(e(t),i)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,n=0;for(;i<t.length;){const r=t[i++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[i++];e[n++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[n++]=String.fromCharCode(55296+(s>>10)),e[n++]=String.fromCharCode(56320+(1023&s))}else{const s=t[i++],o=t[i++];e[n++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=i[t.charAt(e++)],o=e<t.length?i[t.charAt(e)]:0;++e;const a=e<t.length?i[t.charAt(e)]:64;++e;const h=e<t.length?i[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==h)throw new n;const l=s<<2|o>>4;if(r.push(l),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==h){const t=a<<6&192|h;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class n extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const n=e(t);return i.encodeByteArray(n,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return i.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}class h extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(c,((t,i)=>{const n=e[i];return null!=n?String(n):`<${i}?>`}))}(r,i):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new h(n,o,i)}}const c=/\{\$([^}]+)}/g;function u(t,e){if(t===e)return!0;const i=Object.keys(t),n=Object.keys(e);for(const r of i){if(!n.includes(r))return!1;const i=t[r],s=e[r];if(f(i)&&f(s)){if(!u(i,s))return!1}else if(i!==s)return!1}for(const t of n)if(!i.includes(t))return!1;return!0}function f(t){return null!==t&&"object"==typeof t}class p{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const g="[DEFAULT]";class d{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),n=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:g})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t=g){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=g){return this.instances.has(t)}getOptions(t=g){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(t)&&e.resolve(n);return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(t),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&t(s,n),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const n of i)try{n(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t,n===g?void 0:n),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var n;return i||null}normalizeInstanceIdentifier(t=g){return this.component?this.component.multipleInstances?t:g:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class m{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new d(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const y=[];var v,b;(b=v||(v={}))[b.DEBUG=0]="DEBUG",b[b.VERBOSE=1]="VERBOSE",b[b.INFO=2]="INFO",b[b.WARN=3]="WARN",b[b.ERROR=4]="ERROR",b[b.SILENT=5]="SILENT";const E={debug:v.DEBUG,verbose:v.VERBOSE,info:v.INFO,warn:v.WARN,error:v.ERROR,silent:v.SILENT},w=v.INFO,T={[v.DEBUG]:"log",[v.VERBOSE]:"log",[v.INFO]:"info",[v.WARN]:"warn",[v.ERROR]:"error"},I=(t,e,...i)=>{if(e<t.logLevel)return;const n=(new Date).toISOString(),r=T[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${n}]  ${t.name}:`,...i)};class S{constructor(t){this.name=t,this._logLevel=w,this._logHandler=I,this._userLogHandler=null,y.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in v))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?E[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,v.DEBUG,...t),this._logHandler(this,v.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,v.VERBOSE,...t),this._logHandler(this,v.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,v.INFO,...t),this._logHandler(this,v.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,v.WARN,...t),this._logHandler(this,v.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,v.ERROR,...t),this._logHandler(this,v.ERROR,...t)}}const A=(t,e)=>e.some((e=>t instanceof e));let _,C;const D=new WeakMap,R=new WeakMap,L=new WeakMap,N=new WeakMap,k=new WeakMap;let O={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return R.get(t);if("objectStoreNames"===e)return t.objectStoreNames||L.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return M(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(C||(C=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(x(this),t),M(D.get(this))}:function(...t){return M(e.apply(x(this),t))}:function(t,...i){const n=e.call(x(this),t,...i);return L.set(n,t.sort?t.sort():[t]),M(n)}:(t instanceof IDBTransaction&&function(t){if(R.has(t))return;const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),n()},s=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));R.set(t,e)}(t),A(t,_||(_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,O):t);var e}function M(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(M(t.result)),n()},s=()=>{i(t.error),n()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&D.set(e,t)})).catch((()=>{})),k.set(e,t),e}(t);if(N.has(t))return N.get(t);const e=P(t);return e!==t&&(N.set(t,e),k.set(e,t)),e}const x=t=>k.get(t),j=["get","getKey","getAll","getAllKeys","count"],F=["put","add","delete","clear"],U=new Map;function B(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(U.get(e))return U.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,r=F.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!j.includes(i))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),r&&s.done]))[0]};return U.set(e,s),s}var H;H=O,O={...H,get:(t,e,i)=>B(t,e)||H.get(t,e,i),has:(t,e)=>!!B(t,e)||H.has(t,e)};class V{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const $="@firebase/app",z="0.9.15",K=new S("@firebase/app"),G="[DEFAULT]",X={[$]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},W=new Map,Y=new Map;function q(t,e){try{t.container.addComponent(e)}catch(i){K.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function J(t){const e=t.name;if(Y.has(e))return K.debug(`There were multiple attempts to register component ${e}.`),!1;Y.set(e,t);for(const e of W.values())q(e,t);return!0}const Q=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Z{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new p("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Q.create("app-deleted",{appName:this._name})}}function tt(t,e={}){let i=t;"object"!=typeof e&&(e={name:e});const n=Object.assign({name:G,automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!=typeof r||!r)throw Q.create("bad-app-name",{appName:String(r)});if(i||(i=o()),!i)throw Q.create("no-options");const s=W.get(r);if(s){if(u(i,s.options)&&u(n,s.config))return s;throw Q.create("duplicate-app",{appName:r})}const a=new m(r);for(const t of Y.values())a.addComponent(t);const h=new Z(i,n,a);return W.set(r,h),h}function et(t,e,i){var n;let r=null!==(n=X[t])&&void 0!==n?n:t;i&&(r+=`-${i}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${r}" with version "${e}":`];return s&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void K.warn(t.join(" "))}J(new p(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const it="firebase-heartbeat-database",nt=1,rt="firebase-heartbeat-store";let st=null;function ot(){return st||(st=function(t,e,{blocked:i,upgrade:n,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=M(o);return n&&o.addEventListener("upgradeneeded",(t=>{n(M(o.result),t.oldVersion,t.newVersion,M(o.transaction),t)})),i&&o.addEventListener("blocked",(t=>i(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(it,nt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(rt)}}).catch((t=>{throw Q.create("idb-open",{originalErrorMessage:t.message})}))),st}async function at(t,e){try{const i=(await ot()).transaction(rt,"readwrite"),n=i.objectStore(rt);await n.put(e,ht(t)),await i.done}catch(t){if(t instanceof h)K.warn(t.message);else{const e=Q.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});K.warn(e.message)}}}function ht(t){return`${t.name}!${t.options.appId}`}class lt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ut(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=ct();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=ct(),{heartbeatsToSend:e,unsentEntries:i}=function(t,e=1024){const i=[];let n=t.slice();for(const r of t){const t=i.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),ft(i)>e){t.dates.pop();break}}else if(i.push({agent:r.agent,dates:[r.date]}),ft(i)>e){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}}function ct(){return(new Date).toISOString().substring(0,10)}class ut{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let i=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),i||self.indexedDB.deleteDatabase(n),t(!0)},r.onupgradeneeded=()=>{i=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await ot();return await e.transaction(rt).objectStore(rt).get(ht(t))}catch(t){if(t instanceof h)K.warn(t.message);else{const e=Q.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});K.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return at(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return at(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}}}function ft(t){return r(JSON.stringify({version:2,heartbeats:t})).length}J(new p("platform-logger",(t=>new V(t)),"PRIVATE")),J(new p("heartbeat",(t=>new lt(t)),"PRIVATE")),et($,z,""),et($,z,"esm2017"),et("fire-js",""),et("firebase","10.1.0","app");var pt,gt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},dt={},mt=mt||{},yt=gt||self;function vt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function bt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Et="closure_uid_"+(1e9*Math.random()>>>0),wt=0;function Tt(t,e,i){return t.call.apply(t.bind,arguments)}function It(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function St(t,e,i){return(St=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Tt:It).apply(null,arguments)}function At(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function _t(t,e){function i(){}i.prototype=e.prototype,t.$=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.ac=function(t,i,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[i].apply(t,r)}}function Ct(){this.s=this.s,this.o=this.o}Ct.prototype.s=!1,Ct.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Et)&&t[Et]||(t[Et]=++wt))},Ct.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Dt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1};function Rt(t){const e=t.length;if(0<e){const i=Array(e);for(let n=0;n<e;n++)i[n]=t[n];return i}return[]}function Lt(t,e){for(let e=1;e<arguments.length;e++){const i=arguments[e];if(vt(i)){const e=t.length||0,n=i.length||0;t.length=e+n;for(let r=0;r<n;r++)t[e+r]=i[r]}else t.push(i)}}function Nt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Nt.prototype.h=function(){this.defaultPrevented=!0};var kt=function(){if(!yt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{yt.addEventListener("test",(()=>{}),e),yt.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function Ot(t){return/^[\s\xa0]*$/.test(t)}function Pt(){var t=yt.navigator;return t&&(t=t.userAgent)?t:""}function Mt(t){return-1!=Pt().indexOf(t)}function xt(t){return xt[" "](t),t}xt[" "]=function(){};var jt,Ft,Ut,Bt=Mt("Opera"),Ht=Mt("Trident")||Mt("MSIE"),Vt=Mt("Edge"),$t=Vt||Ht,zt=Mt("Gecko")&&!(-1!=Pt().toLowerCase().indexOf("webkit")&&!Mt("Edge"))&&!(Mt("Trident")||Mt("MSIE"))&&!Mt("Edge"),Kt=-1!=Pt().toLowerCase().indexOf("webkit")&&!Mt("Edge");function Gt(){var t=yt.document;return t?t.documentMode:void 0}t:{var Xt="",Wt=(Ft=Pt(),zt?/rv:([^\);]+)(\)|;)/.exec(Ft):Vt?/Edge\/([\d\.]+)/.exec(Ft):Ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ft):Kt?/WebKit\/(\S+)/.exec(Ft):Bt?/(?:Version)[ \/]?(\S+)/.exec(Ft):void 0);if(Wt&&(Xt=Wt?Wt[1]:""),Ht){var Yt=Gt();if(null!=Yt&&Yt>parseFloat(Xt)){jt=String(Yt);break t}}jt=Xt}yt.document&&Ht?Ut=Gt()||parseInt(jt,10)||void 0:Ut=void 0;var qt=Ut;function Jt(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(zt){t:{try{xt(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Qt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Jt.$.h.call(this)}}_t(Jt,Nt);var Qt={2:"touch",3:"pen",4:"mouse"};Jt.prototype.h=function(){Jt.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Zt="closure_listenable_"+(1e6*Math.random()|0),te=0;function ee(t,e,i,n,r){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!n,this.la=r,this.key=++te,this.fa=this.ia=!1}function ie(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ne(t,e,i){for(const n in t)e.call(i,t[n],n,t)}function re(t){const e={};for(const i in t)e[i]=t[i];return e}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(t,e){let i,n;for(let e=1;e<arguments.length;e++){for(i in n=arguments[e],n)t[i]=n[i];for(let e=0;e<se.length;e++)i=se[e],Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}}function ae(t){this.src=t,this.g={},this.h=0}function he(t,e){var i=e.type;if(i in t.g){var n,r=t.g[i],s=Dt(r,e);(n=0<=s)&&Array.prototype.splice.call(r,s,1),n&&(ie(e),0==t.g[i].length&&(delete t.g[i],t.h--))}}function le(t,e,i,n){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!i&&s.la==n)return r}return-1}ae.prototype.add=function(t,e,i,n,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=le(t,e,n,r);return-1<o?(e=t[o],i||(e.ia=!1)):((e=new ee(e,this.src,s,!!n,r)).ia=i,t.push(e)),e};var ce="closure_lm_"+(1e6*Math.random()|0),ue={};function fe(t,e,i,n,r){if(n&&n.once)return ge(t,e,i,n,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)fe(t,e[s],i,n,r);return null}return i=we(i),t&&t[Zt]?t.O(e,i,bt(n)?!!n.capture:!!n,r):pe(t,e,i,!1,n,r)}function pe(t,e,i,n,r,s){if(!e)throw Error("Invalid event type");var o=bt(r)?!!r.capture:!!r,a=be(t);if(a||(t[ce]=a=new ae(t)),(i=a.add(e,i,n,o,s)).proxy)return i;if(n=function(){const t=ve;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=n,n.src=t,n.listener=i,t.addEventListener)kt||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),n,r);else if(t.attachEvent)t.attachEvent(ye(e.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return i}function ge(t,e,i,n,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ge(t,e[s],i,n,r);return null}return i=we(i),t&&t[Zt]?t.P(e,i,bt(n)?!!n.capture:!!n,r):pe(t,e,i,!0,n,r)}function de(t,e,i,n,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)de(t,e[s],i,n,r);else n=bt(n)?!!n.capture:!!n,i=we(i),t&&t[Zt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(i=le(s=t.g[e],i,n,r))&&(ie(s[i]),Array.prototype.splice.call(s,i,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=be(t))&&(e=t.g[e.toString()],t=-1,e&&(t=le(e,i,n,r)),(i=-1<t?e[t]:null)&&me(i))}function me(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Zt])he(e.i,t);else{var i=t.type,n=t.proxy;e.removeEventListener?e.removeEventListener(i,n,t.capture):e.detachEvent?e.detachEvent(ye(i),n):e.addListener&&e.removeListener&&e.removeListener(n),(i=be(e))?(he(i,t),0==i.h&&(i.src=null,e[ce]=null)):ie(t)}}}function ye(t){return t in ue?ue[t]:ue[t]="on"+t}function ve(t,e){if(t.fa)t=!0;else{e=new Jt(e,this);var i=t.listener,n=t.la||t.src;t.ia&&me(t),t=i.call(n,e)}return t}function be(t){return(t=t[ce])instanceof ae?t:null}var Ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(t){return"function"==typeof t?t:(t[Ee]||(t[Ee]=function(e){return t.handleEvent(e)}),t[Ee])}function Te(){Ct.call(this),this.i=new ae(this),this.S=this,this.J=null}function Ie(t,e){var i,n=t.J;if(n)for(i=[];n;n=n.J)i.push(n);if(t=t.S,n=e.type||e,"string"==typeof e)e=new Nt(e,t);else if(e instanceof Nt)e.target=e.target||t;else{var r=e;oe(e=new Nt(n,t),r)}if(r=!0,i)for(var s=i.length-1;0<=s;s--){var o=e.g=i[s];r=Se(o,n,!0,e)&&r}if(r=Se(o=e.g=t,n,!0,e)&&r,r=Se(o,n,!1,e)&&r,i)for(s=0;s<i.length;s++)r=Se(o=e.g=i[s],n,!1,e)&&r}function Se(t,e,i,n){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==i){var a=o.listener,h=o.la||o.src;o.ia&&he(t.i,o),r=!1!==a.call(h,n)&&r}}return r&&!n.defaultPrevented}_t(Te,Ct),Te.prototype[Zt]=!0,Te.prototype.removeEventListener=function(t,e,i,n){de(this,t,e,i,n)},Te.prototype.N=function(){if(Te.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],n=0;n<i.length;n++)ie(i[n]);delete e.g[t],e.h--}}this.J=null},Te.prototype.O=function(t,e,i,n){return this.i.add(String(t),e,!1,i,n)},Te.prototype.P=function(t,e,i,n){return this.i.add(String(t),e,!0,i,n)};var Ae=yt.JSON.stringify;function _e(){var t=Oe;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ce=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new De),(t=>t.reset()));class De{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Re(t){var e=1;t=t.split(":");const i=[];for(;0<e&&t.length;)i.push(t.shift()),e--;return t.length&&i.push(t.join(":")),i}function Le(t){yt.setTimeout((()=>{throw t}),0)}let Ne,ke=!1,Oe=new class{constructor(){this.h=this.g=null}add(t,e){const i=Ce.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}},Pe=()=>{const t=yt.Promise.resolve(void 0);Ne=()=>{t.then(Me)}};var Me=()=>{for(var t;t=_e();){try{t.h.call(t.g)}catch(t){Le(t)}var e=Ce;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ke=!1};function xe(t,e){Te.call(this),this.h=t||1,this.g=e||yt,this.j=St(this.qb,this),this.l=Date.now()}function je(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Fe(t,e,i){if("function"==typeof t)i&&(t=St(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=St(t.handleEvent,t)}return 2147483647<Number(e)?-1:yt.setTimeout(t,e||0)}function Ue(t){t.g=Fe((()=>{t.g=null,t.i&&(t.i=!1,Ue(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}_t(xe,Te),(pt=xe.prototype).ga=!1,pt.T=null,pt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ie(this,"tick"),this.ga&&(je(this),this.start()))}},pt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},pt.N=function(){xe.$.N.call(this),je(this),delete this.g};class Be extends Ct{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ue(this)}N(){super.N(),this.g&&(yt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function He(t){Ct.call(this),this.h=t,this.g={}}_t(He,Ct);var Ve=[];function $e(t,e,i,n){Array.isArray(i)||(i&&(Ve[0]=i.toString()),i=Ve);for(var r=0;r<i.length;r++){var s=fe(e,i[r],n||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function ze(t){ne(t.g,(function(t,e){this.g.hasOwnProperty(e)&&me(t)}),t),t.g={}}function Ke(){this.g=!0}function Ge(t,e,i,n){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(2>n.length)){var r=n[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Ae(i)}catch(t){return e}}(t,i)+(n?" "+n:"")}))}He.prototype.N=function(){He.$.N.call(this),ze(this)},He.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ke.prototype.Ea=function(){this.g=!1},Ke.prototype.info=function(){};var Xe={},We=null;function Ye(){return We=We||new Te}function qe(t){Nt.call(this,Xe.Ta,t)}function Je(t){const e=Ye();Ie(e,new qe(e))}function Qe(t,e){Nt.call(this,Xe.STAT_EVENT,t),this.stat=e}function Ze(t){const e=Ye();Ie(e,new Qe(e,t))}function ti(t,e){Nt.call(this,Xe.Ua,t),this.size=e}function ei(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return yt.setTimeout((function(){t()}),e)}Xe.Ta="serverreachability",_t(qe,Nt),Xe.STAT_EVENT="statevent",_t(Qe,Nt),Xe.Ua="timingevent",_t(ti,Nt);var ii={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ni={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ri(){}function si(t){return t.h||(t.h=t.i())}function oi(){}ri.prototype.h=null;var ai,hi={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function li(){Nt.call(this,"d")}function ci(){Nt.call(this,"c")}function ui(){}function fi(t,e,i,n){this.l=t,this.j=e,this.m=i,this.W=n||1,this.U=new He(this),this.P=gi,t=$t?125:void 0,this.V=new xe(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new pi}function pi(){this.i=null,this.g="",this.h=!1}_t(li,Nt),_t(ci,Nt),_t(ui,ri),ui.prototype.g=function(){return new XMLHttpRequest},ui.prototype.i=function(){return{}},ai=new ui;var gi=45e3,di={},mi={};function yi(t,e,i){t.L=1,t.v=xi(Ni(e)),t.s=i,t.S=!0,vi(t,null)}function vi(t,e){t.G=Date.now(),Ti(t),t.A=Ni(t.v);var i=t.A,n=t.W;Array.isArray(n)||(n=[String(n)]),Yi(i.i,"t",n),t.C=0,i=t.l.J,t.h=new pi,t.g=Yn(t.l,i?e:null,!t.s),0<t.O&&(t.M=new Be(St(t.Pa,t,t.g),t.O)),$e(t.U,t.g,"readystatechange",t.nb),e=t.I?re(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Je(),function(t,e,i,n,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),h=0;h<a.length;h++){var l=a[h].split("=");if(1<l.length){var c=l[0];l=l[1];var u=c.split("_");o=2<=u.length&&"type"==u[1]?o+(c+"=")+l+"&":o+(c+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+e+"\n"+i+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function bi(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function Ei(t,e,i){let n,r=!0;for(;!t.J&&t.C<i.length;){if(n=wi(t,i),n==mi){4==e&&(t.o=4,Ze(14),r=!1),Ge(t.j,t.m,null,"[Incomplete Response]");break}if(n==di){t.o=4,Ze(15),Ge(t.j,t.m,i,"[Invalid Chunk]"),r=!1;break}Ge(t.j,t.m,n,null),Ci(t,n)}bi(t)&&n!=mi&&n!=di&&(t.h.g="",t.C=0),4!=e||0!=i.length||t.h.h||(t.o=1,Ze(16),r=!1),t.i=t.i&&r,r?0<i.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),Hn(e),e.M=!0,Ze(11))):(Ge(t.j,t.m,i,"[Invalid Chunked Response]"),_i(t),Ai(t))}function wi(t,e){var i=t.C,n=e.indexOf("\n",i);return-1==n?mi:(i=Number(e.substring(i,n)),isNaN(i)?di:(n+=1)+i>e.length?mi:(e=e.slice(n,n+i),t.C=n+i,e))}function Ti(t){t.Y=Date.now()+t.P,Ii(t,t.P)}function Ii(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ei(St(t.lb,t),e)}function Si(t){t.B&&(yt.clearTimeout(t.B),t.B=null)}function Ai(t){0==t.l.H||t.J||zn(t.l,t)}function _i(t){Si(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,je(t.V),ze(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Ci(t,e){try{var i=t.l;if(0!=i.H&&(i.g==t||en(i.i,t)))if(!t.K&&en(i.i,t)&&3==i.H){try{var n=i.Ja.g.parse(e)}catch(t){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){t:if(!i.u){if(i.g){if(!(i.g.G+3e3<t.G))break t;$n(i),On(i)}Bn(i),Ze(18)}}else i.Fa=r[1],0<i.Fa-i.V&&37500>r[2]&&i.G&&0==i.A&&!i.v&&(i.v=ei(St(i.ib,i),6e3));if(1>=tn(i.i)&&i.oa){try{i.oa()}catch(t){}i.oa=void 0}}else Gn(i,11)}else if((t.K||i.g==t)&&$n(i),!Ot(e))for(r=i.Ja.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(i.V=l[0],l=l[1],2==i.H)if("c"==l[0]){i.K=l[1],i.pa=l[2];const e=l[3];null!=e&&(i.ra=e,i.l.info("VER="+i.ra));const r=l[4];null!=r&&(i.Ga=r,i.l.info("SVER="+i.Ga));const c=l[5];null!=c&&"number"==typeof c&&0<c&&(n=1.5*c,i.L=n,i.l.info("backChannelRequestTimeoutMs_="+n)),n=i;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=n.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(nn(s,s.h),s.h=null))}if(n.F){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(n.Da=t,Mi(n.I,n.F,t))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-t.G,i.l.info("Handshake RTT: "+i.S+"ms"));var o=t;if((n=i).wa=Wn(n,n.J?n.pa:null,n.Y),o.K){rn(n.i,o);var a=o,h=n.L;h&&a.setTimeout(h),a.B&&(Si(a),Ti(a)),n.g=o}else Un(n);0<i.j.length&&Mn(i)}else"stop"!=l[0]&&"close"!=l[0]||Gn(i,7);else 3==i.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Gn(i,7):kn(i):"noop"!=l[0]&&i.h&&i.h.Aa(l),i.A=0)}Je()}catch(t){}}function Di(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(vt(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var i=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(vt(t)||"string"==typeof t){var e=[];t=t.length;for(var i=0;i<t;i++)e.push(i);return e}e=[],i=0;for(const n in t)e[i++]=n;return e}}}(t),n=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(vt(t)){for(var e=[],i=t.length,n=0;n<i;n++)e.push(t[n]);return e}for(n in e=[],i=0,t)e[i++]=t[n];return e}(t),r=n.length,s=0;s<r;s++)e.call(void 0,n[s],i&&i[s],t)}(pt=fi.prototype).setTimeout=function(t){this.P=t},pt.nb=function(t){t=t.target;const e=this.M;e&&3==_n(t)?e.l():this.Pa(t)},pt.Pa=function(t){try{if(t==this.g)t:{const c=_n(this.g);var e=this.g.Ia();if(this.g.da(),!(3>c)&&(3!=c||$t||this.g&&(this.h.h||this.g.ja()||Cn(this.g)))){this.J||4!=c||7==e||Je(),Si(this);var i=this.g.da();this.ca=i;e:if(bi(this)){var n=Cn(this.g);t="";var r=n.length,s=4==_n(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){_i(this),Ai(this);var o="";break e}this.h.i=new yt.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(n[e],{stream:s&&e==r-1});n.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==i,function(t,e,i,n,r,s,o){t.info((function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+e+"\n"+i+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,c,i),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,h=this.g;if((a=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ot(a)){var l=a;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,Ze(12),_i(this),Ai(this);break t}Ge(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ci(this,i)}this.S?(Ei(this,c,o),$t&&this.i&&3==c&&($e(this.U,this.V,"tick",this.mb),this.V.start())):(Ge(this.j,this.m,o,null),Ci(this,o)),4==c&&_i(this),this.i&&!this.J&&(4==c?zn(this.l,this):(this.i=!1,Ti(this)))}else(function(t){const e={};t=(t.g&&2<=_n(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<t.length;n++){if(Ot(t[n]))continue;var i=Re(t[n]);const r=i[0];if("string"!=typeof(i=i[1]))continue;i=i.trim();const s=e[r]||[];e[r]=s,s.push(i)}!function(t,e){for(const i in t)e.call(void 0,t[i],i,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==i&&0<o.indexOf("Unknown SID")?(this.o=3,Ze(12)):(this.o=0,Ze(13)),_i(this),Ai(this)}}}catch(t){}},pt.mb=function(){if(this.g){var t=_n(this.g),e=this.g.ja();this.C<e.length&&(Si(this),Ei(this,t,e),this.i&&4!=t&&Ti(this))}},pt.cancel=function(){this.J=!0,_i(this)},pt.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(Je(),Ze(17)),_i(this),this.o=2,Ai(this)):Ii(this,this.Y-t)};var Ri=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Li(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Li){this.h=t.h,ki(this,t.j),this.s=t.s,this.g=t.g,Oi(this,t.m),this.l=t.l;var e=t.i,i=new Ki;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),Pi(this,i),this.o=t.o}else t&&(e=String(t).match(Ri))?(this.h=!1,ki(this,e[1]||"",!0),this.s=ji(e[2]||""),this.g=ji(e[3]||"",!0),Oi(this,e[4]),this.l=ji(e[5]||"",!0),Pi(this,e[6]||"",!0),this.o=ji(e[7]||"")):(this.h=!1,this.i=new Ki(null,this.h))}function Ni(t){return new Li(t)}function ki(t,e,i){t.j=i?ji(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Oi(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Pi(t,e,i){e instanceof Ki?(t.i=e,function(t,e){e&&!t.j&&(Gi(t),t.i=null,t.g.forEach((function(t,e){var i=e.toLowerCase();e!=i&&(Xi(this,e),Yi(this,i,t))}),t)),t.j=e}(t.i,t.h)):(i||(e=Fi(e,$i)),t.i=new Ki(e,t.h))}function Mi(t,e,i){t.i.set(e,i)}function xi(t){return Mi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ji(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Fi(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,Ui),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ui(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Li.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Fi(e,Bi,!0),":");var i=this.g;return(i||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Fi(e,Bi,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&t.push(":",String(i))),(i=this.l)&&(this.g&&"/"!=i.charAt(0)&&t.push("/"),t.push(Fi(i,"/"==i.charAt(0)?Vi:Hi,!0))),(i=this.i.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Fi(i,zi)),t.join("")};var Bi=/[#\/\?@]/g,Hi=/[#\?:]/g,Vi=/[#\?]/g,$i=/[#\?@]/g,zi=/#/g;function Ki(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Gi(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var n=t[i].indexOf("="),r=null;if(0<=n){var s=t[i].substring(0,n);r=t[i].substring(n+1)}else s=t[i];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)})))}function Xi(t,e){Gi(t),e=qi(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Wi(t,e){return Gi(t),e=qi(t,e),t.g.has(e)}function Yi(t,e,i){Xi(t,e),0<i.length&&(t.i=null,t.g.set(qi(t,e),Rt(i)),t.h+=i.length)}function qi(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ji(t){this.l=t||Qi,t=yt.PerformanceNavigationTiming?0<(t=yt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(yt.g&&yt.g.Ka&&yt.g.Ka()&&yt.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(pt=Ki.prototype).add=function(t,e){Gi(this),this.i=null,t=qi(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this},pt.forEach=function(t,e){Gi(this),this.g.forEach((function(i,n){i.forEach((function(i){t.call(e,i,n,this)}),this)}),this)},pt.ta=function(){Gi(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let n=0;n<e.length;n++){const r=t[n];for(let t=0;t<r.length;t++)i.push(e[n])}return i},pt.Z=function(t){Gi(this);let e=[];if("string"==typeof t)Wi(this,t)&&(e=e.concat(this.g.get(qi(this,t))));else{t=Array.from(this.g.values());for(let i=0;i<t.length;i++)e=e.concat(t[i])}return e},pt.set=function(t,e){return Gi(this),this.i=null,Wi(this,t=qi(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},pt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},pt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var n=e[i];const s=encodeURIComponent(String(n)),o=this.Z(n);for(n=0;n<o.length;n++){var r=s;""!==o[n]&&(r+="="+encodeURIComponent(String(o[n]))),t.push(r)}}return this.i=t.join("&")};var Qi=10;function Zi(t){return!!t.h||!!t.g&&t.g.size>=t.j}function tn(t){return t.h?1:t.g?t.g.size:0}function en(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function nn(t,e){t.g?t.g.add(e):t.h=e}function rn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function sn(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const i of t.g.values())e=e.concat(i.F);return e}return Rt(t.i)}Ji.prototype.cancel=function(){if(this.i=sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var on=class{stringify(t){return yt.JSON.stringify(t,void 0)}parse(t){return yt.JSON.parse(t,void 0)}};function an(){this.g=new on}function hn(t,e,i){const n=i||"";try{Di(t,(function(t,i){let r=t;bt(t)&&(r=Ae(t)),e.push(n+i+"="+encodeURIComponent(r))}))}catch(t){throw e.push(n+"type="+encodeURIComponent("_badmap")),t}}function ln(t,e,i,n,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(n)}catch(t){}}function cn(t){this.l=t.fc||null,this.j=t.ob||!1}function un(t,e){Te.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_t(cn,ri),cn.prototype.g=function(){return new un(this.l,this.j)},cn.prototype.i=function(t){return function(){return t}}({}),_t(un,Te);var fn=0;function pn(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function gn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,dn(t)}function dn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(pt=un.prototype).open=function(t,e){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,dn(this)},pt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||yt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},pt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gn(this)),this.readyState=fn},pt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,dn(this)),this.g&&(this.readyState=3,dn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==yt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pn(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},pt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?gn(this):dn(this),3==this.readyState&&pn(this)}},pt.Za=function(t){this.g&&(this.response=this.responseText=t,gn(this))},pt.Ya=function(t){this.g&&(this.response=t,gn(this))},pt.ka=function(){this.g&&gn(this)},pt.setRequestHeader=function(t,e){this.v.append(t,e)},pt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},pt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join("\r\n")},Object.defineProperty(un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var mn=yt.JSON.parse;function yn(t){Te.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=vn,this.L=this.M=!1}_t(yn,Te);var vn="",bn=/^https?$/i,En=["POST","PUT"];function wn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Tn(t),Sn(t)}function Tn(t){t.F||(t.F=!0,Ie(t,"complete"),Ie(t,"error"))}function In(t){if(t.h&&void 0!==mt&&(!t.C[1]||4!=_n(t)||2!=t.da()))if(t.v&&4==_n(t))Fe(t.La,0,t);else if(Ie(t,"readystatechange"),4==_n(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var n;if(n=0===o){var r=String(t.I).match(Ri)[1]||null;!r&&yt.self&&yt.self.location&&(r=yt.self.location.protocol.slice(0,-1)),n=!bn.test(r?r.toLowerCase():"")}i=n}if(i)Ie(t,"complete"),Ie(t,"success");else{t.m=6;try{var s=2<_n(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Tn(t)}}finally{Sn(t)}}}function Sn(t,e){if(t.g){An(t);const i=t.g,n=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ie(t,"ready");try{i.onreadystatechange=n}catch(t){}}}function An(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(yt.clearTimeout(t.A),t.A=null)}function _n(t){return t.g?t.g.readyState:0}function Cn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case vn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Dn(t){let e="";return ne(t,(function(t,i){e+=i,e+=":",e+=t,e+="\r\n"})),e}function Rn(t,e,i){t:{for(n in i){var n=!1;break t}n=!0}n||(i=Dn(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):Mi(t,e,i))}function Ln(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function Nn(t){this.Ga=0,this.j=[],this.l=new Ke,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ln("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ln("baseRetryDelayMs",5e3,t),this.hb=Ln("retryDelaySeedMs",1e4,t),this.eb=Ln("forwardChannelMaxRetries",2,t),this.xa=Ln("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ji(t&&t.concurrentRequestLimit),this.Ja=new an,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function kn(t){if(Pn(t),3==t.H){var e=t.W++,i=Ni(t.I);if(Mi(i,"SID",t.K),Mi(i,"RID",e),Mi(i,"TYPE","terminate"),jn(t,i),(e=new fi(t,t.l,e)).L=2,e.v=xi(Ni(i)),i=!1,yt.navigator&&yt.navigator.sendBeacon)try{i=yt.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!i&&yt.Image&&((new Image).src=e.v,i=!0),i||(e.g=Yn(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Ti(e)}Xn(t)}function On(t){t.g&&(Hn(t),t.g.cancel(),t.g=null)}function Pn(t){On(t),t.u&&(yt.clearTimeout(t.u),t.u=null),$n(t),t.i.cancel(),t.m&&("number"==typeof t.m&&yt.clearTimeout(t.m),t.m=null)}function Mn(t){if(!Zi(t.i)&&!t.m){t.m=!0;var e=t.Na;Ne||Pe(),ke||(Ne(),ke=!0),Oe.add(e,t),t.C=0}}function xn(t,e){var i;i=e?e.m:t.W++;const n=Ni(t.I);Mi(n,"SID",t.K),Mi(n,"RID",i),Mi(n,"AID",t.V),jn(t,n),t.o&&t.s&&Rn(n,t.o,t.s),i=new fi(t,t.l,i,t.C+1),null===t.o&&(i.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Fn(t,i,1e3),i.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),nn(t.i,i),yi(i,n,e)}function jn(t,e){t.na&&ne(t.na,(function(t,i){Mi(e,i,t)})),t.h&&Di({},(function(t,i){Mi(e,i,t)}))}function Fn(t,e,i){i=Math.min(t.j.length,i);var n=t.h?St(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+i];-1==e?0<i?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<i;o++){let i=r[o].g;const a=r[o].map;if(i-=e,0>i)e=Math.max(0,r[o].g-100),s=!1;else try{hn(a,t,"req"+i+"_")}catch(t){n&&n(a)}}if(s){n=t.join("&");break t}}}return t=t.j.splice(0,i),e.F=t,n}function Un(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ne||Pe(),ke||(Ne(),ke=!0),Oe.add(e,t),t.A=0}}function Bn(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=ei(St(t.Ma,t),Kn(t,t.A)),t.A++,0))}function Hn(t){null!=t.B&&(yt.clearTimeout(t.B),t.B=null)}function Vn(t){t.g=new fi(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ni(t.wa);Mi(e,"RID","rpc"),Mi(e,"SID",t.K),Mi(e,"AID",t.V),Mi(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Mi(e,"TO",t.qa),Mi(e,"TYPE","xmlhttp"),jn(t,e),t.o&&t.s&&Rn(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var i=t.g;t=t.pa,i.L=1,i.v=xi(Ni(e)),i.s=null,i.S=!0,vi(i,t)}function $n(t){null!=t.v&&(yt.clearTimeout(t.v),t.v=null)}function zn(t,e){var i=null;if(t.g==e){$n(t),Hn(t),t.g=null;var n=2}else{if(!en(t.i,e))return;i=e.F,rn(t.i,e),n=1}if(0!=t.H)if(e.i)if(1==n){i=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;Ie(n=Ye(),new ti(n,i)),Mn(t)}else Un(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==n&&function(t,e){return!(tn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=ei(St(t.Na,t,e),Kn(t,t.C)),t.C++,0)))}(t,e)||2==n&&Bn(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),r){case 1:Gn(t,5);break;case 4:Gn(t,10);break;case 3:Gn(t,6);break;default:Gn(t,2)}}function Kn(t,e){let i=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(i*=2),i*e}function Gn(t,e){if(t.l.info("Error code "+e),2==e){var i=null;t.h&&(i=null);var n=St(t.pb,t);i||(i=new Li("//www.google.com/images/cleardot.gif"),yt.location&&"http"==yt.location.protocol||ki(i,"https"),xi(i)),function(t,e){const i=new Ke;if(yt.Image){const n=new Image;n.onload=At(ln,i,n,"TestLoadImage: loaded",!0,e),n.onerror=At(ln,i,n,"TestLoadImage: error",!1,e),n.onabort=At(ln,i,n,"TestLoadImage: abort",!1,e),n.ontimeout=At(ln,i,n,"TestLoadImage: timeout",!1,e),yt.setTimeout((function(){n.ontimeout&&n.ontimeout()}),1e4),n.src=t}else e(!1)}(i.toString(),n)}else Ze(2);t.H=0,t.h&&t.h.za(e),Xn(t),Pn(t)}function Xn(t){if(t.H=0,t.ma=[],t.h){const e=sn(t.i);0==e.length&&0==t.j.length||(Lt(t.ma,e),Lt(t.ma,t.j),t.i.i.length=0,Rt(t.j),t.j.length=0),t.h.ya()}}function Wn(t,e,i){var n=i instanceof Li?Ni(i):new Li(i);if(""!=n.g)e&&(n.g=e+"."+n.g),Oi(n,n.m);else{var r=yt.location;n=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Li(null);n&&ki(s,n),e&&(s.g=e),r&&Oi(s,r),i&&(s.l=i),n=s}return i=t.F,e=t.Da,i&&e&&Mi(n,i,e),Mi(n,"VER",t.ra),jn(t,n),n}function Yn(t,e,i){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=i&&t.Ha&&!t.va?new yn(new cn({ob:!0})):new yn(t.va)).Oa(t.J),e}function qn(){}function Jn(){if(Ht&&!(10<=Number(qt)))throw Error("Environmental error: no available transport.")}function Qn(t,e){Te.call(this),this.g=new Nn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Ot(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ot(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new er(this)}function Zn(t){li.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const i in e){t=i;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function tr(){ci.call(this),this.status=1}function er(t){this.g=t}function ir(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nr(t,e,i){i||(i=0);var n=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)n[r]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(r=0;16>r;++r)n[r]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=t.g[0],i=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^i&(r^s))+n[0]+3614090360&4294967295;o=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=(i=(r=(s=(e=i+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(r^s))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(i^r))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(i^s&(e^i))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=i+(e^r&(s^e))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(i^r))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(i^r))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(i^r&(e^i))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^i&(s^e))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=i+(s^e&(r^s))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r^s)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^r^s)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^i^r)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^i)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=i+(r^s^e)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(i|~s))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(i|~s))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(i|~s))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~i))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=i+(s^(r|~e))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=i+((o=e+(r^(i|~s))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(i^(e|~r))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~i))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+n[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function rr(t,e){this.h=e;for(var i=[],n=!0,r=t.length-1;0<=r;r--){var s=0|t[r];n&&s==e||(i[r]=s,n=!1)}this.g=i}(pt=yn.prototype).Oa=function(t){this.M=t},pt.ha=function(t,e,i,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ai.g(),this.C=this.u?si(this.u):si(ai),this.g.onreadystatechange=St(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void wn(this,t)}if(t=i||"",i=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)i.set(r,n[r]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const t of n.keys())i.set(t,n.get(t))}n=Array.from(i.keys()).find((t=>"content-type"==t.toLowerCase())),r=yt.FormData&&t instanceof yt.FormData,!(0<=Dt(En,e))||n||r||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of i)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{An(this),0<this.B&&((this.L=function(t){return Ht&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=St(this.ua,this)):this.A=Fe(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){wn(this,t)}},pt.ua=function(){void 0!==mt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ie(this,"timeout"),this.abort(8))},pt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ie(this,"complete"),Ie(this,"abort"),Sn(this))},pt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sn(this,!0)),yn.$.N.call(this)},pt.La=function(){this.s||(this.G||this.v||this.l?In(this):this.kb())},pt.kb=function(){In(this)},pt.isActive=function(){return!!this.g},pt.da=function(){try{return 2<_n(this)?this.g.status:-1}catch(t){return-1}},pt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},pt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),mn(e)}},pt.Ia=function(){return this.m},pt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(pt=Nn.prototype).ra=8,pt.H=1,pt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new fi(this,this.l,t);let s=this.s;if(this.U&&(s?(s=re(s),oe(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,i=0;i<this.j.length;i++){var n=this.j[i];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(e+=n)){e=i;break t}if(4096===e||i===this.j.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Fn(this,r,e),Mi(i=Ni(this.I),"RID",t),Mi(i,"CVER",22),this.F&&Mi(i,"X-HTTP-Session-Id",this.F),jn(this,i),s&&(this.O?e="headers="+encodeURIComponent(String(Dn(s)))+"&"+e:this.o&&Rn(i,this.o,s)),nn(this.i,r),this.bb&&Mi(i,"TYPE","init"),this.P?(Mi(i,"$req",e),Mi(i,"SID","null"),r.aa=!0,yi(r,i,null)):yi(r,i,e),this.H=2}}else 3==this.H&&(t?xn(this,t):0==this.j.length||Zi(this.i)||xn(this))},pt.Ma=function(){if(this.u=null,Vn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=ei(St(this.jb,this),t)}},pt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ze(10),On(this),Vn(this))},pt.ib=function(){null!=this.v&&(this.v=null,On(this),Bn(this),Ze(19))},pt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Ze(2)):(this.l.info("Failed to ping google.com"),Ze(1))},pt.isActive=function(){return!!this.h&&this.h.isActive(this)},(pt=qn.prototype).Ba=function(){},pt.Aa=function(){},pt.za=function(){},pt.ya=function(){},pt.isActive=function(){return!0},pt.Va=function(){},Jn.prototype.g=function(t,e){return new Qn(t,e)},_t(Qn,Te),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,i=this.h||void 0;Ze(0),t.Y=e,t.na=i||{},t.G=t.aa,t.I=Wn(t,null,t.Y),Mn(t)},Qn.prototype.close=function(){kn(this.g)},Qn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var i={};i.__data__=t,t=i}else this.v&&((i={}).__data__=Ae(t),t=i);e.j.push(new class{constructor(t,e){this.g=t,this.map=e}}(e.fb++,t)),3==e.H&&Mn(e)},Qn.prototype.N=function(){this.g.h=null,delete this.j,kn(this.g),delete this.g,Qn.$.N.call(this)},_t(Zn,li),_t(tr,ci),_t(er,qn),er.prototype.Ba=function(){Ie(this.g,"a")},er.prototype.Aa=function(t){Ie(this.g,new Zn(t))},er.prototype.za=function(t){Ie(this.g,new tr)},er.prototype.ya=function(){Ie(this.g,"b")},_t(ir,(function(){this.blockSize=-1})),ir.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ir.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var i=e-this.blockSize,n=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=i;)nr(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(n[r++]=t.charCodeAt(s++),r==this.blockSize){nr(this,n),r=0;break}}else for(;s<e;)if(n[r++]=t[s++],r==this.blockSize){nr(this,n),r=0;break}}this.h=r,this.i+=e},ir.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var i=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&i,i/=256;for(this.j(t),t=Array(16),e=i=0;4>e;++e)for(var n=0;32>n;n+=8)t[i++]=this.g[e]>>>n&255;return t};var sr={};function or(t){return-128<=t&&128>t?function(t,e){var i=sr;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=function(t){return new rr([0|t],0>t?-1:0)}(t)}(t):new rr([0|t],0>t?-1:0)}function ar(t){if(isNaN(t)||!isFinite(t))return lr;if(0>t)return gr(ar(-t));for(var e=[],i=1,n=0;t>=i;n++)e[n]=t/i|0,i*=hr;return new rr(e,0)}var hr=4294967296,lr=or(0),cr=or(1),ur=or(16777216);function fr(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function pr(t){return-1==t.h}function gr(t){for(var e=t.g.length,i=[],n=0;n<e;n++)i[n]=~t.g[n];return new rr(i,~t.h).add(cr)}function dr(t,e){return t.add(gr(e))}function mr(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function yr(t,e){this.g=t,this.h=e}function vr(t,e){if(fr(e))throw Error("division by zero");if(fr(t))return new yr(lr,lr);if(pr(t))return e=vr(gr(t),e),new yr(gr(e.g),gr(e.h));if(pr(e))return e=vr(t,gr(e)),new yr(gr(e.g),e.h);if(30<t.g.length){if(pr(t)||pr(e))throw Error("slowDivide_ only works with positive integers.");for(var i=cr,n=e;0>=n.X(t);)i=br(i),n=br(n);var r=Er(i,1),s=Er(n,1);for(n=Er(n,2),i=Er(i,2);!fr(n);){var o=s.add(n);0>=o.X(t)&&(r=r.add(i),s=o),n=Er(n,1),i=Er(i,1)}return e=dr(t,r.R(e)),new yr(r,e)}for(r=lr;0<=t.X(e);){for(i=Math.max(1,Math.floor(t.ea()/e.ea())),n=48>=(n=Math.ceil(Math.log(i)/Math.LN2))?1:Math.pow(2,n-48),o=(s=ar(i)).R(e);pr(o)||0<o.X(t);)o=(s=ar(i-=n)).R(e);fr(s)&&(s=cr),r=r.add(s),t=dr(t,o)}return new yr(r,t)}function br(t){for(var e=t.g.length+1,i=[],n=0;n<e;n++)i[n]=t.D(n)<<1|t.D(n-1)>>>31;return new rr(i,t.h)}function Er(t,e){var i=e>>5;e%=32;for(var n=t.g.length-i,r=[],s=0;s<n;s++)r[s]=0<e?t.D(s+i)>>>e|t.D(s+i+1)<<32-e:t.D(s+i);return new rr(r,t.h)}(pt=rr.prototype).ea=function(){if(pr(this))return-gr(this).ea();for(var t=0,e=1,i=0;i<this.g.length;i++){var n=this.D(i);t+=(0<=n?n:hr+n)*e,e*=hr}return t},pt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(fr(this))return"0";if(pr(this))return"-"+gr(this).toString(t);for(var e=ar(Math.pow(t,6)),i=this,n="";;){var r=vr(i,e).g,s=((0<(i=dr(i,r.R(e))).g.length?i.g[0]:i.h)>>>0).toString(t);if(fr(i=r))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},pt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},pt.X=function(t){return pr(t=dr(this,t))?-1:fr(t)?0:1},pt.abs=function(){return pr(this)?gr(this):this},pt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0,r=0;r<=e;r++){var s=n+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);n=o>>>16,s&=65535,o&=65535,i[r]=o<<16|s}return new rr(i,-2147483648&i[i.length-1]?-1:0)},pt.R=function(t){if(fr(this)||fr(t))return lr;if(pr(this))return pr(t)?gr(this).R(gr(t)):gr(gr(this).R(t));if(pr(t))return gr(this.R(gr(t)));if(0>this.X(ur)&&0>t.X(ur))return ar(this.ea()*t.ea());for(var e=this.g.length+t.g.length,i=[],n=0;n<2*e;n++)i[n]=0;for(n=0;n<this.g.length;n++)for(var r=0;r<t.g.length;r++){var s=this.D(n)>>>16,o=65535&this.D(n),a=t.D(r)>>>16,h=65535&t.D(r);i[2*n+2*r]+=o*h,mr(i,2*n+2*r),i[2*n+2*r+1]+=s*h,mr(i,2*n+2*r+1),i[2*n+2*r+1]+=o*a,mr(i,2*n+2*r+1),i[2*n+2*r+2]+=s*a,mr(i,2*n+2*r+2)}for(n=0;n<e;n++)i[n]=i[2*n+1]<<16|i[2*n];for(n=e;n<2*e;n++)i[n]=0;return new rr(i,0)},pt.gb=function(t){return vr(this,t).h},pt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)&t.D(n);return new rr(i,this.h&t.h)},pt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)|t.D(n);return new rr(i,this.h|t.h)},pt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],n=0;n<e;n++)i[n]=this.D(n)^t.D(n);return new rr(i,this.h^t.h)},Jn.prototype.createWebChannel=Jn.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,ii.NO_ERROR=0,ii.TIMEOUT=8,ii.HTTP_ERROR=6,ni.COMPLETE="complete",oi.EventType=hi,hi.OPEN="a",hi.CLOSE="b",hi.ERROR="c",hi.MESSAGE="d",Te.prototype.listen=Te.prototype.O,yn.prototype.listenOnce=yn.prototype.P,yn.prototype.getLastError=yn.prototype.Sa,yn.prototype.getLastErrorCode=yn.prototype.Ia,yn.prototype.getStatus=yn.prototype.da,yn.prototype.getResponseJson=yn.prototype.Wa,yn.prototype.getResponseText=yn.prototype.ja,yn.prototype.send=yn.prototype.ha,yn.prototype.setWithCredentials=yn.prototype.Oa,ir.prototype.digest=ir.prototype.l,ir.prototype.reset=ir.prototype.reset,ir.prototype.update=ir.prototype.j,rr.prototype.add=rr.prototype.add,rr.prototype.multiply=rr.prototype.R,rr.prototype.modulo=rr.prototype.gb,rr.prototype.compare=rr.prototype.X,rr.prototype.toNumber=rr.prototype.ea,rr.prototype.toString=rr.prototype.toString,rr.prototype.getBits=rr.prototype.D,rr.fromNumber=ar,rr.fromString=function t(e,i){if(0==e.length)throw Error("number format error: empty string");if(2>(i=i||10)||36<i)throw Error("radix out of range: "+i);if("-"==e.charAt(0))return gr(t(e.substring(1),i));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=ar(Math.pow(i,8)),r=lr,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),i);8>o?(o=ar(Math.pow(i,o)),r=r.R(o).add(ar(a))):r=(r=r.R(n)).add(ar(a))}return r},dt.createWebChannelTransport=function(){return new Jn},dt.getStatEventTarget=function(){return Ye()},dt.ErrorCode=ii,dt.EventType=ni,dt.Event=Xe,dt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},dt.FetchXmlHttpFactory=cn,dt.WebChannel=oi,dt.XhrIo=yn,dt.Md5=ir;var wr=dt.Integer=rr;const Tr="@firebase/firestore";class Ir{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ir.UNAUTHENTICATED=new Ir(null),Ir.GOOGLE_CREDENTIALS=new Ir("google-credentials-uid"),Ir.FIRST_PARTY=new Ir("first-party-uid"),Ir.MOCK_USER=new Ir("mock-user");let Sr="10.1.0";const Ar=new S("@firebase/firestore");function _r(t,...e){if(Ar.logLevel<=v.DEBUG){const i=e.map(Dr);Ar.debug(`Firestore (${Sr}): ${t}`,...i)}}function Cr(t,...e){if(Ar.logLevel<=v.ERROR){const i=e.map(Dr);Ar.error(`Firestore (${Sr}): ${t}`,...i)}}function Dr(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Rr(t="Unexpected state"){const e=`FIRESTORE (${Sr}) INTERNAL ASSERTION FAILED: `+t;throw Cr(e),new Error(e)}function Lr(t,e){t||Rr()}const Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kr extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Or{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Pr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Mr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ir.UNAUTHENTICATED)))}shutdown(){}}class xr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class jr{constructor(t){this.t=t,this.currentUser=Ir.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i;const n=t=>this.i!==i?(i=this.i,e(t)):Promise.resolve();let r=new Or;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Or,t.enqueueRetryable((()=>n(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await n(this.currentUser)}))},o=t=>{_r("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(_r("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Or)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(_r("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Lr("string"==typeof e.accessToken),new Pr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new Ir(t)}}class Fr{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=Ir.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ur{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new Fr(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Ir.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Br{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hr{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const i=t=>{null!=t.error&&_r("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const i=t.token!==this.R;return this.R=t.token,_r("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>i(e)))};const n=t=>{_r("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>n(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?n(t):_r("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Lr("string"==typeof t.token),this.R=t.token,new Br(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Vr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(i);else for(let e=0;e<t;e++)i[e]=Math.floor(256*Math.random());return i}class $r{static V(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const i=Vr(40);for(let n=0;n<i.length;++n)e.length<20&&i[n]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[n]%62))}return e}}function zr(t,e){return t<e?-1:t>e?1:0}class Kr{constructor(t,e,i){void 0===e?e=0:e>t.length&&Rr(),void 0===i?i=t.length-e:i>t.length-e&&Rr(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return 0===Kr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Kr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++){const i=t.get(n),r=e.get(n);if(i<r)return-1;if(i>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Gr extends Kr{construct(t,e,i){return new Gr(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new kr(Nr.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((t=>t.length>0)))}return new Gr(e)}static emptyPath(){return new Gr([])}}class Xr{constructor(t){this.path=t}static fromPath(t){return new Xr(Gr.fromString(t))}static fromName(t){return new Xr(Gr.fromString(t).popFirst(5))}static empty(){return new Xr(Gr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Gr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Gr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Xr(new Gr(t.slice()))}}function Wr(t){return"IndexedDbTransactionError"===t.name}class Yr{constructor(t,e){this.comparator=t,this.root=e||Jr.EMPTY}insert(t,e){return new Yr(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jr.BLACK,null,null))}remove(t){return new Yr(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jr.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(0===i)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const n=this.comparator(t,i.key);if(0===n)return e+i.left.size;n<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,i)=>(t(e,i),!1)))}toString(){const t=[];return this.inorderTraversal(((e,i)=>(t.push(`${e}:${i}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new qr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new qr(this.root,t,this.comparator,!1)}getReverseIterator(){return new qr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new qr(this.root,t,this.comparator,!0)}}class qr{constructor(t,e,i,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?i(t.key,e):1,e&&n&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Jr{constructor(t,e,i,n,r){this.key=t,this.value=e,this.color=null!=i?i:Jr.RED,this.left=null!=n?n:Jr.EMPTY,this.right=null!=r?r:Jr.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,n,r){return new Jr(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=n?n:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let n=this;const r=i(t,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(t,e,i),null):0===r?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,i)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Jr.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,n=this;if(e(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===e(t,n.key)){if(n.right.isEmpty())return Jr.EMPTY;i=n.right.min(),n=n.copy(i.key,i.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Jr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Jr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Rr();if(this.right.isRed())throw Rr();const t=this.left.check();if(t!==this.right.check())throw Rr();return t+(this.isRed()?0:1)}}Jr.EMPTY=null,Jr.RED=!0,Jr.BLACK=!1,Jr.EMPTY=new class{constructor(){this.size=0}get key(){throw Rr()}get value(){throw Rr()}get color(){throw Rr()}get left(){throw Rr()}get right(){throw Rr()}copy(t,e,i,n,r){return this}insert(t,e,i){return new Jr(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Qr{constructor(t){this.comparator=t,this.data=new Yr(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,i)=>(t(e),!1)))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const n=i.getNext();if(this.comparator(n.key,t[1])>=0)return;e(n.key)}}forEachWhile(t,e){let i;for(i=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Zr(this.data.getIterator())}getIteratorFrom(t){return new Zr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Qr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,n=i.getNext().key;if(0!==this.comparator(t,n))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Qr(this.comparator);return e.data=t,e}}class Zr{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ts extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class es{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ts("Invalid base64 string: "+t):t}}(t);return new es(e)}static fromUint8Array(t){const e=function(t){let e="";for(let i=0;i<t.length;++i)e+=String.fromCharCode(t[i]);return e}(t);return new es(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return zr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}function is(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}es.EMPTY_BYTE_STRING=new es("");class ns{constructor(t,e,i,n,r,s,o,a,h){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=n,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=h}}class rs{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new rs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof rs&&t.projectId===this.projectId&&t.database===this.database}}var ss,os;new Yr(Xr.comparator),new Yr(Xr.comparator),new Yr(Xr.comparator),new Qr(Xr.comparator),new Qr(zr),(os=ss||(ss={}))[os.OK=0]="OK",os[os.CANCELLED=1]="CANCELLED",os[os.UNKNOWN=2]="UNKNOWN",os[os.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",os[os.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",os[os.NOT_FOUND=5]="NOT_FOUND",os[os.ALREADY_EXISTS=6]="ALREADY_EXISTS",os[os.PERMISSION_DENIED=7]="PERMISSION_DENIED",os[os.UNAUTHENTICATED=16]="UNAUTHENTICATED",os[os.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",os[os.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",os[os.ABORTED=10]="ABORTED",os[os.OUT_OF_RANGE=11]="OUT_OF_RANGE",os[os.UNIMPLEMENTED=12]="UNIMPLEMENTED",os[os.INTERNAL=13]="INTERNAL",os[os.UNAVAILABLE=14]="UNAVAILABLE",os[os.DATA_LOSS=15]="DATA_LOSS",new wr([4294967295,4294967295],0);class as{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(is(t.integerValue));else if("doubleValue"in t){const i=is(t.doubleValue);isNaN(i)?this.Et(e,13):(this.Et(e,15),function(t){return 0===t&&1/t==-1/0}(i)?e.dt(0):e.dt(i))}else if("timestampValue"in t){const i=t.timestampValue;this.Et(e,20),"string"==typeof i?e.At(i):(e.At(`${i.seconds||""}`),e.dt(i.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(function(t){return"string"==typeof t?es.fromBase64String(t):es.fromUint8Array(t)}(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const i=t.geoPointValue;this.Et(e,45),e.dt(i.latitude||0),e.dt(i.longitude||0)}else"mapValue"in t?function(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Rr()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const i=t.fields||{};this.Et(e,55);for(const t of Object.keys(i))this.Rt(t,e),this.It(i[t],e)}wt(t,e){const i=t.values||[];this.Et(e,50);for(const t of i)this.It(t,e)}gt(t,e){this.Et(e,37),Xr.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}as.bt=new as,new Uint8Array(0);class hs{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new hs(t,hs.DEFAULT_COLLECTION_PERCENTILE,hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ls(){return"undefined"!=typeof document?document:null}hs.DEFAULT_COLLECTION_PERCENTILE=10,hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hs.DEFAULT=new hs(41943040,hs.DEFAULT_COLLECTION_PERCENTILE,hs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hs.DISABLED=new hs(-1,0,0);class cs{constructor(t,e,i=1e3,n=1.5,r=6e4){this.ii=t,this.timerId=e,this.So=i,this.bo=n,this.Do=r,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(t){this.cancel();const e=Math.floor(this.vo+this.Oo()),i=Math.max(0,Date.now()-this.Fo),n=Math.max(0,e-i);n>0&&_r("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.vo} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,n,(()=>(this.Fo=Date.now(),t()))),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class us{constructor(t,e,i,n,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=n,this.removalCallback=r,this.deferred=new Or,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,i,n,r){const s=Date.now()+i,o=new us(t,e,s,n,r);return o.start(i),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new kr(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class fs{constructor(t,e,i,n){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=n,this.user=Ir.UNAUTHENTICATED,this.clientId=$r.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,(async t=>{_r("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(i,(t=>(_r("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new kr(Nr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Or;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=function(t,e){if(Cr("AsyncQueue",`${e}: ${t}`),Wr(t))return new kr(Nr.UNAVAILABLE,`${e}: ${t}`);throw t}(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ps(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const gs=new Map;function ds(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new kr(Nr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Rr()}(t);throw new kr(Nr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return t}class ms{constructor(t){var e,i;if(void 0===t.host){if(void 0!==t.ssl)throw new kr(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new kr(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,i,n){if(!0===e&&!0===n)throw new kr(Nr.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ps(null!==(i=t.experimentalLongPollingOptions)&&void 0!==i?i:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new kr(Nr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new kr(Nr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new kr(Nr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ys{constructor(t,e,i,n){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ms({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new kr(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new kr(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ms(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Mr;switch(t.type){case"firstParty":return new Ur(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new kr(Nr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=gs.get(t);e&&(_r("ComponentProvider","Removing Datastore"),gs.delete(t),e.terminate())}(this),Promise.resolve()}}function vs(t,e,i,n={}){var s;const o=(t=ds(t,ys))._getSettings(),a=`${e}:${i}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&function(t,...e){if(Ar.logLevel<=v.WARN){const i=e.map(Dr);Ar.warn(`Firestore (${Sr}): ${t}`,...i)}}("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),n.mockUserToken){let e,i;if("string"==typeof n.mockUserToken)e=n.mockUserToken,i=Ir.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",n=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(n.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=n.mockUserToken.sub||n.mockUserToken.user_id;if(!o)throw new kr(Nr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i=new Ir(o)}t._authCredentials=new xr(new Pr(e,i))}}class bs{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new cs(this,"async_queue_retry"),this.Xa=()=>{const t=ls();t&&_r("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const t=ls();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.eu(),this.tu(t)}enterRestrictedMode(t){if(!this.za){this.za=!0,this.Ya=t||!1;const e=ls();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xa)}}enqueue(t){if(this.eu(),this.za)return new Promise((()=>{}));const e=new Or;return this.tu((()=>this.za&&this.Ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ga.push(t),this.nu())))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(t){if(!Wr(t))throw t;_r("AsyncQueue","Operation failed with retryable error: "+t)}this.Ga.length>0&&this.Ko.xo((()=>this.nu()))}}tu(t){const e=this.Wa.then((()=>(this.Ja=!0,t().catch((t=>{this.Ha=t,this.Ja=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Cr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ja=!1,t))))));return this.Wa=e,e}enqueueAfterDelay(t,e,i){this.eu(),this.Za.indexOf(t)>-1&&(e=0);const n=us.createAndSchedule(this,t,e,i,(t=>this.ru(t)));return this.ja.push(n),n}eu(){this.Ha&&Rr()}verifyOperationInProgress(){}async iu(){let t;do{t=this.Wa,await t}while(t!==this.Wa)}su(t){for(const e of this.ja)if(e.timerId===t)return!0;return!1}ou(t){return this.iu().then((()=>{this.ja.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.ja)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.iu()}))}_u(t){this.Za.push(t)}ru(t){const e=this.ja.indexOf(t);this.ja.splice(e,1)}}class Es extends ys{constructor(t,e,i,n){super(t,e,i,n),this.type="firestore",this._queue=new bs,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||function(t){var e,i,n;const r=t._freezeSettings(),s=function(t,e,i,n){return new ns(t,e,i,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,ps(n.experimentalLongPollingOptions),n.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new fs(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(i=r.localCache)||void 0===i?void 0:i._offlineComponentProvider)&&(null===(n=r.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}(this),this._firestoreClient.terminate()}}!function(t,e=!0){Sr="10.1.0",J(new p("firestore",((t,{instanceIdentifier:i,options:n})=>{const r=t.getProvider("app").getImmediate(),s=new Es(new jr(t.getProvider("auth-internal")),new Hr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new kr(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(t.options.projectId,e)}(r,i),r);return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s}),"PUBLIC").setMultipleInstances(!0)),et(Tr,"4.1.0",t),et(Tr,"4.1.0","esm2017")}(),function(t,e){const i="string"==typeof t?t:"(default)",n=function(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=G){const e=W.get(t);if(!e&&t===G&&o())return tt();if(!e)throw Q.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:i});if(!n._initialized){const t=(t=>{const e=(t=>{var e,i;return null===(i=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===i?void 0:i[t]})(t);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(i+1),10);return"["===e[0]?[e.substring(1,i-1),n]:[e.substring(0,i),n]})("firestore");t&&vs(n,...t)}}(tt({apiKey:"AIzaSyAES8iOsxtgQhNved5dltrilIt8X5fxHL0",authDomain:"the-aggregator-b51bd.firebaseapp.com",projectId:"the-aggregator-b51bd",storageBucket:"the-aggregator-b51bd.appspot.com",messagingSenderId:"280028868322",appId:"1:280028868322:web:f654a928da9628d6c378bb",measurementId:"G-408NCFQLCF"}));const ws=["https://www.deepmind.com/blog/rss.xml","https://news.mit.edu/topic/mitmachine-learning-rss.xml"].map((t=>fetch("https://rss-to-json-serverless-api.vercel.app/api?feedURL="+t)));Promise.all(ws).then((t=>Promise.all(t.map((t=>t.json()))))).then((t=>t.map((t=>function(t){const e=function(){const t=new Date;return new Date(t.getFullYear()-1,t.getMonth(),t.getDate())}();return t.items.filter((t=>new Date(t.published)>e)).map((e=>({date:new Date(e.published),title:e.title,link:e.link,description:e.description||"No description available",source:t.title})))}(t))))).then((t=>function(t){const e=t.flat().sort(((t,e)=>e.date-t.date));return e}(t))).then((t=>console.log(t))).catch((t=>console.error(t)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YytDdm5DLENBQU1vQyxPQUNsRHVLLE1BQU1nN0IsR0FiVCxTQUFjQyxHQUNaLE1BQ01DLEVBRFlELEVBQU1FLE9BQ0NsOEIsTUFBSyxDQUFDaEosRUFBR0MsSUFBTUEsRUFBRXNQLEtBQU92UCxFQUFFdVAsT0FDbkQsT0FBTzAxQixDQUNULENBU29CajhCLENBQUsrN0IsS0FDdEJoN0IsTUFBTWs3QixHQUFXdm5DLFFBQVFvSixJQUFJbStCLEtBQzdCdm1DLE9BQU9mLEdBQVVELFFBQVFDLE1BQU1BIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhlX2FnZ3JlZ2F0b3Ivd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdGhlX2FnZ3JlZ2F0b3Ivd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvdXRpbC9kaXN0L2luZGV4LmVzbTIwMTcuanMiLCJ3ZWJwYWNrOi8vdGhlX2FnZ3JlZ2F0b3IvLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2NvbXBvbmVudC9kaXN0L2VzbS9pbmRleC5lc20yMDE3LmpzIiwid2VicGFjazovL3RoZV9hZ2dyZWdhdG9yLy4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9sb2dnZXIvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL25vZGVfbW9kdWxlcy9pZGIvYnVpbGQvd3JhcC1pZGItdmFsdWUuanMiLCJ3ZWJwYWNrOi8vdGhlX2FnZ3JlZ2F0b3IvLi9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2luZGV4LmpzIiwid2VicGFjazovL3RoZV9hZ2dyZWdhdG9yLy4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL25vZGVfbW9kdWxlcy9maXJlYmFzZS9hcHAvZGlzdC9lc20vaW5kZXguZXNtLmpzIiwid2VicGFjazovL3RoZV9hZ2dyZWdhdG9yLy4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvZmlyZXN0b3JlL2Rpc3QvaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL3NyYy9maXJlYmFzZS5qcyIsIndlYnBhY2s6Ly90aGVfYWdncmVnYXRvci8uL3NyYy9zY3JpcHQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS5cclxuICovXHJcbmNvbnN0IENPTlNUQU5UUyA9IHtcclxuICAgIC8qKlxyXG4gICAgICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGlzIHRoZSBjbGllbnQgTm9kZS5qcyBTREsuXHJcbiAgICAgKi9cclxuICAgIE5PREVfQ0xJRU5UOiBmYWxzZSxcclxuICAgIC8qKlxyXG4gICAgICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGlzIHRoZSBBZG1pbiBOb2RlLmpzIFNESy5cclxuICAgICAqL1xyXG4gICAgTk9ERV9BRE1JTjogZmFsc2UsXHJcbiAgICAvKipcclxuICAgICAqIEZpcmViYXNlIFNESyBWZXJzaW9uXHJcbiAgICAgKi9cclxuICAgIFNES19WRVJTSU9OOiAnJHtKU0NPUkVfVkVSU0lPTn0nXHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaHJvd3MgYW4gZXJyb3IgaWYgdGhlIHByb3ZpZGVkIGFzc2VydGlvbiBpcyBmYWxzeVxyXG4gKi9cclxuY29uc3QgYXNzZXJ0ID0gZnVuY3Rpb24gKGFzc2VydGlvbiwgbWVzc2FnZSkge1xyXG4gICAgaWYgKCFhc3NlcnRpb24pIHtcclxuICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcihtZXNzYWdlKTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIFJldHVybnMgYW4gRXJyb3Igb2JqZWN0IHN1aXRhYmxlIGZvciB0aHJvd2luZy5cclxuICovXHJcbmNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiBuZXcgRXJyb3IoJ0ZpcmViYXNlIERhdGFiYXNlICgnICtcclxuICAgICAgICBDT05TVEFOVFMuU0RLX1ZFUlNJT04gK1xyXG4gICAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgK1xyXG4gICAgICAgIG1lc3NhZ2UpO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBzdHJpbmdUb0J5dGVBcnJheSQxID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgbGV0IHAgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gYztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoKGMgJiAweGZjMDApID09PSAweGQ4MDAgJiZcclxuICAgICAgICAgICAgaSArIDEgPCBzdHIubGVuZ3RoICYmXHJcbiAgICAgICAgICAgIChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZjMDApID09PSAweGRjMDApIHtcclxuICAgICAgICAgICAgLy8gU3Vycm9nYXRlIFBhaXJcclxuICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoKGMgJiAweDAzZmYpIDw8IDEwKSArIChzdHIuY2hhckNvZGVBdCgrK2kpICYgMHgwM2ZmKTtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDEyKSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dDtcclxufTtcclxuLyoqXHJcbiAqIFR1cm5zIGFuIGFycmF5IG9mIG51bWJlcnMgaW50byB0aGUgc3RyaW5nIGdpdmVuIGJ5IHRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZVxyXG4gKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuXHJcbiAqIEBwYXJhbSBieXRlcyBBcnJheSBvZiBudW1iZXJzIHJlcHJlc2VudGluZyBjaGFyYWN0ZXJzLlxyXG4gKiBAcmV0dXJuIFN0cmluZ2lmaWNhdGlvbiBvZiB0aGUgYXJyYXkuXHJcbiAqL1xyXG5jb25zdCBieXRlQXJyYXlUb1N0cmluZyA9IGZ1bmN0aW9uIChieXRlcykge1xyXG4gICAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgbGV0IHBvcyA9IDAsIGMgPSAwO1xyXG4gICAgd2hpbGUgKHBvcyA8IGJ5dGVzLmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgIGlmIChjMSA8IDEyOCkge1xyXG4gICAgICAgICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYzEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjMSA+IDE5MSAmJiBjMSA8IDIyNCkge1xyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjMSA+IDIzOSAmJiBjMSA8IDM2NSkge1xyXG4gICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpclxyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgY29uc3QgYzMgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgICAgICBjb25zdCB1ID0gKCgoYzEgJiA3KSA8PCAxOCkgfCAoKGMyICYgNjMpIDw8IDEyKSB8ICgoYzMgJiA2MykgPDwgNikgfCAoYzQgJiA2MykpIC1cclxuICAgICAgICAgICAgICAgIDB4MTAwMDA7XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGQ4MDAgKyAodSA+PiAxMCkpO1xyXG4gICAgICAgICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhkYzAwICsgKHUgJiAxMDIzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgY29uc3QgYzMgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBvdXQuam9pbignJyk7XHJcbn07XHJcbi8vIFdlIGRlZmluZSBpdCBhcyBhbiBvYmplY3QgbGl0ZXJhbCBpbnN0ZWFkIG9mIGEgY2xhc3MgYmVjYXVzZSBhIGNsYXNzIGNvbXBpbGVkIGRvd24gdG8gZXM1IGNhbid0XHJcbi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxXHJcbi8vIFN0YXRpYyBsb29rdXAgbWFwcywgbGF6aWx5IHBvcHVsYXRlZCBieSBpbml0XygpXHJcbmNvbnN0IGJhc2U2NCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBieXRlcyB0byBjaGFyYWN0ZXJzLlxyXG4gICAgICovXHJcbiAgICBieXRlVG9DaGFyTWFwXzogbnVsbCxcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxyXG4gICAgICovXHJcbiAgICBjaGFyVG9CeXRlTWFwXzogbnVsbCxcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBieXRlcyB0byB3ZWJzYWZlIGNoYXJhY3RlcnMuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBieXRlVG9DaGFyTWFwV2ViU2FmZV86IG51bGwsXHJcbiAgICAvKipcclxuICAgICAqIE1hcHMgd2Vic2FmZSBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgY2hhclRvQnl0ZU1hcFdlYlNhZmVfOiBudWxsLFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldCwgc2hhcmVkIGJldHdlZW5cclxuICAgICAqIEVOQ09ERURfVkFMUyBhbmQgRU5DT0RFRF9WQUxTX1dFQlNBRkVcclxuICAgICAqL1xyXG4gICAgRU5DT0RFRF9WQUxTX0JBU0U6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWicgKyAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonICsgJzAxMjM0NTY3ODknLFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldC4gVmFsdWUgNjQgKD0pIGlzIHNwZWNpYWw7IGl0IG1lYW5zIFwibm90aGluZy5cIlxyXG4gICAgICovXHJcbiAgICBnZXQgRU5DT0RFRF9WQUxTKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJysvPSc7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgd2Vic2FmZSBhbHBoYWJldC5cclxuICAgICAqL1xyXG4gICAgZ2V0IEVOQ09ERURfVkFMU19XRUJTQUZFKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJy1fLic7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBXaGV0aGVyIHRoaXMgYnJvd3NlciBzdXBwb3J0cyB0aGUgYXRvYiBhbmQgYnRvYSBmdW5jdGlvbnMuIFRoaXMgZXh0ZW5zaW9uXHJcbiAgICAgKiBzdGFydGVkIGF0IE1vemlsbGEgYnV0IGlzIG5vdyBpbXBsZW1lbnRlZCBieSBtYW55IGJyb3dzZXJzLiBXZSB1c2UgdGhlXHJcbiAgICAgKiBBU1NVTUVfKiB2YXJpYWJsZXMgdG8gYXZvaWQgcHVsbGluZyBpbiB0aGUgZnVsbCB1c2VyYWdlbnQgZGV0ZWN0aW9uIGxpYnJhcnlcclxuICAgICAqIGJ1dCBzdGlsbCBhbGxvd2luZyB0aGUgc3RhbmRhcmQgcGVyLWJyb3dzZXIgY29tcGlsYXRpb25zLlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgSEFTX05BVElWRV9TVVBQT1JUOiB0eXBlb2YgYXRvYiA9PT0gJ2Z1bmN0aW9uJyxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWVuY29kZSBhbiBhcnJheSBvZiBieXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW5wdXQgQW4gYXJyYXkgb2YgYnl0ZXMgKG51bWJlcnMgd2l0aFxyXG4gICAgICogICAgIHZhbHVlIGluIFswLCAyNTVdKSB0byBlbmNvZGUuXHJcbiAgICAgKiBAcGFyYW0gd2ViU2FmZSBCb29sZWFuIGluZGljYXRpbmcgd2Ugc2hvdWxkIHVzZSB0aGVcclxuICAgICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC5cclxuICAgICAqIEByZXR1cm4gVGhlIGJhc2U2NCBlbmNvZGVkIHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgZW5jb2RlQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGlucHV0KSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignZW5jb2RlQnl0ZUFycmF5IHRha2VzIGFuIGFycmF5IGFzIGEgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5pdF8oKTtcclxuICAgICAgICBjb25zdCBieXRlVG9DaGFyTWFwID0gd2ViU2FmZVxyXG4gICAgICAgICAgICA/IHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfXHJcbiAgICAgICAgICAgIDogdGhpcy5ieXRlVG9DaGFyTWFwXztcclxuICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSArPSAzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUxID0gaW5wdXRbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgKyAxIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMiA9IGhhdmVCeXRlMiA/IGlucHV0W2kgKyAxXSA6IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgKyAyIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGlucHV0W2kgKyAyXSA6IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gYnl0ZTEgPj4gMjtcclxuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTIgPSAoKGJ5dGUxICYgMHgwMykgPDwgNCkgfCAoYnl0ZTIgPj4gNCk7XHJcbiAgICAgICAgICAgIGxldCBvdXRCeXRlMyA9ICgoYnl0ZTIgJiAweDBmKSA8PCAyKSB8IChieXRlMyA+PiA2KTtcclxuICAgICAgICAgICAgbGV0IG91dEJ5dGU0ID0gYnl0ZTMgJiAweDNmO1xyXG4gICAgICAgICAgICBpZiAoIWhhdmVCeXRlMykge1xyXG4gICAgICAgICAgICAgICAgb3V0Qnl0ZTQgPSA2NDtcclxuICAgICAgICAgICAgICAgIGlmICghaGF2ZUJ5dGUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0Qnl0ZTMgPSA2NDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvdXRwdXQucHVzaChieXRlVG9DaGFyTWFwW291dEJ5dGUxXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlMl0sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTNdLCBieXRlVG9DaGFyTWFwW291dEJ5dGU0XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBCYXNlNjQtZW5jb2RlIGEgc3RyaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnB1dCBBIHN0cmluZyB0byBlbmNvZGUuXHJcbiAgICAgKiBAcGFyYW0gd2ViU2FmZSBJZiB0cnVlLCB3ZSBzaG91bGQgdXNlIHRoZVxyXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxyXG4gICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBlbmNvZGVTdHJpbmcoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudFxyXG4gICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcclxuICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJ0b2EoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVCeXRlQXJyYXkoc3RyaW5nVG9CeXRlQXJyYXkkMShpbnB1dCksIHdlYlNhZmUpO1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW5wdXQgdG8gZGVjb2RlLlxyXG4gICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZVxyXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxyXG4gICAgICogQHJldHVybiBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBkZWNvZGVkIHZhbHVlLlxyXG4gICAgICovXHJcbiAgICBkZWNvZGVTdHJpbmcoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudFxyXG4gICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcclxuICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF0b2IoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYnl0ZUFycmF5VG9TdHJpbmcodGhpcy5kZWNvZGVTdHJpbmdUb0J5dGVBcnJheShpbnB1dCwgd2ViU2FmZSkpO1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy5cclxuICAgICAqXHJcbiAgICAgKiBJbiBiYXNlLTY0IGRlY29kaW5nLCBncm91cHMgb2YgZm91ciBjaGFyYWN0ZXJzIGFyZSBjb252ZXJ0ZWQgaW50byB0aHJlZVxyXG4gICAgICogYnl0ZXMuICBJZiB0aGUgZW5jb2RlciBkaWQgbm90IGFwcGx5IHBhZGRpbmcsIHRoZSBpbnB1dCBsZW5ndGggbWF5IG5vdFxyXG4gICAgICogYmUgYSBtdWx0aXBsZSBvZiA0LlxyXG4gICAgICpcclxuICAgICAqIEluIHRoaXMgY2FzZSwgdGhlIGxhc3QgZ3JvdXAgd2lsbCBoYXZlIGZld2VyIHRoYW4gNCBjaGFyYWN0ZXJzLCBhbmRcclxuICAgICAqIHBhZGRpbmcgd2lsbCBiZSBpbmZlcnJlZC4gIElmIHRoZSBncm91cCBoYXMgb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzXHJcbiAgICAgKiB0byBvbmUgYnl0ZS4gIElmIHRoZSBncm91cCBoYXMgdGhyZWUgY2hhcmFjdGVycywgaXQgZGVjb2RlcyB0byB0d28gYnl0ZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlucHV0IElucHV0IHRvIGRlY29kZS5cclxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIFRydWUgaWYgd2Ugc2hvdWxkIHVzZSB0aGUgd2ViLXNhZmUgYWxwaGFiZXQuXHJcbiAgICAgKiBAcmV0dXJuIGJ5dGVzIHJlcHJlc2VudGluZyB0aGUgZGVjb2RlZCB2YWx1ZS5cclxuICAgICAqL1xyXG4gICAgZGVjb2RlU3RyaW5nVG9CeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICB0aGlzLmluaXRfKCk7XHJcbiAgICAgICAgY29uc3QgY2hhclRvQnl0ZU1hcCA9IHdlYlNhZmVcclxuICAgICAgICAgICAgPyB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1xyXG4gICAgICAgICAgICA6IHRoaXMuY2hhclRvQnl0ZU1hcF87XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUxID0gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSsrKV07XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogMDtcclxuICAgICAgICAgICAgKytpO1xyXG4gICAgICAgICAgICBjb25zdCBoYXZlQnl0ZTMgPSBpIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0O1xyXG4gICAgICAgICAgICArK2k7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlNCA9IGkgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGU0ID0gaGF2ZUJ5dGU0ID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogNjQ7XHJcbiAgICAgICAgICAgICsraTtcclxuICAgICAgICAgICAgaWYgKGJ5dGUxID09IG51bGwgfHwgYnl0ZTIgPT0gbnVsbCB8fCBieXRlMyA9PSBudWxsIHx8IGJ5dGU0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gKGJ5dGUxIDw8IDIpIHwgKGJ5dGUyID4+IDQpO1xyXG4gICAgICAgICAgICBvdXRwdXQucHVzaChvdXRCeXRlMSk7XHJcbiAgICAgICAgICAgIGlmIChieXRlMyAhPT0gNjQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUyID0gKChieXRlMiA8PCA0KSAmIDB4ZjApIHwgKGJ5dGUzID4+IDIpO1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ5dGU0ICE9PSA2NCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUzID0gKChieXRlMyA8PCA2KSAmIDB4YzApIHwgYnl0ZTQ7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBMYXp5IHN0YXRpYyBpbml0aWFsaXphdGlvbiBmdW5jdGlvbi4gQ2FsbGVkIGJlZm9yZVxyXG4gICAgICogYWNjZXNzaW5nIGFueSBvZiB0aGUgc3RhdGljIG1hcCB2YXJpYWJsZXMuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBpbml0XygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuYnl0ZVRvQ2hhck1hcF8pIHtcclxuICAgICAgICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwXyA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfID0ge307XHJcbiAgICAgICAgICAgIC8vIFdlIHdhbnQgcXVpY2sgbWFwcGluZ3MgYmFjayBhbmQgZm9ydGgsIHNvIHdlIHByZWNvbXB1dGUgdHdvIG1hcHMuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5FTkNPREVEX1ZBTFMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcF9baV0gPSB0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuYnl0ZVRvQ2hhck1hcF9baV1dID0gaTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfW2ldID0gdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXV0gPSBpO1xyXG4gICAgICAgICAgICAgICAgLy8gQmUgZm9yZ2l2aW5nIHdoZW4gZGVjb2RpbmcgYW5kIGNvcnJlY3RseSBkZWNvZGUgYm90aCBlbmNvZGluZ3MuXHJcbiAgICAgICAgICAgICAgICBpZiAoaSA+PSB0aGlzLkVOQ09ERURfVkFMU19CQVNFLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF9bdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSldID0gaTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSldID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIEFuIGVycm9yIGVuY291bnRlcmVkIHdoaWxlIGRlY29kaW5nIGJhc2U2NCBzdHJpbmcuXHJcbiAqL1xyXG5jbGFzcyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gJ0RlY29kZUJhc2U2NFN0cmluZ0Vycm9yJztcclxuICAgIH1cclxufVxyXG4vKipcclxuICogVVJMLXNhZmUgYmFzZTY0IGVuY29kaW5nXHJcbiAqL1xyXG5jb25zdCBiYXNlNjRFbmNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICBjb25zdCB1dGY4Qnl0ZXMgPSBzdHJpbmdUb0J5dGVBcnJheSQxKHN0cik7XHJcbiAgICByZXR1cm4gYmFzZTY0LmVuY29kZUJ5dGVBcnJheSh1dGY4Qnl0ZXMsIHRydWUpO1xyXG59O1xyXG4vKipcclxuICogVVJMLXNhZmUgYmFzZTY0IGVuY29kaW5nICh3aXRob3V0IFwiLlwiIHBhZGRpbmcgaW4gdGhlIGVuZCkuXHJcbiAqIGUuZy4gVXNlZCBpbiBKU09OIFdlYiBUb2tlbiAoSldUKSBwYXJ0cy5cclxuICovXHJcbmNvbnN0IGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgLy8gVXNlIGJhc2U2NHVybCBlbmNvZGluZyBhbmQgcmVtb3ZlIHBhZGRpbmcgaW4gdGhlIGVuZCAoZG90IGNoYXJhY3RlcnMpLlxyXG4gICAgcmV0dXJuIGJhc2U2NEVuY29kZShzdHIpLnJlcGxhY2UoL1xcLi9nLCAnJyk7XHJcbn07XHJcbi8qKlxyXG4gKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmdcclxuICpcclxuICogTk9URTogRE8gTk9UIHVzZSB0aGUgZ2xvYmFsIGF0b2IoKSBmdW5jdGlvbiAtIGl0IGRvZXMgTk9UIHN1cHBvcnQgdGhlXHJcbiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLlxyXG4gKlxyXG4gKiBAcGFyYW0gc3RyIFRvIGJlIGRlY29kZWRcclxuICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGVcclxuICovXHJcbmNvbnN0IGJhc2U2NERlY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIGJhc2U2NC5kZWNvZGVTdHJpbmcoc3RyLCB0cnVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignYmFzZTY0RGVjb2RlIGZhaWxlZDogJywgZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIERvIGEgZGVlcC1jb3B5IG9mIGJhc2ljIEphdmFTY3JpcHQgT2JqZWN0cyBvciBBcnJheXMuXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWVwQ29weSh2YWx1ZSkge1xyXG4gICAgcmV0dXJuIGRlZXBFeHRlbmQodW5kZWZpbmVkLCB2YWx1ZSk7XHJcbn1cclxuLyoqXHJcbiAqIENvcHkgcHJvcGVydGllcyBmcm9tIHNvdXJjZSB0byB0YXJnZXQgKHJlY3Vyc2l2ZWx5IGFsbG93cyBleHRlbnNpb25cclxuICogb2YgT2JqZWN0cyBhbmQgQXJyYXlzKS4gIFNjYWxhciB2YWx1ZXMgaW4gdGhlIHRhcmdldCBhcmUgb3Zlci13cml0dGVuLlxyXG4gKiBJZiB0YXJnZXQgaXMgdW5kZWZpbmVkLCBhbiBvYmplY3Qgb2YgdGhlIGFwcHJvcHJpYXRlIHR5cGUgd2lsbCBiZSBjcmVhdGVkXHJcbiAqIChhbmQgcmV0dXJuZWQpLlxyXG4gKlxyXG4gKiBXZSByZWN1cnNpdmVseSBjb3B5IGFsbCBjaGlsZCBwcm9wZXJ0aWVzIG9mIHBsYWluIE9iamVjdHMgaW4gdGhlIHNvdXJjZS0gc29cclxuICogdGhhdCBuYW1lc3BhY2UtIGxpa2UgZGljdGlvbmFyaWVzIGFyZSBtZXJnZWQuXHJcbiAqXHJcbiAqIE5vdGUgdGhhdCB0aGUgdGFyZ2V0IGNhbiBiZSBhIGZ1bmN0aW9uLCBpbiB3aGljaCBjYXNlIHRoZSBwcm9wZXJ0aWVzIGluXHJcbiAqIHRoZSBzb3VyY2UgT2JqZWN0IGFyZSBjb3BpZWQgb250byBpdCBhcyBzdGF0aWMgcHJvcGVydGllcyBvZiB0aGUgRnVuY3Rpb24uXHJcbiAqXHJcbiAqIE5vdGU6IHdlIGRvbid0IG1lcmdlIF9fcHJvdG9fXyB0byBwcmV2ZW50IHByb3RvdHlwZSBwb2xsdXRpb25cclxuICovXHJcbmZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0LCBzb3VyY2UpIHtcclxuICAgIGlmICghKHNvdXJjZSBpbnN0YW5jZW9mIE9iamVjdCkpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlO1xyXG4gICAgfVxyXG4gICAgc3dpdGNoIChzb3VyY2UuY29uc3RydWN0b3IpIHtcclxuICAgICAgICBjYXNlIERhdGU6XHJcbiAgICAgICAgICAgIC8vIFRyZWF0IERhdGVzIGxpa2Ugc2NhbGFyczsgaWYgdGhlIHRhcmdldCBkYXRlIG9iamVjdCBoYWQgYW55IGNoaWxkXHJcbiAgICAgICAgICAgIC8vIHByb3BlcnRpZXMgLSB0aGV5IHdpbGwgYmUgbG9zdCFcclxuICAgICAgICAgICAgY29uc3QgZGF0ZVZhbHVlID0gc291cmNlO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZVZhbHVlLmdldFRpbWUoKSk7XHJcbiAgICAgICAgY2FzZSBPYmplY3Q6XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBBcnJheTpcclxuICAgICAgICAgICAgLy8gQWx3YXlzIGNvcHkgdGhlIGFycmF5IHNvdXJjZSBhbmQgb3ZlcndyaXRlIHRoZSB0YXJnZXQuXHJcbiAgICAgICAgICAgIHRhcmdldCA9IFtdO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAvLyBOb3QgYSBwbGFpbiBPYmplY3QgLSB0cmVhdCBpdCBhcyBhIHNjYWxhci5cclxuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgcHJvcCBpbiBzb3VyY2UpIHtcclxuICAgICAgICAvLyB1c2UgaXNWYWxpZEtleSB0byBndWFyZCBhZ2FpbnN0IHByb3RvdHlwZSBwb2xsdXRpb24uIFNlZSBodHRwczovL3NueWsuaW8vdnVsbi9TTllLLUpTLUxPREFTSC00NTAyMDJcclxuICAgICAgICBpZiAoIXNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSB8fCAhaXNWYWxpZEtleShwcm9wKSkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFyZ2V0W3Byb3BdID0gZGVlcEV4dGVuZCh0YXJnZXRbcHJvcF0sIHNvdXJjZVtwcm9wXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG59XHJcbmZ1bmN0aW9uIGlzVmFsaWRLZXkoa2V5KSB7XHJcbiAgICByZXR1cm4ga2V5ICE9PSAnX19wcm90b19fJztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUG9seWZpbGwgZm9yIGBnbG9iYWxUaGlzYCBvYmplY3QuXHJcbiAqIEByZXR1cm5zIHRoZSBgZ2xvYmFsVGhpc2Agb2JqZWN0IGZvciB0aGUgZ2l2ZW4gZW52aXJvbm1lbnQuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEdsb2JhbCgpIHtcclxuICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3c7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gZ2xvYmFsO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9jYXRlIGdsb2JhbCBvYmplY3QuJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdHNGcm9tR2xvYmFsID0gKCkgPT4gZ2V0R2xvYmFsKCkuX19GSVJFQkFTRV9ERUZBVUxUU19fO1xyXG4vKipcclxuICogQXR0ZW1wdCB0byByZWFkIGRlZmF1bHRzIGZyb20gYSBKU09OIHN0cmluZyBwcm92aWRlZCB0b1xyXG4gKiBwcm9jZXNzKC4pZW52KC4pX19GSVJFQkFTRV9ERUZBVUxUU19fIG9yIGEgSlNPTiBmaWxlIHdob3NlIHBhdGggaXMgaW5cclxuICogcHJvY2VzcyguKWVudiguKV9fRklSRUJBU0VfREVGQVVMVFNfUEFUSF9fXHJcbiAqIFRoZSBkb3RzIGFyZSBpbiBwYXJlbnMgYmVjYXVzZSBjZXJ0YWluIGNvbXBpbGVycyAoVml0ZT8pIGNhbm5vdFxyXG4gKiBoYW5kbGUgc2VlaW5nIHRoYXQgdmFyaWFibGUgaW4gY29tbWVudHMuXHJcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82ODM4XHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0c0Zyb21FbnZWYXJpYWJsZSA9ICgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb2Nlc3MuZW52ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGRlZmF1bHRzSnNvblN0cmluZyA9IHByb2Nlc3MuZW52Ll9fRklSRUJBU0VfREVGQVVMVFNfXztcclxuICAgIGlmIChkZWZhdWx0c0pzb25TdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkZWZhdWx0c0pzb25TdHJpbmcpO1xyXG4gICAgfVxyXG59O1xyXG5jb25zdCBnZXREZWZhdWx0c0Zyb21Db29raWUgPSAoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBtYXRjaDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgbWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2goL19fRklSRUJBU0VfREVGQVVMVFNfXz0oW147XSspLyk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIFNvbWUgZW52aXJvbm1lbnRzIHN1Y2ggYXMgQW5ndWxhciBVbml2ZXJzYWwgU1NSIGhhdmUgYVxyXG4gICAgICAgIC8vIGBkb2N1bWVudGAgb2JqZWN0IGJ1dCBlcnJvciBvbiBhY2Nlc3NpbmcgYGRvY3VtZW50LmNvb2tpZWAuXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVjb2RlZCA9IG1hdGNoICYmIGJhc2U2NERlY29kZShtYXRjaFsxXSk7XHJcbiAgICByZXR1cm4gZGVjb2RlZCAmJiBKU09OLnBhcnNlKGRlY29kZWQpO1xyXG59O1xyXG4vKipcclxuICogR2V0IHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LiBJdCBjaGVja3MgaW4gb3JkZXI6XHJcbiAqICgxKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgYXMgYSBwcm9wZXJ0eSBvZiBgZ2xvYmFsVGhpc2BcclxuICogKDIpIGlmIHN1Y2ggYW4gb2JqZWN0IHdhcyBwcm92aWRlZCBvbiBhIHNoZWxsIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAqICgzKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgaW4gYSBjb29raWVcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiAoZ2V0RGVmYXVsdHNGcm9tR2xvYmFsKCkgfHxcclxuICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tRW52VmFyaWFibGUoKSB8fFxyXG4gICAgICAgICAgICBnZXREZWZhdWx0c0Zyb21Db29raWUoKSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENhdGNoLWFsbCBmb3IgYmVpbmcgdW5hYmxlIHRvIGdldCBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gZHVlXHJcbiAgICAgICAgICogdG8gYW55IGVudmlyb25tZW50IGNhc2Ugd2UgaGF2ZSBub3QgYWNjb3VudGVkIGZvci4gTG9nIHRvXHJcbiAgICAgICAgICogaW5mbyBpbnN0ZWFkIG9mIHN3YWxsb3dpbmcgc28gd2UgY2FuIGZpbmQgdGhlc2UgdW5rbm93biBjYXNlc1xyXG4gICAgICAgICAqIGFuZCBhZGQgcGF0aHMgZm9yIHRoZW0gaWYgbmVlZGVkLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhgVW5hYmxlIHRvIGdldCBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gZHVlIHRvOiAke2V9YCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogUmV0dXJucyBlbXVsYXRvciBob3N0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdFxyXG4gKiBmb3IgdGhlIGdpdmVuIHByb2R1Y3QuXHJcbiAqIEByZXR1cm5zIGEgVVJMIGhvc3QgZm9ybWF0dGVkIGxpa2UgYDEyNy4wLjAuMTo5OTk5YCBvciBgWzo6MV06NDAwMGAgaWYgYXZhaWxhYmxlXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3QgPSAocHJvZHVjdE5hbWUpID0+IHsgdmFyIF9hLCBfYjsgcmV0dXJuIChfYiA9IChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lbXVsYXRvckhvc3RzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbcHJvZHVjdE5hbWVdOyB9O1xyXG4vKipcclxuICogUmV0dXJucyBlbXVsYXRvciBob3N0bmFtZSBhbmQgcG9ydCBzdG9yZWQgaW4gdGhlIF9fRklSRUJBU0VfREVGQVVMVFNfXyBvYmplY3RcclxuICogZm9yIHRoZSBnaXZlbiBwcm9kdWN0LlxyXG4gKiBAcmV0dXJucyBhIHBhaXIgb2YgaG9zdG5hbWUgYW5kIHBvcnQgbGlrZSBgW1wiOjoxXCIsIDQwMDBdYCBpZiBhdmFpbGFibGVcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0ID0gKHByb2R1Y3ROYW1lKSA9PiB7XHJcbiAgICBjb25zdCBob3N0ID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdChwcm9kdWN0TmFtZSk7XHJcbiAgICBpZiAoIWhvc3QpIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBob3N0Lmxhc3RJbmRleE9mKCc6Jyk7IC8vIEZpbmRpbmcgdGhlIGxhc3Qgc2luY2UgSVB2NiBhZGRyIGFsc28gaGFzIGNvbG9ucy5cclxuICAgIGlmIChzZXBhcmF0b3JJbmRleCA8PSAwIHx8IHNlcGFyYXRvckluZGV4ICsgMSA9PT0gaG9zdC5sZW5ndGgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgaG9zdCAke2hvc3R9IHdpdGggbm8gc2VwYXJhdGUgaG9zdG5hbWUgYW5kIHBvcnQhYCk7XHJcbiAgICB9XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXHJcbiAgICBjb25zdCBwb3J0ID0gcGFyc2VJbnQoaG9zdC5zdWJzdHJpbmcoc2VwYXJhdG9ySW5kZXggKyAxKSwgMTApO1xyXG4gICAgaWYgKGhvc3RbMF0gPT09ICdbJykge1xyXG4gICAgICAgIC8vIEJyYWNrZXQtcXVvdGVkIGBbaXB2NmFkZHJdOnBvcnRgID0+IHJldHVybiBcImlwdjZhZGRyXCIgKHdpdGhvdXQgYnJhY2tldHMpLlxyXG4gICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMSwgc2VwYXJhdG9ySW5kZXggLSAxKSwgcG9ydF07XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gW2hvc3Quc3Vic3RyaW5nKDAsIHNlcGFyYXRvckluZGV4KSwgcG9ydF07XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIEZpcmViYXNlIGFwcCBjb25maWcgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0QXBwQ29uZmlnID0gKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBnZXREZWZhdWx0cygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29uZmlnOyB9O1xyXG4vKipcclxuICogUmV0dXJucyBhbiBleHBlcmltZW50YWwgc2V0dGluZyBvbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdCAocHJvcGVydGllc1xyXG4gKiBwcmVmaXhlZCBieSBcIl9cIilcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RXhwZXJpbWVudGFsU2V0dGluZyA9IChuYW1lKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtgXyR7bmFtZX1gXTsgfTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgRGVmZXJyZWQge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5yZWplY3QgPSAoKSA9PiB7IH07XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlID0gKCkgPT4geyB9O1xyXG4gICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QgPSByZWplY3Q7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE91ciBBUEkgaW50ZXJuYWxzIGFyZSBub3QgcHJvbWlzZWlmaWVkIGFuZCBjYW5ub3QgYmVjYXVzZSBvdXIgY2FsbGJhY2sgQVBJcyBoYXZlIHN1YnRsZSBleHBlY3RhdGlvbnMgYXJvdW5kXHJcbiAgICAgKiBpbnZva2luZyBwcm9taXNlcyBpbmxpbmUsIHdoaWNoIFByb21pc2VzIGFyZSBmb3JiaWRkZW4gdG8gZG8uIFRoaXMgbWV0aG9kIGFjY2VwdHMgYW4gb3B0aW9uYWwgbm9kZS1zdHlsZSBjYWxsYmFja1xyXG4gICAgICogYW5kIHJldHVybnMgYSBub2RlLXN0eWxlIGNhbGxiYWNrIHdoaWNoIHdpbGwgcmVzb2x2ZSBvciByZWplY3QgdGhlIERlZmVycmVkJ3MgcHJvbWlzZS5cclxuICAgICAqL1xyXG4gICAgd3JhcENhbGxiYWNrKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIChlcnJvciwgdmFsdWUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIC8vIEF0dGFjaGluZyBub29wIGhhbmRsZXIganVzdCBpbiBjYXNlIGRldmVsb3BlciB3YXNuJ3QgZXhwZWN0aW5nXHJcbiAgICAgICAgICAgICAgICAvLyBwcm9taXNlc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9taXNlLmNhdGNoKCgpID0+IHsgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBTb21lIG9mIG91ciBjYWxsYmFja3MgZG9uJ3QgZXhwZWN0IGEgdmFsdWUgYW5kIG91ciBvd24gdGVzdHNcclxuICAgICAgICAgICAgICAgIC8vIGFzc2VydCB0aGF0IHRoZSBwYXJhbWV0ZXIgbGVuZ3RoIGlzIDFcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjay5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVNb2NrVXNlclRva2VuKHRva2VuLCBwcm9qZWN0SWQpIHtcclxuICAgIGlmICh0b2tlbi51aWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBcInVpZFwiIGZpZWxkIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQgYnkgbW9ja1VzZXJUb2tlbi4gUGxlYXNlIHVzZSBcInN1YlwiIGluc3RlYWQgZm9yIEZpcmViYXNlIEF1dGggVXNlciBJRC4nKTtcclxuICAgIH1cclxuICAgIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSBcIm5vbmVcIiBhcyB0aGUgYWxnb3JpdGhtLlxyXG4gICAgY29uc3QgaGVhZGVyID0ge1xyXG4gICAgICAgIGFsZzogJ25vbmUnLFxyXG4gICAgICAgIHR5cGU6ICdKV1QnXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcHJvamVjdCA9IHByb2plY3RJZCB8fCAnZGVtby1wcm9qZWN0JztcclxuICAgIGNvbnN0IGlhdCA9IHRva2VuLmlhdCB8fCAwO1xyXG4gICAgY29uc3Qgc3ViID0gdG9rZW4uc3ViIHx8IHRva2VuLnVzZXJfaWQ7XHJcbiAgICBpZiAoIXN1Yikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIm1vY2tVc2VyVG9rZW4gbXVzdCBjb250YWluICdzdWInIG9yICd1c2VyX2lkJyBmaWVsZCFcIik7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IFxyXG4gICAgICAgIC8vIFNldCBhbGwgcmVxdWlyZWQgZmllbGRzIHRvIGRlY2VudCBkZWZhdWx0c1xyXG4gICAgICAgIGlzczogYGh0dHBzOi8vc2VjdXJldG9rZW4uZ29vZ2xlLmNvbS8ke3Byb2plY3R9YCwgYXVkOiBwcm9qZWN0LCBpYXQsIGV4cDogaWF0ICsgMzYwMCwgYXV0aF90aW1lOiBpYXQsIHN1YiwgdXNlcl9pZDogc3ViLCBmaXJlYmFzZToge1xyXG4gICAgICAgICAgICBzaWduX2luX3Byb3ZpZGVyOiAnY3VzdG9tJyxcclxuICAgICAgICAgICAgaWRlbnRpdGllczoge31cclxuICAgICAgICB9IH0sIHRva2VuKTtcclxuICAgIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSB0aGUgZW1wdHkgc3RyaW5nIGFzIGEgc2lnbmF0dXJlLlxyXG4gICAgY29uc3Qgc2lnbmF0dXJlID0gJyc7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAgIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KGhlYWRlcikpLFxyXG4gICAgICAgIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKSxcclxuICAgICAgICBzaWduYXR1cmVcclxuICAgIF0uam9pbignLicpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIG5hdmlnYXRvci51c2VyQWdlbnQgc3RyaW5nIG9yICcnIGlmIGl0J3Mgbm90IGRlZmluZWQuXHJcbiAqIEByZXR1cm4gdXNlciBhZ2VudCBzdHJpbmdcclxuICovXHJcbmZ1bmN0aW9uIGdldFVBKCkge1xyXG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmXHJcbiAgICAgICAgdHlwZW9mIG5hdmlnYXRvclsndXNlckFnZW50J10gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvclsndXNlckFnZW50J107XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCBDb3Jkb3ZhIC8gUGhvbmVHYXAgLyBJb25pYyBmcmFtZXdvcmtzIG9uIGEgbW9iaWxlIGRldmljZS5cclxuICpcclxuICogRGVsaWJlcmF0ZWx5IGRvZXMgbm90IHJlbHkgb24gY2hlY2tpbmcgYGZpbGU6Ly9gIFVSTHMgKGFzIHRoaXMgZmFpbHMgUGhvbmVHYXBcclxuICogaW4gdGhlIFJpcHBsZSBlbXVsYXRvcikgbm9yIENvcmRvdmEgYG9uRGV2aWNlUmVhZHlgLCB3aGljaCB3b3VsZCBub3JtYWxseVxyXG4gKiB3YWl0IGZvciBhIGNhbGxiYWNrLlxyXG4gKi9cclxuZnVuY3Rpb24gaXNNb2JpbGVDb3Jkb3ZhKCkge1xyXG4gICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJlxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmUgU2V0dGluZyB1cCBhbiBicm9hZGx5IGFwcGxpY2FibGUgaW5kZXggc2lnbmF0dXJlIGZvciBXaW5kb3dcclxuICAgICAgICAvLyBqdXN0IHRvIGRlYWwgd2l0aCB0aGlzIGNhc2Ugd291bGQgcHJvYmFibHkgYmUgYSBiYWQgaWRlYS5cclxuICAgICAgICAhISh3aW5kb3dbJ2NvcmRvdmEnXSB8fCB3aW5kb3dbJ3Bob25lZ2FwJ10gfHwgd2luZG93WydQaG9uZUdhcCddKSAmJlxyXG4gICAgICAgIC9pb3N8aXBob25lfGlwb2R8aXBhZHxhbmRyb2lkfGJsYWNrYmVycnl8aWVtb2JpbGUvaS50ZXN0KGdldFVBKCkpKTtcclxufVxyXG4vKipcclxuICogRGV0ZWN0IE5vZGUuanMuXHJcbiAqXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBOb2RlLmpzIGVudmlyb25tZW50IGlzIGRldGVjdGVkIG9yIHNwZWNpZmllZC5cclxuICovXHJcbi8vIE5vZGUgZGV0ZWN0aW9uIGxvZ2ljIGZyb206IGh0dHBzOi8vZ2l0aHViLmNvbS9pbGlha2FuL2RldGVjdC1ub2RlL1xyXG5mdW5jdGlvbiBpc05vZGUoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICBjb25zdCBmb3JjZUVudmlyb25tZW50ID0gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvcmNlRW52aXJvbm1lbnQ7XHJcbiAgICBpZiAoZm9yY2VFbnZpcm9ubWVudCA9PT0gJ25vZGUnKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChmb3JjZUVudmlyb25tZW50ID09PSAnYnJvd3NlcicpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGdsb2JhbC5wcm9jZXNzKSA9PT0gJ1tvYmplY3QgcHJvY2Vzc10nKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBEZXRlY3QgQnJvd3NlciBFbnZpcm9ubWVudFxyXG4gKi9cclxuZnVuY3Rpb24gaXNCcm93c2VyKCkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBzZWxmID09PSAnb2JqZWN0JyAmJiBzZWxmLnNlbGYgPT09IHNlbGY7XHJcbn1cclxuZnVuY3Rpb24gaXNCcm93c2VyRXh0ZW5zaW9uKCkge1xyXG4gICAgY29uc3QgcnVudGltZSA9IHR5cGVvZiBjaHJvbWUgPT09ICdvYmplY3QnXHJcbiAgICAgICAgPyBjaHJvbWUucnVudGltZVxyXG4gICAgICAgIDogdHlwZW9mIGJyb3dzZXIgPT09ICdvYmplY3QnXHJcbiAgICAgICAgICAgID8gYnJvd3Nlci5ydW50aW1lXHJcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBydW50aW1lID09PSAnb2JqZWN0JyAmJiBydW50aW1lLmlkICE9PSB1bmRlZmluZWQ7XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCBSZWFjdCBOYXRpdmUuXHJcbiAqXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBSZWFjdE5hdGl2ZSBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZC5cclxuICovXHJcbmZ1bmN0aW9uIGlzUmVhY3ROYXRpdmUoKSB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvclsncHJvZHVjdCddID09PSAnUmVhY3ROYXRpdmUnKTtcclxufVxyXG4vKiogRGV0ZWN0cyBFbGVjdHJvbiBhcHBzLiAqL1xyXG5mdW5jdGlvbiBpc0VsZWN0cm9uKCkge1xyXG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignRWxlY3Ryb24vJykgPj0gMDtcclxufVxyXG4vKiogRGV0ZWN0cyBJbnRlcm5ldCBFeHBsb3Jlci4gKi9cclxuZnVuY3Rpb24gaXNJRSgpIHtcclxuICAgIGNvbnN0IHVhID0gZ2V0VUEoKTtcclxuICAgIHJldHVybiB1YS5pbmRleE9mKCdNU0lFICcpID49IDAgfHwgdWEuaW5kZXhPZignVHJpZGVudC8nKSA+PSAwO1xyXG59XHJcbi8qKiBEZXRlY3RzIFVuaXZlcnNhbCBXaW5kb3dzIFBsYXRmb3JtIGFwcHMuICovXHJcbmZ1bmN0aW9uIGlzVVdQKCkge1xyXG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignTVNBcHBIb3N0LycpID49IDA7XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IFNESyBidWlsZCBpcyB0aGUgTm9kZSB2ZXJzaW9uLlxyXG4gKlxyXG4gKiBAcmV0dXJuIHRydWUgaWYgaXQncyB0aGUgTm9kZSBTREsgYnVpbGQuXHJcbiAqL1xyXG5mdW5jdGlvbiBpc05vZGVTZGsoKSB7XHJcbiAgICByZXR1cm4gQ09OU1RBTlRTLk5PREVfQ0xJRU5UID09PSB0cnVlIHx8IENPTlNUQU5UUy5OT0RFX0FETUlOID09PSB0cnVlO1xyXG59XHJcbi8qKiBSZXR1cm5zIHRydWUgaWYgd2UgYXJlIHJ1bm5pbmcgaW4gU2FmYXJpLiAqL1xyXG5mdW5jdGlvbiBpc1NhZmFyaSgpIHtcclxuICAgIHJldHVybiAoIWlzTm9kZSgpICYmXHJcbiAgICAgICAgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnU2FmYXJpJykgJiZcclxuICAgICAgICAhbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnQ2hyb21lJykpO1xyXG59XHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCBjaGVja3MgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxyXG4gKiBAcmV0dXJuIHRydWUgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxyXG4gKi9cclxuZnVuY3Rpb24gaXNJbmRleGVkREJBdmFpbGFibGUoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhlZERCID09PSAnb2JqZWN0JztcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCB2YWxpZGF0ZXMgYnJvd3Nlci9zdyBjb250ZXh0IGZvciBpbmRleGVkREIgYnkgb3BlbmluZyBhIGR1bW15IGluZGV4ZWREQiBkYXRhYmFzZSBhbmQgcmVqZWN0XHJcbiAqIGlmIGVycm9ycyBvY2N1ciBkdXJpbmcgdGhlIGRhdGFiYXNlIG9wZW4gb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAdGhyb3dzIGV4Y2VwdGlvbiBpZiBjdXJyZW50IGJyb3dzZXIvc3cgY29udGV4dCBjYW4ndCBydW4gaWRiLm9wZW4gKGV4OiBTYWZhcmkgaWZyYW1lLCBGaXJlZm94XHJcbiAqIHByaXZhdGUgYnJvd3NpbmcpXHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBsZXQgcHJlRXhpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb25zdCBEQl9DSEVDS19OQU1FID0gJ3ZhbGlkYXRlLWJyb3dzZXItY29udGV4dC1mb3ItaW5kZXhlZGRiLWFuYWx5dGljcy1tb2R1bGUnO1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihEQl9DSEVDS19OQU1FKTtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnJlc3VsdC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlIGRhdGFiYXNlIG9ubHkgd2hlbiBpdCBkb2Vzbid0IHByZS1leGlzdFxyXG4gICAgICAgICAgICAgICAgaWYgKCFwcmVFeGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKERCX0NIRUNLX05BTUUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBwcmVFeGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoKChfYSA9IHJlcXVlc3QuZXJyb3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZXNzYWdlKSB8fCAnJyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBjaGVja3Mgd2hldGhlciBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXHJcbiAqL1xyXG5mdW5jdGlvbiBhcmVDb29raWVzRW5hYmxlZCgpIHtcclxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yID09PSAndW5kZWZpbmVkJyB8fCAhbmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGZpbGVvdmVydmlldyBTdGFuZGFyZGl6ZWQgRmlyZWJhc2UgRXJyb3IuXHJcbiAqXHJcbiAqIFVzYWdlOlxyXG4gKlxyXG4gKiAgIC8vIFR5cGVzY3JpcHQgc3RyaW5nIGxpdGVyYWxzIGZvciB0eXBlLXNhZmUgY29kZXNcclxuICogICB0eXBlIEVyciA9XHJcbiAqICAgICAndW5rbm93bicgfFxyXG4gKiAgICAgJ29iamVjdC1ub3QtZm91bmQnXHJcbiAqICAgICA7XHJcbiAqXHJcbiAqICAgLy8gQ2xvc3VyZSBlbnVtIGZvciB0eXBlLXNhZmUgZXJyb3IgY29kZXNcclxuICogICAvLyBhdC1lbnVtIHtzdHJpbmd9XHJcbiAqICAgdmFyIEVyciA9IHtcclxuICogICAgIFVOS05PV046ICd1bmtub3duJyxcclxuICogICAgIE9CSkVDVF9OT1RfRk9VTkQ6ICdvYmplY3Qtbm90LWZvdW5kJyxcclxuICogICB9XHJcbiAqXHJcbiAqICAgbGV0IGVycm9yczogTWFwPEVyciwgc3RyaW5nPiA9IHtcclxuICogICAgICdnZW5lcmljLWVycm9yJzogXCJVbmtub3duIGVycm9yXCIsXHJcbiAqICAgICAnZmlsZS1ub3QtZm91bmQnOiBcIkNvdWxkIG5vdCBmaW5kIGZpbGU6IHskZmlsZX1cIixcclxuICogICB9O1xyXG4gKlxyXG4gKiAgIC8vIFR5cGUtc2FmZSBmdW5jdGlvbiAtIG11c3QgcGFzcyBhIHZhbGlkIGVycm9yIGNvZGUgYXMgcGFyYW0uXHJcbiAqICAgbGV0IGVycm9yID0gbmV3IEVycm9yRmFjdG9yeTxFcnI+KCdzZXJ2aWNlJywgJ1NlcnZpY2UnLCBlcnJvcnMpO1xyXG4gKlxyXG4gKiAgIC4uLlxyXG4gKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuR0VORVJJQyk7XHJcbiAqICAgLi4uXHJcbiAqICAgdGhyb3cgZXJyb3IuY3JlYXRlKEVyci5GSUxFX05PVF9GT1VORCwgeydmaWxlJzogZmlsZU5hbWV9KTtcclxuICogICAuLi5cclxuICogICAvLyBTZXJ2aWNlOiBDb3VsZCBub3QgZmlsZSBmaWxlOiBmb28udHh0IChzZXJ2aWNlL2ZpbGUtbm90LWZvdW5kKS5cclxuICpcclxuICogICBjYXRjaCAoZSkge1xyXG4gKiAgICAgYXNzZXJ0KGUubWVzc2FnZSA9PT0gXCJDb3VsZCBub3QgZmluZCBmaWxlOiBmb28udHh0LlwiKTtcclxuICogICAgIGlmICgoZSBhcyBGaXJlYmFzZUVycm9yKT8uY29kZSA9PT0gJ3NlcnZpY2UvZmlsZS1ub3QtZm91bmQnKSB7XHJcbiAqICAgICAgIGNvbnNvbGUubG9nKFwiQ291bGQgbm90IHJlYWQgZmlsZTogXCIgKyBlWydmaWxlJ10pO1xyXG4gKiAgICAgfVxyXG4gKiAgIH1cclxuICovXHJcbmNvbnN0IEVSUk9SX05BTUUgPSAnRmlyZWJhc2VFcnJvcic7XHJcbi8vIEJhc2VkIG9uIGNvZGUgZnJvbTpcclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRXJyb3IjQ3VzdG9tX0Vycm9yX1R5cGVzXHJcbmNsYXNzIEZpcmViYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKiBUaGUgZXJyb3IgY29kZSBmb3IgdGhpcyBlcnJvci4gKi9cclxuICAgIGNvZGUsIG1lc3NhZ2UsIFxyXG4gICAgLyoqIEN1c3RvbSBkYXRhIGZvciB0aGlzIGVycm9yLiAqL1xyXG4gICAgY3VzdG9tRGF0YSkge1xyXG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xyXG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XHJcbiAgICAgICAgdGhpcy5jdXN0b21EYXRhID0gY3VzdG9tRGF0YTtcclxuICAgICAgICAvKiogVGhlIGN1c3RvbSBuYW1lIGZvciBhbGwgRmlyZWJhc2VFcnJvcnMuICovXHJcbiAgICAgICAgdGhpcy5uYW1lID0gRVJST1JfTkFNRTtcclxuICAgICAgICAvLyBGaXggRm9yIEVTNVxyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrXHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIEZpcmViYXNlRXJyb3IucHJvdG90eXBlKTtcclxuICAgICAgICAvLyBNYWludGFpbnMgcHJvcGVyIHN0YWNrIHRyYWNlIGZvciB3aGVyZSBvdXIgZXJyb3Igd2FzIHRocm93bi5cclxuICAgICAgICAvLyBPbmx5IGF2YWlsYWJsZSBvbiBWOC5cclxuICAgICAgICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcclxuICAgICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgRXJyb3JGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5jbGFzcyBFcnJvckZhY3Rvcnkge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZSwgc2VydmljZU5hbWUsIGVycm9ycykge1xyXG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTmFtZSA9IHNlcnZpY2VOYW1lO1xyXG4gICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlKGNvZGUsIC4uLmRhdGEpIHtcclxuICAgICAgICBjb25zdCBjdXN0b21EYXRhID0gZGF0YVswXSB8fCB7fTtcclxuICAgICAgICBjb25zdCBmdWxsQ29kZSA9IGAke3RoaXMuc2VydmljZX0vJHtjb2RlfWA7XHJcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmVycm9yc1tjb2RlXTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gdGVtcGxhdGUgPyByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGUsIGN1c3RvbURhdGEpIDogJ0Vycm9yJztcclxuICAgICAgICAvLyBTZXJ2aWNlIE5hbWU6IEVycm9yIG1lc3NhZ2UgKHNlcnZpY2UvY29kZSkuXHJcbiAgICAgICAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgJHt0aGlzLnNlcnZpY2VOYW1lfTogJHttZXNzYWdlfSAoJHtmdWxsQ29kZX0pLmA7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRmlyZWJhc2VFcnJvcihmdWxsQ29kZSwgZnVsbE1lc3NhZ2UsIGN1c3RvbURhdGEpO1xyXG4gICAgICAgIHJldHVybiBlcnJvcjtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGUsIGRhdGEpIHtcclxuICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKFBBVFRFUk4sIChfLCBrZXkpID0+IHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGRhdGFba2V5XTtcclxuICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCA/IFN0cmluZyh2YWx1ZSkgOiBgPCR7a2V5fT8+YDtcclxuICAgIH0pO1xyXG59XHJcbmNvbnN0IFBBVFRFUk4gPSAvXFx7XFwkKFtefV0rKX0vZztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEV2YWx1YXRlcyBhIEpTT04gc3RyaW5nIGludG8gYSBqYXZhc2NyaXB0IG9iamVjdC5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBBIHN0cmluZyBjb250YWluaW5nIEpTT04uXHJcbiAqIEByZXR1cm4geyp9IFRoZSBqYXZhc2NyaXB0IG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNwZWNpZmllZCBKU09OLlxyXG4gKi9cclxuZnVuY3Rpb24ganNvbkV2YWwoc3RyKSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm5zIEpTT04gcmVwcmVzZW50aW5nIGEgamF2YXNjcmlwdCBvYmplY3QuXHJcbiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhc2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC5cclxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgSlNPTiBjb250ZW50cyBvZiB0aGUgb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24gc3RyaW5naWZ5KGRhdGEpIHtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGludG8gY29uc3RpdHVlbnQgcGFydHMuXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gd2l0aCBpbnZhbGlkIC8gaW5jb21wbGV0ZSBjbGFpbXMgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXHJcbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXHJcbiAqL1xyXG5jb25zdCBkZWNvZGUgPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGxldCBoZWFkZXIgPSB7fSwgY2xhaW1zID0ge30sIGRhdGEgPSB7fSwgc2lnbmF0dXJlID0gJyc7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gdG9rZW4uc3BsaXQoJy4nKTtcclxuICAgICAgICBoZWFkZXIgPSBqc29uRXZhbChiYXNlNjREZWNvZGUocGFydHNbMF0pIHx8ICcnKTtcclxuICAgICAgICBjbGFpbXMgPSBqc29uRXZhbChiYXNlNjREZWNvZGUocGFydHNbMV0pIHx8ICcnKTtcclxuICAgICAgICBzaWduYXR1cmUgPSBwYXJ0c1syXTtcclxuICAgICAgICBkYXRhID0gY2xhaW1zWydkJ10gfHwge307XHJcbiAgICAgICAgZGVsZXRlIGNsYWltc1snZCddO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHsgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBoZWFkZXIsXHJcbiAgICAgICAgY2xhaW1zLFxyXG4gICAgICAgIGRhdGEsXHJcbiAgICAgICAgc2lnbmF0dXJlXHJcbiAgICB9O1xyXG59O1xyXG4vKipcclxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGFuZCBjaGVja3MgdGhlIHZhbGlkaXR5IG9mIGl0cyB0aW1lLWJhc2VkIGNsYWltcy4gV2lsbCByZXR1cm4gdHJ1ZSBpZiB0aGVcclxuICogdG9rZW4gaXMgd2l0aGluIHRoZSB0aW1lIHdpbmRvdyBhdXRob3JpemVkIGJ5IHRoZSAnbmJmJyAobm90LWJlZm9yZSkgYW5kICdpYXQnIChpc3N1ZWQtYXQpIGNsYWltcy5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNWYWxpZFRpbWVzdGFtcCA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgY29uc3QgY2xhaW1zID0gZGVjb2RlKHRva2VuKS5jbGFpbXM7XHJcbiAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XHJcbiAgICBsZXQgdmFsaWRTaW5jZSA9IDAsIHZhbGlkVW50aWwgPSAwO1xyXG4gICAgaWYgKHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnbmJmJykpIHtcclxuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snbmJmJ107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0JykpIHtcclxuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snaWF0J107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2V4cCcpKSB7XHJcbiAgICAgICAgICAgIHZhbGlkVW50aWwgPSBjbGFpbXNbJ2V4cCddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdG9rZW4gd2lsbCBleHBpcmUgYWZ0ZXIgMjRoIGJ5IGRlZmF1bHRcclxuICAgICAgICAgICAgdmFsaWRVbnRpbCA9IHZhbGlkU2luY2UgKyA4NjQwMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCEhbm93ICYmXHJcbiAgICAgICAgISF2YWxpZFNpbmNlICYmXHJcbiAgICAgICAgISF2YWxpZFVudGlsICYmXHJcbiAgICAgICAgbm93ID49IHZhbGlkU2luY2UgJiZcclxuICAgICAgICBub3cgPD0gdmFsaWRVbnRpbCk7XHJcbn07XHJcbi8qKlxyXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIHJldHVybnMgaXRzIGlzc3VlZCBhdCB0aW1lIGlmIHZhbGlkLCBudWxsIG90aGVyd2lzZS5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBudWxsIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNzdWVkQXRUaW1lID0gZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICBjb25zdCBjbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcclxuICAgIGlmICh0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2lhdCcpKSB7XHJcbiAgICAgICAgcmV0dXJuIGNsYWltc1snaWF0J107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuLyoqXHJcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBpdHMgZm9ybWF0LiBFeHBlY3RzIGEgdmFsaWQgaXNzdWVkLWF0IHRpbWUuXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cclxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cclxuICovXHJcbmNvbnN0IGlzVmFsaWRGb3JtYXQgPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGUodG9rZW4pLCBjbGFpbXMgPSBkZWNvZGVkLmNsYWltcztcclxuICAgIHJldHVybiAhIWNsYWltcyAmJiB0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2lhdCcpO1xyXG59O1xyXG4vKipcclxuICogQXR0ZW1wdHMgdG8gcGVlciBpbnRvIGFuIGF1dGggdG9rZW4gYW5kIGRldGVybWluZSBpZiBpdCdzIGFuIGFkbWluIGF1dGggdG9rZW4gYnkgbG9va2luZyBhdCB0aGUgY2xhaW1zIHBvcnRpb24uXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cclxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cclxuICovXHJcbmNvbnN0IGlzQWRtaW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGNvbnN0IGNsYWltcyA9IGRlY29kZSh0b2tlbikuY2xhaW1zO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltc1snYWRtaW4nXSA9PT0gdHJ1ZTtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gY29udGFpbnMob2JqLCBrZXkpIHtcclxuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpO1xyXG59XHJcbmZ1bmN0aW9uIHNhZmVHZXQob2JqLCBrZXkpIHtcclxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc0VtcHR5KG9iaikge1xyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIG1hcChvYmosIGZuLCBjb250ZXh0T2JqKSB7XHJcbiAgICBjb25zdCByZXMgPSB7fTtcclxuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xyXG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XHJcbiAgICAgICAgICAgIHJlc1trZXldID0gZm4uY2FsbChjb250ZXh0T2JqLCBvYmpba2V5XSwga2V5LCBvYmopO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuLyoqXHJcbiAqIERlZXAgZXF1YWwgdHdvIG9iamVjdHMuIFN1cHBvcnQgQXJyYXlzIGFuZCBPYmplY3RzLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVlcEVxdWFsKGEsIGIpIHtcclxuICAgIGlmIChhID09PSBiKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xyXG4gICAgY29uc3QgYktleXMgPSBPYmplY3Qua2V5cyhiKTtcclxuICAgIGZvciAoY29uc3QgayBvZiBhS2V5cykge1xyXG4gICAgICAgIGlmICghYktleXMuaW5jbHVkZXMoaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBhUHJvcCA9IGFba107XHJcbiAgICAgICAgY29uc3QgYlByb3AgPSBiW2tdO1xyXG4gICAgICAgIGlmIChpc09iamVjdChhUHJvcCkgJiYgaXNPYmplY3QoYlByb3ApKSB7XHJcbiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChhUHJvcCAhPT0gYlByb3ApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgayBvZiBiS2V5cykge1xyXG4gICAgICAgIGlmICghYUtleXMuaW5jbHVkZXMoaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGlzT2JqZWN0KHRoaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpbmcgIT09IG51bGwgJiYgdHlwZW9mIHRoaW5nID09PSAnb2JqZWN0JztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmVqZWN0cyBpZiB0aGUgZ2l2ZW4gcHJvbWlzZSBkb2Vzbid0IHJlc29sdmUgaW4gdGltZUluTVMgbWlsbGlzZWNvbmRzLlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIHByb21pc2VXaXRoVGltZW91dChwcm9taXNlLCB0aW1lSW5NUyA9IDIwMDApIHtcclxuICAgIGNvbnN0IGRlZmVycmVkUHJvbWlzZSA9IG5ldyBEZWZlcnJlZCgpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiBkZWZlcnJlZFByb21pc2UucmVqZWN0KCd0aW1lb3V0IScpLCB0aW1lSW5NUyk7XHJcbiAgICBwcm9taXNlLnRoZW4oZGVmZXJyZWRQcm9taXNlLnJlc29sdmUsIGRlZmVycmVkUHJvbWlzZS5yZWplY3QpO1xyXG4gICAgcmV0dXJuIGRlZmVycmVkUHJvbWlzZS5wcm9taXNlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcXVlcnlzdHJpbmctZm9ybWF0dGVkIHN0cmluZyAoZS5nLiAmYXJnPXZhbCZhcmcyPXZhbDIpIGZyb20gYVxyXG4gKiBwYXJhbXMgb2JqZWN0IChlLmcuIHthcmc6ICd2YWwnLCBhcmcyOiAndmFsMid9KVxyXG4gKiBOb3RlOiBZb3UgbXVzdCBwcmVwZW5kIGl0IHdpdGggPyB3aGVuIGFkZGluZyBpdCB0byBhIFVSTC5cclxuICovXHJcbmZ1bmN0aW9uIHF1ZXJ5c3RyaW5nKHF1ZXJ5c3RyaW5nUGFyYW1zKSB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSBbXTtcclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5c3RyaW5nUGFyYW1zKSkge1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICB2YWx1ZS5mb3JFYWNoKGFycmF5VmFsID0+IHtcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFycmF5VmFsKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGFyYW1zLmxlbmd0aCA/ICcmJyArIHBhcmFtcy5qb2luKCcmJykgOiAnJztcclxufVxyXG4vKipcclxuICogRGVjb2RlcyBhIHF1ZXJ5c3RyaW5nIChlLmcuID9hcmc9dmFsJmFyZzI9dmFsMikgaW50byBhIHBhcmFtcyBvYmplY3RcclxuICogKGUuZy4ge2FyZzogJ3ZhbCcsIGFyZzI6ICd2YWwyJ30pXHJcbiAqL1xyXG5mdW5jdGlvbiBxdWVyeXN0cmluZ0RlY29kZShxdWVyeXN0cmluZykge1xyXG4gICAgY29uc3Qgb2JqID0ge307XHJcbiAgICBjb25zdCB0b2tlbnMgPSBxdWVyeXN0cmluZy5yZXBsYWNlKC9eXFw/LywgJycpLnNwbGl0KCcmJyk7XHJcbiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XHJcbiAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHRva2VuLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgICAgIG9ialtkZWNvZGVVUklDb21wb25lbnQoa2V5KV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG9iajtcclxufVxyXG4vKipcclxuICogRXh0cmFjdCB0aGUgcXVlcnkgc3RyaW5nIHBhcnQgb2YgYSBVUkwsIGluY2x1ZGluZyB0aGUgbGVhZGluZyBxdWVzdGlvbiBtYXJrIChpZiBwcmVzZW50KS5cclxuICovXHJcbmZ1bmN0aW9uIGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpIHtcclxuICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSB1cmwuaW5kZXhPZignPycpO1xyXG4gICAgaWYgKCFxdWVyeVN0YXJ0KSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZnJhZ21lbnRTdGFydCA9IHVybC5pbmRleE9mKCcjJywgcXVlcnlTdGFydCk7XHJcbiAgICByZXR1cm4gdXJsLnN1YnN0cmluZyhxdWVyeVN0YXJ0LCBmcmFnbWVudFN0YXJ0ID4gMCA/IGZyYWdtZW50U3RhcnQgOiB1bmRlZmluZWQpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAZmlsZW92ZXJ2aWV3IFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaC5cclxuICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzpcclxuICogaHR0cDovL2NzcmMubmlzdC5nb3YvcHVibGljYXRpb25zL2ZpcHMvZmlwczE4MC0zL2ZpcHMxODAtM19maW5hbC5wZGYuXHJcbiAqXHJcbiAqIFVzYWdlOlxyXG4gKiAgIHZhciBzaGExID0gbmV3IHNoYTEoKTtcclxuICogICBzaGExLnVwZGF0ZShieXRlcyk7XHJcbiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpO1xyXG4gKlxyXG4gKiBQZXJmb3JtYW5jZTpcclxuICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3NcclxuICogICBGaXJlZm94IDE2OiAgfjI1MCBNYml0L3NcclxuICpcclxuICovXHJcbi8qKlxyXG4gKiBTSEEtMSBjcnlwdG9ncmFwaGljIGhhc2ggY29uc3RydWN0b3IuXHJcbiAqXHJcbiAqIFRoZSBwcm9wZXJ0aWVzIGRlY2xhcmVkIGhlcmUgYXJlIGRpc2N1c3NlZCBpbiB0aGUgYWJvdmUgYWxnb3JpdGhtIGRvY3VtZW50LlxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQGZpbmFsXHJcbiAqIEBzdHJ1Y3RcclxuICovXHJcbmNsYXNzIFNoYTEge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc19cclxuICAgICAgICAgKiBmdW5jdGlvbi5cclxuICAgICAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuY2hhaW5fID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0LlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5idWZfID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQW4gYXJyYXkgb2YgODAgYnl0ZXMsIGVhY2ggYSBwYXJ0IG9mIHRoZSBtZXNzYWdlIHRvIGJlIGhhc2hlZC4gIFJlZmVycmVkIHRvXHJcbiAgICAgICAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuXHJcbiAgICAgICAgICogQHByaXZhdGVcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLldfID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ29udGFpbnMgZGF0YSBuZWVkZWQgdG8gcGFkIG1lc3NhZ2VzIGxlc3MgdGhhbiA2NCBieXRlcy5cclxuICAgICAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucGFkXyA9IFtdO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlIHtudW1iZXJ9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlIHtudW1iZXJ9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy50b3RhbF8gPSAwO1xyXG4gICAgICAgIHRoaXMuYmxvY2tTaXplID0gNTEyIC8gODtcclxuICAgICAgICB0aGlzLnBhZF9bMF0gPSAxMjg7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmJsb2NrU2l6ZTsgKytpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFkX1tpXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgIH1cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzBdID0gMHg2NzQ1MjMwMTtcclxuICAgICAgICB0aGlzLmNoYWluX1sxXSA9IDB4ZWZjZGFiODk7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlO1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzNdID0gMHgxMDMyNTQ3NjtcclxuICAgICAgICB0aGlzLmNoYWluX1s0XSA9IDB4YzNkMmUxZjA7XHJcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xyXG4gICAgICAgIHRoaXMudG90YWxfID0gMDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW50ZXJuYWwgY29tcHJlc3MgaGVscGVyIGZ1bmN0aW9uLlxyXG4gICAgICogQHBhcmFtIGJ1ZiBCbG9jayB0byBjb21wcmVzcy5cclxuICAgICAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9mIHRoZSBibG9jayBpbiB0aGUgYnVmZmVyLlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgY29tcHJlc3NfKGJ1Ziwgb2Zmc2V0KSB7XHJcbiAgICAgICAgaWYgKCFvZmZzZXQpIHtcclxuICAgICAgICAgICAgb2Zmc2V0ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgVyA9IHRoaXMuV187XHJcbiAgICAgICAgLy8gZ2V0IDE2IGJpZyBlbmRpYW4gd29yZHNcclxuICAgICAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHVzZXIpOiBbYnVnIDgxNDAxMjJdIFJlY2VudCB2ZXJzaW9ucyBvZiBTYWZhcmkgZm9yIE1hYyBPUyBhbmQgaU9TXHJcbiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgYnVnIHRoYXQgdHVybnMgdGhlIHBvc3QtaW5jcmVtZW50ICsrIG9wZXJhdG9yIGludG8gcHJlLWluY3JlbWVudFxyXG4gICAgICAgICAgICAgICAgLy8gZHVyaW5nIEpJVCBjb21waWxhdGlvbi4gIFdlIGhhdmUgY29kZSB0aGF0IGRlcGVuZHMgaGVhdmlseSBvbiBTSEEtMSBmb3JcclxuICAgICAgICAgICAgICAgIC8vIGNvcnJlY3RuZXNzIGFuZCB3aGljaCBpcyBhZmZlY3RlZCBieSB0aGlzIGJ1Zywgc28gSSd2ZSByZW1vdmVkIGFsbCB1c2VzXHJcbiAgICAgICAgICAgICAgICAvLyBvZiBwb3N0LWluY3JlbWVudCArKyBpbiB3aGljaCB0aGUgcmVzdWx0IHZhbHVlIGlzIHVzZWQuICBXZSBjYW4gcmV2ZXJ0XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGNoYW5nZSBvbmNlIHRoZSBTYWZhcmkgYnVnXHJcbiAgICAgICAgICAgICAgICAvLyAoaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEwOTAzNikgaGFzIGJlZW4gZml4ZWQgYW5kXHJcbiAgICAgICAgICAgICAgICAvLyBtb3N0IGNsaWVudHMgaGF2ZSBiZWVuIHVwZGF0ZWQuXHJcbiAgICAgICAgICAgICAgICBXW2ldID1cclxuICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0KSA8PCAyNCkgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGJ1Zi5jaGFyQ29kZUF0KG9mZnNldCArIDIpIDw8IDgpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMyk7XHJcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBXW2ldID1cclxuICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldF0gPDwgMjQpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGJ1ZltvZmZzZXQgKyAxXSA8PCAxNikgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldCArIDJdIDw8IDgpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmW29mZnNldCArIDNdO1xyXG4gICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZXhwYW5kIHRvIDgwIHdvcmRzXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE2OyBpIDwgODA7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTtcclxuICAgICAgICAgICAgV1tpXSA9ICgodCA8PCAxKSB8ICh0ID4+PiAzMSkpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGEgPSB0aGlzLmNoYWluX1swXTtcclxuICAgICAgICBsZXQgYiA9IHRoaXMuY2hhaW5fWzFdO1xyXG4gICAgICAgIGxldCBjID0gdGhpcy5jaGFpbl9bMl07XHJcbiAgICAgICAgbGV0IGQgPSB0aGlzLmNoYWluX1szXTtcclxuICAgICAgICBsZXQgZSA9IHRoaXMuY2hhaW5fWzRdO1xyXG4gICAgICAgIGxldCBmLCBrO1xyXG4gICAgICAgIC8vIFRPRE8odXNlcik6IFRyeSB0byB1bnJvbGwgdGhpcyBsb29wIHRvIHNwZWVkIHVwIHRoZSBjb21wdXRhdGlvbi5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDgwOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGkgPCA0MCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGYgPSBkIF4gKGIgJiAoYyBeIGQpKTtcclxuICAgICAgICAgICAgICAgICAgICBrID0gMHg1YTgyNzk5OTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGYgPSBiIF4gYyBeIGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgayA9IDB4NmVkOWViYTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA8IDYwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IChiICYgYykgfCAoZCAmIChiIHwgYykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGsgPSAweDhmMWJiY2RjO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDtcclxuICAgICAgICAgICAgICAgICAgICBrID0gMHhjYTYyYzFkNjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ID0gKCgoYSA8PCA1KSB8IChhID4+PiAyNykpICsgZiArIGUgKyBrICsgV1tpXSkgJiAweGZmZmZmZmZmO1xyXG4gICAgICAgICAgICBlID0gZDtcclxuICAgICAgICAgICAgZCA9IGM7XHJcbiAgICAgICAgICAgIGMgPSAoKGIgPDwgMzApIHwgKGIgPj4+IDIpKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgICAgIGIgPSBhO1xyXG4gICAgICAgICAgICBhID0gdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMF0gPSAodGhpcy5jaGFpbl9bMF0gKyBhKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAodGhpcy5jaGFpbl9bMl0gKyBjKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bM10gPSAodGhpcy5jaGFpbl9bM10gKyBkKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoYnl0ZXMsIGxlbmd0aCkge1xyXG4gICAgICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrXHJcbiAgICAgICAgaWYgKGJ5dGVzID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbGVuZ3RoID0gYnl0ZXMubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBsZW5ndGhNaW51c0Jsb2NrID0gbGVuZ3RoIC0gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgbGV0IG4gPSAwO1xyXG4gICAgICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LlxyXG4gICAgICAgIGNvbnN0IGJ1ZiA9IHRoaXMuYnVmXztcclxuICAgICAgICBsZXQgaW5idWYgPSB0aGlzLmluYnVmXztcclxuICAgICAgICAvLyBUaGUgb3V0ZXIgd2hpbGUgbG9vcCBzaG91bGQgZXhlY3V0ZSBhdCBtb3N0IHR3aWNlLlxyXG4gICAgICAgIHdoaWxlIChuIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgaGF2ZSBubyBkYXRhIGluIHRoZSBibG9jayB0byB0b3AgdXAsIHdlIGNhbiBkaXJlY3RseSBwcm9jZXNzIHRoZVxyXG4gICAgICAgICAgICAvLyBpbnB1dCBidWZmZXIgKGFzc3VtaW5nIGl0IGNvbnRhaW5zIHN1ZmZpY2llbnQgZGF0YSkuIFRoaXMgZ2l2ZXMgfjI1JVxyXG4gICAgICAgICAgICAvLyBzcGVlZHVwIG9uIENocm9tZSAyMyBhbmQgfjE1JSBzcGVlZHVwIG9uIEZpcmVmb3ggMTYsIGJ1dCByZXF1aXJlcyB0aGF0XHJcbiAgICAgICAgICAgIC8vIHRoZSBkYXRhIGlzIHByb3ZpZGVkIGluIGxhcmdlIGNodW5rcyAob3IgaW4gbXVsdGlwbGVzIG9mIDY0IGJ5dGVzKS5cclxuICAgICAgICAgICAgaWYgKGluYnVmID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAobiA8PSBsZW5ndGhNaW51c0Jsb2NrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wcmVzc18oYnl0ZXMsIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmW2luYnVmXSA9IGJ5dGVzLmNoYXJDb2RlQXQobik7XHJcbiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjtcclxuICAgICAgICAgICAgICAgICAgICArK247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmJ1ZiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXNbbl07XHJcbiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjtcclxuICAgICAgICAgICAgICAgICAgICArK247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmJ1ZiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5idWZfID0gaW5idWY7XHJcbiAgICAgICAgdGhpcy50b3RhbF8gKz0gbGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgLyoqIEBvdmVycmlkZSAqL1xyXG4gICAgZGlnZXN0KCkge1xyXG4gICAgICAgIGNvbnN0IGRpZ2VzdCA9IFtdO1xyXG4gICAgICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7XHJcbiAgICAgICAgLy8gQWRkIHBhZCAweDgwIDB4MDAqLlxyXG4gICAgICAgIGlmICh0aGlzLmluYnVmXyA8IDU2KSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLnBhZF8sIHRoaXMuYmxvY2tTaXplIC0gKHRoaXMuaW5idWZfIC0gNTYpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQWRkICMgYml0cy5cclxuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ibG9ja1NpemUgLSAxOyBpID49IDU2OyBpLS0pIHtcclxuICAgICAgICAgICAgdGhpcy5idWZfW2ldID0gdG90YWxCaXRzICYgMjU1O1xyXG4gICAgICAgICAgICB0b3RhbEJpdHMgLz0gMjU2OyAvLyBEb24ndCB1c2UgYml0LXNoaWZ0aW5nIGhlcmUhXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29tcHJlc3NfKHRoaXMuYnVmXyk7XHJcbiAgICAgICAgbGV0IG4gPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAyNDsgaiA+PSAwOyBqIC09IDgpIHtcclxuICAgICAgICAgICAgICAgIGRpZ2VzdFtuXSA9ICh0aGlzLmNoYWluX1tpXSA+PiBqKSAmIDI1NTtcclxuICAgICAgICAgICAgICAgICsrbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGlnZXN0O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBIZWxwZXIgdG8gbWFrZSBhIFN1YnNjcmliZSBmdW5jdGlvbiAoanVzdCBsaWtlIFByb21pc2UgaGVscHMgbWFrZSBhXHJcbiAqIFRoZW5hYmxlKS5cclxuICpcclxuICogQHBhcmFtIGV4ZWN1dG9yIEZ1bmN0aW9uIHdoaWNoIGNhbiBtYWtlIGNhbGxzIHRvIGEgc2luZ2xlIE9ic2VydmVyXHJcbiAqICAgICBhcyBhIHByb3h5LlxyXG4gKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVTdWJzY3JpYmUoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpIHtcclxuICAgIGNvbnN0IHByb3h5ID0gbmV3IE9ic2VydmVyUHJveHkoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpO1xyXG4gICAgcmV0dXJuIHByb3h5LnN1YnNjcmliZS5iaW5kKHByb3h5KTtcclxufVxyXG4vKipcclxuICogSW1wbGVtZW50IGZhbi1vdXQgZm9yIGFueSBudW1iZXIgb2YgT2JzZXJ2ZXJzIGF0dGFjaGVkIHZpYSBhIHN1YnNjcmliZVxyXG4gKiBmdW5jdGlvbi5cclxuICovXHJcbmNsYXNzIE9ic2VydmVyUHJveHkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXJcclxuICAgICAqICAgICBhcyBhIHByb3h5LlxyXG4gICAgICogQHBhcmFtIG9uTm9PYnNlcnZlcnMgQ2FsbGJhY2sgd2hlbiBjb3VudCBvZiBPYnNlcnZlcnMgZ29lcyB0byB6ZXJvLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihleGVjdXRvciwgb25Ob09ic2VydmVycykge1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XHJcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZXMgPSBbXTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgPSAwO1xyXG4gICAgICAgIC8vIE1pY3JvLXRhc2sgc2NoZWR1bGluZyBieSBjYWxsaW5nIHRhc2sudGhlbigpLlxyXG4gICAgICAgIHRoaXMudGFzayA9IFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgIHRoaXMuZmluYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gb25Ob09ic2VydmVycztcclxuICAgICAgICAvLyBDYWxsIHRoZSBleGVjdXRvciBhc3luY2hyb25vdXNseSBzbyBzdWJzY3JpYmVycyB0aGF0IGFyZSBjYWxsZWRcclxuICAgICAgICAvLyBzeW5jaHJvbm91c2x5IGFmdGVyIHRoZSBjcmVhdGlvbiBvZiB0aGUgc3Vic2NyaWJlIGZ1bmN0aW9uXHJcbiAgICAgICAgLy8gY2FuIHN0aWxsIHJlY2VpdmUgdGhlIHZlcnkgZmlyc3QgdmFsdWUgZ2VuZXJhdGVkIGluIHRoZSBleGVjdXRvci5cclxuICAgICAgICB0aGlzLnRhc2tcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBleGVjdXRvcih0aGlzKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZXh0KHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpYmUgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBhZGQgYW4gT2JzZXJ2ZXIgdG8gdGhlIGZhbi1vdXQgbGlzdC5cclxuICAgICAqXHJcbiAgICAgKiAtIFdlIHJlcXVpcmUgdGhhdCBubyBldmVudCBpcyBzZW50IHRvIGEgc3Vic2NyaWJlciBzeWNocm9ub3VzbHkgdG8gdGhlaXJcclxuICAgICAqICAgY2FsbCB0byBzdWJzY3JpYmUoKS5cclxuICAgICAqL1xyXG4gICAgc3Vic2NyaWJlKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGUpIHtcclxuICAgICAgICBsZXQgb2JzZXJ2ZXI7XHJcbiAgICAgICAgaWYgKG5leHRPck9ic2VydmVyID09PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgZXJyb3IgPT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgICAgICBjb21wbGV0ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPYnNlcnZlci4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQXNzZW1ibGUgYW4gT2JzZXJ2ZXIgb2JqZWN0IHdoZW4gcGFzc2VkIGFzIGNhbGxiYWNrIGZ1bmN0aW9ucy5cclxuICAgICAgICBpZiAoaW1wbGVtZW50c0FueU1ldGhvZHMobmV4dE9yT2JzZXJ2ZXIsIFtcclxuICAgICAgICAgICAgJ25leHQnLFxyXG4gICAgICAgICAgICAnZXJyb3InLFxyXG4gICAgICAgICAgICAnY29tcGxldGUnXHJcbiAgICAgICAgXSkpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXh0T3JPYnNlcnZlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0ge1xyXG4gICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsXHJcbiAgICAgICAgICAgICAgICBlcnJvcixcclxuICAgICAgICAgICAgICAgIGNvbXBsZXRlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYnNlcnZlci5uZXh0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCA9IG5vb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYnNlcnZlci5lcnJvciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yID0gbm9vcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9ic2VydmVyLmNvbXBsZXRlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUgPSBub29wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB1bnN1YiA9IHRoaXMudW5zdWJzY3JpYmVPbmUuYmluZCh0aGlzLCB0aGlzLm9ic2VydmVycy5sZW5ndGgpO1xyXG4gICAgICAgIC8vIEF0dGVtcHQgdG8gc3Vic2NyaWJlIHRvIGEgdGVybWluYXRlZCBPYnNlcnZhYmxlIC0gd2VcclxuICAgICAgICAvLyBqdXN0IHJlc3BvbmQgdG8gdGhlIE9ic2VydmVyIHdpdGggdGhlIGZpbmFsIGVycm9yIG9yIGNvbXBsZXRlXHJcbiAgICAgICAgLy8gZXZlbnQuXHJcbiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcclxuICAgICAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5maW5hbEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKHRoaXMuZmluYWxFcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XHJcbiAgICAgICAgcmV0dXJuIHVuc3ViO1xyXG4gICAgfVxyXG4gICAgLy8gVW5zdWJzY3JpYmUgaXMgc3luY2hyb25vdXMgLSB3ZSBndWFyYW50ZWUgdGhhdCBubyBldmVudHMgYXJlIHNlbnQgdG9cclxuICAgIC8vIGFueSB1bnN1YnNjcmliZWQgT2JzZXJ2ZXIuXHJcbiAgICB1bnN1YnNjcmliZU9uZShpKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzID09PSB1bmRlZmluZWQgfHwgdGhpcy5vYnNlcnZlcnNbaV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlbGV0ZSB0aGlzLm9ic2VydmVyc1tpXTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgLT0gMTtcclxuICAgICAgICBpZiAodGhpcy5vYnNlcnZlckNvdW50ID09PSAwICYmIHRoaXMub25Ob09ic2VydmVycyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25Ob09ic2VydmVycyh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3JFYWNoT2JzZXJ2ZXIoZm4pIHtcclxuICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcclxuICAgICAgICAgICAgLy8gQWxyZWFkeSBjbG9zZWQgYnkgcHJldmlvdXMgZXZlbnQuLi4uanVzdCBlYXQgdGhlIGFkZGl0aW9uYWwgdmFsdWVzLlxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFNpbmNlIHNlbmRPbmUgY2FsbHMgYXN5bmNocm9ub3VzbHkgLSB0aGVyZSBpcyBubyBjaGFuY2UgdGhhdFxyXG4gICAgICAgIC8vIHRoaXMub2JzZXJ2ZXJzIHdpbGwgYmVjb21lIHVuZGVmaW5lZC5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZE9uZShpLCBmbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gQ2FsbCB0aGUgT2JzZXJ2ZXIgdmlhIG9uZSBvZiBpdCdzIGNhbGxiYWNrIGZ1bmN0aW9uLiBXZSBhcmUgY2FyZWZ1bCB0b1xyXG4gICAgLy8gY29uZmlybSB0aGF0IHRoZSBvYnNlcnZlIGhhcyBub3QgYmVlbiB1bnN1YnNjcmliZWQgc2luY2UgdGhpcyBhc3luY2hyb25vdXNcclxuICAgIC8vIGZ1bmN0aW9uIGhhZCBiZWVuIHF1ZXVlZC5cclxuICAgIHNlbmRPbmUoaSwgZm4pIHtcclxuICAgICAgICAvLyBFeGVjdXRlIHRoZSBjYWxsYmFjayBhc3luY2hyb25vdXNseVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcclxuICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVycyAhPT0gdW5kZWZpbmVkICYmIHRoaXMub2JzZXJ2ZXJzW2ldICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm4odGhpcy5vYnNlcnZlcnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgZXhjZXB0aW9ucyByYWlzZWQgaW4gT2JzZXJ2ZXJzIG9yIG1pc3NpbmcgbWV0aG9kcyBvZiBhblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE9ic2VydmVyLlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIExvZyBlcnJvciB0byBjb25zb2xlLiBiLzMxNDA0ODA2XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjbG9zZShlcnIpIHtcclxuICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZpbmFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKGVyciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmluYWxFcnJvciA9IGVycjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUHJveHkgaXMgbm8gbG9uZ2VyIG5lZWRlZCAtIGdhcmJhZ2UgY29sbGVjdCByZWZlcmVuY2VzXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHRoaXMub25Ob09ic2VydmVycyA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4vKiogVHVybiBzeW5jaHJvbm91cyBmdW5jdGlvbiBpbnRvIG9uZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkuICovXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXHJcbmZ1bmN0aW9uIGFzeW5jKGZuLCBvbkVycm9yKSB7XHJcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcclxuICAgICAgICBQcm9taXNlLnJlc29sdmUodHJ1ZSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBmbiguLi5hcmdzKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChvbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBvbkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufVxyXG4vKipcclxuICogUmV0dXJuIHRydWUgaWYgdGhlIG9iamVjdCBwYXNzZWQgaW4gaW1wbGVtZW50cyBhbnkgb2YgdGhlIG5hbWVkIG1ldGhvZHMuXHJcbiAqL1xyXG5mdW5jdGlvbiBpbXBsZW1lbnRzQW55TWV0aG9kcyhvYmosIG1ldGhvZHMpIHtcclxuICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBmb3IgKGNvbnN0IG1ldGhvZCBvZiBtZXRob2RzKSB7XHJcbiAgICAgICAgaWYgKG1ldGhvZCBpbiBvYmogJiYgdHlwZW9mIG9ialttZXRob2RdID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiBub29wKCkge1xyXG4gICAgLy8gZG8gbm90aGluZ1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBDaGVjayB0byBtYWtlIHN1cmUgdGhlIGFwcHJvcHJpYXRlIG51bWJlciBvZiBhcmd1bWVudHMgYXJlIHByb3ZpZGVkIGZvciBhIHB1YmxpYyBmdW5jdGlvbi5cclxuICogVGhyb3dzIGFuIGVycm9yIGlmIGl0IGZhaWxzLlxyXG4gKlxyXG4gKiBAcGFyYW0gZm5OYW1lIFRoZSBmdW5jdGlvbiBuYW1lXHJcbiAqIEBwYXJhbSBtaW5Db3VudCBUaGUgbWluaW11bSBudW1iZXIgb2YgYXJndW1lbnRzIHRvIGFsbG93IGZvciB0aGUgZnVuY3Rpb24gY2FsbFxyXG4gKiBAcGFyYW0gbWF4Q291bnQgVGhlIG1heGltdW0gbnVtYmVyIG9mIGFyZ3VtZW50IHRvIGFsbG93IGZvciB0aGUgZnVuY3Rpb24gY2FsbFxyXG4gKiBAcGFyYW0gYXJnQ291bnQgVGhlIGFjdHVhbCBudW1iZXIgb2YgYXJndW1lbnRzIHByb3ZpZGVkLlxyXG4gKi9cclxuY29uc3QgdmFsaWRhdGVBcmdDb3VudCA9IGZ1bmN0aW9uIChmbk5hbWUsIG1pbkNvdW50LCBtYXhDb3VudCwgYXJnQ291bnQpIHtcclxuICAgIGxldCBhcmdFcnJvcjtcclxuICAgIGlmIChhcmdDb3VudCA8IG1pbkNvdW50KSB7XHJcbiAgICAgICAgYXJnRXJyb3IgPSAnYXQgbGVhc3QgJyArIG1pbkNvdW50O1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYXJnQ291bnQgPiBtYXhDb3VudCkge1xyXG4gICAgICAgIGFyZ0Vycm9yID0gbWF4Q291bnQgPT09IDAgPyAnbm9uZScgOiAnbm8gbW9yZSB0aGFuICcgKyBtYXhDb3VudDtcclxuICAgIH1cclxuICAgIGlmIChhcmdFcnJvcikge1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gZm5OYW1lICtcclxuICAgICAgICAgICAgJyBmYWlsZWQ6IFdhcyBjYWxsZWQgd2l0aCAnICtcclxuICAgICAgICAgICAgYXJnQ291bnQgK1xyXG4gICAgICAgICAgICAoYXJnQ291bnQgPT09IDEgPyAnIGFyZ3VtZW50LicgOiAnIGFyZ3VtZW50cy4nKSArXHJcbiAgICAgICAgICAgICcgRXhwZWN0cyAnICtcclxuICAgICAgICAgICAgYXJnRXJyb3IgK1xyXG4gICAgICAgICAgICAnLic7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yKTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIEdlbmVyYXRlcyBhIHN0cmluZyB0byBwcmVmaXggYW4gZXJyb3IgbWVzc2FnZSBhYm91dCBmYWlsZWQgYXJndW1lbnQgdmFsaWRhdGlvblxyXG4gKlxyXG4gKiBAcGFyYW0gZm5OYW1lIFRoZSBmdW5jdGlvbiBuYW1lXHJcbiAqIEBwYXJhbSBhcmdOYW1lIFRoZSBuYW1lIG9mIHRoZSBhcmd1bWVudFxyXG4gKiBAcmV0dXJuIFRoZSBwcmVmaXggdG8gYWRkIHRvIHRoZSBlcnJvciB0aHJvd24gZm9yIHZhbGlkYXRpb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBlcnJvclByZWZpeChmbk5hbWUsIGFyZ05hbWUpIHtcclxuICAgIHJldHVybiBgJHtmbk5hbWV9IGZhaWxlZDogJHthcmdOYW1lfSBhcmd1bWVudCBgO1xyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0gZm5OYW1lXHJcbiAqIEBwYXJhbSBhcmd1bWVudE51bWJlclxyXG4gKiBAcGFyYW0gbmFtZXNwYWNlXHJcbiAqIEBwYXJhbSBvcHRpb25hbFxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVOYW1lc3BhY2UoZm5OYW1lLCBuYW1lc3BhY2UsIG9wdGlvbmFsKSB7XHJcbiAgICBpZiAob3B0aW9uYWwgJiYgIW5hbWVzcGFjZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgbmFtZXNwYWNlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIC8vVE9ETzogSSBzaG91bGQgZG8gbW9yZSB2YWxpZGF0aW9uIGhlcmUuIFdlIG9ubHkgYWxsb3cgY2VydGFpbiBjaGFycyBpbiBuYW1lc3BhY2VzLlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsICduYW1lc3BhY2UnKSArICdtdXN0IGJlIGEgdmFsaWQgZmlyZWJhc2UgbmFtZXNwYWNlLicpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ2FsbGJhY2soZm5OYW1lLCBhcmd1bWVudE5hbWUsIFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xyXG5jYWxsYmFjaywgb3B0aW9uYWwpIHtcclxuICAgIGlmIChvcHRpb25hbCAmJiAhY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4KGZuTmFtZSwgYXJndW1lbnROYW1lKSArICdtdXN0IGJlIGEgdmFsaWQgZnVuY3Rpb24uJyk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gdmFsaWRhdGVDb250ZXh0T2JqZWN0KGZuTmFtZSwgYXJndW1lbnROYW1lLCBjb250ZXh0LCBvcHRpb25hbCkge1xyXG4gICAgaWYgKG9wdGlvbmFsICYmICFjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBjb250ZXh0ICE9PSAnb2JqZWN0JyB8fCBjb250ZXh0ID09PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4KGZuTmFtZSwgYXJndW1lbnROYW1lKSArICdtdXN0IGJlIGEgdmFsaWQgY29udGV4dCBvYmplY3QuJyk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLy8gQ29kZSBvcmlnaW5hbGx5IGNhbWUgZnJvbSBnb29nLmNyeXB0LnN0cmluZ1RvVXRmOEJ5dGVBcnJheSwgYnV0IGZvciBzb21lIHJlYXNvbiB0aGV5XHJcbi8vIGF1dG9tYXRpY2FsbHkgcmVwbGFjZWQgJ1xcclxcbicgd2l0aCAnXFxuJywgYW5kIHRoZXkgZGlkbid0IGhhbmRsZSBzdXJyb2dhdGUgcGFpcnMsXHJcbi8vIHNvIGl0J3MgYmVlbiBtb2RpZmllZC5cclxuLy8gTm90ZSB0aGF0IG5vdCBhbGwgVW5pY29kZSBjaGFyYWN0ZXJzIGFwcGVhciBhcyBzaW5nbGUgY2hhcmFjdGVycyBpbiBKYXZhU2NyaXB0IHN0cmluZ3MuXHJcbi8vIGZyb21DaGFyQ29kZSByZXR1cm5zIHRoZSBVVEYtMTYgZW5jb2Rpbmcgb2YgYSBjaGFyYWN0ZXIgLSBzbyBzb21lIFVuaWNvZGUgY2hhcmFjdGVyc1xyXG4vLyB1c2UgMiBjaGFyYWN0ZXJzIGluIEphdmFzY3JpcHQuICBBbGwgNC1ieXRlIFVURi04IGNoYXJhY3RlcnMgYmVnaW4gd2l0aCBhIGZpcnN0XHJcbi8vIGNoYXJhY3RlciBpbiB0aGUgcmFuZ2UgMHhEODAwIC0gMHhEQkZGICh0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIGEgc28tY2FsbGVkIHN1cnJvZ2F0ZVxyXG4vLyBwYWlyKS5cclxuLy8gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xLjNcclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcclxuICogQHJldHVybiB7QXJyYXl9XHJcbiAqL1xyXG5jb25zdCBzdHJpbmdUb0J5dGVBcnJheSA9IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgbGV0IHAgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIC8vIElzIHRoaXMgdGhlIGxlYWQgc3Vycm9nYXRlIGluIGEgc3Vycm9nYXRlIHBhaXI/XHJcbiAgICAgICAgaWYgKGMgPj0gMHhkODAwICYmIGMgPD0gMHhkYmZmKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhpZ2ggPSBjIC0gMHhkODAwOyAvLyB0aGUgaGlnaCAxMCBiaXRzLlxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgIGFzc2VydChpIDwgc3RyLmxlbmd0aCwgJ1N1cnJvZ2F0ZSBwYWlyIG1pc3NpbmcgdHJhaWwgc3Vycm9nYXRlLicpO1xyXG4gICAgICAgICAgICBjb25zdCBsb3cgPSBzdHIuY2hhckNvZGVBdChpKSAtIDB4ZGMwMDsgLy8gdGhlIGxvdyAxMCBiaXRzLlxyXG4gICAgICAgICAgICBjID0gMHgxMDAwMCArIChoaWdoIDw8IDEwKSArIGxvdztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSBjO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDYpIHwgMTkyO1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjIDwgNjU1MzYpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxMikgfCAyMjQ7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDEyKSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dDtcclxufTtcclxuLyoqXHJcbiAqIENhbGN1bGF0ZSBsZW5ndGggd2l0aG91dCBhY3R1YWxseSBjb252ZXJ0aW5nOyB1c2VmdWwgZm9yIGRvaW5nIGNoZWFwZXIgdmFsaWRhdGlvbi5cclxuICogQHBhcmFtIHtzdHJpbmd9IHN0clxyXG4gKiBAcmV0dXJuIHtudW1iZXJ9XHJcbiAqL1xyXG5jb25zdCBzdHJpbmdMZW5ndGggPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICBsZXQgcCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGMgPSBzdHIuY2hhckNvZGVBdChpKTtcclxuICAgICAgICBpZiAoYyA8IDEyOCkge1xyXG4gICAgICAgICAgICBwKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMgPCAyMDQ4KSB7XHJcbiAgICAgICAgICAgIHAgKz0gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcclxuICAgICAgICAgICAgLy8gTGVhZCBzdXJyb2dhdGUgb2YgYSBzdXJyb2dhdGUgcGFpci4gIFRoZSBwYWlyIHRvZ2V0aGVyIHdpbGwgdGFrZSA0IGJ5dGVzIHRvIHJlcHJlc2VudC5cclxuICAgICAgICAgICAgcCArPSA0O1xyXG4gICAgICAgICAgICBpKys7IC8vIHNraXAgdHJhaWwgc3Vycm9nYXRlLlxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcCArPSAzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBwO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ29waWVkIGZyb20gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzIxMTc1MjNcclxuICogR2VuZXJhdGVzIGEgbmV3IHV1aWQuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IHV1aWR2NCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGMgPT4ge1xyXG4gICAgICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDAsIHYgPSBjID09PSAneCcgPyByIDogKHIgJiAweDMpIHwgMHg4O1xyXG4gICAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcclxuICAgIH0pO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVGhlIGFtb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gZXhwb25lbnRpYWxseSBpbmNyZWFzZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfSU5URVJWQUxfTUlMTElTID0gMTAwMDtcclxuLyoqXHJcbiAqIFRoZSBmYWN0b3IgdG8gYmFja29mZiBieS5cclxuICogU2hvdWxkIGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAxLlxyXG4gKi9cclxuY29uc3QgREVGQVVMVF9CQUNLT0ZGX0ZBQ1RPUiA9IDI7XHJcbi8qKlxyXG4gKiBUaGUgbWF4aW11bSBtaWxsaXNlY29uZHMgdG8gaW5jcmVhc2UgdG8uXHJcbiAqXHJcbiAqIDxwPlZpc2libGUgZm9yIHRlc3RpbmdcclxuICovXHJcbmNvbnN0IE1BWF9WQUxVRV9NSUxMSVMgPSA0ICogNjAgKiA2MCAqIDEwMDA7IC8vIEZvdXIgaG91cnMsIGxpa2UgaU9TIGFuZCBBbmRyb2lkLlxyXG4vKipcclxuICogVGhlIHBlcmNlbnRhZ2Ugb2YgYmFja29mZiB0aW1lIHRvIHJhbmRvbWl6ZSBieS5cclxuICogU2VlXHJcbiAqIGh0dHA6Ly9nby9zYWZlLWNsaWVudC1iZWhhdmlvciNzdGVwLTEtZGV0ZXJtaW5lLXRoZS1hcHByb3ByaWF0ZS1yZXRyeS1pbnRlcnZhbC10by1oYW5kbGUtc3Bpa2UtdHJhZmZpY1xyXG4gKiBmb3IgY29udGV4dC5cclxuICpcclxuICogPHA+VmlzaWJsZSBmb3IgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgUkFORE9NX0ZBQ1RPUiA9IDAuNTtcclxuLyoqXHJcbiAqIEJhc2VkIG9uIHRoZSBiYWNrb2ZmIG1ldGhvZCBmcm9tXHJcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Jsb2IvbWFzdGVyL2Nsb3N1cmUvZ29vZy9tYXRoL2V4cG9uZW50aWFsYmFja29mZi5qcy5cclxuICogRXh0cmFjdGVkIGhlcmUgc28gd2UgZG9uJ3QgbmVlZCB0byBwYXNzIG1ldGFkYXRhIGFuZCBhIHN0YXRlZnVsIEV4cG9uZW50aWFsQmFja29mZiBvYmplY3QgYXJvdW5kLlxyXG4gKi9cclxuZnVuY3Rpb24gY2FsY3VsYXRlQmFja29mZk1pbGxpcyhiYWNrb2ZmQ291bnQsIGludGVydmFsTWlsbGlzID0gREVGQVVMVF9JTlRFUlZBTF9NSUxMSVMsIGJhY2tvZmZGYWN0b3IgPSBERUZBVUxUX0JBQ0tPRkZfRkFDVE9SKSB7XHJcbiAgICAvLyBDYWxjdWxhdGVzIGFuIGV4cG9uZW50aWFsbHkgaW5jcmVhc2luZyB2YWx1ZS5cclxuICAgIC8vIERldmlhdGlvbjogY2FsY3VsYXRlcyB2YWx1ZSBmcm9tIGNvdW50IGFuZCBhIGNvbnN0YW50IGludGVydmFsLCBzbyB3ZSBvbmx5IG5lZWQgdG8gc2F2ZSB2YWx1ZVxyXG4gICAgLy8gYW5kIGNvdW50IHRvIHJlc3RvcmUgc3RhdGUuXHJcbiAgICBjb25zdCBjdXJyQmFzZVZhbHVlID0gaW50ZXJ2YWxNaWxsaXMgKiBNYXRoLnBvdyhiYWNrb2ZmRmFjdG9yLCBiYWNrb2ZmQ291bnQpO1xyXG4gICAgLy8gQSByYW5kb20gXCJmdXp6XCIgdG8gYXZvaWQgd2F2ZXMgb2YgcmV0cmllcy5cclxuICAgIC8vIERldmlhdGlvbjogcmFuZG9tRmFjdG9yIGlzIHJlcXVpcmVkLlxyXG4gICAgY29uc3QgcmFuZG9tV2FpdCA9IE1hdGgucm91bmQoXHJcbiAgICAvLyBBIGZyYWN0aW9uIG9mIHRoZSBiYWNrb2ZmIHZhbHVlIHRvIGFkZC9zdWJ0cmFjdC5cclxuICAgIC8vIERldmlhdGlvbjogY2hhbmdlcyBtdWx0aXBsaWNhdGlvbiBvcmRlciB0byBpbXByb3ZlIHJlYWRhYmlsaXR5LlxyXG4gICAgUkFORE9NX0ZBQ1RPUiAqXHJcbiAgICAgICAgY3VyckJhc2VWYWx1ZSAqXHJcbiAgICAgICAgLy8gQSByYW5kb20gZmxvYXQgKHJvdW5kZWQgdG8gaW50IGJ5IE1hdGgucm91bmQgYWJvdmUpIGluIHRoZSByYW5nZSBbLTEsIDFdLiBEZXRlcm1pbmVzXHJcbiAgICAgICAgLy8gaWYgd2UgYWRkIG9yIHN1YnRyYWN0LlxyXG4gICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqXHJcbiAgICAgICAgMik7XHJcbiAgICAvLyBMaW1pdHMgYmFja29mZiB0byBtYXggdG8gYXZvaWQgZWZmZWN0aXZlbHkgcGVybWFuZW50IGJhY2tvZmYuXHJcbiAgICByZXR1cm4gTWF0aC5taW4oTUFYX1ZBTFVFX01JTExJUywgY3VyckJhc2VWYWx1ZSArIHJhbmRvbVdhaXQpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlIEVuZ2xpc2ggb3JkaW5hbCBsZXR0ZXJzIGFmdGVyIGEgbnVtYmVyXHJcbiAqL1xyXG5mdW5jdGlvbiBvcmRpbmFsKGkpIHtcclxuICAgIGlmICghTnVtYmVyLmlzRmluaXRlKGkpKSB7XHJcbiAgICAgICAgcmV0dXJuIGAke2l9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBpICsgaW5kaWNhdG9yKGkpO1xyXG59XHJcbmZ1bmN0aW9uIGluZGljYXRvcihpKSB7XHJcbiAgICBpID0gTWF0aC5hYnMoaSk7XHJcbiAgICBjb25zdCBjZW50ID0gaSAlIDEwMDtcclxuICAgIGlmIChjZW50ID49IDEwICYmIGNlbnQgPD0gMjApIHtcclxuICAgICAgICByZXR1cm4gJ3RoJztcclxuICAgIH1cclxuICAgIGNvbnN0IGRlYyA9IGkgJSAxMDtcclxuICAgIGlmIChkZWMgPT09IDEpIHtcclxuICAgICAgICByZXR1cm4gJ3N0JztcclxuICAgIH1cclxuICAgIGlmIChkZWMgPT09IDIpIHtcclxuICAgICAgICByZXR1cm4gJ25kJztcclxuICAgIH1cclxuICAgIGlmIChkZWMgPT09IDMpIHtcclxuICAgICAgICByZXR1cm4gJ3JkJztcclxuICAgIH1cclxuICAgIHJldHVybiAndGgnO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGdldE1vZHVsYXJJbnN0YW5jZShzZXJ2aWNlKSB7XHJcbiAgICBpZiAoc2VydmljZSAmJiBzZXJ2aWNlLl9kZWxlZ2F0ZSkge1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlLl9kZWxlZ2F0ZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgfVxyXG59XG5cbmV4cG9ydCB7IENPTlNUQU5UUywgRGVjb2RlQmFzZTY0U3RyaW5nRXJyb3IsIERlZmVycmVkLCBFcnJvckZhY3RvcnksIEZpcmViYXNlRXJyb3IsIE1BWF9WQUxVRV9NSUxMSVMsIFJBTkRPTV9GQUNUT1IsIFNoYTEsIGFyZUNvb2tpZXNFbmFibGVkLCBhc3NlcnQsIGFzc2VydGlvbkVycm9yLCBhc3luYywgYmFzZTY0LCBiYXNlNjREZWNvZGUsIGJhc2U2NEVuY29kZSwgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcsIGNhbGN1bGF0ZUJhY2tvZmZNaWxsaXMsIGNvbnRhaW5zLCBjcmVhdGVNb2NrVXNlclRva2VuLCBjcmVhdGVTdWJzY3JpYmUsIGRlY29kZSwgZGVlcENvcHksIGRlZXBFcXVhbCwgZGVlcEV4dGVuZCwgZXJyb3JQcmVmaXgsIGV4dHJhY3RRdWVyeXN0cmluZywgZ2V0RGVmYXVsdEFwcENvbmZpZywgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCwgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0LCBnZXREZWZhdWx0cywgZ2V0RXhwZXJpbWVudGFsU2V0dGluZywgZ2V0R2xvYmFsLCBnZXRNb2R1bGFySW5zdGFuY2UsIGdldFVBLCBpc0FkbWluLCBpc0Jyb3dzZXIsIGlzQnJvd3NlckV4dGVuc2lvbiwgaXNFbGVjdHJvbiwgaXNFbXB0eSwgaXNJRSwgaXNJbmRleGVkREJBdmFpbGFibGUsIGlzTW9iaWxlQ29yZG92YSwgaXNOb2RlLCBpc05vZGVTZGssIGlzUmVhY3ROYXRpdmUsIGlzU2FmYXJpLCBpc1VXUCwgaXNWYWxpZEZvcm1hdCwgaXNWYWxpZFRpbWVzdGFtcCwgaXNzdWVkQXRUaW1lLCBqc29uRXZhbCwgbWFwLCBvcmRpbmFsLCBwcm9taXNlV2l0aFRpbWVvdXQsIHF1ZXJ5c3RyaW5nLCBxdWVyeXN0cmluZ0RlY29kZSwgc2FmZUdldCwgc3RyaW5nTGVuZ3RoLCBzdHJpbmdUb0J5dGVBcnJheSwgc3RyaW5naWZ5LCB1dWlkdjQsIHZhbGlkYXRlQXJnQ291bnQsIHZhbGlkYXRlQ2FsbGJhY2ssIHZhbGlkYXRlQ29udGV4dE9iamVjdCwgdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSwgdmFsaWRhdGVOYW1lc3BhY2UgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgeyBEZWZlcnJlZCB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcblxuLyoqXHJcbiAqIENvbXBvbmVudCBmb3Igc2VydmljZSBuYW1lIFQsIGUuZy4gYGF1dGhgLCBgYXV0aC1pbnRlcm5hbGBcclxuICovXHJcbmNsYXNzIENvbXBvbmVudCB7XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgcHVibGljIHNlcnZpY2UgbmFtZSwgZS5nLiBhcHAsIGF1dGgsIGZpcmVzdG9yZSwgZGF0YWJhc2VcclxuICAgICAqIEBwYXJhbSBpbnN0YW5jZUZhY3RvcnkgU2VydmljZSBmYWN0b3J5IHJlc3BvbnNpYmxlIGZvciBjcmVhdGluZyB0aGUgcHVibGljIGludGVyZmFjZVxyXG4gICAgICogQHBhcmFtIHR5cGUgd2hldGhlciB0aGUgc2VydmljZSBwcm92aWRlZCBieSB0aGUgY29tcG9uZW50IGlzIHB1YmxpYyBvciBwcml2YXRlXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGluc3RhbmNlRmFjdG9yeSwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZUZhY3RvcnkgPSBpbnN0YW5jZUZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgICAgICB0aGlzLm11bHRpcGxlSW5zdGFuY2VzID0gZmFsc2U7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUHJvcGVydGllcyB0byBiZSBhZGRlZCB0byB0aGUgc2VydmljZSBuYW1lc3BhY2VcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnNlcnZpY2VQcm9wcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuaW5zdGFudGlhdGlvbk1vZGUgPSBcIkxBWllcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5MQVpZICovO1xyXG4gICAgICAgIHRoaXMub25JbnN0YW5jZUNyZWF0ZWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgc2V0SW5zdGFudGlhdGlvbk1vZGUobW9kZSkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFudGlhdGlvbk1vZGUgPSBtb2RlO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2V0TXVsdGlwbGVJbnN0YW5jZXMobXVsdGlwbGVJbnN0YW5jZXMpIHtcclxuICAgICAgICB0aGlzLm11bHRpcGxlSW5zdGFuY2VzID0gbXVsdGlwbGVJbnN0YW5jZXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBzZXRTZXJ2aWNlUHJvcHMocHJvcHMpIHtcclxuICAgICAgICB0aGlzLnNlcnZpY2VQcm9wcyA9IHByb3BzO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gY2FsbGJhY2s7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgREVGQVVMVF9FTlRSWV9OQU1FID0gJ1tERUZBVUxUXSc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgaW5zdGFuY2UgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuICdhdXRoJywgJ2F1dGgtaW50ZXJuYWwnXHJcbiAqIE5hbWVTZXJ2aWNlTWFwcGluZ1tUXSBpcyBhbiBhbGlhcyBmb3IgdGhlIHR5cGUgb2YgdGhlIGluc3RhbmNlXHJcbiAqL1xyXG5jbGFzcyBQcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmluc3RhbmNlcyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLm9uSW5pdENhbGxiYWNrcyA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIGlkZW50aWZpZXIgQSBwcm92aWRlciBjYW4gcHJvdmlkZSBtdWxpdHBsZSBpbnN0YW5jZXMgb2YgYSBzZXJ2aWNlXHJcbiAgICAgKiBpZiB0aGlzLmNvbXBvbmVudC5tdWx0aXBsZUluc3RhbmNlcyBpcyB0cnVlLlxyXG4gICAgICovXHJcbiAgICBnZXQoaWRlbnRpZmllcikge1xyXG4gICAgICAgIC8vIGlmIG11bHRpcGxlSW5zdGFuY2VzIGlzIG5vdCBzdXBwb3J0ZWQsIHVzZSB0aGUgZGVmYXVsdCBuYW1lXHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAoIXRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuaGFzKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSkge1xyXG4gICAgICAgICAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZGVmZXJyZWQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzZXJ2aWNlIGlmIGl0IGNhbiBiZSBhdXRvLWluaXRpYWxpemVkXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllclxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgdGhyb3dzIGFuIGV4Y2VwdGlvbiBkdXJpbmcgZ2V0KCksIGl0IHNob3VsZCBub3QgY2F1c2VcclxuICAgICAgICAgICAgICAgICAgICAvLyBhIGZhdGFsIGVycm9yLiBXZSBqdXN0IHJldHVybiB0aGUgdW5yZXNvbHZlZCBwcm9taXNlIGluIHRoaXMgY2FzZS5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpLnByb21pc2U7XHJcbiAgICB9XHJcbiAgICBnZXRJbW1lZGlhdGUob3B0aW9ucykge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICAvLyBpZiBtdWx0aXBsZUluc3RhbmNlcyBpcyBub3Qgc3VwcG9ydGVkLCB1c2UgdGhlIGRlZmF1bHQgbmFtZVxyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmlkZW50aWZpZXIpO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbmFsID0gKF9hID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLm9wdGlvbmFsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSB8fFxyXG4gICAgICAgICAgICB0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEluIGNhc2UgYSBjb21wb25lbnQgaXMgbm90IGluaXRpYWxpemVkIGFuZCBzaG91bGQvY2FuIG5vdCBiZSBhdXRvLWluaXRpYWxpemVkIGF0IHRoZSBtb21lbnQsIHJldHVybiBudWxsIGlmIHRoZSBvcHRpb25hbCBmbGFnIGlzIHNldCwgb3IgdGhyb3dcclxuICAgICAgICAgICAgaWYgKG9wdGlvbmFsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBTZXJ2aWNlICR7dGhpcy5uYW1lfSBpcyBub3QgYXZhaWxhYmxlYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRDb21wb25lbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50O1xyXG4gICAgfVxyXG4gICAgc2V0Q29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChjb21wb25lbnQubmFtZSAhPT0gdGhpcy5uYW1lKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBNaXNtYXRjaGluZyBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gZm9yIFByb3ZpZGVyICR7dGhpcy5uYW1lfS5gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgZm9yICR7dGhpcy5uYW1lfSBoYXMgYWxyZWFkeSBiZWVuIHByb3ZpZGVkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gY29tcG9uZW50O1xyXG4gICAgICAgIC8vIHJldHVybiBlYXJseSB3aXRob3V0IGF0dGVtcHRpbmcgdG8gaW5pdGlhbGl6ZSB0aGUgY29tcG9uZW50IGlmIHRoZSBjb21wb25lbnQgcmVxdWlyZXMgZXhwbGljaXQgaW5pdGlhbGl6YXRpb24gKGNhbGxpbmcgYFByb3ZpZGVyLmluaXRpYWxpemUoKWApXHJcbiAgICAgICAgaWYgKCF0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiB0aGUgc2VydmljZSBpcyBlYWdlciwgaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZVxyXG4gICAgICAgIGlmIChpc0NvbXBvbmVudEVhZ2VyKGNvbXBvbmVudCkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7IGluc3RhbmNlSWRlbnRpZmllcjogREVGQVVMVF9FTlRSWV9OQU1FIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IGZvciBhbiBlYWdlciBDb21wb25lbnQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBkdXJpbmcgdGhlIGVhZ2VyXHJcbiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZSBhIGZhdGFsIGVycm9yLlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogSW52ZXN0aWdhdGUgaWYgd2UgbmVlZCB0byBtYWtlIGl0IGNvbmZpZ3VyYWJsZSwgYmVjYXVzZSBzb21lIGNvbXBvbmVudCBtYXkgd2FudCB0byBjYXVzZVxyXG4gICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvciBpbiB0aGlzIGNhc2U/XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ3JlYXRlIHNlcnZpY2UgaW5zdGFuY2VzIGZvciB0aGUgcGVuZGluZyBwcm9taXNlcyBhbmQgcmVzb2x2ZSB0aGVtXHJcbiAgICAgICAgLy8gTk9URTogaWYgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyBpcyBmYWxzZSwgb25seSB0aGUgZGVmYXVsdCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWRcclxuICAgICAgICAvLyBhbmQgYWxsIHByb21pc2VzIHdpdGggcmVzb2x2ZSB3aXRoIGl0IHJlZ2FyZGxlc3Mgb2YgdGhlIGlkZW50aWZpZXIuXHJcbiAgICAgICAgZm9yIChjb25zdCBbaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZURlZmVycmVkXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAvLyBgZ2V0T3JJbml0aWFsaXplU2VydmljZSgpYCBzaG91bGQgYWx3YXlzIHJldHVybiBhIHZhbGlkIGluc3RhbmNlIHNpbmNlIGEgY29tcG9uZW50IGlzIGd1YXJhbnRlZWQuIHVzZSAhIHRvIG1ha2UgdHlwZXNjcmlwdCBoYXBweS5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZVxyXG4gICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvci4gV2UganVzdCBsZWF2ZSB0aGUgcHJvbWlzZSB1bnJlc29sdmVkLlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2xlYXJJbnN0YW5jZShpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5kZWxldGUoaWRlbnRpZmllcik7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNPcHRpb25zLmRlbGV0ZShpZGVudGlmaWVyKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlcy5kZWxldGUoaWRlbnRpZmllcik7XHJcbiAgICB9XHJcbiAgICAvLyBhcHAuZGVsZXRlKCkgd2lsbCBjYWxsIHRoaXMgbWV0aG9kIG9uIGV2ZXJ5IHByb3ZpZGVyIHRvIGRlbGV0ZSB0aGUgc2VydmljZXNcclxuICAgIC8vIFRPRE86IHNob3VsZCB3ZSBtYXJrIHRoZSBwcm92aWRlciBhcyBkZWxldGVkP1xyXG4gICAgYXN5bmMgZGVsZXRlKCkge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VzID0gQXJyYXkuZnJvbSh0aGlzLmluc3RhbmNlcy52YWx1ZXMoKSk7XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICAuLi5zZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdJTlRFUk5BTCcgaW4gc2VydmljZSkgLy8gbGVnYWN5IHNlcnZpY2VzXHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgICAgICAgICAgLm1hcChzZXJ2aWNlID0+IHNlcnZpY2UuSU5URVJOQUwuZGVsZXRlKCkpLFxyXG4gICAgICAgICAgICAuLi5zZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdfZGVsZXRlJyBpbiBzZXJ2aWNlKSAvLyBtb2R1bGFyaXplZCBzZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLl9kZWxldGUoKSlcclxuICAgICAgICBdKTtcclxuICAgIH1cclxuICAgIGlzQ29tcG9uZW50U2V0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudCAhPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaXNJbml0aWFsaXplZChpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTtcclxuICAgIH1cclxuICAgIGdldE9wdGlvbnMoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlc09wdGlvbnMuZ2V0KGlkZW50aWZpZXIpIHx8IHt9O1xyXG4gICAgfVxyXG4gICAgaW5pdGlhbGl6ZShvcHRzID0ge30pIHtcclxuICAgICAgICBjb25zdCB7IG9wdGlvbnMgPSB7fSB9ID0gb3B0cztcclxuICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdHMuaW5zdGFuY2VJZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgJHt0aGlzLm5hbWV9KCR7bm9ybWFsaXplZElkZW50aWZpZXJ9KSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpemVkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5pc0NvbXBvbmVudFNldCgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgJHt0aGlzLm5hbWV9IGhhcyBub3QgYmVlbiByZWdpc3RlcmVkIHlldGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XHJcbiAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXIsXHJcbiAgICAgICAgICAgIG9wdGlvbnNcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyByZXNvbHZlIGFueSBwZW5kaW5nIHByb21pc2Ugd2FpdGluZyBmb3IgdGhlIHNlcnZpY2UgaW5zdGFuY2VcclxuICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpbnN0YW5jZUlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZElkZW50aWZpZXIgPT09IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIC0gYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW52b2tlZCAgYWZ0ZXIgdGhlIHByb3ZpZGVyIGhhcyBiZWVuIGluaXRpYWxpemVkIGJ5IGNhbGxpbmcgcHJvdmlkZXIuaW5pdGlhbGl6ZSgpLlxyXG4gICAgICogVGhlIGZ1bmN0aW9uIGlzIGludm9rZWQgU1lOQ0hST05PVVNMWSwgc28gaXQgc2hvdWxkIG5vdCBleGVjdXRlIGFueSBsb25ncnVubmluZyB0YXNrcyBpbiBvcmRlciB0byBub3QgYmxvY2sgdGhlIHByb2dyYW0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkZW50aWZpZXIgQW4gb3B0aW9uYWwgaW5zdGFuY2UgaWRlbnRpZmllclxyXG4gICAgICogQHJldHVybnMgYSBmdW5jdGlvbiB0byB1bnJlZ2lzdGVyIHRoZSBjYWxsYmFja1xyXG4gICAgICovXHJcbiAgICBvbkluaXQoY2FsbGJhY2ssIGlkZW50aWZpZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTtcclxuICAgICAgICBjb25zdCBleGlzdGluZ0NhbGxiYWNrcyA9IChfYSA9IHRoaXMub25Jbml0Q2FsbGJhY2tzLmdldChub3JtYWxpemVkSWRlbnRpZmllcikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG5ldyBTZXQoKTtcclxuICAgICAgICBleGlzdGluZ0NhbGxiYWNrcy5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgIHRoaXMub25Jbml0Q2FsbGJhY2tzLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZXhpc3RpbmdDYWxsYmFja3MpO1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nSW5zdGFuY2UgPSB0aGlzLmluc3RhbmNlcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpO1xyXG4gICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGV4aXN0aW5nSW5zdGFuY2UsIG5vcm1hbGl6ZWRJZGVudGlmaWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgZXhpc3RpbmdDYWxsYmFja3MuZGVsZXRlKGNhbGxiYWNrKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnZva2Ugb25Jbml0IGNhbGxiYWNrcyBzeW5jaHJvbm91c2x5XHJcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2UgdGhlIHNlcnZpY2UgaW5zdGFuY2VgXHJcbiAgICAgKi9cclxuICAgIGludm9rZU9uSW5pdENhbGxiYWNrcyhpbnN0YW5jZSwgaWRlbnRpZmllcikge1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMub25Jbml0Q2FsbGJhY2tzLmdldChpZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAoIWNhbGxiYWNrcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgY2FsbGJhY2tzKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhpbnN0YW5jZSwgaWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluaXQgY2FsbGJhY2tcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXIsIG9wdGlvbnMgPSB7fSB9KSB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KGluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKCFpbnN0YW5jZSAmJiB0aGlzLmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZSA9IHRoaXMuY29tcG9uZW50Lmluc3RhbmNlRmFjdG9yeSh0aGlzLmNvbnRhaW5lciwge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVJZGVudGlmaWVyRm9yRmFjdG9yeShpbnN0YW5jZUlkZW50aWZpZXIpLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJbnZva2Ugb25Jbml0IGxpc3RlbmVycy5cclxuICAgICAgICAgICAgICogTm90ZSB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCBpcyBkaWZmZXJlbnQsIHdoaWNoIGlzIHVzZWQgYnkgdGhlIGNvbXBvbmVudCBjcmVhdG9yLFxyXG4gICAgICAgICAgICAgKiB3aGlsZSBvbkluaXQgbGlzdGVuZXJzIGFyZSByZWdpc3RlcmVkIGJ5IGNvbnN1bWVycyBvZiB0aGUgcHJvdmlkZXIuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aGlzLmludm9rZU9uSW5pdENhbGxiYWNrcyhpbnN0YW5jZSwgaW5zdGFuY2VJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIE9yZGVyIGlzIGltcG9ydGFudFxyXG4gICAgICAgICAgICAgKiBvbkluc3RhbmNlQ3JlYXRlZCgpIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgdGhpcy5pbnN0YW5jZXMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpOyB3aGljaFxyXG4gICAgICAgICAgICAgKiBtYWtlcyBgaXNJbml0aWFsaXplZCgpYCByZXR1cm4gdHJ1ZS5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCh0aGlzLmNvbnRhaW5lciwgaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluc3RhbmNlQ3JlYXRlZENhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQubXVsdGlwbGVJbnN0YW5jZXMgPyBpZGVudGlmaWVyIDogREVGQVVMVF9FTlRSWV9OQU1FO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7IC8vIGFzc3VtZSBtdWx0aXBsZSBpbnN0YW5jZXMgYXJlIHN1cHBvcnRlZCBiZWZvcmUgdGhlIGNvbXBvbmVudCBpcyBwcm92aWRlZC5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzaG91bGRBdXRvSW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICByZXR1cm4gKCEhdGhpcy5jb21wb25lbnQgJiZcclxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgIT09IFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLyk7XHJcbiAgICB9XHJcbn1cclxuLy8gdW5kZWZpbmVkIHNob3VsZCBiZSBwYXNzZWQgdG8gdGhlIHNlcnZpY2UgZmFjdG9yeSBmb3IgdGhlIGRlZmF1bHQgaW5zdGFuY2VcclxuZnVuY3Rpb24gbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaWRlbnRpZmllcikge1xyXG4gICAgcmV0dXJuIGlkZW50aWZpZXIgPT09IERFRkFVTFRfRU5UUllfTkFNRSA/IHVuZGVmaW5lZCA6IGlkZW50aWZpZXI7XHJcbn1cclxuZnVuY3Rpb24gaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpIHtcclxuICAgIHJldHVybiBjb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgPT09IFwiRUFHRVJcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FQUdFUiAqLztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ29tcG9uZW50Q29udGFpbmVyIHRoYXQgcHJvdmlkZXMgUHJvdmlkZXJzIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiBgYXV0aGAsIGBhdXRoLWludGVybmFsYFxyXG4gKi9cclxuY2xhc3MgQ29tcG9uZW50Q29udGFpbmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbXBvbmVudCBDb21wb25lbnQgYmVpbmcgYWRkZWRcclxuICAgICAqIEBwYXJhbSBvdmVyd3JpdGUgV2hlbiBhIGNvbXBvbmVudCB3aXRoIHRoZSBzYW1lIG5hbWUgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkLFxyXG4gICAgICogaWYgb3ZlcndyaXRlIGlzIHRydWU6IG92ZXJ3cml0ZSB0aGUgZXhpc3RpbmcgY29tcG9uZW50IHdpdGggdGhlIG5ldyBjb21wb25lbnQgYW5kIGNyZWF0ZSBhIG5ld1xyXG4gICAgICogcHJvdmlkZXIgd2l0aCB0aGUgbmV3IGNvbXBvbmVudC4gSXQgY2FuIGJlIHVzZWZ1bCBpbiB0ZXN0cyB3aGVyZSB5b3Ugd2FudCB0byB1c2UgZGlmZmVyZW50IG1vY2tzXHJcbiAgICAgKiBmb3IgZGlmZmVyZW50IHRlc3RzLlxyXG4gICAgICogaWYgb3ZlcndyaXRlIGlzIGZhbHNlOiB0aHJvdyBhbiBleGNlcHRpb25cclxuICAgICAqL1xyXG4gICAgYWRkQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5nZXRQcm92aWRlcihjb21wb25lbnQubmFtZSk7XHJcbiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkIHdpdGggJHt0aGlzLm5hbWV9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3ZpZGVyLnNldENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoY29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTtcclxuICAgICAgICBpZiAocHJvdmlkZXIuaXNDb21wb25lbnRTZXQoKSkge1xyXG4gICAgICAgICAgICAvLyBkZWxldGUgdGhlIGV4aXN0aW5nIHByb3ZpZGVyIGZyb20gdGhlIGNvbnRhaW5lciwgc28gd2UgY2FuIHJlZ2lzdGVyIHRoZSBuZXcgY29tcG9uZW50XHJcbiAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLmRlbGV0ZShjb21wb25lbnQubmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGdldFByb3ZpZGVyIHByb3ZpZGVzIGEgdHlwZSBzYWZlIGludGVyZmFjZSB3aGVyZSBpdCBjYW4gb25seSBiZSBjYWxsZWQgd2l0aCBhIGZpZWxkIG5hbWVcclxuICAgICAqIHByZXNlbnQgaW4gTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZS5cclxuICAgICAqXHJcbiAgICAgKiBGaXJlYmFzZSBTREtzIHByb3ZpZGluZyBzZXJ2aWNlcyBzaG91bGQgZXh0ZW5kIE5hbWVTZXJ2aWNlTWFwcGluZyBpbnRlcmZhY2UgdG8gcmVnaXN0ZXJcclxuICAgICAqIHRoZW1zZWx2ZXMuXHJcbiAgICAgKi9cclxuICAgIGdldFByb3ZpZGVyKG5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5wcm92aWRlcnMuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVycy5nZXQobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNyZWF0ZSBhIFByb3ZpZGVyIGZvciBhIHNlcnZpY2UgdGhhdCBoYXNuJ3QgcmVnaXN0ZXJlZCB3aXRoIEZpcmViYXNlXHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgUHJvdmlkZXIobmFtZSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcnMuc2V0KG5hbWUsIHByb3ZpZGVyKTtcclxuICAgICAgICByZXR1cm4gcHJvdmlkZXI7XHJcbiAgICB9XHJcbiAgICBnZXRQcm92aWRlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm92aWRlcnMudmFsdWVzKCkpO1xyXG4gICAgfVxyXG59XG5cbmV4cG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50Q29udGFpbmVyLCBQcm92aWRlciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsIi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBIGNvbnRhaW5lciBmb3IgYWxsIG9mIHRoZSBMb2dnZXIgaW5zdGFuY2VzXHJcbiAqL1xyXG5jb25zdCBpbnN0YW5jZXMgPSBbXTtcclxuLyoqXHJcbiAqIFRoZSBKUyBTREsgc3VwcG9ydHMgNSBsb2cgbGV2ZWxzIGFuZCBhbHNvIGFsbG93cyBhIHVzZXIgdGhlIGFiaWxpdHkgdG9cclxuICogc2lsZW5jZSB0aGUgbG9ncyBhbHRvZ2V0aGVyLlxyXG4gKlxyXG4gKiBUaGUgb3JkZXIgaXMgYSBmb2xsb3dzOlxyXG4gKiBERUJVRyA8IFZFUkJPU0UgPCBJTkZPIDwgV0FSTiA8IEVSUk9SXHJcbiAqXHJcbiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCB3aWxsIGJlIGNhcHR1cmVkIChpLmUuIGlmXHJcbiAqIHlvdSBzZXQgdGhlIGxvZyBsZXZlbCB0byBgSU5GT2AsIGVycm9ycyB3aWxsIHN0aWxsIGJlIGxvZ2dlZCwgYnV0IGBERUJVR2AgYW5kXHJcbiAqIGBWRVJCT1NFYCBsb2dzIHdpbGwgbm90KVxyXG4gKi9cclxudmFyIExvZ0xldmVsO1xyXG4oZnVuY3Rpb24gKExvZ0xldmVsKSB7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkRFQlVHXCJdID0gMF0gPSBcIkRFQlVHXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlZFUkJPU0VcIl0gPSAxXSA9IFwiVkVSQk9TRVwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJJTkZPXCJdID0gMl0gPSBcIklORk9cIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiV0FSTlwiXSA9IDNdID0gXCJXQVJOXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkVSUk9SXCJdID0gNF0gPSBcIkVSUk9SXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlNJTEVOVFwiXSA9IDVdID0gXCJTSUxFTlRcIjtcclxufSkoTG9nTGV2ZWwgfHwgKExvZ0xldmVsID0ge30pKTtcclxuY29uc3QgbGV2ZWxTdHJpbmdUb0VudW0gPSB7XHJcbiAgICAnZGVidWcnOiBMb2dMZXZlbC5ERUJVRyxcclxuICAgICd2ZXJib3NlJzogTG9nTGV2ZWwuVkVSQk9TRSxcclxuICAgICdpbmZvJzogTG9nTGV2ZWwuSU5GTyxcclxuICAgICd3YXJuJzogTG9nTGV2ZWwuV0FSTixcclxuICAgICdlcnJvcic6IExvZ0xldmVsLkVSUk9SLFxyXG4gICAgJ3NpbGVudCc6IExvZ0xldmVsLlNJTEVOVFxyXG59O1xyXG4vKipcclxuICogVGhlIGRlZmF1bHQgbG9nIGxldmVsXHJcbiAqL1xyXG5jb25zdCBkZWZhdWx0TG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPO1xyXG4vKipcclxuICogQnkgZGVmYXVsdCwgYGNvbnNvbGUuZGVidWdgIGlzIG5vdCBkaXNwbGF5ZWQgaW4gdGhlIGRldmVsb3BlciBjb25zb2xlIChpblxyXG4gKiBjaHJvbWUpLiBUbyBhdm9pZCBmb3JjaW5nIHVzZXJzIHRvIGhhdmUgdG8gb3B0LWluIHRvIHRoZXNlIGxvZ3MgdHdpY2VcclxuICogKGkuZS4gb25jZSBmb3IgZmlyZWJhc2UsIGFuZCBvbmNlIGluIHRoZSBjb25zb2xlKSwgd2UgYXJlIHNlbmRpbmcgYERFQlVHYFxyXG4gKiBsb2dzIHRvIHRoZSBgY29uc29sZS5sb2dgIGZ1bmN0aW9uLlxyXG4gKi9cclxuY29uc3QgQ29uc29sZU1ldGhvZCA9IHtcclxuICAgIFtMb2dMZXZlbC5ERUJVR106ICdsb2cnLFxyXG4gICAgW0xvZ0xldmVsLlZFUkJPU0VdOiAnbG9nJyxcclxuICAgIFtMb2dMZXZlbC5JTkZPXTogJ2luZm8nLFxyXG4gICAgW0xvZ0xldmVsLldBUk5dOiAnd2FybicsXHJcbiAgICBbTG9nTGV2ZWwuRVJST1JdOiAnZXJyb3InXHJcbn07XHJcbi8qKlxyXG4gKiBUaGUgZGVmYXVsdCBsb2cgaGFuZGxlciB3aWxsIGZvcndhcmQgREVCVUcsIFZFUkJPU0UsIElORk8sIFdBUk4sIGFuZCBFUlJPUlxyXG4gKiBtZXNzYWdlcyBvbiB0byB0aGVpciBjb3JyZXNwb25kaW5nIGNvbnNvbGUgY291bnRlcnBhcnRzIChpZiB0aGUgbG9nIG1ldGhvZFxyXG4gKiBpcyBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgbG9nIGxldmVsKVxyXG4gKi9cclxuY29uc3QgZGVmYXVsdExvZ0hhbmRsZXIgPSAoaW5zdGFuY2UsIGxvZ1R5cGUsIC4uLmFyZ3MpID0+IHtcclxuICAgIGlmIChsb2dUeXBlIDwgaW5zdGFuY2UubG9nTGV2ZWwpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcbiAgICBjb25zdCBtZXRob2QgPSBDb25zb2xlTWV0aG9kW2xvZ1R5cGVdO1xyXG4gICAgaWYgKG1ldGhvZCkge1xyXG4gICAgICAgIGNvbnNvbGVbbWV0aG9kXShgWyR7bm93fV0gICR7aW5zdGFuY2UubmFtZX06YCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0dGVtcHRlZCB0byBsb2cgYSBtZXNzYWdlIHdpdGggYW4gaW52YWxpZCBsb2dUeXBlICh2YWx1ZTogJHtsb2dUeXBlfSlgKTtcclxuICAgIH1cclxufTtcclxuY2xhc3MgTG9nZ2VyIHtcclxuICAgIC8qKlxyXG4gICAgICogR2l2ZXMgeW91IGFuIGluc3RhbmNlIG9mIGEgTG9nZ2VyIHRvIGNhcHR1cmUgbWVzc2FnZXMgYWNjb3JkaW5nIHRvXHJcbiAgICAgKiBGaXJlYmFzZSdzIGxvZ2dpbmcgc2NoZW1lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHRoYXQgdGhlIGxvZ3Mgd2lsbCBiZSBhc3NvY2lhdGVkIHdpdGhcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IobmFtZSkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIGxvZyBsZXZlbCBvZiB0aGUgZ2l2ZW4gTG9nZ2VyIGluc3RhbmNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gZGVmYXVsdExvZ0xldmVsO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBtYWluIChpbnRlcm5hbCkgbG9nIGhhbmRsZXIgZm9yIHRoZSBMb2dnZXIgaW5zdGFuY2UuXHJcbiAgICAgICAgICogQ2FuIGJlIHNldCB0byBhIG5ldyBmdW5jdGlvbiBpbiBpbnRlcm5hbCBwYWNrYWdlIGNvZGUgYnV0IG5vdCBieSB1c2VyLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIgPSBkZWZhdWx0TG9nSGFuZGxlcjtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgb3B0aW9uYWwsIGFkZGl0aW9uYWwsIHVzZXItZGVmaW5lZCBsb2cgaGFuZGxlciBmb3IgdGhlIExvZ2dlciBpbnN0YW5jZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ2FwdHVyZSB0aGUgY3VycmVudCBpbnN0YW5jZSBmb3IgbGF0ZXIgdXNlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaW5zdGFuY2VzLnB1c2godGhpcyk7XHJcbiAgICB9XHJcbiAgICBnZXQgbG9nTGV2ZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvZ0xldmVsO1xyXG4gICAgfVxyXG4gICAgc2V0IGxvZ0xldmVsKHZhbCkge1xyXG4gICAgICAgIGlmICghKHZhbCBpbiBMb2dMZXZlbCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCB2YWx1ZSBcIiR7dmFsfVwiIGFzc2lnbmVkIHRvIFxcYGxvZ0xldmVsXFxgYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLy8gV29ya2Fyb3VuZCBmb3Igc2V0dGVyL2dldHRlciBoYXZpbmcgdG8gYmUgdGhlIHNhbWUgdHlwZS5cclxuICAgIHNldExvZ0xldmVsKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gdHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgPyBsZXZlbFN0cmluZ1RvRW51bVt2YWxdIDogdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IGxvZ0hhbmRsZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvZ0hhbmRsZXI7XHJcbiAgICB9XHJcbiAgICBzZXQgbG9nSGFuZGxlcih2YWwpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgdXNlckxvZ0hhbmRsZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJMb2dIYW5kbGVyO1xyXG4gICAgfVxyXG4gICAgc2V0IHVzZXJMb2dIYW5kbGVyKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgZnVuY3Rpb25zIGJlbG93IGFyZSBhbGwgYmFzZWQgb24gdGhlIGBjb25zb2xlYCBpbnRlcmZhY2VcclxuICAgICAqL1xyXG4gICAgZGVidWcoLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIGxvZyguLi5hcmdzKSB7XHJcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiZcclxuICAgICAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuVkVSQk9TRSwgLi4uYXJncyk7XHJcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5WRVJCT1NFLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIGluZm8oLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLklORk8sIC4uLmFyZ3MpO1xyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICB3YXJuKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLldBUk4sIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgZXJyb3IoLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkVSUk9SLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkVSUk9SLCAuLi5hcmdzKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbCkge1xyXG4gICAgaW5zdGFuY2VzLmZvckVhY2goaW5zdCA9PiB7XHJcbiAgICAgICAgaW5zdC5zZXRMb2dMZXZlbChsZXZlbCk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBzZXRVc2VyTG9nSGFuZGxlcihsb2dDYWxsYmFjaywgb3B0aW9ucykge1xyXG4gICAgZm9yIChjb25zdCBpbnN0YW5jZSBvZiBpbnN0YW5jZXMpIHtcclxuICAgICAgICBsZXQgY3VzdG9tTG9nTGV2ZWwgPSBudWxsO1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMubGV2ZWwpIHtcclxuICAgICAgICAgICAgY3VzdG9tTG9nTGV2ZWwgPSBsZXZlbFN0cmluZ1RvRW51bVtvcHRpb25zLmxldmVsXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxvZ0NhbGxiYWNrID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnVzZXJMb2dIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnVzZXJMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsZXZlbCwgLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFyZ3NcclxuICAgICAgICAgICAgICAgICAgICAubWFwKGFyZyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgYXJnID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZy50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGlnbm9yZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGFyZyA9PiBhcmcpXHJcbiAgICAgICAgICAgICAgICAgICAgLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgIGlmIChsZXZlbCA+PSAoY3VzdG9tTG9nTGV2ZWwgIT09IG51bGwgJiYgY3VzdG9tTG9nTGV2ZWwgIT09IHZvaWQgMCA/IGN1c3RvbUxvZ0xldmVsIDogaW5zdGFuY2UubG9nTGV2ZWwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nQ2FsbGJhY2soe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogTG9nTGV2ZWxbbGV2ZWxdLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGluc3RhbmNlLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuZXhwb3J0IHsgTG9nTGV2ZWwsIExvZ2dlciwgc2V0TG9nTGV2ZWwsIHNldFVzZXJMb2dIYW5kbGVyIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoKGMpID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xuICAgIHJldHVybiAoaWRiUHJveHlhYmxlVHlwZXMgfHxcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW1xuICAgICAgICAgICAgSURCRGF0YWJhc2UsXG4gICAgICAgICAgICBJREJPYmplY3RTdG9yZSxcbiAgICAgICAgICAgIElEQkluZGV4LFxuICAgICAgICAgICAgSURCQ3Vyc29yLFxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24sXG4gICAgICAgIF0pKTtcbn1cbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XG4gICAgcmV0dXJuIChjdXJzb3JBZHZhbmNlTWV0aG9kcyB8fFxuICAgICAgICAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgPSBbXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZVByaW1hcnlLZXksXG4gICAgICAgIF0pKTtcbn1cbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgdW5saXN0ZW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgfSk7XG4gICAgcHJvbWlzZVxuICAgICAgICAudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxuICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhdGNoaW5nIHRvIGF2b2lkIFwiVW5jYXVnaHQgUHJvbWlzZSBleGNlcHRpb25zXCJcbiAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4geyB9KTtcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXG4gICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChwcm9taXNlLCByZXF1ZXN0KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbn1cbmZ1bmN0aW9uIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih0eCkge1xuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHR4LmVycm9yIHx8IG5ldyBET01FeGNlcHRpb24oJ0Fib3J0RXJyb3InLCAnQWJvcnRFcnJvcicpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XG4gICAgfSk7XG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcbn1cbmxldCBpZGJQcm94eVRyYXBzID0ge1xuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uRG9uZU1hcC5nZXQodGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0Lm9iamVjdFN0b3JlTmFtZXMgfHwgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLmdldCh0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3N0b3JlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXG4gICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0LCBwcm9wLCB2YWx1ZSkge1xuICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbiAmJlxuICAgICAgICAgICAgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xuICAgIH0sXG59O1xuZnVuY3Rpb24gcmVwbGFjZVRyYXBzKGNhbGxiYWNrKSB7XG4gICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpO1xufVxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZVxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cbiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmXG4gICAgICAgICEoJ29iamVjdFN0b3JlTmFtZXMnIGluIElEQlRyYW5zYWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XG4gICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXG4gICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGVcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcbiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpO1xuICAgIH07XG59XG5mdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XG4gICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbixcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxuICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpO1xuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XG4gICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC5cbiAgICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiB3cmFwKHZhbHVlKSB7XG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXG4gICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS5cbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTtcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cbiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdWYWx1ZTtcbn1cbmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG5cbmV4cG9ydCB7IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBhLCBpbnN0YW5jZU9mQW55IGFzIGksIHJlcGxhY2VUcmFwcyBhcyByLCB1bndyYXAgYXMgdSwgd3JhcCBhcyB3IH07XG4iLCJpbXBvcnQgeyB3IGFzIHdyYXAsIHIgYXMgcmVwbGFjZVRyYXBzIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5leHBvcnQgeyB1IGFzIHVud3JhcCwgdyBhcyB3cmFwIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5cbi8qKlxuICogT3BlbiBhIGRhdGFiYXNlLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxuICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxuICovXG5mdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZywgdGVybWluYXRlZCB9ID0ge30pIHtcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xuICAgIGlmICh1cGdyYWRlKSB7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSwgZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIG9wZW5Qcm9taXNlXG4gICAgICAgIC50aGVuKChkYikgPT4ge1xuICAgICAgICBpZiAodGVybWluYXRlZClcbiAgICAgICAgICAgIGRiLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKCkgPT4gdGVybWluYXRlZCgpKTtcbiAgICAgICAgaWYgKGJsb2NraW5nKSB7XG4gICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKGV2ZW50KSA9PiBibG9ja2luZyhldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xufVxuLyoqXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIHJldHVybiB3cmFwKHJlcXVlc3QpLnRoZW4oKCkgPT4gdW5kZWZpbmVkKTtcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcbmNvbnN0IGNhY2hlZE1ldGhvZHMgPSBuZXcgTWFwKCk7XG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcbiAgICAgICAgIShwcm9wIGluIHRhcmdldCkgJiZcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjYWNoZWRNZXRob2RzLmdldChwcm9wKSlcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xuICAgIGNvbnN0IHVzZUluZGV4ID0gcHJvcCAhPT0gdGFyZ2V0RnVuY05hbWU7XG4gICAgY29uc3QgaXNXcml0ZSA9IHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSk7XG4gICAgaWYgKFxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cbiAgICAhKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkgfHxcbiAgICAgICAgIShpc1dyaXRlIHx8IHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2QgPSBhc3luYyBmdW5jdGlvbiAoc3RvcmVOYW1lLCAuLi5hcmdzKSB7XG4gICAgICAgIC8vIGlzV3JpdGUgPyAncmVhZHdyaXRlJyA6IHVuZGVmaW5lZCBnemlwcHMgYmV0dGVyLCBidXQgZmFpbHMgaW4gRWRnZSA6KFxuICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKTtcbiAgICAgICAgbGV0IHRhcmdldCA9IHR4LnN0b3JlO1xuICAgICAgICBpZiAodXNlSW5kZXgpXG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcbiAgICAgICAgLy8gTXVzdCByZWplY3QgaWYgb3AgcmVqZWN0cy5cbiAgICAgICAgLy8gSWYgaXQncyBhIHdyaXRlIG9wZXJhdGlvbiwgbXVzdCByZWplY3QgaWYgdHguZG9uZSByZWplY3RzLlxuICAgICAgICAvLyBNdXN0IHJlamVjdCB3aXRoIG9wIHJlamVjdGlvbiBmaXJzdC5cbiAgICAgICAgLy8gTXVzdCByZXNvbHZlIHdpdGggb3AgdmFsdWUuXG4gICAgICAgIC8vIE11c3QgaGFuZGxlIGJvdGggcHJvbWlzZXMgKG5vIHVuaGFuZGxlZCByZWplY3Rpb25zKVxuICAgICAgICByZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyksXG4gICAgICAgICAgICBpc1dyaXRlICYmIHR4LmRvbmUsXG4gICAgICAgIF0pKVswXTtcbiAgICB9O1xuICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XG4gICAgcmV0dXJuIG1ldGhvZDtcbn1cbnJlcGxhY2VUcmFwcygob2xkVHJhcHMpID0+ICh7XG4gICAgLi4ub2xkVHJhcHMsXG4gICAgZ2V0OiAodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikgPT4gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpLFxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcbn0pKTtcblxuZXhwb3J0IHsgZGVsZXRlREIsIG9wZW5EQiB9O1xuIiwiaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRDb250YWluZXIgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciwgc2V0VXNlckxvZ0hhbmRsZXIsIHNldExvZ0xldmVsIGFzIHNldExvZ0xldmVsJDEgfSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IEVycm9yRmFjdG9yeSwgZ2V0RGVmYXVsdEFwcENvbmZpZywgZGVlcEVxdWFsLCBGaXJlYmFzZUVycm9yLCBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZywgaXNJbmRleGVkREJBdmFpbGFibGUsIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5leHBvcnQgeyBGaXJlYmFzZUVycm9yIH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgb3BlbkRCIH0gZnJvbSAnaWRiJztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIC8vIEluIGluaXRpYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd2lsbCBiZSBjYWxsZWQgYnkgaW5zdGFsbGF0aW9ucyBvblxyXG4gICAgLy8gYXV0aCB0b2tlbiByZWZyZXNoLCBhbmQgaW5zdGFsbGF0aW9ucyB3aWxsIHNlbmQgdGhpcyBzdHJpbmcuXHJcbiAgICBnZXRQbGF0Zm9ybUluZm9TdHJpbmcoKSB7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXJzID0gdGhpcy5jb250YWluZXIuZ2V0UHJvdmlkZXJzKCk7XHJcbiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIHByb3ZpZGVycyBhbmQgZ2V0IGxpYnJhcnkvdmVyc2lvbiBwYWlycyBmcm9tIGFueSB0aGF0IGFyZVxyXG4gICAgICAgIC8vIHZlcnNpb24gY29tcG9uZW50cy5cclxuICAgICAgICByZXR1cm4gcHJvdmlkZXJzXHJcbiAgICAgICAgICAgIC5tYXAocHJvdmlkZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNWZXJzaW9uU2VydmljZVByb3ZpZGVyKHByb3ZpZGVyKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VydmljZSA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3NlcnZpY2UubGlicmFyeX0vJHtzZXJ2aWNlLnZlcnNpb259YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZpbHRlcihsb2dTdHJpbmcgPT4gbG9nU3RyaW5nKVxyXG4gICAgICAgICAgICAuam9pbignICcpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgY2hlY2sgaWYgdGhpcyBwcm92aWRlciBwcm92aWRlcyBhIFZlcnNpb25TZXJ2aWNlXHJcbiAqXHJcbiAqIE5PVEU6IFVzaW5nIFByb3ZpZGVyPCdhcHAtdmVyc2lvbic+IGlzIGEgaGFjayB0byBpbmRpY2F0ZSB0aGF0IHRoZSBwcm92aWRlclxyXG4gKiBwcm92aWRlcyBWZXJzaW9uU2VydmljZS4gVGhlIHByb3ZpZGVyIGlzIG5vdCBuZWNlc3NhcmlseSBhICdhcHAtdmVyc2lvbidcclxuICogcHJvdmlkZXIuXHJcbiAqL1xyXG5mdW5jdGlvbiBpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudCA9IHByb3ZpZGVyLmdldENvbXBvbmVudCgpO1xyXG4gICAgcmV0dXJuIChjb21wb25lbnQgPT09IG51bGwgfHwgY29tcG9uZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb21wb25lbnQudHlwZSkgPT09IFwiVkVSU0lPTlwiIC8qIENvbXBvbmVudFR5cGUuVkVSU0lPTiAqLztcclxufVxuXG5jb25zdCBuYW1lJG8gPSBcIkBmaXJlYmFzZS9hcHBcIjtcbmNvbnN0IHZlcnNpb24kMSA9IFwiMC45LjE1XCI7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ0BmaXJlYmFzZS9hcHAnKTtcblxuY29uc3QgbmFtZSRuID0gXCJAZmlyZWJhc2UvYXBwLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJG0gPSBcIkBmaXJlYmFzZS9hbmFseXRpY3MtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkbCA9IFwiQGZpcmViYXNlL2FuYWx5dGljc1wiO1xuXG5jb25zdCBuYW1lJGsgPSBcIkBmaXJlYmFzZS9hcHAtY2hlY2stY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkaiA9IFwiQGZpcmViYXNlL2FwcC1jaGVja1wiO1xuXG5jb25zdCBuYW1lJGkgPSBcIkBmaXJlYmFzZS9hdXRoXCI7XG5cbmNvbnN0IG5hbWUkaCA9IFwiQGZpcmViYXNlL2F1dGgtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkZyA9IFwiQGZpcmViYXNlL2RhdGFiYXNlXCI7XG5cbmNvbnN0IG5hbWUkZiA9IFwiQGZpcmViYXNlL2RhdGFiYXNlLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGUgPSBcIkBmaXJlYmFzZS9mdW5jdGlvbnNcIjtcblxuY29uc3QgbmFtZSRkID0gXCJAZmlyZWJhc2UvZnVuY3Rpb25zLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGMgPSBcIkBmaXJlYmFzZS9pbnN0YWxsYXRpb25zXCI7XG5cbmNvbnN0IG5hbWUkYiA9IFwiQGZpcmViYXNlL2luc3RhbGxhdGlvbnMtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkYSA9IFwiQGZpcmViYXNlL21lc3NhZ2luZ1wiO1xuXG5jb25zdCBuYW1lJDkgPSBcIkBmaXJlYmFzZS9tZXNzYWdpbmctY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkOCA9IFwiQGZpcmViYXNlL3BlcmZvcm1hbmNlXCI7XG5cbmNvbnN0IG5hbWUkNyA9IFwiQGZpcmViYXNlL3BlcmZvcm1hbmNlLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDYgPSBcIkBmaXJlYmFzZS9yZW1vdGUtY29uZmlnXCI7XG5cbmNvbnN0IG5hbWUkNSA9IFwiQGZpcmViYXNlL3JlbW90ZS1jb25maWctY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkNCA9IFwiQGZpcmViYXNlL3N0b3JhZ2VcIjtcblxuY29uc3QgbmFtZSQzID0gXCJAZmlyZWJhc2Uvc3RvcmFnZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSQyID0gXCJAZmlyZWJhc2UvZmlyZXN0b3JlXCI7XG5cbmNvbnN0IG5hbWUkMSA9IFwiQGZpcmViYXNlL2ZpcmVzdG9yZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSA9IFwiZmlyZWJhc2VcIjtcbmNvbnN0IHZlcnNpb24gPSBcIjEwLjEuMFwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVGhlIGRlZmF1bHQgYXBwIG5hbWVcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0VOVFJZX05BTUUgPSAnW0RFRkFVTFRdJztcclxuY29uc3QgUExBVEZPUk1fTE9HX1NUUklORyA9IHtcclxuICAgIFtuYW1lJG9dOiAnZmlyZS1jb3JlJyxcclxuICAgIFtuYW1lJG5dOiAnZmlyZS1jb3JlLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRsXTogJ2ZpcmUtYW5hbHl0aWNzJyxcclxuICAgIFtuYW1lJG1dOiAnZmlyZS1hbmFseXRpY3MtY29tcGF0JyxcclxuICAgIFtuYW1lJGpdOiAnZmlyZS1hcHAtY2hlY2snLFxyXG4gICAgW25hbWUka106ICdmaXJlLWFwcC1jaGVjay1jb21wYXQnLFxyXG4gICAgW25hbWUkaV06ICdmaXJlLWF1dGgnLFxyXG4gICAgW25hbWUkaF06ICdmaXJlLWF1dGgtY29tcGF0JyxcclxuICAgIFtuYW1lJGddOiAnZmlyZS1ydGRiJyxcclxuICAgIFtuYW1lJGZdOiAnZmlyZS1ydGRiLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRlXTogJ2ZpcmUtZm4nLFxyXG4gICAgW25hbWUkZF06ICdmaXJlLWZuLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRjXTogJ2ZpcmUtaWlkJyxcclxuICAgIFtuYW1lJGJdOiAnZmlyZS1paWQtY29tcGF0JyxcclxuICAgIFtuYW1lJGFdOiAnZmlyZS1mY20nLFxyXG4gICAgW25hbWUkOV06ICdmaXJlLWZjbS1jb21wYXQnLFxyXG4gICAgW25hbWUkOF06ICdmaXJlLXBlcmYnLFxyXG4gICAgW25hbWUkN106ICdmaXJlLXBlcmYtY29tcGF0JyxcclxuICAgIFtuYW1lJDZdOiAnZmlyZS1yYycsXHJcbiAgICBbbmFtZSQ1XTogJ2ZpcmUtcmMtY29tcGF0JyxcclxuICAgIFtuYW1lJDRdOiAnZmlyZS1nY3MnLFxyXG4gICAgW25hbWUkM106ICdmaXJlLWdjcy1jb21wYXQnLFxyXG4gICAgW25hbWUkMl06ICdmaXJlLWZzdCcsXHJcbiAgICBbbmFtZSQxXTogJ2ZpcmUtZnN0LWNvbXBhdCcsXHJcbiAgICAnZmlyZS1qcyc6ICdmaXJlLWpzJyxcclxuICAgIFtuYW1lXTogJ2ZpcmUtanMtYWxsJ1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBfYXBwcyA9IG5ldyBNYXAoKTtcclxuLyoqXHJcbiAqIFJlZ2lzdGVyZWQgY29tcG9uZW50cy5cclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5jb25zdCBfY29tcG9uZW50cyA9IG5ldyBNYXAoKTtcclxuLyoqXHJcbiAqIEBwYXJhbSBjb21wb25lbnQgLSB0aGUgY29tcG9uZW50IGJlaW5nIGFkZGVkIHRvIHRoaXMgYXBwJ3MgY29udGFpbmVyXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gX2FkZENvbXBvbmVudChhcHAsIGNvbXBvbmVudCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBhcHAuY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBsb2dnZXIuZGVidWcoYENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBGaXJlYmFzZUFwcCAke2FwcC5uYW1lfWAsIGUpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9hZGRPck92ZXJ3cml0ZUNvbXBvbmVudChhcHAsIGNvbXBvbmVudCkge1xyXG4gICAgYXBwLmNvbnRhaW5lci5hZGRPck92ZXJ3cml0ZUNvbXBvbmVudChjb21wb25lbnQpO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCB0byByZWdpc3RlclxyXG4gKiBAcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgY29tcG9uZW50IGlzIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5XHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gX3JlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IGNvbXBvbmVudC5uYW1lO1xyXG4gICAgaWYgKF9jb21wb25lbnRzLmhhcyhjb21wb25lbnROYW1lKSkge1xyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgVGhlcmUgd2VyZSBtdWx0aXBsZSBhdHRlbXB0cyB0byByZWdpc3RlciBjb21wb25lbnQgJHtjb21wb25lbnROYW1lfS5gKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBfY29tcG9uZW50cy5zZXQoY29tcG9uZW50TmFtZSwgY29tcG9uZW50KTtcclxuICAgIC8vIGFkZCB0aGUgY29tcG9uZW50IHRvIGV4aXN0aW5nIGFwcCBpbnN0YW5jZXNcclxuICAgIGZvciAoY29uc3QgYXBwIG9mIF9hcHBzLnZhbHVlcygpKSB7XHJcbiAgICAgICAgX2FkZENvbXBvbmVudChhcHAsIGNvbXBvbmVudCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG4vKipcclxuICpcclxuICogQHBhcmFtIGFwcCAtIEZpcmViYXNlQXBwIGluc3RhbmNlXHJcbiAqIEBwYXJhbSBuYW1lIC0gc2VydmljZSBuYW1lXHJcbiAqXHJcbiAqIEByZXR1cm5zIHRoZSBwcm92aWRlciBmb3IgdGhlIHNlcnZpY2Ugd2l0aCB0aGUgbWF0Y2hpbmcgbmFtZVxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9nZXRQcm92aWRlcihhcHAsIG5hbWUpIHtcclxuICAgIGNvbnN0IGhlYXJ0YmVhdENvbnRyb2xsZXIgPSBhcHAuY29udGFpbmVyXHJcbiAgICAgICAgLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKVxyXG4gICAgICAgIC5nZXRJbW1lZGlhdGUoeyBvcHRpb25hbDogdHJ1ZSB9KTtcclxuICAgIGlmIChoZWFydGJlYXRDb250cm9sbGVyKSB7XHJcbiAgICAgICAgdm9pZCBoZWFydGJlYXRDb250cm9sbGVyLnRyaWdnZXJIZWFydGJlYXQoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBhcHAuY29udGFpbmVyLmdldFByb3ZpZGVyKG5hbWUpO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gYXBwIC0gRmlyZWJhc2VBcHAgaW5zdGFuY2VcclxuICogQHBhcmFtIG5hbWUgLSBzZXJ2aWNlIG5hbWVcclxuICogQHBhcmFtIGluc3RhbmNlSWRlbnRpZmllciAtIHNlcnZpY2UgaW5zdGFuY2UgaWRlbnRpZmllciBpbiBjYXNlIHRoZSBzZXJ2aWNlIHN1cHBvcnRzIG11bHRpcGxlIGluc3RhbmNlc1xyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9yZW1vdmVTZXJ2aWNlSW5zdGFuY2UoYXBwLCBuYW1lLCBpbnN0YW5jZUlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUpIHtcclxuICAgIF9nZXRQcm92aWRlcihhcHAsIG5hbWUpLmNsZWFySW5zdGFuY2UoaW5zdGFuY2VJZGVudGlmaWVyKTtcclxufVxyXG4vKipcclxuICogVGVzdCBvbmx5XHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gX2NsZWFyQ29tcG9uZW50cygpIHtcclxuICAgIF9jb21wb25lbnRzLmNsZWFyKCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgRVJST1JTID0ge1xyXG4gICAgW1wibm8tYXBwXCIgLyogQXBwRXJyb3IuTk9fQVBQICovXTogXCJObyBGaXJlYmFzZSBBcHAgJ3skYXBwTmFtZX0nIGhhcyBiZWVuIGNyZWF0ZWQgLSBcIiArXHJcbiAgICAgICAgJ2NhbGwgaW5pdGlhbGl6ZUFwcCgpIGZpcnN0JyxcclxuICAgIFtcImJhZC1hcHAtbmFtZVwiIC8qIEFwcEVycm9yLkJBRF9BUFBfTkFNRSAqL106IFwiSWxsZWdhbCBBcHAgbmFtZTogJ3skYXBwTmFtZX1cIixcclxuICAgIFtcImR1cGxpY2F0ZS1hcHBcIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovXTogXCJGaXJlYmFzZSBBcHAgbmFtZWQgJ3skYXBwTmFtZX0nIGFscmVhZHkgZXhpc3RzIHdpdGggZGlmZmVyZW50IG9wdGlvbnMgb3IgY29uZmlnXCIsXHJcbiAgICBbXCJhcHAtZGVsZXRlZFwiIC8qIEFwcEVycm9yLkFQUF9ERUxFVEVEICovXTogXCJGaXJlYmFzZSBBcHAgbmFtZWQgJ3skYXBwTmFtZX0nIGFscmVhZHkgZGVsZXRlZFwiLFxyXG4gICAgW1wibm8tb3B0aW9uc1wiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi9dOiAnTmVlZCB0byBwcm92aWRlIG9wdGlvbnMsIHdoZW4gbm90IGJlaW5nIGRlcGxveWVkIHRvIGhvc3RpbmcgdmlhIHNvdXJjZS4nLFxyXG4gICAgW1wiaW52YWxpZC1hcHAtYXJndW1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX0FQUF9BUkdVTUVOVCAqL106ICdmaXJlYmFzZS57JGFwcE5hbWV9KCkgdGFrZXMgZWl0aGVyIG5vIGFyZ3VtZW50IG9yIGEgJyArXHJcbiAgICAgICAgJ0ZpcmViYXNlIEFwcCBpbnN0YW5jZS4nLFxyXG4gICAgW1wiaW52YWxpZC1sb2ctYXJndW1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX0xPR19BUkdVTUVOVCAqL106ICdGaXJzdCBhcmd1bWVudCB0byBgb25Mb2dgIG11c3QgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLicsXHJcbiAgICBbXCJpZGItb3BlblwiIC8qIEFwcEVycm9yLklEQl9PUEVOICovXTogJ0Vycm9yIHRocm93biB3aGVuIG9wZW5pbmcgSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJyxcclxuICAgIFtcImlkYi1nZXRcIiAvKiBBcHBFcnJvci5JREJfR0VUICovXTogJ0Vycm9yIHRocm93biB3aGVuIHJlYWRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLFxyXG4gICAgW1wiaWRiLXNldFwiIC8qIEFwcEVycm9yLklEQl9XUklURSAqL106ICdFcnJvciB0aHJvd24gd2hlbiB3cml0aW5nIHRvIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXHJcbiAgICBbXCJpZGItZGVsZXRlXCIgLyogQXBwRXJyb3IuSURCX0RFTEVURSAqL106ICdFcnJvciB0aHJvd24gd2hlbiBkZWxldGluZyBmcm9tIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LidcclxufTtcclxuY29uc3QgRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2FwcCcsICdGaXJlYmFzZScsIEVSUk9SUyk7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIEZpcmViYXNlQXBwSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuX2lzRGVsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcpO1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBjb25maWcubmFtZTtcclxuICAgICAgICB0aGlzLl9hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPVxyXG4gICAgICAgICAgICBjb25maWcuYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDb21wb25lbnQobmV3IENvbXBvbmVudCgnYXBwJywgKCkgPT4gdGhpcywgXCJQVUJMSUNcIiAvKiBDb21wb25lbnRUeXBlLlBVQkxJQyAqLykpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCgpIHtcclxuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDtcclxuICAgIH1cclxuICAgIHNldCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQodmFsKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBuYW1lKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTtcclxuICAgIH1cclxuICAgIGdldCBvcHRpb25zKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcclxuICAgIH1cclxuICAgIGdldCBjb25maWcoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWc7XHJcbiAgICB9XHJcbiAgICBnZXQgY29udGFpbmVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb250YWluZXI7XHJcbiAgICB9XHJcbiAgICBnZXQgaXNEZWxldGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RlbGV0ZWQ7XHJcbiAgICB9XHJcbiAgICBzZXQgaXNEZWxldGVkKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2lzRGVsZXRlZCA9IHZhbDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhpcyBmdW5jdGlvbiB3aWxsIHRocm93IGFuIEVycm9yIGlmIHRoZSBBcHAgaGFzIGFscmVhZHkgYmVlbiBkZWxldGVkIC1cclxuICAgICAqIHVzZSBiZWZvcmUgcGVyZm9ybWluZyBBUEkgYWN0aW9ucyBvbiB0aGUgQXBwLlxyXG4gICAgICovXHJcbiAgICBjaGVja0Rlc3Ryb3llZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJhcHAtZGVsZXRlZFwiIC8qIEFwcEVycm9yLkFQUF9ERUxFVEVEICovLCB7IGFwcE5hbWU6IHRoaXMuX25hbWUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgU0RLX1ZFUlNJT04gPSB2ZXJzaW9uO1xyXG5mdW5jdGlvbiBpbml0aWFsaXplQXBwKF9vcHRpb25zLCByYXdDb25maWcgPSB7fSkge1xyXG4gICAgbGV0IG9wdGlvbnMgPSBfb3B0aW9ucztcclxuICAgIGlmICh0eXBlb2YgcmF3Q29uZmlnICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGNvbnN0IG5hbWUgPSByYXdDb25maWc7XHJcbiAgICAgICAgcmF3Q29uZmlnID0geyBuYW1lIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHsgbmFtZTogREVGQVVMVF9FTlRSWV9OQU1FLCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sIHJhd0NvbmZpZyk7XHJcbiAgICBjb25zdCBuYW1lID0gY29uZmlnLm5hbWU7XHJcbiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8ICFuYW1lKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJiYWQtYXBwLW5hbWVcIiAvKiBBcHBFcnJvci5CQURfQVBQX05BTUUgKi8sIHtcclxuICAgICAgICAgICAgYXBwTmFtZTogU3RyaW5nKG5hbWUpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0gZ2V0RGVmYXVsdEFwcENvbmZpZygpKTtcclxuICAgIGlmICghb3B0aW9ucykge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm8tb3B0aW9uc1wiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi8pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZXhpc3RpbmdBcHAgPSBfYXBwcy5nZXQobmFtZSk7XHJcbiAgICBpZiAoZXhpc3RpbmdBcHApIHtcclxuICAgICAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLlxyXG4gICAgICAgIGlmIChkZWVwRXF1YWwob3B0aW9ucywgZXhpc3RpbmdBcHAub3B0aW9ucykgJiZcclxuICAgICAgICAgICAgZGVlcEVxdWFsKGNvbmZpZywgZXhpc3RpbmdBcHAuY29uZmlnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdBcHA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImR1cGxpY2F0ZS1hcHBcIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovLCB7IGFwcE5hbWU6IG5hbWUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcihuYW1lKTtcclxuICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIF9jb21wb25lbnRzLnZhbHVlcygpKSB7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbmV3QXBwID0gbmV3IEZpcmViYXNlQXBwSW1wbChvcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcik7XHJcbiAgICBfYXBwcy5zZXQobmFtZSwgbmV3QXBwKTtcclxuICAgIHJldHVybiBuZXdBcHA7XHJcbn1cclxuLyoqXHJcbiAqIFJldHJpZXZlcyBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBpbnN0YW5jZS5cclxuICpcclxuICogV2hlbiBjYWxsZWQgd2l0aCBubyBhcmd1bWVudHMsIHRoZSBkZWZhdWx0IGFwcCBpcyByZXR1cm5lZC4gV2hlbiBhbiBhcHAgbmFtZVxyXG4gKiBpcyBwcm92aWRlZCwgdGhlIGFwcCBjb3JyZXNwb25kaW5nIHRvIHRoYXQgbmFtZSBpcyByZXR1cm5lZC5cclxuICpcclxuICogQW4gZXhjZXB0aW9uIGlzIHRocm93biBpZiB0aGUgYXBwIGJlaW5nIHJldHJpZXZlZCBoYXMgbm90IHlldCBiZWVuXHJcbiAqIGluaXRpYWxpemVkLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFJldHVybiB0aGUgZGVmYXVsdCBhcHBcclxuICogY29uc3QgYXBwID0gZ2V0QXBwKCk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFJldHVybiBhIG5hbWVkIGFwcFxyXG4gKiBjb25zdCBvdGhlckFwcCA9IGdldEFwcChcIm90aGVyQXBwXCIpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIG5hbWUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBhcHAgdG8gcmV0dXJuLiBJZiBubyBuYW1lIGlzXHJcbiAqICAgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGlzIGBcIltERUZBVUxUXVwiYC5cclxuICpcclxuICogQHJldHVybnMgVGhlIGFwcCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm92aWRlZCBhcHAgbmFtZS5cclxuICogICBJZiBubyBhcHAgbmFtZSBpcyBwcm92aWRlZCwgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBcHAobmFtZSA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgY29uc3QgYXBwID0gX2FwcHMuZ2V0KG5hbWUpO1xyXG4gICAgaWYgKCFhcHAgJiYgbmFtZSA9PT0gREVGQVVMVF9FTlRSWV9OQU1FICYmIGdldERlZmF1bHRBcHBDb25maWcoKSkge1xyXG4gICAgICAgIHJldHVybiBpbml0aWFsaXplQXBwKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWFwcCkge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm8tYXBwXCIgLyogQXBwRXJyb3IuTk9fQVBQICovLCB7IGFwcE5hbWU6IG5hbWUgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXBwO1xyXG59XHJcbi8qKlxyXG4gKiBBIChyZWFkLW9ubHkpIGFycmF5IG9mIGFsbCBpbml0aWFsaXplZCBhcHBzLlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBcHBzKCkge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oX2FwcHMudmFsdWVzKCkpO1xyXG59XHJcbi8qKlxyXG4gKiBSZW5kZXJzIHRoaXMgYXBwIHVudXNhYmxlIGFuZCBmcmVlcyB0aGUgcmVzb3VyY2VzIG9mIGFsbCBhc3NvY2lhdGVkXHJcbiAqIHNlcnZpY2VzLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIGRlbGV0ZUFwcChhcHApXHJcbiAqICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAqICAgICBjb25zb2xlLmxvZyhcIkFwcCBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiKTtcclxuICogICB9KVxyXG4gKiAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xyXG4gKiAgICAgY29uc29sZS5sb2coXCJFcnJvciBkZWxldGluZyBhcHA6XCIsIGVycm9yKTtcclxuICogICB9KTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFwcChhcHApIHtcclxuICAgIGNvbnN0IG5hbWUgPSBhcHAubmFtZTtcclxuICAgIGlmIChfYXBwcy5oYXMobmFtZSkpIHtcclxuICAgICAgICBfYXBwcy5kZWxldGUobmFtZSk7XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYXBwLmNvbnRhaW5lclxyXG4gICAgICAgICAgICAuZ2V0UHJvdmlkZXJzKClcclxuICAgICAgICAgICAgLm1hcChwcm92aWRlciA9PiBwcm92aWRlci5kZWxldGUoKSkpO1xyXG4gICAgICAgIGFwcC5pc0RlbGV0ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBSZWdpc3RlcnMgYSBsaWJyYXJ5J3MgbmFtZSBhbmQgdmVyc2lvbiBmb3IgcGxhdGZvcm0gbG9nZ2luZyBwdXJwb3Nlcy5cclxuICogQHBhcmFtIGxpYnJhcnkgLSBOYW1lIG9mIDFwIG9yIDNwIGxpYnJhcnkgKGUuZy4gZmlyZXN0b3JlLCBhbmd1bGFyZmlyZSlcclxuICogQHBhcmFtIHZlcnNpb24gLSBDdXJyZW50IHZlcnNpb24gb2YgdGhhdCBsaWJyYXJ5LlxyXG4gKiBAcGFyYW0gdmFyaWFudCAtIEJ1bmRsZSB2YXJpYW50LCBlLmcuLCBub2RlLCBybiwgZXRjLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiByZWdpc3RlclZlcnNpb24obGlicmFyeUtleU9yTmFtZSwgdmVyc2lvbiwgdmFyaWFudCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgLy8gVE9ETzogV2UgY2FuIHVzZSB0aGlzIGNoZWNrIHRvIHdoaXRlbGlzdCBzdHJpbmdzIHdoZW4vaWYgd2Ugc2V0IHVwXHJcbiAgICAvLyBhIGdvb2Qgd2hpdGVsaXN0IHN5c3RlbS5cclxuICAgIGxldCBsaWJyYXJ5ID0gKF9hID0gUExBVEZPUk1fTE9HX1NUUklOR1tsaWJyYXJ5S2V5T3JOYW1lXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGlicmFyeUtleU9yTmFtZTtcclxuICAgIGlmICh2YXJpYW50KSB7XHJcbiAgICAgICAgbGlicmFyeSArPSBgLSR7dmFyaWFudH1gO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbGlicmFyeU1pc21hdGNoID0gbGlicmFyeS5tYXRjaCgvXFxzfFxcLy8pO1xyXG4gICAgY29uc3QgdmVyc2lvbk1pc21hdGNoID0gdmVyc2lvbi5tYXRjaCgvXFxzfFxcLy8pO1xyXG4gICAgaWYgKGxpYnJhcnlNaXNtYXRjaCB8fCB2ZXJzaW9uTWlzbWF0Y2gpIHtcclxuICAgICAgICBjb25zdCB3YXJuaW5nID0gW1xyXG4gICAgICAgICAgICBgVW5hYmxlIHRvIHJlZ2lzdGVyIGxpYnJhcnkgXCIke2xpYnJhcnl9XCIgd2l0aCB2ZXJzaW9uIFwiJHt2ZXJzaW9ufVwiOmBcclxuICAgICAgICBdO1xyXG4gICAgICAgIGlmIChsaWJyYXJ5TWlzbWF0Y2gpIHtcclxuICAgICAgICAgICAgd2FybmluZy5wdXNoKGBsaWJyYXJ5IG5hbWUgXCIke2xpYnJhcnl9XCIgY29udGFpbnMgaWxsZWdhbCBjaGFyYWN0ZXJzICh3aGl0ZXNwYWNlIG9yIFwiL1wiKWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGlicmFyeU1pc21hdGNoICYmIHZlcnNpb25NaXNtYXRjaCkge1xyXG4gICAgICAgICAgICB3YXJuaW5nLnB1c2goJ2FuZCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmVyc2lvbk1pc21hdGNoKSB7XHJcbiAgICAgICAgICAgIHdhcm5pbmcucHVzaChgdmVyc2lvbiBuYW1lIFwiJHt2ZXJzaW9ufVwiIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciBcIi9cIilgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9nZ2VyLndhcm4od2FybmluZy5qb2luKCcgJykpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KGAke2xpYnJhcnl9LXZlcnNpb25gLCAoKSA9PiAoeyBsaWJyYXJ5LCB2ZXJzaW9uIH0pLCBcIlZFUlNJT05cIiAvKiBDb21wb25lbnRUeXBlLlZFUlNJT04gKi8pKTtcclxufVxyXG4vKipcclxuICogU2V0cyBsb2cgaGFuZGxlciBmb3IgYWxsIEZpcmViYXNlIFNES3MuXHJcbiAqIEBwYXJhbSBsb2dDYWxsYmFjayAtIEFuIG9wdGlvbmFsIGN1c3RvbSBsb2cgaGFuZGxlciB0aGF0IGV4ZWN1dGVzIHVzZXIgY29kZSB3aGVuZXZlclxyXG4gKiB0aGUgRmlyZWJhc2UgU0RLIG1ha2VzIGEgbG9nZ2luZyBjYWxsLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBvbkxvZyhsb2dDYWxsYmFjaywgb3B0aW9ucykge1xyXG4gICAgaWYgKGxvZ0NhbGxiYWNrICE9PSBudWxsICYmIHR5cGVvZiBsb2dDYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW52YWxpZC1sb2ctYXJndW1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX0xPR19BUkdVTUVOVCAqLyk7XHJcbiAgICB9XHJcbiAgICBzZXRVc2VyTG9nSGFuZGxlcihsb2dDYWxsYmFjaywgb3B0aW9ucyk7XHJcbn1cclxuLyoqXHJcbiAqIFNldHMgbG9nIGxldmVsIGZvciBhbGwgRmlyZWJhc2UgU0RLcy5cclxuICpcclxuICogQWxsIG9mIHRoZSBsb2cgdHlwZXMgYWJvdmUgdGhlIGN1cnJlbnQgbG9nIGxldmVsIGFyZSBjYXB0dXJlZCAoaS5lLiBpZlxyXG4gKiB5b3Ugc2V0IHRoZSBsb2cgbGV2ZWwgdG8gYGluZm9gLCBlcnJvcnMgYXJlIGxvZ2dlZCwgYnV0IGBkZWJ1Z2AgYW5kXHJcbiAqIGB2ZXJib3NlYCBsb2dzIGFyZSBub3QpLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsb2dMZXZlbCkge1xyXG4gICAgc2V0TG9nTGV2ZWwkMShsb2dMZXZlbCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgREJfTkFNRSA9ICdmaXJlYmFzZS1oZWFydGJlYXQtZGF0YWJhc2UnO1xyXG5jb25zdCBEQl9WRVJTSU9OID0gMTtcclxuY29uc3QgU1RPUkVfTkFNRSA9ICdmaXJlYmFzZS1oZWFydGJlYXQtc3RvcmUnO1xyXG5sZXQgZGJQcm9taXNlID0gbnVsbDtcclxuZnVuY3Rpb24gZ2V0RGJQcm9taXNlKCkge1xyXG4gICAgaWYgKCFkYlByb21pc2UpIHtcclxuICAgICAgICBkYlByb21pc2UgPSBvcGVuREIoREJfTkFNRSwgREJfVkVSU0lPTiwge1xyXG4gICAgICAgICAgICB1cGdyYWRlOiAoZGIsIG9sZFZlcnNpb24pID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaFxyXG4gICAgICAgICAgICAgICAgLy8gYmVoYXZpb3IgaXMgd2hhdCB3ZSB3YW50LCBiZWNhdXNlIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSB2ZXJzaW9ucyBiZXR3ZWVuXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgb2xkIHZlcnNpb24gYW5kIHRoZSBjdXJyZW50IHZlcnNpb24sIHdlIHdhbnQgQUxMIHRoZSBtaWdyYXRpb25zXHJcbiAgICAgICAgICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuXHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVmYXVsdC1jYXNlXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG9sZFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKFNUT1JFX05BTUUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLW9wZW5cIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqLywge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYlByb21pc2U7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gcmVhZEhlYXJ0YmVhdHNGcm9tSW5kZXhlZERCKGFwcCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXHJcbiAgICAgICAgICAgIC50cmFuc2FjdGlvbihTVE9SRV9OQU1FKVxyXG4gICAgICAgICAgICAub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSlcclxuICAgICAgICAgICAgLmdldChjb21wdXRlS2V5KGFwcCkpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvcikge1xyXG4gICAgICAgICAgICBsb2dnZXIud2FybihlLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWRiR2V0RXJyb3IgPSBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImlkYi1nZXRcIiAvKiBBcHBFcnJvci5JREJfR0VUICovLCB7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGlkYkdldEVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5hc3luYyBmdW5jdGlvbiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQihhcHAsIGhlYXJ0YmVhdE9iamVjdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHgub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7XHJcbiAgICAgICAgYXdhaXQgb2JqZWN0U3RvcmUucHV0KGhlYXJ0YmVhdE9iamVjdCwgY29tcHV0ZUtleShhcHApKTtcclxuICAgICAgICBhd2FpdCB0eC5kb25lO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oZS5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkYkdldEVycm9yID0gRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpZGItc2V0XCIgLyogQXBwRXJyb3IuSURCX1dSSVRFICovLCB7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGlkYkdldEVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjb21wdXRlS2V5KGFwcCkge1xyXG4gICAgcmV0dXJuIGAke2FwcC5uYW1lfSEke2FwcC5vcHRpb25zLmFwcElkfWA7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgTUFYX0hFQURFUl9CWVRFUyA9IDEwMjQ7XHJcbi8vIDMwIGRheXNcclxuY29uc3QgU1RPUkVEX0hFQVJUQkVBVF9SRVRFTlRJT05fTUFYX01JTExJUyA9IDMwICogMjQgKiA2MCAqIDYwICogMTAwMDtcclxuY2xhc3MgSGVhcnRiZWF0U2VydmljZUltcGwge1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW4tbWVtb3J5IGNhY2hlIGZvciBoZWFydGJlYXRzLCB1c2VkIGJ5IGdldEhlYXJ0YmVhdHNIZWFkZXIoKSB0byBnZW5lcmF0ZVxyXG4gICAgICAgICAqIHRoZSBoZWFkZXIgc3RyaW5nLlxyXG4gICAgICAgICAqIFN0b3JlcyBvbmUgcmVjb3JkIHBlciBkYXRlLiBUaGlzIHdpbGwgYmUgY29uc29saWRhdGVkIGludG8gdGhlIHN0YW5kYXJkXHJcbiAgICAgICAgICogZm9ybWF0IG9mIG9uZSByZWNvcmQgcGVyIHVzZXIgYWdlbnQgc3RyaW5nIGJlZm9yZSBiZWluZyBzZW50IGFzIGEgaGVhZGVyLlxyXG4gICAgICAgICAqIFBvcHVsYXRlZCBmcm9tIGluZGV4ZWREQiB3aGVuIHRoZSBjb250cm9sbGVyIGlzIGluc3RhbnRpYXRlZCBhbmQgc2hvdWxkXHJcbiAgICAgICAgICogYmUga2VwdCBpbiBzeW5jIHdpdGggaW5kZXhlZERCLlxyXG4gICAgICAgICAqIExlYXZlIHB1YmxpYyBmb3IgZWFzaWVyIHRlc3RpbmcuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gbnVsbDtcclxuICAgICAgICBjb25zdCBhcHAgPSB0aGlzLmNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IG5ldyBIZWFydGJlYXRTdG9yYWdlSW1wbChhcHApO1xyXG4gICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2UgPSB0aGlzLl9zdG9yYWdlLnJlYWQoKS50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHRvIHJlcG9ydCBhIGhlYXJ0YmVhdC4gVGhlIGZ1bmN0aW9uIHdpbGwgZ2VuZXJhdGVcclxuICAgICAqIGEgSGVhcnRiZWF0c0J5VXNlckFnZW50IG9iamVjdCwgdXBkYXRlIGhlYXJ0YmVhdHNDYWNoZSwgYW5kIHBlcnNpc3QgaXRcclxuICAgICAqIHRvIEluZGV4ZWREQi5cclxuICAgICAqIE5vdGUgdGhhdCB3ZSBvbmx5IHN0b3JlIG9uZSBoZWFydGJlYXQgcGVyIGRheS4gU28gaWYgYSBoZWFydGJlYXQgZm9yIHRvZGF5IGlzXHJcbiAgICAgKiBhbHJlYWR5IGxvZ2dlZCwgc3Vic2VxdWVudCBjYWxscyB0byB0aGlzIGZ1bmN0aW9uIGluIHRoZSBzYW1lIGRheSB3aWxsIGJlIGlnbm9yZWQuXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIHRyaWdnZXJIZWFydGJlYXQoKSB7XHJcbiAgICAgICAgY29uc3QgcGxhdGZvcm1Mb2dnZXIgPSB0aGlzLmNvbnRhaW5lclxyXG4gICAgICAgICAgICAuZ2V0UHJvdmlkZXIoJ3BsYXRmb3JtLWxvZ2dlcicpXHJcbiAgICAgICAgICAgIC5nZXRJbW1lZGlhdGUoKTtcclxuICAgICAgICAvLyBUaGlzIGlzIHRoZSBcIkZpcmViYXNlIHVzZXIgYWdlbnRcIiBzdHJpbmcgZnJvbSB0aGUgcGxhdGZvcm0gbG9nZ2VyXHJcbiAgICAgICAgLy8gc2VydmljZSwgbm90IHRoZSBicm93c2VyIHVzZXIgYWdlbnQuXHJcbiAgICAgICAgY29uc3QgYWdlbnQgPSBwbGF0Zm9ybUxvZ2dlci5nZXRQbGF0Zm9ybUluZm9TdHJpbmcoKTtcclxuICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpO1xyXG4gICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gYXdhaXQgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRG8gbm90IHN0b3JlIGEgaGVhcnRiZWF0IGlmIG9uZSBpcyBhbHJlYWR5IHN0b3JlZCBmb3IgdGhpcyBkYXlcclxuICAgICAgICAvLyBvciBpZiBhIGhlYWRlciBoYXMgYWxyZWFkeSBiZWVuIHNlbnQgdG9kYXkuXHJcbiAgICAgICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPT09IGRhdGUgfHxcclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMuc29tZShzaW5nbGVEYXRlSGVhcnRiZWF0ID0+IHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSA9PT0gZGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gZW50cnkgZm9yIHRoaXMgZGF0ZS4gQ3JlYXRlIG9uZS5cclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMucHVzaCh7IGRhdGUsIGFnZW50IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBSZW1vdmUgZW50cmllcyBvbGRlciB0aGFuIDMwIGRheXMuXHJcbiAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5maWx0ZXIoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhiVGltZXN0YW1wID0gbmV3IERhdGUoc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBub3cgLSBoYlRpbWVzdGFtcCA8PSBTVE9SRURfSEVBUlRCRUFUX1JFVEVOVElPTl9NQVhfTUlMTElTO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLm92ZXJ3cml0ZSh0aGlzLl9oZWFydGJlYXRzQ2FjaGUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgYmFzZTY0IGVuY29kZWQgc3RyaW5nIHdoaWNoIGNhbiBiZSBhdHRhY2hlZCB0byB0aGUgaGVhcnRiZWF0LXNwZWNpZmljIGhlYWRlciBkaXJlY3RseS5cclxuICAgICAqIEl0IGFsc28gY2xlYXJzIGFsbCBoZWFydGJlYXRzIGZyb20gbWVtb3J5IGFzIHdlbGwgYXMgaW4gSW5kZXhlZERCLlxyXG4gICAgICpcclxuICAgICAqIE5PVEU6IENvbnN1bWluZyBwcm9kdWN0IFNES3Mgc2hvdWxkIG5vdCBzZW5kIHRoZSBoZWFkZXIgaWYgdGhpcyBtZXRob2RcclxuICAgICAqIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBhc3luYyBnZXRIZWFydGJlYXRzSGVhZGVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgaXQncyBzdGlsbCBudWxsIG9yIHRoZSBhcnJheSBpcyBlbXB0eSwgdGhlcmUgaXMgbm8gZGF0YSB0byBzZW5kLlxyXG4gICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwgfHxcclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGF0ZSA9IGdldFVUQ0RhdGVTdHJpbmcoKTtcclxuICAgICAgICAvLyBFeHRyYWN0IGFzIG1hbnkgaGVhcnRiZWF0cyBmcm9tIHRoZSBjYWNoZSBhcyB3aWxsIGZpdCB1bmRlciB0aGUgc2l6ZSBsaW1pdC5cclxuICAgICAgICBjb25zdCB7IGhlYXJ0YmVhdHNUb1NlbmQsIHVuc2VudEVudHJpZXMgfSA9IGV4dHJhY3RIZWFydGJlYXRzRm9ySGVhZGVyKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzKTtcclxuICAgICAgICBjb25zdCBoZWFkZXJTdHJpbmcgPSBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDIsIGhlYXJ0YmVhdHM6IGhlYXJ0YmVhdHNUb1NlbmQgfSkpO1xyXG4gICAgICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5LlxyXG4gICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPSBkYXRlO1xyXG4gICAgICAgIGlmICh1bnNlbnRFbnRyaWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gU3RvcmUgYW55IHVuc2VudCBlbnRyaWVzIGlmIHRoZXkgZXhpc3QuXHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gdW5zZW50RW50cmllcztcclxuICAgICAgICAgICAgLy8gVGhpcyBzZWVtcyBtb3JlIGxpa2VseSB0aGFuIGVtcHR5aW5nIHRoZSBhcnJheSAoYmVsb3cpIHRvIGxlYWQgdG8gc29tZSBvZGQgc3RhdGVcclxuICAgICAgICAgICAgLy8gc2luY2UgdGhlIGNhY2hlIGlzbid0IGVtcHR5IGFuZCB0aGlzIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IHJlcXVlc3QsXHJcbiAgICAgICAgICAgIC8vIGFuZCBpcyBwcm9iYWJseSBzYWZlc3QgaWYgd2UgYXdhaXQgaXQuXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyA9IFtdO1xyXG4gICAgICAgICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuXHJcbiAgICAgICAgICAgIHZvaWQgdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGhlYWRlclN0cmluZztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRVVENEYXRlU3RyaW5nKCkge1xyXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgLy8gUmV0dXJucyBkYXRlIGZvcm1hdCAnWVlZWS1NTS1ERCdcclxuICAgIHJldHVybiB0b2RheS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7XHJcbn1cclxuZnVuY3Rpb24gZXh0cmFjdEhlYXJ0YmVhdHNGb3JIZWFkZXIoaGVhcnRiZWF0c0NhY2hlLCBtYXhTaXplID0gTUFYX0hFQURFUl9CWVRFUykge1xyXG4gICAgLy8gSGVhcnRiZWF0cyBncm91cGVkIGJ5IHVzZXIgYWdlbnQgaW4gdGhlIHN0YW5kYXJkIGZvcm1hdCB0byBiZSBzZW50IGluXHJcbiAgICAvLyB0aGUgaGVhZGVyLlxyXG4gICAgY29uc3QgaGVhcnRiZWF0c1RvU2VuZCA9IFtdO1xyXG4gICAgLy8gU2luZ2xlIGRhdGUgZm9ybWF0IGhlYXJ0YmVhdHMgdGhhdCBhcmUgbm90IHNlbnQuXHJcbiAgICBsZXQgdW5zZW50RW50cmllcyA9IGhlYXJ0YmVhdHNDYWNoZS5zbGljZSgpO1xyXG4gICAgZm9yIChjb25zdCBzaW5nbGVEYXRlSGVhcnRiZWF0IG9mIGhlYXJ0YmVhdHNDYWNoZSkge1xyXG4gICAgICAgIC8vIExvb2sgZm9yIGFuIGV4aXN0aW5nIGVudHJ5IHdpdGggdGhlIHNhbWUgdXNlciBhZ2VudC5cclxuICAgICAgICBjb25zdCBoZWFydGJlYXRFbnRyeSA9IGhlYXJ0YmVhdHNUb1NlbmQuZmluZChoYiA9PiBoYi5hZ2VudCA9PT0gc2luZ2xlRGF0ZUhlYXJ0YmVhdC5hZ2VudCk7XHJcbiAgICAgICAgaWYgKCFoZWFydGJlYXRFbnRyeSkge1xyXG4gICAgICAgICAgICAvLyBJZiBubyBlbnRyeSBmb3IgdGhpcyB1c2VyIGFnZW50IGV4aXN0cywgY3JlYXRlIG9uZS5cclxuICAgICAgICAgICAgaGVhcnRiZWF0c1RvU2VuZC5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGFnZW50OiBzaW5nbGVEYXRlSGVhcnRiZWF0LmFnZW50LFxyXG4gICAgICAgICAgICAgICAgZGF0ZXM6IFtzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGVdXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAoY291bnRCeXRlcyhoZWFydGJlYXRzVG9TZW5kKSA+IG1heFNpemUpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGhlYXJ0YmVhdFxyXG4gICAgICAgICAgICAgICAgLy8gZW50cnkgYW5kIHN0b3AgYWRkaW5nIHRvIHRoZSBoZWFkZXIuXHJcbiAgICAgICAgICAgICAgICBoZWFydGJlYXRzVG9TZW5kLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGhlYXJ0YmVhdEVudHJ5LmRhdGVzLnB1c2goc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlKTtcclxuICAgICAgICAgICAgLy8gSWYgdGhlIGhlYWRlciB3b3VsZCBleGNlZWQgbWF4IHNpemUsIHJlbW92ZSB0aGUgYWRkZWQgZGF0ZVxyXG4gICAgICAgICAgICAvLyBhbmQgc3RvcCBhZGRpbmcgdG8gdGhlIGhlYWRlci5cclxuICAgICAgICAgICAgaWYgKGNvdW50Qnl0ZXMoaGVhcnRiZWF0c1RvU2VuZCkgPiBtYXhTaXplKSB7XHJcbiAgICAgICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFBvcCB1bnNlbnQgZW50cnkgZnJvbSBxdWV1ZS4gKFNraXBwZWQgaWYgYWRkaW5nIHRoZSBlbnRyeSBleGNlZWRlZFxyXG4gICAgICAgIC8vIHF1b3RhIGFuZCB0aGUgbG9vcCBicmVha3MgZWFybHkuKVxyXG4gICAgICAgIHVuc2VudEVudHJpZXMgPSB1bnNlbnRFbnRyaWVzLnNsaWNlKDEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBoZWFydGJlYXRzVG9TZW5kLFxyXG4gICAgICAgIHVuc2VudEVudHJpZXNcclxuICAgIH07XHJcbn1cclxuY2xhc3MgSGVhcnRiZWF0U3RvcmFnZUltcGwge1xyXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XHJcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XHJcbiAgICAgICAgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZSA9IHRoaXMucnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgcnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpIHtcclxuICAgICAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdHJ1ZSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWFkIGFsbCBoZWFydGJlYXRzLlxyXG4gICAgICovXHJcbiAgICBhc3luYyByZWFkKCkge1xyXG4gICAgICAgIGNvbnN0IGNhblVzZUluZGV4ZWREQiA9IGF3YWl0IHRoaXMuX2NhblVzZUluZGV4ZWREQlByb21pc2U7XHJcbiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgaGVhcnRiZWF0czogW10gfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkYkhlYXJ0YmVhdE9iamVjdCA9IGF3YWl0IHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQih0aGlzLmFwcCk7XHJcbiAgICAgICAgICAgIHJldHVybiBpZGJIZWFydGJlYXRPYmplY3QgfHwgeyBoZWFydGJlYXRzOiBbXSB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIG92ZXJ3cml0ZSB0aGUgc3RvcmFnZSB3aXRoIHRoZSBwcm92aWRlZCBoZWFydGJlYXRzXHJcbiAgICBhc3luYyBvdmVyd3JpdGUoaGVhcnRiZWF0c09iamVjdCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xyXG4gICAgICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIodGhpcy5hcHAsIHtcclxuICAgICAgICAgICAgICAgIGxhc3RTZW50SGVhcnRiZWF0RGF0ZTogKF9hID0gaGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUsXHJcbiAgICAgICAgICAgICAgICBoZWFydGJlYXRzOiBoZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gYWRkIGhlYXJ0YmVhdHNcclxuICAgIGFzeW5jIGFkZChoZWFydGJlYXRzT2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGNvbnN0IGNhblVzZUluZGV4ZWREQiA9IGF3YWl0IHRoaXMuX2NhblVzZUluZGV4ZWREQlByb21pc2U7XHJcbiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0ID0gYXdhaXQgdGhpcy5yZWFkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQih0aGlzLmFwcCwge1xyXG4gICAgICAgICAgICAgICAgbGFzdFNlbnRIZWFydGJlYXREYXRlOiAoX2EgPSBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSxcclxuICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHM6IFtcclxuICAgICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0cyxcclxuICAgICAgICAgICAgICAgICAgICAuLi5oZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHNcclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBDYWxjdWxhdGUgYnl0ZXMgb2YgYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgYXJyYXkgYWZ0ZXIgYmVpbmcgd3JhcHBlZFxyXG4gKiBpbiBhIHBsYXRmb3JtIGxvZ2dpbmcgaGVhZGVyIEpTT04gb2JqZWN0LCBzdHJpbmdpZmllZCwgYW5kIGNvbnZlcnRlZFxyXG4gKiB0byBiYXNlIDY0LlxyXG4gKi9cclxuZnVuY3Rpb24gY291bnRCeXRlcyhoZWFydGJlYXRzQ2FjaGUpIHtcclxuICAgIC8vIGJhc2U2NCBoYXMgYSByZXN0cmljdGVkIHNldCBvZiBjaGFyYWN0ZXJzLCBhbGwgb2Ygd2hpY2ggc2hvdWxkIGJlIDEgYnl0ZS5cclxuICAgIHJldHVybiBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhcclxuICAgIC8vIGhlYXJ0YmVhdHNDYWNoZSB3cmFwcGVyIHByb3BlcnRpZXNcclxuICAgIEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMiwgaGVhcnRiZWF0czogaGVhcnRiZWF0c0NhY2hlIH0pKS5sZW5ndGg7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gcmVnaXN0ZXJDb3JlQ29tcG9uZW50cyh2YXJpYW50KSB7XHJcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgncGxhdGZvcm0tbG9nZ2VyJywgY29udGFpbmVyID0+IG5ldyBQbGF0Zm9ybUxvZ2dlclNlcnZpY2VJbXBsKGNvbnRhaW5lciksIFwiUFJJVkFURVwiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpO1xyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ2hlYXJ0YmVhdCcsIGNvbnRhaW5lciA9PiBuZXcgSGVhcnRiZWF0U2VydmljZUltcGwoY29udGFpbmVyKSwgXCJQUklWQVRFXCIgLyogQ29tcG9uZW50VHlwZS5QUklWQVRFICovKSk7XHJcbiAgICAvLyBSZWdpc3RlciBgYXBwYCBwYWNrYWdlLlxyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkbywgdmVyc2lvbiQxLCB2YXJpYW50KTtcclxuICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXHJcbiAgICByZWdpc3RlclZlcnNpb24obmFtZSRvLCB2ZXJzaW9uJDEsICdlc20yMDE3Jyk7XHJcbiAgICAvLyBSZWdpc3RlciBwbGF0Zm9ybSBTREsgaWRlbnRpZmllciAobm8gdmVyc2lvbikuXHJcbiAgICByZWdpc3RlclZlcnNpb24oJ2ZpcmUtanMnLCAnJyk7XHJcbn1cblxuLyoqXHJcbiAqIEZpcmViYXNlIEFwcFxyXG4gKlxyXG4gKiBAcmVtYXJrcyBUaGlzIHBhY2thZ2UgY29vcmRpbmF0ZXMgdGhlIGNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUgZGlmZmVyZW50IEZpcmViYXNlIGNvbXBvbmVudHNcclxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXHJcbiAqL1xyXG5yZWdpc3RlckNvcmVDb21wb25lbnRzKCcnKTtcblxuZXhwb3J0IHsgU0RLX1ZFUlNJT04sIERFRkFVTFRfRU5UUllfTkFNRSBhcyBfREVGQVVMVF9FTlRSWV9OQU1FLCBfYWRkQ29tcG9uZW50LCBfYWRkT3JPdmVyd3JpdGVDb21wb25lbnQsIF9hcHBzLCBfY2xlYXJDb21wb25lbnRzLCBfY29tcG9uZW50cywgX2dldFByb3ZpZGVyLCBfcmVnaXN0ZXJDb21wb25lbnQsIF9yZW1vdmVTZXJ2aWNlSW5zdGFuY2UsIGRlbGV0ZUFwcCwgZ2V0QXBwLCBnZXRBcHBzLCBpbml0aWFsaXplQXBwLCBvbkxvZywgcmVnaXN0ZXJWZXJzaW9uLCBzZXRMb2dMZXZlbCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsImltcG9ydCB7IHJlZ2lzdGVyVmVyc2lvbiB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuZXhwb3J0ICogZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5cbnZhciBuYW1lID0gXCJmaXJlYmFzZVwiO1xudmFyIHZlcnNpb24gPSBcIjEwLjEuMFwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5yZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtLmpzLm1hcFxuIiwidmFyIGNvbW1vbmpzR2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307XG5cbnZhciBlc20gPSB7fTtcblxuLypcblxuIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG4gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiovXG5cbnZhciBrLGdvb2c9Z29vZ3x8e30sbD1jb21tb25qc0dsb2JhbHx8c2VsZjtmdW5jdGlvbiBhYShhKXt2YXIgYj10eXBlb2YgYTtiPVwib2JqZWN0XCIhPWI/YjphP0FycmF5LmlzQXJyYXkoYSk/XCJhcnJheVwiOmI6XCJudWxsXCI7cmV0dXJuIFwiYXJyYXlcIj09Ynx8XCJvYmplY3RcIj09YiYmXCJudW1iZXJcIj09dHlwZW9mIGEubGVuZ3RofWZ1bmN0aW9uIHAoYSl7dmFyIGI9dHlwZW9mIGE7cmV0dXJuIFwib2JqZWN0XCI9PWImJm51bGwhPWF8fFwiZnVuY3Rpb25cIj09Yn1mdW5jdGlvbiBiYShhKXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGEsY2EpJiZhW2NhXXx8KGFbY2FdPSsrZGEpfXZhciBjYT1cImNsb3N1cmVfdWlkX1wiKygxRTkqTWF0aC5yYW5kb20oKT4+PjApLGRhPTA7ZnVuY3Rpb24gZWEoYSxiLGMpe3JldHVybiBhLmNhbGwuYXBwbHkoYS5iaW5kLGFyZ3VtZW50cyl9XG5mdW5jdGlvbiBmYShhLGIsYyl7aWYoIWEpdGhyb3cgRXJyb3IoKTtpZigyPGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBkPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO0FycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KGUsZCk7cmV0dXJuIGEuYXBwbHkoYixlKX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkoYixhcmd1bWVudHMpfX1mdW5jdGlvbiBxKGEsYixjKXtGdW5jdGlvbi5wcm90b3R5cGUuYmluZCYmLTEhPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLnRvU3RyaW5nKCkuaW5kZXhPZihcIm5hdGl2ZSBjb2RlXCIpP3E9ZWE6cT1mYTtyZXR1cm4gcS5hcHBseShudWxsLGFyZ3VtZW50cyl9XG5mdW5jdGlvbiBoYShhLGIpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZD1jLnNsaWNlKCk7ZC5wdXNoLmFwcGx5KGQsYXJndW1lbnRzKTtyZXR1cm4gYS5hcHBseSh0aGlzLGQpfX1mdW5jdGlvbiByKGEsYil7ZnVuY3Rpb24gYygpe31jLnByb3RvdHlwZT1iLnByb3RvdHlwZTthLiQ9Yi5wcm90b3R5cGU7YS5wcm90b3R5cGU9bmV3IGM7YS5wcm90b3R5cGUuY29uc3RydWN0b3I9YTthLmFjPWZ1bmN0aW9uKGQsZSxmKXtmb3IodmFyIGg9QXJyYXkoYXJndW1lbnRzLmxlbmd0aC0yKSxuPTI7bjxhcmd1bWVudHMubGVuZ3RoO24rKyloW24tMl09YXJndW1lbnRzW25dO3JldHVybiBiLnByb3RvdHlwZVtlXS5hcHBseShkLGgpfTt9ZnVuY3Rpb24gdigpe3RoaXMucz10aGlzLnM7dGhpcy5vPXRoaXMubzt9dmFyIGlhPTA7di5wcm90b3R5cGUucz0hMTt2LnByb3RvdHlwZS5zYT1mdW5jdGlvbigpe2lmKCF0aGlzLnMmJih0aGlzLnM9ITAsdGhpcy5OKCksMCE9aWEpKXtiYSh0aGlzKTt9fTt2LnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7aWYodGhpcy5vKWZvcig7dGhpcy5vLmxlbmd0aDspdGhpcy5vLnNoaWZ0KCkoKTt9O2NvbnN0IGthPUFycmF5LnByb3RvdHlwZS5pbmRleE9mP2Z1bmN0aW9uKGEsYil7cmV0dXJuIEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYSxiLHZvaWQgMCl9OmZ1bmN0aW9uKGEsYil7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXJldHVybiBcInN0cmluZ1wiIT09dHlwZW9mIGJ8fDEhPWIubGVuZ3RoPy0xOmEuaW5kZXhPZihiLDApO2ZvcihsZXQgYz0wO2M8YS5sZW5ndGg7YysrKWlmKGMgaW4gYSYmYVtjXT09PWIpcmV0dXJuIGM7cmV0dXJuIC0xfTtmdW5jdGlvbiBtYShhKXtjb25zdCBiPWEubGVuZ3RoO2lmKDA8Yil7Y29uc3QgYz1BcnJheShiKTtmb3IobGV0IGQ9MDtkPGI7ZCsrKWNbZF09YVtkXTtyZXR1cm4gY31yZXR1cm4gW119XG5mdW5jdGlvbiBuYShhLGIpe2ZvcihsZXQgYz0xO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspe2NvbnN0IGQ9YXJndW1lbnRzW2NdO2lmKGFhKGQpKXtjb25zdCBlPWEubGVuZ3RofHwwLGY9ZC5sZW5ndGh8fDA7YS5sZW5ndGg9ZStmO2ZvcihsZXQgaD0wO2g8ZjtoKyspYVtlK2hdPWRbaF07fWVsc2UgYS5wdXNoKGQpO319ZnVuY3Rpb24gdyhhLGIpe3RoaXMudHlwZT1hO3RoaXMuZz10aGlzLnRhcmdldD1iO3RoaXMuZGVmYXVsdFByZXZlbnRlZD0hMTt9dy5wcm90b3R5cGUuaD1mdW5jdGlvbigpe3RoaXMuZGVmYXVsdFByZXZlbnRlZD0hMDt9O3ZhciBvYT1mdW5jdGlvbigpe2lmKCFsLmFkZEV2ZW50TGlzdGVuZXJ8fCFPYmplY3QuZGVmaW5lUHJvcGVydHkpcmV0dXJuICExO3ZhciBhPSExLGI9T2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LFwicGFzc2l2ZVwiLHtnZXQ6ZnVuY3Rpb24oKXthPSEwO319KTt0cnl7bC5hZGRFdmVudExpc3RlbmVyKFwidGVzdFwiLCgpPT57fSxiKSxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0ZXN0XCIsKCk9Pnt9LGIpO31jYXRjaChjKXt9cmV0dXJuIGF9KCk7ZnVuY3Rpb24geChhKXtyZXR1cm4gL15bXFxzXFx4YTBdKiQvLnRlc3QoYSl9ZnVuY3Rpb24gcGEoKXt2YXIgYT1sLm5hdmlnYXRvcjtyZXR1cm4gYSYmKGE9YS51c2VyQWdlbnQpP2E6XCJcIn1mdW5jdGlvbiB5KGEpe3JldHVybiAtMSE9cGEoKS5pbmRleE9mKGEpfWZ1bmN0aW9uIHFhKGEpe3FhW1wiIFwiXShhKTtyZXR1cm4gYX1xYVtcIiBcIl09ZnVuY3Rpb24oKXt9O2Z1bmN0aW9uIHJhKGEsYil7dmFyIGM9c2E7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjLGEpP2NbYV06Y1thXT1iKGEpfXZhciB0YT15KFwiT3BlcmFcIiksej15KFwiVHJpZGVudFwiKXx8eShcIk1TSUVcIiksdWE9eShcIkVkZ2VcIiksdmE9dWF8fHosd2E9eShcIkdlY2tvXCIpJiYhKC0xIT1wYSgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIndlYmtpdFwiKSYmIXkoXCJFZGdlXCIpKSYmISh5KFwiVHJpZGVudFwiKXx8eShcIk1TSUVcIikpJiYheShcIkVkZ2VcIikseGE9LTEhPXBhKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwid2Via2l0XCIpJiYheShcIkVkZ2VcIik7ZnVuY3Rpb24geWEoKXt2YXIgYT1sLmRvY3VtZW50O3JldHVybiBhP2EuZG9jdW1lbnRNb2RlOnZvaWQgMH12YXIgemE7XG5hOnt2YXIgQWE9XCJcIixCYT1mdW5jdGlvbigpe3ZhciBhPXBhKCk7aWYod2EpcmV0dXJuIC9ydjooW15cXCk7XSspKFxcKXw7KS8uZXhlYyhhKTtpZih1YSlyZXR1cm4gL0VkZ2VcXC8oW1xcZFxcLl0rKS8uZXhlYyhhKTtpZih6KXJldHVybiAvXFxiKD86TVNJRXxydilbOiBdKFteXFwpO10rKShcXCl8OykvLmV4ZWMoYSk7aWYoeGEpcmV0dXJuIC9XZWJLaXRcXC8oXFxTKykvLmV4ZWMoYSk7aWYodGEpcmV0dXJuIC8oPzpWZXJzaW9uKVsgXFwvXT8oXFxTKykvLmV4ZWMoYSl9KCk7QmEmJihBYT1CYT9CYVsxXTpcIlwiKTtpZih6KXt2YXIgQ2E9eWEoKTtpZihudWxsIT1DYSYmQ2E+cGFyc2VGbG9hdChBYSkpe3phPVN0cmluZyhDYSk7YnJlYWsgYX19emE9QWE7fXZhciBEYTtpZihsLmRvY3VtZW50JiZ6KXt2YXIgRWE9eWEoKTtEYT1FYT9FYTpwYXJzZUludCh6YSwxMCl8fHZvaWQgMDt9ZWxzZSBEYT12b2lkIDA7dmFyIEZhPURhO2Z1bmN0aW9uIEEoYSxiKXt3LmNhbGwodGhpcyxhP2EudHlwZTpcIlwiKTt0aGlzLnJlbGF0ZWRUYXJnZXQ9dGhpcy5nPXRoaXMudGFyZ2V0PW51bGw7dGhpcy5idXR0b249dGhpcy5zY3JlZW5ZPXRoaXMuc2NyZWVuWD10aGlzLmNsaWVudFk9dGhpcy5jbGllbnRYPTA7dGhpcy5rZXk9XCJcIjt0aGlzLm1ldGFLZXk9dGhpcy5zaGlmdEtleT10aGlzLmFsdEtleT10aGlzLmN0cmxLZXk9ITE7dGhpcy5zdGF0ZT1udWxsO3RoaXMucG9pbnRlcklkPTA7dGhpcy5wb2ludGVyVHlwZT1cIlwiO3RoaXMuaT1udWxsO2lmKGEpe3ZhciBjPXRoaXMudHlwZT1hLnR5cGUsZD1hLmNoYW5nZWRUb3VjaGVzJiZhLmNoYW5nZWRUb3VjaGVzLmxlbmd0aD9hLmNoYW5nZWRUb3VjaGVzWzBdOm51bGw7dGhpcy50YXJnZXQ9YS50YXJnZXR8fGEuc3JjRWxlbWVudDt0aGlzLmc9YjtpZihiPWEucmVsYXRlZFRhcmdldCl7aWYod2Epe2E6e3RyeXtxYShiLm5vZGVOYW1lKTt2YXIgZT0hMDticmVhayBhfWNhdGNoKGYpe31lPVxuITE7fWV8fChiPW51bGwpO319ZWxzZSBcIm1vdXNlb3ZlclwiPT1jP2I9YS5mcm9tRWxlbWVudDpcIm1vdXNlb3V0XCI9PWMmJihiPWEudG9FbGVtZW50KTt0aGlzLnJlbGF0ZWRUYXJnZXQ9YjtkPyh0aGlzLmNsaWVudFg9dm9pZCAwIT09ZC5jbGllbnRYP2QuY2xpZW50WDpkLnBhZ2VYLHRoaXMuY2xpZW50WT12b2lkIDAhPT1kLmNsaWVudFk/ZC5jbGllbnRZOmQucGFnZVksdGhpcy5zY3JlZW5YPWQuc2NyZWVuWHx8MCx0aGlzLnNjcmVlblk9ZC5zY3JlZW5ZfHwwKToodGhpcy5jbGllbnRYPXZvaWQgMCE9PWEuY2xpZW50WD9hLmNsaWVudFg6YS5wYWdlWCx0aGlzLmNsaWVudFk9dm9pZCAwIT09YS5jbGllbnRZP2EuY2xpZW50WTphLnBhZ2VZLHRoaXMuc2NyZWVuWD1hLnNjcmVlblh8fDAsdGhpcy5zY3JlZW5ZPWEuc2NyZWVuWXx8MCk7dGhpcy5idXR0b249YS5idXR0b247dGhpcy5rZXk9YS5rZXl8fFwiXCI7dGhpcy5jdHJsS2V5PWEuY3RybEtleTt0aGlzLmFsdEtleT1hLmFsdEtleTt0aGlzLnNoaWZ0S2V5PVxuYS5zaGlmdEtleTt0aGlzLm1ldGFLZXk9YS5tZXRhS2V5O3RoaXMucG9pbnRlcklkPWEucG9pbnRlcklkfHwwO3RoaXMucG9pbnRlclR5cGU9XCJzdHJpbmdcIj09PXR5cGVvZiBhLnBvaW50ZXJUeXBlP2EucG9pbnRlclR5cGU6R2FbYS5wb2ludGVyVHlwZV18fFwiXCI7dGhpcy5zdGF0ZT1hLnN0YXRlO3RoaXMuaT1hO2EuZGVmYXVsdFByZXZlbnRlZCYmQS4kLmguY2FsbCh0aGlzKTt9fXIoQSx3KTt2YXIgR2E9ezI6XCJ0b3VjaFwiLDM6XCJwZW5cIiw0OlwibW91c2VcIn07QS5wcm90b3R5cGUuaD1mdW5jdGlvbigpe0EuJC5oLmNhbGwodGhpcyk7dmFyIGE9dGhpcy5pO2EucHJldmVudERlZmF1bHQ/YS5wcmV2ZW50RGVmYXVsdCgpOmEucmV0dXJuVmFsdWU9ITE7fTt2YXIgSGE9XCJjbG9zdXJlX2xpc3RlbmFibGVfXCIrKDFFNipNYXRoLnJhbmRvbSgpfDApO3ZhciBJYT0wO2Z1bmN0aW9uIEphKGEsYixjLGQsZSl7dGhpcy5saXN0ZW5lcj1hO3RoaXMucHJveHk9bnVsbDt0aGlzLnNyYz1iO3RoaXMudHlwZT1jO3RoaXMuY2FwdHVyZT0hIWQ7dGhpcy5sYT1lO3RoaXMua2V5PSsrSWE7dGhpcy5mYT10aGlzLmlhPSExO31mdW5jdGlvbiBLYShhKXthLmZhPSEwO2EubGlzdGVuZXI9bnVsbDthLnByb3h5PW51bGw7YS5zcmM9bnVsbDthLmxhPW51bGw7fWZ1bmN0aW9uIE5hKGEsYixjKXtmb3IoY29uc3QgZCBpbiBhKWIuY2FsbChjLGFbZF0sZCxhKTt9ZnVuY3Rpb24gT2EoYSxiKXtmb3IoY29uc3QgYyBpbiBhKWIuY2FsbCh2b2lkIDAsYVtjXSxjLGEpO31mdW5jdGlvbiBQYShhKXtjb25zdCBiPXt9O2Zvcihjb25zdCBjIGluIGEpYltjXT1hW2NdO3JldHVybiBifWNvbnN0IFFhPVwiY29uc3RydWN0b3IgaGFzT3duUHJvcGVydHkgaXNQcm90b3R5cGVPZiBwcm9wZXJ0eUlzRW51bWVyYWJsZSB0b0xvY2FsZVN0cmluZyB0b1N0cmluZyB2YWx1ZU9mXCIuc3BsaXQoXCIgXCIpO2Z1bmN0aW9uIFJhKGEsYil7bGV0IGMsZDtmb3IobGV0IGU9MTtlPGFyZ3VtZW50cy5sZW5ndGg7ZSsrKXtkPWFyZ3VtZW50c1tlXTtmb3IoYyBpbiBkKWFbY109ZFtjXTtmb3IobGV0IGY9MDtmPFFhLmxlbmd0aDtmKyspYz1RYVtmXSxPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZCxjKSYmKGFbY109ZFtjXSk7fX1mdW5jdGlvbiBTYShhKXt0aGlzLnNyYz1hO3RoaXMuZz17fTt0aGlzLmg9MDt9U2EucHJvdG90eXBlLmFkZD1mdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPWEudG9TdHJpbmcoKTthPXRoaXMuZ1tmXTthfHwoYT10aGlzLmdbZl09W10sdGhpcy5oKyspO3ZhciBoPVRhKGEsYixkLGUpOy0xPGg/KGI9YVtoXSxjfHwoYi5pYT0hMSkpOihiPW5ldyBKYShiLHRoaXMuc3JjLGYsISFkLGUpLGIuaWE9YyxhLnB1c2goYikpO3JldHVybiBifTtmdW5jdGlvbiBVYShhLGIpe3ZhciBjPWIudHlwZTtpZihjIGluIGEuZyl7dmFyIGQ9YS5nW2NdLGU9a2EoZCxiKSxmOyhmPTA8PWUpJiZBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoZCxlLDEpO2YmJihLYShiKSwwPT1hLmdbY10ubGVuZ3RoJiYoZGVsZXRlIGEuZ1tjXSxhLmgtLSkpO319XG5mdW5jdGlvbiBUYShhLGIsYyxkKXtmb3IodmFyIGU9MDtlPGEubGVuZ3RoOysrZSl7dmFyIGY9YVtlXTtpZighZi5mYSYmZi5saXN0ZW5lcj09YiYmZi5jYXB0dXJlPT0hIWMmJmYubGE9PWQpcmV0dXJuIGV9cmV0dXJuIC0xfXZhciBWYT1cImNsb3N1cmVfbG1fXCIrKDFFNipNYXRoLnJhbmRvbSgpfDApLFdhPXt9O2Z1bmN0aW9uIFlhKGEsYixjLGQsZSl7aWYoZCYmZC5vbmNlKXJldHVybiBaYShhLGIsYyxkLGUpO2lmKEFycmF5LmlzQXJyYXkoYikpe2Zvcih2YXIgZj0wO2Y8Yi5sZW5ndGg7ZisrKVlhKGEsYltmXSxjLGQsZSk7cmV0dXJuIG51bGx9Yz0kYShjKTtyZXR1cm4gYSYmYVtIYV0/YS5PKGIsYyxwKGQpPyEhZC5jYXB0dXJlOiEhZCxlKTphYihhLGIsYywhMSxkLGUpfVxuZnVuY3Rpb24gYWIoYSxiLGMsZCxlLGYpe2lmKCFiKXRocm93IEVycm9yKFwiSW52YWxpZCBldmVudCB0eXBlXCIpO3ZhciBoPXAoZSk/ISFlLmNhcHR1cmU6ISFlLG49YmIoYSk7bnx8KGFbVmFdPW49bmV3IFNhKGEpKTtjPW4uYWRkKGIsYyxkLGgsZik7aWYoYy5wcm94eSlyZXR1cm4gYztkPWNiKCk7Yy5wcm94eT1kO2Quc3JjPWE7ZC5saXN0ZW5lcj1jO2lmKGEuYWRkRXZlbnRMaXN0ZW5lcilvYXx8KGU9aCksdm9pZCAwPT09ZSYmKGU9ITEpLGEuYWRkRXZlbnRMaXN0ZW5lcihiLnRvU3RyaW5nKCksZCxlKTtlbHNlIGlmKGEuYXR0YWNoRXZlbnQpYS5hdHRhY2hFdmVudChkYihiLnRvU3RyaW5nKCkpLGQpO2Vsc2UgaWYoYS5hZGRMaXN0ZW5lciYmYS5yZW1vdmVMaXN0ZW5lcilhLmFkZExpc3RlbmVyKGQpO2Vsc2UgdGhyb3cgRXJyb3IoXCJhZGRFdmVudExpc3RlbmVyIGFuZCBhdHRhY2hFdmVudCBhcmUgdW5hdmFpbGFibGUuXCIpO3JldHVybiBjfVxuZnVuY3Rpb24gY2IoKXtmdW5jdGlvbiBhKGMpe3JldHVybiBiLmNhbGwoYS5zcmMsYS5saXN0ZW5lcixjKX1jb25zdCBiPWViO3JldHVybiBhfWZ1bmN0aW9uIFphKGEsYixjLGQsZSl7aWYoQXJyYXkuaXNBcnJheShiKSl7Zm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspWmEoYSxiW2ZdLGMsZCxlKTtyZXR1cm4gbnVsbH1jPSRhKGMpO3JldHVybiBhJiZhW0hhXT9hLlAoYixjLHAoZCk/ISFkLmNhcHR1cmU6ISFkLGUpOmFiKGEsYixjLCEwLGQsZSl9XG5mdW5jdGlvbiBmYihhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpZm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspZmIoYSxiW2ZdLGMsZCxlKTtlbHNlIChkPXAoZCk/ISFkLmNhcHR1cmU6ISFkLGM9JGEoYyksYSYmYVtIYV0pPyhhPWEuaSxiPVN0cmluZyhiKS50b1N0cmluZygpLGIgaW4gYS5nJiYoZj1hLmdbYl0sYz1UYShmLGMsZCxlKSwtMTxjJiYoS2EoZltjXSksQXJyYXkucHJvdG90eXBlLnNwbGljZS5jYWxsKGYsYywxKSwwPT1mLmxlbmd0aCYmKGRlbGV0ZSBhLmdbYl0sYS5oLS0pKSkpOmEmJihhPWJiKGEpKSYmKGI9YS5nW2IudG9TdHJpbmcoKV0sYT0tMSxiJiYoYT1UYShiLGMsZCxlKSksKGM9LTE8YT9iW2FdOm51bGwpJiZnYihjKSk7fVxuZnVuY3Rpb24gZ2IoYSl7aWYoXCJudW1iZXJcIiE9PXR5cGVvZiBhJiZhJiYhYS5mYSl7dmFyIGI9YS5zcmM7aWYoYiYmYltIYV0pVWEoYi5pLGEpO2Vsc2Uge3ZhciBjPWEudHlwZSxkPWEucHJveHk7Yi5yZW1vdmVFdmVudExpc3RlbmVyP2IucmVtb3ZlRXZlbnRMaXN0ZW5lcihjLGQsYS5jYXB0dXJlKTpiLmRldGFjaEV2ZW50P2IuZGV0YWNoRXZlbnQoZGIoYyksZCk6Yi5hZGRMaXN0ZW5lciYmYi5yZW1vdmVMaXN0ZW5lciYmYi5yZW1vdmVMaXN0ZW5lcihkKTsoYz1iYihiKSk/KFVhKGMsYSksMD09Yy5oJiYoYy5zcmM9bnVsbCxiW1ZhXT1udWxsKSk6S2EoYSk7fX19ZnVuY3Rpb24gZGIoYSl7cmV0dXJuIGEgaW4gV2E/V2FbYV06V2FbYV09XCJvblwiK2F9ZnVuY3Rpb24gZWIoYSxiKXtpZihhLmZhKWE9ITA7ZWxzZSB7Yj1uZXcgQShiLHRoaXMpO3ZhciBjPWEubGlzdGVuZXIsZD1hLmxhfHxhLnNyYzthLmlhJiZnYihhKTthPWMuY2FsbChkLGIpO31yZXR1cm4gYX1cbmZ1bmN0aW9uIGJiKGEpe2E9YVtWYV07cmV0dXJuIGEgaW5zdGFuY2VvZiBTYT9hOm51bGx9dmFyIGhiPVwiX19jbG9zdXJlX2V2ZW50c19mbl9cIisoMUU5Kk1hdGgucmFuZG9tKCk+Pj4wKTtmdW5jdGlvbiAkYShhKXtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgYSlyZXR1cm4gYTthW2hiXXx8KGFbaGJdPWZ1bmN0aW9uKGIpe3JldHVybiBhLmhhbmRsZUV2ZW50KGIpfSk7cmV0dXJuIGFbaGJdfWZ1bmN0aW9uIEIoKXt2LmNhbGwodGhpcyk7dGhpcy5pPW5ldyBTYSh0aGlzKTt0aGlzLlM9dGhpczt0aGlzLko9bnVsbDt9cihCLHYpO0IucHJvdG90eXBlW0hhXT0hMDtCLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjLGQpe2ZiKHRoaXMsYSxiLGMsZCk7fTtcbmZ1bmN0aW9uIEMoYSxiKXt2YXIgYyxkPWEuSjtpZihkKWZvcihjPVtdO2Q7ZD1kLkopYy5wdXNoKGQpO2E9YS5TO2Q9Yi50eXBlfHxiO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYiliPW5ldyB3KGIsYSk7ZWxzZSBpZihiIGluc3RhbmNlb2YgdyliLnRhcmdldD1iLnRhcmdldHx8YTtlbHNlIHt2YXIgZT1iO2I9bmV3IHcoZCxhKTtSYShiLGUpO31lPSEwO2lmKGMpZm9yKHZhciBmPWMubGVuZ3RoLTE7MDw9ZjtmLS0pe3ZhciBoPWIuZz1jW2ZdO2U9aWIoaCxkLCEwLGIpJiZlO31oPWIuZz1hO2U9aWIoaCxkLCEwLGIpJiZlO2U9aWIoaCxkLCExLGIpJiZlO2lmKGMpZm9yKGY9MDtmPGMubGVuZ3RoO2YrKyloPWIuZz1jW2ZdLGU9aWIoaCxkLCExLGIpJiZlO31cbkIucHJvdG90eXBlLk49ZnVuY3Rpb24oKXtCLiQuTi5jYWxsKHRoaXMpO2lmKHRoaXMuaSl7dmFyIGE9dGhpcy5pLGM7Zm9yKGMgaW4gYS5nKXtmb3IodmFyIGQ9YS5nW2NdLGU9MDtlPGQubGVuZ3RoO2UrKylLYShkW2VdKTtkZWxldGUgYS5nW2NdO2EuaC0tO319dGhpcy5KPW51bGw7fTtCLnByb3RvdHlwZS5PPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmkuYWRkKFN0cmluZyhhKSxiLCExLGMsZCl9O0IucHJvdG90eXBlLlA9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMuaS5hZGQoU3RyaW5nKGEpLGIsITAsYyxkKX07XG5mdW5jdGlvbiBpYihhLGIsYyxkKXtiPWEuaS5nW1N0cmluZyhiKV07aWYoIWIpcmV0dXJuICEwO2I9Yi5jb25jYXQoKTtmb3IodmFyIGU9ITAsZj0wO2Y8Yi5sZW5ndGg7KytmKXt2YXIgaD1iW2ZdO2lmKGgmJiFoLmZhJiZoLmNhcHR1cmU9PWMpe3ZhciBuPWgubGlzdGVuZXIsdD1oLmxhfHxoLnNyYztoLmlhJiZVYShhLmksaCk7ZT0hMSE9PW4uY2FsbCh0LGQpJiZlO319cmV0dXJuIGUmJiFkLmRlZmF1bHRQcmV2ZW50ZWR9dmFyIGpiPWwuSlNPTi5zdHJpbmdpZnk7Y2xhc3Mga2J7Y29uc3RydWN0b3IoYSxiKXt0aGlzLmk9YTt0aGlzLmo9Yjt0aGlzLmg9MDt0aGlzLmc9bnVsbDt9Z2V0KCl7bGV0IGE7MDx0aGlzLmg/KHRoaXMuaC0tLGE9dGhpcy5nLHRoaXMuZz1hLm5leHQsYS5uZXh0PW51bGwpOmE9dGhpcy5pKCk7cmV0dXJuIGF9fWZ1bmN0aW9uIGxiKCl7dmFyIGE9bWI7bGV0IGI9bnVsbDthLmcmJihiPWEuZyxhLmc9YS5nLm5leHQsYS5nfHwoYS5oPW51bGwpLGIubmV4dD1udWxsKTtyZXR1cm4gYn1jbGFzcyBuYntjb25zdHJ1Y3Rvcigpe3RoaXMuaD10aGlzLmc9bnVsbDt9YWRkKGEsYil7Y29uc3QgYz1vYi5nZXQoKTtjLnNldChhLGIpO3RoaXMuaD90aGlzLmgubmV4dD1jOnRoaXMuZz1jO3RoaXMuaD1jO319dmFyIG9iPW5ldyBrYigoKT0+bmV3IHBiLGE9PmEucmVzZXQoKSk7Y2xhc3MgcGJ7Y29uc3RydWN0b3IoKXt0aGlzLm5leHQ9dGhpcy5nPXRoaXMuaD1udWxsO31zZXQoYSxiKXt0aGlzLmg9YTt0aGlzLmc9Yjt0aGlzLm5leHQ9bnVsbDt9cmVzZXQoKXt0aGlzLm5leHQ9dGhpcy5nPXRoaXMuaD1udWxsO319ZnVuY3Rpb24gcWIoYSl7dmFyIGI9MTthPWEuc3BsaXQoXCI6XCIpO2NvbnN0IGM9W107Zm9yKDswPGImJmEubGVuZ3RoOyljLnB1c2goYS5zaGlmdCgpKSxiLS07YS5sZW5ndGgmJmMucHVzaChhLmpvaW4oXCI6XCIpKTtyZXR1cm4gY31mdW5jdGlvbiByYihhKXtsLnNldFRpbWVvdXQoKCk9Pnt0aHJvdyBhO30sMCk7fWxldCBzYix0Yj0hMSxtYj1uZXcgbmIsdmI9KCk9Pntjb25zdCBhPWwuUHJvbWlzZS5yZXNvbHZlKHZvaWQgMCk7c2I9KCk9PnthLnRoZW4odWIpO307fTt2YXIgdWI9KCk9Pntmb3IodmFyIGE7YT1sYigpOyl7dHJ5e2EuaC5jYWxsKGEuZyk7fWNhdGNoKGMpe3JiKGMpO312YXIgYj1vYjtiLmooYSk7MTAwPmIuaCYmKGIuaCsrLGEubmV4dD1iLmcsYi5nPWEpO310Yj0hMTt9O2Z1bmN0aW9uIHdiKGEsYil7Qi5jYWxsKHRoaXMpO3RoaXMuaD1hfHwxO3RoaXMuZz1ifHxsO3RoaXMuaj1xKHRoaXMucWIsdGhpcyk7dGhpcy5sPURhdGUubm93KCk7fXIod2IsQik7az13Yi5wcm90b3R5cGU7ay5nYT0hMTtrLlQ9bnVsbDtrLnFiPWZ1bmN0aW9uKCl7aWYodGhpcy5nYSl7dmFyIGE9RGF0ZS5ub3coKS10aGlzLmw7MDxhJiZhPC44KnRoaXMuaD90aGlzLlQ9dGhpcy5nLnNldFRpbWVvdXQodGhpcy5qLHRoaXMuaC1hKToodGhpcy5UJiYodGhpcy5nLmNsZWFyVGltZW91dCh0aGlzLlQpLHRoaXMuVD1udWxsKSxDKHRoaXMsXCJ0aWNrXCIpLHRoaXMuZ2EmJih4Yih0aGlzKSx0aGlzLnN0YXJ0KCkpKTt9fTtrLnN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5nYT0hMDt0aGlzLlR8fCh0aGlzLlQ9dGhpcy5nLnNldFRpbWVvdXQodGhpcy5qLHRoaXMuaCksdGhpcy5sPURhdGUubm93KCkpO307XG5mdW5jdGlvbiB4YihhKXthLmdhPSExO2EuVCYmKGEuZy5jbGVhclRpbWVvdXQoYS5UKSxhLlQ9bnVsbCk7fWsuTj1mdW5jdGlvbigpe3diLiQuTi5jYWxsKHRoaXMpO3hiKHRoaXMpO2RlbGV0ZSB0aGlzLmc7fTtmdW5jdGlvbiB5YihhLGIsYyl7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGEpYyYmKGE9cShhLGMpKTtlbHNlIGlmKGEmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuaGFuZGxlRXZlbnQpYT1xKGEuaGFuZGxlRXZlbnQsYSk7ZWxzZSB0aHJvdyBFcnJvcihcIkludmFsaWQgbGlzdGVuZXIgYXJndW1lbnRcIik7cmV0dXJuIDIxNDc0ODM2NDc8TnVtYmVyKGIpPy0xOmwuc2V0VGltZW91dChhLGJ8fDApfWZ1bmN0aW9uIHpiKGEpe2EuZz15YigoKT0+e2EuZz1udWxsO2EuaSYmKGEuaT0hMSx6YihhKSk7fSxhLmopO2NvbnN0IGI9YS5oO2EuaD1udWxsO2EubS5hcHBseShudWxsLGIpO31jbGFzcyBBYiBleHRlbmRzIHZ7Y29uc3RydWN0b3IoYSxiKXtzdXBlcigpO3RoaXMubT1hO3RoaXMuaj1iO3RoaXMuaD1udWxsO3RoaXMuaT0hMTt0aGlzLmc9bnVsbDt9bChhKXt0aGlzLmg9YXJndW1lbnRzO3RoaXMuZz90aGlzLmk9ITA6emIodGhpcyk7fU4oKXtzdXBlci5OKCk7dGhpcy5nJiYobC5jbGVhclRpbWVvdXQodGhpcy5nKSx0aGlzLmc9bnVsbCx0aGlzLmk9ITEsdGhpcy5oPW51bGwpO319ZnVuY3Rpb24gQmIoYSl7di5jYWxsKHRoaXMpO3RoaXMuaD1hO3RoaXMuZz17fTt9cihCYix2KTt2YXIgQ2I9W107ZnVuY3Rpb24gRGIoYSxiLGMsZCl7QXJyYXkuaXNBcnJheShjKXx8KGMmJihDYlswXT1jLnRvU3RyaW5nKCkpLGM9Q2IpO2Zvcih2YXIgZT0wO2U8Yy5sZW5ndGg7ZSsrKXt2YXIgZj1ZYShiLGNbZV0sZHx8YS5oYW5kbGVFdmVudCwhMSxhLmh8fGEpO2lmKCFmKWJyZWFrO2EuZ1tmLmtleV09Zjt9fWZ1bmN0aW9uIEZiKGEpe05hKGEuZyxmdW5jdGlvbihiLGMpe3RoaXMuZy5oYXNPd25Qcm9wZXJ0eShjKSYmZ2IoYik7fSxhKTthLmc9e307fUJiLnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7QmIuJC5OLmNhbGwodGhpcyk7RmIodGhpcyk7fTtCYi5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcihcIkV2ZW50SGFuZGxlci5oYW5kbGVFdmVudCBub3QgaW1wbGVtZW50ZWRcIik7fTtmdW5jdGlvbiBHYigpe3RoaXMuZz0hMDt9R2IucHJvdG90eXBlLkVhPWZ1bmN0aW9uKCl7dGhpcy5nPSExO307ZnVuY3Rpb24gSGIoYSxiLGMsZCxlLGYpe2EuaW5mbyhmdW5jdGlvbigpe2lmKGEuZylpZihmKXt2YXIgaD1cIlwiO2Zvcih2YXIgbj1mLnNwbGl0KFwiJlwiKSx0PTA7dDxuLmxlbmd0aDt0Kyspe3ZhciBtPW5bdF0uc3BsaXQoXCI9XCIpO2lmKDE8bS5sZW5ndGgpe3ZhciB1PW1bMF07bT1tWzFdO3ZhciBMPXUuc3BsaXQoXCJfXCIpO2g9Mjw9TC5sZW5ndGgmJlwidHlwZVwiPT1MWzFdP2grKHUrXCI9XCIrbStcIiZcIik6aCsodStcIj1yZWRhY3RlZCZcIik7fX19ZWxzZSBoPW51bGw7ZWxzZSBoPWY7cmV0dXJuIFwiWE1MSFRUUCBSRVEgKFwiK2QrXCIpIFthdHRlbXB0IFwiK2UrXCJdOiBcIitiK1wiXFxuXCIrYytcIlxcblwiK2h9KTt9XG5mdW5jdGlvbiBJYihhLGIsYyxkLGUsZixoKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJYTUxIVFRQIFJFU1AgKFwiK2QrXCIpIFsgYXR0ZW1wdCBcIitlK1wiXTogXCIrYitcIlxcblwiK2MrXCJcXG5cIitmK1wiIFwiK2h9KTt9ZnVuY3Rpb24gRChhLGIsYyxkKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJYTUxIVFRQIFRFWFQgKFwiK2IrXCIpOiBcIitKYihhLGMpKyhkP1wiIFwiK2Q6XCJcIil9KTt9ZnVuY3Rpb24gS2IoYSxiKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJUSU1FT1VUOiBcIitifSk7fUdiLnByb3RvdHlwZS5pbmZvPWZ1bmN0aW9uKCl7fTtcbmZ1bmN0aW9uIEpiKGEsYil7aWYoIWEuZylyZXR1cm4gYjtpZighYilyZXR1cm4gbnVsbDt0cnl7dmFyIGM9SlNPTi5wYXJzZShiKTtpZihjKWZvcihhPTA7YTxjLmxlbmd0aDthKyspaWYoQXJyYXkuaXNBcnJheShjW2FdKSl7dmFyIGQ9Y1thXTtpZighKDI+ZC5sZW5ndGgpKXt2YXIgZT1kWzFdO2lmKEFycmF5LmlzQXJyYXkoZSkmJiEoMT5lLmxlbmd0aCkpe3ZhciBmPWVbMF07aWYoXCJub29wXCIhPWYmJlwic3RvcFwiIT1mJiZcImNsb3NlXCIhPWYpZm9yKHZhciBoPTE7aDxlLmxlbmd0aDtoKyspZVtoXT1cIlwiO319fXJldHVybiBqYihjKX1jYXRjaChuKXtyZXR1cm4gYn19dmFyIEU9e30sTGI9bnVsbDtmdW5jdGlvbiBNYigpe3JldHVybiBMYj1MYnx8bmV3IEJ9RS5UYT1cInNlcnZlcnJlYWNoYWJpbGl0eVwiO2Z1bmN0aW9uIE5iKGEpe3cuY2FsbCh0aGlzLEUuVGEsYSk7fXIoTmIsdyk7ZnVuY3Rpb24gT2IoYSl7Y29uc3QgYj1NYigpO0MoYixuZXcgTmIoYikpO31FLlNUQVRfRVZFTlQ9XCJzdGF0ZXZlbnRcIjtmdW5jdGlvbiBQYihhLGIpe3cuY2FsbCh0aGlzLEUuU1RBVF9FVkVOVCxhKTt0aGlzLnN0YXQ9Yjt9cihQYix3KTtmdW5jdGlvbiBGKGEpe2NvbnN0IGI9TWIoKTtDKGIsbmV3IFBiKGIsYSkpO31FLlVhPVwidGltaW5nZXZlbnRcIjtmdW5jdGlvbiBRYihhLGIpe3cuY2FsbCh0aGlzLEUuVWEsYSk7dGhpcy5zaXplPWI7fXIoUWIsdyk7XG5mdW5jdGlvbiBSYihhLGIpe2lmKFwiZnVuY3Rpb25cIiE9PXR5cGVvZiBhKXRocm93IEVycm9yKFwiRm4gbXVzdCBub3QgYmUgbnVsbCBhbmQgbXVzdCBiZSBhIGZ1bmN0aW9uXCIpO3JldHVybiBsLnNldFRpbWVvdXQoZnVuY3Rpb24oKXthKCk7fSxiKX12YXIgU2I9e05PX0VSUk9SOjAscmI6MSxFYjoyLERiOjMseWI6NCxDYjo1LEZiOjYsUWE6NyxUSU1FT1VUOjgsSWI6OX07dmFyIFRiPXt3YjpcImNvbXBsZXRlXCIsU2I6XCJzdWNjZXNzXCIsUmE6XCJlcnJvclwiLFFhOlwiYWJvcnRcIixLYjpcInJlYWR5XCIsTGI6XCJyZWFkeXN0YXRlY2hhbmdlXCIsVElNRU9VVDpcInRpbWVvdXRcIixHYjpcImluY3JlbWVudGFsZGF0YVwiLEpiOlwicHJvZ3Jlc3NcIix6YjpcImRvd25sb2FkcHJvZ3Jlc3NcIiwkYjpcInVwbG9hZHByb2dyZXNzXCJ9O2Z1bmN0aW9uIFViKCl7fVViLnByb3RvdHlwZS5oPW51bGw7ZnVuY3Rpb24gVmIoYSl7cmV0dXJuIGEuaHx8KGEuaD1hLmkoKSl9ZnVuY3Rpb24gV2IoKXt9dmFyIFhiPXtPUEVOOlwiYVwiLHZiOlwiYlwiLFJhOlwiY1wiLEhiOlwiZFwifTtmdW5jdGlvbiBZYigpe3cuY2FsbCh0aGlzLFwiZFwiKTt9cihZYix3KTtmdW5jdGlvbiBaYigpe3cuY2FsbCh0aGlzLFwiY1wiKTt9cihaYix3KTt2YXIgJGI7ZnVuY3Rpb24gYWMoKXt9cihhYyxVYik7YWMucHJvdG90eXBlLmc9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0fTthYy5wcm90b3R5cGUuaT1mdW5jdGlvbigpe3JldHVybiB7fX07JGI9bmV3IGFjO2Z1bmN0aW9uIGJjKGEsYixjLGQpe3RoaXMubD1hO3RoaXMuaj1iO3RoaXMubT1jO3RoaXMuVz1kfHwxO3RoaXMuVT1uZXcgQmIodGhpcyk7dGhpcy5QPWNjO2E9dmE/MTI1OnZvaWQgMDt0aGlzLlY9bmV3IHdiKGEpO3RoaXMuST1udWxsO3RoaXMuaT0hMTt0aGlzLnM9dGhpcy5BPXRoaXMudj10aGlzLkw9dGhpcy5HPXRoaXMuWT10aGlzLkI9bnVsbDt0aGlzLkY9W107dGhpcy5nPW51bGw7dGhpcy5DPTA7dGhpcy5vPXRoaXMudT1udWxsO3RoaXMuY2E9LTE7dGhpcy5KPSExO3RoaXMuTz0wO3RoaXMuTT1udWxsO3RoaXMuYmE9dGhpcy5LPXRoaXMuYWE9dGhpcy5TPSExO3RoaXMuaD1uZXcgZGM7fWZ1bmN0aW9uIGRjKCl7dGhpcy5pPW51bGw7dGhpcy5nPVwiXCI7dGhpcy5oPSExO312YXIgY2M9NDVFMyxlYz17fSxmYz17fTtrPWJjLnByb3RvdHlwZTtrLnNldFRpbWVvdXQ9ZnVuY3Rpb24oYSl7dGhpcy5QPWE7fTtcbmZ1bmN0aW9uIGdjKGEsYixjKXthLkw9MTthLnY9aGMoRyhiKSk7YS5zPWM7YS5TPSEwO2ljKGEsbnVsbCk7fWZ1bmN0aW9uIGljKGEsYil7YS5HPURhdGUubm93KCk7amMoYSk7YS5BPUcoYS52KTt2YXIgYz1hLkEsZD1hLlc7QXJyYXkuaXNBcnJheShkKXx8KGQ9W1N0cmluZyhkKV0pO2tjKGMuaSxcInRcIixkKTthLkM9MDtjPWEubC5KO2EuaD1uZXcgZGM7YS5nPWxjKGEubCxjP2I6bnVsbCwhYS5zKTswPGEuTyYmKGEuTT1uZXcgQWIocShhLlBhLGEsYS5nKSxhLk8pKTtEYihhLlUsYS5nLFwicmVhZHlzdGF0ZWNoYW5nZVwiLGEubmIpO2I9YS5JP1BhKGEuSSk6e307YS5zPyhhLnV8fChhLnU9XCJQT1NUXCIpLGJbXCJDb250ZW50LVR5cGVcIl09XCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixhLmcuaGEoYS5BLGEudSxhLnMsYikpOihhLnU9XCJHRVRcIixhLmcuaGEoYS5BLGEudSxudWxsLGIpKTtPYigpO0hiKGEuaixhLnUsYS5BLGEubSxhLlcsYS5zKTt9XG5rLm5iPWZ1bmN0aW9uKGEpe2E9YS50YXJnZXQ7Y29uc3QgYj10aGlzLk07YiYmMz09SChhKT9iLmwoKTp0aGlzLlBhKGEpO307XG5rLlBhPWZ1bmN0aW9uKGEpe3RyeXtpZihhPT10aGlzLmcpYTp7Y29uc3QgdT1IKHRoaXMuZyk7dmFyIGI9dGhpcy5nLklhKCk7Y29uc3QgTD10aGlzLmcuZGEoKTtpZighKDM+dSkmJigzIT11fHx2YXx8dGhpcy5nJiYodGhpcy5oLmh8fHRoaXMuZy5qYSgpfHxtYyh0aGlzLmcpKSkpe3RoaXMuSnx8NCE9dXx8Nz09Ynx8KDg9PWJ8fDA+PUw/T2IoMyk6T2IoMikpO25jKHRoaXMpO3ZhciBjPXRoaXMuZy5kYSgpO3RoaXMuY2E9YztiOmlmKG9jKHRoaXMpKXt2YXIgZD1tYyh0aGlzLmcpO2E9XCJcIjt2YXIgZT1kLmxlbmd0aCxmPTQ9PUgodGhpcy5nKTtpZighdGhpcy5oLmkpe2lmKFwidW5kZWZpbmVkXCI9PT10eXBlb2YgVGV4dERlY29kZXIpe0kodGhpcyk7cGModGhpcyk7dmFyIGg9XCJcIjticmVhayBifXRoaXMuaC5pPW5ldyBsLlRleHREZWNvZGVyO31mb3IoYj0wO2I8ZTtiKyspdGhpcy5oLmg9ITAsYSs9dGhpcy5oLmkuZGVjb2RlKGRbYl0se3N0cmVhbTpmJiZiPT1lLTF9KTtkLnNwbGljZSgwLFxuZSk7dGhpcy5oLmcrPWE7dGhpcy5DPTA7aD10aGlzLmguZzt9ZWxzZSBoPXRoaXMuZy5qYSgpO3RoaXMuaT0yMDA9PWM7SWIodGhpcy5qLHRoaXMudSx0aGlzLkEsdGhpcy5tLHRoaXMuVyx1LGMpO2lmKHRoaXMuaSl7aWYodGhpcy5hYSYmIXRoaXMuSyl7Yjp7aWYodGhpcy5nKXt2YXIgbix0PXRoaXMuZztpZigobj10Lmc/dC5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1IVFRQLUluaXRpYWwtUmVzcG9uc2VcIik6bnVsbCkmJiF4KG4pKXt2YXIgbT1uO2JyZWFrIGJ9fW09bnVsbDt9aWYoYz1tKUQodGhpcy5qLHRoaXMubSxjLFwiSW5pdGlhbCBoYW5kc2hha2UgcmVzcG9uc2UgdmlhIFgtSFRUUC1Jbml0aWFsLVJlc3BvbnNlXCIpLHRoaXMuSz0hMCxxYyh0aGlzLGMpO2Vsc2Uge3RoaXMuaT0hMTt0aGlzLm89MztGKDEyKTtJKHRoaXMpO3BjKHRoaXMpO2JyZWFrIGF9fXRoaXMuUz8ocmModGhpcyx1LGgpLHZhJiZ0aGlzLmkmJjM9PXUmJihEYih0aGlzLlUsdGhpcy5WLFwidGlja1wiLHRoaXMubWIpLFxudGhpcy5WLnN0YXJ0KCkpKTooRCh0aGlzLmosdGhpcy5tLGgsbnVsbCkscWModGhpcyxoKSk7ND09dSYmSSh0aGlzKTt0aGlzLmkmJiF0aGlzLkomJig0PT11P3NjKHRoaXMubCx0aGlzKToodGhpcy5pPSExLGpjKHRoaXMpKSk7fWVsc2UgdGModGhpcy5nKSw0MDA9PWMmJjA8aC5pbmRleE9mKFwiVW5rbm93biBTSURcIik/KHRoaXMubz0zLEYoMTIpKToodGhpcy5vPTAsRigxMykpLEkodGhpcykscGModGhpcyk7fX19Y2F0Y2godSl7fWZpbmFsbHl7fX07ZnVuY3Rpb24gb2MoYSl7cmV0dXJuIGEuZz9cIkdFVFwiPT1hLnUmJjIhPWEuTCYmYS5sLkhhOiExfVxuZnVuY3Rpb24gcmMoYSxiLGMpe2xldCBkPSEwLGU7Zm9yKDshYS5KJiZhLkM8Yy5sZW5ndGg7KWlmKGU9dWMoYSxjKSxlPT1mYyl7ND09YiYmKGEubz00LEYoMTQpLGQ9ITEpO0QoYS5qLGEubSxudWxsLFwiW0luY29tcGxldGUgUmVzcG9uc2VdXCIpO2JyZWFrfWVsc2UgaWYoZT09ZWMpe2Eubz00O0YoMTUpO0QoYS5qLGEubSxjLFwiW0ludmFsaWQgQ2h1bmtdXCIpO2Q9ITE7YnJlYWt9ZWxzZSBEKGEuaixhLm0sZSxudWxsKSxxYyhhLGUpO29jKGEpJiZlIT1mYyYmZSE9ZWMmJihhLmguZz1cIlwiLGEuQz0wKTs0IT1ifHwwIT1jLmxlbmd0aHx8YS5oLmh8fChhLm89MSxGKDE2KSxkPSExKTthLmk9YS5pJiZkO2Q/MDxjLmxlbmd0aCYmIWEuYmEmJihhLmJhPSEwLGI9YS5sLGIuZz09YSYmYi5jYSYmIWIuTSYmKGIubC5pbmZvKFwiR3JlYXQsIG5vIGJ1ZmZlcmluZyBwcm94eSBkZXRlY3RlZC4gQnl0ZXMgcmVjZWl2ZWQ6IFwiK2MubGVuZ3RoKSx2YyhiKSxiLk09ITAsRigxMSkpKTooRChhLmosYS5tLFxuYyxcIltJbnZhbGlkIENodW5rZWQgUmVzcG9uc2VdXCIpLEkoYSkscGMoYSkpO31rLm1iPWZ1bmN0aW9uKCl7aWYodGhpcy5nKXt2YXIgYT1IKHRoaXMuZyksYj10aGlzLmcuamEoKTt0aGlzLkM8Yi5sZW5ndGgmJihuYyh0aGlzKSxyYyh0aGlzLGEsYiksdGhpcy5pJiY0IT1hJiZqYyh0aGlzKSk7fX07ZnVuY3Rpb24gdWMoYSxiKXt2YXIgYz1hLkMsZD1iLmluZGV4T2YoXCJcXG5cIixjKTtpZigtMT09ZClyZXR1cm4gZmM7Yz1OdW1iZXIoYi5zdWJzdHJpbmcoYyxkKSk7aWYoaXNOYU4oYykpcmV0dXJuIGVjO2QrPTE7aWYoZCtjPmIubGVuZ3RoKXJldHVybiBmYztiPWIuc2xpY2UoZCxkK2MpO2EuQz1kK2M7cmV0dXJuIGJ9ay5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLko9ITA7SSh0aGlzKTt9O2Z1bmN0aW9uIGpjKGEpe2EuWT1EYXRlLm5vdygpK2EuUDt3YyhhLGEuUCk7fVxuZnVuY3Rpb24gd2MoYSxiKXtpZihudWxsIT1hLkIpdGhyb3cgRXJyb3IoXCJXYXRjaERvZyB0aW1lciBub3QgbnVsbFwiKTthLkI9UmIocShhLmxiLGEpLGIpO31mdW5jdGlvbiBuYyhhKXthLkImJihsLmNsZWFyVGltZW91dChhLkIpLGEuQj1udWxsKTt9ay5sYj1mdW5jdGlvbigpe3RoaXMuQj1udWxsO2NvbnN0IGE9RGF0ZS5ub3coKTswPD1hLXRoaXMuWT8oS2IodGhpcy5qLHRoaXMuQSksMiE9dGhpcy5MJiYoT2IoKSxGKDE3KSksSSh0aGlzKSx0aGlzLm89MixwYyh0aGlzKSk6d2ModGhpcyx0aGlzLlktYSk7fTtmdW5jdGlvbiBwYyhhKXswPT1hLmwuSHx8YS5KfHxzYyhhLmwsYSk7fWZ1bmN0aW9uIEkoYSl7bmMoYSk7dmFyIGI9YS5NO2ImJlwiZnVuY3Rpb25cIj09dHlwZW9mIGIuc2EmJmIuc2EoKTthLk09bnVsbDt4YihhLlYpO0ZiKGEuVSk7YS5nJiYoYj1hLmcsYS5nPW51bGwsYi5hYm9ydCgpLGIuc2EoKSk7fVxuZnVuY3Rpb24gcWMoYSxiKXt0cnl7dmFyIGM9YS5sO2lmKDAhPWMuSCYmKGMuZz09YXx8eGMoYy5pLGEpKSlpZighYS5LJiZ4YyhjLmksYSkmJjM9PWMuSCl7dHJ5e3ZhciBkPWMuSmEuZy5wYXJzZShiKTt9Y2F0Y2gobSl7ZD1udWxsO31pZihBcnJheS5pc0FycmF5KGQpJiYzPT1kLmxlbmd0aCl7dmFyIGU9ZDtpZigwPT1lWzBdKWE6e2lmKCFjLnUpe2lmKGMuZylpZihjLmcuRyszRTM8YS5HKXljKGMpLHpjKGMpO2Vsc2UgYnJlYWsgYTtBYyhjKTtGKDE4KTt9fWVsc2UgYy5GYT1lWzFdLDA8Yy5GYS1jLlYmJjM3NTAwPmVbMl0mJmMuRyYmMD09Yy5BJiYhYy52JiYoYy52PVJiKHEoYy5pYixjKSw2RTMpKTtpZigxPj1CYyhjLmkpJiZjLm9hKXt0cnl7Yy5vYSgpO31jYXRjaChtKXt9Yy5vYT12b2lkIDA7fX1lbHNlIEooYywxMSk7fWVsc2UgaWYoKGEuS3x8Yy5nPT1hKSYmeWMoYyksIXgoYikpZm9yKGU9Yy5KYS5nLnBhcnNlKGIpLGI9MDtiPGUubGVuZ3RoO2IrKyl7bGV0IG09ZVtiXTtjLlY9XG5tWzBdO209bVsxXTtpZigyPT1jLkgpaWYoXCJjXCI9PW1bMF0pe2MuSz1tWzFdO2MucGE9bVsyXTtjb25zdCB1PW1bM107bnVsbCE9dSYmKGMucmE9dSxjLmwuaW5mbyhcIlZFUj1cIitjLnJhKSk7Y29uc3QgTD1tWzRdO251bGwhPUwmJihjLkdhPUwsYy5sLmluZm8oXCJTVkVSPVwiK2MuR2EpKTtjb25zdCBMYT1tWzVdO251bGwhPUxhJiZcIm51bWJlclwiPT09dHlwZW9mIExhJiYwPExhJiYoZD0xLjUqTGEsYy5MPWQsYy5sLmluZm8oXCJiYWNrQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXNfPVwiK2QpKTtkPWM7Y29uc3QgbGE9YS5nO2lmKGxhKXtjb25zdCBNYT1sYS5nP2xhLmcuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLUNsaWVudC1XaXJlLVByb3RvY29sXCIpOm51bGw7aWYoTWEpe3ZhciBmPWQuaTtmLmd8fC0xPT1NYS5pbmRleE9mKFwic3BkeVwiKSYmLTE9PU1hLmluZGV4T2YoXCJxdWljXCIpJiYtMT09TWEuaW5kZXhPZihcImgyXCIpfHwoZi5qPWYubCxmLmc9bmV3IFNldCxmLmgmJihDYyhmLGYuaCksZi5oPW51bGwpKTt9aWYoZC5GKXtjb25zdCBFYj1cbmxhLmc/bGEuZy5nZXRSZXNwb25zZUhlYWRlcihcIlgtSFRUUC1TZXNzaW9uLUlkXCIpOm51bGw7RWImJihkLkRhPUViLEsoZC5JLGQuRixFYikpO319Yy5IPTM7Yy5oJiZjLmguQmEoKTtjLmNhJiYoYy5TPURhdGUubm93KCktYS5HLGMubC5pbmZvKFwiSGFuZHNoYWtlIFJUVDogXCIrYy5TK1wibXNcIikpO2Q9Yzt2YXIgaD1hO2Qud2E9RGMoZCxkLko/ZC5wYTpudWxsLGQuWSk7aWYoaC5LKXtFYyhkLmksaCk7dmFyIG49aCx0PWQuTDt0JiZuLnNldFRpbWVvdXQodCk7bi5CJiYobmMobiksamMobikpO2QuZz1oO31lbHNlIEZjKGQpOzA8Yy5qLmxlbmd0aCYmR2MoYyk7fWVsc2UgXCJzdG9wXCIhPW1bMF0mJlwiY2xvc2VcIiE9bVswXXx8SihjLDcpO2Vsc2UgMz09Yy5IJiYoXCJzdG9wXCI9PW1bMF18fFwiY2xvc2VcIj09bVswXT9cInN0b3BcIj09bVswXT9KKGMsNyk6SGMoYyk6XCJub29wXCIhPW1bMF0mJmMuaCYmYy5oLkFhKG0pLGMuQT0wKTt9T2IoNCk7fWNhdGNoKG0pe319ZnVuY3Rpb24gSWMoYSl7aWYoYS5aJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLlopcmV0dXJuIGEuWigpO2lmKFwidW5kZWZpbmVkXCIhPT10eXBlb2YgTWFwJiZhIGluc3RhbmNlb2YgTWFwfHxcInVuZGVmaW5lZFwiIT09dHlwZW9mIFNldCYmYSBpbnN0YW5jZW9mIFNldClyZXR1cm4gQXJyYXkuZnJvbShhLnZhbHVlcygpKTtpZihcInN0cmluZ1wiPT09dHlwZW9mIGEpcmV0dXJuIGEuc3BsaXQoXCJcIik7aWYoYWEoYSkpe2Zvcih2YXIgYj1bXSxjPWEubGVuZ3RoLGQ9MDtkPGM7ZCsrKWIucHVzaChhW2RdKTtyZXR1cm4gYn1iPVtdO2M9MDtmb3IoZCBpbiBhKWJbYysrXT1hW2RdO3JldHVybiBifVxuZnVuY3Rpb24gSmMoYSl7aWYoYS50YSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYS50YSlyZXR1cm4gYS50YSgpO2lmKCFhLlp8fFwiZnVuY3Rpb25cIiE9dHlwZW9mIGEuWil7aWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBNYXAmJmEgaW5zdGFuY2VvZiBNYXApcmV0dXJuIEFycmF5LmZyb20oYS5rZXlzKCkpO2lmKCEoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBTZXQmJmEgaW5zdGFuY2VvZiBTZXQpKXtpZihhYShhKXx8XCJzdHJpbmdcIj09PXR5cGVvZiBhKXt2YXIgYj1bXTthPWEubGVuZ3RoO2Zvcih2YXIgYz0wO2M8YTtjKyspYi5wdXNoKGMpO3JldHVybiBifWI9W107Yz0wO2Zvcihjb25zdCBkIGluIGEpYltjKytdPWQ7cmV0dXJuIGJ9fX1cbmZ1bmN0aW9uIEtjKGEsYil7aWYoYS5mb3JFYWNoJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLmZvckVhY2gpYS5mb3JFYWNoKGIsdm9pZCAwKTtlbHNlIGlmKGFhKGEpfHxcInN0cmluZ1wiPT09dHlwZW9mIGEpQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChhLGIsdm9pZCAwKTtlbHNlIGZvcih2YXIgYz1KYyhhKSxkPUljKGEpLGU9ZC5sZW5ndGgsZj0wO2Y8ZTtmKyspYi5jYWxsKHZvaWQgMCxkW2ZdLGMmJmNbZl0sYSk7fXZhciBMYz1SZWdFeHAoXCJeKD86KFteOi8/Iy5dKyk6KT8oPzovLyg/OihbXlxcXFxcXFxcLz8jXSopQCk/KFteXFxcXFxcXFwvPyNdKj8pKD86OihbMC05XSspKT8oPz1bXFxcXFxcXFwvPyNdfCQpKT8oW14/I10rKT8oPzpcXFxcPyhbXiNdKikpPyg/OiMoW1xcXFxzXFxcXFNdKikpPyRcIik7ZnVuY3Rpb24gTWMoYSxiKXtpZihhKXthPWEuc3BsaXQoXCImXCIpO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7YysrKXt2YXIgZD1hW2NdLmluZGV4T2YoXCI9XCIpLGU9bnVsbDtpZigwPD1kKXt2YXIgZj1hW2NdLnN1YnN0cmluZygwLGQpO2U9YVtjXS5zdWJzdHJpbmcoZCsxKTt9ZWxzZSBmPWFbY107YihmLGU/ZGVjb2RlVVJJQ29tcG9uZW50KGUucmVwbGFjZSgvXFwrL2csXCIgXCIpKTpcIlwiKTt9fX1mdW5jdGlvbiBNKGEpe3RoaXMuZz10aGlzLnM9dGhpcy5qPVwiXCI7dGhpcy5tPW51bGw7dGhpcy5vPXRoaXMubD1cIlwiO3RoaXMuaD0hMTtpZihhIGluc3RhbmNlb2YgTSl7dGhpcy5oPWEuaDtOYyh0aGlzLGEuaik7dGhpcy5zPWEuczt0aGlzLmc9YS5nO09jKHRoaXMsYS5tKTt0aGlzLmw9YS5sO3ZhciBiPWEuaTt2YXIgYz1uZXcgUGM7Yy5pPWIuaTtiLmcmJihjLmc9bmV3IE1hcChiLmcpLGMuaD1iLmgpO1FjKHRoaXMsYyk7dGhpcy5vPWEubzt9ZWxzZSBhJiYoYj1TdHJpbmcoYSkubWF0Y2goTGMpKT8odGhpcy5oPSExLE5jKHRoaXMsYlsxXXx8XCJcIiwhMCksdGhpcy5zPVJjKGJbMl18fFwiXCIpLHRoaXMuZz1SYyhiWzNdfHxcIlwiLCEwKSxPYyh0aGlzLGJbNF0pLHRoaXMubD1SYyhiWzVdfHxcIlwiLCEwKSxRYyh0aGlzLGJbNl18fFwiXCIsITApLHRoaXMubz1SYyhiWzddfHxcIlwiKSk6KHRoaXMuaD0hMSx0aGlzLmk9bmV3IFBjKG51bGwsdGhpcy5oKSk7fVxuTS5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXt2YXIgYT1bXSxiPXRoaXMuajtiJiZhLnB1c2goU2MoYixUYywhMCksXCI6XCIpO3ZhciBjPXRoaXMuZztpZihjfHxcImZpbGVcIj09YilhLnB1c2goXCIvL1wiKSwoYj10aGlzLnMpJiZhLnB1c2goU2MoYixUYywhMCksXCJAXCIpLGEucHVzaChlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGMpKS5yZXBsYWNlKC8lMjUoWzAtOWEtZkEtRl17Mn0pL2csXCIlJDFcIikpLGM9dGhpcy5tLG51bGwhPWMmJmEucHVzaChcIjpcIixTdHJpbmcoYykpO2lmKGM9dGhpcy5sKXRoaXMuZyYmXCIvXCIhPWMuY2hhckF0KDApJiZhLnB1c2goXCIvXCIpLGEucHVzaChTYyhjLFwiL1wiPT1jLmNoYXJBdCgwKT9VYzpWYywhMCkpOyhjPXRoaXMuaS50b1N0cmluZygpKSYmYS5wdXNoKFwiP1wiLGMpOyhjPXRoaXMubykmJmEucHVzaChcIiNcIixTYyhjLFdjKSk7cmV0dXJuIGEuam9pbihcIlwiKX07ZnVuY3Rpb24gRyhhKXtyZXR1cm4gbmV3IE0oYSl9XG5mdW5jdGlvbiBOYyhhLGIsYyl7YS5qPWM/UmMoYiwhMCk6YjthLmomJihhLmo9YS5qLnJlcGxhY2UoLzokLyxcIlwiKSk7fWZ1bmN0aW9uIE9jKGEsYil7aWYoYil7Yj1OdW1iZXIoYik7aWYoaXNOYU4oYil8fDA+Yil0aHJvdyBFcnJvcihcIkJhZCBwb3J0IG51bWJlciBcIitiKTthLm09Yjt9ZWxzZSBhLm09bnVsbDt9ZnVuY3Rpb24gUWMoYSxiLGMpe2IgaW5zdGFuY2VvZiBQYz8oYS5pPWIsWGMoYS5pLGEuaCkpOihjfHwoYj1TYyhiLFljKSksYS5pPW5ldyBQYyhiLGEuaCkpO31mdW5jdGlvbiBLKGEsYixjKXthLmkuc2V0KGIsYyk7fWZ1bmN0aW9uIGhjKGEpe0soYSxcInp4XCIsTWF0aC5mbG9vcigyMTQ3NDgzNjQ4Kk1hdGgucmFuZG9tKCkpLnRvU3RyaW5nKDM2KStNYXRoLmFicyhNYXRoLmZsb29yKDIxNDc0ODM2NDgqTWF0aC5yYW5kb20oKSleRGF0ZS5ub3coKSkudG9TdHJpbmcoMzYpKTtyZXR1cm4gYX1cbmZ1bmN0aW9uIFJjKGEsYil7cmV0dXJuIGE/Yj9kZWNvZGVVUkkoYS5yZXBsYWNlKC8lMjUvZyxcIiUyNTI1XCIpKTpkZWNvZGVVUklDb21wb25lbnQoYSk6XCJcIn1mdW5jdGlvbiBTYyhhLGIsYyl7cmV0dXJuIFwic3RyaW5nXCI9PT10eXBlb2YgYT8oYT1lbmNvZGVVUkkoYSkucmVwbGFjZShiLFpjKSxjJiYoYT1hLnJlcGxhY2UoLyUyNShbMC05YS1mQS1GXXsyfSkvZyxcIiUkMVwiKSksYSk6bnVsbH1mdW5jdGlvbiBaYyhhKXthPWEuY2hhckNvZGVBdCgwKTtyZXR1cm4gXCIlXCIrKGE+PjQmMTUpLnRvU3RyaW5nKDE2KSsoYSYxNSkudG9TdHJpbmcoMTYpfXZhciBUYz0vWyNcXC9cXD9AXS9nLFZjPS9bI1xcPzpdL2csVWM9L1sjXFw/XS9nLFljPS9bI1xcP0BdL2csV2M9LyMvZztmdW5jdGlvbiBQYyhhLGIpe3RoaXMuaD10aGlzLmc9bnVsbDt0aGlzLmk9YXx8bnVsbDt0aGlzLmo9ISFiO31cbmZ1bmN0aW9uIE4oYSl7YS5nfHwoYS5nPW5ldyBNYXAsYS5oPTAsYS5pJiZNYyhhLmksZnVuY3Rpb24oYixjKXthLmFkZChkZWNvZGVVUklDb21wb25lbnQoYi5yZXBsYWNlKC9cXCsvZyxcIiBcIikpLGMpO30pKTt9az1QYy5wcm90b3R5cGU7ay5hZGQ9ZnVuY3Rpb24oYSxiKXtOKHRoaXMpO3RoaXMuaT1udWxsO2E9Tyh0aGlzLGEpO3ZhciBjPXRoaXMuZy5nZXQoYSk7Y3x8dGhpcy5nLnNldChhLGM9W10pO2MucHVzaChiKTt0aGlzLmgrPTE7cmV0dXJuIHRoaXN9O2Z1bmN0aW9uICRjKGEsYil7TihhKTtiPU8oYSxiKTthLmcuaGFzKGIpJiYoYS5pPW51bGwsYS5oLT1hLmcuZ2V0KGIpLmxlbmd0aCxhLmcuZGVsZXRlKGIpKTt9ZnVuY3Rpb24gYWQoYSxiKXtOKGEpO2I9TyhhLGIpO3JldHVybiBhLmcuaGFzKGIpfVxuay5mb3JFYWNoPWZ1bmN0aW9uKGEsYil7Tih0aGlzKTt0aGlzLmcuZm9yRWFjaChmdW5jdGlvbihjLGQpe2MuZm9yRWFjaChmdW5jdGlvbihlKXthLmNhbGwoYixlLGQsdGhpcyk7fSx0aGlzKTt9LHRoaXMpO307ay50YT1mdW5jdGlvbigpe04odGhpcyk7Y29uc3QgYT1BcnJheS5mcm9tKHRoaXMuZy52YWx1ZXMoKSksYj1BcnJheS5mcm9tKHRoaXMuZy5rZXlzKCkpLGM9W107Zm9yKGxldCBkPTA7ZDxiLmxlbmd0aDtkKyspe2NvbnN0IGU9YVtkXTtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyljLnB1c2goYltkXSk7fXJldHVybiBjfTtrLlo9ZnVuY3Rpb24oYSl7Tih0aGlzKTtsZXQgYj1bXTtpZihcInN0cmluZ1wiPT09dHlwZW9mIGEpYWQodGhpcyxhKSYmKGI9Yi5jb25jYXQodGhpcy5nLmdldChPKHRoaXMsYSkpKSk7ZWxzZSB7YT1BcnJheS5mcm9tKHRoaXMuZy52YWx1ZXMoKSk7Zm9yKGxldCBjPTA7YzxhLmxlbmd0aDtjKyspYj1iLmNvbmNhdChhW2NdKTt9cmV0dXJuIGJ9O1xuay5zZXQ9ZnVuY3Rpb24oYSxiKXtOKHRoaXMpO3RoaXMuaT1udWxsO2E9Tyh0aGlzLGEpO2FkKHRoaXMsYSkmJih0aGlzLmgtPXRoaXMuZy5nZXQoYSkubGVuZ3RoKTt0aGlzLmcuc2V0KGEsW2JdKTt0aGlzLmgrPTE7cmV0dXJuIHRoaXN9O2suZ2V0PWZ1bmN0aW9uKGEsYil7aWYoIWEpcmV0dXJuIGI7YT10aGlzLlooYSk7cmV0dXJuIDA8YS5sZW5ndGg/U3RyaW5nKGFbMF0pOmJ9O2Z1bmN0aW9uIGtjKGEsYixjKXskYyhhLGIpOzA8Yy5sZW5ndGgmJihhLmk9bnVsbCxhLmcuc2V0KE8oYSxiKSxtYShjKSksYS5oKz1jLmxlbmd0aCk7fVxuay50b1N0cmluZz1mdW5jdGlvbigpe2lmKHRoaXMuaSlyZXR1cm4gdGhpcy5pO2lmKCF0aGlzLmcpcmV0dXJuIFwiXCI7Y29uc3QgYT1bXSxiPUFycmF5LmZyb20odGhpcy5nLmtleXMoKSk7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspe3ZhciBkPWJbY107Y29uc3QgZj1lbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGQpKSxoPXRoaXMuWihkKTtmb3IoZD0wO2Q8aC5sZW5ndGg7ZCsrKXt2YXIgZT1mO1wiXCIhPT1oW2RdJiYoZSs9XCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhoW2RdKSkpO2EucHVzaChlKTt9fXJldHVybiB0aGlzLmk9YS5qb2luKFwiJlwiKX07ZnVuY3Rpb24gTyhhLGIpe2I9U3RyaW5nKGIpO2EuaiYmKGI9Yi50b0xvd2VyQ2FzZSgpKTtyZXR1cm4gYn1cbmZ1bmN0aW9uIFhjKGEsYil7YiYmIWEuaiYmKE4oYSksYS5pPW51bGwsYS5nLmZvckVhY2goZnVuY3Rpb24oYyxkKXt2YXIgZT1kLnRvTG93ZXJDYXNlKCk7ZCE9ZSYmKCRjKHRoaXMsZCksa2ModGhpcyxlLGMpKTt9LGEpKTthLmo9Yjt9dmFyIGJkPWNsYXNze2NvbnN0cnVjdG9yKGEsYil7dGhpcy5nPWE7dGhpcy5tYXA9Yjt9fTtmdW5jdGlvbiBjZChhKXt0aGlzLmw9YXx8ZGQ7bC5QZXJmb3JtYW5jZU5hdmlnYXRpb25UaW1pbmc/KGE9bC5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKFwibmF2aWdhdGlvblwiKSxhPTA8YS5sZW5ndGgmJihcImhxXCI9PWFbMF0ubmV4dEhvcFByb3RvY29sfHxcImgyXCI9PWFbMF0ubmV4dEhvcFByb3RvY29sKSk6YT0hIShsLmcmJmwuZy5LYSYmbC5nLkthKCkmJmwuZy5LYSgpLmVjKTt0aGlzLmo9YT90aGlzLmw6MTt0aGlzLmc9bnVsbDsxPHRoaXMuaiYmKHRoaXMuZz1uZXcgU2V0KTt0aGlzLmg9bnVsbDt0aGlzLmk9W107fXZhciBkZD0xMDtmdW5jdGlvbiBlZChhKXtyZXR1cm4gYS5oPyEwOmEuZz9hLmcuc2l6ZT49YS5qOiExfWZ1bmN0aW9uIEJjKGEpe3JldHVybiBhLmg/MTphLmc/YS5nLnNpemU6MH1mdW5jdGlvbiB4YyhhLGIpe3JldHVybiBhLmg/YS5oPT1iOmEuZz9hLmcuaGFzKGIpOiExfWZ1bmN0aW9uIENjKGEsYil7YS5nP2EuZy5hZGQoYik6YS5oPWI7fVxuZnVuY3Rpb24gRWMoYSxiKXthLmgmJmEuaD09Yj9hLmg9bnVsbDphLmcmJmEuZy5oYXMoYikmJmEuZy5kZWxldGUoYik7fWNkLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLmk9ZmQodGhpcyk7aWYodGhpcy5oKXRoaXMuaC5jYW5jZWwoKSx0aGlzLmg9bnVsbDtlbHNlIGlmKHRoaXMuZyYmMCE9PXRoaXMuZy5zaXplKXtmb3IoY29uc3QgYSBvZiB0aGlzLmcudmFsdWVzKCkpYS5jYW5jZWwoKTt0aGlzLmcuY2xlYXIoKTt9fTtmdW5jdGlvbiBmZChhKXtpZihudWxsIT1hLmgpcmV0dXJuIGEuaS5jb25jYXQoYS5oLkYpO2lmKG51bGwhPWEuZyYmMCE9PWEuZy5zaXplKXtsZXQgYj1hLmk7Zm9yKGNvbnN0IGMgb2YgYS5nLnZhbHVlcygpKWI9Yi5jb25jYXQoYy5GKTtyZXR1cm4gYn1yZXR1cm4gbWEoYS5pKX12YXIgZ2Q9Y2xhc3N7c3RyaW5naWZ5KGEpe3JldHVybiBsLkpTT04uc3RyaW5naWZ5KGEsdm9pZCAwKX1wYXJzZShhKXtyZXR1cm4gbC5KU09OLnBhcnNlKGEsdm9pZCAwKX19O2Z1bmN0aW9uIGhkKCl7dGhpcy5nPW5ldyBnZDt9ZnVuY3Rpb24gaWQoYSxiLGMpe2NvbnN0IGQ9Y3x8XCJcIjt0cnl7S2MoYSxmdW5jdGlvbihlLGYpe2xldCBoPWU7cChlKSYmKGg9amIoZSkpO2IucHVzaChkK2YrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGgpKTt9KTt9Y2F0Y2goZSl7dGhyb3cgYi5wdXNoKGQrXCJ0eXBlPVwiK2VuY29kZVVSSUNvbXBvbmVudChcIl9iYWRtYXBcIikpLGU7fX1mdW5jdGlvbiBqZChhLGIpe2NvbnN0IGM9bmV3IEdiO2lmKGwuSW1hZ2Upe2NvbnN0IGQ9bmV3IEltYWdlO2Qub25sb2FkPWhhKGtkLGMsZCxcIlRlc3RMb2FkSW1hZ2U6IGxvYWRlZFwiLCEwLGIpO2Qub25lcnJvcj1oYShrZCxjLGQsXCJUZXN0TG9hZEltYWdlOiBlcnJvclwiLCExLGIpO2Qub25hYm9ydD1oYShrZCxjLGQsXCJUZXN0TG9hZEltYWdlOiBhYm9ydFwiLCExLGIpO2Qub250aW1lb3V0PWhhKGtkLGMsZCxcIlRlc3RMb2FkSW1hZ2U6IHRpbWVvdXRcIiwhMSxiKTtsLnNldFRpbWVvdXQoZnVuY3Rpb24oKXtpZihkLm9udGltZW91dClkLm9udGltZW91dCgpO30sMUU0KTtkLnNyYz1hO31lbHNlIGIoITEpO31mdW5jdGlvbiBrZChhLGIsYyxkLGUpe3RyeXtiLm9ubG9hZD1udWxsLGIub25lcnJvcj1udWxsLGIub25hYm9ydD1udWxsLGIub250aW1lb3V0PW51bGwsZShkKTt9Y2F0Y2goZil7fX1mdW5jdGlvbiBsZChhKXt0aGlzLmw9YS5mY3x8bnVsbDt0aGlzLmo9YS5vYnx8ITE7fXIobGQsVWIpO2xkLnByb3RvdHlwZS5nPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBtZCh0aGlzLmwsdGhpcy5qKX07bGQucHJvdG90eXBlLmk9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGF9fSh7fSk7ZnVuY3Rpb24gbWQoYSxiKXtCLmNhbGwodGhpcyk7dGhpcy5GPWE7dGhpcy51PWI7dGhpcy5tPXZvaWQgMDt0aGlzLnJlYWR5U3RhdGU9bmQ7dGhpcy5zdGF0dXM9MDt0aGlzLnJlc3BvbnNlVHlwZT10aGlzLnJlc3BvbnNlVGV4dD10aGlzLnJlc3BvbnNlPXRoaXMuc3RhdHVzVGV4dD1cIlwiO3RoaXMub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7dGhpcy52PW5ldyBIZWFkZXJzO3RoaXMuaD1udWxsO3RoaXMuQz1cIkdFVFwiO3RoaXMuQj1cIlwiO3RoaXMuZz0hMTt0aGlzLkE9dGhpcy5qPXRoaXMubD1udWxsO31yKG1kLEIpO3ZhciBuZD0wO2s9bWQucHJvdG90eXBlO1xuay5vcGVuPWZ1bmN0aW9uKGEsYil7aWYodGhpcy5yZWFkeVN0YXRlIT1uZCl0aHJvdyB0aGlzLmFib3J0KCksRXJyb3IoXCJFcnJvciByZW9wZW5pbmcgYSBjb25uZWN0aW9uXCIpO3RoaXMuQz1hO3RoaXMuQj1iO3RoaXMucmVhZHlTdGF0ZT0xO29kKHRoaXMpO307ay5zZW5kPWZ1bmN0aW9uKGEpe2lmKDEhPXRoaXMucmVhZHlTdGF0ZSl0aHJvdyB0aGlzLmFib3J0KCksRXJyb3IoXCJuZWVkIHRvIGNhbGwgb3BlbigpIGZpcnN0LiBcIik7dGhpcy5nPSEwO2NvbnN0IGI9e2hlYWRlcnM6dGhpcy52LG1ldGhvZDp0aGlzLkMsY3JlZGVudGlhbHM6dGhpcy5tLGNhY2hlOnZvaWQgMH07YSYmKGIuYm9keT1hKTsodGhpcy5GfHxsKS5mZXRjaChuZXcgUmVxdWVzdCh0aGlzLkIsYikpLnRoZW4odGhpcy4kYS5iaW5kKHRoaXMpLHRoaXMua2EuYmluZCh0aGlzKSk7fTtcbmsuYWJvcnQ9ZnVuY3Rpb24oKXt0aGlzLnJlc3BvbnNlPXRoaXMucmVzcG9uc2VUZXh0PVwiXCI7dGhpcy52PW5ldyBIZWFkZXJzO3RoaXMuc3RhdHVzPTA7dGhpcy5qJiZ0aGlzLmouY2FuY2VsKFwiUmVxdWVzdCB3YXMgYWJvcnRlZC5cIikuY2F0Y2goKCk9Pnt9KTsxPD10aGlzLnJlYWR5U3RhdGUmJnRoaXMuZyYmNCE9dGhpcy5yZWFkeVN0YXRlJiYodGhpcy5nPSExLHBkKHRoaXMpKTt0aGlzLnJlYWR5U3RhdGU9bmQ7fTtcbmsuJGE9ZnVuY3Rpb24oYSl7aWYodGhpcy5nJiYodGhpcy5sPWEsdGhpcy5ofHwodGhpcy5zdGF0dXM9dGhpcy5sLnN0YXR1cyx0aGlzLnN0YXR1c1RleHQ9dGhpcy5sLnN0YXR1c1RleHQsdGhpcy5oPWEuaGVhZGVycyx0aGlzLnJlYWR5U3RhdGU9MixvZCh0aGlzKSksdGhpcy5nJiYodGhpcy5yZWFkeVN0YXRlPTMsb2QodGhpcyksdGhpcy5nKSkpaWYoXCJhcnJheWJ1ZmZlclwiPT09dGhpcy5yZXNwb25zZVR5cGUpYS5hcnJheUJ1ZmZlcigpLnRoZW4odGhpcy5ZYS5iaW5kKHRoaXMpLHRoaXMua2EuYmluZCh0aGlzKSk7ZWxzZSBpZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIGwuUmVhZGFibGVTdHJlYW0mJlwiYm9keVwiaW4gYSl7dGhpcy5qPWEuYm9keS5nZXRSZWFkZXIoKTtpZih0aGlzLnUpe2lmKHRoaXMucmVzcG9uc2VUeXBlKXRocm93IEVycm9yKCdyZXNwb25zZVR5cGUgbXVzdCBiZSBlbXB0eSBmb3IgXCJzdHJlYW1CaW5hcnlDaHVua3NcIiBtb2RlIHJlc3BvbnNlcy4nKTt0aGlzLnJlc3BvbnNlPVxuW107fWVsc2UgdGhpcy5yZXNwb25zZT10aGlzLnJlc3BvbnNlVGV4dD1cIlwiLHRoaXMuQT1uZXcgVGV4dERlY29kZXI7cWQodGhpcyk7fWVsc2UgYS50ZXh0KCkudGhlbih0aGlzLlphLmJpbmQodGhpcyksdGhpcy5rYS5iaW5kKHRoaXMpKTt9O2Z1bmN0aW9uIHFkKGEpe2Euai5yZWFkKCkudGhlbihhLlhhLmJpbmQoYSkpLmNhdGNoKGEua2EuYmluZChhKSk7fWsuWGE9ZnVuY3Rpb24oYSl7aWYodGhpcy5nKXtpZih0aGlzLnUmJmEudmFsdWUpdGhpcy5yZXNwb25zZS5wdXNoKGEudmFsdWUpO2Vsc2UgaWYoIXRoaXMudSl7dmFyIGI9YS52YWx1ZT9hLnZhbHVlOm5ldyBVaW50OEFycmF5KDApO2lmKGI9dGhpcy5BLmRlY29kZShiLHtzdHJlYW06IWEuZG9uZX0pKXRoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQrPWI7fWEuZG9uZT9wZCh0aGlzKTpvZCh0aGlzKTszPT10aGlzLnJlYWR5U3RhdGUmJnFkKHRoaXMpO319O1xuay5aYT1mdW5jdGlvbihhKXt0aGlzLmcmJih0aGlzLnJlc3BvbnNlPXRoaXMucmVzcG9uc2VUZXh0PWEscGQodGhpcykpO307ay5ZYT1mdW5jdGlvbihhKXt0aGlzLmcmJih0aGlzLnJlc3BvbnNlPWEscGQodGhpcykpO307ay5rYT1mdW5jdGlvbigpe3RoaXMuZyYmcGQodGhpcyk7fTtmdW5jdGlvbiBwZChhKXthLnJlYWR5U3RhdGU9NDthLmw9bnVsbDthLmo9bnVsbDthLkE9bnVsbDtvZChhKTt9ay5zZXRSZXF1ZXN0SGVhZGVyPWZ1bmN0aW9uKGEsYil7dGhpcy52LmFwcGVuZChhLGIpO307ay5nZXRSZXNwb25zZUhlYWRlcj1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5oP3RoaXMuaC5nZXQoYS50b0xvd2VyQ2FzZSgpKXx8XCJcIjpcIlwifTtcbmsuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzPWZ1bmN0aW9uKCl7aWYoIXRoaXMuaClyZXR1cm4gXCJcIjtjb25zdCBhPVtdLGI9dGhpcy5oLmVudHJpZXMoKTtmb3IodmFyIGM9Yi5uZXh0KCk7IWMuZG9uZTspYz1jLnZhbHVlLGEucHVzaChjWzBdK1wiOiBcIitjWzFdKSxjPWIubmV4dCgpO3JldHVybiBhLmpvaW4oXCJcXHJcXG5cIil9O2Z1bmN0aW9uIG9kKGEpe2Eub25yZWFkeXN0YXRlY2hhbmdlJiZhLm9ucmVhZHlzdGF0ZWNoYW5nZS5jYWxsKGEpO31PYmplY3QuZGVmaW5lUHJvcGVydHkobWQucHJvdG90eXBlLFwid2l0aENyZWRlbnRpYWxzXCIse2dldDpmdW5jdGlvbigpe3JldHVybiBcImluY2x1ZGVcIj09PXRoaXMubX0sc2V0OmZ1bmN0aW9uKGEpe3RoaXMubT1hP1wiaW5jbHVkZVwiOlwic2FtZS1vcmlnaW5cIjt9fSk7dmFyIHJkPWwuSlNPTi5wYXJzZTtmdW5jdGlvbiBQKGEpe0IuY2FsbCh0aGlzKTt0aGlzLmhlYWRlcnM9bmV3IE1hcDt0aGlzLnU9YXx8bnVsbDt0aGlzLmg9ITE7dGhpcy5DPXRoaXMuZz1udWxsO3RoaXMuST1cIlwiO3RoaXMubT0wO3RoaXMuaj1cIlwiO3RoaXMubD10aGlzLkc9dGhpcy52PXRoaXMuRj0hMTt0aGlzLkI9MDt0aGlzLkE9bnVsbDt0aGlzLks9c2Q7dGhpcy5MPXRoaXMuTT0hMTt9cihQLEIpO3ZhciBzZD1cIlwiLHRkPS9eaHR0cHM/JC9pLHVkPVtcIlBPU1RcIixcIlBVVFwiXTtrPVAucHJvdG90eXBlO2suT2E9ZnVuY3Rpb24oYSl7dGhpcy5NPWE7fTtcbmsuaGE9ZnVuY3Rpb24oYSxiLGMsZCl7aWYodGhpcy5nKXRocm93IEVycm9yKFwiW2dvb2cubmV0LlhocklvXSBPYmplY3QgaXMgYWN0aXZlIHdpdGggYW5vdGhlciByZXF1ZXN0PVwiK3RoaXMuSStcIjsgbmV3VXJpPVwiK2EpO2I9Yj9iLnRvVXBwZXJDYXNlKCk6XCJHRVRcIjt0aGlzLkk9YTt0aGlzLmo9XCJcIjt0aGlzLm09MDt0aGlzLkY9ITE7dGhpcy5oPSEwO3RoaXMuZz10aGlzLnU/dGhpcy51LmcoKTokYi5nKCk7dGhpcy5DPXRoaXMudT9WYih0aGlzLnUpOlZiKCRiKTt0aGlzLmcub25yZWFkeXN0YXRlY2hhbmdlPXEodGhpcy5MYSx0aGlzKTt0cnl7dGhpcy5HPSEwLHRoaXMuZy5vcGVuKGIsU3RyaW5nKGEpLCEwKSx0aGlzLkc9ITE7fWNhdGNoKGYpe3ZkKHRoaXMsZik7cmV0dXJufWE9Y3x8XCJcIjtjPW5ldyBNYXAodGhpcy5oZWFkZXJzKTtpZihkKWlmKE9iamVjdC5nZXRQcm90b3R5cGVPZihkKT09PU9iamVjdC5wcm90b3R5cGUpZm9yKHZhciBlIGluIGQpYy5zZXQoZSxkW2VdKTtlbHNlIGlmKFwiZnVuY3Rpb25cIj09PVxudHlwZW9mIGQua2V5cyYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGQuZ2V0KWZvcihjb25zdCBmIG9mIGQua2V5cygpKWMuc2V0KGYsZC5nZXQoZikpO2Vsc2UgdGhyb3cgRXJyb3IoXCJVbmtub3duIGlucHV0IHR5cGUgZm9yIG9wdF9oZWFkZXJzOiBcIitTdHJpbmcoZCkpO2Q9QXJyYXkuZnJvbShjLmtleXMoKSkuZmluZChmPT5cImNvbnRlbnQtdHlwZVwiPT1mLnRvTG93ZXJDYXNlKCkpO2U9bC5Gb3JtRGF0YSYmYSBpbnN0YW5jZW9mIGwuRm9ybURhdGE7ISgwPD1rYSh1ZCxiKSl8fGR8fGV8fGMuc2V0KFwiQ29udGVudC1UeXBlXCIsXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD11dGYtOFwiKTtmb3IoY29uc3QgW2YsaF1vZiBjKXRoaXMuZy5zZXRSZXF1ZXN0SGVhZGVyKGYsaCk7dGhpcy5LJiYodGhpcy5nLnJlc3BvbnNlVHlwZT10aGlzLkspO1wid2l0aENyZWRlbnRpYWxzXCJpbiB0aGlzLmcmJnRoaXMuZy53aXRoQ3JlZGVudGlhbHMhPT10aGlzLk0mJih0aGlzLmcud2l0aENyZWRlbnRpYWxzPVxudGhpcy5NKTt0cnl7d2QodGhpcyksMDx0aGlzLkImJigodGhpcy5MPXhkKHRoaXMuZykpPyh0aGlzLmcudGltZW91dD10aGlzLkIsdGhpcy5nLm9udGltZW91dD1xKHRoaXMudWEsdGhpcykpOnRoaXMuQT15Yih0aGlzLnVhLHRoaXMuQix0aGlzKSksdGhpcy52PSEwLHRoaXMuZy5zZW5kKGEpLHRoaXMudj0hMTt9Y2F0Y2goZil7dmQodGhpcyxmKTt9fTtmdW5jdGlvbiB4ZChhKXtyZXR1cm4geiYmXCJudW1iZXJcIj09PXR5cGVvZiBhLnRpbWVvdXQmJnZvaWQgMCE9PWEub250aW1lb3V0fWsudWE9ZnVuY3Rpb24oKXtcInVuZGVmaW5lZFwiIT10eXBlb2YgZ29vZyYmdGhpcy5nJiYodGhpcy5qPVwiVGltZWQgb3V0IGFmdGVyIFwiK3RoaXMuQitcIm1zLCBhYm9ydGluZ1wiLHRoaXMubT04LEModGhpcyxcInRpbWVvdXRcIiksdGhpcy5hYm9ydCg4KSk7fTtmdW5jdGlvbiB2ZChhLGIpe2EuaD0hMTthLmcmJihhLmw9ITAsYS5nLmFib3J0KCksYS5sPSExKTthLmo9YjthLm09NTt5ZChhKTt6ZChhKTt9XG5mdW5jdGlvbiB5ZChhKXthLkZ8fChhLkY9ITAsQyhhLFwiY29tcGxldGVcIiksQyhhLFwiZXJyb3JcIikpO31rLmFib3J0PWZ1bmN0aW9uKGEpe3RoaXMuZyYmdGhpcy5oJiYodGhpcy5oPSExLHRoaXMubD0hMCx0aGlzLmcuYWJvcnQoKSx0aGlzLmw9ITEsdGhpcy5tPWF8fDcsQyh0aGlzLFwiY29tcGxldGVcIiksQyh0aGlzLFwiYWJvcnRcIiksemQodGhpcykpO307ay5OPWZ1bmN0aW9uKCl7dGhpcy5nJiYodGhpcy5oJiYodGhpcy5oPSExLHRoaXMubD0hMCx0aGlzLmcuYWJvcnQoKSx0aGlzLmw9ITEpLHpkKHRoaXMsITApKTtQLiQuTi5jYWxsKHRoaXMpO307ay5MYT1mdW5jdGlvbigpe3RoaXMuc3x8KHRoaXMuR3x8dGhpcy52fHx0aGlzLmw/QWQodGhpcyk6dGhpcy5rYigpKTt9O2sua2I9ZnVuY3Rpb24oKXtBZCh0aGlzKTt9O1xuZnVuY3Rpb24gQWQoYSl7aWYoYS5oJiZcInVuZGVmaW5lZFwiIT10eXBlb2YgZ29vZyYmKCFhLkNbMV18fDQhPUgoYSl8fDIhPWEuZGEoKSkpaWYoYS52JiY0PT1IKGEpKXliKGEuTGEsMCxhKTtlbHNlIGlmKEMoYSxcInJlYWR5c3RhdGVjaGFuZ2VcIiksND09SChhKSl7YS5oPSExO3RyeXtjb25zdCBoPWEuZGEoKTthOnN3aXRjaChoKXtjYXNlIDIwMDpjYXNlIDIwMTpjYXNlIDIwMjpjYXNlIDIwNDpjYXNlIDIwNjpjYXNlIDMwNDpjYXNlIDEyMjM6dmFyIGI9ITA7YnJlYWsgYTtkZWZhdWx0OmI9ITE7fXZhciBjO2lmKCEoYz1iKSl7dmFyIGQ7aWYoZD0wPT09aCl7dmFyIGU9U3RyaW5nKGEuSSkubWF0Y2goTGMpWzFdfHxudWxsOyFlJiZsLnNlbGYmJmwuc2VsZi5sb2NhdGlvbiYmKGU9bC5zZWxmLmxvY2F0aW9uLnByb3RvY29sLnNsaWNlKDAsLTEpKTtkPSF0ZC50ZXN0KGU/ZS50b0xvd2VyQ2FzZSgpOlwiXCIpO31jPWQ7fWlmKGMpQyhhLFwiY29tcGxldGVcIiksQyhhLFwic3VjY2Vzc1wiKTtlbHNlIHthLm09XG42O3RyeXt2YXIgZj0yPEgoYSk/YS5nLnN0YXR1c1RleHQ6XCJcIjt9Y2F0Y2gobil7Zj1cIlwiO31hLmo9ZitcIiBbXCIrYS5kYSgpK1wiXVwiO3lkKGEpO319ZmluYWxseXt6ZChhKTt9fX1mdW5jdGlvbiB6ZChhLGIpe2lmKGEuZyl7d2QoYSk7Y29uc3QgYz1hLmcsZD1hLkNbMF0/KCk9Pnt9Om51bGw7YS5nPW51bGw7YS5DPW51bGw7Ynx8QyhhLFwicmVhZHlcIik7dHJ5e2Mub25yZWFkeXN0YXRlY2hhbmdlPWQ7fWNhdGNoKGUpe319fWZ1bmN0aW9uIHdkKGEpe2EuZyYmYS5MJiYoYS5nLm9udGltZW91dD1udWxsKTthLkEmJihsLmNsZWFyVGltZW91dChhLkEpLGEuQT1udWxsKTt9ay5pc0FjdGl2ZT1mdW5jdGlvbigpe3JldHVybiAhIXRoaXMuZ307ZnVuY3Rpb24gSChhKXtyZXR1cm4gYS5nP2EuZy5yZWFkeVN0YXRlOjB9ay5kYT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gMjxIKHRoaXMpP3RoaXMuZy5zdGF0dXM6LTF9Y2F0Y2goYSl7cmV0dXJuIC0xfX07XG5rLmphPWZ1bmN0aW9uKCl7dHJ5e3JldHVybiB0aGlzLmc/dGhpcy5nLnJlc3BvbnNlVGV4dDpcIlwifWNhdGNoKGEpe3JldHVybiBcIlwifX07ay5XYT1mdW5jdGlvbihhKXtpZih0aGlzLmcpe3ZhciBiPXRoaXMuZy5yZXNwb25zZVRleHQ7YSYmMD09Yi5pbmRleE9mKGEpJiYoYj1iLnN1YnN0cmluZyhhLmxlbmd0aCkpO3JldHVybiByZChiKX19O2Z1bmN0aW9uIG1jKGEpe3RyeXtpZighYS5nKXJldHVybiBudWxsO2lmKFwicmVzcG9uc2VcImluIGEuZylyZXR1cm4gYS5nLnJlc3BvbnNlO3N3aXRjaChhLkspe2Nhc2Ugc2Q6Y2FzZSBcInRleHRcIjpyZXR1cm4gYS5nLnJlc3BvbnNlVGV4dDtjYXNlIFwiYXJyYXlidWZmZXJcIjppZihcIm1velJlc3BvbnNlQXJyYXlCdWZmZXJcImluIGEuZylyZXR1cm4gYS5nLm1velJlc3BvbnNlQXJyYXlCdWZmZXJ9cmV0dXJuIG51bGx9Y2F0Y2goYil7cmV0dXJuIG51bGx9fVxuZnVuY3Rpb24gdGMoYSl7Y29uc3QgYj17fTthPShhLmcmJjI8PUgoYSk/YS5nLmdldEFsbFJlc3BvbnNlSGVhZGVycygpfHxcIlwiOlwiXCIpLnNwbGl0KFwiXFxyXFxuXCIpO2ZvcihsZXQgZD0wO2Q8YS5sZW5ndGg7ZCsrKXtpZih4KGFbZF0pKWNvbnRpbnVlO3ZhciBjPXFiKGFbZF0pO2NvbnN0IGU9Y1swXTtjPWNbMV07aWYoXCJzdHJpbmdcIiE9PXR5cGVvZiBjKWNvbnRpbnVlO2M9Yy50cmltKCk7Y29uc3QgZj1iW2VdfHxbXTtiW2VdPWY7Zi5wdXNoKGMpO31PYShiLGZ1bmN0aW9uKGQpe3JldHVybiBkLmpvaW4oXCIsIFwiKX0pO31rLklhPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubX07ay5TYT1mdW5jdGlvbigpe3JldHVybiBcInN0cmluZ1wiPT09dHlwZW9mIHRoaXMuaj90aGlzLmo6U3RyaW5nKHRoaXMuail9O2Z1bmN0aW9uIEJkKGEpe2xldCBiPVwiXCI7TmEoYSxmdW5jdGlvbihjLGQpe2IrPWQ7Yis9XCI6XCI7Yis9YztiKz1cIlxcclxcblwiO30pO3JldHVybiBifWZ1bmN0aW9uIENkKGEsYixjKXthOntmb3IoZCBpbiBjKXt2YXIgZD0hMTticmVhayBhfWQ9ITA7fWR8fChjPUJkKGMpLFwic3RyaW5nXCI9PT10eXBlb2YgYT8obnVsbCE9YyYmZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhjKSkpOksoYSxiLGMpKTt9ZnVuY3Rpb24gRGQoYSxiLGMpe3JldHVybiBjJiZjLmludGVybmFsQ2hhbm5lbFBhcmFtcz9jLmludGVybmFsQ2hhbm5lbFBhcmFtc1thXXx8YjpifVxuZnVuY3Rpb24gRWQoYSl7dGhpcy5HYT0wO3RoaXMuaj1bXTt0aGlzLmw9bmV3IEdiO3RoaXMucGE9dGhpcy53YT10aGlzLkk9dGhpcy5ZPXRoaXMuZz10aGlzLkRhPXRoaXMuRj10aGlzLm5hPXRoaXMubz10aGlzLlU9dGhpcy5zPW51bGw7dGhpcy5mYj10aGlzLlc9MDt0aGlzLmNiPURkKFwiZmFpbEZhc3RcIiwhMSxhKTt0aGlzLkc9dGhpcy52PXRoaXMudT10aGlzLm09dGhpcy5oPW51bGw7dGhpcy5hYT0hMDt0aGlzLkZhPXRoaXMuVj0tMTt0aGlzLmJhPXRoaXMuQT10aGlzLkM9MDt0aGlzLmFiPURkKFwiYmFzZVJldHJ5RGVsYXlNc1wiLDVFMyxhKTt0aGlzLmhiPURkKFwicmV0cnlEZWxheVNlZWRNc1wiLDFFNCxhKTt0aGlzLmViPURkKFwiZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXCIsMixhKTt0aGlzLnhhPURkKFwiZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXCIsMkU0LGEpO3RoaXMudmE9YSYmYS54bWxIdHRwRmFjdG9yeXx8dm9pZCAwO3RoaXMuSGE9YSYmYS5kY3x8ITE7dGhpcy5MPVxudm9pZCAwO3RoaXMuSj1hJiZhLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHJ8fCExO3RoaXMuSz1cIlwiO3RoaXMuaT1uZXcgY2QoYSYmYS5jb25jdXJyZW50UmVxdWVzdExpbWl0KTt0aGlzLkphPW5ldyBoZDt0aGlzLlA9YSYmYS5mYXN0SGFuZHNoYWtlfHwhMTt0aGlzLk89YSYmYS5lbmNvZGVJbml0TWVzc2FnZUhlYWRlcnN8fCExO3RoaXMuUCYmdGhpcy5PJiYodGhpcy5PPSExKTt0aGlzLmJiPWEmJmEuYmN8fCExO2EmJmEuRWEmJnRoaXMubC5FYSgpO2EmJmEuZm9yY2VMb25nUG9sbGluZyYmKHRoaXMuYWE9ITEpO3RoaXMuY2E9IXRoaXMuUCYmdGhpcy5hYSYmYSYmYS5kZXRlY3RCdWZmZXJpbmdQcm94eXx8ITE7dGhpcy5xYT12b2lkIDA7YSYmYS5sb25nUG9sbGluZ1RpbWVvdXQmJjA8YS5sb25nUG9sbGluZ1RpbWVvdXQmJih0aGlzLnFhPWEubG9uZ1BvbGxpbmdUaW1lb3V0KTt0aGlzLm9hPXZvaWQgMDt0aGlzLlM9MDt0aGlzLk09ITE7dGhpcy5tYT10aGlzLkI9bnVsbDt9az1FZC5wcm90b3R5cGU7XG5rLnJhPTg7ay5IPTE7ZnVuY3Rpb24gSGMoYSl7RmQoYSk7aWYoMz09YS5IKXt2YXIgYj1hLlcrKyxjPUcoYS5JKTtLKGMsXCJTSURcIixhLkspO0soYyxcIlJJRFwiLGIpO0soYyxcIlRZUEVcIixcInRlcm1pbmF0ZVwiKTtHZChhLGMpO2I9bmV3IGJjKGEsYS5sLGIpO2IuTD0yO2Iudj1oYyhHKGMpKTtjPSExO2lmKGwubmF2aWdhdG9yJiZsLm5hdmlnYXRvci5zZW5kQmVhY29uKXRyeXtjPWwubmF2aWdhdG9yLnNlbmRCZWFjb24oYi52LnRvU3RyaW5nKCksXCJcIik7fWNhdGNoKGQpe30hYyYmbC5JbWFnZSYmKChuZXcgSW1hZ2UpLnNyYz1iLnYsYz0hMCk7Y3x8KGIuZz1sYyhiLmwsbnVsbCksYi5nLmhhKGIudikpO2IuRz1EYXRlLm5vdygpO2pjKGIpO31IZChhKTt9ZnVuY3Rpb24gemMoYSl7YS5nJiYodmMoYSksYS5nLmNhbmNlbCgpLGEuZz1udWxsKTt9XG5mdW5jdGlvbiBGZChhKXt6YyhhKTthLnUmJihsLmNsZWFyVGltZW91dChhLnUpLGEudT1udWxsKTt5YyhhKTthLmkuY2FuY2VsKCk7YS5tJiYoXCJudW1iZXJcIj09PXR5cGVvZiBhLm0mJmwuY2xlYXJUaW1lb3V0KGEubSksYS5tPW51bGwpO31mdW5jdGlvbiBHYyhhKXtpZighZWQoYS5pKSYmIWEubSl7YS5tPSEwO3ZhciBiPWEuTmE7c2J8fHZiKCk7dGJ8fChzYigpLHRiPSEwKTttYi5hZGQoYixhKTthLkM9MDt9fWZ1bmN0aW9uIElkKGEsYil7aWYoQmMoYS5pKT49YS5pLmotKGEubT8xOjApKXJldHVybiAhMTtpZihhLm0pcmV0dXJuIGEuaj1iLkYuY29uY2F0KGEuaiksITA7aWYoMT09YS5IfHwyPT1hLkh8fGEuQz49KGEuY2I/MDphLmViKSlyZXR1cm4gITE7YS5tPVJiKHEoYS5OYSxhLGIpLEpkKGEsYS5DKSk7YS5DKys7cmV0dXJuICEwfVxuay5OYT1mdW5jdGlvbihhKXtpZih0aGlzLm0paWYodGhpcy5tPW51bGwsMT09dGhpcy5IKXtpZighYSl7dGhpcy5XPU1hdGguZmxvb3IoMUU1Kk1hdGgucmFuZG9tKCkpO2E9dGhpcy5XKys7Y29uc3QgZT1uZXcgYmModGhpcyx0aGlzLmwsYSk7bGV0IGY9dGhpcy5zO3RoaXMuVSYmKGY/KGY9UGEoZiksUmEoZix0aGlzLlUpKTpmPXRoaXMuVSk7bnVsbCE9PXRoaXMub3x8dGhpcy5PfHwoZS5JPWYsZj1udWxsKTtpZih0aGlzLlApYTp7dmFyIGI9MDtmb3IodmFyIGM9MDtjPHRoaXMuai5sZW5ndGg7YysrKXtiOnt2YXIgZD10aGlzLmpbY107aWYoXCJfX2RhdGFfX1wiaW4gZC5tYXAmJihkPWQubWFwLl9fZGF0YV9fLFwic3RyaW5nXCI9PT10eXBlb2YgZCkpe2Q9ZC5sZW5ndGg7YnJlYWsgYn1kPXZvaWQgMDt9aWYodm9pZCAwPT09ZClicmVhaztiKz1kO2lmKDQwOTY8Yil7Yj1jO2JyZWFrIGF9aWYoNDA5Nj09PWJ8fGM9PT10aGlzLmoubGVuZ3RoLTEpe2I9YysxO2JyZWFrIGF9fWI9MUUzO31lbHNlIGI9XG4xRTM7Yj1LZCh0aGlzLGUsYik7Yz1HKHRoaXMuSSk7SyhjLFwiUklEXCIsYSk7SyhjLFwiQ1ZFUlwiLDIyKTt0aGlzLkYmJksoYyxcIlgtSFRUUC1TZXNzaW9uLUlkXCIsdGhpcy5GKTtHZCh0aGlzLGMpO2YmJih0aGlzLk8/Yj1cImhlYWRlcnM9XCIrZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhCZChmKSkpK1wiJlwiK2I6dGhpcy5vJiZDZChjLHRoaXMubyxmKSk7Q2ModGhpcy5pLGUpO3RoaXMuYmImJksoYyxcIlRZUEVcIixcImluaXRcIik7dGhpcy5QPyhLKGMsXCIkcmVxXCIsYiksSyhjLFwiU0lEXCIsXCJudWxsXCIpLGUuYWE9ITAsZ2MoZSxjLG51bGwpKTpnYyhlLGMsYik7dGhpcy5IPTI7fX1lbHNlIDM9PXRoaXMuSCYmKGE/TGQodGhpcyxhKTowPT10aGlzLmoubGVuZ3RofHxlZCh0aGlzLmkpfHxMZCh0aGlzKSk7fTtcbmZ1bmN0aW9uIExkKGEsYil7dmFyIGM7Yj9jPWIubTpjPWEuVysrO2NvbnN0IGQ9RyhhLkkpO0soZCxcIlNJRFwiLGEuSyk7SyhkLFwiUklEXCIsYyk7SyhkLFwiQUlEXCIsYS5WKTtHZChhLGQpO2EubyYmYS5zJiZDZChkLGEubyxhLnMpO2M9bmV3IGJjKGEsYS5sLGMsYS5DKzEpO251bGw9PT1hLm8mJihjLkk9YS5zKTtiJiYoYS5qPWIuRi5jb25jYXQoYS5qKSk7Yj1LZChhLGMsMUUzKTtjLnNldFRpbWVvdXQoTWF0aC5yb3VuZCguNSphLnhhKStNYXRoLnJvdW5kKC41KmEueGEqTWF0aC5yYW5kb20oKSkpO0NjKGEuaSxjKTtnYyhjLGQsYik7fWZ1bmN0aW9uIEdkKGEsYil7YS5uYSYmTmEoYS5uYSxmdW5jdGlvbihjLGQpe0soYixkLGMpO30pO2EuaCYmS2Moe30sZnVuY3Rpb24oYyxkKXtLKGIsZCxjKTt9KTt9XG5mdW5jdGlvbiBLZChhLGIsYyl7Yz1NYXRoLm1pbihhLmoubGVuZ3RoLGMpO3ZhciBkPWEuaD9xKGEuaC5WYSxhLmgsYSk6bnVsbDthOnt2YXIgZT1hLmo7bGV0IGY9LTE7Zm9yKDs7KXtjb25zdCBoPVtcImNvdW50PVwiK2NdOy0xPT1mPzA8Yz8oZj1lWzBdLmcsaC5wdXNoKFwib2ZzPVwiK2YpKTpmPTA6aC5wdXNoKFwib2ZzPVwiK2YpO2xldCBuPSEwO2ZvcihsZXQgdD0wO3Q8Yzt0Kyspe2xldCBtPWVbdF0uZztjb25zdCB1PWVbdF0ubWFwO20tPWY7aWYoMD5tKWY9TWF0aC5tYXgoMCxlW3RdLmctMTAwKSxuPSExO2Vsc2UgdHJ5e2lkKHUsaCxcInJlcVwiK20rXCJfXCIpO31jYXRjaChMKXtkJiZkKHUpO319aWYobil7ZD1oLmpvaW4oXCImXCIpO2JyZWFrIGF9fX1hPWEuai5zcGxpY2UoMCxjKTtiLkY9YTtyZXR1cm4gZH1mdW5jdGlvbiBGYyhhKXtpZighYS5nJiYhYS51KXthLmJhPTE7dmFyIGI9YS5NYTtzYnx8dmIoKTt0Ynx8KHNiKCksdGI9ITApO21iLmFkZChiLGEpO2EuQT0wO319XG5mdW5jdGlvbiBBYyhhKXtpZihhLmd8fGEudXx8Mzw9YS5BKXJldHVybiAhMTthLmJhKys7YS51PVJiKHEoYS5NYSxhKSxKZChhLGEuQSkpO2EuQSsrO3JldHVybiAhMH1rLk1hPWZ1bmN0aW9uKCl7dGhpcy51PW51bGw7TWQodGhpcyk7aWYodGhpcy5jYSYmISh0aGlzLk18fG51bGw9PXRoaXMuZ3x8MD49dGhpcy5TKSl7dmFyIGE9Mip0aGlzLlM7dGhpcy5sLmluZm8oXCJCUCBkZXRlY3Rpb24gdGltZXIgZW5hYmxlZDogXCIrYSk7dGhpcy5CPVJiKHEodGhpcy5qYix0aGlzKSxhKTt9fTtrLmpiPWZ1bmN0aW9uKCl7dGhpcy5CJiYodGhpcy5CPW51bGwsdGhpcy5sLmluZm8oXCJCUCBkZXRlY3Rpb24gdGltZW91dCByZWFjaGVkLlwiKSx0aGlzLmwuaW5mbyhcIkJ1ZmZlcmluZyBwcm94eSBkZXRlY3RlZCBhbmQgc3dpdGNoIHRvIGxvbmctcG9sbGluZyFcIiksdGhpcy5HPSExLHRoaXMuTT0hMCxGKDEwKSx6Yyh0aGlzKSxNZCh0aGlzKSk7fTtcbmZ1bmN0aW9uIHZjKGEpe251bGwhPWEuQiYmKGwuY2xlYXJUaW1lb3V0KGEuQiksYS5CPW51bGwpO31mdW5jdGlvbiBNZChhKXthLmc9bmV3IGJjKGEsYS5sLFwicnBjXCIsYS5iYSk7bnVsbD09PWEubyYmKGEuZy5JPWEucyk7YS5nLk89MDt2YXIgYj1HKGEud2EpO0soYixcIlJJRFwiLFwicnBjXCIpO0soYixcIlNJRFwiLGEuSyk7SyhiLFwiQUlEXCIsYS5WKTtLKGIsXCJDSVwiLGEuRz9cIjBcIjpcIjFcIik7IWEuRyYmYS5xYSYmSyhiLFwiVE9cIixhLnFhKTtLKGIsXCJUWVBFXCIsXCJ4bWxodHRwXCIpO0dkKGEsYik7YS5vJiZhLnMmJkNkKGIsYS5vLGEucyk7YS5MJiZhLmcuc2V0VGltZW91dChhLkwpO3ZhciBjPWEuZzthPWEucGE7Yy5MPTE7Yy52PWhjKEcoYikpO2Mucz1udWxsO2MuUz0hMDtpYyhjLGEpO31rLmliPWZ1bmN0aW9uKCl7bnVsbCE9dGhpcy52JiYodGhpcy52PW51bGwsemModGhpcyksQWModGhpcyksRigxOSkpO307XG5mdW5jdGlvbiB5YyhhKXtudWxsIT1hLnYmJihsLmNsZWFyVGltZW91dChhLnYpLGEudj1udWxsKTt9ZnVuY3Rpb24gc2MoYSxiKXt2YXIgYz1udWxsO2lmKGEuZz09Yil7eWMoYSk7dmMoYSk7YS5nPW51bGw7dmFyIGQ9Mjt9ZWxzZSBpZih4YyhhLmksYikpYz1iLkYsRWMoYS5pLGIpLGQ9MTtlbHNlIHJldHVybjtpZigwIT1hLkgpaWYoYi5pKWlmKDE9PWQpe2M9Yi5zP2Iucy5sZW5ndGg6MDtiPURhdGUubm93KCktYi5HO3ZhciBlPWEuQztkPU1iKCk7QyhkLG5ldyBRYihkLGMpKTtHYyhhKTt9ZWxzZSBGYyhhKTtlbHNlIGlmKGU9Yi5vLDM9PWV8fDA9PWUmJjA8Yi5jYXx8ISgxPT1kJiZJZChhLGIpfHwyPT1kJiZBYyhhKSkpc3dpdGNoKGMmJjA8Yy5sZW5ndGgmJihiPWEuaSxiLmk9Yi5pLmNvbmNhdChjKSksZSl7Y2FzZSAxOkooYSw1KTticmVhaztjYXNlIDQ6SihhLDEwKTticmVhaztjYXNlIDM6SihhLDYpO2JyZWFrO2RlZmF1bHQ6SihhLDIpO319XG5mdW5jdGlvbiBKZChhLGIpe2xldCBjPWEuYWIrTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmEuaGIpO2EuaXNBY3RpdmUoKXx8KGMqPTIpO3JldHVybiBjKmJ9ZnVuY3Rpb24gSihhLGIpe2EubC5pbmZvKFwiRXJyb3IgY29kZSBcIitiKTtpZigyPT1iKXt2YXIgYz1udWxsO2EuaCYmKGM9bnVsbCk7dmFyIGQ9cShhLnBiLGEpO2N8fChjPW5ldyBNKFwiLy93d3cuZ29vZ2xlLmNvbS9pbWFnZXMvY2xlYXJkb3QuZ2lmXCIpLGwubG9jYXRpb24mJlwiaHR0cFwiPT1sLmxvY2F0aW9uLnByb3RvY29sfHxOYyhjLFwiaHR0cHNcIiksaGMoYykpO2pkKGMudG9TdHJpbmcoKSxkKTt9ZWxzZSBGKDIpO2EuSD0wO2EuaCYmYS5oLnphKGIpO0hkKGEpO0ZkKGEpO31rLnBiPWZ1bmN0aW9uKGEpe2E/KHRoaXMubC5pbmZvKFwiU3VjY2Vzc2Z1bGx5IHBpbmdlZCBnb29nbGUuY29tXCIpLEYoMikpOih0aGlzLmwuaW5mbyhcIkZhaWxlZCB0byBwaW5nIGdvb2dsZS5jb21cIiksRigxKSk7fTtcbmZ1bmN0aW9uIEhkKGEpe2EuSD0wO2EubWE9W107aWYoYS5oKXtjb25zdCBiPWZkKGEuaSk7aWYoMCE9Yi5sZW5ndGh8fDAhPWEuai5sZW5ndGgpbmEoYS5tYSxiKSxuYShhLm1hLGEuaiksYS5pLmkubGVuZ3RoPTAsbWEoYS5qKSxhLmoubGVuZ3RoPTA7YS5oLnlhKCk7fX1mdW5jdGlvbiBEYyhhLGIsYyl7dmFyIGQ9YyBpbnN0YW5jZW9mIE0/RyhjKTpuZXcgTShjKTtpZihcIlwiIT1kLmcpYiYmKGQuZz1iK1wiLlwiK2QuZyksT2MoZCxkLm0pO2Vsc2Uge3ZhciBlPWwubG9jYXRpb247ZD1lLnByb3RvY29sO2I9Yj9iK1wiLlwiK2UuaG9zdG5hbWU6ZS5ob3N0bmFtZTtlPStlLnBvcnQ7dmFyIGY9bmV3IE0obnVsbCk7ZCYmTmMoZixkKTtiJiYoZi5nPWIpO2UmJk9jKGYsZSk7YyYmKGYubD1jKTtkPWY7fWM9YS5GO2I9YS5EYTtjJiZiJiZLKGQsYyxiKTtLKGQsXCJWRVJcIixhLnJhKTtHZChhLGQpO3JldHVybiBkfVxuZnVuY3Rpb24gbGMoYSxiLGMpe2lmKGImJiFhLkopdGhyb3cgRXJyb3IoXCJDYW4ndCBjcmVhdGUgc2Vjb25kYXJ5IGRvbWFpbiBjYXBhYmxlIFhocklvIG9iamVjdC5cIik7Yj1jJiZhLkhhJiYhYS52YT9uZXcgUChuZXcgbGQoe29iOiEwfSkpOm5ldyBQKGEudmEpO2IuT2EoYS5KKTtyZXR1cm4gYn1rLmlzQWN0aXZlPWZ1bmN0aW9uKCl7cmV0dXJuICEhdGhpcy5oJiZ0aGlzLmguaXNBY3RpdmUodGhpcyl9O2Z1bmN0aW9uIE5kKCl7fWs9TmQucHJvdG90eXBlO2suQmE9ZnVuY3Rpb24oKXt9O2suQWE9ZnVuY3Rpb24oKXt9O2suemE9ZnVuY3Rpb24oKXt9O2sueWE9ZnVuY3Rpb24oKXt9O2suaXNBY3RpdmU9ZnVuY3Rpb24oKXtyZXR1cm4gITB9O2suVmE9ZnVuY3Rpb24oKXt9O2Z1bmN0aW9uIE9kKCl7aWYoeiYmISgxMDw9TnVtYmVyKEZhKSkpdGhyb3cgRXJyb3IoXCJFbnZpcm9ubWVudGFsIGVycm9yOiBubyBhdmFpbGFibGUgdHJhbnNwb3J0LlwiKTt9T2QucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IFEoYSxiKX07XG5mdW5jdGlvbiBRKGEsYil7Qi5jYWxsKHRoaXMpO3RoaXMuZz1uZXcgRWQoYik7dGhpcy5sPWE7dGhpcy5oPWImJmIubWVzc2FnZVVybFBhcmFtc3x8bnVsbDthPWImJmIubWVzc2FnZUhlYWRlcnN8fG51bGw7YiYmYi5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkJiYoYT9hW1wiWC1DbGllbnQtUHJvdG9jb2xcIl09XCJ3ZWJjaGFubmVsXCI6YT17XCJYLUNsaWVudC1Qcm90b2NvbFwiOlwid2ViY2hhbm5lbFwifSk7dGhpcy5nLnM9YTthPWImJmIuaW5pdE1lc3NhZ2VIZWFkZXJzfHxudWxsO2ImJmIubWVzc2FnZUNvbnRlbnRUeXBlJiYoYT9hW1wiWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZVwiXT1iLm1lc3NhZ2VDb250ZW50VHlwZTphPXtcIlgtV2ViQ2hhbm5lbC1Db250ZW50LVR5cGVcIjpiLm1lc3NhZ2VDb250ZW50VHlwZX0pO2ImJmIuQ2EmJihhP2FbXCJYLVdlYkNoYW5uZWwtQ2xpZW50LVByb2ZpbGVcIl09Yi5DYTphPXtcIlgtV2ViQ2hhbm5lbC1DbGllbnQtUHJvZmlsZVwiOmIuQ2F9KTt0aGlzLmcuVT1cbmE7KGE9YiYmYi5jYykmJiF4KGEpJiYodGhpcy5nLm89YSk7dGhpcy5BPWImJmIuc3VwcG9ydHNDcm9zc0RvbWFpblhocnx8ITE7dGhpcy52PWImJmIuc2VuZFJhd0pzb258fCExOyhiPWImJmIuaHR0cFNlc3Npb25JZFBhcmFtKSYmIXgoYikmJih0aGlzLmcuRj1iLGE9dGhpcy5oLG51bGwhPT1hJiZiIGluIGEmJihhPXRoaXMuaCxiIGluIGEmJmRlbGV0ZSBhW2JdKSk7dGhpcy5qPW5ldyBSKHRoaXMpO31yKFEsQik7US5wcm90b3R5cGUubT1mdW5jdGlvbigpe3RoaXMuZy5oPXRoaXMuajt0aGlzLkEmJih0aGlzLmcuSj0hMCk7dmFyIGE9dGhpcy5nLGI9dGhpcy5sLGM9dGhpcy5ofHx2b2lkIDA7RigwKTthLlk9YjthLm5hPWN8fHt9O2EuRz1hLmFhO2EuST1EYyhhLG51bGwsYS5ZKTtHYyhhKTt9O1EucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7SGModGhpcy5nKTt9O1xuUS5wcm90b3R5cGUudT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmc7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXt2YXIgYz17fTtjLl9fZGF0YV9fPWE7YT1jO31lbHNlIHRoaXMudiYmKGM9e30sYy5fX2RhdGFfXz1qYihhKSxhPWMpO2Iuai5wdXNoKG5ldyBiZChiLmZiKyssYSkpOzM9PWIuSCYmR2MoYik7fTtRLnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7dGhpcy5nLmg9bnVsbDtkZWxldGUgdGhpcy5qO0hjKHRoaXMuZyk7ZGVsZXRlIHRoaXMuZztRLiQuTi5jYWxsKHRoaXMpO307XG5mdW5jdGlvbiBQZChhKXtZYi5jYWxsKHRoaXMpO2EuX19oZWFkZXJzX18mJih0aGlzLmhlYWRlcnM9YS5fX2hlYWRlcnNfXyx0aGlzLnN0YXR1c0NvZGU9YS5fX3N0YXR1c19fLGRlbGV0ZSBhLl9faGVhZGVyc19fLGRlbGV0ZSBhLl9fc3RhdHVzX18pO3ZhciBiPWEuX19zbV9fO2lmKGIpe2E6e2Zvcihjb25zdCBjIGluIGIpe2E9YzticmVhayBhfWE9dm9pZCAwO31pZih0aGlzLmk9YSlhPXRoaXMuaSxiPW51bGwhPT1iJiZhIGluIGI/YlthXTp2b2lkIDA7dGhpcy5kYXRhPWI7fWVsc2UgdGhpcy5kYXRhPWE7fXIoUGQsWWIpO2Z1bmN0aW9uIFFkKCl7WmIuY2FsbCh0aGlzKTt0aGlzLnN0YXR1cz0xO31yKFFkLFpiKTtmdW5jdGlvbiBSKGEpe3RoaXMuZz1hO31yKFIsTmQpO1IucHJvdG90eXBlLkJhPWZ1bmN0aW9uKCl7Qyh0aGlzLmcsXCJhXCIpO307Ui5wcm90b3R5cGUuQWE9ZnVuY3Rpb24oYSl7Qyh0aGlzLmcsbmV3IFBkKGEpKTt9O1xuUi5wcm90b3R5cGUuemE9ZnVuY3Rpb24oYSl7Qyh0aGlzLmcsbmV3IFFkKCkpO307Ui5wcm90b3R5cGUueWE9ZnVuY3Rpb24oKXtDKHRoaXMuZyxcImJcIik7fTtmdW5jdGlvbiBSZCgpe3RoaXMuYmxvY2tTaXplPS0xO31mdW5jdGlvbiBTKCl7dGhpcy5ibG9ja1NpemU9LTE7dGhpcy5ibG9ja1NpemU9NjQ7dGhpcy5nPUFycmF5KDQpO3RoaXMubT1BcnJheSh0aGlzLmJsb2NrU2l6ZSk7dGhpcy5pPXRoaXMuaD0wO3RoaXMucmVzZXQoKTt9cihTLFJkKTtTLnByb3RvdHlwZS5yZXNldD1mdW5jdGlvbigpe3RoaXMuZ1swXT0xNzMyNTg0MTkzO3RoaXMuZ1sxXT00MDIzMjMzNDE3O3RoaXMuZ1syXT0yNTYyMzgzMTAyO3RoaXMuZ1szXT0yNzE3MzM4Nzg7dGhpcy5pPXRoaXMuaD0wO307XG5mdW5jdGlvbiBTZChhLGIsYyl7Y3x8KGM9MCk7dmFyIGQ9QXJyYXkoMTYpO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYilmb3IodmFyIGU9MDsxNj5lOysrZSlkW2VdPWIuY2hhckNvZGVBdChjKyspfGIuY2hhckNvZGVBdChjKyspPDw4fGIuY2hhckNvZGVBdChjKyspPDwxNnxiLmNoYXJDb2RlQXQoYysrKTw8MjQ7ZWxzZSBmb3IoZT0wOzE2PmU7KytlKWRbZV09YltjKytdfGJbYysrXTw8OHxiW2MrK108PDE2fGJbYysrXTw8MjQ7Yj1hLmdbMF07Yz1hLmdbMV07ZT1hLmdbMl07dmFyIGY9YS5nWzNdO3ZhciBoPWIrKGZeYyYoZV5mKSkrZFswXSszNjE0MDkwMzYwJjQyOTQ5NjcyOTU7Yj1jKyhoPDw3JjQyOTQ5NjcyOTV8aD4+PjI1KTtoPWYrKGVeYiYoY15lKSkrZFsxXSszOTA1NDAyNzEwJjQyOTQ5NjcyOTU7Zj1iKyhoPDwxMiY0Mjk0OTY3Mjk1fGg+Pj4yMCk7aD1lKyhjXmYmKGJeYykpK2RbMl0rNjA2MTA1ODE5JjQyOTQ5NjcyOTU7ZT1mKyhoPDwxNyY0Mjk0OTY3Mjk1fGg+Pj4xNSk7XG5oPWMrKGJeZSYoZl5iKSkrZFszXSszMjUwNDQxOTY2JjQyOTQ5NjcyOTU7Yz1lKyhoPDwyMiY0Mjk0OTY3Mjk1fGg+Pj4xMCk7aD1iKyhmXmMmKGVeZikpK2RbNF0rNDExODU0ODM5OSY0Mjk0OTY3Mjk1O2I9YysoaDw8NyY0Mjk0OTY3Mjk1fGg+Pj4yNSk7aD1mKyhlXmImKGNeZSkpK2RbNV0rMTIwMDA4MDQyNiY0Mjk0OTY3Mjk1O2Y9YisoaDw8MTImNDI5NDk2NzI5NXxoPj4+MjApO2g9ZSsoY15mJihiXmMpKStkWzZdKzI4MjE3MzU5NTUmNDI5NDk2NzI5NTtlPWYrKGg8PDE3JjQyOTQ5NjcyOTV8aD4+PjE1KTtoPWMrKGJeZSYoZl5iKSkrZFs3XSs0MjQ5MjYxMzEzJjQyOTQ5NjcyOTU7Yz1lKyhoPDwyMiY0Mjk0OTY3Mjk1fGg+Pj4xMCk7aD1iKyhmXmMmKGVeZikpK2RbOF0rMTc3MDAzNTQxNiY0Mjk0OTY3Mjk1O2I9YysoaDw8NyY0Mjk0OTY3Mjk1fGg+Pj4yNSk7aD1mKyhlXmImKGNeZSkpK2RbOV0rMjMzNjU1Mjg3OSY0Mjk0OTY3Mjk1O2Y9YisoaDw8MTImNDI5NDk2NzI5NXxcbmg+Pj4yMCk7aD1lKyhjXmYmKGJeYykpK2RbMTBdKzQyOTQ5MjUyMzMmNDI5NDk2NzI5NTtlPWYrKGg8PDE3JjQyOTQ5NjcyOTV8aD4+PjE1KTtoPWMrKGJeZSYoZl5iKSkrZFsxMV0rMjMwNDU2MzEzNCY0Mjk0OTY3Mjk1O2M9ZSsoaDw8MjImNDI5NDk2NzI5NXxoPj4+MTApO2g9YisoZl5jJihlXmYpKStkWzEyXSsxODA0NjAzNjgyJjQyOTQ5NjcyOTU7Yj1jKyhoPDw3JjQyOTQ5NjcyOTV8aD4+PjI1KTtoPWYrKGVeYiYoY15lKSkrZFsxM10rNDI1NDYyNjE5NSY0Mjk0OTY3Mjk1O2Y9YisoaDw8MTImNDI5NDk2NzI5NXxoPj4+MjApO2g9ZSsoY15mJihiXmMpKStkWzE0XSsyNzkyOTY1MDA2JjQyOTQ5NjcyOTU7ZT1mKyhoPDwxNyY0Mjk0OTY3Mjk1fGg+Pj4xNSk7aD1jKyhiXmUmKGZeYikpK2RbMTVdKzEyMzY1MzUzMjkmNDI5NDk2NzI5NTtjPWUrKGg8PDIyJjQyOTQ5NjcyOTV8aD4+PjEwKTtoPWIrKGVeZiYoY15lKSkrZFsxXSs0MTI5MTcwNzg2JjQyOTQ5NjcyOTU7Yj1jKyhoPDxcbjUmNDI5NDk2NzI5NXxoPj4+MjcpO2g9ZisoY15lJihiXmMpKStkWzZdKzMyMjU0NjU2NjQmNDI5NDk2NzI5NTtmPWIrKGg8PDkmNDI5NDk2NzI5NXxoPj4+MjMpO2g9ZSsoYl5jJihmXmIpKStkWzExXSs2NDM3MTc3MTMmNDI5NDk2NzI5NTtlPWYrKGg8PDE0JjQyOTQ5NjcyOTV8aD4+PjE4KTtoPWMrKGZeYiYoZV5mKSkrZFswXSszOTIxMDY5OTk0JjQyOTQ5NjcyOTU7Yz1lKyhoPDwyMCY0Mjk0OTY3Mjk1fGg+Pj4xMik7aD1iKyhlXmYmKGNeZSkpK2RbNV0rMzU5MzQwODYwNSY0Mjk0OTY3Mjk1O2I9YysoaDw8NSY0Mjk0OTY3Mjk1fGg+Pj4yNyk7aD1mKyhjXmUmKGJeYykpK2RbMTBdKzM4MDE2MDgzJjQyOTQ5NjcyOTU7Zj1iKyhoPDw5JjQyOTQ5NjcyOTV8aD4+PjIzKTtoPWUrKGJeYyYoZl5iKSkrZFsxNV0rMzYzNDQ4ODk2MSY0Mjk0OTY3Mjk1O2U9ZisoaDw8MTQmNDI5NDk2NzI5NXxoPj4+MTgpO2g9YysoZl5iJihlXmYpKStkWzRdKzM4ODk0Mjk0NDgmNDI5NDk2NzI5NTtjPVxuZSsoaDw8MjAmNDI5NDk2NzI5NXxoPj4+MTIpO2g9YisoZV5mJihjXmUpKStkWzldKzU2ODQ0NjQzOCY0Mjk0OTY3Mjk1O2I9YysoaDw8NSY0Mjk0OTY3Mjk1fGg+Pj4yNyk7aD1mKyhjXmUmKGJeYykpK2RbMTRdKzMyNzUxNjM2MDYmNDI5NDk2NzI5NTtmPWIrKGg8PDkmNDI5NDk2NzI5NXxoPj4+MjMpO2g9ZSsoYl5jJihmXmIpKStkWzNdKzQxMDc2MDMzMzUmNDI5NDk2NzI5NTtlPWYrKGg8PDE0JjQyOTQ5NjcyOTV8aD4+PjE4KTtoPWMrKGZeYiYoZV5mKSkrZFs4XSsxMTYzNTMxNTAxJjQyOTQ5NjcyOTU7Yz1lKyhoPDwyMCY0Mjk0OTY3Mjk1fGg+Pj4xMik7aD1iKyhlXmYmKGNeZSkpK2RbMTNdKzI4NTAyODU4MjkmNDI5NDk2NzI5NTtiPWMrKGg8PDUmNDI5NDk2NzI5NXxoPj4+MjcpO2g9ZisoY15lJihiXmMpKStkWzJdKzQyNDM1NjM1MTImNDI5NDk2NzI5NTtmPWIrKGg8PDkmNDI5NDk2NzI5NXxoPj4+MjMpO2g9ZSsoYl5jJihmXmIpKStkWzddKzE3MzUzMjg0NzMmNDI5NDk2NzI5NTtcbmU9ZisoaDw8MTQmNDI5NDk2NzI5NXxoPj4+MTgpO2g9YysoZl5iJihlXmYpKStkWzEyXSsyMzY4MzU5NTYyJjQyOTQ5NjcyOTU7Yz1lKyhoPDwyMCY0Mjk0OTY3Mjk1fGg+Pj4xMik7aD1iKyhjXmVeZikrZFs1XSs0Mjk0NTg4NzM4JjQyOTQ5NjcyOTU7Yj1jKyhoPDw0JjQyOTQ5NjcyOTV8aD4+PjI4KTtoPWYrKGJeY15lKStkWzhdKzIyNzIzOTI4MzMmNDI5NDk2NzI5NTtmPWIrKGg8PDExJjQyOTQ5NjcyOTV8aD4+PjIxKTtoPWUrKGZeYl5jKStkWzExXSsxODM5MDMwNTYyJjQyOTQ5NjcyOTU7ZT1mKyhoPDwxNiY0Mjk0OTY3Mjk1fGg+Pj4xNik7aD1jKyhlXmZeYikrZFsxNF0rNDI1OTY1Nzc0MCY0Mjk0OTY3Mjk1O2M9ZSsoaDw8MjMmNDI5NDk2NzI5NXxoPj4+OSk7aD1iKyhjXmVeZikrZFsxXSsyNzYzOTc1MjM2JjQyOTQ5NjcyOTU7Yj1jKyhoPDw0JjQyOTQ5NjcyOTV8aD4+PjI4KTtoPWYrKGJeY15lKStkWzRdKzEyNzI4OTMzNTMmNDI5NDk2NzI5NTtmPWIrKGg8PDExJjQyOTQ5NjcyOTV8XG5oPj4+MjEpO2g9ZSsoZl5iXmMpK2RbN10rNDEzOTQ2OTY2NCY0Mjk0OTY3Mjk1O2U9ZisoaDw8MTYmNDI5NDk2NzI5NXxoPj4+MTYpO2g9YysoZV5mXmIpK2RbMTBdKzMyMDAyMzY2NTYmNDI5NDk2NzI5NTtjPWUrKGg8PDIzJjQyOTQ5NjcyOTV8aD4+PjkpO2g9YisoY15lXmYpK2RbMTNdKzY4MTI3OTE3NCY0Mjk0OTY3Mjk1O2I9YysoaDw8NCY0Mjk0OTY3Mjk1fGg+Pj4yOCk7aD1mKyhiXmNeZSkrZFswXSszOTM2NDMwMDc0JjQyOTQ5NjcyOTU7Zj1iKyhoPDwxMSY0Mjk0OTY3Mjk1fGg+Pj4yMSk7aD1lKyhmXmJeYykrZFszXSszNTcyNDQ1MzE3JjQyOTQ5NjcyOTU7ZT1mKyhoPDwxNiY0Mjk0OTY3Mjk1fGg+Pj4xNik7aD1jKyhlXmZeYikrZFs2XSs3NjAyOTE4OSY0Mjk0OTY3Mjk1O2M9ZSsoaDw8MjMmNDI5NDk2NzI5NXxoPj4+OSk7aD1iKyhjXmVeZikrZFs5XSszNjU0NjAyODA5JjQyOTQ5NjcyOTU7Yj1jKyhoPDw0JjQyOTQ5NjcyOTV8aD4+PjI4KTtoPWYrKGJeY15lKStkWzEyXStcbjM4NzMxNTE0NjEmNDI5NDk2NzI5NTtmPWIrKGg8PDExJjQyOTQ5NjcyOTV8aD4+PjIxKTtoPWUrKGZeYl5jKStkWzE1XSs1MzA3NDI1MjAmNDI5NDk2NzI5NTtlPWYrKGg8PDE2JjQyOTQ5NjcyOTV8aD4+PjE2KTtoPWMrKGVeZl5iKStkWzJdKzMyOTk2Mjg2NDUmNDI5NDk2NzI5NTtjPWUrKGg8PDIzJjQyOTQ5NjcyOTV8aD4+PjkpO2g9YisoZV4oY3x+ZikpK2RbMF0rNDA5NjMzNjQ1MiY0Mjk0OTY3Mjk1O2I9YysoaDw8NiY0Mjk0OTY3Mjk1fGg+Pj4yNik7aD1mKyhjXihifH5lKSkrZFs3XSsxMTI2ODkxNDE1JjQyOTQ5NjcyOTU7Zj1iKyhoPDwxMCY0Mjk0OTY3Mjk1fGg+Pj4yMik7aD1lKyhiXihmfH5jKSkrZFsxNF0rMjg3ODYxMjM5MSY0Mjk0OTY3Mjk1O2U9ZisoaDw8MTUmNDI5NDk2NzI5NXxoPj4+MTcpO2g9YysoZl4oZXx+YikpK2RbNV0rNDIzNzUzMzI0MSY0Mjk0OTY3Mjk1O2M9ZSsoaDw8MjEmNDI5NDk2NzI5NXxoPj4+MTEpO2g9YisoZV4oY3x+ZikpK2RbMTJdKzE3MDA0ODU1NzEmXG40Mjk0OTY3Mjk1O2I9YysoaDw8NiY0Mjk0OTY3Mjk1fGg+Pj4yNik7aD1mKyhjXihifH5lKSkrZFszXSsyMzk5OTgwNjkwJjQyOTQ5NjcyOTU7Zj1iKyhoPDwxMCY0Mjk0OTY3Mjk1fGg+Pj4yMik7aD1lKyhiXihmfH5jKSkrZFsxMF0rNDI5MzkxNTc3MyY0Mjk0OTY3Mjk1O2U9ZisoaDw8MTUmNDI5NDk2NzI5NXxoPj4+MTcpO2g9YysoZl4oZXx+YikpK2RbMV0rMjI0MDA0NDQ5NyY0Mjk0OTY3Mjk1O2M9ZSsoaDw8MjEmNDI5NDk2NzI5NXxoPj4+MTEpO2g9YisoZV4oY3x+ZikpK2RbOF0rMTg3MzMxMzM1OSY0Mjk0OTY3Mjk1O2I9YysoaDw8NiY0Mjk0OTY3Mjk1fGg+Pj4yNik7aD1mKyhjXihifH5lKSkrZFsxNV0rNDI2NDM1NTU1MiY0Mjk0OTY3Mjk1O2Y9YisoaDw8MTAmNDI5NDk2NzI5NXxoPj4+MjIpO2g9ZSsoYl4oZnx+YykpK2RbNl0rMjczNDc2ODkxNiY0Mjk0OTY3Mjk1O2U9ZisoaDw8MTUmNDI5NDk2NzI5NXxoPj4+MTcpO2g9YysoZl4oZXx+YikpK2RbMTNdKzEzMDkxNTE2NDkmXG40Mjk0OTY3Mjk1O2M9ZSsoaDw8MjEmNDI5NDk2NzI5NXxoPj4+MTEpO2g9YisoZV4oY3x+ZikpK2RbNF0rNDE0OTQ0NDIyNiY0Mjk0OTY3Mjk1O2I9YysoaDw8NiY0Mjk0OTY3Mjk1fGg+Pj4yNik7aD1mKyhjXihifH5lKSkrZFsxMV0rMzE3NDc1NjkxNyY0Mjk0OTY3Mjk1O2Y9YisoaDw8MTAmNDI5NDk2NzI5NXxoPj4+MjIpO2g9ZSsoYl4oZnx+YykpK2RbMl0rNzE4Nzg3MjU5JjQyOTQ5NjcyOTU7ZT1mKyhoPDwxNSY0Mjk0OTY3Mjk1fGg+Pj4xNyk7aD1jKyhmXihlfH5iKSkrZFs5XSszOTUxNDgxNzQ1JjQyOTQ5NjcyOTU7YS5nWzBdPWEuZ1swXStiJjQyOTQ5NjcyOTU7YS5nWzFdPWEuZ1sxXSsoZSsoaDw8MjEmNDI5NDk2NzI5NXxoPj4+MTEpKSY0Mjk0OTY3Mjk1O2EuZ1syXT1hLmdbMl0rZSY0Mjk0OTY3Mjk1O2EuZ1szXT1hLmdbM10rZiY0Mjk0OTY3Mjk1O31cblMucHJvdG90eXBlLmo9ZnVuY3Rpb24oYSxiKXt2b2lkIDA9PT1iJiYoYj1hLmxlbmd0aCk7Zm9yKHZhciBjPWItdGhpcy5ibG9ja1NpemUsZD10aGlzLm0sZT10aGlzLmgsZj0wO2Y8Yjspe2lmKDA9PWUpZm9yKDtmPD1jOylTZCh0aGlzLGEsZiksZis9dGhpcy5ibG9ja1NpemU7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKWZvcig7ZjxiOyl7aWYoZFtlKytdPWEuY2hhckNvZGVBdChmKyspLGU9PXRoaXMuYmxvY2tTaXplKXtTZCh0aGlzLGQpO2U9MDticmVha319ZWxzZSBmb3IoO2Y8YjspaWYoZFtlKytdPWFbZisrXSxlPT10aGlzLmJsb2NrU2l6ZSl7U2QodGhpcyxkKTtlPTA7YnJlYWt9fXRoaXMuaD1lO3RoaXMuaSs9Yjt9O1xuUy5wcm90b3R5cGUubD1mdW5jdGlvbigpe3ZhciBhPUFycmF5KCg1Nj50aGlzLmg/dGhpcy5ibG9ja1NpemU6Mip0aGlzLmJsb2NrU2l6ZSktdGhpcy5oKTthWzBdPTEyODtmb3IodmFyIGI9MTtiPGEubGVuZ3RoLTg7KytiKWFbYl09MDt2YXIgYz04KnRoaXMuaTtmb3IoYj1hLmxlbmd0aC04O2I8YS5sZW5ndGg7KytiKWFbYl09YyYyNTUsYy89MjU2O3RoaXMuaihhKTthPUFycmF5KDE2KTtmb3IoYj1jPTA7ND5iOysrYilmb3IodmFyIGQ9MDszMj5kO2QrPTgpYVtjKytdPXRoaXMuZ1tiXT4+PmQmMjU1O3JldHVybiBhfTtmdW5jdGlvbiBUKGEsYil7dGhpcy5oPWI7Zm9yKHZhciBjPVtdLGQ9ITAsZT1hLmxlbmd0aC0xOzA8PWU7ZS0tKXt2YXIgZj1hW2VdfDA7ZCYmZj09Ynx8KGNbZV09ZixkPSExKTt9dGhpcy5nPWM7fXZhciBzYT17fTtmdW5jdGlvbiBUZChhKXtyZXR1cm4gLTEyODw9YSYmMTI4PmE/cmEoYSxmdW5jdGlvbihiKXtyZXR1cm4gbmV3IFQoW2J8MF0sMD5iPy0xOjApfSk6bmV3IFQoW2F8MF0sMD5hPy0xOjApfWZ1bmN0aW9uIFUoYSl7aWYoaXNOYU4oYSl8fCFpc0Zpbml0ZShhKSlyZXR1cm4gVjtpZigwPmEpcmV0dXJuIFcoVSgtYSkpO2Zvcih2YXIgYj1bXSxjPTEsZD0wO2E+PWM7ZCsrKWJbZF09YS9jfDAsYyo9VWQ7cmV0dXJuIG5ldyBUKGIsMCl9XG5mdW5jdGlvbiBWZChhLGIpe2lmKDA9PWEubGVuZ3RoKXRocm93IEVycm9yKFwibnVtYmVyIGZvcm1hdCBlcnJvcjogZW1wdHkgc3RyaW5nXCIpO2I9Ynx8MTA7aWYoMj5ifHwzNjxiKXRocm93IEVycm9yKFwicmFkaXggb3V0IG9mIHJhbmdlOiBcIitiKTtpZihcIi1cIj09YS5jaGFyQXQoMCkpcmV0dXJuIFcoVmQoYS5zdWJzdHJpbmcoMSksYikpO2lmKDA8PWEuaW5kZXhPZihcIi1cIikpdGhyb3cgRXJyb3IoJ251bWJlciBmb3JtYXQgZXJyb3I6IGludGVyaW9yIFwiLVwiIGNoYXJhY3RlcicpO2Zvcih2YXIgYz1VKE1hdGgucG93KGIsOCkpLGQ9VixlPTA7ZTxhLmxlbmd0aDtlKz04KXt2YXIgZj1NYXRoLm1pbig4LGEubGVuZ3RoLWUpLGg9cGFyc2VJbnQoYS5zdWJzdHJpbmcoZSxlK2YpLGIpOzg+Zj8oZj1VKE1hdGgucG93KGIsZikpLGQ9ZC5SKGYpLmFkZChVKGgpKSk6KGQ9ZC5SKGMpLGQ9ZC5hZGQoVShoKSkpO31yZXR1cm4gZH1cbnZhciBVZD00Mjk0OTY3Mjk2LFY9VGQoMCksV2Q9VGQoMSksWGQ9VGQoMTY3NzcyMTYpO2s9VC5wcm90b3R5cGU7ay5lYT1mdW5jdGlvbigpe2lmKFgodGhpcykpcmV0dXJuIC1XKHRoaXMpLmVhKCk7Zm9yKHZhciBhPTAsYj0xLGM9MDtjPHRoaXMuZy5sZW5ndGg7YysrKXt2YXIgZD10aGlzLkQoYyk7YSs9KDA8PWQ/ZDpVZCtkKSpiO2IqPVVkO31yZXR1cm4gYX07XG5rLnRvU3RyaW5nPWZ1bmN0aW9uKGEpe2E9YXx8MTA7aWYoMj5hfHwzNjxhKXRocm93IEVycm9yKFwicmFkaXggb3V0IG9mIHJhbmdlOiBcIithKTtpZihZKHRoaXMpKXJldHVybiBcIjBcIjtpZihYKHRoaXMpKXJldHVybiBcIi1cIitXKHRoaXMpLnRvU3RyaW5nKGEpO2Zvcih2YXIgYj1VKE1hdGgucG93KGEsNikpLGM9dGhpcyxkPVwiXCI7Oyl7dmFyIGU9WWQoYyxiKS5nO2M9WmQoYyxlLlIoYikpO3ZhciBmPSgoMDxjLmcubGVuZ3RoP2MuZ1swXTpjLmgpPj4+MCkudG9TdHJpbmcoYSk7Yz1lO2lmKFkoYykpcmV0dXJuIGYrZDtmb3IoOzY+Zi5sZW5ndGg7KWY9XCIwXCIrZjtkPWYrZDt9fTtrLkQ9ZnVuY3Rpb24oYSl7cmV0dXJuIDA+YT8wOmE8dGhpcy5nLmxlbmd0aD90aGlzLmdbYV06dGhpcy5ofTtmdW5jdGlvbiBZKGEpe2lmKDAhPWEuaClyZXR1cm4gITE7Zm9yKHZhciBiPTA7YjxhLmcubGVuZ3RoO2IrKylpZigwIT1hLmdbYl0pcmV0dXJuICExO3JldHVybiAhMH1cbmZ1bmN0aW9uIFgoYSl7cmV0dXJuIC0xPT1hLmh9ay5YPWZ1bmN0aW9uKGEpe2E9WmQodGhpcyxhKTtyZXR1cm4gWChhKT8tMTpZKGEpPzA6MX07ZnVuY3Rpb24gVyhhKXtmb3IodmFyIGI9YS5nLmxlbmd0aCxjPVtdLGQ9MDtkPGI7ZCsrKWNbZF09fmEuZ1tkXTtyZXR1cm4gKG5ldyBUKGMsfmEuaCkpLmFkZChXZCl9ay5hYnM9ZnVuY3Rpb24oKXtyZXR1cm4gWCh0aGlzKT9XKHRoaXMpOnRoaXN9O2suYWRkPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1NYXRoLm1heCh0aGlzLmcubGVuZ3RoLGEuZy5sZW5ndGgpLGM9W10sZD0wLGU9MDtlPD1iO2UrKyl7dmFyIGY9ZCsodGhpcy5EKGUpJjY1NTM1KSsoYS5EKGUpJjY1NTM1KSxoPShmPj4+MTYpKyh0aGlzLkQoZSk+Pj4xNikrKGEuRChlKT4+PjE2KTtkPWg+Pj4xNjtmJj02NTUzNTtoJj02NTUzNTtjW2VdPWg8PDE2fGY7fXJldHVybiBuZXcgVChjLGNbYy5sZW5ndGgtMV0mLTIxNDc0ODM2NDg/LTE6MCl9O1xuZnVuY3Rpb24gWmQoYSxiKXtyZXR1cm4gYS5hZGQoVyhiKSl9XG5rLlI9ZnVuY3Rpb24oYSl7aWYoWSh0aGlzKXx8WShhKSlyZXR1cm4gVjtpZihYKHRoaXMpKXJldHVybiBYKGEpP1codGhpcykuUihXKGEpKTpXKFcodGhpcykuUihhKSk7aWYoWChhKSlyZXR1cm4gVyh0aGlzLlIoVyhhKSkpO2lmKDA+dGhpcy5YKFhkKSYmMD5hLlgoWGQpKXJldHVybiBVKHRoaXMuZWEoKSphLmVhKCkpO2Zvcih2YXIgYj10aGlzLmcubGVuZ3RoK2EuZy5sZW5ndGgsYz1bXSxkPTA7ZDwyKmI7ZCsrKWNbZF09MDtmb3IoZD0wO2Q8dGhpcy5nLmxlbmd0aDtkKyspZm9yKHZhciBlPTA7ZTxhLmcubGVuZ3RoO2UrKyl7dmFyIGY9dGhpcy5EKGQpPj4+MTYsaD10aGlzLkQoZCkmNjU1MzUsbj1hLkQoZSk+Pj4xNix0PWEuRChlKSY2NTUzNTtjWzIqZCsyKmVdKz1oKnQ7JGQoYywyKmQrMiplKTtjWzIqZCsyKmUrMV0rPWYqdDskZChjLDIqZCsyKmUrMSk7Y1syKmQrMiplKzFdKz1oKm47JGQoYywyKmQrMiplKzEpO2NbMipkKzIqZSsyXSs9ZipuOyRkKGMsMipkKzIqZSsyKTt9Zm9yKGQ9XG4wO2Q8YjtkKyspY1tkXT1jWzIqZCsxXTw8MTZ8Y1syKmRdO2ZvcihkPWI7ZDwyKmI7ZCsrKWNbZF09MDtyZXR1cm4gbmV3IFQoYywwKX07ZnVuY3Rpb24gJGQoYSxiKXtmb3IoOyhhW2JdJjY1NTM1KSE9YVtiXTspYVtiKzFdKz1hW2JdPj4+MTYsYVtiXSY9NjU1MzUsYisrO31mdW5jdGlvbiBhZShhLGIpe3RoaXMuZz1hO3RoaXMuaD1iO31cbmZ1bmN0aW9uIFlkKGEsYil7aWYoWShiKSl0aHJvdyBFcnJvcihcImRpdmlzaW9uIGJ5IHplcm9cIik7aWYoWShhKSlyZXR1cm4gbmV3IGFlKFYsVik7aWYoWChhKSlyZXR1cm4gYj1ZZChXKGEpLGIpLG5ldyBhZShXKGIuZyksVyhiLmgpKTtpZihYKGIpKXJldHVybiBiPVlkKGEsVyhiKSksbmV3IGFlKFcoYi5nKSxiLmgpO2lmKDMwPGEuZy5sZW5ndGgpe2lmKFgoYSl8fFgoYikpdGhyb3cgRXJyb3IoXCJzbG93RGl2aWRlXyBvbmx5IHdvcmtzIHdpdGggcG9zaXRpdmUgaW50ZWdlcnMuXCIpO2Zvcih2YXIgYz1XZCxkPWI7MD49ZC5YKGEpOyljPWJlKGMpLGQ9YmUoZCk7dmFyIGU9WihjLDEpLGY9WihkLDEpO2Q9WihkLDIpO2ZvcihjPVooYywyKTshWShkKTspe3ZhciBoPWYuYWRkKGQpOzA+PWguWChhKSYmKGU9ZS5hZGQoYyksZj1oKTtkPVooZCwxKTtjPVooYywxKTt9Yj1aZChhLGUuUihiKSk7cmV0dXJuIG5ldyBhZShlLGIpfWZvcihlPVY7MDw9YS5YKGIpOyl7Yz1NYXRoLm1heCgxLE1hdGguZmxvb3IoYS5lYSgpL1xuYi5lYSgpKSk7ZD1NYXRoLmNlaWwoTWF0aC5sb2coYykvTWF0aC5MTjIpO2Q9NDg+PWQ/MTpNYXRoLnBvdygyLGQtNDgpO2Y9VShjKTtmb3IoaD1mLlIoYik7WChoKXx8MDxoLlgoYSk7KWMtPWQsZj1VKGMpLGg9Zi5SKGIpO1koZikmJihmPVdkKTtlPWUuYWRkKGYpO2E9WmQoYSxoKTt9cmV0dXJuIG5ldyBhZShlLGEpfWsuZ2I9ZnVuY3Rpb24oYSl7cmV0dXJuIFlkKHRoaXMsYSkuaH07ay5hbmQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPU1hdGgubWF4KHRoaXMuZy5sZW5ndGgsYS5nLmxlbmd0aCksYz1bXSxkPTA7ZDxiO2QrKyljW2RdPXRoaXMuRChkKSZhLkQoZCk7cmV0dXJuIG5ldyBUKGMsdGhpcy5oJmEuaCl9O2sub3I9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPU1hdGgubWF4KHRoaXMuZy5sZW5ndGgsYS5nLmxlbmd0aCksYz1bXSxkPTA7ZDxiO2QrKyljW2RdPXRoaXMuRChkKXxhLkQoZCk7cmV0dXJuIG5ldyBUKGMsdGhpcy5ofGEuaCl9O1xuay54b3I9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPU1hdGgubWF4KHRoaXMuZy5sZW5ndGgsYS5nLmxlbmd0aCksYz1bXSxkPTA7ZDxiO2QrKyljW2RdPXRoaXMuRChkKV5hLkQoZCk7cmV0dXJuIG5ldyBUKGMsdGhpcy5oXmEuaCl9O2Z1bmN0aW9uIGJlKGEpe2Zvcih2YXIgYj1hLmcubGVuZ3RoKzEsYz1bXSxkPTA7ZDxiO2QrKyljW2RdPWEuRChkKTw8MXxhLkQoZC0xKT4+PjMxO3JldHVybiBuZXcgVChjLGEuaCl9ZnVuY3Rpb24gWihhLGIpe3ZhciBjPWI+PjU7YiU9MzI7Zm9yKHZhciBkPWEuZy5sZW5ndGgtYyxlPVtdLGY9MDtmPGQ7ZisrKWVbZl09MDxiP2EuRChmK2MpPj4+YnxhLkQoZitjKzEpPDwzMi1iOmEuRChmK2MpO3JldHVybiBuZXcgVChlLGEuaCl9T2QucHJvdG90eXBlLmNyZWF0ZVdlYkNoYW5uZWw9T2QucHJvdG90eXBlLmc7US5wcm90b3R5cGUuc2VuZD1RLnByb3RvdHlwZS51O1EucHJvdG90eXBlLm9wZW49US5wcm90b3R5cGUubTtRLnByb3RvdHlwZS5jbG9zZT1RLnByb3RvdHlwZS5jbG9zZTtTYi5OT19FUlJPUj0wO1NiLlRJTUVPVVQ9ODtTYi5IVFRQX0VSUk9SPTY7VGIuQ09NUExFVEU9XCJjb21wbGV0ZVwiO1diLkV2ZW50VHlwZT1YYjtYYi5PUEVOPVwiYVwiO1hiLkNMT1NFPVwiYlwiO1hiLkVSUk9SPVwiY1wiO1hiLk1FU1NBR0U9XCJkXCI7Qi5wcm90b3R5cGUubGlzdGVuPUIucHJvdG90eXBlLk87UC5wcm90b3R5cGUubGlzdGVuT25jZT1QLnByb3RvdHlwZS5QO1AucHJvdG90eXBlLmdldExhc3RFcnJvcj1QLnByb3RvdHlwZS5TYTtQLnByb3RvdHlwZS5nZXRMYXN0RXJyb3JDb2RlPVAucHJvdG90eXBlLklhO1AucHJvdG90eXBlLmdldFN0YXR1cz1QLnByb3RvdHlwZS5kYTtQLnByb3RvdHlwZS5nZXRSZXNwb25zZUpzb249UC5wcm90b3R5cGUuV2E7XG5QLnByb3RvdHlwZS5nZXRSZXNwb25zZVRleHQ9UC5wcm90b3R5cGUuamE7UC5wcm90b3R5cGUuc2VuZD1QLnByb3RvdHlwZS5oYTtQLnByb3RvdHlwZS5zZXRXaXRoQ3JlZGVudGlhbHM9UC5wcm90b3R5cGUuT2E7Uy5wcm90b3R5cGUuZGlnZXN0PVMucHJvdG90eXBlLmw7Uy5wcm90b3R5cGUucmVzZXQ9Uy5wcm90b3R5cGUucmVzZXQ7Uy5wcm90b3R5cGUudXBkYXRlPVMucHJvdG90eXBlLmo7VC5wcm90b3R5cGUuYWRkPVQucHJvdG90eXBlLmFkZDtULnByb3RvdHlwZS5tdWx0aXBseT1ULnByb3RvdHlwZS5SO1QucHJvdG90eXBlLm1vZHVsbz1ULnByb3RvdHlwZS5nYjtULnByb3RvdHlwZS5jb21wYXJlPVQucHJvdG90eXBlLlg7VC5wcm90b3R5cGUudG9OdW1iZXI9VC5wcm90b3R5cGUuZWE7VC5wcm90b3R5cGUudG9TdHJpbmc9VC5wcm90b3R5cGUudG9TdHJpbmc7VC5wcm90b3R5cGUuZ2V0Qml0cz1ULnByb3RvdHlwZS5EO1QuZnJvbU51bWJlcj1VO1QuZnJvbVN0cmluZz1WZDtcbnZhciBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0ID0gZXNtLmNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IE9kfTt2YXIgZ2V0U3RhdEV2ZW50VGFyZ2V0ID0gZXNtLmdldFN0YXRFdmVudFRhcmdldD1mdW5jdGlvbigpe3JldHVybiBNYigpfTt2YXIgRXJyb3JDb2RlID0gZXNtLkVycm9yQ29kZT1TYjt2YXIgRXZlbnRUeXBlID0gZXNtLkV2ZW50VHlwZT1UYjt2YXIgRXZlbnQgPSBlc20uRXZlbnQ9RTt2YXIgU3RhdCA9IGVzbS5TdGF0PXt4YjowLEFiOjEsQmI6MixVYjozLFpiOjQsV2I6NSxYYjo2LFZiOjcsVGI6OCxZYjo5LFBST1hZOjEwLE5PUFJPWFk6MTEsUmI6MTIsTmI6MTMsT2I6MTQsTWI6MTUsUGI6MTYsUWI6MTcsdGI6MTgsc2I6MTksdWI6MjB9O3ZhciBGZXRjaFhtbEh0dHBGYWN0b3J5ID0gZXNtLkZldGNoWG1sSHR0cEZhY3Rvcnk9bGQ7dmFyIFdlYkNoYW5uZWwgPSBlc20uV2ViQ2hhbm5lbD1XYjt2YXIgWGhySW8gPSBlc20uWGhySW89UDt2YXIgTWQ1ID0gZXNtLk1kNT1TO3ZhciBJbnRlZ2VyID0gZXNtLkludGVnZXI9VDtcblxuZXhwb3J0IHsgRXJyb3JDb2RlLCBFdmVudCwgRXZlbnRUeXBlLCBGZXRjaFhtbEh0dHBGYWN0b3J5LCBJbnRlZ2VyLCBNZDUsIFN0YXQsIFdlYkNoYW5uZWwsIFhocklvLCBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0LCBlc20gYXMgZGVmYXVsdCwgZ2V0U3RhdEV2ZW50VGFyZ2V0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24sIF9nZXRQcm92aWRlciwgZ2V0QXBwLCBfcmVtb3ZlU2VydmljZUluc3RhbmNlLCBTREtfVkVSU0lPTiB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBMb2dnZXIsIExvZ0xldmVsIH0gZnJvbSAnQGZpcmViYXNlL2xvZ2dlcic7XG5pbXBvcnQgeyBGaXJlYmFzZUVycm9yLCBjcmVhdGVNb2NrVXNlclRva2VuLCBnZXRNb2R1bGFySW5zdGFuY2UsIGRlZXBFcXVhbCwgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0LCBnZXRVQSwgaXNJbmRleGVkREJBdmFpbGFibGUsIGlzU2FmYXJpIH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgSW50ZWdlciwgWGhySW8sIEV2ZW50VHlwZSwgRXJyb3JDb2RlLCBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0LCBnZXRTdGF0RXZlbnRUYXJnZXQsIEZldGNoWG1sSHR0cEZhY3RvcnksIFdlYkNoYW5uZWwsIEV2ZW50LCBTdGF0LCBNZDUgfSBmcm9tICdAZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyJztcblxuY29uc3QgUyA9IFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTaW1wbGUgd3JhcHBlciBhcm91bmQgYSBudWxsYWJsZSBVSUQuIE1vc3RseSBleGlzdHMgdG8gbWFrZSBjb2RlIG1vcmVcbiAqIHJlYWRhYmxlLlxuICovXG5jbGFzcyBVc2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudWlkID0gZTtcbiAgICB9XG4gICAgaXNBdXRoZW50aWNhdGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLnVpZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGtleSByZXByZXNlbnRpbmcgdGhpcyB1c2VyLCBzdWl0YWJsZSBmb3IgaW5jbHVzaW9uIGluIGFcbiAgICAgKiBkaWN0aW9uYXJ5LlxuICAgICAqLyAgICB0b0tleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNBdXRoZW50aWNhdGVkKCkgPyBcInVpZDpcIiArIHRoaXMudWlkIDogXCJhbm9ueW1vdXMtdXNlclwiO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUudWlkID09PSB0aGlzLnVpZDtcbiAgICB9XG59XG5cbi8qKiBBIHVzZXIgd2l0aCBhIG51bGwgVUlELiAqLyBVc2VyLlVOQVVUSEVOVElDQVRFRCA9IG5ldyBVc2VyKG51bGwpLCBcbi8vIFRPRE8obWlrZWxlaGVuKTogTG9vayBpbnRvIGdldHRpbmcgYSBwcm9wZXIgdWlkLWVxdWl2YWxlbnQgZm9yXG4vLyBub24tRmlyZWJhc2VBdXRoIHByb3ZpZGVycy5cblVzZXIuR09PR0xFX0NSRURFTlRJQUxTID0gbmV3IFVzZXIoXCJnb29nbGUtY3JlZGVudGlhbHMtdWlkXCIpLCBVc2VyLkZJUlNUX1BBUlRZID0gbmV3IFVzZXIoXCJmaXJzdC1wYXJ0eS11aWRcIiksIFxuVXNlci5NT0NLX1VTRVIgPSBuZXcgVXNlcihcIm1vY2stdXNlclwiKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBiID0gXCIxMC4xLjBcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IEQgPSBuZXcgTG9nZ2VyKFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcblxuLy8gSGVscGVyIG1ldGhvZHMgYXJlIG5lZWRlZCBiZWNhdXNlIHZhcmlhYmxlcyBjYW4ndCBiZSBleHBvcnRlZCBhcyByZWFkL3dyaXRlXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TG9nTGV2ZWwoKSB7XG4gICAgcmV0dXJuIEQubG9nTGV2ZWw7XG59XG5cbi8qKlxuICogU2V0cyB0aGUgdmVyYm9zaXR5IG9mIENsb3VkIEZpcmVzdG9yZSBsb2dzIChkZWJ1ZywgZXJyb3IsIG9yIHNpbGVudCkuXG4gKlxuICogQHBhcmFtIGxvZ0xldmVsIC0gVGhlIHZlcmJvc2l0eSB5b3Ugc2V0IGZvciBhY3Rpdml0eSBhbmQgZXJyb3IgbG9nZ2luZy4gQ2FuXG4gKiAgIGJlIGFueSBvZiB0aGUgZm9sbG93aW5nIHZhbHVlczpcbiAqXG4gKiAgIDx1bD5cbiAqICAgICA8bGk+YGRlYnVnYCBmb3IgdGhlIG1vc3QgdmVyYm9zZSBsb2dnaW5nIGxldmVsLCBwcmltYXJpbHkgZm9yXG4gKiAgICAgZGVidWdnaW5nLjwvbGk+XG4gKiAgICAgPGxpPmBlcnJvcmAgdG8gbG9nIGVycm9ycyBvbmx5LjwvbGk+XG4gKiAgICAgPGxpPjxjb2RlPmBzaWxlbnRgIHRvIHR1cm4gb2ZmIGxvZ2dpbmcuPC9saT5cbiAqICAgPC91bD5cbiAqLyBmdW5jdGlvbiBzZXRMb2dMZXZlbChlKSB7XG4gICAgRC5zZXRMb2dMZXZlbChlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvZ0RlYnVnKGUsIC4uLnQpIHtcbiAgICBpZiAoRC5sb2dMZXZlbCA8PSBMb2dMZXZlbC5ERUJVRykge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgRC5kZWJ1ZyhgRmlyZXN0b3JlICgke2J9KTogJHtlfWAsIC4uLm4pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvZ0Vycm9yKGUsIC4uLnQpIHtcbiAgICBpZiAoRC5sb2dMZXZlbCA8PSBMb2dMZXZlbC5FUlJPUikge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgRC5lcnJvcihgRmlyZXN0b3JlICgke2J9KTogJHtlfWAsIC4uLm4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9nV2FybihlLCAuLi50KSB7XG4gICAgaWYgKEQubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuV0FSTikge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgRC53YXJuKGBGaXJlc3RvcmUgKCR7Yn0pOiAke2V9YCwgLi4ubik7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIGFuIGFkZGl0aW9uYWwgbG9nIHBhcmFtZXRlciB0byBhIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYXJnVG9TdHJpbmcoZSkge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4gZTtcbiAgICB0cnkge1xuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgICAgICAvKiogRm9ybWF0cyBhbiBvYmplY3QgYXMgYSBKU09OIHN0cmluZywgc3VpdGFibGUgZm9yIGxvZ2dpbmcuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZm9ybWF0SlNPTihlKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgICAgIH0oZSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICAvLyBDb252ZXJ0aW5nIHRvIEpTT04gZmFpbGVkLCBqdXN0IGxvZyB0aGUgb2JqZWN0IGRpcmVjdGx5XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVW5jb25kaXRpb25hbGx5IGZhaWxzLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLlxuICogTWVzc2FnZXMgYXJlIHN0cmlwcGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzLlxuICpcbiAqIFJldHVybnMgYG5ldmVyYCBhbmQgY2FuIGJlIHVzZWQgaW4gZXhwcmVzc2lvbnM6XG4gKiBAZXhhbXBsZVxuICogbGV0IGZ1dHVyZVZhciA9IGZhaWwoJ25vdCBpbXBsZW1lbnRlZCB5ZXQnKTtcbiAqLyBmdW5jdGlvbiBmYWlsKGUgPSBcIlVuZXhwZWN0ZWQgc3RhdGVcIikge1xuICAgIC8vIExvZyB0aGUgZmFpbHVyZSBpbiBhZGRpdGlvbiB0byB0aHJvdyBhbiBleGNlcHRpb24sIGp1c3QgaW4gY2FzZSB0aGVcbiAgICAvLyBleGNlcHRpb24gaXMgc3dhbGxvd2VkLlxuICAgIGNvbnN0IHQgPSBgRklSRVNUT1JFICgke2J9KSBJTlRFUk5BTCBBU1NFUlRJT04gRkFJTEVEOiBgICsgZTtcbiAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgRmlyZXN0b3JlRXJyb3IgaGVyZSBiZWNhdXNlIHRoZXNlIGFyZSBpbnRlcm5hbCBmYWlsdXJlc1xuICAgIC8vIHRoYXQgY2Fubm90IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIuIChBbHNvIGl0IHdvdWxkIGNyZWF0ZSBhIGNpcmN1bGFyXG4gICAgLy8gZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBlcnJvciBhbmQgYXNzZXJ0IG1vZHVsZXMgd2hpY2ggZG9lc24ndCB3b3JrLilcbiAgICB0aHJvdyBfX1BSSVZBVEVfbG9nRXJyb3IodCksIG5ldyBFcnJvcih0KTtcbn1cblxuLyoqXG4gKiBGYWlscyBpZiB0aGUgZ2l2ZW4gYXNzZXJ0aW9uIGNvbmRpdGlvbiBpcyBmYWxzZSwgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGVcbiAqIGdpdmVuIG1lc3NhZ2UgaWYgaXQgZGlkLlxuICpcbiAqIE1lc3NhZ2VzIGFyZSBzdHJpcHBlZCBpbiBwcm9kdWN0aW9uIGJ1aWxkcy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaGFyZEFzc2VydChlLCB0KSB7XG4gICAgZSB8fCBmYWlsKCk7XG59XG5cbi8qKlxuICogRmFpbHMgaWYgdGhlIGdpdmVuIGFzc2VydGlvbiBjb25kaXRpb24gaXMgZmFsc2UsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlXG4gKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC5cbiAqXG4gKiBUaGUgY29kZSBvZiBjYWxsc2l0ZXMgaW52b2tpbmcgdGhpcyBmdW5jdGlvbiBhcmUgc3RyaXBwZWQgb3V0IGluIHByb2R1Y3Rpb25cbiAqIGJ1aWxkcy4gQW55IHNpZGUtZWZmZWN0cyBvZiBjb2RlIHdpdGhpbiB0aGUgZGVidWdBc3NlcnQoKSBpbnZvY2F0aW9uIHdpbGwgbm90XG4gKiBoYXBwZW4gaW4gdGhpcyBjYXNlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kZWJ1Z0Fzc2VydChlLCB0KSB7XG4gICAgZSB8fCBmYWlsKCk7XG59XG5cbi8qKlxuICogQ2FzdHMgYG9iamAgdG8gYFRgLiBJbiBub24tcHJvZHVjdGlvbiBidWlsZHMsIHZlcmlmaWVzIHRoYXQgYG9iamAgaXMgYW5cbiAqIGluc3RhbmNlIG9mIGBUYCBiZWZvcmUgY2FzdGluZy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVidWdDYXN0KGUsIFxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbnQpIHtcbiAgICByZXR1cm4gZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgdiA9IHtcbiAgICAvLyBDYXVzZXMgYXJlIGNvcGllZCBmcm9tOlxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ncnBjL2dycGMvYmxvYi9iY2VlYzk0ZWE0ZmM1ZjAwODVkODEyMzVkOGUxYzA2Nzk4ZGMzNDFhL2luY2x1ZGUvZ3JwYyUyQiUyQi9pbXBsL2NvZGVnZW4vc3RhdHVzX2NvZGVfZW51bS5oXG4gICAgLyoqIE5vdCBhbiBlcnJvcjsgcmV0dXJuZWQgb24gc3VjY2Vzcy4gKi9cbiAgICBPSzogXCJva1wiLFxuICAgIC8qKiBUaGUgb3BlcmF0aW9uIHdhcyBjYW5jZWxsZWQgKHR5cGljYWxseSBieSB0aGUgY2FsbGVyKS4gKi9cbiAgICBDQU5DRUxMRUQ6IFwiY2FuY2VsbGVkXCIsXG4gICAgLyoqIFVua25vd24gZXJyb3Igb3IgYW4gZXJyb3IgZnJvbSBhIGRpZmZlcmVudCBlcnJvciBkb21haW4uICovXG4gICAgVU5LTk9XTjogXCJ1bmtub3duXCIsXG4gICAgLyoqXG4gICAgICogQ2xpZW50IHNwZWNpZmllZCBhbiBpbnZhbGlkIGFyZ3VtZW50LiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb21cbiAgICAgKiBGQUlMRURfUFJFQ09ORElUSU9OLiBJTlZBTElEX0FSR1VNRU5UIGluZGljYXRlcyBhcmd1bWVudHMgdGhhdCBhcmVcbiAgICAgKiBwcm9ibGVtYXRpYyByZWdhcmRsZXNzIG9mIHRoZSBzdGF0ZSBvZiB0aGUgc3lzdGVtIChlLmcuLCBhIG1hbGZvcm1lZCBmaWxlXG4gICAgICogbmFtZSkuXG4gICAgICovXG4gICAgSU5WQUxJRF9BUkdVTUVOVDogXCJpbnZhbGlkLWFyZ3VtZW50XCIsXG4gICAgLyoqXG4gICAgICogRGVhZGxpbmUgZXhwaXJlZCBiZWZvcmUgb3BlcmF0aW9uIGNvdWxkIGNvbXBsZXRlLiBGb3Igb3BlcmF0aW9ucyB0aGF0XG4gICAgICogY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGUgc3lzdGVtLCB0aGlzIGVycm9yIG1heSBiZSByZXR1cm5lZCBldmVuIGlmIHRoZVxuICAgICAqIG9wZXJhdGlvbiBoYXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4gRm9yIGV4YW1wbGUsIGEgc3VjY2Vzc2Z1bCByZXNwb25zZVxuICAgICAqIGZyb20gYSBzZXJ2ZXIgY291bGQgaGF2ZSBiZWVuIGRlbGF5ZWQgbG9uZyBlbm91Z2ggZm9yIHRoZSBkZWFkbGluZSB0b1xuICAgICAqIGV4cGlyZS5cbiAgICAgKi9cbiAgICBERUFETElORV9FWENFRURFRDogXCJkZWFkbGluZS1leGNlZWRlZFwiLFxuICAgIC8qKiBTb21lIHJlcXVlc3RlZCBlbnRpdHkgKGUuZy4sIGZpbGUgb3IgZGlyZWN0b3J5KSB3YXMgbm90IGZvdW5kLiAqL1xuICAgIE5PVF9GT1VORDogXCJub3QtZm91bmRcIixcbiAgICAvKipcbiAgICAgKiBTb21lIGVudGl0eSB0aGF0IHdlIGF0dGVtcHRlZCB0byBjcmVhdGUgKGUuZy4sIGZpbGUgb3IgZGlyZWN0b3J5KSBhbHJlYWR5XG4gICAgICogZXhpc3RzLlxuICAgICAqL1xuICAgIEFMUkVBRFlfRVhJU1RTOiBcImFscmVhZHktZXhpc3RzXCIsXG4gICAgLyoqXG4gICAgICogVGhlIGNhbGxlciBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gZXhlY3V0ZSB0aGUgc3BlY2lmaWVkIG9wZXJhdGlvbi5cbiAgICAgKiBQRVJNSVNTSU9OX0RFTklFRCBtdXN0IG5vdCBiZSB1c2VkIGZvciByZWplY3Rpb25zIGNhdXNlZCBieSBleGhhdXN0aW5nXG4gICAgICogc29tZSByZXNvdXJjZSAodXNlIFJFU09VUkNFX0VYSEFVU1RFRCBpbnN0ZWFkIGZvciB0aG9zZSBlcnJvcnMpLlxuICAgICAqIFBFUk1JU1NJT05fREVOSUVEIG11c3Qgbm90IGJlIHVzZWQgaWYgdGhlIGNhbGxlciBjYW4gbm90IGJlIGlkZW50aWZpZWRcbiAgICAgKiAodXNlIFVOQVVUSEVOVElDQVRFRCBpbnN0ZWFkIGZvciB0aG9zZSBlcnJvcnMpLlxuICAgICAqL1xuICAgIFBFUk1JU1NJT05fREVOSUVEOiBcInBlcm1pc3Npb24tZGVuaWVkXCIsXG4gICAgLyoqXG4gICAgICogVGhlIHJlcXVlc3QgZG9lcyBub3QgaGF2ZSB2YWxpZCBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFscyBmb3IgdGhlXG4gICAgICogb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIFVOQVVUSEVOVElDQVRFRDogXCJ1bmF1dGhlbnRpY2F0ZWRcIixcbiAgICAvKipcbiAgICAgKiBTb21lIHJlc291cmNlIGhhcyBiZWVuIGV4aGF1c3RlZCwgcGVyaGFwcyBhIHBlci11c2VyIHF1b3RhLCBvciBwZXJoYXBzIHRoZVxuICAgICAqIGVudGlyZSBmaWxlIHN5c3RlbSBpcyBvdXQgb2Ygc3BhY2UuXG4gICAgICovXG4gICAgUkVTT1VSQ0VfRVhIQVVTVEVEOiBcInJlc291cmNlLWV4aGF1c3RlZFwiLFxuICAgIC8qKlxuICAgICAqIE9wZXJhdGlvbiB3YXMgcmVqZWN0ZWQgYmVjYXVzZSB0aGUgc3lzdGVtIGlzIG5vdCBpbiBhIHN0YXRlIHJlcXVpcmVkIGZvclxuICAgICAqIHRoZSBvcGVyYXRpb24ncyBleGVjdXRpb24uIEZvciBleGFtcGxlLCBkaXJlY3RvcnkgdG8gYmUgZGVsZXRlZCBtYXkgYmVcbiAgICAgKiBub24tZW1wdHksIGFuIHJtZGlyIG9wZXJhdGlvbiBpcyBhcHBsaWVkIHRvIGEgbm9uLWRpcmVjdG9yeSwgZXRjLlxuICAgICAqXG4gICAgICogQSBsaXRtdXMgdGVzdCB0aGF0IG1heSBoZWxwIGEgc2VydmljZSBpbXBsZW1lbnRvciBpbiBkZWNpZGluZ1xuICAgICAqIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiwgQUJPUlRFRCwgYW5kIFVOQVZBSUxBQkxFOlxuICAgICAqICAoYSkgVXNlIFVOQVZBSUxBQkxFIGlmIHRoZSBjbGllbnQgY2FuIHJldHJ5IGp1c3QgdGhlIGZhaWxpbmcgY2FsbC5cbiAgICAgKiAgKGIpIFVzZSBBQk9SVEVEIGlmIHRoZSBjbGllbnQgc2hvdWxkIHJldHJ5IGF0IGEgaGlnaGVyLWxldmVsXG4gICAgICogICAgICAoZS5nLiwgcmVzdGFydGluZyBhIHJlYWQtbW9kaWZ5LXdyaXRlIHNlcXVlbmNlKS5cbiAgICAgKiAgKGMpIFVzZSBGQUlMRURfUFJFQ09ORElUSU9OIGlmIHRoZSBjbGllbnQgc2hvdWxkIG5vdCByZXRyeSB1bnRpbFxuICAgICAqICAgICAgdGhlIHN5c3RlbSBzdGF0ZSBoYXMgYmVlbiBleHBsaWNpdGx5IGZpeGVkLiBFLmcuLCBpZiBhbiBcInJtZGlyXCJcbiAgICAgKiAgICAgIGZhaWxzIGJlY2F1c2UgdGhlIGRpcmVjdG9yeSBpcyBub24tZW1wdHksIEZBSUxFRF9QUkVDT05ESVRJT05cbiAgICAgKiAgICAgIHNob3VsZCBiZSByZXR1cm5lZCBzaW5jZSB0aGUgY2xpZW50IHNob3VsZCBub3QgcmV0cnkgdW5sZXNzXG4gICAgICogICAgICB0aGV5IGhhdmUgZmlyc3QgZml4ZWQgdXAgdGhlIGRpcmVjdG9yeSBieSBkZWxldGluZyBmaWxlcyBmcm9tIGl0LlxuICAgICAqICAoZCkgVXNlIEZBSUxFRF9QUkVDT05ESVRJT04gaWYgdGhlIGNsaWVudCBwZXJmb3JtcyBjb25kaXRpb25hbFxuICAgICAqICAgICAgUkVTVCBHZXQvVXBkYXRlL0RlbGV0ZSBvbiBhIHJlc291cmNlIGFuZCB0aGUgcmVzb3VyY2Ugb24gdGhlXG4gICAgICogICAgICBzZXJ2ZXIgZG9lcyBub3QgbWF0Y2ggdGhlIGNvbmRpdGlvbi4gRS5nLiwgY29uZmxpY3RpbmdcbiAgICAgKiAgICAgIHJlYWQtbW9kaWZ5LXdyaXRlIG9uIHRoZSBzYW1lIHJlc291cmNlLlxuICAgICAqL1xuICAgIEZBSUxFRF9QUkVDT05ESVRJT046IFwiZmFpbGVkLXByZWNvbmRpdGlvblwiLFxuICAgIC8qKlxuICAgICAqIFRoZSBvcGVyYXRpb24gd2FzIGFib3J0ZWQsIHR5cGljYWxseSBkdWUgdG8gYSBjb25jdXJyZW5jeSBpc3N1ZSBsaWtlXG4gICAgICogc2VxdWVuY2VyIGNoZWNrIGZhaWx1cmVzLCB0cmFuc2FjdGlvbiBhYm9ydHMsIGV0Yy5cbiAgICAgKlxuICAgICAqIFNlZSBsaXRtdXMgdGVzdCBhYm92ZSBmb3IgZGVjaWRpbmcgYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OLCBBQk9SVEVELFxuICAgICAqIGFuZCBVTkFWQUlMQUJMRS5cbiAgICAgKi9cbiAgICBBQk9SVEVEOiBcImFib3J0ZWRcIixcbiAgICAvKipcbiAgICAgKiBPcGVyYXRpb24gd2FzIGF0dGVtcHRlZCBwYXN0IHRoZSB2YWxpZCByYW5nZS4gRS5nLiwgc2Vla2luZyBvciByZWFkaW5nXG4gICAgICogcGFzdCBlbmQgb2YgZmlsZS5cbiAgICAgKlxuICAgICAqIFVubGlrZSBJTlZBTElEX0FSR1VNRU5ULCB0aGlzIGVycm9yIGluZGljYXRlcyBhIHByb2JsZW0gdGhhdCBtYXkgYmUgZml4ZWRcbiAgICAgKiBpZiB0aGUgc3lzdGVtIHN0YXRlIGNoYW5nZXMuIEZvciBleGFtcGxlLCBhIDMyLWJpdCBmaWxlIHN5c3RlbSB3aWxsXG4gICAgICogZ2VuZXJhdGUgSU5WQUxJRF9BUkdVTUVOVCBpZiBhc2tlZCB0byByZWFkIGF0IGFuIG9mZnNldCB0aGF0IGlzIG5vdCBpbiB0aGVcbiAgICAgKiByYW5nZSBbMCwyXjMyLTFdLCBidXQgaXQgd2lsbCBnZW5lcmF0ZSBPVVRfT0ZfUkFOR0UgaWYgYXNrZWQgdG8gcmVhZCBmcm9tXG4gICAgICogYW4gb2Zmc2V0IHBhc3QgdGhlIGN1cnJlbnQgZmlsZSBzaXplLlxuICAgICAqXG4gICAgICogVGhlcmUgaXMgYSBmYWlyIGJpdCBvZiBvdmVybGFwIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiBhbmRcbiAgICAgKiBPVVRfT0ZfUkFOR0UuIFdlIHJlY29tbWVuZCB1c2luZyBPVVRfT0ZfUkFOR0UgKHRoZSBtb3JlIHNwZWNpZmljIGVycm9yKVxuICAgICAqIHdoZW4gaXQgYXBwbGllcyBzbyB0aGF0IGNhbGxlcnMgd2hvIGFyZSBpdGVyYXRpbmcgdGhyb3VnaCBhIHNwYWNlIGNhblxuICAgICAqIGVhc2lseSBsb29rIGZvciBhbiBPVVRfT0ZfUkFOR0UgZXJyb3IgdG8gZGV0ZWN0IHdoZW4gdGhleSBhcmUgZG9uZS5cbiAgICAgKi9cbiAgICBPVVRfT0ZfUkFOR0U6IFwib3V0LW9mLXJhbmdlXCIsXG4gICAgLyoqIE9wZXJhdGlvbiBpcyBub3QgaW1wbGVtZW50ZWQgb3Igbm90IHN1cHBvcnRlZC9lbmFibGVkIGluIHRoaXMgc2VydmljZS4gKi9cbiAgICBVTklNUExFTUVOVEVEOiBcInVuaW1wbGVtZW50ZWRcIixcbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBlcnJvcnMuIE1lYW5zIHNvbWUgaW52YXJpYW50cyBleHBlY3RlZCBieSB1bmRlcmx5aW5nIFN5c3RlbSBoYXNcbiAgICAgKiBiZWVuIGJyb2tlbi4gSWYgeW91IHNlZSBvbmUgb2YgdGhlc2UgZXJyb3JzLCBTb21ldGhpbmcgaXMgdmVyeSBicm9rZW4uXG4gICAgICovXG4gICAgSU5URVJOQUw6IFwiaW50ZXJuYWxcIixcbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSBpcyBjdXJyZW50bHkgdW5hdmFpbGFibGUuIFRoaXMgaXMgYSBtb3N0IGxpa2VseSBhIHRyYW5zaWVudFxuICAgICAqIGNvbmRpdGlvbiBhbmQgbWF5IGJlIGNvcnJlY3RlZCBieSByZXRyeWluZyB3aXRoIGEgYmFja29mZi5cbiAgICAgKlxuICAgICAqIFNlZSBsaXRtdXMgdGVzdCBhYm92ZSBmb3IgZGVjaWRpbmcgYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OLCBBQk9SVEVELFxuICAgICAqIGFuZCBVTkFWQUlMQUJMRS5cbiAgICAgKi9cbiAgICBVTkFWQUlMQUJMRTogXCJ1bmF2YWlsYWJsZVwiLFxuICAgIC8qKiBVbnJlY292ZXJhYmxlIGRhdGEgbG9zcyBvciBjb3JydXB0aW9uLiAqL1xuICAgIERBVEFfTE9TUzogXCJkYXRhLWxvc3NcIlxufTtcblxuLyoqIEFuIGVycm9yIHJldHVybmVkIGJ5IGEgRmlyZXN0b3JlIG9wZXJhdGlvbi4gKi8gY2xhc3MgRmlyZXN0b3JlRXJyb3IgZXh0ZW5kcyBGaXJlYmFzZUVycm9yIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBiYWNrZW5kIGVycm9yIGNvZGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZXJyb3IuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogQSBjdXN0b20gZXJyb3IgZGVzY3JpcHRpb24uXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICBzdXBlcihlLCB0KSwgdGhpcy5jb2RlID0gZSwgdGhpcy5tZXNzYWdlID0gdCwgXG4gICAgICAgIC8vIEhBQ0s6IFdlIHdyaXRlIGEgdG9TdHJpbmcgcHJvcGVydHkgZGlyZWN0bHkgYmVjYXVzZSBFcnJvciBpcyBub3QgYSByZWFsXG4gICAgICAgIC8vIGNsYXNzIGFuZCBzbyBpbmhlcml0YW5jZSBkb2VzIG5vdCB3b3JrIGNvcnJlY3RseS4gV2UgY291bGQgYWx0ZXJuYXRpdmVseVxuICAgICAgICAvLyBkbyB0aGUgc2FtZSBcImJhY2stZG9vciBpbmhlcml0YW5jZVwiIHRyaWNrIHRoYXQgRmlyZWJhc2VFcnJvciBkb2VzLlxuICAgICAgICB0aGlzLnRvU3RyaW5nID0gKCkgPT4gYCR7dGhpcy5uYW1lfTogW2NvZGU9JHt0aGlzLmNvZGV9XTogJHt0aGlzLm1lc3NhZ2V9YDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9EZWZlcnJlZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlID0gZSwgdGhpcy5yZWplY3QgPSB0O1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfT0F1dGhUb2tlbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnVzZXIgPSB0LCB0aGlzLnR5cGUgPSBcIk9BdXRoXCIsIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAsIHRoaXMuaGVhZGVycy5zZXQoXCJBdXRob3JpemF0aW9uXCIsIGBCZWFyZXIgJHtlfWApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIENyZWRlbnRpYWxzUHJvdmlkZXIgdGhhdCBhbHdheXMgeWllbGRzIGFuIGVtcHR5IHRva2VuLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgX19QUklWQVRFX0VtcHR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIge1xuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxuICAgIHN0YXJ0KGUsIHQpIHtcbiAgICAgICAgLy8gRmlyZSB3aXRoIGluaXRpYWwgdXNlci5cbiAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0KFVzZXIuVU5BVVRIRU5USUNBVEVEKSkpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHt9XG59XG5cbi8qKlxuICogQSBDcmVkZW50aWFsc1Byb3ZpZGVyIHRoYXQgYWx3YXlzIHJldHVybnMgYSBjb25zdGFudCB0b2tlbi4gVXNlZCBmb3JcbiAqIGVtdWxhdG9yIHRva2VuIG1vY2tpbmcuXG4gKi8gY2xhc3MgX19QUklWQVRFX0VtdWxhdG9yQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmVzIHRoZSBsaXN0ZW5lciByZWdpc3RlcmVkIHdpdGggc2V0Q2hhbmdlTGlzdGVuZXIoKVxuICAgICAgICAgKiBUaGlzIGlzbid0IGFjdHVhbGx5IG5lY2Vzc2FyeSBzaW5jZSB0aGUgVUlEIG5ldmVyIGNoYW5nZXMsIGJ1dCB3ZSB1c2UgdGhpc1xuICAgICAgICAgKiB0byB2ZXJpZnkgdGhlIGxpc3RlbiBjb250cmFjdCBpcyBhZGhlcmVkIHRvIGluIHRlc3RzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jaGFuZ2VMaXN0ZW5lciA9IG51bGw7XG4gICAgfVxuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMudG9rZW4pO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxuICAgIHN0YXJ0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VMaXN0ZW5lciA9IHQsIFxuICAgICAgICAvLyBGaXJlIHdpdGggaW5pdGlhbCB1c2VyLlxuICAgICAgICBlLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHQodGhpcy50b2tlbi51c2VyKSkpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VMaXN0ZW5lciA9IG51bGw7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnQgPSBlLCBcbiAgICAgICAgLyoqIFRyYWNrcyB0aGUgY3VycmVudCBVc2VyLiAqL1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gVXNlci5VTkFVVEhFTlRJQ0FURUQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQ291bnRlciB1c2VkIHRvIGRldGVjdCBpZiB0aGUgdG9rZW4gY2hhbmdlZCB3aGlsZSBhIGdldFRva2VuIHJlcXVlc3Qgd2FzXG4gICAgICAgICAqIG91dHN0YW5kaW5nLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pID0gMCwgdGhpcy5mb3JjZVJlZnJlc2ggPSAhMSwgdGhpcy5hdXRoID0gbnVsbDtcbiAgICB9XG4gICAgc3RhcnQoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IHRoaXMuaTtcbiAgICAgICAgLy8gQSBjaGFuZ2UgbGlzdGVuZXIgdGhhdCBwcmV2ZW50cyBkb3VibGUtZmlyaW5nIGZvciB0aGUgc2FtZSB0b2tlbiBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgY29uc3QgX19QUklWQVRFX2d1YXJkZWRDaGFuZ2VMaXN0ZW5lciA9IGUgPT4gdGhpcy5pICE9PSBuID8gKG4gPSB0aGlzLmksIFxuICAgICAgICB0KGUpKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAvLyBBIHByb21pc2UgdGhhdCBjYW4gYmUgd2FpdGVkIG9uIHRvIGJsb2NrIG9uIHRoZSBuZXh0IHRva2VuIGNoYW5nZS5cbiAgICAgICAgLy8gVGhpcyBwcm9taXNlIGlzIHJlLWNyZWF0ZWQgYWZ0ZXIgZWFjaCBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICB0aGlzLm8gPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmkrKywgdGhpcy5jdXJyZW50VXNlciA9IHRoaXMudSgpLCByLnJlc29sdmUoKSwgciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBfX1BSSVZBVEVfZ3VhcmRlZENoYW5nZUxpc3RlbmVyKHRoaXMuY3VycmVudFVzZXIpKSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IF9fUFJJVkFURV9hd2FpdE5leHRUb2tlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSByO1xuICAgICAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdC5wcm9taXNlLCBhd2FpdCBfX1BSSVZBVEVfZ3VhcmRlZENoYW5nZUxpc3RlbmVyKHRoaXMuY3VycmVudFVzZXIpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9LCBfX1BSSVZBVEVfcmVnaXN0ZXJBdXRoID0gZSA9PiB7XG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyXCIsIFwiQXV0aCBkZXRlY3RlZFwiKSwgdGhpcy5hdXRoID0gZSwgXG4gICAgICAgICAgICB0aGlzLmF1dGguYWRkQXV0aFRva2VuTGlzdGVuZXIodGhpcy5vKSwgX19QUklWQVRFX2F3YWl0TmV4dFRva2VuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudC5vbkluaXQoKGUgPT4gX19QUklWQVRFX3JlZ2lzdGVyQXV0aChlKSkpLCBcbiAgICAgICAgLy8gT3VyIHVzZXJzIGNhbiBpbml0aWFsaXplIEF1dGggcmlnaHQgYWZ0ZXIgRmlyZXN0b3JlLCBzbyB3ZSBnaXZlIGl0XG4gICAgICAgIC8vIGEgY2hhbmNlIHRvIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrIGJlZm9yZSB3ZVxuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byBzdGFydCB1cCBpbiB1bmF1dGhlbnRpY2F0ZWQgbW9kZS5cbiAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmF1dGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy50LmdldEltbWVkaWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUgPyBfX1BSSVZBVEVfcmVnaXN0ZXJBdXRoKGUpIDogKFxuICAgICAgICAgICAgICAgIC8vIElmIGF1dGggaXMgc3RpbGwgbm90IGF2YWlsYWJsZSwgcHJvY2VlZCB3aXRoIGBudWxsYCB1c2VyXG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlclwiLCBcIkF1dGggbm90IHlldCBkZXRlY3RlZFwiKSwgXG4gICAgICAgICAgICAgICAgci5yZXNvbHZlKCksIHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksIDApLCBfX1BSSVZBVEVfYXdhaXROZXh0VG9rZW4oKTtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIC8vIFRha2Ugbm90ZSBvZiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgdG9rZW5Db3VudGVyIHNvIHRoYXQgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gY2FuIGZhaWwgKHdpdGggYW4gQUJPUlRFRCBlcnJvcikgaWYgdGhlcmUgaXMgYSB0b2tlbiBjaGFuZ2Ugd2hpbGUgdGhlXG4gICAgICAgIC8vIHJlcXVlc3QgaXMgb3V0c3RhbmRpbmcuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmksIHQgPSB0aGlzLmZvcmNlUmVmcmVzaDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXV0aCA/IHRoaXMuYXV0aC5nZXRUb2tlbih0KS50aGVuKCh0ID0+IFxuICAgICAgICAvLyBDYW5jZWwgdGhlIHJlcXVlc3Qgc2luY2UgdGhlIHRva2VuIGNoYW5nZWQgd2hpbGUgdGhlIHJlcXVlc3Qgd2FzXG4gICAgICAgIC8vIG91dHN0YW5kaW5nIHNvIHRoZSByZXNwb25zZSBpcyBwb3RlbnRpYWxseSBmb3IgYSBwcmV2aW91cyB1c2VyICh3aGljaFxuICAgICAgICAvLyB1c2VyLCB3ZSBjYW4ndCBiZSBzdXJlKS5cbiAgICAgICAgdGhpcy5pICE9PSBlID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJnZXRUb2tlbiBhYm9ydGVkIGR1ZSB0byB0b2tlbiBjaGFuZ2UuXCIpLCBcbiAgICAgICAgdGhpcy5nZXRUb2tlbigpKSA6IHQgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC5hY2Nlc3NUb2tlbiksIFxuICAgICAgICBuZXcgX19QUklWQVRFX09BdXRoVG9rZW4odC5hY2Nlc3NUb2tlbiwgdGhpcy5jdXJyZW50VXNlcikpIDogbnVsbCkpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7XG4gICAgICAgIHRoaXMuZm9yY2VSZWZyZXNoID0gITA7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLmF1dGggJiYgdGhpcy5hdXRoLnJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyKHRoaXMubyk7XG4gICAgfVxuICAgIC8vIEF1dGguZ2V0VWlkKCkgY2FuIHJldHVybiBudWxsIGV2ZW4gd2l0aCBhIHVzZXIgbG9nZ2VkIGluLiBJdCBpcyBiZWNhdXNlXG4gICAgLy8gZ2V0VWlkKCkgaXMgc3luY2hyb25vdXMsIGJ1dCB0aGUgYXV0aCBjb2RlIHBvcHVsYXRpbmcgVWlkIGlzIGFzeW5jaHJvbm91cy5cbiAgICAvLyBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgaW4gdGhlIEF1dGhUb2tlbkxpc3RlbmVyIGNhbGxiYWNrXG4gICAgLy8gdG8gZ3VhcmFudGVlIHRvIGdldCB0aGUgYWN0dWFsIHVzZXIuXG4gICAgdSgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuYXV0aCAmJiB0aGlzLmF1dGguZ2V0VWlkKCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsID09PSBlIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpLCBuZXcgVXNlcihlKTtcbiAgICB9XG59XG5cbi8qXG4gKiBGaXJzdFBhcnR5VG9rZW4gcHJvdmlkZXMgYSBmcmVzaCB0b2tlbiBlYWNoIHRpbWUgaXRzIHZhbHVlXG4gKiBpcyByZXF1ZXN0ZWQsIGJlY2F1c2UgaWYgdGhlIHRva2VuIGlzIHRvbyBvbGQsIHJlcXVlc3RzIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKiBUZWNobmljYWxseSB0aGlzIG1heSBubyBsb25nZXIgYmUgbmVjZXNzYXJ5IHNpbmNlIHRoZSBTREsgc2hvdWxkIGdyYWNlZnVsbHlcbiAqIHJlY292ZXIgZnJvbSB1bmF1dGhlbnRpY2F0ZWQgZXJyb3JzIChzZWUgYi8zMzE0NzgxOCBmb3IgY29udGV4dCksIGJ1dCBpdCdzXG4gKiBzYWZlciB0byBrZWVwIHRoZSBpbXBsZW1lbnRhdGlvbiBhcy1pcy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRmlyc3RQYXJ0eVRva2VuIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMubCA9IGUsIHRoaXMuaCA9IHQsIHRoaXMuUCA9IG4sIHRoaXMudHlwZSA9IFwiRmlyc3RQYXJ0eVwiLCB0aGlzLnVzZXIgPSBVc2VyLkZJUlNUX1BBUlRZLCBcbiAgICAgICAgdGhpcy5JID0gbmV3IE1hcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhbiBhdXRob3JpemF0aW9uIHRva2VuLCB1c2luZyBhIHByb3ZpZGVkIGZhY3RvcnkgZnVuY3Rpb24sIG9yIHJldHVyblxuICAgICAqIG51bGwuXG4gICAgICovICAgIFQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlAgPyB0aGlzLlAoKSA6IG51bGw7XG4gICAgfVxuICAgIGdldCBoZWFkZXJzKCkge1xuICAgICAgICB0aGlzLkkuc2V0KFwiWC1Hb29nLUF1dGhVc2VyXCIsIHRoaXMubCk7XG4gICAgICAgIC8vIFVzZSBhcnJheSBub3RhdGlvbiB0byBwcmV2ZW50IG1pbmlmaWNhdGlvblxuICAgICAgICBjb25zdCBlID0gdGhpcy5UKCk7XG4gICAgICAgIHJldHVybiBlICYmIHRoaXMuSS5zZXQoXCJBdXRob3JpemF0aW9uXCIsIGUpLCB0aGlzLmggJiYgdGhpcy5JLnNldChcIlgtR29vZy1JYW0tQXV0aG9yaXphdGlvbi1Ub2tlblwiLCB0aGlzLmgpLCBcbiAgICAgICAgdGhpcy5JO1xuICAgIH1cbn1cblxuLypcbiAqIFByb3ZpZGVzIHVzZXIgY3JlZGVudGlhbHMgcmVxdWlyZWQgZm9yIHRoZSBGaXJlc3RvcmUgSmF2YVNjcmlwdCBTREtcbiAqIHRvIGF1dGhlbnRpY2F0ZSB0aGUgdXNlciwgdXNpbmcgdGVjaG5pcXVlIHRoYXQgaXMgb25seSBhdmFpbGFibGVcbiAqIHRvIGFwcGxpY2F0aW9ucyBob3N0ZWQgYnkgR29vZ2xlLlxuICovIGNsYXNzIF9fUFJJVkFURV9GaXJzdFBhcnR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5sID0gZSwgdGhpcy5oID0gdCwgdGhpcy5QID0gbjtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IF9fUFJJVkFURV9GaXJzdFBhcnR5VG9rZW4odGhpcy5sLCB0aGlzLmgsIHRoaXMuUCkpO1xuICAgIH1cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIC8vIEZpcmUgd2l0aCBpbml0aWFsIHVpZC5cbiAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0KFVzZXIuRklSU1RfUEFSVFkpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxufVxuXG5jbGFzcyBBcHBDaGVja1Rva2VuIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBlLCB0aGlzLnR5cGUgPSBcIkFwcENoZWNrXCIsIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAsIGUgJiYgZS5sZW5ndGggPiAwICYmIHRoaXMuaGVhZGVycy5zZXQoXCJ4LWZpcmViYXNlLWFwcGNoZWNrXCIsIHRoaXMudmFsdWUpO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0ZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuQSA9IGUsIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXBwQ2hlY2sgPSBudWxsLCB0aGlzLlIgPSBudWxsO1xuICAgIH1cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG9uVG9rZW5DaGFuZ2VkID0gZSA9PiB7XG4gICAgICAgICAgICBudWxsICE9IGUuZXJyb3IgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgYEVycm9yIGdldHRpbmcgQXBwIENoZWNrIHRva2VuOyB1c2luZyBwbGFjZWhvbGRlciB0b2tlbiBpbnN0ZWFkLiBFcnJvcjogJHtlLmVycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICBjb25zdCBuID0gZS50b2tlbiAhPT0gdGhpcy5SO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUiA9IGUudG9rZW4sIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIGBSZWNlaXZlZCAke24gPyBcIm5ld1wiIDogXCJleGlzdGluZ1wifSB0b2tlbi5gKSwgXG4gICAgICAgICAgICBuID8gdChlLnRva2VuKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm8gPSB0ID0+IHtcbiAgICAgICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gb25Ub2tlbkNoYW5nZWQodCkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgX19QUklWQVRFX3JlZ2lzdGVyQXBwQ2hlY2sgPSBlID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIFwiQXBwQ2hlY2sgZGV0ZWN0ZWRcIiksIHRoaXMuYXBwQ2hlY2sgPSBlLCBcbiAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2suYWRkVG9rZW5MaXN0ZW5lcih0aGlzLm8pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLkEub25Jbml0KChlID0+IF9fUFJJVkFURV9yZWdpc3RlckFwcENoZWNrKGUpKSksIFxuICAgICAgICAvLyBPdXIgdXNlcnMgY2FuIGluaXRpYWxpemUgQXBwQ2hlY2sgYWZ0ZXIgRmlyZXN0b3JlLCBzbyB3ZSBnaXZlIGl0XG4gICAgICAgIC8vIGEgY2hhbmNlIHRvIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrLlxuICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwQ2hlY2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5BLmdldEltbWVkaWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUgPyBfX1BSSVZBVEVfcmVnaXN0ZXJBcHBDaGVjayhlKSA6IFxuICAgICAgICAgICAgICAgIC8vIElmIEFwcENoZWNrIGlzIHN0aWxsIG5vdCBhdmFpbGFibGUsIHByb2NlZWQgd2l0aG91dCBpdC5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlclwiLCBcIkFwcENoZWNrIG5vdCB5ZXQgZGV0ZWN0ZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCAwKTtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmZvcmNlUmVmcmVzaDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXBwQ2hlY2sgPyB0aGlzLmFwcENoZWNrLmdldFRva2VuKGUpLnRoZW4oKGUgPT4gZSA/IChfX1BSSVZBVEVfaGFyZEFzc2VydChcInN0cmluZ1wiID09IHR5cGVvZiBlLnRva2VuKSwgXG4gICAgICAgIHRoaXMuUiA9IGUudG9rZW4sIG5ldyBBcHBDaGVja1Rva2VuKGUudG9rZW4pKSA6IG51bGwpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge1xuICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9ICEwO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5hcHBDaGVjayAmJiB0aGlzLmFwcENoZWNrLnJlbW92ZVRva2VuTGlzdGVuZXIodGhpcy5vKTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gQXBwQ2hlY2sgdG9rZW4gcHJvdmlkZXIgdGhhdCBhbHdheXMgeWllbGRzIGFuIGVtcHR5IHRva2VuLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgX19QUklWQVRFX0VtcHR5QXBwQ2hlY2tUb2tlblByb3ZpZGVyIHtcbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgQXBwQ2hlY2tUb2tlbihcIlwiKSk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQoZSwgdCkge31cbiAgICBzaHV0ZG93bigpIHt9XG59XG5cbi8qKlxuICogQnVpbGRzIGEgQ3JlZGVudGlhbHNQcm92aWRlciBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2ZcbiAqIHRoZSBjcmVkZW50aWFscyBwYXNzZWQgaW4uXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEdlbmVyYXRlcyBgbkJ5dGVzYCBvZiByYW5kb20gYnl0ZXMuXG4gKlxuICogSWYgYG5CeXRlcyA8IDBgICwgYW4gZXJyb3Igd2lsbCBiZSB0aHJvd24uXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9yYW5kb21CeXRlcyhlKSB7XG4gICAgLy8gUG9seWZpbGxzIGZvciBJRSBhbmQgV2ViV29ya2VyIGJ5IHVzaW5nIGBzZWxmYCBhbmQgYG1zQ3J5cHRvYCB3aGVuIGBjcnlwdG9gIGlzIG5vdCBhdmFpbGFibGUuXG4gICAgY29uc3QgdCA9IFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygc2VsZiAmJiAoc2VsZi5jcnlwdG8gfHwgc2VsZi5tc0NyeXB0byksIG4gPSBuZXcgVWludDhBcnJheShlKTtcbiAgICBpZiAodCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQuZ2V0UmFuZG9tVmFsdWVzKSB0LmdldFJhbmRvbVZhbHVlcyhuKTsgZWxzZSBcbiAgICAvLyBGYWxscyBiYWNrIHRvIE1hdGgucmFuZG9tXG4gICAgZm9yIChsZXQgdCA9IDA7IHQgPCBlOyB0KyspIG5bdF0gPSBNYXRoLmZsb29yKDI1NiAqIE1hdGgucmFuZG9tKCkpO1xuICAgIHJldHVybiBuO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQXV0b0lkIHtcbiAgICBzdGF0aWMgVigpIHtcbiAgICAgICAgLy8gQWxwaGFudW1lcmljIGNoYXJhY3RlcnNcbiAgICAgICAgY29uc3QgZSA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlcIiwgdCA9IE1hdGguZmxvb3IoMjU2IC8gZS5sZW5ndGgpICogZS5sZW5ndGg7XG4gICAgICAgIC8vIFRoZSBsYXJnZXN0IGJ5dGUgdmFsdWUgdGhhdCBpcyBhIG11bHRpcGxlIG9mIGBjaGFyLmxlbmd0aGAuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSBcIlwiO1xuICAgICAgICBmb3IgKDtuLmxlbmd0aCA8IDIwOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfcmFuZG9tQnl0ZXMoNDApO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByLmxlbmd0aDsgKytpKSBcbiAgICAgICAgICAgIC8vIE9ubHkgYWNjZXB0IHZhbHVlcyB0aGF0IGFyZSBbMCwgbWF4TXVsdGlwbGUpLCB0aGlzIGVuc3VyZXMgdGhleSBjYW5cbiAgICAgICAgICAgIC8vIGJlIGV2ZW5seSBtYXBwZWQgdG8gaW5kaWNlcyBvZiBgY2hhcnNgIHZpYSBhIG1vZHVsbyBvcGVyYXRpb24uXG4gICAgICAgICAgICBuLmxlbmd0aCA8IDIwICYmIHJbaV0gPCB0ICYmIChuICs9IGUuY2hhckF0KHJbaV0gJSBlLmxlbmd0aCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZSwgdCkge1xuICAgIHJldHVybiBlIDwgdCA/IC0xIDogZSA+IHQgPyAxIDogMDtcbn1cblxuLyoqIEhlbHBlciB0byBjb21wYXJlIGFycmF5cyB1c2luZyBpc0VxdWFsKCkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcnJheUVxdWFscyhlLCB0LCBuKSB7XG4gICAgcmV0dXJuIGUubGVuZ3RoID09PSB0Lmxlbmd0aCAmJiBlLmV2ZXJ5KCgoZSwgcikgPT4gbihlLCB0W3JdKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGltbWVkaWF0ZSBsZXhpY29ncmFwaGljYWxseS1mb2xsb3dpbmcgc3RyaW5nLiBUaGlzIGlzIHVzZWZ1bCB0b1xuICogY29uc3RydWN0IGFuIGluY2x1c2l2ZSByYW5nZSBmb3IgaW5kZXhlZGRiIGl0ZXJhdG9ycy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW1tZWRpYXRlU3VjY2Vzc29yKGUpIHtcbiAgICAvLyBSZXR1cm4gdGhlIGlucHV0IHN0cmluZywgd2l0aCBhbiBhZGRpdGlvbmFsIE5VTCBieXRlIGFwcGVuZGVkLlxuICAgIHJldHVybiBlICsgXCJcXDBcIjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRoZSBlYXJsaWVzdCBkYXRlIHN1cHBvcnRlZCBieSBGaXJlc3RvcmUgdGltZXN0YW1wcyAoMDAwMS0wMS0wMVQwMDowMDowMFopLlxuLyoqXG4gKiBBIGBUaW1lc3RhbXBgIHJlcHJlc2VudHMgYSBwb2ludCBpbiB0aW1lIGluZGVwZW5kZW50IG9mIGFueSB0aW1lIHpvbmUgb3JcbiAqIGNhbGVuZGFyLCByZXByZXNlbnRlZCBhcyBzZWNvbmRzIGFuZCBmcmFjdGlvbnMgb2Ygc2Vjb25kcyBhdCBuYW5vc2Vjb25kXG4gKiByZXNvbHV0aW9uIGluIFVUQyBFcG9jaCB0aW1lLlxuICpcbiAqIEl0IGlzIGVuY29kZWQgdXNpbmcgdGhlIFByb2xlcHRpYyBHcmVnb3JpYW4gQ2FsZW5kYXIgd2hpY2ggZXh0ZW5kcyB0aGVcbiAqIEdyZWdvcmlhbiBjYWxlbmRhciBiYWNrd2FyZHMgdG8geWVhciBvbmUuIEl0IGlzIGVuY29kZWQgYXNzdW1pbmcgYWxsIG1pbnV0ZXNcbiAqIGFyZSA2MCBzZWNvbmRzIGxvbmcsIGkuZS4gbGVhcCBzZWNvbmRzIGFyZSBcInNtZWFyZWRcIiBzbyB0aGF0IG5vIGxlYXAgc2Vjb25kXG4gKiB0YWJsZSBpcyBuZWVkZWQgZm9yIGludGVycHJldGF0aW9uLiBSYW5nZSBpcyBmcm9tIDAwMDEtMDEtMDFUMDA6MDA6MDBaIHRvXG4gKiA5OTk5LTEyLTMxVDIzOjU5OjU5Ljk5OTk5OTk5OVouXG4gKlxuICogRm9yIGV4YW1wbGVzIGFuZCBmdXJ0aGVyIHNwZWNpZmljYXRpb25zLCByZWZlciB0byB0aGVcbiAqIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL3Byb3RvYnVmL2Jsb2IvbWFzdGVyL3NyYy9nb29nbGUvcHJvdG9idWYvdGltZXN0YW1wLnByb3RvIHwgVGltZXN0YW1wIGRlZmluaXRpb259LlxuICovXG5jbGFzcyBUaW1lc3RhbXAge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlY29uZHMgLSBUaGUgbnVtYmVyIG9mIHNlY29uZHMgb2YgVVRDIHRpbWUgc2luY2UgVW5peCBlcG9jaFxuICAgICAqICAgICAxOTcwLTAxLTAxVDAwOjAwOjAwWi4gTXVzdCBiZSBmcm9tIDAwMDEtMDEtMDFUMDA6MDA6MDBaIHRvXG4gICAgICogICAgIDk5OTktMTItMzFUMjM6NTk6NTlaIGluY2x1c2l2ZS5cbiAgICAgKiBAcGFyYW0gbmFub3NlY29uZHMgLSBUaGUgbm9uLW5lZ2F0aXZlIGZyYWN0aW9ucyBvZiBhIHNlY29uZCBhdCBuYW5vc2Vjb25kXG4gICAgICogICAgIHJlc29sdXRpb24uIE5lZ2F0aXZlIHNlY29uZCB2YWx1ZXMgd2l0aCBmcmFjdGlvbnMgbXVzdCBzdGlsbCBoYXZlXG4gICAgICogICAgIG5vbi1uZWdhdGl2ZSBuYW5vc2Vjb25kcyB2YWx1ZXMgdGhhdCBjb3VudCBmb3J3YXJkIGluIHRpbWUuIE11c3QgYmVcbiAgICAgKiAgICAgZnJvbSAwIHRvIDk5OSw5OTksOTk5IGluY2x1c2l2ZS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIHNlY29uZHMgb2YgVVRDIHRpbWUgc2luY2UgVW5peCBlcG9jaCAxOTcwLTAxLTAxVDAwOjAwOjAwWi5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgZnJhY3Rpb25zIG9mIGEgc2Vjb25kIGF0IG5hbm9zZWNvbmQgcmVzb2x1dGlvbi4qXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICBpZiAodGhpcy5zZWNvbmRzID0gZSwgdGhpcy5uYW5vc2Vjb25kcyA9IHQsIHQgPCAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBuYW5vc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgdCk7XG4gICAgICAgIGlmICh0ID49IDFlOSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgbmFub3NlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIHQpO1xuICAgICAgICBpZiAoZSA8IC02MjEzNTU5NjgwMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgZSk7XG4gICAgICAgIC8vIFRoaXMgd2lsbCBicmVhayBpbiB0aGUgeWVhciAxMCwwMDAuXG4gICAgICAgICAgICAgICAgaWYgKGUgPj0gMjUzNDAyMzAwODAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBzZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgd2l0aCB0aGUgY3VycmVudCBkYXRlLCB3aXRoIG1pbGxpc2Vjb25kIHByZWNpc2lvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEgbmV3IHRpbWVzdGFtcCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgZGF0ZS5cbiAgICAgKi8gICAgc3RhdGljIG5vdygpIHtcbiAgICAgICAgcmV0dXJuIFRpbWVzdGFtcC5mcm9tTWlsbGlzKERhdGUubm93KCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcCBmcm9tIHRoZSBnaXZlbiBkYXRlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGUgLSBUaGUgZGF0ZSB0byBpbml0aWFsaXplIHRoZSBgVGltZXN0YW1wYCBmcm9tLlxuICAgICAqIEByZXR1cm5zIEEgbmV3IGBUaW1lc3RhbXBgIHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzIHRoZSBnaXZlblxuICAgICAqICAgICBkYXRlLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbURhdGUoZSkge1xuICAgICAgICByZXR1cm4gVGltZXN0YW1wLmZyb21NaWxsaXMoZS5nZXRUaW1lKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcCBmcm9tIHRoZSBnaXZlbiBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIG1pbGxpc2Vjb25kcyAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgc2luY2UgVW5peCBlcG9jaFxuICAgICAqICAgICAxOTcwLTAxLTAxVDAwOjAwOjAwWi5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBgVGltZXN0YW1wYCByZXByZXNlbnRpbmcgdGhlIHNhbWUgcG9pbnQgaW4gdGltZSBhcyB0aGUgZ2l2ZW5cbiAgICAgKiAgICAgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy5cbiAgICAgKi8gICAgc3RhdGljIGZyb21NaWxsaXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gTWF0aC5mbG9vcihlIC8gMWUzKSwgbiA9IE1hdGguZmxvb3IoMWU2ICogKGUgLSAxZTMgKiB0KSk7XG4gICAgICAgIHJldHVybiBuZXcgVGltZXN0YW1wKHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIGBUaW1lc3RhbXBgIHRvIGEgSmF2YVNjcmlwdCBgRGF0ZWAgb2JqZWN0LiBUaGlzIGNvbnZlcnNpb25cbiAgICAgKiBjYXVzZXMgYSBsb3NzIG9mIHByZWNpc2lvbiBzaW5jZSBgRGF0ZWAgb2JqZWN0cyBvbmx5IHN1cHBvcnQgbWlsbGlzZWNvbmRcbiAgICAgKiBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBKYXZhU2NyaXB0IGBEYXRlYCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXNcbiAgICAgKiAgICAgdGhpcyBgVGltZXN0YW1wYCwgd2l0aCBtaWxsaXNlY29uZCBwcmVjaXNpb24uXG4gICAgICovICAgIHRvRGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMudG9NaWxsaXMoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgYFRpbWVzdGFtcGAgdG8gYSBudW1lcmljIHRpbWVzdGFtcCAoaW4gbWlsbGlzZWNvbmRzIHNpbmNlXG4gICAgICogZXBvY2gpLiBUaGlzIG9wZXJhdGlvbiBjYXVzZXMgYSBsb3NzIG9mIHByZWNpc2lvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBwb2ludCBpbiB0aW1lIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyB0aW1lc3RhbXAsIHJlcHJlc2VudGVkIGFzXG4gICAgICogICAgIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIFVuaXggZXBvY2ggMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICovICAgIHRvTWlsbGlzKCkge1xuICAgICAgICByZXR1cm4gMWUzICogdGhpcy5zZWNvbmRzICsgdGhpcy5uYW5vc2Vjb25kcyAvIDFlNjtcbiAgICB9XG4gICAgX2NvbXBhcmVUbyhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY29uZHMgPT09IGUuc2Vjb25kcyA/IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMubmFub3NlY29uZHMsIGUubmFub3NlY29uZHMpIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IodGhpcy5zZWNvbmRzLCBlLnNlY29uZHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgVGltZXN0YW1wYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBUaW1lc3RhbXBgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYFRpbWVzdGFtcGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBlLnNlY29uZHMgPT09IHRoaXMuc2Vjb25kcyAmJiBlLm5hbm9zZWNvbmRzID09PSB0aGlzLm5hbm9zZWNvbmRzO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIHRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBgVGltZXN0YW1wYC4gKi8gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIlRpbWVzdGFtcChzZWNvbmRzPVwiICsgdGhpcy5zZWNvbmRzICsgXCIsIG5hbm9zZWNvbmRzPVwiICsgdGhpcy5uYW5vc2Vjb25kcyArIFwiKVwiO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYFRpbWVzdGFtcGAuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlY29uZHM6IHRoaXMuc2Vjb25kcyxcbiAgICAgICAgICAgIG5hbm9zZWNvbmRzOiB0aGlzLm5hbm9zZWNvbmRzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoaXMgb2JqZWN0IHRvIGEgcHJpbWl0aXZlIHN0cmluZywgd2hpY2ggYWxsb3dzIGBUaW1lc3RhbXBgIG9iamVjdHNcbiAgICAgKiB0byBiZSBjb21wYXJlZCB1c2luZyB0aGUgYD5gLCBgPD1gLCBgPj1gIGFuZCBgPmAgb3BlcmF0b3JzLlxuICAgICAqLyAgICB2YWx1ZU9mKCkge1xuICAgICAgICAvLyBUaGlzIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIG9mIHRoZSBmb3JtIDxzZWNvbmRzPi48bmFub3NlY29uZHM+IHdoZXJlXG4gICAgICAgIC8vIDxzZWNvbmRzPiBpcyB0cmFuc2xhdGVkIHRvIGhhdmUgYSBub24tbmVnYXRpdmUgdmFsdWUgYW5kIGJvdGggPHNlY29uZHM+XG4gICAgICAgIC8vIGFuZCA8bmFub3NlY29uZHM+IGFyZSBsZWZ0LXBhZGRlZCB3aXRoIHplcm9lcyB0byBiZSBhIGNvbnNpc3RlbnQgbGVuZ3RoLlxuICAgICAgICAvLyBTdHJpbmdzIHdpdGggdGhpcyBmb3JtYXQgdGhlbiBoYXZlIGEgbGV4aW9ncmFwaGljYWwgb3JkZXJpbmcgdGhhdCBtYXRjaGVzXG4gICAgICAgIC8vIHRoZSBleHBlY3RlZCBvcmRlcmluZy4gVGhlIDxzZWNvbmRzPiB0cmFuc2xhdGlvbiBpcyBkb25lIHRvIGF2b2lkIGhhdmluZ1xuICAgICAgICAvLyBhIGxlYWRpbmcgbmVnYXRpdmUgc2lnbiAoaS5lLiBhIGxlYWRpbmcgJy0nIGNoYXJhY3RlcikgaW4gaXRzIHN0cmluZ1xuICAgICAgICAvLyByZXByZXNlbnRhdGlvbiwgd2hpY2ggd291bGQgYWZmZWN0IGl0cyBsZXhpb2dyYXBoaWNhbCBvcmRlcmluZy5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc2Vjb25kcyAtIC02MjEzNTU5NjgwMDtcbiAgICAgICAgLy8gTm90ZTogVXAgdG8gMTIgZGVjaW1hbCBkaWdpdHMgYXJlIHJlcXVpcmVkIHRvIHJlcHJlc2VudCBhbGwgdmFsaWRcbiAgICAgICAgLy8gJ3NlY29uZHMnIHZhbHVlcy5cbiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKGUpLnBhZFN0YXJ0KDEyLCBcIjBcIikgKyBcIi5cIiArIFN0cmluZyh0aGlzLm5hbm9zZWNvbmRzKS5wYWRTdGFydCg5LCBcIjBcIik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHZlcnNpb24gb2YgYSBkb2N1bWVudCBpbiBGaXJlc3RvcmUuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHZlcnNpb25cbiAqIHRpbWVzdGFtcCwgc3VjaCBhcyB1cGRhdGVfdGltZSBvciByZWFkX3RpbWUuXG4gKi8gY2xhc3MgU25hcHNob3RWZXJzaW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudGltZXN0YW1wID0gZTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21UaW1lc3RhbXAoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNuYXBzaG90VmVyc2lvbihlKTtcbiAgICB9XG4gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTbmFwc2hvdFZlcnNpb24obmV3IFRpbWVzdGFtcCgwLCAwKSk7XG4gICAgfVxuICAgIHN0YXRpYyBtYXgoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU25hcHNob3RWZXJzaW9uKG5ldyBUaW1lc3RhbXAoMjUzNDAyMzAwNzk5LCA5OTk5OTk5OTkpKTtcbiAgICB9XG4gICAgY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLl9jb21wYXJlVG8oZS50aW1lc3RhbXApO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLmlzRXF1YWwoZS50aW1lc3RhbXApO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmVyc2lvbiBmb3IgdXNlIGluIHNwZWMgdGVzdHMuICovICAgIHRvTWljcm9zZWNvbmRzKCkge1xuICAgICAgICAvLyBDb252ZXJ0IHRvIG1pY3Jvc2Vjb25kcy5cbiAgICAgICAgcmV0dXJuIDFlNiAqIHRoaXMudGltZXN0YW1wLnNlY29uZHMgKyB0aGlzLnRpbWVzdGFtcC5uYW5vc2Vjb25kcyAvIDFlMztcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIlNuYXBzaG90VmVyc2lvbihcIiArIHRoaXMudGltZXN0YW1wLnRvU3RyaW5nKCkgKyBcIilcIjtcbiAgICB9XG4gICAgdG9UaW1lc3RhbXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVzdGFtcDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFBhdGggcmVwcmVzZW50cyBhbiBvcmRlcmVkIHNlcXVlbmNlIG9mIHN0cmluZyBzZWdtZW50cy5cbiAqL1xuY2xhc3MgQmFzZVBhdGgge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdm9pZCAwID09PSB0ID8gdCA9IDAgOiB0ID4gZS5sZW5ndGggJiYgZmFpbCgpLCB2b2lkIDAgPT09IG4gPyBuID0gZS5sZW5ndGggLSB0IDogbiA+IGUubGVuZ3RoIC0gdCAmJiBmYWlsKCksIFxuICAgICAgICB0aGlzLnNlZ21lbnRzID0gZSwgdGhpcy5vZmZzZXQgPSB0LCB0aGlzLmxlbiA9IG47XG4gICAgfVxuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbjtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiAwID09PSBCYXNlUGF0aC5jb21wYXJhdG9yKHRoaXMsIGUpO1xuICAgIH1cbiAgICBjaGlsZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnNlZ21lbnRzLnNsaWNlKHRoaXMub2Zmc2V0LCB0aGlzLmxpbWl0KCkpO1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEJhc2VQYXRoID8gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQucHVzaChlKTtcbiAgICAgICAgfSkpIDogdC5wdXNoKGUpLCB0aGlzLmNvbnN0cnVjdCh0KTtcbiAgICB9XG4gICAgLyoqIFRoZSBpbmRleCBvZiBvbmUgcGFzdCB0aGUgbGFzdCBzZWdtZW50IG9mIHRoZSBwYXRoLiAqLyAgICBsaW1pdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIHBvcEZpcnN0KGUpIHtcbiAgICAgICAgcmV0dXJuIGUgPSB2b2lkIDAgPT09IGUgPyAxIDogZSwgdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQgKyBlLCB0aGlzLmxlbmd0aCAtIGUpO1xuICAgIH1cbiAgICBwb3BMYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQsIHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGZpcnN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbdGhpcy5vZmZzZXRdO1xuICAgIH1cbiAgICBsYXN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGdldChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzW3RoaXMub2Zmc2V0ICsgZV07XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAwID09PSB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgaXNQcmVmaXhPZihlKSB7XG4gICAgICAgIGlmIChlLmxlbmd0aCA8IHRoaXMubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgdGhpcy5sZW5ndGg7IHQrKykgaWYgKHRoaXMuZ2V0KHQpICE9PSBlLmdldCh0KSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlzSW1tZWRpYXRlUGFyZW50T2YoZSkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggKyAxICE9PSBlLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHRoaXMubGVuZ3RoOyB0KyspIGlmICh0aGlzLmdldCh0KSAhPT0gZS5nZXQodCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgZm9yIChsZXQgdCA9IHRoaXMub2Zmc2V0LCBuID0gdGhpcy5saW1pdCgpOyB0IDwgbjsgdCsrKSBlKHRoaXMuc2VnbWVudHNbdF0pO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWdtZW50cy5zbGljZSh0aGlzLm9mZnNldCwgdGhpcy5saW1pdCgpKTtcbiAgICB9XG4gICAgc3RhdGljIGNvbXBhcmF0b3IoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gTWF0aC5taW4oZS5sZW5ndGgsIHQubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBuOyByKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmdldChyKSwgaSA9IHQuZ2V0KHIpO1xuICAgICAgICAgICAgaWYgKG4gPCBpKSByZXR1cm4gLTE7XG4gICAgICAgICAgICBpZiAobiA+IGkpIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlLmxlbmd0aCA8IHQubGVuZ3RoID8gLTEgOiBlLmxlbmd0aCA+IHQubGVuZ3RoID8gMSA6IDA7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgc2xhc2gtc2VwYXJhdGVkIHBhdGggZm9yIG5hdmlnYXRpbmcgcmVzb3VyY2VzIChkb2N1bWVudHMgYW5kIGNvbGxlY3Rpb25zKVxuICogd2l0aGluIEZpcmVzdG9yZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBSZXNvdXJjZVBhdGggZXh0ZW5kcyBCYXNlUGF0aCB7XG4gICAgY29uc3RydWN0KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgoZSwgdCwgbik7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgLy8gTk9URTogVGhlIGNsaWVudCBpcyBpZ25vcmFudCBvZiBhbnkgcGF0aCBzZWdtZW50cyBjb250YWluaW5nIGVzY2FwZVxuICAgICAgICAvLyBzZXF1ZW5jZXMgKGUuZy4gX19pZDEyM19fKSBhbmQganVzdCBwYXNzZXMgdGhlbSB0aHJvdWdoIHJhdyAodGhleSBleGlzdFxuICAgICAgICAvLyBmb3IgbGVnYWN5IHJlYXNvbnMgYW5kIHNob3VsZCBub3QgYmUgdXNlZCBmcmVxdWVudGx5KS5cbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmpvaW4oXCIvXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSByZXNvdXJjZSBwYXRoIGZyb20gdGhlIGdpdmVuIHNsYXNoLWRlbGltaXRlZCBzdHJpbmcuIElmIG11bHRpcGxlXG4gICAgICogYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgYWxsIGNvbXBvbmVudHMgYXJlIGNvbWJpbmVkLiBMZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAqIHNsYXNoZXMgZnJvbSBhbGwgY29tcG9uZW50cyBhcmUgaWdub3JlZC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21TdHJpbmcoLi4uZSkge1xuICAgICAgICAvLyBOT1RFOiBUaGUgY2xpZW50IGlzIGlnbm9yYW50IG9mIGFueSBwYXRoIHNlZ21lbnRzIGNvbnRhaW5pbmcgZXNjYXBlXG4gICAgICAgIC8vIHNlcXVlbmNlcyAoZS5nLiBfX2lkMTIzX18pIGFuZCBqdXN0IHBhc3NlcyB0aGVtIHRocm91Z2ggcmF3ICh0aGV5IGV4aXN0XG4gICAgICAgIC8vIGZvciBsZWdhY3kgcmVhc29ucyBhbmQgc2hvdWxkIG5vdCBiZSB1c2VkIGZyZXF1ZW50bHkpLlxuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSB7XG4gICAgICAgICAgICBpZiAobi5pbmRleE9mKFwiLy9cIikgPj0gMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgc2VnbWVudCAoJHtufSkuIFBhdGhzIG11c3Qgbm90IGNvbnRhaW4gLy8gaW4gdGhlbS5gKTtcbiAgICAgICAgICAgIC8vIFN0cmlwIGxlYWRpbmcgYW5kIHRyYWxpbmcgc2xhc2hlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHQucHVzaCguLi5uLnNwbGl0KFwiL1wiKS5maWx0ZXIoKGUgPT4gZS5sZW5ndGggPiAwKSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmVzb3VyY2VQYXRoKHQpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHlQYXRoKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aChbXSk7XG4gICAgfVxufVxuXG5jb25zdCBDID0gL15bX2EtekEtWl1bX2EtekEtWjAtOV0qJC87XG5cbi8qKlxuICogQSBkb3Qtc2VwYXJhdGVkIHBhdGggZm9yIG5hdmlnYXRpbmcgc3ViLW9iamVjdHMgd2l0aGluIGEgZG9jdW1lbnQuXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBGaWVsZFBhdGgkMSBleHRlbmRzIEJhc2VQYXRoIHtcbiAgICBjb25zdHJ1Y3QoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCQxKGUsIHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHN0cmluZyBjb3VsZCBiZSB1c2VkIGFzIGEgc2VnbWVudCBpbiBhIGZpZWxkIHBhdGhcbiAgICAgKiB3aXRob3V0IGVzY2FwaW5nLlxuICAgICAqLyAgICBzdGF0aWMgaXNWYWxpZElkZW50aWZpZXIoZSkge1xuICAgICAgICByZXR1cm4gQy50ZXN0KGUpO1xuICAgIH1cbiAgICBjYW5vbmljYWxTdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKS5tYXAoKGUgPT4gKGUgPSBlLnJlcGxhY2UoL1xcXFwvZywgXCJcXFxcXFxcXFwiKS5yZXBsYWNlKC9gL2csIFwiXFxcXGBcIiksIFxuICAgICAgICBGaWVsZFBhdGgkMS5pc1ZhbGlkSWRlbnRpZmllcihlKSB8fCAoZSA9IFwiYFwiICsgZSArIFwiYFwiKSwgZSkpKS5qb2luKFwiLlwiKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBmaWVsZCByZWZlcmVuY2VzIHRoZSBrZXkgb2YgYSBkb2N1bWVudC5cbiAgICAgKi8gICAgaXNLZXlGaWVsZCgpIHtcbiAgICAgICAgcmV0dXJuIDEgPT09IHRoaXMubGVuZ3RoICYmIFwiX19uYW1lX19cIiA9PT0gdGhpcy5nZXQoMCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBmaWVsZCBkZXNpZ25hdGluZyB0aGUga2V5IG9mIGEgZG9jdW1lbnQuXG4gICAgICovICAgIHN0YXRpYyBrZXlGaWVsZCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMShbIFwiX19uYW1lX19cIiBdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgZmllbGQgc3RyaW5nIGZyb20gdGhlIGdpdmVuIHNlcnZlci1mb3JtYXR0ZWQgc3RyaW5nLlxuICAgICAqXG4gICAgICogLSBTcGxpdHRpbmcgdGhlIGVtcHR5IHN0cmluZyBpcyBub3QgYWxsb3dlZCAoZm9yIG5vdyBhdCBsZWFzdCkuXG4gICAgICogLSBFbXB0eSBzZWdtZW50cyB3aXRoaW4gdGhlIHN0cmluZyAoZS5nLiBpZiB0aGVyZSBhcmUgdHdvIGNvbnNlY3V0aXZlXG4gICAgICogICBzZXBhcmF0b3JzKSBhcmUgbm90IGFsbG93ZWQuXG4gICAgICpcbiAgICAgKiBUT0RPKGIvMzcyNDQxNTcpOiB3ZSBzaG91bGQgbWFrZSB0aGlzIG1vcmUgc3RyaWN0LiBSaWdodCBub3csIGl0IGFsbG93c1xuICAgICAqIG5vbi1pZGVudGlmaWVyIHBhdGggY29tcG9uZW50cywgZXZlbiBpZiB0aGV5IGFyZW4ndCBlc2NhcGVkLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbVNlcnZlckZvcm1hdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgbGV0IG4gPSBcIlwiLCByID0gMDtcbiAgICAgICAgY29uc3QgX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50ID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKDAgPT09IG4ubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBmaWVsZCBwYXRoICgke2V9KS4gUGF0aHMgbXVzdCBub3QgYmUgZW1wdHksIGJlZ2luIHdpdGggJy4nLCBlbmQgd2l0aCAnLicsIG9yIGNvbnRhaW4gJy4uJ2ApO1xuICAgICAgICAgICAgdC5wdXNoKG4pLCBuID0gXCJcIjtcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IGkgPSAhMTtcbiAgICAgICAgZm9yICg7ciA8IGUubGVuZ3RoOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlW3JdO1xuICAgICAgICAgICAgaWYgKFwiXFxcXFwiID09PSB0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHIgKyAxID09PSBlLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJQYXRoIGhhcyB0cmFpbGluZyBlc2NhcGUgY2hhcmFjdGVyOiBcIiArIGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlW3IgKyAxXTtcbiAgICAgICAgICAgICAgICBpZiAoXCJcXFxcXCIgIT09IHQgJiYgXCIuXCIgIT09IHQgJiYgXCJgXCIgIT09IHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgaW52YWxpZCBlc2NhcGUgc2VxdWVuY2U6IFwiICsgZSk7XG4gICAgICAgICAgICAgICAgbiArPSB0LCByICs9IDI7XG4gICAgICAgICAgICB9IGVsc2UgXCJgXCIgPT09IHQgPyAoaSA9ICFpLCByKyspIDogXCIuXCIgIT09IHQgfHwgaSA/IChuICs9IHQsIHIrKykgOiAoX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50KCksIFxuICAgICAgICAgICAgcisrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50KCksIGkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiVW50ZXJtaW5hdGVkIGAgaW4gcGF0aDogXCIgKyBlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMSh0KTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMShbXSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBEb2N1bWVudEtleSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnBhdGggPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVBhdGgoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUpKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21OYW1lKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhlKS5wb3BGaXJzdCg1KSk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCkpO1xuICAgIH1cbiAgICBnZXQgY29sbGVjdGlvbkdyb3VwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnBvcExhc3QoKS5sYXN0U2VnbWVudCgpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIHRoZSBkb2N1bWVudCBpcyBpbiB0aGUgc3BlY2lmaWVkIGNvbGxlY3Rpb25JZC4gKi8gICAgaGFzQ29sbGVjdGlvbklkKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5sZW5ndGggPj0gMiAmJiB0aGlzLnBhdGguZ2V0KHRoaXMucGF0aC5sZW5ndGggLSAyKSA9PT0gZTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIGNvbGxlY3Rpb24gZ3JvdXAgKGkuZS4gdGhlIG5hbWUgb2YgdGhlIHBhcmVudCBjb2xsZWN0aW9uKSBmb3IgdGhpcyBrZXkuICovICAgIGdldENvbGxlY3Rpb25Hcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5nZXQodGhpcy5wYXRoLmxlbmd0aCAtIDIpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgZnVsbHkgcXVhbGlmaWVkIHBhdGggdG8gdGhlIHBhcmVudCBjb2xsZWN0aW9uLiAqLyAgICBnZXRDb2xsZWN0aW9uUGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5wb3BMYXN0KCk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZSAmJiAwID09PSBSZXNvdXJjZVBhdGguY29tcGFyYXRvcih0aGlzLnBhdGgsIGUucGF0aCk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHN0YXRpYyBjb21wYXJhdG9yKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFJlc291cmNlUGF0aC5jb21wYXJhdG9yKGUucGF0aCwgdC5wYXRoKTtcbiAgICB9XG4gICAgc3RhdGljIGlzRG9jdW1lbnRLZXkoZSkge1xuICAgICAgICByZXR1cm4gZS5sZW5ndGggJSAyID09IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgZG9jdW1lbnQga2V5IHdpdGggdGhlIGdpdmVuIHNlZ21lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlZ21lbnRzIC0gVGhlIHNlZ21lbnRzIG9mIHRoZSBwYXRoIHRvIHRoZSBkb2N1bWVudFxuICAgICAqIEByZXR1cm5zIEEgbmV3IGluc3RhbmNlIG9mIERvY3VtZW50S2V5XG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VnbWVudHMoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KG5ldyBSZXNvdXJjZVBhdGgoZS5zbGljZSgpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgaW5pdGlhbCBtdXRhdGlvbiBiYXRjaCBpZCBmb3IgZWFjaCBpbmRleC4gR2V0cyB1cGRhdGVkIGR1cmluZyBpbmRleFxuICogYmFja2ZpbGwuXG4gKi9cbi8qKlxuICogQW4gaW5kZXggZGVmaW5pdGlvbiBmb3IgZmllbGQgaW5kZXhlcyBpbiBGaXJlc3RvcmUuXG4gKlxuICogRXZlcnkgaW5kZXggaXMgYXNzb2NpYXRlZCB3aXRoIGEgY29sbGVjdGlvbi4gVGhlIGRlZmluaXRpb24gY29udGFpbnMgYSBsaXN0XG4gKiBvZiBmaWVsZHMgYW5kIHRoZWlyIGluZGV4IGtpbmQgKHdoaWNoIGNhbiBiZSBgQVNDRU5ESU5HYCwgYERFU0NFTkRJTkdgIG9yXG4gKiBgQ09OVEFJTlNgIGZvciBBcnJheUNvbnRhaW5zL0FycmF5Q29udGFpbnNBbnkgcXVlcmllcykuXG4gKlxuICogVW5saWtlIHRoZSBiYWNrZW5kLCB0aGUgU0RLIGRvZXMgbm90IGRpZmZlcmVudGlhdGUgYmV0d2VlbiBjb2xsZWN0aW9uIG9yXG4gKiBjb2xsZWN0aW9uIGdyb3VwLXNjb3BlZCBpbmRpY2VzLiBFdmVyeSBpbmRleCBjYW4gYmUgdXNlZCBmb3IgYm90aCBzaW5nbGVcbiAqIGNvbGxlY3Rpb24gYW5kIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcmllcy5cbiAqL1xuY2xhc3MgRmllbGRJbmRleCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGluZGV4IElELiBSZXR1cm5zIC0xIGlmIHRoZSBpbmRleCBJRCBpcyBub3QgYXZhaWxhYmxlIChlLmcuIHRoZSBpbmRleFxuICAgICAqIGhhcyBub3QgeWV0IGJlZW4gcGVyc2lzdGVkKS5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGNvbGxlY3Rpb24gSUQgdGhpcyBpbmRleCBhcHBsaWVzIHRvLiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgZmllbGQgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovXG4gICAgbiwgXG4gICAgLyoqIFNob3dzIGhvdyB1cC10by1kYXRlIHRoZSBpbmRleCBpcyBmb3IgdGhlIGN1cnJlbnQgdXNlci4gKi9cbiAgICByKSB7XG4gICAgICAgIHRoaXMuaW5kZXhJZCA9IGUsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gdCwgdGhpcy5maWVsZHMgPSBuLCB0aGlzLmluZGV4U3RhdGUgPSByO1xuICAgIH1cbn1cblxuLyoqIEFuIElEIGZvciBhbiBpbmRleCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gYWRkZWQgdG8gcGVyc2lzdGVuY2UuICAqL1xuLyoqIFJldHVybnMgdGhlIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBzZWdtZW50IGZvciB0aGlzIGluZGV4LiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXRBcnJheVNlZ21lbnQoZSkge1xuICAgIHJldHVybiBlLmZpZWxkcy5maW5kKChlID0+IDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovID09PSBlLmtpbmQpKTtcbn1cblxuLyoqIFJldHVybnMgYWxsIGRpcmVjdGlvbmFsIChhc2NlbmRpbmcvZGVzY2VuZGluZykgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZEluZGV4R2V0RGlyZWN0aW9uYWxTZWdtZW50cyhlKSB7XG4gICAgcmV0dXJuIGUuZmllbGRzLmZpbHRlcigoZSA9PiAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLyAhPT0gZS5raW5kKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgb3JkZXIgb2YgdGhlIGRvY3VtZW50IGtleSBjb21wb25lbnQgZm9yIHRoZSBnaXZlbiBpbmRleC5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGluIHRoZSBXZWIgSW5kZXhlZERiIGltcGxlbWVudGF0aW9uLlxuICovXG4vKipcbiAqIENvbXBhcmVzIGluZGV4ZXMgYnkgY29sbGVjdGlvbiBncm91cCBhbmQgc2VnbWVudHMuIElnbm9yZXMgdXBkYXRlIHRpbWUgYW5kXG4gKiBpbmRleCBJRC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhTZW1hbnRpY0NvbXBhcmF0b3IoZSwgdCkge1xuICAgIGxldCBuID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jb2xsZWN0aW9uR3JvdXAsIHQuY29sbGVjdGlvbkdyb3VwKTtcbiAgICBpZiAoMCAhPT0gbikgcmV0dXJuIG47XG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCBNYXRoLm1pbihlLmZpZWxkcy5sZW5ndGgsIHQuZmllbGRzLmxlbmd0aCk7ICsrcikgaWYgKG4gPSBfX1BSSVZBVEVfaW5kZXhTZWdtZW50Q29tcGFyYXRvcihlLmZpZWxkc1tyXSwgdC5maWVsZHNbcl0pLCBcbiAgICAwICE9PSBuKSByZXR1cm4gbjtcbiAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5maWVsZHMubGVuZ3RoLCB0LmZpZWxkcy5sZW5ndGgpO1xufVxuXG4vKiogUmV0dXJucyBhIGRlYnVnIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBmaWVsZCBpbmRleCAqLyBGaWVsZEluZGV4LlVOS05PV05fSUQgPSAtMTtcblxuLyoqIEFuIGluZGV4IGNvbXBvbmVudCBjb25zaXN0aW5nIG9mIGZpZWxkIHBhdGggYW5kIGluZGV4IHR5cGUuICAqL1xuY2xhc3MgSW5kZXhTZWdtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIGZpZWxkIHBhdGggb2YgdGhlIGNvbXBvbmVudC4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGZpZWxkcyBzb3J0aW5nIG9yZGVyLiAqL1xuICAgIHQpIHtcbiAgICAgICAgdGhpcy5maWVsZFBhdGggPSBlLCB0aGlzLmtpbmQgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2luZGV4U2VnbWVudENvbXBhcmF0b3IoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBGaWVsZFBhdGgkMS5jb21wYXJhdG9yKGUuZmllbGRQYXRoLCB0LmZpZWxkUGF0aCk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5raW5kLCB0LmtpbmQpO1xufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgXCJoaWdoIHdhdGVyIG1hcmtcIiB0aGF0IGluZGljYXRlcyBob3cgdXBkYXRlZCB0aGUgSW5kZXggaXMgZm9yIHRoZVxuICogY3VycmVudCB1c2VyLlxuICovIGNsYXNzIEluZGV4U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEluZGljYXRlcyB3aGVuIHRoZSBpbmRleCB3YXMgbGFzdCB1cGRhdGVkIChyZWxhdGl2ZSB0byBvdGhlciBpbmRleGVzKS5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIHRoZSBsYXRlc3QgaW5kZXhlZCByZWFkIHRpbWUsIGRvY3VtZW50IGFuZCBiYXRjaCBpZC4gKi9cbiAgICB0KSB7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VOdW1iZXIgPSBlLCB0aGlzLm9mZnNldCA9IHQ7XG4gICAgfVxuICAgIC8qKiBUaGUgc3RhdGUgb2YgYW4gaW5kZXggdGhhdCBoYXMgbm90IHlldCBiZWVuIGJhY2tmaWxsZWQuICovICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleFN0YXRlKDAsIEluZGV4T2Zmc2V0Lm1pbigpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBvZmZzZXQgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgd2l0aCBhIHJlYWQgdGltZSBoaWdoZXIgdGhhblxuICogYHJlYWRUaW1lYC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRTdWNjZXNzb3JGcm9tUmVhZFRpbWUoZSwgdCkge1xuICAgIC8vIFdlIHdhbnQgdG8gY3JlYXRlIGFuIG9mZnNldCB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyB3aXRoIGEgcmVhZCB0aW1lXG4gICAgLy8gZ3JlYXRlciB0aGFuIHRoZSBwcm92aWRlZCByZWFkIHRpbWUuIFRvIGRvIHNvLCB3ZSB0ZWNobmljYWxseSBuZWVkIHRvXG4gICAgLy8gY3JlYXRlIGFuIG9mZnNldCBmb3IgYChyZWFkVGltZSwgTUFYX0RPQ1VNRU5UX0tFWSlgLiBXaGlsZSB3ZSBjb3VsZCB1c2VcbiAgICAvLyBVbmljb2RlIGNvZGVwb2ludHMgdG8gZ2VuZXJhdGUgTUFYX0RPQ1VNRU5UX0tFWSwgaXQgaXMgbXVjaCBlYXNpZXIgdG8gdXNlXG4gICAgLy8gYChyZWFkVGltZSArIDEsIERvY3VtZW50S2V5LmVtcHR5KCkpYCBzaW5jZSBgPiBEb2N1bWVudEtleS5lbXB0eSgpYCBtYXRjaGVzXG4gICAgLy8gYWxsIHZhbGlkIGRvY3VtZW50IElEcy5cbiAgICBjb25zdCBuID0gZS50b1RpbWVzdGFtcCgpLnNlY29uZHMsIHIgPSBlLnRvVGltZXN0YW1wKCkubmFub3NlY29uZHMgKyAxLCBpID0gU25hcHNob3RWZXJzaW9uLmZyb21UaW1lc3RhbXAoMWU5ID09PSByID8gbmV3IFRpbWVzdGFtcChuICsgMSwgMCkgOiBuZXcgVGltZXN0YW1wKG4sIHIpKTtcbiAgICByZXR1cm4gbmV3IEluZGV4T2Zmc2V0KGksIERvY3VtZW50S2V5LmVtcHR5KCksIHQpO1xufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBvZmZzZXQgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGRvY3VtZW50LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRGcm9tRG9jdW1lbnQoZSkge1xuICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQoZS5yZWFkVGltZSwgZS5rZXksIC0xKTtcbn1cblxuLyoqXG4gKiBTdG9yZXMgdGhlIGxhdGVzdCByZWFkIHRpbWUsIGRvY3VtZW50IGFuZCBiYXRjaCBJRCB0aGF0IHdlcmUgcHJvY2Vzc2VkIGZvciBhblxuICogaW5kZXguXG4gKi8gY2xhc3MgSW5kZXhPZmZzZXQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBsYXRlc3QgcmVhZCB0aW1lIHZlcnNpb24gdGhhdCBoYXMgYmVlbiBpbmRleGVkIGJ5IEZpcmVzdG9yZSBmb3IgdGhpc1xuICAgICAqIGZpZWxkIGluZGV4LlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSBrZXkgb2YgdGhlIGxhc3QgZG9jdW1lbnQgdGhhdCB3YXMgaW5kZXhlZCBmb3IgdGhpcyBxdWVyeS4gVXNlXG4gICAgICogYERvY3VtZW50S2V5LmVtcHR5KClgIGlmIG5vIGRvY3VtZW50IGhhcyBiZWVuIGluZGV4ZWQuXG4gICAgICovXG4gICAgdCwgXG4gICAgLypcbiAgICAgKiBUaGUgbGFyZ2VzdCBtdXRhdGlvbiBiYXRjaCBpZCB0aGF0J3MgYmVlbiBwcm9jZXNzZWQgYnkgRmlyZXN0b3JlLlxuICAgICAqL1xuICAgIG4pIHtcbiAgICAgICAgdGhpcy5yZWFkVGltZSA9IGUsIHRoaXMuZG9jdW1lbnRLZXkgPSB0LCB0aGlzLmxhcmdlc3RCYXRjaElkID0gbjtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYW4gb2Zmc2V0IHRoYXQgc29ydHMgYmVmb3JlIGFsbCByZWd1bGFyIG9mZnNldHMuICovICAgIHN0YXRpYyBtaW4oKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQoU25hcHNob3RWZXJzaW9uLm1pbigpLCBEb2N1bWVudEtleS5lbXB0eSgpLCAtMSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGFuIG9mZnNldCB0aGF0IHNvcnRzIGFmdGVyIGFsbCByZWd1bGFyIG9mZnNldHMuICovICAgIHN0YXRpYyBtYXgoKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQoU25hcHNob3RWZXJzaW9uLm1heCgpLCBEb2N1bWVudEtleS5lbXB0eSgpLCAtMSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhPZmZzZXRDb21wYXJhdG9yKGUsIHQpIHtcbiAgICBsZXQgbiA9IGUucmVhZFRpbWUuY29tcGFyZVRvKHQucmVhZFRpbWUpO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IChuID0gRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmRvY3VtZW50S2V5LCB0LmRvY3VtZW50S2V5KSwgXG4gICAgMCAhPT0gbiA/IG4gOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmxhcmdlc3RCYXRjaElkLCB0Lmxhcmdlc3RCYXRjaElkKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEYgPSBcIlRoZSBjdXJyZW50IHRhYiBpcyBub3QgaW4gdGhlIHJlcXVpcmVkIHN0YXRlIHRvIHBlcmZvcm0gdGhpcyBvcGVyYXRpb24uIEl0IG1pZ2h0IGJlIG5lY2Vzc2FyeSB0byByZWZyZXNoIHRoZSBicm93c2VyIHRhYi5cIjtcblxuLyoqXG4gKiBBIGJhc2UgY2xhc3MgcmVwcmVzZW50aW5nIGEgcGVyc2lzdGVuY2UgdHJhbnNhY3Rpb24sIGVuY2Fwc3VsYXRpbmcgYm90aCB0aGVcbiAqIHRyYW5zYWN0aW9uJ3Mgc2VxdWVuY2UgbnVtYmVycyBhcyB3ZWxsIGFzIGEgbGlzdCBvZiBvbkNvbW1pdHRlZCBsaXN0ZW5lcnMuXG4gKlxuICogV2hlbiB5b3UgY2FsbCBQZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbigpLCBpdCB3aWxsIGNyZWF0ZSBhIHRyYW5zYWN0aW9uIGFuZFxuICogcGFzcyBpdCB0byB5b3VyIGNhbGxiYWNrLiBZb3UgdGhlbiBwYXNzIGl0IHRvIGFueSBtZXRob2QgdGhhdCBvcGVyYXRlc1xuICogb24gcGVyc2lzdGVuY2UuXG4gKi8gY2xhc3MgUGVyc2lzdGVuY2VUcmFuc2FjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMgPSBbXTtcbiAgICB9XG4gICAgYWRkT25Db21taXR0ZWRMaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMucHVzaChlKTtcbiAgICB9XG4gICAgcmFpc2VPbkNvbW1pdHRlZEV2ZW50KCkge1xuICAgICAgICB0aGlzLm9uQ29tbWl0dGVkTGlzdGVuZXJzLmZvckVhY2goKGUgPT4gZSgpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBWZXJpZmllcyB0aGUgZXJyb3IgdGhyb3duIGJ5IGEgTG9jYWxTdG9yZSBvcGVyYXRpb24uIElmIGEgTG9jYWxTdG9yZVxuICogb3BlcmF0aW9uIGZhaWxzIGJlY2F1c2UgdGhlIHByaW1hcnkgbGVhc2UgaGFzIGJlZW4gdGFrZW4gYnkgYW5vdGhlciBjbGllbnQsXG4gKiB3ZSBpZ25vcmUgdGhlIGVycm9yICh0aGUgcGVyc2lzdGVuY2UgbGF5ZXIgd2lsbCBpbW1lZGlhdGVseSBjYWxsXG4gKiBgYXBwbHlQcmltYXJ5TGVhc2VgIHRvIHByb3BhZ2F0ZSB0aGUgcHJpbWFyeSBzdGF0ZSBjaGFuZ2UpLiBBbGwgb3RoZXIgZXJyb3JzXG4gKiBhcmUgcmUtdGhyb3duLlxuICpcbiAqIEBwYXJhbSBlcnIgLSBBbiBlcnJvciByZXR1cm5lZCBieSBhIExvY2FsU3RvcmUgb3BlcmF0aW9uLlxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgd2UgcmVjb3ZlcmVkLCBvciB0aGUgb3JpZ2luYWwgZXJyb3IuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKSB7XG4gICAgaWYgKGUuY29kZSAhPT0gdi5GQUlMRURfUFJFQ09ORElUSU9OIHx8IGUubWVzc2FnZSAhPT0gRikgdGhyb3cgZTtcbiAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJMb2NhbFN0b3JlXCIsIFwiVW5leHBlY3RlZGx5IGxvc3QgcHJpbWFyeSBsZWFzZVwiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUGVyc2lzdGVuY2VQcm9taXNlIGlzIGVzc2VudGlhbGx5IGEgcmUtaW1wbGVtZW50YXRpb24gb2YgUHJvbWlzZSBleGNlcHRcbiAqIGl0IGhhcyBhIC5uZXh0KCkgbWV0aG9kIGluc3RlYWQgb2YgLnRoZW4oKSBhbmQgLm5leHQoKSBhbmQgLmNhdGNoKCkgY2FsbGJhY2tzXG4gKiBhcmUgZXhlY3V0ZWQgc3luY2hyb25vdXNseSB3aGVuIGEgUGVyc2lzdGVuY2VQcm9taXNlIHJlc29sdmVzIHJhdGhlciB0aGFuXG4gKiBhc3luY2hyb25vdXNseSAoUHJvbWlzZSBpbXBsZW1lbnRhdGlvbnMgdXNlIHNldEltbWVkaWF0ZSgpIG9yIHNpbWlsYXIpLlxuICpcbiAqIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIGludGVyb3BlcmF0ZSB3aXRoIEluZGV4ZWREQiB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHlcbiAqIGNvbW1pdCB0cmFuc2FjdGlvbnMgaWYgY29udHJvbCBpcyByZXR1cm5lZCB0byB0aGUgZXZlbnQgbG9vcCB3aXRob3V0XG4gKiBzeW5jaHJvbm91c2x5IGluaXRpYXRpbmcgYW5vdGhlciBvcGVyYXRpb24gb24gdGhlIHRyYW5zYWN0aW9uLlxuICpcbiAqIE5PVEU6IC50aGVuKCkgYW5kIC5jYXRjaCgpIG9ubHkgYWxsb3cgYSBzaW5nbGUgY29uc3VtZXIsIHVubGlrZSBub3JtYWxcbiAqIFByb21pc2VzLlxuICovIGNsYXNzIFBlcnNpc3RlbmNlUHJvbWlzZSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICAvLyBOT1RFOiBuZXh0L2NhdGNoQ2FsbGJhY2sgd2lsbCBhbHdheXMgcG9pbnQgdG8gb3VyIG93biB3cmFwcGVyIGZ1bmN0aW9ucyxcbiAgICAgICAgLy8gbm90IHRoZSB1c2VyJ3MgcmF3IG5leHQoKSBvciBjYXRjaCgpIGNhbGxiYWNrcy5cbiAgICAgICAgdGhpcy5uZXh0Q2FsbGJhY2sgPSBudWxsLCB0aGlzLmNhdGNoQ2FsbGJhY2sgPSBudWxsLCBcbiAgICAgICAgLy8gV2hlbiB0aGUgb3BlcmF0aW9uIHJlc29sdmVzLCB3ZSdsbCBzZXQgcmVzdWx0IG9yIGVycm9yIGFuZCBtYXJrIGlzRG9uZS5cbiAgICAgICAgdGhpcy5yZXN1bHQgPSB2b2lkIDAsIHRoaXMuZXJyb3IgPSB2b2lkIDAsIHRoaXMuaXNEb25lID0gITEsIFxuICAgICAgICAvLyBTZXQgdG8gdHJ1ZSB3aGVuIC50aGVuKCkgb3IgLmNhdGNoKCkgYXJlIGNhbGxlZCBhbmQgcHJldmVudHMgYWRkaXRpb25hbFxuICAgICAgICAvLyBjaGFpbmluZy5cbiAgICAgICAgdGhpcy5jYWxsYmFja0F0dGFjaGVkID0gITEsIGUoKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0RvbmUgPSAhMCwgdGhpcy5yZXN1bHQgPSBlLCB0aGlzLm5leHRDYWxsYmFjayAmJiBcbiAgICAgICAgICAgIC8vIHZhbHVlIHNob3VsZCBiZSBkZWZpbmVkIHVubGVzcyBUIGlzIFZvaWQsIGJ1dCB3ZSBjYW4ndCBleHByZXNzXG4gICAgICAgICAgICAvLyB0aGF0IGluIHRoZSB0eXBlIHN5c3RlbS5cbiAgICAgICAgICAgIHRoaXMubmV4dENhbGxiYWNrKGUpO1xuICAgICAgICB9KSwgKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0RvbmUgPSAhMCwgdGhpcy5lcnJvciA9IGUsIHRoaXMuY2F0Y2hDYWxsYmFjayAmJiB0aGlzLmNhdGNoQ2FsbGJhY2soZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5uZXh0KHZvaWQgMCwgZSk7XG4gICAgfVxuICAgIG5leHQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsYmFja0F0dGFjaGVkICYmIGZhaWwoKSwgdGhpcy5jYWxsYmFja0F0dGFjaGVkID0gITAsIHRoaXMuaXNEb25lID8gdGhpcy5lcnJvciA/IHRoaXMud3JhcEZhaWx1cmUodCwgdGhpcy5lcnJvcikgOiB0aGlzLndyYXBTdWNjZXNzKGUsIHRoaXMucmVzdWx0KSA6IG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKChuLCByKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHRDYWxsYmFjayA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcFN1Y2Nlc3MoZSwgdCkubmV4dChuLCByKTtcbiAgICAgICAgICAgIH0sIHRoaXMuY2F0Y2hDYWxsYmFjayA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcEZhaWx1cmUodCwgZSkubmV4dChuLCByKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdG9Qcm9taXNlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHQoZSwgdCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgd3JhcFVzZXJGdW5jdGlvbihlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZVByb21pc2UgPyB0IDogUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdyYXBTdWNjZXNzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUgPyB0aGlzLndyYXBVc2VyRnVuY3Rpb24oKCgpID0+IGUodCkpKSA6IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHQpO1xuICAgIH1cbiAgICB3cmFwRmFpbHVyZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBlID8gdGhpcy53cmFwVXNlckZ1bmN0aW9uKCgoKSA9PiBlKHQpKSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVqZWN0KHQpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVzb2x2ZShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgdChlKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVqZWN0KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBuKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHN0YXRpYyB3YWl0Rm9yKFxuICAgIC8vIEFjY2VwdCBhbGwgUHJvbWlzZSB0eXBlcyBpbiB3YWl0Rm9yKCkuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgbGV0IHIgPSAwLCBpID0gMCwgcyA9ICExO1xuICAgICAgICAgICAgZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICArK3IsIGUubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICArK2ksIHMgJiYgaSA9PT0gciAmJiB0KCk7XG4gICAgICAgICAgICAgICAgfSksIChlID0+IG4oZSkpKTtcbiAgICAgICAgICAgIH0pKSwgcyA9ICEwLCBpID09PSByICYmIHQoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhbiBhcnJheSBvZiBwcmVkaWNhdGUgZnVuY3Rpb25zIHRoYXQgYXN5bmNocm9ub3VzbHkgZXZhbHVhdGUgdG8gYVxuICAgICAqIGJvb2xlYW4sIGltcGxlbWVudHMgYSBzaG9ydC1jaXJjdWl0aW5nIGBvcmAgYmV0d2VlbiB0aGUgcmVzdWx0cy4gUHJlZGljYXRlc1xuICAgICAqIHdpbGwgYmUgZXZhbHVhdGVkIHVudGlsIG9uZSBvZiB0aGVtIHJldHVybnMgYHRydWVgLCB0aGVuIHN0b3AuIFRoZSBmaW5hbFxuICAgICAqIHJlc3VsdCB3aWxsIGJlIHdoZXRoZXIgYW55IG9mIHRoZW0gcmV0dXJuZWQgYHRydWVgLlxuICAgICAqLyAgICBzdGF0aWMgb3IoZSkge1xuICAgICAgICBsZXQgdCA9IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCExKTtcbiAgICAgICAgZm9yIChjb25zdCBuIG9mIGUpIHQgPSB0Lm5leHQoKGUgPT4gZSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGUpIDogbigpKSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICBzdGF0aWMgZm9yRWFjaChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG4ucHVzaCh0LmNhbGwodGhpcywgZSwgcikpO1xuICAgICAgICB9KSksIHRoaXMud2FpdEZvcihuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uY3VycmVudGx5IG1hcCBhbGwgYXJyYXkgZWxlbWVudHMgdGhyb3VnaCBhc3luY2hyb25vdXMgZnVuY3Rpb24uXG4gICAgICovICAgIHN0YXRpYyBtYXBBcnJheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IGUubGVuZ3RoLCBzID0gbmV3IEFycmF5KGkpO1xuICAgICAgICAgICAgbGV0IG8gPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgXyA9IDA7IF8gPCBpOyBfKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gXztcbiAgICAgICAgICAgICAgICB0KGVbYV0pLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzW2FdID0gZSwgKytvLCBvID09PSBpICYmIG4ocyk7XG4gICAgICAgICAgICAgICAgfSksIChlID0+IHIoZSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBbiBhbHRlcm5hdGl2ZSB0byByZWN1cnNpdmUgUGVyc2lzdGVuY2VQcm9taXNlIGNhbGxzLCB0aGF0IGF2b2lkc1xuICAgICAqIHBvdGVudGlhbCBtZW1vcnkgcHJvYmxlbXMgZnJvbSB1bmJvdW5kZWQgY2hhaW5zIG9mIHByb21pc2VzLlxuICAgICAqXG4gICAgICogVGhlIGBhY3Rpb25gIHdpbGwgYmUgY2FsbGVkIHJlcGVhdGVkbHkgd2hpbGUgYGNvbmRpdGlvbmAgaXMgdHJ1ZS5cbiAgICAgKi8gICAgc3RhdGljIGRvV2hpbGUoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgITAgPT09IGUoKSA/IHQoKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9KSwgcikgOiBuKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcHJvY2VzcygpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBTaW1wbGVEYi5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbi8qKlxuICogV3JhcHMgYW4gSURCVHJhbnNhY3Rpb24gYW5kIGV4cG9zZXMgYSBzdG9yZSgpIG1ldGhvZCB0byBnZXQgYSBoYW5kbGUgdG8gYVxuICogc3BlY2lmaWMgb2JqZWN0IHN0b3JlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfU2ltcGxlRGJUcmFuc2FjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmFjdGlvbiA9IGUsIHRoaXMudHJhbnNhY3Rpb24gPSB0LCB0aGlzLmFib3J0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlc3VsdCBvZiB0aGUgSW5kZXhlZERiIHRyYW5zYWN0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZCwgdGhpcy50cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tLnJlc29sdmUoKTtcbiAgICAgICAgfSwgdGhpcy50cmFuc2FjdGlvbi5vbmFib3J0ID0gKCkgPT4ge1xuICAgICAgICAgICAgdC5lcnJvciA/IHRoaXMubS5yZWplY3QobmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUsIHQuZXJyb3IpKSA6IHRoaXMubS5yZXNvbHZlKCk7XG4gICAgICAgIH0sIHRoaXMudHJhbnNhY3Rpb24ub25lcnJvciA9IHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9jaGVja0ZvckFuZFJlcG9ydGlPU0Vycm9yKHQudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgIHRoaXMubS5yZWplY3QobmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUsIG4pKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3RhdGljIG9wZW4oZSwgdCwgbiwgcikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2ltcGxlRGJUcmFuc2FjdGlvbih0LCBlLnRyYW5zYWN0aW9uKHIsIG4pKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKHQsIGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBnKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tLnByb21pc2U7XG4gICAgfVxuICAgIGFib3J0KGUpIHtcbiAgICAgICAgZSAmJiB0aGlzLm0ucmVqZWN0KGUpLCB0aGlzLmFib3J0ZWQgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiQWJvcnRpbmcgdHJhbnNhY3Rpb246XCIsIGUgPyBlLm1lc3NhZ2UgOiBcIkNsaWVudC1pbml0aWF0ZWQgYWJvcnRcIiksIFxuICAgICAgICB0aGlzLmFib3J0ZWQgPSAhMCwgdGhpcy50cmFuc2FjdGlvbi5hYm9ydCgpKTtcbiAgICB9XG4gICAgcCgpIHtcbiAgICAgICAgLy8gSWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgVjMgSW5kZXhlZERCLCB3ZSBpbnZva2UgY29tbWl0KCkgZXhwbGljaXRseSB0b1xuICAgICAgICAvLyBzcGVlZCB1cCBpbmRleCBEQiBwcm9jZXNzaW5nIGlmIHRoZSBldmVudCBsb29wIHJlbWFpbnMgYmxvY2tzLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICBjb25zdCBlID0gdGhpcy50cmFuc2FjdGlvbjtcbiAgICAgICAgdGhpcy5hYm9ydGVkIHx8IFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgZS5jb21taXQgfHwgZS5jb21taXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIFNpbXBsZURiU3RvcmU8S2V5VHlwZSwgVmFsdWVUeXBlPiBmb3IgdGhlIHNwZWNpZmllZCBzdG9yZS4gQWxsXG4gICAgICogb3BlcmF0aW9ucyBwZXJmb3JtZWQgb24gdGhlIFNpbXBsZURiU3RvcmUgaGFwcGVuIHdpdGhpbiB0aGUgY29udGV4dCBvZiB0aGlzXG4gICAgICogdHJhbnNhY3Rpb24gYW5kIGl0IGNhbm5vdCBiZSB1c2VkIGFueW1vcmUgb25jZSB0aGUgdHJhbnNhY3Rpb24gaXNcbiAgICAgKiBjb21wbGV0ZWQuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgd2UgY2FuJ3QgYWN0dWFsbHkgZW5mb3JjZSB0aGF0IHRoZSBLZXlUeXBlIGFuZCBWYWx1ZVR5cGUgYXJlXG4gICAgICogY29ycmVjdCwgYnV0IHRoZXkgYWxsb3cgdHlwZSBzYWZldHkgdGhyb3VnaCB0aGUgcmVzdCBvZiB0aGUgY29uc3VtaW5nIGNvZGUuXG4gICAgICovICAgIHN0b3JlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMudHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoZSk7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1NpbXBsZURiU3RvcmUodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGEgd3JhcHBlciBhcm91bmQgSW5kZXhlZERiIHdpdGggYSBzaW1wbGlmaWVkIGludGVyZmFjZSB0aGF0IHVzZXNcbiAqIFByb21pc2UtbGlrZSByZXR1cm4gdmFsdWVzIHRvIGNoYWluIG9wZXJhdGlvbnMuIFJlYWwgcHJvbWlzZXMgY2Fubm90IGJlIHVzZWRcbiAqIHNpbmNlIC50aGVuKCkgY29udGludWF0aW9ucyBhcmUgZXhlY3V0ZWQgYXN5bmNocm9ub3VzbHkgKGUuZy4gdmlhXG4gKiAuc2V0SW1tZWRpYXRlKSwgd2hpY2ggd291bGQgY2F1c2UgSW5kZXhlZERCIHRvIGVuZCB0aGUgdHJhbnNhY3Rpb24uXG4gKiBTZWUgUGVyc2lzdGVuY2VQcm9taXNlIGZvciBtb3JlIGRldGFpbHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1NpbXBsZURiIHtcbiAgICAvKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2ltcGxlRGIgd3JhcHBlciBmb3IgSW5kZXhlZERiIGRhdGFiYXNlIGBuYW1lYC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBgdmVyc2lvbmAgbXVzdCBub3QgYmUgYSBkb3duZ3JhZGUuIEluZGV4ZWREQiBkb2VzIG5vdCBzdXBwb3J0XG4gICAgICogZG93bmdyYWRpbmcgdGhlIHNjaGVtYSB2ZXJzaW9uLiBXZSBjdXJyZW50bHkgZG8gbm90IHN1cHBvcnQgYW55IHdheSB0byBkb1xuICAgICAqIHZlcnNpb25pbmcgb3V0c2lkZSBvZiBJbmRleGVkREIncyB2ZXJzaW9uaW5nIG1lY2hhbmlzbSwgYXMgb25seVxuICAgICAqIHZlcnNpb24tdXBncmFkZSB0cmFuc2FjdGlvbnMgYXJlIGFsbG93ZWQgdG8gZG8gdGhpbmdzIGxpa2UgY3JlYXRlXG4gICAgICogb2JqZWN0c3RvcmVzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5uYW1lID0gZSwgdGhpcy52ZXJzaW9uID0gdCwgdGhpcy5TID0gbjtcbiAgICAgICAgLy8gTk9URTogQWNjb3JkaW5nIHRvIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0xOTcwNTAsIHRoZVxuICAgICAgICAvLyBidWcgd2UncmUgY2hlY2tpbmcgZm9yIHNob3VsZCBleGlzdCBpbiBpT1MgPj0gMTIuMiBhbmQgPCAxMywgYnV0IGZvclxuICAgICAgICAvLyB3aGF0ZXZlciByZWFzb24gaXQncyBtdWNoIGhhcmRlciB0byBoaXQgYWZ0ZXIgMTIuMiBzbyB3ZSBvbmx5IHByb2FjdGl2ZWx5XG4gICAgICAgIC8vIGxvZyBvbiAxMi4yLlxuICAgICAgICAxMi4yID09PSBfX1BSSVZBVEVfU2ltcGxlRGIuRChnZXRVQSgpKSAmJiBfX1BSSVZBVEVfbG9nRXJyb3IoXCJGaXJlc3RvcmUgcGVyc2lzdGVuY2Ugc3VmZmVycyBmcm9tIGEgYnVnIGluIGlPUyAxMi4yIFNhZmFyaSB0aGF0IG1heSBjYXVzZSB5b3VyIGFwcCB0byBzdG9wIHdvcmtpbmcuIFNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3EvNTY0OTYyOTYvMTEwOTE1IGZvciBkZXRhaWxzIGFuZCBhIHBvdGVudGlhbCB3b3JrYXJvdW5kLlwiKTtcbiAgICB9XG4gICAgLyoqIERlbGV0ZXMgdGhlIHNwZWNpZmllZCBkYXRhYmFzZS4gKi8gICAgc3RhdGljIGRlbGV0ZShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlJlbW92aW5nIGRhdGFiYXNlOlwiLCBlKSwgX19QUklWQVRFX3dyYXBSZXF1ZXN0KHdpbmRvdy5pbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZSkpLnRvUHJvbWlzZSgpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIEluZGV4ZWREQiBpcyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuICovICAgIHN0YXRpYyB2KCkge1xuICAgICAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHJldHVybiAhMTtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9TaW1wbGVEYi5DKCkpIHJldHVybiAhMDtcbiAgICAgICAgLy8gV2UgZXh0ZW5zaXZlbHkgdXNlIGluZGV4ZWQgYXJyYXkgdmFsdWVzIGFuZCBjb21wb3VuZCBrZXlzLFxuICAgICAgICAvLyB3aGljaCBJRSBhbmQgRWRnZSBkbyBub3Qgc3VwcG9ydC4gSG93ZXZlciwgdGhleSBzdGlsbCBoYXZlIGluZGV4ZWREQlxuICAgICAgICAvLyBkZWZpbmVkIG9uIHRoZSB3aW5kb3csIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHRoZW0gaGVyZSBhbmQgbWFrZSBzdXJlXG4gICAgICAgIC8vIHRvIHJldHVybiB0aGF0IHBlcnNpc3RlbmNlIGlzIG5vdCBlbmFibGVkIGZvciB0aG9zZSBicm93c2Vycy5cbiAgICAgICAgLy8gRm9yIHRyYWNraW5nIHN1cHBvcnQgb2YgdGhpcyBmZWF0dXJlLCBzZWUgaGVyZTpcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubWljcm9zb2Z0LmNvbS9lbi11cy9taWNyb3NvZnQtZWRnZS9wbGF0Zm9ybS9zdGF0dXMvaW5kZXhlZGRiYXJyYXlzYW5kbXVsdGllbnRyeXN1cHBvcnQvXG4gICAgICAgIC8vIENoZWNrIHRoZSBVQSBzdHJpbmcgdG8gZmluZCBvdXQgdGhlIGJyb3dzZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IGdldFVBKCksIHQgPSBfX1BSSVZBVEVfU2ltcGxlRGIuRChlKSwgbiA9IDAgPCB0ICYmIHQgPCAxMCwgciA9IF9fUFJJVkFURV9TaW1wbGVEYi5GKGUpLCBpID0gMCA8IHIgJiYgciA8IDQuNTtcbiAgICAgICAgLy8gSUUgMTBcbiAgICAgICAgLy8gdWEgPSAnTW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgMTAuMDsgV2luZG93cyBOVCA2LjI7IFRyaWRlbnQvNi4wKSc7XG4gICAgICAgIC8vIElFIDExXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMzsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28nO1xuICAgICAgICAvLyBFZGdlXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLFxuICAgICAgICAvLyBsaWtlIEdlY2tvKSBDaHJvbWUvMzkuMC4yMTcxLjcxIFNhZmFyaS81MzcuMzYgRWRnZS8xMi4wJztcbiAgICAgICAgLy8gaU9TIFNhZmFyaTogRGlzYWJsZSBmb3IgdXNlcnMgcnVubmluZyBpT1MgdmVyc2lvbiA8IDEwLlxuICAgICAgICAgICAgICAgIHJldHVybiAhKGUuaW5kZXhPZihcIk1TSUUgXCIpID4gMCB8fCBlLmluZGV4T2YoXCJUcmlkZW50L1wiKSA+IDAgfHwgZS5pbmRleE9mKFwiRWRnZS9cIikgPiAwIHx8IG4gfHwgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYmFja2luZyBJbmRleGVkREIgc3RvcmUgaXMgdGhlIE5vZGUgSW5kZXhlZERCU2hpbVxuICAgICAqIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL2F4ZW1jbGlvbi9JbmRleGVkREJTaGltKS5cbiAgICAgKi8gICAgc3RhdGljIEMoKSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgcHJvY2VzcyAmJiBcIllFU1wiID09PSAobnVsbCA9PT0gKGUgPSBwcm9jZXNzLmVudikgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5NKTtcbiAgICB9XG4gICAgLyoqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZyb20gYSB0cmFuc2FjdGlvbi4gKi8gICAgc3RhdGljIE8oZSwgdCkge1xuICAgICAgICByZXR1cm4gZS5zdG9yZSh0KTtcbiAgICB9XG4gICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgIC8qKiBQYXJzZSBVc2VyIEFnZW50IHRvIGRldGVybWluZSBpT1MgdmVyc2lvbi4gUmV0dXJucyAtMSBpZiBub3QgZm91bmQuICovXG4gICAgc3RhdGljIEQoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5tYXRjaCgvaSg/OnBob25lfHBhZHxwb2QpIG9zIChbXFxkX10rKS9pKSwgbiA9IHQgPyB0WzFdLnNwbGl0KFwiX1wiKS5zbGljZSgwLCAyKS5qb2luKFwiLlwiKSA6IFwiLTFcIjtcbiAgICAgICAgcmV0dXJuIE51bWJlcihuKTtcbiAgICB9XG4gICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgIC8qKiBQYXJzZSBVc2VyIEFnZW50IHRvIGRldGVybWluZSBBbmRyb2lkIHZlcnNpb24uIFJldHVybnMgLTEgaWYgbm90IGZvdW5kLiAqL1xuICAgIHN0YXRpYyBGKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUubWF0Y2goL0FuZHJvaWQgKFtcXGQuXSspL2kpLCBuID0gdCA/IHRbMV0uc3BsaXQoXCIuXCIpLnNsaWNlKDAsIDIpLmpvaW4oXCIuXCIpIDogXCItMVwiO1xuICAgICAgICByZXR1cm4gTnVtYmVyKG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPcGVucyB0aGUgc3BlY2lmaWVkIGRhdGFiYXNlLCBjcmVhdGluZyBvciB1cGdyYWRpbmcgaXQgaWYgbmVjZXNzYXJ5LlxuICAgICAqLyAgICBhc3luYyBOKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiT3BlbmluZyBkYXRhYmFzZTpcIiwgdGhpcy5uYW1lKSwgXG4gICAgICAgIHRoaXMuZGIgPSBhd2FpdCBuZXcgUHJvbWlzZSgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSW52ZXN0aWdhdGUgYnJvd3NlciBjb21wYXRpYmlsaXR5LlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0luZGV4ZWREQl9BUEkvVXNpbmdfSW5kZXhlZERCXG4gICAgICAgICAgICAvLyBzdWdnZXN0cyBJRTkgYW5kIG9sZGVyIFdlYktpdCBicm93c2VycyBoYW5kbGUgdXBncmFkZVxuICAgICAgICAgICAgLy8gZGlmZmVyZW50bHkuIFRoZXkgZXhwZWN0IHNldFZlcnNpb24sIGFzIGRlc2NyaWJlZCBoZXJlOlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0lEQlZlcnNpb25DaGFuZ2VSZXF1ZXN0L3NldFZlcnNpb25cbiAgICAgICAgICAgIGNvbnN0IHIgPSBpbmRleGVkREIub3Blbih0aGlzLm5hbWUsIHRoaXMudmVyc2lvbik7XG4gICAgICAgICAgICByLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgdChuKTtcbiAgICAgICAgICAgIH0sIHIub25ibG9ja2VkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIG4obmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUsIFwiQ2Fubm90IHVwZ3JhZGUgSW5kZXhlZERCIHNjaGVtYSB3aGlsZSBhbm90aGVyIHRhYiBpcyBvcGVuLiBDbG9zZSBhbGwgdGFicyB0aGF0IGFjY2VzcyBGaXJlc3RvcmUgYW5kIHJlbG9hZCB0aGlzIHBhZ2UgdG8gcHJvY2VlZC5cIikpO1xuICAgICAgICAgICAgfSwgci5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHQudGFyZ2V0LmVycm9yO1xuICAgICAgICAgICAgICAgIFwiVmVyc2lvbkVycm9yXCIgPT09IHIubmFtZSA/IG4obmV3IEZpcmVzdG9yZUVycm9yKHYuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJBIG5ld2VyIHZlcnNpb24gb2YgdGhlIEZpcmVzdG9yZSBTREsgd2FzIHByZXZpb3VzbHkgdXNlZCBhbmQgc28gdGhlIHBlcnNpc3RlZCBkYXRhIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGhlIHZlcnNpb24gb2YgdGhlIFNESyB5b3UgYXJlIG5vdyB1c2luZy4gVGhlIFNESyB3aWxsIG9wZXJhdGUgd2l0aCBwZXJzaXN0ZW5jZSBkaXNhYmxlZC4gSWYgeW91IG5lZWQgcGVyc2lzdGVuY2UsIHBsZWFzZSByZS11cGdyYWRlIHRvIGEgbmV3ZXIgdmVyc2lvbiBvZiB0aGUgU0RLIG9yIGVsc2UgY2xlYXIgdGhlIHBlcnNpc3RlZCBJbmRleGVkREIgZGF0YSBmb3IgeW91ciBhcHAgdG8gc3RhcnQgZnJlc2guXCIpKSA6IFwiSW52YWxpZFN0YXRlRXJyb3JcIiA9PT0gci5uYW1lID8gbihuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlVuYWJsZSB0byBvcGVuIGFuIEluZGV4ZWREQiBjb25uZWN0aW9uLiBUaGlzIGNvdWxkIGJlIGR1ZSB0byBydW5uaW5nIGluIGEgcHJpdmF0ZSBicm93c2luZyBzZXNzaW9uIG9uIGEgYnJvd3NlciB3aG9zZSBwcml2YXRlIGJyb3dzaW5nIHNlc3Npb25zIGRvIG5vdCBzdXBwb3J0IEluZGV4ZWREQjogXCIgKyByKSkgOiBuKG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlLCByKSk7XG4gICAgICAgICAgICB9LCByLm9udXBncmFkZW5lZWRlZCA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsICdEYXRhYmFzZSBcIicgKyB0aGlzLm5hbWUgKyAnXCIgcmVxdWlyZXMgdXBncmFkZSBmcm9tIHZlcnNpb246JywgZS5vbGRWZXJzaW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIHRoaXMuUy5CKHQsIHIudHJhbnNhY3Rpb24sIGUub2xkVmVyc2lvbiwgdGhpcy52ZXJzaW9uKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiRGF0YWJhc2UgdXBncmFkZSB0byB2ZXJzaW9uIFwiICsgdGhpcy52ZXJzaW9uICsgXCIgY29tcGxldGVcIik7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpKSwgdGhpcy5MICYmICh0aGlzLmRiLm9udmVyc2lvbmNoYW5nZSA9IGUgPT4gdGhpcy5MKGUpKSwgdGhpcy5kYjtcbiAgICB9XG4gICAgayhlKSB7XG4gICAgICAgIHRoaXMuTCA9IGUsIHRoaXMuZGIgJiYgKHRoaXMuZGIub252ZXJzaW9uY2hhbmdlID0gdCA9PiBlKHQpKTtcbiAgICB9XG4gICAgYXN5bmMgcnVuVHJhbnNhY3Rpb24oZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gXCJyZWFkb25seVwiID09PSB0O1xuICAgICAgICBsZXQgcyA9IDA7XG4gICAgICAgIGZvciAoOzspIHtcbiAgICAgICAgICAgICsrcztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYiA9IGF3YWl0IHRoaXMuTihlKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX1NpbXBsZURiVHJhbnNhY3Rpb24ub3Blbih0aGlzLmRiLCBlLCBpID8gXCJyZWFkb25seVwiIDogXCJyZWFkd3JpdGVcIiwgbiksIHMgPSByKHQpLm5leHQoKGUgPT4gKHQucCgpLCBcbiAgICAgICAgICAgICAgICBlKSkpLmNhdGNoKChlID0+IChcbiAgICAgICAgICAgICAgICAvLyBBYm9ydCB0aGUgdHJhbnNhY3Rpb24gaWYgdGhlcmUgd2FzIGFuIGVycm9yLlxuICAgICAgICAgICAgICAgIHQuYWJvcnQoZSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZWplY3QoZSkpKSkudG9Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgLy8gQXMgbm90ZWQgYWJvdmUsIGVycm9ycyBhcmUgcHJvcGFnYXRlZCBieSBhYm9ydGluZyB0aGUgdHJhbnNhY3Rpb24uIFNvXG4gICAgICAgICAgICAgICAgLy8gd2Ugc3dhbGxvdyBhbnkgZXJyb3IgaGVyZSB0byBhdm9pZCB0aGUgYnJvd3NlciBsb2dnaW5nIGl0IGFzIHVuaGFuZGxlZC5cbiAgICAgICAgICAgICAgICByZXR1cm4gcy5jYXRjaCgoKCkgPT4ge30pKSwgXG4gICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgdGhlIHRyYW5zYWN0aW9uIHRvIGNvbXBsZXRlIChpLmUuIEluZGV4ZWREYidzIG9uc3VjY2VzcyBldmVudCB0b1xuICAgICAgICAgICAgICAgIC8vIGZpcmUpLCBidXQgc3RpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCB0cmFuc2FjdGlvbkZuUmVzdWx0IGJhY2sgdG8gdGhlXG4gICAgICAgICAgICAgICAgLy8gY2FsbGVyLlxuICAgICAgICAgICAgICAgIGF3YWl0IHQuZywgcztcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZSwgbiA9IFwiRmlyZWJhc2VFcnJvclwiICE9PSB0Lm5hbWUgJiYgcyA8IDM7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhzY2htaWR0LXNlYmFzdGlhbik6IFdlIGNvdWxkIHByb2JhYmx5IGJlIHNtYXJ0ZXIgYWJvdXQgdGhpcyBhbmRcbiAgICAgICAgICAgICAgICAvLyBub3QgcmV0cnkgZXhjZXB0aW9ucyB0aGF0IGFyZSBsaWtlbHkgdW5yZWNvdmVyYWJsZSAoc3VjaCBhcyBxdW90YVxuICAgICAgICAgICAgICAgIC8vIGV4Y2VlZGVkIGVycm9ycykuXG4gICAgICAgICAgICAgICAgLy8gTm90ZTogV2UgY2Fubm90IHVzZSBhbiBpbnN0YW5jZW9mIGNoZWNrIGZvciBGaXJlc3RvcmVFeGNlcHRpb24sIHNpbmNlIHRoZVxuICAgICAgICAgICAgICAgIC8vIGV4Y2VwdGlvbiBpcyB3cmFwcGVkIGluIGEgZ2VuZXJpYyBlcnJvciBieSBvdXIgYXN5bmMvYXdhaXQgaGFuZGxpbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlRyYW5zYWN0aW9uIGZhaWxlZCB3aXRoIGVycm9yOlwiLCB0Lm1lc3NhZ2UsIFwiUmV0cnlpbmc6XCIsIG4pLCBcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCksICFuKSByZXR1cm4gUHJvbWlzZS5yZWplY3QodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuZGIgJiYgdGhpcy5kYi5jbG9zZSgpLCB0aGlzLmRiID0gdm9pZCAwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGNvbnRyb2xsZXIgZm9yIGl0ZXJhdGluZyBvdmVyIGEga2V5IHJhbmdlIG9yIGluZGV4LiBJdCBhbGxvd3MgYW4gaXRlcmF0ZVxuICogY2FsbGJhY2sgdG8gZGVsZXRlIHRoZSBjdXJyZW50bHktcmVmZXJlbmNlZCBvYmplY3QsIG9yIGp1bXAgdG8gYSBuZXcga2V5XG4gKiB3aXRoaW4gdGhlIGtleSByYW5nZSBvciBpbmRleC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSXRlcmF0aW9uQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnEgPSBlLCB0aGlzLksgPSAhMSwgdGhpcy4kID0gbnVsbDtcbiAgICB9XG4gICAgZ2V0IGlzRG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSztcbiAgICB9XG4gICAgZ2V0IFUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiQ7XG4gICAgfVxuICAgIHNldCBjdXJzb3IoZSkge1xuICAgICAgICB0aGlzLnEgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgdG8gc3RvcCBpdGVyYXRpb24gYXQgYW55IHBvaW50LlxuICAgICAqLyAgICBkb25lKCkge1xuICAgICAgICB0aGlzLksgPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHRvIHNraXAgdG8gdGhhdCBuZXh0IGtleSwgd2hpY2ggY291bGQgYmVcbiAgICAgKiBhbiBpbmRleCBvciBhIHByaW1hcnkga2V5LlxuICAgICAqLyAgICBXKGUpIHtcbiAgICAgICAgdGhpcy4kID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIHRoZSBjdXJyZW50IGN1cnNvciB2YWx1ZSBmcm9tIHRoZSBvYmplY3Qgc3RvcmUuXG4gICAgICpcbiAgICAgKiBOT1RFOiBZb3UgQ0FOTk9UIGRvIHRoaXMgd2l0aCBhIGtleXNPbmx5IHF1ZXJ5LlxuICAgICAqLyAgICBkZWxldGUoKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5xLmRlbGV0ZSgpKTtcbiAgICB9XG59XG5cbi8qKiBBbiBlcnJvciB0aGF0IHdyYXBzIGV4Y2VwdGlvbnMgdGhhdCB0aHJvd24gZHVyaW5nIEluZGV4ZWREQiBleGVjdXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yIGV4dGVuZHMgRmlyZXN0b3JlRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIodi5VTkFWQUlMQUJMRSwgYEluZGV4ZWREQiB0cmFuc2FjdGlvbiAnJHtlfScgZmFpbGVkOiAke3R9YCksIHRoaXMubmFtZSA9IFwiSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvclwiO1xuICAgIH1cbn1cblxuLyoqIFZlcmlmaWVzIHdoZXRoZXIgYGVgIGlzIGFuIEluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkge1xuICAgIC8vIFVzZSBuYW1lIGVxdWFsaXR5LCBhcyBpbnN0YW5jZW9mIGNoZWNrcyBvbiBlcnJvcnMgZG9uJ3Qgd29yayB3aXRoIGVycm9yc1xuICAgIC8vIHRoYXQgd3JhcCBvdGhlciBlcnJvcnMuXG4gICAgcmV0dXJuIFwiSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvclwiID09PSBlLm5hbWU7XG59XG5cbi8qKlxuICogQSB3cmFwcGVyIGFyb3VuZCBhbiBJREJPYmplY3RTdG9yZSBwcm92aWRpbmcgYW4gQVBJIHRoYXQ6XG4gKlxuICogMSkgSGFzIGdlbmVyaWMgS2V5VHlwZSAvIFZhbHVlVHlwZSBwYXJhbWV0ZXJzIHRvIHByb3ZpZGUgc3Ryb25nbHktdHlwZWRcbiAqIG1ldGhvZHMgZm9yIGFjdGluZyBhZ2FpbnN0IHRoZSBvYmplY3Qgc3RvcmUuXG4gKiAyKSBEZWFscyB3aXRoIEluZGV4ZWREQidzIG9uc3VjY2VzcyAvIG9uZXJyb3IgZXZlbnQgY2FsbGJhY2tzLCBtYWtpbmcgZXZlcnlcbiAqIG1ldGhvZCByZXR1cm4gYSBQZXJzaXN0ZW5jZVByb21pc2UgaW5zdGVhZC5cbiAqIDMpIFByb3ZpZGVzIGEgaGlnaGVyLWxldmVsIEFQSSB0byBhdm9pZCBuZWVkaW5nIHRvIGRvIGV4Y2Vzc2l2ZSB3cmFwcGluZyBvZlxuICogaW50ZXJtZWRpYXRlIEluZGV4ZWREQiB0eXBlcyAoSURCQ3Vyc29yV2l0aFZhbHVlLCBldGMuKVxuICovIGNsYXNzIF9fUFJJVkFURV9TaW1wbGVEYlN0b3JlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBlO1xuICAgIH1cbiAgICBwdXQoZSwgdCkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdCA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIGUsIHQpLCBcbiAgICAgICAgbiA9IHRoaXMuc3RvcmUucHV0KHQsIGUpKSA6IChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIFwiPGF1dG8ta2V5PlwiLCBlKSwgXG4gICAgICAgIG4gPSB0aGlzLnN0b3JlLnB1dChlKSksIF9fUFJJVkFURV93cmFwUmVxdWVzdChuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyB2YWx1ZSBpbnRvIGFuIE9iamVjdCBTdG9yZSBhbmQgcmV0dXJucyB0aGUgbmV3IGtleS4gU2ltaWxhciB0b1xuICAgICAqIEluZGV4ZWREYidzIGBhZGQoKWAsIHRoaXMgbWV0aG9kIHdpbGwgZmFpbCBvbiBwcmltYXJ5IGtleSBjb2xsaXNpb25zLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG9iamVjdCB0byB3cml0ZS5cbiAgICAgKiBAcmV0dXJucyBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBhZGQuXG4gICAgICovICAgIGFkZChlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiQUREXCIsIHRoaXMuc3RvcmUubmFtZSwgZSwgZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5zdG9yZS5hZGQoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBvYmplY3Qgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBmcm9tIHRoZSBzcGVjaWZpZWQgc3RvcmUsIG9yIG51bGxcbiAgICAgKiBpZiBubyBvYmplY3QgZXhpc3RzIHdpdGggdGhlIHNwZWNpZmllZCBrZXkuXG4gICAgICpcbiAgICAgKiBAa2V5IFRoZSBrZXkgb2YgdGhlIG9iamVjdCB0byBnZXQuXG4gICAgICogQHJldHVybnMgVGhlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IG9yIG51bGwgaWYgbm8gb2JqZWN0IGV4aXN0cy5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgLy8gV2UncmUgZG9pbmcgYW4gdW5zYWZlIGNhc3QgdG8gVmFsdWVUeXBlLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyYXBSZXF1ZXN0KHRoaXMuc3RvcmUuZ2V0KGUpKS5uZXh0KCh0ID0+IChcbiAgICAgICAgLy8gTm9ybWFsaXplIG5vbmV4aXN0ZW5jZSB0byBudWxsLlxuICAgICAgICB2b2lkIDAgPT09IHQgJiYgKHQgPSBudWxsKSwgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgXCJHRVRcIiwgdGhpcy5zdG9yZS5uYW1lLCBlLCB0KSwgXG4gICAgICAgIHQpKSk7XG4gICAgfVxuICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiREVMRVRFXCIsIHRoaXMuc3RvcmUubmFtZSwgZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5zdG9yZS5kZWxldGUoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB3ZSBldmVyIG5lZWQgbW9yZSBvZiB0aGUgY291bnQgdmFyaWFudHMsIHdlIGNhbiBhZGQgb3ZlcmxvYWRzLiBGb3Igbm93LFxuICAgICAqIGFsbCB3ZSBuZWVkIGlzIHRvIGNvdW50IGV2ZXJ5dGhpbmcgaW4gYSBzdG9yZS5cbiAgICAgKlxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByb3dzIGluIHRoZSBzdG9yZS5cbiAgICAgKi8gICAgY291bnQoKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiQ09VTlRcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cmFwUmVxdWVzdCh0aGlzLnN0b3JlLmNvdW50KCkpO1xuICAgIH1cbiAgICBHKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyhlLCB0KTtcbiAgICAgICAgLy8gVXNlIGBnZXRBbGwoKWAgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgSW5kZXhlZERCIHYzLCBhcyBpdCBpcyByb3VnaGx5XG4gICAgICAgIC8vIDIwJSBmYXN0ZXIuIFVuZm9ydHVuYXRlbHksIGdldEFsbCgpIGRvZXMgbm90IHN1cHBvcnQgY3VzdG9tIGluZGljZXMuXG4gICAgICAgICAgICAgICAgaWYgKG4uaW5kZXggfHwgXCJmdW5jdGlvblwiICE9IHR5cGVvZiB0aGlzLnN0b3JlLmdldEFsbCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuY3Vyc29yKG4pLCB0ID0gW107XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5qKGUsICgoZSwgbikgPT4ge1xuICAgICAgICAgICAgICAgIHQucHVzaChuKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgICAgIH1cbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuc3RvcmUuZ2V0QWxsKG4ucmFuZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG4oZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0sIGUub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQoZS50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvYWRzIHRoZSBmaXJzdCBgY291bnRgIGVsZW1lbnRzIGZyb20gdGhlIHByb3ZpZGVkIGluZGV4IHJhbmdlLiBMb2FkcyBhbGxcbiAgICAgKiBlbGVtZW50cyBpZiBubyBsaW1pdCBpcyBwcm92aWRlZC5cbiAgICAgKi8gICAgSChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnN0b3JlLmdldEFsbChlLCBudWxsID09PSB0ID8gdm9pZCAwIDogdCk7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgbi5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgdChlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB9LCBuLm9uc3VjY2VzcyA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIGUodC50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgSihlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiREVMRVRFIEFMTFwiLCB0aGlzLnN0b3JlLm5hbWUpO1xuICAgICAgICBjb25zdCBuID0gdGhpcy5vcHRpb25zKGUsIHQpO1xuICAgICAgICBuLlkgPSAhMTtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuY3Vyc29yKG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5qKHIsICgoZSwgdCwgbikgPT4gbi5kZWxldGUoKSkpO1xuICAgIH1cbiAgICBaKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIHQgPyBuID0gZSA6IChuID0ge30sIHQgPSBlKTtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuY3Vyc29yKG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5qKHIsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGEgc3RvcmUsIGJ1dCB3YWl0cyBmb3IgdGhlIGdpdmVuIGNhbGxiYWNrIHRvIGNvbXBsZXRlIGZvclxuICAgICAqIGVhY2ggZW50cnkgYmVmb3JlIGl0ZXJhdGluZyB0aGUgbmV4dCBlbnRyeS4gVGhpcyBhbGxvd3MgdGhlIGNhbGxiYWNrIHRvIGRvXG4gICAgICogYXN5bmNocm9ub3VzIHdvcmsgdG8gZGV0ZXJtaW5lIGlmIHRoaXMgaXRlcmF0aW9uIHNob3VsZCBjb250aW51ZS5cbiAgICAgKlxuICAgICAqIFRoZSBwcm92aWRlZCBjYWxsYmFjayBzaG91bGQgcmV0dXJuIGB0cnVlYCB0byBjb250aW51ZSBpdGVyYXRpb24sIGFuZFxuICAgICAqIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgICAqLyAgICBYKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuY3Vyc29yKHt9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKChuLCByKSA9PiB7XG4gICAgICAgICAgICB0Lm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2NoZWNrRm9yQW5kUmVwb3J0aU9TRXJyb3IoZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgICAgIHIodCk7XG4gICAgICAgICAgICB9LCB0Lm9uc3VjY2VzcyA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgciA/IGUoci5wcmltYXJ5S2V5LCByLnZhbHVlKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZSA/IHIuY29udGludWUoKSA6IG4oKTtcbiAgICAgICAgICAgICAgICB9KSkgOiBuKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGooZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgociwgaSkgPT4ge1xuICAgICAgICAgICAgZS5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgaShlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB9LCBlLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKCFpKSByZXR1cm4gdm9pZCByKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBfX1BSSVZBVEVfSXRlcmF0aW9uQ29udHJvbGxlcihpKSwgbyA9IHQoaS5wcmltYXJ5S2V5LCBpLnZhbHVlLCBzKTtcbiAgICAgICAgICAgICAgICBpZiAobyBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gby5jYXRjaCgoZSA9PiAocy5kb25lKCksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZWplY3QoZSkpKSk7XG4gICAgICAgICAgICAgICAgICAgIG4ucHVzaChlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcy5pc0RvbmUgPyByKCkgOiBudWxsID09PSBzLlUgPyBpLmNvbnRpbnVlKCkgOiBpLmNvbnRpbnVlKHMuVSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IobikpKTtcbiAgICB9XG4gICAgb3B0aW9ucyhlLCB0KSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlICYmIChcInN0cmluZ1wiID09IHR5cGVvZiBlID8gbiA9IGUgOiB0ID0gZSksIHtcbiAgICAgICAgICAgIGluZGV4OiBuLFxuICAgICAgICAgICAgcmFuZ2U6IHRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY3Vyc29yKGUpIHtcbiAgICAgICAgbGV0IHQgPSBcIm5leHRcIjtcbiAgICAgICAgaWYgKGUucmV2ZXJzZSAmJiAodCA9IFwicHJldlwiKSwgZS5pbmRleCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuc3RvcmUuaW5kZXgoZS5pbmRleCk7XG4gICAgICAgICAgICByZXR1cm4gZS5ZID8gbi5vcGVuS2V5Q3Vyc29yKGUucmFuZ2UsIHQpIDogbi5vcGVuQ3Vyc29yKGUucmFuZ2UsIHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JlLm9wZW5DdXJzb3IoZS5yYW5nZSwgdCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFdyYXBzIGFuIElEQlJlcXVlc3QgaW4gYSBQZXJzaXN0ZW5jZVByb21pc2UsIHVzaW5nIHRoZSBvbnN1Y2Nlc3MgLyBvbmVycm9yXG4gKiBoYW5kbGVycyB0byByZXNvbHZlIC8gcmVqZWN0IHRoZSBQZXJzaXN0ZW5jZVByb21pc2UgYXMgYXBwcm9wcmlhdGUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3dyYXBSZXF1ZXN0KGUpIHtcbiAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKHQsIG4pID0+IHtcbiAgICAgICAgZS5vbnN1Y2Nlc3MgPSBlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICB0KG4pO1xuICAgICAgICB9LCBlLm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2hlY2tGb3JBbmRSZXBvcnRpT1NFcnJvcihlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICBuKHQpO1xuICAgICAgICB9O1xuICAgIH0pKTtcbn1cblxuLy8gR3VhcmQgc28gd2Ugb25seSByZXBvcnQgdGhlIGVycm9yIG9uY2UuXG5sZXQgTSA9ICExO1xuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2hlY2tGb3JBbmRSZXBvcnRpT1NFcnJvcihlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9TaW1wbGVEYi5EKGdldFVBKCkpO1xuICAgIGlmICh0ID49IDEyLjIgJiYgdCA8IDEzKSB7XG4gICAgICAgIGNvbnN0IHQgPSBcIkFuIGludGVybmFsIGVycm9yIHdhcyBlbmNvdW50ZXJlZCBpbiB0aGUgSW5kZXhlZCBEYXRhYmFzZSBzZXJ2ZXJcIjtcbiAgICAgICAgaWYgKGUubWVzc2FnZS5pbmRleE9mKHQpID49IDApIHtcbiAgICAgICAgICAgIC8vIFdyYXAgZXJyb3IgaW4gYSBtb3JlIGRlc2NyaXB0aXZlIG9uZS5cbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgRmlyZXN0b3JlRXJyb3IoXCJpbnRlcm5hbFwiLCBgSU9TX0lOREVYRUREQl9CVUcxOiBJbmRleGVkRGIgaGFzIHRocm93biAnJHt0fScuIFRoaXMgaXMgbGlrZWx5IGR1ZSB0byBhbiB1bmF2b2lkYWJsZSBidWcgaW4gaU9TLiBTZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzU2NDk2Mjk2LzExMDkxNSBmb3IgZGV0YWlscyBhbmQgYSBwb3RlbnRpYWwgd29ya2Fyb3VuZC5gKTtcbiAgICAgICAgICAgIHJldHVybiBNIHx8IChNID0gITAsIFxuICAgICAgICAgICAgLy8gVGhyb3cgYSBnbG9iYWwgZXhjZXB0aW9uIG91dHNpZGUgb2YgdGhpcyBwcm9taXNlIGNoYWluLCBmb3IgdGhlIHVzZXIgdG9cbiAgICAgICAgICAgIC8vIHBvdGVudGlhbGx5IGNhdGNoLlxuICAgICAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICB9KSwgMCkpLCBlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlO1xufVxuXG4vKiogVGhpcyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgdGhlIHNjaGVkdWxpbmcgb2YgSW5kZXggQmFja2ZpbGxlci4gKi9cbmNsYXNzIF9fUFJJVkFURV9JbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy5lZSA9IHQsIHRoaXMudGFzayA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnRlKDE1ZTMpO1xuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICB0aGlzLnRhc2sgJiYgKHRoaXMudGFzay5jYW5jZWwoKSwgdGhpcy50YXNrID0gbnVsbCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy50YXNrO1xuICAgIH1cbiAgICB0ZShlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4QmFja2lsbGVyXCIsIGBTY2hlZHVsZWQgaW4gJHtlfW1zYCksIHRoaXMudGFzayA9IHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQWZ0ZXJEZWxheShcImluZGV4X2JhY2tmaWxsXCIgLyogVGltZXJJZC5JbmRleEJhY2tmaWxsICovICwgZSwgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudGFzayA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4QmFja2lsbGVyXCIsIGBEb2N1bWVudHMgd3JpdHRlbjogJHthd2FpdCB0aGlzLmVlLm5lKCl9YCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSA/IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4QmFja2lsbGVyXCIsIFwiSWdub3JpbmcgSW5kZXhlZERCIGVycm9yIGR1cmluZyBpbmRleCBiYWNrZmlsbDogXCIsIGUpIDogYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMudGUoNmU0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqIEltcGxlbWVudHMgdGhlIHN0ZXBzIGZvciBiYWNrZmlsbGluZyBpbmRleGVzLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhCYWNrZmlsbGVyIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBMb2NhbFN0b3JlIHByb3ZpZGVzIGFjY2VzcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3LlxuICAgICAqIFRoZXNlIHByb3BlcnRpZXMgd2lsbCB1cGRhdGUgd2hlbiB0aGUgdXNlciBjaGFuZ2VzLiBDb25zZXF1ZW50bHksXG4gICAgICogbWFraW5nIGEgbG9jYWwgY29weSBvZiBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3IHdpbGwgcmVxdWlyZVxuICAgICAqIHVwZGF0ZXMgb3ZlciB0aW1lLiBUaGUgc2ltcGxlciBzb2x1dGlvbiBpcyB0byByZWx5IG9uIExvY2FsU3RvcmUgdG8gaGF2ZVxuICAgICAqIGFuIHVwLXRvLWRhdGUgcmVmZXJlbmNlcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRTdG9yZS5cbiAgICAgKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMucGVyc2lzdGVuY2UgPSB0O1xuICAgIH1cbiAgICBhc3luYyBuZShlID0gNTApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJCYWNrZmlsbCBJbmRleGVzXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4gdGhpcy5yZSh0LCBlKSkpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGluZGV4IGVudHJpZXMgdW50aWwgdGhlIGNhcCBpcyByZWFjaGVkLiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHByb2Nlc3NlZC4gKi8gICAgcmUoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IFNldDtcbiAgICAgICAgbGV0IHIgPSB0LCBpID0gITA7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZG9XaGlsZSgoKCkgPT4gITAgPT09IGkgJiYgciA+IDApLCAoKCkgPT4gdGhpcy5sb2NhbFN0b3JlLmluZGV4TWFuYWdlci5nZXROZXh0Q29sbGVjdGlvbkdyb3VwVG9VcGRhdGUoZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gdCAmJiAhbi5oYXModCkpIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcoXCJJbmRleEJhY2tpbGxlclwiLCBgUHJvY2Vzc2luZyBjb2xsZWN0aW9uOiAke3R9YCksIFxuICAgICAgICAgICAgdGhpcy5pZShlLCB0LCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICByIC09IGUsIG4uYWRkKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaSA9ICExO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiB0IC0gcikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZXMgZW50cmllcyBmb3IgdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb24gZ3JvdXAuIFJldHVybnMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcHJvY2Vzc2VkLlxuICAgICAqLyAgICBpZShlLCB0LCBuKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgZWFybGllc3Qgb2Zmc2V0IG9mIGFsbCBmaWVsZCBpbmRleGVzIHRvIHF1ZXJ5IHRoZSBsb2NhbCBjYWNoZS5cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxTdG9yZS5pbmRleE1hbmFnZXIuZ2V0TWluT2Zmc2V0RnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0KS5uZXh0KChyID0+IHRoaXMubG9jYWxTdG9yZS5sb2NhbERvY3VtZW50cy5nZXROZXh0RG9jdW1lbnRzKGUsIHQsIHIsIG4pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uY2hhbmdlcztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLnVwZGF0ZUluZGV4RW50cmllcyhlLCBpKS5uZXh0KCgoKSA9PiB0aGlzLnNlKHIsIG4pKSkubmV4dCgobiA9PiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhCYWNraWxsZXJcIiwgYFVwZGF0aW5nIG9mZnNldDogJHtufWApLCBcbiAgICAgICAgICAgIHRoaXMubG9jYWxTdG9yZS5pbmRleE1hbmFnZXIudXBkYXRlQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4pKSkpLm5leHQoKCgpID0+IGkuc2l6ZSkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIG5leHQgb2Zmc2V0IGJhc2VkIG9uIHRoZSBwcm92aWRlZCBkb2N1bWVudHMuICovICAgIHNlKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBlO1xuICAgICAgICByZXR1cm4gdC5jaGFuZ2VzLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX25ld0luZGV4T2Zmc2V0RnJvbURvY3VtZW50KHQpO1xuICAgICAgICAgICAgX19QUklWQVRFX2luZGV4T2Zmc2V0Q29tcGFyYXRvcihyLCBuKSA+IDAgJiYgKG4gPSByKTtcbiAgICAgICAgfSkpLCBuZXcgSW5kZXhPZmZzZXQobi5yZWFkVGltZSwgbi5kb2N1bWVudEtleSwgTWF0aC5tYXgodC5iYXRjaElkLCBlLmxhcmdlc3RCYXRjaElkKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBgTGlzdGVuU2VxdWVuY2VgIGlzIGEgbW9ub3RvbmljIHNlcXVlbmNlLiBJdCBpcyBpbml0aWFsaXplZCB3aXRoIGEgbWluaW11bSB2YWx1ZSB0b1xuICogZXhjZWVkLiBBbGwgc3Vic2VxdWVudCBjYWxscyB0byBuZXh0IHdpbGwgcmV0dXJuIGluY3JlYXNpbmcgdmFsdWVzLiBJZiBwcm92aWRlZCB3aXRoIGFcbiAqIGBTZXF1ZW5jZU51bWJlclN5bmNlcmAsIGl0IHdpbGwgYWRkaXRpb25hbGx5IGJ1bXAgaXRzIG5leHQgdmFsdWUgd2hlbiB0b2xkIG9mIGEgbmV3IHZhbHVlLCBhc1xuICogd2VsbCBhcyB3cml0ZSBvdXQgc2VxdWVuY2UgbnVtYmVycyB0aGF0IGl0IHByb2R1Y2VzIHZpYSBgbmV4dCgpYC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2Uge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5wcmV2aW91c1ZhbHVlID0gZSwgdCAmJiAodC5zZXF1ZW5jZU51bWJlckhhbmRsZXIgPSBlID0+IHRoaXMub2UoZSksIHRoaXMuX2UgPSBlID0+IHQud3JpdGVTZXF1ZW5jZU51bWJlcihlKSk7XG4gICAgfVxuICAgIG9lKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJldmlvdXNWYWx1ZSA9IE1hdGgubWF4KGUsIHRoaXMucHJldmlvdXNWYWx1ZSksIHRoaXMucHJldmlvdXNWYWx1ZTtcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgY29uc3QgZSA9ICsrdGhpcy5wcmV2aW91c1ZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcy5fZSAmJiB0aGlzLl9lKGUpLCBlO1xuICAgIH1cbn1cblxuX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlID0gLTE7XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGEgdmFyaWFibGUgaXMgZWl0aGVyIHVuZGVmaW5lZCBvciBudWxsLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfaXNOdWxsT3JVbmRlZmluZWQoZSkge1xuICAgIHJldHVybiBudWxsID09IGU7XG59XG5cbi8qKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHZhbHVlIHJlcHJlc2VudHMgLTAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc05lZ2F0aXZlWmVybyhlKSB7XG4gICAgLy8gRGV0ZWN0IGlmIHRoZSB2YWx1ZSBpcyAtMC4wLiBCYXNlZCBvbiBwb2x5ZmlsbCBmcm9tXG4gICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2lzXG4gICAgcmV0dXJuIDAgPT09IGUgJiYgMSAvIGUgPT0gLTEgLyAwO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhIHZhbHVlIGlzIGFuIGludGVnZXIgYW5kIGluIHRoZSBzYWZlIGludGVnZXIgcmFuZ2VcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byB0ZXN0IGZvciBiZWluZyBhbiBpbnRlZ2VyIGFuZCBpbiB0aGUgc2FmZSByYW5nZVxuICovIGZ1bmN0aW9uIGlzU2FmZUludGVnZXIoZSkge1xuICAgIHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiBlICYmIE51bWJlci5pc0ludGVnZXIoZSkgJiYgIV9fUFJJVkFURV9pc05lZ2F0aXZlWmVybyhlKSAmJiBlIDw9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSICYmIGUgPj0gTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEVuY29kZXMgYSByZXNvdXJjZSBwYXRoIGludG8gYSBJbmRleGVkRGItY29tcGF0aWJsZSBzdHJpbmcgZm9ybS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlKSB7XG4gICAgbGV0IHQgPSBcIlwiO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykgdC5sZW5ndGggPiAwICYmICh0ID0gX19QUklWQVRFX2VuY29kZVNlcGFyYXRvcih0KSksIFxuICAgIHQgPSBfX1BSSVZBVEVfZW5jb2RlU2VnbWVudChlLmdldChuKSwgdCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbmNvZGVTZXBhcmF0b3IodCk7XG59XG5cbi8qKiBFbmNvZGVzIGEgc2luZ2xlIHNlZ21lbnQgb2YgYSByZXNvdXJjZSBwYXRoIGludG8gdGhlIGdpdmVuIHJlc3VsdCAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5jb2RlU2VnbWVudChlLCB0KSB7XG4gICAgbGV0IG4gPSB0O1xuICAgIGNvbnN0IHIgPSBlLmxlbmd0aDtcbiAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHI7IHQrKykge1xuICAgICAgICBjb25zdCByID0gZS5jaGFyQXQodCk7XG4gICAgICAgIHN3aXRjaCAocikge1xuICAgICAgICAgIGNhc2UgXCJcXDBcIjpcbiAgICAgICAgICAgIG4gKz0gXCJcdTAwMDFcdTAwMTBcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIlx1MDAwMVwiOlxuICAgICAgICAgICAgbiArPSBcIlx1MDAwMVx1MDAxMVwiO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgbiArPSByO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuO1xufVxuXG4vKiogRW5jb2RlcyBhIHBhdGggc2VwYXJhdG9yIGludG8gdGhlIGdpdmVuIHJlc3VsdCAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5jb2RlU2VwYXJhdG9yKGUpIHtcbiAgICByZXR1cm4gZSArIFwiXHUwMDAxXHUwMDAxXCI7XG59XG5cbi8qKlxuICogRGVjb2RlcyB0aGUgZ2l2ZW4gSW5kZXhlZERiLWNvbXBhdGlibGUgc3RyaW5nIGZvcm0gb2YgYSByZXNvdXJjZSBwYXRoIGludG9cbiAqIGEgUmVzb3VyY2VQYXRoIGluc3RhbmNlLiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgaXMgbm90IHN1aXRhYmxlIGZvciB1c2Ugd2l0aFxuICogZGVjb2RpbmcgcmVzb3VyY2UgbmFtZXMgZnJvbSB0aGUgc2VydmVyOyB0aG9zZSBhcmUgT25lIFBsYXRmb3JtIGZvcm1hdFxuICogc3RyaW5ncy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKGUpIHtcbiAgICAvLyBFdmVudCB0aGUgZW1wdHkgcGF0aCBtdXN0IGVuY29kZSBhcyBhIHBhdGggb2YgYXQgbGVhc3QgbGVuZ3RoIDIuIEEgcGF0aFxuICAgIC8vIHdpdGggZXhhY3RseSAyIG11c3QgYmUgdGhlIGVtcHR5IHBhdGguXG4gICAgY29uc3QgdCA9IGUubGVuZ3RoO1xuICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydCh0ID49IDIpLCAyID09PSB0KSByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoXCJcdTAwMDFcIiA9PT0gZS5jaGFyQXQoMCkgJiYgXCJcdTAwMDFcIiA9PT0gZS5jaGFyQXQoMSkpLCBcbiAgICBSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCk7XG4gICAgLy8gRXNjYXBlIGNoYXJhY3RlcnMgY2Fubm90IGV4aXN0IHBhc3QgdGhlIHNlY29uZC10by1sYXN0IHBvc2l0aW9uIGluIHRoZVxuICAgIC8vIHNvdXJjZSB2YWx1ZS5cbiAgICAgICAgY29uc3QgX19QUklWQVRFX2xhc3RSZWFzb25hYmxlRXNjYXBlSW5kZXggPSB0IC0gMiwgbiA9IFtdO1xuICAgIGxldCByID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHQ7ICkge1xuICAgICAgICAvLyBUaGUgbGFzdCB0d28gY2hhcmFjdGVycyBvZiBhIHZhbGlkIGVuY29kZWQgcGF0aCBtdXN0IGJlIGEgc2VwYXJhdG9yLCBzb1xuICAgICAgICAvLyB0aGVyZSBtdXN0IGJlIGFuIGVuZCB0byB0aGlzIHNlZ21lbnQuXG4gICAgICAgIGNvbnN0IHQgPSBlLmluZGV4T2YoXCJcdTAwMDFcIiwgaSk7XG4gICAgICAgICh0IDwgMCB8fCB0ID4gX19QUklWQVRFX2xhc3RSZWFzb25hYmxlRXNjYXBlSW5kZXgpICYmIGZhaWwoKTtcbiAgICAgICAgc3dpdGNoIChlLmNoYXJBdCh0ICsgMSkpIHtcbiAgICAgICAgICBjYXNlIFwiXHUwMDAxXCI6XG4gICAgICAgICAgICBjb25zdCBzID0gZS5zdWJzdHJpbmcoaSwgdCk7XG4gICAgICAgICAgICBsZXQgbztcbiAgICAgICAgICAgIDAgPT09IHIubGVuZ3RoID8gXG4gICAgICAgICAgICAvLyBBdm9pZCBjb3B5aW5nIGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgYSBzZWdtZW50IHRoYXQgZXhjbHVkZXMgXFwwXG4gICAgICAgICAgICAvLyBhbmQgXFwwMDFcbiAgICAgICAgICAgIG8gPSBzIDogKHIgKz0gcywgbyA9IHIsIHIgPSBcIlwiKSwgbi5wdXNoKG8pO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiXHUwMDEwXCI6XG4gICAgICAgICAgICByICs9IGUuc3Vic3RyaW5nKGksIHQpLCByICs9IFwiXFwwXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJcdTAwMTFcIjpcbiAgICAgICAgICAgIC8vIFRoZSBlc2NhcGUgY2hhcmFjdGVyIGNhbiBiZSB1c2VkIGluIHRoZSBvdXRwdXQgdG8gZW5jb2RlIGl0c2VsZi5cbiAgICAgICAgICAgIHIgKz0gZS5zdWJzdHJpbmcoaSwgdCArIDEpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgICAgIGkgPSB0ICsgMjtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgobik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IHggPSBbIFwidXNlcklkXCIsIFwiYmF0Y2hJZFwiIF07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE5hbWUgb2YgdGhlIEluZGV4ZWREYiBvYmplY3Qgc3RvcmUuXG4gKlxuICogTm90ZSB0aGF0IHRoZSBuYW1lICdvd25lcicgaXMgY2hvc2VuIHRvIGVuc3VyZSBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoXG4gKiBvbGRlciBjbGllbnRzIHRoYXQgb25seSBzdXBwb3J0ZWQgc2luZ2xlIGxvY2tlZCBhY2Nlc3MgdG8gdGhlIHBlcnNpc3RlbmNlXG4gKiBsYXllci5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGEgW3VzZXJJZCwgZW5jb2RlZFBhdGhdIGtleSBmb3IgdXNlIGluIHRoZSBEYkRvY3VtZW50TXV0YXRpb25zXG4gKiBpbmRleCB0byBpdGVyYXRlIG92ZXIgYWxsIGF0IGRvY3VtZW50IG11dGF0aW9ucyBmb3IgYSBnaXZlbiBwYXRoIG9yIGxvd2VyLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aChlLCB0KSB7XG4gICAgcmV0dXJuIFsgZSwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0KSBdO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdWxsIGluZGV4IGtleSBvZiBbdXNlcklkLCBlbmNvZGVkUGF0aCwgYmF0Y2hJZF0gZm9yIGluc2VydGluZ1xuICogYW5kIGRlbGV0aW5nIGludG8gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXguXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvbktleShlLCB0LCBuKSB7XG4gICAgcmV0dXJuIFsgZSwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0KSwgbiBdO1xufVxuXG4vKipcbiAqIEJlY2F1c2Ugd2Ugc3RvcmUgYWxsIHRoZSB1c2VmdWwgaW5mb3JtYXRpb24gZm9yIHRoaXMgc3RvcmUgaW4gdGhlIGtleSxcbiAqIHRoZXJlIGlzIG5vIHVzZWZ1bCBpbmZvcm1hdGlvbiB0byBzdG9yZSBhcyB0aGUgdmFsdWUuIFRoZSByYXcgKHVuZW5jb2RlZClcbiAqIHBhdGggY2Fubm90IGJlIHN0b3JlZCBiZWNhdXNlIEluZGV4ZWREYiBkb2Vzbid0IHN0b3JlIHByb3RvdHlwZVxuICogaW5mb3JtYXRpb24uXG4gKi8gY29uc3QgTyA9IHt9LCBOID0gWyBcInByZWZpeFBhdGhcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcImRvY3VtZW50SWRcIiBdLCBCID0gWyBcInByZWZpeFBhdGhcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJkb2N1bWVudElkXCIgXSwgTCA9IFsgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcInByZWZpeFBhdGhcIiwgXCJkb2N1bWVudElkXCIgXSwgayA9IFsgXCJjYW5vbmljYWxJZFwiLCBcInRhcmdldElkXCIgXSwgcSA9IFsgXCJ0YXJnZXRJZFwiLCBcInBhdGhcIiBdLCBRID0gWyBcInBhdGhcIiwgXCJ0YXJnZXRJZFwiIF0sIEsgPSBbIFwiY29sbGVjdGlvbklkXCIsIFwicGFyZW50XCIgXSwgJCA9IFsgXCJpbmRleElkXCIsIFwidWlkXCIgXSwgVSA9IFsgXCJ1aWRcIiwgXCJzZXF1ZW5jZU51bWJlclwiIF0sIFcgPSBbIFwiaW5kZXhJZFwiLCBcInVpZFwiLCBcImFycmF5VmFsdWVcIiwgXCJkaXJlY3Rpb25hbFZhbHVlXCIsIFwib3JkZXJlZERvY3VtZW50S2V5XCIsIFwiZG9jdW1lbnRLZXlcIiBdLCBHID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiwgXCJvcmRlcmVkRG9jdW1lbnRLZXlcIiBdLCB6ID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwiZG9jdW1lbnRJZFwiIF0sIGogPSBbIFwidXNlcklkXCIsIFwiY29sbGVjdGlvblBhdGhcIiwgXCJsYXJnZXN0QmF0Y2hJZFwiIF0sIEggPSBbIFwidXNlcklkXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwibGFyZ2VzdEJhdGNoSWRcIiBdLCBKID0gWyAuLi5bIC4uLlsgLi4uWyAuLi5bIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1wiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiIF0sIFwiY2xpZW50TWV0YWRhdGFcIiBdLCBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIgXSwgXCJjb2xsZWN0aW9uUGFyZW50c1wiIF0sIFwiYnVuZGxlc1wiLCBcIm5hbWVkUXVlcmllc1wiIF0sIFkgPSBbIC4uLkosIFwiZG9jdW1lbnRPdmVybGF5c1wiIF0sIFogPSBbIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1YxNFwiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiLCBcImNsaWVudE1ldGFkYXRhXCIsIFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIiwgXCJjb2xsZWN0aW9uUGFyZW50c1wiLCBcImJ1bmRsZXNcIiwgXCJuYW1lZFF1ZXJpZXNcIiwgXCJkb2N1bWVudE92ZXJsYXlzXCIgXSwgWCA9IFosIGVlID0gWyAuLi5YLCBcImluZGV4Q29uZmlndXJhdGlvblwiLCBcImluZGV4U3RhdGVcIiwgXCJpbmRleEVudHJpZXNcIiBdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uIGV4dGVuZHMgUGVyc2lzdGVuY2VUcmFuc2FjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnVlID0gZSwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFN0b3JlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX1NpbXBsZURiLk8obi51ZSwgdCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9vYmplY3RTaXplKGUpIHtcbiAgICBsZXQgdCA9IDA7XG4gICAgZm9yIChjb25zdCBuIGluIGUpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBuKSAmJiB0Kys7XG4gICAgcmV0dXJuIHQ7XG59XG5cbmZ1bmN0aW9uIGZvckVhY2goZSwgdCkge1xuICAgIGZvciAoY29uc3QgbiBpbiBlKSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbikgJiYgdChuLCBlW25dKTtcbn1cblxuZnVuY3Rpb24gaXNFbXB0eShlKSB7XG4gICAgZm9yIChjb25zdCB0IGluIGUpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiAhMTtcbiAgICByZXR1cm4gITA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBBbiBpbW11dGFibGUgc29ydGVkIG1hcCBpbXBsZW1lbnRhdGlvbiwgYmFzZWQgb24gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrXG4vLyB0cmVlLlxuY2xhc3MgU29ydGVkTWFwIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuY29tcGFyYXRvciA9IGUsIHRoaXMucm9vdCA9IHQgfHwgTExSQk5vZGUuRU1QVFk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQgb3IgcmVwbGFjZWQuXG4gICAgaW5zZXJ0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QuaW5zZXJ0KGUsIHQsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWFwLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IHJlbW92ZWQuXG4gICAgcmVtb3ZlKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QucmVtb3ZlKGUsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbm9kZSB3aXRoIHRoZSBnaXZlbiBrZXksIG9yIG51bGwuXG4gICAgZ2V0KGUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLnJvb3Q7XG4gICAgICAgIGZvciAoOyF0LmlzRW1wdHkoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5jb21wYXJhdG9yKGUsIHQua2V5KTtcbiAgICAgICAgICAgIGlmICgwID09PSBuKSByZXR1cm4gdC52YWx1ZTtcbiAgICAgICAgICAgIG4gPCAwID8gdCA9IHQubGVmdCA6IG4gPiAwICYmICh0ID0gdC5yaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IGluIHRoaXMgc29ydGVkIG1hcCwgb3IgLTEgaWYgaXQgZG9lc24ndFxuICAgIC8vIGV4aXN0LlxuICAgIGluZGV4T2YoZSkge1xuICAgICAgICAvLyBOdW1iZXIgb2Ygbm9kZXMgdGhhdCB3ZXJlIHBydW5lZCB3aGVuIGRlc2NlbmRpbmcgcmlnaHRcbiAgICAgICAgbGV0IHQgPSAwLCBuID0gdGhpcy5yb290O1xuICAgICAgICBmb3IgKDshbi5pc0VtcHR5KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY29tcGFyYXRvcihlLCBuLmtleSk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gcikgcmV0dXJuIHQgKyBuLmxlZnQuc2l6ZTtcbiAgICAgICAgICAgIHIgPCAwID8gbiA9IG4ubGVmdCA6IChcbiAgICAgICAgICAgIC8vIENvdW50IGFsbCBub2RlcyBsZWZ0IG9mIHRoZSBub2RlIHBsdXMgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICB0ICs9IG4ubGVmdC5zaXplICsgMSwgbiA9IG4ucmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vZGUgbm90IGZvdW5kXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBtYXAuXG4gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3Quc2l6ZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBrZXkgaW4gdGhlIG1hcC5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QubWluS2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1heGltdW0ga2V5IGluIHRoZSBtYXAuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Lm1heEtleSgpO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIG1hcCBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uXG4gICAgLy8gZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5pbm9yZGVyVHJhdmVyc2FsKGUpO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUodCwgbiksICExKSkpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUucHVzaChgJHt0fToke259YCksICExKSkpLCBgeyR7ZS5qb2luKFwiLCBcIil9fWA7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgbWFwIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXNcbiAgICAvLyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5yZXZlcnNlVHJhdmVyc2FsKGUpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIFNvcnRlZE1hcC5cbiAgICBnZXRJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITEpO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcEl0ZXJhdG9yKHRoaXMucm9vdCwgZSwgdGhpcy5jb21wYXJhdG9yLCAhMSk7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbiAgICBnZXRSZXZlcnNlSXRlcmF0b3JGcm9tKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIGUsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBcbi8vIEFuIGl0ZXJhdG9yIG92ZXIgYW4gTExSQk5vZGUuXG5jbGFzcyBTb3J0ZWRNYXBJdGVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmlzUmV2ZXJzZSA9IHIsIHRoaXMubm9kZVN0YWNrID0gW107XG4gICAgICAgIGxldCBpID0gMTtcbiAgICAgICAgZm9yICg7IWUuaXNFbXB0eSgpOyApIGlmIChpID0gdCA/IG4oZS5rZXksIHQpIDogMSwgXG4gICAgICAgIC8vIGZsaXAgdGhlIGNvbXBhcmlzb24gaWYgd2UncmUgZ29pbmcgaW4gcmV2ZXJzZVxuICAgICAgICB0ICYmIHIgJiYgKGkgKj0gLTEpLCBpIDwgMCkgXG4gICAgICAgIC8vIFRoaXMgbm9kZSBpcyBsZXNzIHRoYW4gb3VyIHN0YXJ0IGtleS4gaWdub3JlIGl0XG4gICAgICAgIGUgPSB0aGlzLmlzUmV2ZXJzZSA/IGUubGVmdCA6IGUucmlnaHQ7IGVsc2Uge1xuICAgICAgICAgICAgaWYgKDAgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZXhhY3RseSBlcXVhbCB0byBvdXIgc3RhcnQga2V5LiBQdXNoIGl0IG9uIHRoZSBzdGFjayxcbiAgICAgICAgICAgICAgICAvLyBidXQgc3RvcCBpdGVyYXRpbmc7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2sucHVzaChlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBncmVhdGVyIHRoYW4gb3VyIHN0YXJ0IGtleSwgYWRkIGl0IHRvIHRoZSBzdGFjayBhbmQgbW92ZVxuICAgICAgICAgICAgLy8gdG8gdGhlIG5leHQgb25lXG4gICAgICAgICAgICB0aGlzLm5vZGVTdGFjay5wdXNoKGUpLCBlID0gdGhpcy5pc1JldmVyc2UgPyBlLnJpZ2h0IDogZS5sZWZ0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5ub2RlU3RhY2sucG9wKCk7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBrZXk6IGUua2V5LFxuICAgICAgICAgICAgdmFsdWU6IGUudmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlKSBmb3IgKGUgPSBlLmxlZnQ7ICFlLmlzRW1wdHkoKTsgKSB0aGlzLm5vZGVTdGFjay5wdXNoKGUpLCBlID0gZS5yaWdodDsgZWxzZSBmb3IgKGUgPSBlLnJpZ2h0OyAhZS5pc0VtcHR5KCk7ICkgdGhpcy5ub2RlU3RhY2sucHVzaChlKSwgXG4gICAgICAgIGUgPSBlLmxlZnQ7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICBoYXNOZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlU3RhY2subGVuZ3RoID4gMDtcbiAgICB9XG4gICAgcGVlaygpIHtcbiAgICAgICAgaWYgKDAgPT09IHRoaXMubm9kZVN0YWNrLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLm5vZGVTdGFja1t0aGlzLm5vZGVTdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtleTogZS5rZXksXG4gICAgICAgICAgICB2YWx1ZTogZS52YWx1ZVxuICAgICAgICB9O1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBJdGVyYXRvclxuLy8gUmVwcmVzZW50cyBhIG5vZGUgaW4gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrIHRyZWUuXG5jbGFzcyBMTFJCTm9kZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLmtleSA9IGUsIHRoaXMudmFsdWUgPSB0LCB0aGlzLmNvbG9yID0gbnVsbCAhPSBuID8gbiA6IExMUkJOb2RlLlJFRCwgdGhpcy5sZWZ0ID0gbnVsbCAhPSByID8gciA6IExMUkJOb2RlLkVNUFRZLCBcbiAgICAgICAgdGhpcy5yaWdodCA9IG51bGwgIT0gaSA/IGkgOiBMTFJCTm9kZS5FTVBUWSwgdGhpcy5zaXplID0gdGhpcy5sZWZ0LnNpemUgKyAxICsgdGhpcy5yaWdodC5zaXplO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLCBvcHRpb25hbGx5IHJlcGxhY2luZyBwaWVjZXMgb2YgaXQuXG4gICAgY29weShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHJldHVybiBuZXcgTExSQk5vZGUobnVsbCAhPSBlID8gZSA6IHRoaXMua2V5LCBudWxsICE9IHQgPyB0IDogdGhpcy52YWx1ZSwgbnVsbCAhPSBuID8gbiA6IHRoaXMuY29sb3IsIG51bGwgIT0gciA/IHIgOiB0aGlzLmxlZnQsIG51bGwgIT0gaSA/IGkgOiB0aGlzLnJpZ2h0KTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIHRyZWUgaW4ga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgIC8vIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pbm9yZGVyVHJhdmVyc2FsKGUpIHx8IGUodGhpcy5rZXksIHRoaXMudmFsdWUpIHx8IHRoaXMucmlnaHQuaW5vcmRlclRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSB0cmVlIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQucmV2ZXJzZVRyYXZlcnNhbChlKSB8fCBlKHRoaXMua2V5LCB0aGlzLnZhbHVlKSB8fCB0aGlzLmxlZnQucmV2ZXJzZVRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBub2RlIGluIHRoZSB0cmVlLlxuICAgIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pc0VtcHR5KCkgPyB0aGlzIDogdGhpcy5sZWZ0Lm1pbigpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbigpLmtleTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWF4aW11bSBrZXkgaW4gdGhlIHRyZWUuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5pc0VtcHR5KCkgPyB0aGlzLmtleSA6IHRoaXMucmlnaHQubWF4S2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQoZSwgdCwgbikge1xuICAgICAgICBsZXQgciA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGkgPSBuKGUsIHIua2V5KTtcbiAgICAgICAgcmV0dXJuIHIgPSBpIDwgMCA/IHIuY29weShudWxsLCBudWxsLCBudWxsLCByLmxlZnQuaW5zZXJ0KGUsIHQsIG4pLCBudWxsKSA6IDAgPT09IGkgPyByLmNvcHkobnVsbCwgdCwgbnVsbCwgbnVsbCwgbnVsbCkgOiByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgci5yaWdodC5pbnNlcnQoZSwgdCwgbikpLCBcbiAgICAgICAgci5maXhVcCgpO1xuICAgIH1cbiAgICByZW1vdmVNaW4oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSByZXR1cm4gTExSQk5vZGUuRU1QVFk7XG4gICAgICAgIGxldCBlID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGUubGVmdC5pc1JlZCgpIHx8IGUubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKGUgPSBlLm1vdmVSZWRMZWZ0KCkpLCBlID0gZS5jb3B5KG51bGwsIG51bGwsIG51bGwsIGUubGVmdC5yZW1vdmVNaW4oKSwgbnVsbCksIFxuICAgICAgICBlLmZpeFVwKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBpdGVtIHJlbW92ZWQuXG4gICAgcmVtb3ZlKGUsIHQpIHtcbiAgICAgICAgbGV0IG4sIHIgPSB0aGlzO1xuICAgICAgICBpZiAodChlLCByLmtleSkgPCAwKSByLmxlZnQuaXNFbXB0eSgpIHx8IHIubGVmdC5pc1JlZCgpIHx8IHIubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKHIgPSByLm1vdmVSZWRMZWZ0KCkpLCBcbiAgICAgICAgciA9IHIuY29weShudWxsLCBudWxsLCBudWxsLCByLmxlZnQucmVtb3ZlKGUsIHQpLCBudWxsKTsgZWxzZSB7XG4gICAgICAgICAgICBpZiAoci5sZWZ0LmlzUmVkKCkgJiYgKHIgPSByLnJvdGF0ZVJpZ2h0KCkpLCByLnJpZ2h0LmlzRW1wdHkoKSB8fCByLnJpZ2h0LmlzUmVkKCkgfHwgci5yaWdodC5sZWZ0LmlzUmVkKCkgfHwgKHIgPSByLm1vdmVSZWRSaWdodCgpKSwgXG4gICAgICAgICAgICAwID09PSB0KGUsIHIua2V5KSkge1xuICAgICAgICAgICAgICAgIGlmIChyLnJpZ2h0LmlzRW1wdHkoKSkgcmV0dXJuIExMUkJOb2RlLkVNUFRZO1xuICAgICAgICAgICAgICAgIG4gPSByLnJpZ2h0Lm1pbigpLCByID0gci5jb3B5KG4ua2V5LCBuLnZhbHVlLCBudWxsLCBudWxsLCByLnJpZ2h0LnJlbW92ZU1pbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHIgPSByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgci5yaWdodC5yZW1vdmUoZSwgdCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByLmZpeFVwKCk7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvcjtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBuZXcgdHJlZSBhZnRlciBwZXJmb3JtaW5nIGFueSBuZWVkZWQgcm90YXRpb25zLlxuICAgIGZpeFVwKCkge1xuICAgICAgICBsZXQgZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBlLnJpZ2h0LmlzUmVkKCkgJiYgIWUubGVmdC5pc1JlZCgpICYmIChlID0gZS5yb3RhdGVMZWZ0KCkpLCBlLmxlZnQuaXNSZWQoKSAmJiBlLmxlZnQubGVmdC5pc1JlZCgpICYmIChlID0gZS5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIGUubGVmdC5pc1JlZCgpICYmIGUucmlnaHQuaXNSZWQoKSAmJiAoZSA9IGUuY29sb3JGbGlwKCkpLCBlO1xuICAgIH1cbiAgICBtb3ZlUmVkTGVmdCgpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzLmNvbG9yRmxpcCgpO1xuICAgICAgICByZXR1cm4gZS5yaWdodC5sZWZ0LmlzUmVkKCkgJiYgKGUgPSBlLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgZS5yaWdodC5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIGUgPSBlLnJvdGF0ZUxlZnQoKSwgZSA9IGUuY29sb3JGbGlwKCkpLCBlO1xuICAgIH1cbiAgICBtb3ZlUmVkUmlnaHQoKSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5jb2xvckZsaXAoKTtcbiAgICAgICAgcmV0dXJuIGUubGVmdC5sZWZ0LmlzUmVkKCkgJiYgKGUgPSBlLnJvdGF0ZVJpZ2h0KCksIGUgPSBlLmNvbG9yRmxpcCgpKSwgZTtcbiAgICB9XG4gICAgcm90YXRlTGVmdCgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5SRUQsIG51bGwsIHRoaXMucmlnaHQubGVmdCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgZSwgbnVsbCk7XG4gICAgfVxuICAgIHJvdGF0ZVJpZ2h0KCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jb3B5KG51bGwsIG51bGwsIExMUkJOb2RlLlJFRCwgdGhpcy5sZWZ0LnJpZ2h0LCBudWxsKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIG51bGwsIGUpO1xuICAgIH1cbiAgICBjb2xvckZsaXAoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCAhdGhpcy5sZWZ0LmNvbG9yLCBudWxsLCBudWxsKSwgdCA9IHRoaXMucmlnaHQuY29weShudWxsLCBudWxsLCAhdGhpcy5yaWdodC5jb2xvciwgbnVsbCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkobnVsbCwgbnVsbCwgIXRoaXMuY29sb3IsIGUsIHQpO1xuICAgIH1cbiAgICAvLyBGb3IgdGVzdGluZy5cbiAgICBjaGVja01heERlcHRoKCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jaGVjaygpO1xuICAgICAgICByZXR1cm4gTWF0aC5wb3coMiwgZSkgPD0gdGhpcy5zaXplICsgMTtcbiAgICB9XG4gICAgLy8gSW4gYSBiYWxhbmNlZCBSQiB0cmVlLCB0aGUgYmxhY2stZGVwdGggKG51bWJlciBvZiBibGFjayBub2RlcykgZnJvbSByb290IHRvXG4gICAgLy8gbGVhdmVzIGlzIGVxdWFsIG9uIGJvdGggc2lkZXMuICBUaGlzIGZ1bmN0aW9uIHZlcmlmaWVzIHRoYXQgb3IgYXNzZXJ0cy5cbiAgICBjaGVjaygpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZWQoKSAmJiB0aGlzLmxlZnQuaXNSZWQoKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICBpZiAodGhpcy5yaWdodC5pc1JlZCgpKSB0aHJvdyBmYWlsKCk7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmxlZnQuY2hlY2soKTtcbiAgICAgICAgaWYgKGUgIT09IHRoaXMucmlnaHQuY2hlY2soKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICByZXR1cm4gZSArICh0aGlzLmlzUmVkKCkgPyAwIDogMSk7XG4gICAgfVxufVxuXG4gLy8gZW5kIExMUkJOb2RlXG4vLyBFbXB0eSBub2RlIGlzIHNoYXJlZCBiZXR3ZWVuIGFsbCBMTFJCIHRyZWVzLlxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbkxMUkJOb2RlLkVNUFRZID0gbnVsbCwgTExSQk5vZGUuUkVEID0gITAsIExMUkJOb2RlLkJMQUNLID0gITE7XG5cbi8vIGVuZCBMTFJCRW1wdHlOb2RlXG5MTFJCTm9kZS5FTVBUWSA9IG5ldyBcbi8vIFJlcHJlc2VudHMgYW4gZW1wdHkgbm9kZSAoYSBsZWFmIG5vZGUgaW4gdGhlIFJlZC1CbGFjayBUcmVlKS5cbmNsYXNzIExMUkJFbXB0eU5vZGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBnZXQga2V5KCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICBnZXQgY29sb3IoKSB7XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG4gICAgZ2V0IGxlZnQoKSB7XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG4gICAgZ2V0IHJpZ2h0KCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG5vZGUuXG4gICAgY29weShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKGUsIHQpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgIHJlbW92ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlub3JkZXJUcmF2ZXJzYWwoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIHJldmVyc2VUcmF2ZXJzYWwoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIC8vIEZvciB0ZXN0aW5nLlxuICAgIGNoZWNrTWF4RGVwdGgoKSB7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgY2hlY2soKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNvcnRlZFNldCBpcyBhbiBpbW11dGFibGUgKGNvcHktb24td3JpdGUpIGNvbGxlY3Rpb24gdGhhdCBob2xkcyBlbGVtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLlxuICpcbiAqIE5PVEU6IGlmIHByb3ZpZGVkIGNvbXBhcmF0b3IgcmV0dXJucyAwIGZvciB0d28gZWxlbWVudHMsIHdlIGNvbnNpZGVyIHRoZW0gdG9cbiAqIGJlIGVxdWFsIVxuICovXG5jbGFzcyBTb3J0ZWRTZXQge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gZSwgdGhpcy5kYXRhID0gbmV3IFNvcnRlZE1hcCh0aGlzLmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICBoYXMoZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5kYXRhLmdldChlKTtcbiAgICB9XG4gICAgZmlyc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubWF4S2V5KCk7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLnNpemU7XG4gICAgfVxuICAgIGluZGV4T2YoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmluZGV4T2YoZSk7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyBlbGVtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2goZSkge1xuICAgICAgICB0aGlzLmRhdGEuaW5vcmRlclRyYXZlcnNhbCgoKHQsIG4pID0+IChlKHQpLCAhMSkpKTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIG92ZXIgYGVsZW1gcyBzdWNoIHRoYXQ6IHJhbmdlWzBdICZsdDs9IGVsZW0gJmx0OyByYW5nZVsxXS4gKi8gICAgZm9yRWFjaEluUmFuZ2UoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbShlWzBdKTtcbiAgICAgICAgZm9yICg7bi5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uZ2V0TmV4dCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tcGFyYXRvcihyLmtleSwgZVsxXSkgPj0gMCkgcmV0dXJuO1xuICAgICAgICAgICAgdChyLmtleSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBgZWxlbWBzIHN1Y2ggdGhhdDogc3RhcnQgJmx0Oz0gZWxlbSB1bnRpbCBmYWxzZSBpcyByZXR1cm5lZC5cbiAgICAgKi8gICAgZm9yRWFjaFdoaWxlKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIGZvciAobiA9IHZvaWQgMCAhPT0gdCA/IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20odCkgOiB0aGlzLmRhdGEuZ2V0SXRlcmF0b3IoKTsgbi5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgaWYgKCFlKG4uZ2V0TmV4dCgpLmtleSkpIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogRmluZHMgdGhlIGxlYXN0IGVsZW1lbnQgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGBlbGVtYC4gKi8gICAgZmlyc3RBZnRlck9yRXF1YWwoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbShlKTtcbiAgICAgICAgcmV0dXJuIHQuaGFzTmV4dCgpID8gdC5nZXROZXh0KCkua2V5IDogbnVsbDtcbiAgICB9XG4gICAgZ2V0SXRlcmF0b3IoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkU2V0SXRlcmF0b3IodGhpcy5kYXRhLmdldEl0ZXJhdG9yKCkpO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZFNldEl0ZXJhdG9yKHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20oZSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGFuIGVsZW1lbnQgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weSh0aGlzLmRhdGEucmVtb3ZlKGUpLmluc2VydChlLCAhMCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhbiBlbGVtZW50ICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhcyhlKSA/IHRoaXMuY29weSh0aGlzLmRhdGEucmVtb3ZlKGUpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuaXNFbXB0eSgpO1xuICAgIH1cbiAgICB1bmlvbldpdGgoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSBgcmVzdWx0YCBhbHdheXMgcmVmZXJzIHRvIHRoZSBsYXJnZXIgb25lIG9mIHRoZSB0d28gc2V0cy5cbiAgICAgICAgICAgICAgICByZXR1cm4gdC5zaXplIDwgZS5zaXplICYmICh0ID0gZSwgZSA9IHRoaXMpLCBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdCA9IHQuYWRkKGUpO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgU29ydGVkU2V0KSkgcmV0dXJuICExO1xuICAgICAgICBpZiAodGhpcy5zaXplICE9PSBlLnNpemUpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpLCBuID0gZS5kYXRhLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3QuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmdldE5leHQoKS5rZXksIHIgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gdGhpcy5jb21wYXJhdG9yKGUsIHIpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5wdXNoKHQpO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQpKSksIFwiU29ydGVkU2V0KFwiICsgZS50b1N0cmluZygpICsgXCIpXCI7XG4gICAgfVxuICAgIGNvcHkoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IFNvcnRlZFNldCh0aGlzLmNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdC5kYXRhID0gZSwgdDtcbiAgICB9XG59XG5cbmNsYXNzIFNvcnRlZFNldEl0ZXJhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuaXRlciA9IGU7XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZXIuZ2V0TmV4dCgpLmtleTtcbiAgICB9XG4gICAgaGFzTmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlci5oYXNOZXh0KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXBhcmVzIHR3byBzb3J0ZWQgc2V0cyBmb3IgZXF1YWxpdHkgdXNpbmcgdGhlaXIgbmF0dXJhbCBvcmRlcmluZy4gVGhlXG4gKiBtZXRob2QgY29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBhbmQgaW52b2tlcyBgb25BZGRgIGZvciBldmVyeSBlbGVtZW50IHRoYXRcbiAqIGlzIGluIGBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC4gYG9uUmVtb3ZlYCBpcyBpbnZva2VkIGZvciBldmVyeSBlbGVtZW50IGluXG4gKiBgYmVmb3JlYCBidXQgbWlzc2luZyBmcm9tIGBhZnRlcmAuXG4gKlxuICogVGhlIG1ldGhvZCBjcmVhdGVzIGEgY29weSBvZiBib3RoIGBiZWZvcmVgIGFuZCBgYWZ0ZXJgIGFuZCBydW5zIGluIE8obiBsb2dcbiAqIG4pLCB3aGVyZSBuIGlzIHRoZSBzaXplIG9mIHRoZSB0d28gbGlzdHMuXG4gKlxuICogQHBhcmFtIGJlZm9yZSAtIFRoZSBlbGVtZW50cyB0aGF0IGV4aXN0IGluIHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gYWZ0ZXIgLSBUaGUgZWxlbWVudHMgdG8gZGlmZiBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gY29tcGFyYXRvciAtIFRoZSBjb21wYXJhdG9yIGZvciB0aGUgZWxlbWVudHMgaW4gYmVmb3JlIGFuZCBhZnRlci5cbiAqIEBwYXJhbSBvbkFkZCAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZiBgXG4gKiBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC5cbiAqIEBwYXJhbSBvblJlbW92ZSAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZlxuICogYGJlZm9yZWAgYnV0IG5vdCBgYWZ0ZXJgLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG5leHQgZWxlbWVudCBmcm9tIHRoZSBpdGVyYXRvciBvciBgdW5kZWZpbmVkYCBpZiBub25lIGF2YWlsYWJsZS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihlKSB7XG4gICAgcmV0dXJuIGUuaGFzTmV4dCgpID8gZS5nZXROZXh0KCkgOiB2b2lkIDA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVzIGEgc2V0IG9mIGZpZWxkcyB0aGF0IGNhbiBiZSB1c2VkIHRvIHBhcnRpYWxseSBwYXRjaCBhIGRvY3VtZW50LlxuICogRmllbGRNYXNrIGlzIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCBPYmplY3RWYWx1ZS5cbiAqIEV4YW1wbGVzOlxuICogICBmb28gLSBPdmVyd3JpdGVzIGZvbyBlbnRpcmVseSB3aXRoIHRoZSBwcm92aWRlZCB2YWx1ZS4gSWYgZm9vIGlzIG5vdFxuICogICAgICAgICBwcmVzZW50IGluIHRoZSBjb21wYW5pb24gT2JqZWN0VmFsdWUsIHRoZSBmaWVsZCBpcyBkZWxldGVkLlxuICogICBmb28uYmFyIC0gT3ZlcndyaXRlcyBvbmx5IHRoZSBmaWVsZCBiYXIgb2YgdGhlIG9iamVjdCBmb28uXG4gKiAgICAgICAgICAgICBJZiBmb28gaXMgbm90IGFuIG9iamVjdCwgZm9vIGlzIHJlcGxhY2VkIHdpdGggYW4gb2JqZWN0XG4gKiAgICAgICAgICAgICBjb250YWluaW5nIGZvb1xuICovIGNsYXNzIEZpZWxkTWFzayB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmZpZWxkcyA9IGUsIFxuICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IHZhbGlkYXRpb24gb2YgRmllbGRNYXNrXG4gICAgICAgIC8vIFNvcnQgdGhlIGZpZWxkIG1hc2sgdG8gc3VwcG9ydCBgRmllbGRNYXNrLmlzRXF1YWwoKWAgYW5kIGFzc2VydCBiZWxvdy5cbiAgICAgICAgZS5zb3J0KEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRNYXNrKFtdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIG5ldyBGaWVsZE1hc2sgb2JqZWN0IHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBhZGRpbmcgYWxsIHRoZSBnaXZlblxuICAgICAqIGZpZWxkcyBwYXRocyB0byB0aGlzIGZpZWxkIG1hc2suXG4gICAgICovICAgIHVuaW9uV2l0aChlKSB7XG4gICAgICAgIGxldCB0ID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuZmllbGRzKSB0ID0gdC5hZGQoZSk7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSB0ID0gdC5hZGQobik7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRNYXNrKHQudG9BcnJheSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmVyaWZpZXMgdGhhdCBgZmllbGRQYXRoYCBpcyBpbmNsdWRlZCBieSBhdCBsZWFzdCBvbmUgZmllbGQgaW4gdGhpcyBmaWVsZFxuICAgICAqIG1hc2suXG4gICAgICpcbiAgICAgKiBUaGlzIGlzIGFuIE8obikgb3BlcmF0aW9uLCB3aGVyZSBgbmAgaXMgdGhlIHNpemUgb2YgdGhlIGZpZWxkIG1hc2suXG4gICAgICovICAgIGNvdmVycyhlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLmZpZWxkcykgaWYgKHQuaXNQcmVmaXhPZihlKSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2FycmF5RXF1YWxzKHRoaXMuZmllbGRzLCBlLmZpZWxkcywgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGVycm9yIGVuY291bnRlcmVkIHdoaWxlIGRlY29kaW5nIGJhc2U2NCBzdHJpbmcuXG4gKi8gY2xhc3MgX19QUklWQVRFX0Jhc2U2NERlY29kZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpLCB0aGlzLm5hbWUgPSBcIkJhc2U2NERlY29kZUVycm9yXCI7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIENvbnZlcnRzIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nIHRvIGEgYmluYXJ5IHN0cmluZy4gKi9cbi8qKiBUcnVlIGlmIGFuZCBvbmx5IGlmIHRoZSBCYXNlNjQgY29udmVyc2lvbiBmdW5jdGlvbnMgYXJlIGF2YWlsYWJsZS4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc0Jhc2U2NEF2YWlsYWJsZSgpIHtcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgYXRvYjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1tdXRhYmxlIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIFwicHJvdG9cIiBieXRlIHN0cmluZy5cbiAqXG4gKiBQcm90byBieXRlIHN0cmluZ3MgY2FuIGVpdGhlciBiZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmdzIG9yIFVpbnQ4QXJyYXlzIHdoZW5cbiAqIHNlbnQgb24gdGhlIHdpcmUuIFRoaXMgY2xhc3MgYWJzdHJhY3RzIGF3YXkgdGhpcyBkaWZmZXJlbnRpYXRpb24gYnkgaG9sZGluZ1xuICogdGhlIHByb3RvIGJ5dGUgc3RyaW5nIGluIGEgY29tbW9uIGNsYXNzIHRoYXQgbXVzdCBiZSBjb252ZXJ0ZWQgaW50byBhIHN0cmluZ1xuICogYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBwcm90by5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIEJ5dGVTdHJpbmcge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5iaW5hcnlTdHJpbmcgPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbUJhc2U2NFN0cmluZyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZGVjb2RlQmFzZTY0KGUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0b2IoZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCBgRE9NRXhjZXB0aW9uYCBpcyBkZWZpbmVkIGJlZm9yZSB1c2luZyBpdCB0byBhdm9pZFxuICAgICAgICAgICAgICAgIC8vIFwiUmVmZXJlbmNlRXJyb3I6IFByb3BlcnR5ICdET01FeGNlcHRpb24nIGRvZXNuJ3QgZXhpc3RcIiBpbiByZWFjdC1uYXRpdmUuXG4gICAgICAgICAgICAgICAgLy8gKGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzcxMTUpXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgRE9NRXhjZXB0aW9uICYmIGUgaW5zdGFuY2VvZiBET01FeGNlcHRpb24gPyBuZXcgX19QUklWQVRFX0Jhc2U2NERlY29kZUVycm9yKFwiSW52YWxpZCBiYXNlNjQgc3RyaW5nOiBcIiArIGUpIDogZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKiogQ29udmVydHMgYSBiaW5hcnkgc3RyaW5nIHRvIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nLiAqLyAoZSk7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZVN0cmluZyh0KTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21VaW50OEFycmF5KGUpIHtcbiAgICAgICAgLy8gVE9ETyhpbmRleGluZyk7IFJlbW92ZSB0aGUgY29weSBvZiB0aGUgYnl0ZSBzdHJpbmcgaGVyZSBhcyB0aGlzIG1ldGhvZFxuICAgICAgICAvLyBpcyBmcmVxdWVudGx5IGNhbGxlZCBkdXJpbmcgaW5kZXhpbmcuXG4gICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBhbiBVaW50OGFycmF5IHRvIGEgYmluYXJ5IHN0cmluZy5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfYmluYXJ5U3RyaW5nRnJvbVVpbnQ4QXJyYXkoZSkge1xuICAgICAgICAgICAgbGV0IHQgPSBcIlwiO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgKytuKSB0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZVtuXSk7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjb252ZXJ0IGEgYmluYXJ5IHN0cmluZyB0byBhbiBVaW50OEFycmF5LlxuICovIChlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBCeXRlU3RyaW5nKHQpO1xuICAgIH1cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgbGV0IGUgPSAwO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmV4dDogKCkgPT4gZSA8IHRoaXMuYmluYXJ5U3RyaW5nLmxlbmd0aCA/IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5iaW5hcnlTdHJpbmcuY2hhckNvZGVBdChlKyspLFxuICAgICAgICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsXG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgdG9CYXNlNjQoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZW5jb2RlQmFzZTY0KGUpIHtcbiAgICAgICAgICAgIHJldHVybiBidG9hKGUpO1xuICAgICAgICB9KHRoaXMuYmluYXJ5U3RyaW5nKTtcbiAgICB9XG4gICAgdG9VaW50OEFycmF5KCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3VpbnQ4QXJyYXlGcm9tQmluYXJ5U3RyaW5nKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgVWludDhBcnJheShlLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHRbbl0gPSBlLmNoYXJDb2RlQXQobik7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgICAgICAvLyBBIFJlZ0V4cCBtYXRjaGluZyBJU08gODYwMSBVVEMgdGltZXN0YW1wcyB3aXRoIG9wdGlvbmFsIGZyYWN0aW9uLlxuICAgICAgICAodGhpcy5iaW5hcnlTdHJpbmcpO1xuICAgIH1cbiAgICBhcHByb3hpbWF0ZUJ5dGVTaXplKCkge1xuICAgICAgICByZXR1cm4gMiAqIHRoaXMuYmluYXJ5U3RyaW5nLmxlbmd0aDtcbiAgICB9XG4gICAgY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMuYmluYXJ5U3RyaW5nLCBlLmJpbmFyeVN0cmluZyk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iaW5hcnlTdHJpbmcgPT09IGUuYmluYXJ5U3RyaW5nO1xuICAgIH1cbn1cblxuQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORyA9IG5ldyBCeXRlU3RyaW5nKFwiXCIpO1xuXG5jb25zdCB0ZSA9IG5ldyBSZWdFeHAoL15cXGR7NH0tXFxkXFxkLVxcZFxcZFRcXGRcXGQ6XFxkXFxkOlxcZFxcZCg/OlxcLihcXGQrKSk/WiQvKTtcblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgcG9zc2libGUgUHJvdG8gdmFsdWVzIGZvciBhIHRpbWVzdGFtcCB2YWx1ZSBpbnRvIGEgXCJzZWNvbmRzIGFuZFxuICogbmFub3NcIiByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpIHtcbiAgICAvLyBUaGUganNvbiBpbnRlcmZhY2UgKGZvciB0aGUgYnJvd3Nlcikgd2lsbCByZXR1cm4gYW4gaXNvIHRpbWVzdGFtcCBzdHJpbmcsXG4gICAgLy8gd2hpbGUgdGhlIHByb3RvIGpzIGxpYnJhcnkgKGZvciBub2RlKSB3aWxsIHJldHVybiBhXG4gICAgLy8gZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCBpbnN0YW5jZS5cbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoISFlKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSkge1xuICAgICAgICAvLyBUaGUgZGF0ZSBzdHJpbmcgY2FuIGhhdmUgaGlnaGVyIHByZWNpc2lvbiAobmFub3MpIHRoYW4gdGhlIERhdGUgY2xhc3NcbiAgICAgICAgLy8gKG1pbGxpcyksIHNvIHdlIGRvIHNvbWUgY3VzdG9tIHBhcnNpbmcgaGVyZS5cbiAgICAgICAgLy8gUGFyc2UgdGhlIG5hbm9zIHJpZ2h0IG91dCBvZiB0aGUgc3RyaW5nLlxuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIGNvbnN0IG4gPSB0ZS5leGVjKGUpO1xuICAgICAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoISFuKSwgblsxXSkge1xuICAgICAgICAgICAgLy8gUGFkIHRoZSBmcmFjdGlvbiBvdXQgdG8gOSBkaWdpdHMgKG5hbm9zKS5cbiAgICAgICAgICAgIGxldCBlID0gblsxXTtcbiAgICAgICAgICAgIGUgPSAoZSArIFwiMDAwMDAwMDAwXCIpLnN1YnN0cigwLCA5KSwgdCA9IE51bWJlcihlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQYXJzZSB0aGUgZGF0ZSB0byBnZXQgdGhlIHNlY29uZHMuXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBEYXRlKGUpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vjb25kczogTWF0aC5mbG9vcihyLmdldFRpbWUoKSAvIDFlMyksXG4gICAgICAgICAgICBuYW5vczogdFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuc2Vjb25kcyksXG4gICAgICAgIG5hbm9zOiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubmFub3MpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgcG9zc2libGUgUHJvdG8gdHlwZXMgZm9yIG51bWJlcnMgaW50byBhIEphdmFTY3JpcHQgbnVtYmVyLlxuICogUmV0dXJucyAwIGlmIHRoZSB2YWx1ZSBpcyBub3QgbnVtZXJpYy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUpIHtcbiAgICAvLyBUT0RPKGJqb3JuaWNrKTogSGFuZGxlIGludDY0IGdyZWF0ZXIgdGhhbiA1MyBiaXRzLlxuICAgIHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiBlID8gZSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBOdW1iZXIoZSkgOiAwO1xufVxuXG4vKiogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHR5cGVzIGZvciBCbG9icyBpbnRvIGEgQnl0ZVN0cmluZy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZSkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gQnl0ZVN0cmluZy5mcm9tQmFzZTY0U3RyaW5nKGUpIDogQnl0ZVN0cmluZy5mcm9tVWludDhBcnJheShlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGxvY2FsbHktYXBwbGllZCBTZXJ2ZXJUaW1lc3RhbXAuXG4gKlxuICogU2VydmVyIFRpbWVzdGFtcHMgYXJlIGJhY2tlZCBieSBNYXBWYWx1ZXMgdGhhdCBjb250YWluIGFuIGludGVybmFsIGZpZWxkXG4gKiBgX190eXBlX19gIHdpdGggYSB2YWx1ZSBvZiBgc2VydmVyX3RpbWVzdGFtcGAuIFRoZSBwcmV2aW91cyB2YWx1ZSBhbmQgbG9jYWxcbiAqIHdyaXRlIHRpbWUgYXJlIHN0b3JlZCBpbiBpdHMgYF9fcHJldmlvdXNfdmFsdWVfX2AgYW5kIGBfX2xvY2FsX3dyaXRlX3RpbWVfX2BcbiAqIGZpZWxkcyByZXNwZWN0aXZlbHkuXG4gKlxuICogTm90ZXM6XG4gKiAtIFNlcnZlclRpbWVzdGFtcFZhbHVlIGluc3RhbmNlcyBhcmUgY3JlYXRlZCBhcyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGFcbiAqICAgdHJhbnNmb3JtLiBUaGV5IGNhbiBvbmx5IGV4aXN0IGluIHRoZSBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQuIFRoZXJlZm9yZVxuICogICB0aGV5IGRvIG5vdCBuZWVkIHRvIGJlIHBhcnNlZCBvciBzZXJpYWxpemVkLlxuICogLSBXaGVuIGV2YWx1YXRlZCBsb2NhbGx5IChlLmcuIGZvciBzbmFwc2hvdC5kYXRhKCkpLCB0aGV5IGJ5IGRlZmF1bHRcbiAqICAgZXZhbHVhdGUgdG8gYG51bGxgLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IHBhc3NpbmcgY3VzdG9tXG4gKiAgIEZpZWxkVmFsdWVPcHRpb25zIHRvIHZhbHVlKCkuXG4gKiAtIFdpdGggcmVzcGVjdCB0byBvdGhlciBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMsIHRoZXkgc29ydCBieSB0aGVpclxuICogICBsb2NhbFdyaXRlVGltZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNTZXJ2ZXJUaW1lc3RhbXAoZSkge1xuICAgIHZhciB0LCBuO1xuICAgIHJldHVybiBcInNlcnZlcl90aW1lc3RhbXBcIiA9PT0gKG51bGwgPT09IChuID0gKChudWxsID09PSAodCA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUubWFwVmFsdWUpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuZmllbGRzKSB8fCB7fSkuX190eXBlX18pIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uc3RyaW5nVmFsdWUpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgU2VydmVyVGltZXN0YW1wIHByb3RvIHZhbHVlICh1c2luZyB0aGUgaW50ZXJuYWwgZm9ybWF0KS5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgYmVmb3JlIHRoaXMgU2VydmVyVGltZXN0YW1wIHdhcyBzZXQuXG4gKlxuICogUHJlc2VydmluZyB0aGUgcHJldmlvdXMgdmFsdWVzIGFsbG93cyB0aGUgdXNlciB0byBkaXNwbGF5IHRoZSBsYXN0IHJlc29sZWRcbiAqIHZhbHVlIHVudGlsIHRoZSBiYWNrZW5kIHJlc3BvbmRzIHdpdGggdGhlIHRpbWVzdGFtcC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSkge1xuICAgIGNvbnN0IHQgPSBlLm1hcFZhbHVlLmZpZWxkcy5fX3ByZXZpb3VzX3ZhbHVlX187XG4gICAgcmV0dXJuIF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcCh0KSA/IF9fUFJJVkFURV9nZXRQcmV2aW91c1ZhbHVlKHQpIDogdDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsb2NhbCB0aW1lIGF0IHdoaWNoIHRoaXMgdGltZXN0YW1wIHdhcyBmaXJzdCBzZXQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlLm1hcFZhbHVlLmZpZWxkcy5fX2xvY2FsX3dyaXRlX3RpbWVfXy50aW1lc3RhbXBWYWx1ZSk7XG4gICAgcmV0dXJuIG5ldyBUaW1lc3RhbXAodC5zZWNvbmRzLCB0Lm5hbm9zKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgRGF0YWJhc2VJbmZvIHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEgRGF0YWJhc2VJbmZvIHVzaW5nIHRoZSBwcm92aWRlZCBob3N0LCBkYXRhYmFzZUlkIGFuZFxuICAgICAqIHBlcnNpc3RlbmNlS2V5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgdG8gdXNlLlxuICAgICAqIEBwYXJhbSBhcHBJZCAtIFRoZSBGaXJlYmFzZSBBcHAgSWQuXG4gICAgICogQHBhcmFtIHBlcnNpc3RlbmNlS2V5IC0gQSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhpcyBGaXJlc3RvcmUncyBsb2NhbFxuICAgICAqIHN0b3JhZ2UgKHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB0aGUgZGF0YWJhc2VJZCkuXG4gICAgICogQHBhcmFtIGhvc3QgLSBUaGUgRmlyZXN0b3JlIGJhY2tlbmQgaG9zdCB0byBjb25uZWN0IHRvLlxuICAgICAqIEBwYXJhbSBzc2wgLSBXaGV0aGVyIHRvIHVzZSBTU0wgd2hlbiBjb25uZWN0aW5nLlxuICAgICAqIEBwYXJhbSBmb3JjZUxvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGZvcmNlTG9uZ1BvbGxpbmcgb3B0aW9uXG4gICAgICogd2hlbiB1c2luZyBXZWJDaGFubmVsIGFzIHRoZSBuZXR3b3JrIHRyYW5zcG9ydC5cbiAgICAgKiBAcGFyYW0gYXV0b0RldGVjdExvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGRldGVjdEJ1ZmZlcmluZ1Byb3h5XG4gICAgICogb3B0aW9uIHdoZW4gdXNpbmcgV2ViQ2hhbm5lbCBhcyB0aGUgbmV0d29yayB0cmFuc3BvcnQuXG4gICAgICogQHBhcmFtIGxvbmdQb2xsaW5nT3B0aW9ucyBPcHRpb25zIHRoYXQgY29uZmlndXJlIGxvbmctcG9sbGluZy5cbiAgICAgKiBAcGFyYW0gdXNlRmV0Y2hTdHJlYW1zIFdoZXRoZXIgdG8gdXNlIHRoZSBGZXRjaCBBUEkgaW5zdGVhZCBvZlxuICAgICAqIFhNTEhUVFBSZXF1ZXN0XG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlSWQgPSBlLCB0aGlzLmFwcElkID0gdCwgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IG4sIHRoaXMuaG9zdCA9IHIsIHRoaXMuc3NsID0gaSwgXG4gICAgICAgIHRoaXMuZm9yY2VMb25nUG9sbGluZyA9IHMsIHRoaXMuYXV0b0RldGVjdExvbmdQb2xsaW5nID0gbywgdGhpcy5sb25nUG9sbGluZ09wdGlvbnMgPSBfLCBcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSBhO1xuICAgIH1cbn1cblxuLyoqIFRoZSBkZWZhdWx0IGRhdGFiYXNlIG5hbWUgZm9yIGEgcHJvamVjdC4gKi9cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgZGF0YWJhc2UgSUQgYSBGaXJlc3RvcmUgY2xpZW50IGlzIGFzc29jaWF0ZWQgd2l0aC5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBEYXRhYmFzZUlkIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucHJvamVjdElkID0gZSwgdGhpcy5kYXRhYmFzZSA9IHQgfHwgXCIoZGVmYXVsdClcIjtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSWQoXCJcIiwgXCJcIik7XG4gICAgfVxuICAgIGdldCBpc0RlZmF1bHREYXRhYmFzZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiKGRlZmF1bHQpXCIgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIERhdGFiYXNlSWQgJiYgZS5wcm9qZWN0SWQgPT09IHRoaXMucHJvamVjdElkICYmIGUuZGF0YWJhc2UgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgbmUgPSB7XG4gICAgbWFwVmFsdWU6IHtcbiAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcIl9fbWF4X19cIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSwgcmUgPSB7XG4gICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxufTtcblxuLyoqIEV4dHJhY3RzIHRoZSBiYWNrZW5kJ3MgdHlwZSBvcmRlciBmb3IgdGhlIHByb3ZpZGVkIHZhbHVlLiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3R5cGVPcmRlcihlKSB7XG4gICAgcmV0dXJuIFwibnVsbFZhbHVlXCIgaW4gZSA/IDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSB8fCBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8gNSAvKiBUeXBlT3JkZXIuU3RyaW5nVmFsdWUgKi8gOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8gNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDogXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUgPyA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUgPyA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IDkgLyogVHlwZU9yZGVyLkFycmF5VmFsdWUgKi8gOiBcIm1hcFZhbHVlXCIgaW4gZSA/IF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcChlKSA/IDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDogX19QUklWQVRFX2lzTWF4VmFsdWUoZSkgPyA5MDA3MTk5MjU0NzQwOTkxIC8qIFR5cGVPcmRlci5NYXhWYWx1ZSAqLyA6IDEwIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6IGZhaWwoKTtcbn1cblxuLyoqIFRlc3RzIGBsZWZ0YCBhbmQgYHJpZ2h0YCBmb3IgZXF1YWxpdHkgYmFzZWQgb24gdGhlIGJhY2tlbmQgc2VtYW50aWNzLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZSwgdCkge1xuICAgIGlmIChlID09PSB0KSByZXR1cm4gITA7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV90eXBlT3JkZXIoZSk7XG4gICAgaWYgKG4gIT09IF9fUFJJVkFURV90eXBlT3JkZXIodCkpIHJldHVybiAhMTtcbiAgICBzd2l0Y2ggKG4pIHtcbiAgICAgIGNhc2UgMCAvKiBUeXBlT3JkZXIuTnVsbFZhbHVlICovIDpcbiAgICAgIGNhc2UgOTAwNzE5OTI1NDc0MDk5MSAvKiBUeXBlT3JkZXIuTWF4VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gITA7XG5cbiAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGUuYm9vbGVhblZhbHVlID09PSB0LmJvb2xlYW5WYWx1ZTtcblxuICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0TG9jYWxXcml0ZVRpbWUoZSkuaXNFcXVhbChfX1BSSVZBVEVfZ2V0TG9jYWxXcml0ZVRpbWUodCkpO1xuXG4gICAgICBjYXNlIDMgLyogVHlwZU9yZGVyLlRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV90aW1lc3RhbXBFcXVhbHMoZSwgdCkge1xuICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUudGltZXN0YW1wVmFsdWUgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC50aW1lc3RhbXBWYWx1ZSAmJiBlLnRpbWVzdGFtcFZhbHVlLmxlbmd0aCA9PT0gdC50aW1lc3RhbXBWYWx1ZS5sZW5ndGgpIFxuICAgICAgICAgICAgLy8gVXNlIHN0cmluZyBlcXVhbGl0eSBmb3IgSVNPIDg2MDEgdGltZXN0YW1wc1xuICAgICAgICAgICAgcmV0dXJuIGUudGltZXN0YW1wVmFsdWUgPT09IHQudGltZXN0YW1wVmFsdWU7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlLnRpbWVzdGFtcFZhbHVlKSwgciA9IF9fUFJJVkFURV9ub3JtYWxpemVUaW1lc3RhbXAodC50aW1lc3RhbXBWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gbi5zZWNvbmRzID09PSByLnNlY29uZHMgJiYgbi5uYW5vcyA9PT0gci5uYW5vcztcbiAgICAgICAgfShlLCB0KTtcblxuICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBlLnN0cmluZ1ZhbHVlID09PSB0LnN0cmluZ1ZhbHVlO1xuXG4gICAgICBjYXNlIDYgLyogVHlwZU9yZGVyLkJsb2JWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfYmxvYkVxdWFscyhlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZS5ieXRlc1ZhbHVlKS5pc0VxdWFsKF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKHQuYnl0ZXNWYWx1ZSkpO1xuICAgICAgICB9KGUsIHQpO1xuXG4gICAgICBjYXNlIDcgLyogVHlwZU9yZGVyLlJlZlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGUucmVmZXJlbmNlVmFsdWUgPT09IHQucmVmZXJlbmNlVmFsdWU7XG5cbiAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZ2VvUG9pbnRFcXVhbHMoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5nZW9Qb2ludFZhbHVlLmxhdGl0dWRlKSA9PT0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0Lmdlb1BvaW50VmFsdWUubGF0aXR1ZGUpICYmIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5nZW9Qb2ludFZhbHVlLmxvbmdpdHVkZSkgPT09IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5nZW9Qb2ludFZhbHVlLmxvbmdpdHVkZSk7XG4gICAgICAgIH0oZSwgdCk7XG5cbiAgICAgIGNhc2UgMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX251bWJlckVxdWFscyhlLCB0KSB7XG4gICAgICAgICAgICBpZiAoXCJpbnRlZ2VyVmFsdWVcIiBpbiBlICYmIFwiaW50ZWdlclZhbHVlXCIgaW4gdCkgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5pbnRlZ2VyVmFsdWUpID09PSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQuaW50ZWdlclZhbHVlKTtcbiAgICAgICAgICAgIGlmIChcImRvdWJsZVZhbHVlXCIgaW4gZSAmJiBcImRvdWJsZVZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuZG91YmxlVmFsdWUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmRvdWJsZVZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbiA9PT0gciA/IF9fUFJJVkFURV9pc05lZ2F0aXZlWmVybyhuKSA9PT0gX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKHIpIDogaXNOYU4obikgJiYgaXNOYU4ocik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIH0oZSwgdCk7XG5cbiAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZS5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSwgdC5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSwgX19QUklWQVRFX3ZhbHVlRXF1YWxzKTtcblxuICAgICAgY2FzZSAxMCAvKiBUeXBlT3JkZXIuT2JqZWN0VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX29iamVjdEVxdWFscyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5tYXBWYWx1ZS5maWVsZHMgfHwge30sIHIgPSB0Lm1hcFZhbHVlLmZpZWxkcyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfb2JqZWN0U2l6ZShuKSAhPT0gX19QUklWQVRFX29iamVjdFNpemUocikpIHJldHVybiAhMTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBpbiBuKSBpZiAobi5oYXNPd25Qcm9wZXJ0eShlKSAmJiAodm9pZCAwID09PSByW2VdIHx8ICFfX1BSSVZBVEVfdmFsdWVFcXVhbHMobltlXSwgcltlXSkpKSByZXR1cm4gITE7XG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgQXJyYXlWYWx1ZSBjb250YWlucyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQuICovIChlLCB0KTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnMoZSwgdCkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IChlLnZhbHVlcyB8fCBbXSkuZmluZCgoZSA9PiBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZSwgdCkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShlLCB0KSB7XG4gICAgaWYgKGUgPT09IHQpIHJldHVybiAwO1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdHlwZU9yZGVyKGUpLCByID0gX19QUklWQVRFX3R5cGVPcmRlcih0KTtcbiAgICBpZiAobiAhPT0gcikgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4sIHIpO1xuICAgIHN3aXRjaCAobikge1xuICAgICAgY2FzZSAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOlxuICAgICAgY2FzZSA5MDA3MTk5MjU0NzQwOTkxIC8qIFR5cGVPcmRlci5NYXhWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiAwO1xuXG4gICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmJvb2xlYW5WYWx1ZSwgdC5ib29sZWFuVmFsdWUpO1xuXG4gICAgICBjYXNlIDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlTnVtYmVycyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmludGVnZXJWYWx1ZSB8fCBlLmRvdWJsZVZhbHVlKSwgciA9IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5pbnRlZ2VyVmFsdWUgfHwgdC5kb3VibGVWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gbiA8IHIgPyAtMSA6IG4gPiByID8gMSA6IG4gPT09IHIgPyAwIDogXG4gICAgICAgICAgICAvLyBvbmUgb3IgYm90aCBhcmUgTmFOLlxuICAgICAgICAgICAgaXNOYU4obikgPyBpc05hTihyKSA/IDAgOiAtMSA6IDE7XG4gICAgICAgIH0oZSwgdCk7XG5cbiAgICAgIGNhc2UgMyAvKiBUeXBlT3JkZXIuVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbXBhcmVUaW1lc3RhbXBzKGUudGltZXN0YW1wVmFsdWUsIHQudGltZXN0YW1wVmFsdWUpO1xuXG4gICAgICBjYXNlIDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlVGltZXN0YW1wcyhfX1BSSVZBVEVfZ2V0TG9jYWxXcml0ZVRpbWUoZSksIF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZSh0KSk7XG5cbiAgICAgIGNhc2UgNSAvKiBUeXBlT3JkZXIuU3RyaW5nVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5zdHJpbmdWYWx1ZSwgdC5zdHJpbmdWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlQmxvYnMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcodCk7XG4gICAgICAgICAgICByZXR1cm4gbi5jb21wYXJlVG8ocik7XG4gICAgICAgIH0oZS5ieXRlc1ZhbHVlLCB0LmJ5dGVzVmFsdWUpO1xuXG4gICAgICBjYXNlIDcgLyogVHlwZU9yZGVyLlJlZlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlUmVmZXJlbmNlcyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5zcGxpdChcIi9cIiksIHIgPSB0LnNwbGl0KFwiL1wiKTtcbiAgICAgICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgbi5sZW5ndGggJiYgZSA8IHIubGVuZ3RoOyBlKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IobltlXSwgcltlXSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgIT09IHQpIHJldHVybiB0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4ubGVuZ3RoLCByLmxlbmd0aCk7XG4gICAgICAgIH0oZS5yZWZlcmVuY2VWYWx1ZSwgdC5yZWZlcmVuY2VWYWx1ZSk7XG5cbiAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUdlb1BvaW50cyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmxhdGl0dWRlKSwgX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmxhdGl0dWRlKSk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gbikgcmV0dXJuIG47XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmxvbmdpdHVkZSksIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5sb25naXR1ZGUpKTtcbiAgICAgICAgfShlLmdlb1BvaW50VmFsdWUsIHQuZ2VvUG9pbnRWYWx1ZSk7XG5cbiAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUFycmF5cyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS52YWx1ZXMgfHwgW10sIHIgPSB0LnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgbi5sZW5ndGggJiYgZSA8IHIubGVuZ3RoOyArK2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShuW2VdLCByW2VdKTtcbiAgICAgICAgICAgICAgICBpZiAodCkgcmV0dXJuIHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Iobi5sZW5ndGgsIHIubGVuZ3RoKTtcbiAgICAgICAgfShlLmFycmF5VmFsdWUsIHQuYXJyYXlWYWx1ZSk7XG5cbiAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlTWFwcyhlLCB0KSB7XG4gICAgICAgICAgICBpZiAoZSA9PT0gbmUubWFwVmFsdWUgJiYgdCA9PT0gbmUubWFwVmFsdWUpIHJldHVybiAwO1xuICAgICAgICAgICAgaWYgKGUgPT09IG5lLm1hcFZhbHVlKSByZXR1cm4gMTtcbiAgICAgICAgICAgIGlmICh0ID09PSBuZS5tYXBWYWx1ZSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgY29uc3QgbiA9IGUuZmllbGRzIHx8IHt9LCByID0gT2JqZWN0LmtleXMobiksIGkgPSB0LmZpZWxkcyB8fCB7fSwgcyA9IE9iamVjdC5rZXlzKGkpO1xuICAgICAgICAgICAgLy8gRXZlbiB0aG91Z2ggTWFwVmFsdWVzIGFyZSBsaWtlbHkgc29ydGVkIGNvcnJlY3RseSBiYXNlZCBvbiB0aGVpciBpbnNlcnRpb25cbiAgICAgICAgICAgIC8vIG9yZGVyIChlLmcuIHdoZW4gcmVjZWl2ZWQgZnJvbSB0aGUgYmFja2VuZCksIGxvY2FsIG1vZGlmaWNhdGlvbnMgY2FuIGJyaW5nXG4gICAgICAgICAgICAvLyBlbGVtZW50cyBvdXQgb2Ygb3JkZXIuIFdlIG5lZWQgdG8gcmUtc29ydCB0aGUgZWxlbWVudHMgdG8gZW5zdXJlIHRoYXRcbiAgICAgICAgICAgIC8vIGNhbm9uaWNhbCBJRHMgYXJlIGluZGVwZW5kZW50IG9mIGluc2VydGlvbiBvcmRlci5cbiAgICAgICAgICAgIHIuc29ydCgpLCBzLnNvcnQoKTtcbiAgICAgICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgci5sZW5ndGggJiYgZSA8IHMubGVuZ3RoOyArK2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IocltlXSwgc1tlXSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgIT09IHQpIHJldHVybiB0O1xuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKG5bcltlXV0sIGlbc1tlXV0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSBvKSByZXR1cm4gbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihyLmxlbmd0aCwgcy5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogR2VuZXJhdGVzIHRoZSBjYW5vbmljYWwgSUQgZm9yIHRoZSBwcm92aWRlZCBmaWVsZCB2YWx1ZSAoYXMgdXNlZCBpbiBUYXJnZXRcbiAqIHNlcmlhbGl6YXRpb24pLlxuICovIChlLm1hcFZhbHVlLCB0Lm1hcFZhbHVlKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVUaW1lc3RhbXBzKGUsIHQpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0ICYmIGUubGVuZ3RoID09PSB0Lmxlbmd0aCkgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUsIHQpO1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcCh0KSwgaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4uc2Vjb25kcywgci5zZWNvbmRzKTtcbiAgICByZXR1cm4gMCAhPT0gaSA/IGkgOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuLm5hbm9zLCByLm5hbm9zKTtcbn1cblxuZnVuY3Rpb24gY2Fub25pY2FsSWQoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY2Fub25pZnlWYWx1ZShlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5VmFsdWUoZSkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIGUgPyBcIm51bGxcIiA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IFwiXCIgKyBlLmJvb2xlYW5WYWx1ZSA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSA/IFwiXCIgKyBlLmludGVnZXJWYWx1ZSA6IFwiZG91YmxlVmFsdWVcIiBpbiBlID8gXCJcIiArIGUuZG91YmxlVmFsdWUgOiBcInRpbWVzdGFtcFZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVRpbWVzdGFtcChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpO1xuICAgICAgICByZXR1cm4gYHRpbWUoJHt0LnNlY29uZHN9LCR7dC5uYW5vc30pYDtcbiAgICB9KGUudGltZXN0YW1wVmFsdWUpIDogXCJzdHJpbmdWYWx1ZVwiIGluIGUgPyBlLnN0cmluZ1ZhbHVlIDogXCJieXRlc1ZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeUJ5dGVTdHJpbmcoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZSkudG9CYXNlNjQoKTtcbiAgICB9KGUuYnl0ZXNWYWx1ZSkgOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVJlZmVyZW5jZShlKSB7XG4gICAgICAgIHJldHVybiBEb2N1bWVudEtleS5mcm9tTmFtZShlKS50b1N0cmluZygpO1xuICAgIH0oZS5yZWZlcmVuY2VWYWx1ZSkgOiBcImdlb1BvaW50VmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5R2VvUG9pbnQoZSkge1xuICAgICAgICByZXR1cm4gYGdlbygke2UubGF0aXR1ZGV9LCR7ZS5sb25naXR1ZGV9KWA7XG4gICAgfShlLmdlb1BvaW50VmFsdWUpIDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeUFycmF5KGUpIHtcbiAgICAgICAgbGV0IHQgPSBcIltcIiwgbiA9ICEwO1xuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgZS52YWx1ZXMgfHwgW10pIG4gPyBuID0gITEgOiB0ICs9IFwiLFwiLCB0ICs9IF9fUFJJVkFURV9jYW5vbmlmeVZhbHVlKHIpO1xuICAgICAgICByZXR1cm4gdCArIFwiXVwiO1xuICAgIH1cbiAgICAvKipcbiAqIFJldHVybnMgYW4gYXBwcm94aW1hdGUgKGFuZCB3aWxkbHkgaW5hY2N1cmF0ZSkgaW4tbWVtb3J5IHNpemUgZm9yIHRoZSBmaWVsZFxuICogdmFsdWUuXG4gKlxuICogVGhlIG1lbW9yeSBzaXplIHRha2VzIGludG8gYWNjb3VudCBvbmx5IHRoZSBhY3R1YWwgdXNlciBkYXRhIGFzIGl0IHJlc2lkZXNcbiAqIGluIG1lbW9yeSBhbmQgaWdub3JlcyBvYmplY3Qgb3ZlcmhlYWQuXG4gKi8gKGUuYXJyYXlWYWx1ZSkgOiBcIm1hcFZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeU1hcChlKSB7XG4gICAgICAgIC8vIEl0ZXJhdGlvbiBvcmRlciBpbiBKYXZhU2NyaXB0IGlzIG5vdCBndWFyYW50ZWVkLiBUbyBlbnN1cmUgdGhhdCB3ZSBnZW5lcmF0ZVxuICAgICAgICAvLyBtYXRjaGluZyBjYW5vbmljYWwgSURzIGZvciBpZGVudGljYWwgbWFwcywgd2UgbmVlZCB0byBzb3J0IHRoZSBrZXlzLlxuICAgICAgICBjb25zdCB0ID0gT2JqZWN0LmtleXMoZS5maWVsZHMgfHwge30pLnNvcnQoKTtcbiAgICAgICAgbGV0IG4gPSBcIntcIiwgciA9ICEwO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2YgdCkgciA/IHIgPSAhMSA6IG4gKz0gXCIsXCIsIG4gKz0gYCR7aX06JHtfX1BSSVZBVEVfY2Fub25pZnlWYWx1ZShlLmZpZWxkc1tpXSl9YDtcbiAgICAgICAgcmV0dXJuIG4gKyBcIn1cIjtcbiAgICB9KGUubWFwVmFsdWUpIDogZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZXN0aW1hdGVCeXRlU2l6ZShlKSB7XG4gICAgc3dpdGNoIChfX1BSSVZBVEVfdHlwZU9yZGVyKGUpKSB7XG4gICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiA0O1xuXG4gICAgICBjYXNlIDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIDg7XG5cbiAgICAgIGNhc2UgMyAvKiBUeXBlT3JkZXIuVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgY2FzZSA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDpcbiAgICAgICAgLy8gR2VvUG9pbnRzIGFyZSBtYWRlIHVwIG9mIHR3byBkaXN0aW5jdCBudW1iZXJzIChsYXRpdHVkZSArIGxvbmdpdHVkZSlcbiAgICAgICAgcmV0dXJuIDE2O1xuXG4gICAgICBjYXNlIDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9nZXRQcmV2aW91c1ZhbHVlKGUpO1xuICAgICAgICByZXR1cm4gdCA/IDE2ICsgX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUodCkgOiAxNjtcblxuICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgIC8vIFNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L0RhdGFfc3RydWN0dXJlczpcbiAgICAgICAgLy8gXCJKYXZhU2NyaXB0J3MgU3RyaW5nIHR5cGUgaXMgWy4uLl0gYSBzZXQgb2YgZWxlbWVudHMgb2YgMTYtYml0IHVuc2lnbmVkXG4gICAgICAgIC8vIGludGVnZXIgdmFsdWVzXCJcbiAgICAgICAgcmV0dXJuIDIgKiBlLnN0cmluZ1ZhbHVlLmxlbmd0aDtcblxuICAgICAgY2FzZSA2IC8qIFR5cGVPcmRlci5CbG9iVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZS5ieXRlc1ZhbHVlKS5hcHByb3hpbWF0ZUJ5dGVTaXplKCk7XG5cbiAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZS5yZWZlcmVuY2VWYWx1ZS5sZW5ndGg7XG5cbiAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZXN0aW1hdGVBcnJheUJ5dGVTaXplKGUpIHtcbiAgICAgICAgICAgIHJldHVybiAoZS52YWx1ZXMgfHwgW10pLnJlZHVjZSgoKGUsIHQpID0+IGUgKyBfX1BSSVZBVEVfZXN0aW1hdGVCeXRlU2l6ZSh0KSksIDApO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHZhbHVlIGZvciB0aGUgcHJvdmlkZWQgZGF0YWJhc2UgYW5kIGtleS4gKi8gKGUuYXJyYXlWYWx1ZSk7XG5cbiAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9lc3RpbWF0ZU1hcEJ5dGVTaXplKGUpIHtcbiAgICAgICAgICAgIGxldCB0ID0gMDtcbiAgICAgICAgICAgIHJldHVybiBmb3JFYWNoKGUuZmllbGRzLCAoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICB0ICs9IGUubGVuZ3RoICsgX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUobik7XG4gICAgICAgICAgICB9KSksIHQ7XG4gICAgICAgIH0oZS5tYXBWYWx1ZSk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9yZWZWYWx1ZShlLCB0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVmZXJlbmNlVmFsdWU6IGBwcm9qZWN0cy8ke2UucHJvamVjdElkfS9kYXRhYmFzZXMvJHtlLmRhdGFiYXNlfS9kb2N1bWVudHMvJHt0LnBhdGguY2Fub25pY2FsU3RyaW5nKCl9YFxuICAgIH07XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhbiBJbnRlZ2VyVmFsdWUgLiAqLyBmdW5jdGlvbiBpc0ludGVnZXIoZSkge1xuICAgIHJldHVybiAhIWUgJiYgXCJpbnRlZ2VyVmFsdWVcIiBpbiBlO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBEb3VibGVWYWx1ZS4gKi9cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhbiBBcnJheVZhbHVlLiAqL1xuZnVuY3Rpb24gaXNBcnJheShlKSB7XG4gICAgcmV0dXJuICEhZSAmJiBcImFycmF5VmFsdWVcIiBpbiBlO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBOdWxsVmFsdWUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc051bGxWYWx1ZShlKSB7XG4gICAgcmV0dXJuICEhZSAmJiBcIm51bGxWYWx1ZVwiIGluIGU7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBOYU4uICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc05hblZhbHVlKGUpIHtcbiAgICByZXR1cm4gISFlICYmIFwiZG91YmxlVmFsdWVcIiBpbiBlICYmIGlzTmFOKE51bWJlcihlLmRvdWJsZVZhbHVlKSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIE1hcFZhbHVlLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNNYXBWYWx1ZShlKSB7XG4gICAgcmV0dXJuICEhZSAmJiBcIm1hcFZhbHVlXCIgaW4gZTtcbn1cblxuLyoqIENyZWF0ZXMgYSBkZWVwIGNvcHkgb2YgYHNvdXJjZWAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kZWVwQ2xvbmUoZSkge1xuICAgIGlmIChlLmdlb1BvaW50VmFsdWUpIHJldHVybiB7XG4gICAgICAgIGdlb1BvaW50VmFsdWU6IE9iamVjdC5hc3NpZ24oe30sIGUuZ2VvUG9pbnRWYWx1ZSlcbiAgICB9O1xuICAgIGlmIChlLnRpbWVzdGFtcFZhbHVlICYmIFwib2JqZWN0XCIgPT0gdHlwZW9mIGUudGltZXN0YW1wVmFsdWUpIHJldHVybiB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiBPYmplY3QuYXNzaWduKHt9LCBlLnRpbWVzdGFtcFZhbHVlKVxuICAgIH07XG4gICAgaWYgKGUubWFwVmFsdWUpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiB7fVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZm9yRWFjaChlLm1hcFZhbHVlLmZpZWxkcywgKChlLCBuKSA9PiB0Lm1hcFZhbHVlLmZpZWxkc1tlXSA9IF9fUFJJVkFURV9kZWVwQ2xvbmUobikpKSwgXG4gICAgICAgIHQ7XG4gICAgfVxuICAgIGlmIChlLmFycmF5VmFsdWUpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgKGUuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10pLmxlbmd0aDsgKytuKSB0LmFycmF5VmFsdWUudmFsdWVzW25dID0gX19QUklWQVRFX2RlZXBDbG9uZShlLmFycmF5VmFsdWUudmFsdWVzW25dKTtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBlKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgVmFsdWUgcmVwcmVzZW50cyB0aGUgY2Fub25pY2FsIHtAbGluayAjTUFYX1ZBTFVFfSAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc01heFZhbHVlKGUpIHtcbiAgICByZXR1cm4gXCJfX21heF9fXCIgPT09ICgoKGUubWFwVmFsdWUgfHwge30pLmZpZWxkcyB8fCB7fSkuX190eXBlX18gfHwge30pLnN0cmluZ1ZhbHVlO1xufVxuXG4vKiogUmV0dXJucyB0aGUgbG93ZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoaW5jbHVzaXZlKS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlc0dldExvd2VyQm91bmQoZSkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIGUgPyByZSA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYm9vbGVhblZhbHVlOiAhMVxuICAgIH0gOiBcImludGVnZXJWYWx1ZVwiIGluIGUgfHwgXCJkb3VibGVWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICBzZWNvbmRzOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUlxuICAgICAgICB9XG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBzdHJpbmdWYWx1ZTogXCJcIlxuICAgIH0gOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX3JlZlZhbHVlKERhdGFiYXNlSWQuZW1wdHkoKSwgRG9jdW1lbnRLZXkuZW1wdHkoKSkgOiBcImdlb1BvaW50VmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJtYXBWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIG1hcFZhbHVlOiB7fVxuICAgIH0gOiBmYWlsKCk7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBsYXJnZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoZXhjbHVzaXZlKS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlc0dldFVwcGVyQm91bmQoZSkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGJvb2xlYW5WYWx1ZTogITFcbiAgICB9IDogXCJib29sZWFuVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgfSA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSB8fCBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgIHNlY29uZHM6IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSXG4gICAgICAgIH1cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHN0cmluZ1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwiYnl0ZXNWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfcmVmVmFsdWUoRGF0YWJhc2VJZC5lbXB0eSgpLCBEb2N1bWVudEtleS5lbXB0eSgpKSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgbWFwVmFsdWU6IHt9XG4gICAgfSA6IFwibWFwVmFsdWVcIiBpbiBlID8gbmUgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb3dlckJvdW5kQ29tcGFyZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV92YWx1ZUNvbXBhcmUoZS52YWx1ZSwgdC52YWx1ZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogZS5pbmNsdXNpdmUgJiYgIXQuaW5jbHVzaXZlID8gLTEgOiAhZS5pbmNsdXNpdmUgJiYgdC5pbmNsdXNpdmUgPyAxIDogMDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3VwcGVyQm91bmRDb21wYXJlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShlLnZhbHVlLCB0LnZhbHVlKTtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiBlLmluY2x1c2l2ZSAmJiAhdC5pbmNsdXNpdmUgPyAxIDogIWUuaW5jbHVzaXZlICYmIHQuaW5jbHVzaXZlID8gLTEgOiAwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBPYmplY3RWYWx1ZSByZXByZXNlbnRzIGEgTWFwVmFsdWUgaW4gdGhlIEZpcmVzdG9yZSBQcm90byBhbmQgb2ZmZXJzIHRoZVxuICogYWJpbGl0eSB0byBhZGQgYW5kIHJlbW92ZSBmaWVsZHMgKHZpYSB0aGUgT2JqZWN0VmFsdWVCdWlsZGVyKS5cbiAqLyBjbGFzcyBPYmplY3RWYWx1ZSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gZTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IE9iamVjdFZhbHVlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7fVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdmFsdWUgYXQgdGhlIGdpdmVuIHBhdGggb3IgbnVsbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gdGhlIHBhdGggdG8gc2VhcmNoXG4gICAgICogQHJldHVybnMgVGhlIHZhbHVlIGF0IHRoZSBwYXRoIG9yIG51bGwgaWYgdGhlIHBhdGggaXMgbm90IHNldC5cbiAgICAgKi8gICAgZmllbGQoZSkge1xuICAgICAgICBpZiAoZS5pc0VtcHR5KCkpIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICB7XG4gICAgICAgICAgICBsZXQgdCA9IHRoaXMudmFsdWU7XG4gICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoIC0gMTsgKytuKSBpZiAodCA9ICh0Lm1hcFZhbHVlLmZpZWxkcyB8fCB7fSlbZS5nZXQobildLCBcbiAgICAgICAgICAgICFfX1BSSVZBVEVfaXNNYXBWYWx1ZSh0KSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICByZXR1cm4gdCA9ICh0Lm1hcFZhbHVlLmZpZWxkcyB8fCB7fSlbZS5sYXN0U2VnbWVudCgpXSwgdCB8fCBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGZpZWxkIHRvIHRoZSBwcm92aWRlZCB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gVGhlIGZpZWxkIHBhdGggdG8gc2V0LlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuXG4gICAgICovICAgIHNldChlLCB0KSB7XG4gICAgICAgIHRoaXMuZ2V0RmllbGRzTWFwKGUucG9wTGFzdCgpKVtlLmxhc3RTZWdtZW50KCldID0gX19QUklWQVRFX2RlZXBDbG9uZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgcHJvdmlkZWQgZmllbGRzIHRvIHRoZSBwcm92aWRlZCB2YWx1ZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGF0YSAtIEEgbWFwIG9mIGZpZWxkcyB0byB2YWx1ZXMgKG9yIG51bGwgZm9yIGRlbGV0ZXMpLlxuICAgICAqLyAgICBzZXRBbGwoZSkge1xuICAgICAgICBsZXQgdCA9IEZpZWxkUGF0aCQxLmVtcHR5UGF0aCgpLCBuID0ge30sIHIgPSBbXTtcbiAgICAgICAgZS5mb3JFYWNoKCgoZSwgaSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0LmlzSW1tZWRpYXRlUGFyZW50T2YoaSkpIHtcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYXQgdGhpcyBwYXJlbnQgbG9jYXRpb25cbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5nZXRGaWVsZHNNYXAodCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBseUNoYW5nZXMoZSwgbiwgciksIG4gPSB7fSwgciA9IFtdLCB0ID0gaS5wb3BMYXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlID8gbltpLmxhc3RTZWdtZW50KCldID0gX19QUklWQVRFX2RlZXBDbG9uZShlKSA6IHIucHVzaChpLmxhc3RTZWdtZW50KCkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLmdldEZpZWxkc01hcCh0KTtcbiAgICAgICAgdGhpcy5hcHBseUNoYW5nZXMoaSwgbiwgcik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIGZpZWxkIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4gSWYgdGhlcmUgaXMgbm8gZmllbGQgYXQgdGhlXG4gICAgICogc3BlY2lmaWVkIHBhdGgsIG5vdGhpbmcgaXMgY2hhbmdlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gVGhlIGZpZWxkIHBhdGggdG8gcmVtb3ZlLlxuICAgICAqLyAgICBkZWxldGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5maWVsZChlLnBvcExhc3QoKSk7XG4gICAgICAgIF9fUFJJVkFURV9pc01hcFZhbHVlKHQpICYmIHQubWFwVmFsdWUuZmllbGRzICYmIGRlbGV0ZSB0Lm1hcFZhbHVlLmZpZWxkc1tlLmxhc3RTZWdtZW50KCldO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWx1ZUVxdWFscyh0aGlzLnZhbHVlLCBlLnZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgbWFwIHRoYXQgY29udGFpbnMgdGhlIGxlYWYgZWxlbWVudCBvZiBgcGF0aGAuIElmIHRoZSBwYXJlbnRcbiAgICAgKiBlbnRyeSBkb2VzIG5vdCB5ZXQgZXhpc3QsIG9yIGlmIGl0IGlzIG5vdCBhIG1hcCwgYSBuZXcgbWFwIHdpbGwgYmUgY3JlYXRlZC5cbiAgICAgKi8gICAgZ2V0RmllbGRzTWFwKGUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLnZhbHVlO1xuICAgICAgICB0Lm1hcFZhbHVlLmZpZWxkcyB8fCAodC5tYXBWYWx1ZSA9IHtcbiAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGg7ICsrbikge1xuICAgICAgICAgICAgbGV0IHIgPSB0Lm1hcFZhbHVlLmZpZWxkc1tlLmdldChuKV07XG4gICAgICAgICAgICBfX1BSSVZBVEVfaXNNYXBWYWx1ZShyKSAmJiByLm1hcFZhbHVlLmZpZWxkcyB8fCAociA9IHtcbiAgICAgICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHt9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdC5tYXBWYWx1ZS5maWVsZHNbZS5nZXQobildID0gciksIHQgPSByO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0Lm1hcFZhbHVlLmZpZWxkcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogTW9kaWZpZXMgYGZpZWxkc01hcGAgYnkgYWRkaW5nLCByZXBsYWNpbmcgb3IgZGVsZXRpbmcgdGhlIHNwZWNpZmllZFxuICAgICAqIGVudHJpZXMuXG4gICAgICovICAgIGFwcGx5Q2hhbmdlcyhlLCB0LCBuKSB7XG4gICAgICAgIGZvckVhY2godCwgKCh0LCBuKSA9PiBlW3RdID0gbikpO1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgbikgZGVsZXRlIGVbdF07XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IE9iamVjdFZhbHVlKF9fUFJJVkFURV9kZWVwQ2xvbmUodGhpcy52YWx1ZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmllbGRNYXNrIGJ1aWx0IGZyb20gYWxsIGZpZWxkcyBpbiBhIE1hcFZhbHVlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9leHRyYWN0RmllbGRNYXNrKGUpIHtcbiAgICBjb25zdCB0ID0gW107XG4gICAgcmV0dXJuIGZvckVhY2goZS5maWVsZHMsICgoZSwgbikgPT4ge1xuICAgICAgICBjb25zdCByID0gbmV3IEZpZWxkUGF0aCQxKFsgZSBdKTtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9pc01hcFZhbHVlKG4pKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX2V4dHJhY3RGaWVsZE1hc2sobi5tYXBWYWx1ZSkuZmllbGRzO1xuICAgICAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSBcbiAgICAgICAgICAgIC8vIFByZXNlcnZlIHRoZSBlbXB0eSBtYXAgYnkgYWRkaW5nIGl0IHRvIHRoZSBGaWVsZE1hc2suXG4gICAgICAgICAgICB0LnB1c2gocik7IGVsc2UgXG4gICAgICAgICAgICAvLyBGb3IgbmVzdGVkIGFuZCBub24tZW1wdHkgT2JqZWN0VmFsdWVzLCBhZGQgdGhlIEZpZWxkUGF0aCBvZiB0aGVcbiAgICAgICAgICAgIC8vIGxlYWYgbm9kZXMuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdC5wdXNoKHIuY2hpbGQobikpO1xuICAgICAgICB9IGVsc2UgXG4gICAgICAgIC8vIEZvciBuZXN0ZWQgYW5kIG5vbi1lbXB0eSBPYmplY3RWYWx1ZXMsIGFkZCB0aGUgRmllbGRQYXRoIG9mIHRoZSBsZWFmXG4gICAgICAgIC8vIG5vZGVzLlxuICAgICAgICB0LnB1c2gocik7XG4gICAgfSkpLCBuZXcgRmllbGRNYXNrKHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgZG9jdW1lbnQgaW4gRmlyZXN0b3JlIHdpdGggYSBrZXksIHZlcnNpb24sIGRhdGEgYW5kIHdoZXRoZXIgaXRcbiAqIGhhcyBsb2NhbCBtdXRhdGlvbnMgYXBwbGllZCB0byBpdC5cbiAqXG4gKiBEb2N1bWVudHMgY2FuIHRyYW5zaXRpb24gYmV0d2VlbiBzdGF0ZXMgdmlhIGBjb252ZXJ0VG9Gb3VuZERvY3VtZW50KClgLFxuICogYGNvbnZlcnRUb05vRG9jdW1lbnQoKWAgYW5kIGBjb252ZXJ0VG9Vbmtub3duRG9jdW1lbnQoKWAuIElmIGEgZG9jdW1lbnQgZG9lc1xuICogbm90IHRyYW5zaXRpb24gdG8gb25lIG9mIHRoZXNlIHN0YXRlcyBldmVuIGFmdGVyIGFsbCBtdXRhdGlvbnMgaGF2ZSBiZWVuXG4gKiBhcHBsaWVkLCBgaXNWYWxpZERvY3VtZW50KClgIHJldHVybnMgZmFsc2UgYW5kIHRoZSBkb2N1bWVudCBzaG91bGQgYmUgcmVtb3ZlZFxuICogZnJvbSBhbGwgdmlld3MuXG4gKi8gY2xhc3MgTXV0YWJsZURvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpLCBzLCBvKSB7XG4gICAgICAgIHRoaXMua2V5ID0gZSwgdGhpcy5kb2N1bWVudFR5cGUgPSB0LCB0aGlzLnZlcnNpb24gPSBuLCB0aGlzLnJlYWRUaW1lID0gciwgdGhpcy5jcmVhdGVUaW1lID0gaSwgXG4gICAgICAgIHRoaXMuZGF0YSA9IHMsIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBkb2N1bWVudCB3aXRoIG5vIGtub3duIHZlcnNpb24gb3IgZGF0YSwgYnV0IHdoaWNoIGNhbiBzZXJ2ZSBhc1xuICAgICAqIGJhc2UgZG9jdW1lbnQgZm9yIG11dGF0aW9ucy5cbiAgICAgKi8gICAgc3RhdGljIG5ld0ludmFsaWREb2N1bWVudChlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXV0YWJsZURvY3VtZW50KGUsIDAgLyogRG9jdW1lbnRUeXBlLklOVkFMSUQgKi8gLCBcbiAgICAgICAgLyogdmVyc2lvbiAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiByZWFkVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiBjcmVhdGVUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgT2JqZWN0VmFsdWUuZW1wdHkoKSwgMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgZG9jdW1lbnQgdGhhdCBpcyBrbm93biB0byBleGlzdCB3aXRoIHRoZSBnaXZlbiBkYXRhIGF0IHRoZVxuICAgICAqIGdpdmVuIHZlcnNpb24uXG4gICAgICovICAgIHN0YXRpYyBuZXdGb3VuZERvY3VtZW50KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhYmxlRG9jdW1lbnQoZSwgMSAvKiBEb2N1bWVudFR5cGUuRk9VTkRfRE9DVU1FTlQgKi8gLCBcbiAgICAgICAgLyogdmVyc2lvbiAqLyB0LCBcbiAgICAgICAgLyogcmVhZFRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBuLCByLCAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgZG9jdW1lbnQgdGhhdCBpcyBrbm93biB0byBub3QgZXhpc3QgYXQgdGhlIGdpdmVuIHZlcnNpb24uICovICAgIHN0YXRpYyBuZXdOb0RvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhYmxlRG9jdW1lbnQoZSwgMiAvKiBEb2N1bWVudFR5cGUuTk9fRE9DVU1FTlQgKi8gLCBcbiAgICAgICAgLyogdmVyc2lvbiAqLyB0LCBcbiAgICAgICAgLyogcmVhZFRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIE9iamVjdFZhbHVlLmVtcHR5KCksIDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHRoYXQgaXMga25vd24gdG8gZXhpc3QgYXQgdGhlIGdpdmVuIHZlcnNpb24gYnV0XG4gICAgICogd2hvc2UgZGF0YSBpcyBub3Qga25vd24gKGUuZy4gYSBkb2N1bWVudCB0aGF0IHdhcyB1cGRhdGVkIHdpdGhvdXQgYSBrbm93blxuICAgICAqIGJhc2UgZG9jdW1lbnQpLlxuICAgICAqLyAgICBzdGF0aWMgbmV3VW5rbm93bkRvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhYmxlRG9jdW1lbnQoZSwgMyAvKiBEb2N1bWVudFR5cGUuVU5LTk9XTl9ET0NVTUVOVCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIHQsIFxuICAgICAgICAvKiByZWFkVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiBjcmVhdGVUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgT2JqZWN0VmFsdWUuZW1wdHkoKSwgMiAvKiBEb2N1bWVudFN0YXRlLkhBU19DT01NSVRURURfTVVUQVRJT05TICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGV4aXN0cyBhbmQgdGhhdCBpdHMgdmVyc2lvblxuICAgICAqIGFuZCBkYXRhIGFyZSBrbm93bi5cbiAgICAgKi8gICAgY29udmVydFRvRm91bmREb2N1bWVudChlLCB0KSB7XG4gICAgICAgIC8vIElmIGEgZG9jdW1lbnQgaXMgc3dpdGNoaW5nIHN0YXRlIGZyb20gYmVpbmcgYW4gaW52YWxpZCBvciBkZWxldGVkXG4gICAgICAgIC8vIGRvY3VtZW50IHRvIGEgdmFsaWQgKEZPVU5EX0RPQ1VNRU5UKSBkb2N1bWVudCwgZWl0aGVyIGR1ZSB0byByZWNlaXZpbmcgYW5cbiAgICAgICAgLy8gdXBkYXRlIGZyb20gV2F0Y2ggb3IgZHVlIHRvIGFwcGx5aW5nIGEgbG9jYWwgc2V0IG11dGF0aW9uIG9uIHRvcFxuICAgICAgICAvLyBvZiBhIGRlbGV0ZWQgZG9jdW1lbnQsIG91ciBiZXN0IGd1ZXNzIGFib3V0IGl0cyBjcmVhdGVUaW1lIHdvdWxkIGJlIHRoZVxuICAgICAgICAvLyB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBkb2N1bWVudCB0cmFuc2l0aW9uZWQgdG8gYSBGT1VORF9ET0NVTUVOVC5cbiAgICAgICAgcmV0dXJuICF0aGlzLmNyZWF0ZVRpbWUuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpIHx8IDIgLyogRG9jdW1lbnRUeXBlLk5PX0RPQ1VNRU5UICovICE9PSB0aGlzLmRvY3VtZW50VHlwZSAmJiAwIC8qIERvY3VtZW50VHlwZS5JTlZBTElEICovICE9PSB0aGlzLmRvY3VtZW50VHlwZSB8fCAodGhpcy5jcmVhdGVUaW1lID0gZSksIFxuICAgICAgICB0aGlzLnZlcnNpb24gPSBlLCB0aGlzLmRvY3VtZW50VHlwZSA9IDEgLyogRG9jdW1lbnRUeXBlLkZPVU5EX0RPQ1VNRU5UICovICwgdGhpcy5kYXRhID0gdCwgXG4gICAgICAgIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8gLCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBkb2N1bWVudCB0eXBlIHRvIGluZGljYXRlIHRoYXQgaXQgZG9lc24ndCBleGlzdCBhdCB0aGUgZ2l2ZW5cbiAgICAgKiB2ZXJzaW9uLlxuICAgICAqLyAgICBjb252ZXJ0VG9Ob0RvY3VtZW50KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmVyc2lvbiA9IGUsIHRoaXMuZG9jdW1lbnRUeXBlID0gMiAvKiBEb2N1bWVudFR5cGUuTk9fRE9DVU1FTlQgKi8gLCBcbiAgICAgICAgdGhpcy5kYXRhID0gT2JqZWN0VmFsdWUuZW1wdHkoKSwgdGhpcy5kb2N1bWVudFN0YXRlID0gMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyAsIFxuICAgICAgICB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBkb2N1bWVudCB0eXBlIHRvIGluZGljYXRlIHRoYXQgaXQgZXhpc3RzIGF0IGEgZ2l2ZW4gdmVyc2lvbiBidXRcbiAgICAgKiB0aGF0IGl0cyBkYXRhIGlzIG5vdCBrbm93biAoZS5nLiBhIGRvY3VtZW50IHRoYXQgd2FzIHVwZGF0ZWQgd2l0aG91dCBhIGtub3duXG4gICAgICogYmFzZSBkb2N1bWVudCkuXG4gICAgICovICAgIGNvbnZlcnRUb1Vua25vd25Eb2N1bWVudChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZlcnNpb24gPSBlLCB0aGlzLmRvY3VtZW50VHlwZSA9IDMgLyogRG9jdW1lbnRUeXBlLlVOS05PV05fRE9DVU1FTlQgKi8gLCBcbiAgICAgICAgdGhpcy5kYXRhID0gT2JqZWN0VmFsdWUuZW1wdHkoKSwgdGhpcy5kb2N1bWVudFN0YXRlID0gMiAvKiBEb2N1bWVudFN0YXRlLkhBU19DT01NSVRURURfTVVUQVRJT05TICovICwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIHNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyAsIHRoaXM7XG4gICAgfVxuICAgIHNldEhhc0xvY2FsTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudFN0YXRlID0gMSAvKiBEb2N1bWVudFN0YXRlLkhBU19MT0NBTF9NVVRBVElPTlMgKi8gLCB0aGlzLnZlcnNpb24gPSBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICB0aGlzO1xuICAgIH1cbiAgICBzZXRSZWFkVGltZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRUaW1lID0gZSwgdGhpcztcbiAgICB9XG4gICAgZ2V0IGhhc0xvY2FsTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gMSAvKiBEb2N1bWVudFN0YXRlLkhBU19MT0NBTF9NVVRBVElPTlMgKi8gPT09IHRoaXMuZG9jdW1lbnRTdGF0ZTtcbiAgICB9XG4gICAgZ2V0IGhhc0NvbW1pdHRlZE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyA9PT0gdGhpcy5kb2N1bWVudFN0YXRlO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzTG9jYWxNdXRhdGlvbnMgfHwgdGhpcy5oYXNDb21taXR0ZWRNdXRhdGlvbnM7XG4gICAgfVxuICAgIGlzVmFsaWREb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogRG9jdW1lbnRUeXBlLklOVkFMSUQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc0ZvdW5kRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAxIC8qIERvY3VtZW50VHlwZS5GT1VORF9ET0NVTUVOVCAqLyA9PT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzTm9Eb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogRG9jdW1lbnRUeXBlLk5PX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNVbmtub3duRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgTXV0YWJsZURvY3VtZW50ICYmIHRoaXMua2V5LmlzRXF1YWwoZS5rZXkpICYmIHRoaXMudmVyc2lvbi5pc0VxdWFsKGUudmVyc2lvbikgJiYgdGhpcy5kb2N1bWVudFR5cGUgPT09IGUuZG9jdW1lbnRUeXBlICYmIHRoaXMuZG9jdW1lbnRTdGF0ZSA9PT0gZS5kb2N1bWVudFN0YXRlICYmIHRoaXMuZGF0YS5pc0VxdWFsKGUuZGF0YSk7XG4gICAgfVxuICAgIG11dGFibGVDb3B5KCkge1xuICAgICAgICByZXR1cm4gbmV3IE11dGFibGVEb2N1bWVudCh0aGlzLmtleSwgdGhpcy5kb2N1bWVudFR5cGUsIHRoaXMudmVyc2lvbiwgdGhpcy5yZWFkVGltZSwgdGhpcy5jcmVhdGVUaW1lLCB0aGlzLmRhdGEuY2xvbmUoKSwgdGhpcy5kb2N1bWVudFN0YXRlKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBgRG9jdW1lbnQoJHt0aGlzLmtleX0sICR7dGhpcy52ZXJzaW9ufSwgJHtKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGEudmFsdWUpfSwge2NyZWF0ZVRpbWU6ICR7dGhpcy5jcmVhdGVUaW1lfX0pLCB7ZG9jdW1lbnRUeXBlOiAke3RoaXMuZG9jdW1lbnRUeXBlfX0pLCB7ZG9jdW1lbnRTdGF0ZTogJHt0aGlzLmRvY3VtZW50U3RhdGV9fSlgO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb21wYXJlcyB0aGUgdmFsdWUgZm9yIGZpZWxkIGBmaWVsZGAgaW4gdGhlIHByb3ZpZGVkIGRvY3VtZW50cy4gVGhyb3dzIGlmXG4gKiB0aGUgZmllbGQgZG9lcyBub3QgZXhpc3QgaW4gYm90aCBkb2N1bWVudHMuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBib3VuZCBvZiBhIHF1ZXJ5LlxuICpcbiAqIFRoZSBib3VuZCBpcyBzcGVjaWZpZWQgd2l0aCB0aGUgZ2l2ZW4gY29tcG9uZW50cyByZXByZXNlbnRpbmcgYSBwb3NpdGlvbiBhbmRcbiAqIHdoZXRoZXIgaXQncyBqdXN0IGJlZm9yZSBvciBqdXN0IGFmdGVyIHRoZSBwb3NpdGlvbiAocmVsYXRpdmUgdG8gd2hhdGV2ZXIgdGhlXG4gKiBxdWVyeSBvcmRlciBpcykuXG4gKlxuICogVGhlIHBvc2l0aW9uIHJlcHJlc2VudHMgYSBsb2dpY2FsIGluZGV4IHBvc2l0aW9uIGZvciBhIHF1ZXJ5LiBJdCdzIGEgcHJlZml4XG4gKiBvZiB2YWx1ZXMgZm9yIHRoZSAocG90ZW50aWFsbHkgaW1wbGljaXQpIG9yZGVyIGJ5IGNsYXVzZXMgb2YgYSBxdWVyeS5cbiAqXG4gKiBCb3VuZCBwcm92aWRlcyBhIGZ1bmN0aW9uIHRvIGRldGVybWluZSB3aGV0aGVyIGEgZG9jdW1lbnQgY29tZXMgYmVmb3JlIG9yXG4gKiBhZnRlciBhIGJvdW5kLiBUaGlzIGlzIGluZmx1ZW5jZWQgYnkgd2hldGhlciB0aGUgcG9zaXRpb24gaXMganVzdCBiZWZvcmUgb3JcbiAqIGp1c3QgYWZ0ZXIgdGhlIHByb3ZpZGVkIHZhbHVlcy5cbiAqL1xuY2xhc3MgQm91bmQge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGUsIHRoaXMuaW5jbHVzaXZlID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9ib3VuZENvbXBhcmVUb0RvY3VtZW50KGUsIHQsIG4pIHtcbiAgICBsZXQgciA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlLnBvc2l0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0W2ldLCBvID0gZS5wb3NpdGlvbltpXTtcbiAgICAgICAgaWYgKHMuZmllbGQuaXNLZXlGaWVsZCgpKSByID0gRG9jdW1lbnRLZXkuY29tcGFyYXRvcihEb2N1bWVudEtleS5mcm9tTmFtZShvLnJlZmVyZW5jZVZhbHVlKSwgbi5rZXkpOyBlbHNlIHtcbiAgICAgICAgICAgIHIgPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKG8sIG4uZGF0YS5maWVsZChzLmZpZWxkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovID09PSBzLmRpciAmJiAociAqPSAtMSksIDAgIT09IHIpIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gcjtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgYSBkb2N1bWVudCBzb3J0cyBhZnRlciBhIGJvdW5kIHVzaW5nIHRoZSBwcm92aWRlZCBzb3J0XG4gKiBvcmRlci5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYm91bmRFcXVhbHMoZSwgdCkge1xuICAgIGlmIChudWxsID09PSBlKSByZXR1cm4gbnVsbCA9PT0gdDtcbiAgICBpZiAobnVsbCA9PT0gdCkgcmV0dXJuICExO1xuICAgIGlmIChlLmluY2x1c2l2ZSAhPT0gdC5pbmNsdXNpdmUgfHwgZS5wb3NpdGlvbi5sZW5ndGggIT09IHQucG9zaXRpb24ubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLnBvc2l0aW9uLmxlbmd0aDsgbisrKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX3ZhbHVlRXF1YWxzKGUucG9zaXRpb25bbl0sIHQucG9zaXRpb25bbl0pKSByZXR1cm4gITE7XG4gICAgfVxuICAgIHJldHVybiAhMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gb3JkZXJpbmcgb24gYSBmaWVsZCwgaW4gc29tZSBEaXJlY3Rpb24uIERpcmVjdGlvbiBkZWZhdWx0cyB0byBBU0NFTkRJTkcuXG4gKi8gY2xhc3MgT3JkZXJCeSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCA9IFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLykge1xuICAgICAgICB0aGlzLmZpZWxkID0gZSwgdGhpcy5kaXIgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX29yZGVyQnlFcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBlLmRpciA9PT0gdC5kaXIgJiYgZS5maWVsZC5pc0VxdWFsKHQuZmllbGQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBGaWx0ZXIge31cblxuY2xhc3MgRmllbGRGaWx0ZXIgZXh0ZW5kcyBGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maWVsZCA9IGUsIHRoaXMub3AgPSB0LCB0aGlzLnZhbHVlID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGZpbHRlciBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgYXJndW1lbnRzLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIGUuaXNLZXlGaWVsZCgpID8gXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSB0IHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSB0ID8gdGhpcy5jcmVhdGVLZXlGaWVsZEluRmlsdGVyKGUsIHQsIG4pIDogbmV3IF9fUFJJVkFURV9LZXlGaWVsZEZpbHRlcihlLCB0LCBuKSA6IFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gdCA/IG5ldyBfX1BSSVZBVEVfQXJyYXlDb250YWluc0ZpbHRlcihlLCBuKSA6IFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gdCA/IG5ldyBfX1BSSVZBVEVfSW5GaWx0ZXIoZSwgbikgOiBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gdCA/IG5ldyBfX1BSSVZBVEVfTm90SW5GaWx0ZXIoZSwgbikgOiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gdCA/IG5ldyBfX1BSSVZBVEVfQXJyYXlDb250YWluc0FueUZpbHRlcihlLCBuKSA6IG5ldyBGaWVsZEZpbHRlcihlLCB0LCBuKTtcbiAgICB9XG4gICAgc3RhdGljIGNyZWF0ZUtleUZpZWxkSW5GaWx0ZXIoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSB0ID8gbmV3IF9fUFJJVkFURV9LZXlGaWVsZEluRmlsdGVyKGUsIG4pIDogbmV3IF9fUFJJVkFURV9LZXlGaWVsZE5vdEluRmlsdGVyKGUsIG4pO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgLy8gVHlwZXMgZG8gbm90IGhhdmUgdG8gbWF0Y2ggaW4gTk9UX0VRVUFMIGZpbHRlcnMuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gPT09IHRoaXMub3AgPyBudWxsICE9PSB0ICYmIHRoaXMubWF0Y2hlc0NvbXBhcmlzb24oX19QUklWQVRFX3ZhbHVlQ29tcGFyZSh0LCB0aGlzLnZhbHVlKSkgOiBudWxsICE9PSB0ICYmIF9fUFJJVkFURV90eXBlT3JkZXIodGhpcy52YWx1ZSkgPT09IF9fUFJJVkFURV90eXBlT3JkZXIodCkgJiYgdGhpcy5tYXRjaGVzQ29tcGFyaXNvbihfX1BSSVZBVEVfdmFsdWVDb21wYXJlKHQsIHRoaXMudmFsdWUpKTtcbiAgICAgICAgLy8gT25seSBjb21wYXJlIHR5cGVzIHdpdGggbWF0Y2hpbmcgYmFja2VuZCBvcmRlciAoc3VjaCBhcyBkb3VibGUgYW5kIGludCkuXG4gICAgICAgIH1cbiAgICBtYXRjaGVzQ29tcGFyaXNvbihlKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5vcCkge1xuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICAgIHJldHVybiBlIDwgMDtcblxuICAgICAgICAgIGNhc2UgXCI8PVwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZSA8PSAwO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIDAgPT09IGU7XG5cbiAgICAgICAgICBjYXNlIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIDAgIT09IGU7XG5cbiAgICAgICAgICBjYXNlIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZSA+IDA7XG5cbiAgICAgICAgICBjYXNlIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIGUgPj0gMDtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzSW5lcXVhbGl0eSgpIHtcbiAgICAgICAgcmV0dXJuIFsgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovICwgXCI8PVwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTl9PUl9FUVVBTCAqLyAsIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyAsIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXS5pbmRleE9mKHRoaXMub3ApID49IDA7XG4gICAgfVxuICAgIGdldEZsYXR0ZW5lZEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMgXTtcbiAgICB9XG4gICAgZ2V0RmlsdGVycygpIHtcbiAgICAgICAgcmV0dXJuIFsgdGhpcyBdO1xuICAgIH1cbiAgICBnZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNJbmVxdWFsaXR5KCkgPyB0aGlzLmZpZWxkIDogbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIENvbXBvc2l0ZUZpbHRlciBleHRlbmRzIEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpbHRlcnMgPSBlLCB0aGlzLm9wID0gdCwgdGhpcy5jZSA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmaWx0ZXIgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGFyZ3VtZW50cy5cbiAgICAgKi8gICAgc3RhdGljIGNyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29tcG9zaXRlRmlsdGVyKGUsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKHRoaXMpID8gdm9pZCAwID09PSB0aGlzLmZpbHRlcnMuZmluZCgodCA9PiAhdC5tYXRjaGVzKGUpKSkgOiB2b2lkIDAgIT09IHRoaXMuZmlsdGVycy5maW5kKCh0ID0+IHQubWF0Y2hlcyhlKSkpO1xuICAgIH1cbiAgICBnZXRGbGF0dGVuZWRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5jZSB8fCAodGhpcy5jZSA9IHRoaXMuZmlsdGVycy5yZWR1Y2UoKChlLCB0KSA9PiBlLmNvbmNhdCh0LmdldEZsYXR0ZW5lZEZpbHRlcnMoKSkpLCBbXSkpLCBcbiAgICAgICAgdGhpcy5jZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIG11dGFibGUgY29weSBvZiBgdGhpcy5maWx0ZXJzYFxuICAgIGdldEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFtdLCB0aGlzLmZpbHRlcnMpO1xuICAgIH1cbiAgICBnZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMubGUoKGUgPT4gZS5pc0luZXF1YWxpdHkoKSkpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZSA/IGUuZmllbGQgOiBudWxsO1xuICAgIH1cbiAgICAvLyBQZXJmb3JtcyBhIGRlcHRoLWZpcnN0IHNlYXJjaCB0byBmaW5kIGFuZCByZXR1cm4gdGhlIGZpcnN0IEZpZWxkRmlsdGVyIGluIHRoZSBjb21wb3NpdGUgZmlsdGVyXG4gICAgLy8gdGhhdCBzYXRpc2ZpZXMgdGhlIHByZWRpY2F0ZS4gUmV0dXJucyBgbnVsbGAgaWYgbm9uZSBvZiB0aGUgRmllbGRGaWx0ZXJzIHNhdGlzZnkgdGhlXG4gICAgLy8gcHJlZGljYXRlLlxuICAgIGxlKGUpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMuZ2V0RmxhdHRlbmVkRmlsdGVycygpKSBpZiAoZSh0KSkgcmV0dXJuIHQ7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzQ29uanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyA9PT0gZS5vcDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRGlzanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gPT09IGUub3A7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZmlsdGVyIGlzIGEgY29uanVuY3Rpb24gb2YgZmllbGQgZmlsdGVycyBvbmx5LiBSZXR1cm5zIGZhbHNlIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0KGUpICYmIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpbHRlciBkb2VzIG5vdCBjb250YWluIGFueSBjb21wb3NpdGUgZmlsdGVycy4gUmV0dXJucyBmYWxzZSBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdChlKSB7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuZmlsdGVycykgaWYgKHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpIHJldHVybiAhMTtcbiAgICByZXR1cm4gITA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeUZpbHRlcihlKSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlcikgXG4gICAgLy8gVE9ETyhiLzI5MTgzMTY1KTogVGVjaG5pY2FsbHksIHRoaXMgd29uJ3QgYmUgdW5pcXVlIGlmIHR3byB2YWx1ZXMgaGF2ZVxuICAgIC8vIHRoZSBzYW1lIGRlc2NyaXB0aW9uLCBzdWNoIGFzIHRoZSBpbnQgMyBhbmQgdGhlIHN0cmluZyBcIjNcIi4gU28gd2Ugc2hvdWxkXG4gICAgLy8gYWRkIHRoZSB0eXBlcyBpbiBoZXJlIHNvbWVob3csIHRvby5cbiAgICByZXR1cm4gZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSArIGUub3AudG9TdHJpbmcoKSArIGNhbm9uaWNhbElkKGUudmFsdWUpO1xuICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24oZSkpIFxuICAgIC8vIE9sZGVyIFNESyB2ZXJzaW9ucyB1c2UgYW4gaW1wbGljaXQgQU5EIG9wZXJhdGlvbiBiZXR3ZWVuIHRoZWlyIGZpbHRlcnMuXG4gICAgLy8gSW4gdGhlIG5ldyBTREsgdmVyc2lvbnMsIHRoZSBkZXZlbG9wZXIgbWF5IHVzZSBhbiBleHBsaWNpdCBBTkQgZmlsdGVyLlxuICAgIC8vIFRvIHN0YXkgY29uc2lzdGVudCB3aXRoIHRoZSBvbGQgdXNhZ2VzLCB3ZSBhZGQgYSBzcGVjaWFsIGNhc2UgdG8gZW5zdXJlXG4gICAgLy8gdGhlIGNhbm9uaWNhbCBJRCBmb3IgdGhlc2UgdHdvIGFyZSB0aGUgc2FtZS4gRm9yIGV4YW1wbGU6XG4gICAgLy8gYGNvbC53aGVyZUVxdWFscyhcImFcIiwgMSkud2hlcmVFcXVhbHMoXCJiXCIsIDIpYCBzaG91bGQgaGF2ZSB0aGUgc2FtZVxuICAgIC8vIGNhbm9uaWNhbCBJRCBhcyBgY29sLndoZXJlKGFuZChlcXVhbHMoXCJhXCIsMSksIGVxdWFscyhcImJcIiwyKSkpYC5cbiAgICByZXR1cm4gZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKTtcbiAgICB7XG4gICAgICAgIC8vIGZpbHRlciBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlclxuICAgICAgICBjb25zdCB0ID0gZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKTtcbiAgICAgICAgcmV0dXJuIGAke2Uub3B9KCR7dH0pYDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRGaWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyICYmIGUub3AgPT09IHQub3AgJiYgZS5maWVsZC5pc0VxdWFsKHQuZmllbGQpICYmIF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLnZhbHVlLCB0LnZhbHVlKTtcbiAgICB9KGUsIHQpIDogZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBlLm9wID09PSB0Lm9wICYmIGUuZmlsdGVycy5sZW5ndGggPT09IHQuZmlsdGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBlLmZpbHRlcnMucmVkdWNlKCgoZSwgbiwgcikgPT4gZSAmJiBfX1BSSVZBVEVfZmlsdGVyRXF1YWxzKG4sIHQuZmlsdGVyc1tyXSkpLCAhMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAqIFJldHVybnMgYSBuZXcgY29tcG9zaXRlIGZpbHRlciB0aGF0IGNvbnRhaW5zIGFsbCBmaWx0ZXIgZnJvbVxuICogYGNvbXBvc2l0ZUZpbHRlcmAgcGx1cyBhbGwgdGhlIGdpdmVuIGZpbHRlcnMgaW4gYG90aGVyRmlsdGVyc2AuXG4gKi8gKGUsIHQpIDogdm9pZCBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZS5maWx0ZXJzLmNvbmNhdCh0KTtcbiAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShuLCBlLm9wKTtcbn1cblxuLyoqIFJldHVybnMgYSBkZWJ1ZyBkZXNjcmlwdGlvbiBmb3IgYGZpbHRlcmAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zdHJpbmdpZnlGaWx0ZXIoZSkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5RmllbGRGaWx0ZXIoZSkge1xuICAgICAgICByZXR1cm4gYCR7ZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKX0gJHtlLm9wfSAke2Nhbm9uaWNhbElkKGUudmFsdWUpfWA7XG4gICAgfVxuICAgIC8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgKGkuZS4gJ19fbmFtZV9fJykuICovIChlKSA6IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5Q29tcG9zaXRlRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGUub3AudG9TdHJpbmcoKSArIFwiIHtcIiArIGUuZ2V0RmlsdGVycygpLm1hcChfX1BSSVZBVEVfc3RyaW5naWZ5RmlsdGVyKS5qb2luKFwiICxcIikgKyBcIn1cIjtcbiAgICB9KGUpIDogXCJGaWx0ZXJcIjtcbn1cblxuY2xhc3MgX19QUklWQVRFX0tleUZpZWxkRmlsdGVyIGV4dGVuZHMgRmllbGRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoZSwgdCwgbiksIHRoaXMua2V5ID0gRG9jdW1lbnRLZXkuZnJvbU5hbWUobi5yZWZlcmVuY2VWYWx1ZSk7XG4gICAgfVxuICAgIG1hdGNoZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmtleSwgdGhpcy5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRjaGVzQ29tcGFyaXNvbih0KTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBfX1BSSVZBVEVfS2V5RmllbGRJbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpLCB0aGlzLmtleXMgPSBfX1BSSVZBVEVfZXh0cmFjdERvY3VtZW50S2V5c0Zyb21BcnJheVZhbHVlKFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2V5cy5zb21lKCh0ID0+IHQuaXNFcXVhbChlLmtleSkpKTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgbm90IHByZXNlbnQgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBfX1BSSVZBVEVfS2V5RmllbGROb3RJbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICwgdCksIHRoaXMua2V5cyA9IF9fUFJJVkFURV9leHRyYWN0RG9jdW1lbnRLZXlzRnJvbUFycmF5VmFsdWUoXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5rZXlzLnNvbWUoKHQgPT4gdC5pc0VxdWFsKGUua2V5KSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V4dHJhY3REb2N1bWVudEtleXNGcm9tQXJyYXlWYWx1ZShlLCB0KSB7XG4gICAgdmFyIG47XG4gICAgcmV0dXJuICgobnVsbCA9PT0gKG4gPSB0LmFycmF5VmFsdWUpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4udmFsdWVzKSB8fCBbXSkubWFwKChlID0+IERvY3VtZW50S2V5LmZyb21OYW1lKGUucmVmZXJlbmNlVmFsdWUpKSk7XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIGFycmF5LWNvbnRhaW5zIG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfQXJyYXlDb250YWluc0ZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIGlzQXJyYXkodCkgJiYgX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0LmFycmF5VmFsdWUsIHRoaXMudmFsdWUpO1xuICAgIH1cbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgSU4gb3BlcmF0b3IuICovIGNsYXNzIF9fUFJJVkFURV9JbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHQgJiYgX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIHQpO1xuICAgIH1cbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgbm90LWluIG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfTm90SW5GaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnModGhpcy52YWx1ZS5hcnJheVZhbHVlLCB7XG4gICAgICAgICAgICBudWxsVmFsdWU6IFwiTlVMTF9WQUxVRVwiXG4gICAgICAgIH0pKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0ICYmICFfX1BSSVZBVEVfYXJyYXlWYWx1ZUNvbnRhaW5zKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwgdCk7XG4gICAgfVxufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBhcnJheS1jb250YWlucy1hbnkgb3BlcmF0b3IuICovIGNsYXNzIF9fUFJJVkFURV9BcnJheUNvbnRhaW5zQW55RmlsdGVyIGV4dGVuZHMgRmllbGRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoZSwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiAhKCFpc0FycmF5KHQpIHx8ICF0LmFycmF5VmFsdWUudmFsdWVzKSAmJiB0LmFycmF5VmFsdWUudmFsdWVzLnNvbWUoKGUgPT4gX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIGUpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX1RhcmdldEltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBudWxsLCBvID0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhdGggPSBlLCB0aGlzLmNvbGxlY3Rpb25Hcm91cCA9IHQsIHRoaXMub3JkZXJCeSA9IG4sIHRoaXMuZmlsdGVycyA9IHIsIHRoaXMubGltaXQgPSBpLCBcbiAgICAgICAgdGhpcy5zdGFydEF0ID0gcywgdGhpcy5lbmRBdCA9IG8sIHRoaXMuaGUgPSBudWxsO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhIFRhcmdldCB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAqIFBhdGggbXVzdCBjdXJyZW50bHkgYmUgZW1wdHkgaWYgdGhpcyBpcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkuXG4gKlxuICogTk9URTogeW91IHNob3VsZCBhbHdheXMgY29uc3RydWN0IGBUYXJnZXRgIGZyb20gYFF1ZXJ5LnRvVGFyZ2V0YCBpbnN0ZWFkIG9mXG4gKiB1c2luZyB0aGlzIGZhY3RvcnkgbWV0aG9kLCBiZWNhdXNlIGBRdWVyeWAgcHJvdmlkZXMgYW4gaW1wbGljaXQgYG9yZGVyQnlgXG4gKiBwcm9wZXJ0eS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3VGFyZ2V0KGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBudWxsLCBvID0gbnVsbCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1RhcmdldEltcGwoZSwgdCwgbiwgciwgaSwgcywgbyk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKG51bGwgPT09IHQuaGUpIHtcbiAgICAgICAgbGV0IGUgPSB0LnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwICYmIChlICs9IFwifGNnOlwiICsgdC5jb2xsZWN0aW9uR3JvdXApLCBlICs9IFwifGY6XCIsIGUgKz0gdC5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKSwgXG4gICAgICAgIGUgKz0gXCJ8b2I6XCIsIGUgKz0gdC5vcmRlckJ5Lm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlPcmRlckJ5KGUpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oYi8yOTE4MzE2NSk6IE1ha2UgdGhpcyBjb2xsaXNpb24gcm9idXN0LlxuICAgICAgICAgICAgcmV0dXJuIGUuZmllbGQuY2Fub25pY2FsU3RyaW5nKCkgKyBlLmRpcjtcbiAgICAgICAgfShlKSkpLmpvaW4oXCIsXCIpLCBfX1BSSVZBVEVfaXNOdWxsT3JVbmRlZmluZWQodC5saW1pdCkgfHwgKGUgKz0gXCJ8bDpcIiwgZSArPSB0LmxpbWl0KSwgXG4gICAgICAgIHQuc3RhcnRBdCAmJiAoZSArPSBcInxsYjpcIiwgZSArPSB0LnN0YXJ0QXQuaW5jbHVzaXZlID8gXCJiOlwiIDogXCJhOlwiLCBlICs9IHQuc3RhcnRBdC5wb3NpdGlvbi5tYXAoKGUgPT4gY2Fub25pY2FsSWQoZSkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICB0LmVuZEF0ICYmIChlICs9IFwifHViOlwiLCBlICs9IHQuZW5kQXQuaW5jbHVzaXZlID8gXCJhOlwiIDogXCJiOlwiLCBlICs9IHQuZW5kQXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBcbiAgICAgICAgdC5oZSA9IGU7XG4gICAgfVxuICAgIHJldHVybiB0LmhlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKGUsIHQpIHtcbiAgICBpZiAoZS5saW1pdCAhPT0gdC5saW1pdCkgcmV0dXJuICExO1xuICAgIGlmIChlLm9yZGVyQnkubGVuZ3RoICE9PSB0Lm9yZGVyQnkubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLm9yZGVyQnkubGVuZ3RoOyBuKyspIGlmICghX19QUklWQVRFX29yZGVyQnlFcXVhbHMoZS5vcmRlckJ5W25dLCB0Lm9yZGVyQnlbbl0pKSByZXR1cm4gITE7XG4gICAgaWYgKGUuZmlsdGVycy5sZW5ndGggIT09IHQuZmlsdGVycy5sZW5ndGgpIHJldHVybiAhMTtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUuZmlsdGVycy5sZW5ndGg7IG4rKykgaWYgKCFfX1BSSVZBVEVfZmlsdGVyRXF1YWxzKGUuZmlsdGVyc1tuXSwgdC5maWx0ZXJzW25dKSkgcmV0dXJuICExO1xuICAgIHJldHVybiBlLmNvbGxlY3Rpb25Hcm91cCA9PT0gdC5jb2xsZWN0aW9uR3JvdXAgJiYgKCEhZS5wYXRoLmlzRXF1YWwodC5wYXRoKSAmJiAoISFfX1BSSVZBVEVfYm91bmRFcXVhbHMoZS5zdGFydEF0LCB0LnN0YXJ0QXQpICYmIF9fUFJJVkFURV9ib3VuZEVxdWFscyhlLmVuZEF0LCB0LmVuZEF0KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0SXNEb2N1bWVudFRhcmdldChlKSB7XG4gICAgcmV0dXJuIERvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoZS5wYXRoKSAmJiBudWxsID09PSBlLmNvbGxlY3Rpb25Hcm91cCAmJiAwID09PSBlLmZpbHRlcnMubGVuZ3RoO1xufVxuXG4vKiogUmV0dXJucyB0aGUgZmllbGQgZmlsdGVycyB0aGF0IHRhcmdldCB0aGUgZ2l2ZW4gZmllbGQgcGF0aC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldEZpZWxkRmlsdGVyc0ZvclBhdGgoZSwgdCkge1xuICAgIHJldHVybiBlLmZpbHRlcnMuZmlsdGVyKChlID0+IGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciAmJiBlLmZpZWxkLmlzRXF1YWwodCkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZXMgdGhhdCBhcmUgdXNlZCBpbiBBUlJBWV9DT05UQUlOUyBvciBBUlJBWV9DT05UQUlOU19BTllcbiAqIGZpbHRlcnMuIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyBzdWNoIGZpbHRlcnMuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWUgdG8gdXNlIGFzIHRoZSBsb3dlciBib3VuZCBmb3IgYXNjZW5kaW5nIGluZGV4IHNlZ21lbnQgYXRcbiAqIHRoZSBwcm92aWRlZCBgZmllbGRQYXRoYCAob3IgdGhlIHVwcGVyIGJvdW5kIGZvciBhbiBkZXNjZW5kaW5nIHNlZ21lbnQpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0QXNjZW5kaW5nQm91bmQoZSwgdCwgbikge1xuICAgIGxldCByID0gcmUsIGkgPSAhMDtcbiAgICAvLyBQcm9jZXNzIGFsbCBmaWx0ZXJzIHRvIGZpbmQgYSB2YWx1ZSBmb3IgdGhlIGN1cnJlbnQgZmllbGQgc2VnbWVudFxuICAgIGZvciAoY29uc3QgbiBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCB0KSkge1xuICAgICAgICBsZXQgZSA9IHJlLCB0ID0gITA7XG4gICAgICAgIHN3aXRjaCAobi5vcCkge1xuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgZSA9IF9fUFJJVkFURV92YWx1ZXNHZXRMb3dlckJvdW5kKG4udmFsdWUpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gOlxuICAgICAgICAgIGNhc2UgXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICBlID0gbi52YWx1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgZSA9IG4udmFsdWUsIHQgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIDpcbiAgICAgICAgICAgIGUgPSByZTtcbiAvLyBSZW1haW5pbmcgZmlsdGVycyBjYW5ub3QgYmUgdXNlZCBhcyBsb3dlciBib3VuZHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICBfX1BSSVZBVEVfbG93ZXJCb3VuZENvbXBhcmUoe1xuICAgICAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IHRcbiAgICAgICAgfSkgPCAwICYmIChyID0gZSwgaSA9IHQpO1xuICAgIH1cbiAgICAvLyBJZiB0aGVyZSBpcyBhbiBhZGRpdGlvbmFsIGJvdW5kLCBjb21wYXJlIHRoZSB2YWx1ZXMgYWdhaW5zdCB0aGUgZXhpc3RpbmdcbiAgICAvLyByYW5nZSB0byBzZWUgaWYgd2UgY2FuIG5hcnJvdyB0aGUgc2NvcGUuXG4gICAgICAgIGlmIChudWxsICE9PSBuKSBmb3IgKGxldCBzID0gMDsgcyA8IGUub3JkZXJCeS5sZW5ndGg7ICsrcykge1xuICAgICAgICBpZiAoZS5vcmRlckJ5W3NdLmZpZWxkLmlzRXF1YWwodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuLnBvc2l0aW9uW3NdO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvd2VyQm91bmRDb21wYXJlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogZSxcbiAgICAgICAgICAgICAgICBpbmNsdXNpdmU6IG4uaW5jbHVzaXZlXG4gICAgICAgICAgICB9KSA8IDAgJiYgKHIgPSBlLCBpID0gbi5pbmNsdXNpdmUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgIGluY2x1c2l2ZTogaVxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWUgdG8gdXNlIGFzIHRoZSB1cHBlciBib3VuZCBmb3IgYXNjZW5kaW5nIGluZGV4IHNlZ21lbnQgYXRcbiAqIHRoZSBwcm92aWRlZCBgZmllbGRQYXRoYCAob3IgdGhlIGxvd2VyIGJvdW5kIGZvciBhIGRlc2NlbmRpbmcgc2VnbWVudCkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldERlc2NlbmRpbmdCb3VuZChlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBuZSwgaSA9ICEwO1xuICAgIC8vIFByb2Nlc3MgYWxsIGZpbHRlcnMgdG8gZmluZCBhIHZhbHVlIGZvciB0aGUgY3VycmVudCBmaWVsZCBzZWdtZW50XG4gICAgZm9yIChjb25zdCBuIG9mIF9fUFJJVkFURV90YXJnZXRHZXRGaWVsZEZpbHRlcnNGb3JQYXRoKGUsIHQpKSB7XG4gICAgICAgIGxldCBlID0gbmUsIHQgPSAhMDtcbiAgICAgICAgc3dpdGNoIChuLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyA6XG4gICAgICAgICAgICBlID0gX19QUklWQVRFX3ZhbHVlc0dldFVwcGVyQm91bmQobi52YWx1ZSksIHQgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgZSA9IG4udmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICAgIGUgPSBuLnZhbHVlLCB0ID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICBlID0gbmU7XG4gLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgdXBwZXIgYm91bmRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgX19QUklWQVRFX3VwcGVyQm91bmRDb21wYXJlKHtcbiAgICAgICAgICAgIHZhbHVlOiByLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHZhbHVlOiBlLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiB0XG4gICAgICAgIH0pID4gMCAmJiAociA9IGUsIGkgPSB0KTtcbiAgICB9XG4gICAgLy8gSWYgdGhlcmUgaXMgYW4gYWRkaXRpb25hbCBib3VuZCwgY29tcGFyZSB0aGUgdmFsdWVzIGFnYWluc3QgdGhlIGV4aXN0aW5nXG4gICAgLy8gcmFuZ2UgdG8gc2VlIGlmIHdlIGNhbiBuYXJyb3cgdGhlIHNjb3BlLlxuICAgICAgICBpZiAobnVsbCAhPT0gbikgZm9yIChsZXQgcyA9IDA7IHMgPCBlLm9yZGVyQnkubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgaWYgKGUub3JkZXJCeVtzXS5maWVsZC5pc0VxdWFsKHQpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbi5wb3NpdGlvbltzXTtcbiAgICAgICAgICAgIF9fUFJJVkFURV91cHBlckJvdW5kQ29tcGFyZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBuLmluY2x1c2l2ZVxuICAgICAgICAgICAgfSkgPiAwICYmIChyID0gZSwgaSA9IG4uaW5jbHVzaXZlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByLFxuICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICB9O1xufVxuXG4vKiogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNlZ21lbnRzIG9mIGEgcGVyZmVjdCBpbmRleCBmb3IgdGhpcyB0YXJnZXQuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBRdWVyeSBlbmNhcHN1bGF0ZXMgYWxsIHRoZSBxdWVyeSBhdHRyaWJ1dGVzIHdlIHN1cHBvcnQgaW4gdGhlIFNESy4gSXQgY2FuXG4gKiBiZSBydW4gYWdhaW5zdCB0aGUgTG9jYWxTdG9yZSwgYXMgd2VsbCBhcyBiZSBjb252ZXJ0ZWQgdG8gYSBgVGFyZ2V0YCB0b1xuICogcXVlcnkgdGhlIFJlbW90ZVN0b3JlIHJlc3VsdHMuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5SW1wbCB7XG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYSBRdWVyeSB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAgICAgKiBQYXRoIG11c3QgY3VycmVudGx5IGJlIGVtcHR5IGlmIHRoaXMgaXMgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gLCBvID0gbnVsbCwgXyA9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gZSwgdGhpcy5jb2xsZWN0aW9uR3JvdXAgPSB0LCB0aGlzLmV4cGxpY2l0T3JkZXJCeSA9IG4sIHRoaXMuZmlsdGVycyA9IHIsIFxuICAgICAgICB0aGlzLmxpbWl0ID0gaSwgdGhpcy5saW1pdFR5cGUgPSBzLCB0aGlzLnN0YXJ0QXQgPSBvLCB0aGlzLmVuZEF0ID0gXywgdGhpcy5QZSA9IG51bGwsIFxuICAgICAgICAvLyBUaGUgY29ycmVzcG9uZGluZyBgVGFyZ2V0YCBvZiB0aGlzIGBRdWVyeWAgaW5zdGFuY2UuXG4gICAgICAgIHRoaXMuSWUgPSBudWxsLCB0aGlzLnN0YXJ0QXQsIHRoaXMuZW5kQXQ7XG4gICAgfVxufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBRdWVyeSBpbnN0YW5jZSB3aXRoIHRoZSBvcHRpb25zIHByb3ZpZGVkLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnkoZSwgdCwgbiwgciwgaSwgcywgbywgXykge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLCB0LCBuLCByLCBpLCBzLCBvLCBfKTtcbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgUXVlcnkgZm9yIGEgcXVlcnkgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgYXQgYHBhdGhgICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gY29udmVydCBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkgaW50byBhIGNvbGxlY3Rpb24gcXVlcnkgYXQgYVxuICogc3BlY2lmaWMgcGF0aC4gVGhpcyBpcyB1c2VkIHdoZW4gZXhlY3V0aW5nIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcmllcywgc2luY2VcbiAqIHdlIGhhdmUgdG8gc3BsaXQgdGhlIHF1ZXJ5IGludG8gYSBzZXQgb2YgY29sbGVjdGlvbiBxdWVyaWVzIGF0IG11bHRpcGxlXG4gKiBwYXRocy5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBxdWVyeSBkb2VzIG5vdCBzcGVjaWZ5IGFueSBxdWVyeSBjb25zdHJhaW50cyB0aGF0XG4gKiBjb3VsZCByZW1vdmUgcmVzdWx0cy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0FsbERvY3VtZW50cyhlKSB7XG4gICAgcmV0dXJuIDAgPT09IGUuZmlsdGVycy5sZW5ndGggJiYgbnVsbCA9PT0gZS5saW1pdCAmJiBudWxsID09IGUuc3RhcnRBdCAmJiBudWxsID09IGUuZW5kQXQgJiYgKDAgPT09IGUuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCB8fCAxID09PSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggJiYgZS5leHBsaWNpdE9yZGVyQnlbMF0uZmllbGQuaXNLZXlGaWVsZCgpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldEZpcnN0T3JkZXJCeUZpZWxkKGUpIHtcbiAgICByZXR1cm4gZS5leHBsaWNpdE9yZGVyQnkubGVuZ3RoID4gMCA/IGUuZXhwbGljaXRPcmRlckJ5WzBdLmZpZWxkIDogbnVsbDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldEluZXF1YWxpdHlGaWx0ZXJGaWVsZChlKSB7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuZmlsdGVycykge1xuICAgICAgICBjb25zdCBlID0gdC5nZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpO1xuICAgICAgICBpZiAobnVsbCAhPT0gZSkgcmV0dXJuIGU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgUXVlcnkgZm9yIGEgY29sbGVjdGlvbiBncm91cCBxdWVyeSB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50c1xuICogd2l0aGluIHRoZSBwcm92aWRlZCBjb2xsZWN0aW9uIGdyb3VwLlxuICovXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgcXVlcnkgbWF0Y2hlcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcmF0aGVyIHRoYW4gYSBzcGVjaWZpY1xuICogY29sbGVjdGlvbi5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2lzQ29sbGVjdGlvbkdyb3VwUXVlcnkoZSkge1xuICAgIHJldHVybiBudWxsICE9PSBlLmNvbGxlY3Rpb25Hcm91cDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBpbXBsaWNpdCBvcmRlciBieSBjb25zdHJhaW50IHRoYXQgaXMgdXNlZCB0byBleGVjdXRlIHRoZSBRdWVyeSxcbiAqIHdoaWNoIGNhbiBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb3JkZXIgYnkgY29uc3RyYWludHMgdGhlIHVzZXIgcHJvdmlkZWQgKGUuZy5cbiAqIHRoZSBTREsgYW5kIGJhY2tlbmQgYWx3YXlzIG9yZGVycyBieSBgX19uYW1lX19gKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlPcmRlckJ5KGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBpZiAobnVsbCA9PT0gdC5QZSkge1xuICAgICAgICB0LlBlID0gW107XG4gICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZ2V0SW5lcXVhbGl0eUZpbHRlckZpZWxkKHQpLCBuID0gX19QUklWQVRFX2dldEZpcnN0T3JkZXJCeUZpZWxkKHQpO1xuICAgICAgICBpZiAobnVsbCAhPT0gZSAmJiBudWxsID09PSBuKSBcbiAgICAgICAgLy8gSW4gb3JkZXIgdG8gaW1wbGljaXRseSBhZGQga2V5IG9yZGVyaW5nLCB3ZSBtdXN0IGFsc28gYWRkIHRoZVxuICAgICAgICAvLyBpbmVxdWFsaXR5IGZpbHRlciBmaWVsZCBmb3IgaXQgdG8gYmUgYSB2YWxpZCBxdWVyeS5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBkZWZhdWx0IGluZXF1YWxpdHkgZmllbGQgYW5kIGtleSBvcmRlcmluZyBpcyBhc2NlbmRpbmcuXG4gICAgICAgIGUuaXNLZXlGaWVsZCgpIHx8IHQuUGUucHVzaChuZXcgT3JkZXJCeShlKSksIHQuUGUucHVzaChuZXcgT3JkZXJCeShGaWVsZFBhdGgkMS5rZXlGaWVsZCgpLCBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8pKTsgZWxzZSB7XG4gICAgICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHQuZXhwbGljaXRPcmRlckJ5KSB0LlBlLnB1c2gobiksIG4uZmllbGQuaXNLZXlGaWVsZCgpICYmIChlID0gITApO1xuICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIG9yZGVyIG9mIHRoZSBpbXBsaWNpdCBrZXkgb3JkZXJpbmcgYWx3YXlzIG1hdGNoZXMgdGhlIGxhc3RcbiAgICAgICAgICAgICAgICAvLyBleHBsaWNpdCBvcmRlciBieVxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggPiAwID8gdC5leHBsaWNpdE9yZGVyQnlbdC5leHBsaWNpdE9yZGVyQnkubGVuZ3RoIC0gMV0uZGlyIDogXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovO1xuICAgICAgICAgICAgICAgIHQuUGUucHVzaChuZXcgT3JkZXJCeShGaWVsZFBhdGgkMS5rZXlGaWVsZCgpLCBlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHQuUGU7XG59XG5cbi8qKlxuICogQ29udmVydHMgdGhpcyBgUXVlcnlgIGluc3RhbmNlIHRvIGl0J3MgY29ycmVzcG9uZGluZyBgVGFyZ2V0YCByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKCF0LkllKSBpZiAoXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSB0LmxpbWl0VHlwZSkgdC5JZSA9IF9fUFJJVkFURV9uZXdUYXJnZXQodC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgX19QUklWQVRFX3F1ZXJ5T3JkZXJCeSh0KSwgdC5maWx0ZXJzLCB0LmxpbWl0LCB0LnN0YXJ0QXQsIHQuZW5kQXQpOyBlbHNlIHtcbiAgICAgICAgLy8gRmxpcCB0aGUgb3JkZXJCeSBkaXJlY3Rpb25zIHNpbmNlIHdlIHdhbnQgdGhlIGxhc3QgcmVzdWx0c1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBfX1BSSVZBVEVfcXVlcnlPcmRlckJ5KHQpKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gPT09IG4uZGlyID8gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovIDogXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi87XG4gICAgICAgICAgICBlLnB1c2gobmV3IE9yZGVyQnkobi5maWVsZCwgdCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gc3dhcCB0aGUgY3Vyc29ycyB0byBtYXRjaCB0aGUgbm93LWZsaXBwZWQgcXVlcnkgb3JkZXJpbmcuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHQuZW5kQXQgPyBuZXcgQm91bmQodC5lbmRBdC5wb3NpdGlvbiwgdC5lbmRBdC5pbmNsdXNpdmUpIDogbnVsbCwgciA9IHQuc3RhcnRBdCA/IG5ldyBCb3VuZCh0LnN0YXJ0QXQucG9zaXRpb24sIHQuc3RhcnRBdC5pbmNsdXNpdmUpIDogbnVsbDtcbiAgICAgICAgLy8gTm93IHJldHVybiBhcyBhIExpbWl0VHlwZS5GaXJzdCBxdWVyeS5cbiAgICAgICAgdC5JZSA9IF9fUFJJVkFURV9uZXdUYXJnZXQodC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgZSwgdC5maWx0ZXJzLCB0LmxpbWl0LCBuLCByKTtcbiAgICB9XG4gICAgcmV0dXJuIHQuSWU7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhBZGRlZEZpbHRlcihlLCB0KSB7XG4gICAgdC5nZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpLCBfX1BSSVZBVEVfZ2V0SW5lcXVhbGl0eUZpbHRlckZpZWxkKGUpO1xuICAgIGNvbnN0IG4gPSBlLmZpbHRlcnMuY29uY2F0KFsgdCBdKTtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgbiwgZS5saW1pdCwgZS5saW1pdFR5cGUsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdChlLCB0LCBuKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCB0LCBuLCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlFcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KGUpLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSkgJiYgZS5saW1pdFR5cGUgPT09IHQubGltaXRUeXBlO1xufVxuXG4vLyBUT0RPKGIvMjkxODMxNjUpOiBUaGlzIGlzIHVzZWQgdG8gZ2V0IGEgdW5pcXVlIHN0cmluZyBmcm9tIGEgcXVlcnkgdG8sIGZvclxuLy8gZXhhbXBsZSwgdXNlIGFzIGEgZGljdGlvbmFyeSBrZXksIGJ1dCB0aGUgaW1wbGVtZW50YXRpb24gaXMgc3ViamVjdCB0b1xuLy8gY29sbGlzaW9ucy4gTWFrZSBpdCBjb2xsaXNpb24tZnJlZS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVF1ZXJ5KGUpIHtcbiAgICByZXR1cm4gYCR7X19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KGUpKX18bHQ6JHtlLmxpbWl0VHlwZX1gO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkoZSkge1xuICAgIHJldHVybiBgUXVlcnkodGFyZ2V0PSR7ZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gZS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgKHQgKz0gXCIgY29sbGVjdGlvbkdyb3VwPVwiICsgZS5jb2xsZWN0aW9uR3JvdXApLCBcbiAgICAgICAgZS5maWx0ZXJzLmxlbmd0aCA+IDAgJiYgKHQgKz0gYCwgZmlsdGVyczogWyR7ZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfc3RyaW5naWZ5RmlsdGVyKGUpKSkuam9pbihcIiwgXCIpfV1gKSwgXG4gICAgICAgIF9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZChlLmxpbWl0KSB8fCAodCArPSBcIiwgbGltaXQ6IFwiICsgZS5saW1pdCksIGUub3JkZXJCeS5sZW5ndGggPiAwICYmICh0ICs9IGAsIG9yZGVyQnk6IFske2Uub3JkZXJCeS5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeU9yZGVyQnkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGAke2UuZmllbGQuY2Fub25pY2FsU3RyaW5nKCl9ICgke2UuZGlyfSlgO1xuICAgICAgICB9KGUpKSkuam9pbihcIiwgXCIpfV1gKSwgZS5zdGFydEF0ICYmICh0ICs9IFwiLCBzdGFydEF0OiBcIiwgdCArPSBlLnN0YXJ0QXQuaW5jbHVzaXZlID8gXCJiOlwiIDogXCJhOlwiLCBcbiAgICAgICAgdCArPSBlLnN0YXJ0QXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBlLmVuZEF0ICYmICh0ICs9IFwiLCBlbmRBdDogXCIsIFxuICAgICAgICB0ICs9IGUuZW5kQXQuaW5jbHVzaXZlID8gXCJhOlwiIDogXCJiOlwiLCB0ICs9IGUuZW5kQXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBcbiAgICAgICAgYFRhcmdldCgke3R9KWA7XG4gICAgfShfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChlKSl9OyBsaW1pdFR5cGU9JHtlLmxpbWl0VHlwZX0pYDtcbn1cblxuLyoqIFJldHVybnMgd2hldGhlciBgZG9jYCBtYXRjaGVzIHRoZSBjb25zdHJhaW50cyBvZiBgcXVlcnlgLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKGUsIHQpIHtcbiAgICByZXR1cm4gdC5pc0ZvdW5kRG9jdW1lbnQoKSAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzUGF0aEFuZENvbGxlY3Rpb25Hcm91cChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LmtleS5wYXRoO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZS5jb2xsZWN0aW9uR3JvdXAgPyB0LmtleS5oYXNDb2xsZWN0aW9uSWQoZS5jb2xsZWN0aW9uR3JvdXApICYmIGUucGF0aC5pc1ByZWZpeE9mKG4pIDogRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShlLnBhdGgpID8gZS5wYXRoLmlzRXF1YWwobikgOiBlLnBhdGguaXNJbW1lZGlhdGVQYXJlbnRPZihuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBBIGRvY3VtZW50IG11c3QgaGF2ZSBhIHZhbHVlIGZvciBldmVyeSBvcmRlcmluZyBjbGF1c2UgaW4gb3JkZXIgdG8gc2hvdyB1cFxuICogaW4gdGhlIHJlc3VsdHMuXG4gKi8gKGUsIHQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNPcmRlckJ5KGUsIHQpIHtcbiAgICAgICAgLy8gV2UgbXVzdCB1c2UgYHF1ZXJ5T3JkZXJCeSgpYCB0byBnZXQgdGhlIGxpc3Qgb2YgYWxsIG9yZGVyQnlzIChib3RoIGltcGxpY2l0IGFuZCBleHBsaWNpdCkuXG4gICAgICAgIC8vIE5vdGUgdGhhdCBmb3IgT1IgcXVlcmllcywgb3JkZXJCeSBhcHBsaWVzIHRvIGFsbCBkaXNqdW5jdGlvbiB0ZXJtcyBhbmQgaW1wbGljaXQgb3JkZXJCeXMgbXVzdFxuICAgICAgICAvLyBiZSB0YWtlbiBpbnRvIGFjY291bnQuIEZvciBleGFtcGxlLCB0aGUgcXVlcnkgXCJhID4gMSB8fCBiPT0xXCIgaGFzIGFuIGltcGxpY2l0IFwib3JkZXJCeSBhXCIgZHVlXG4gICAgICAgIC8vIHRvIHRoZSBpbmVxdWFsaXR5LCBhbmQgaXMgZXZhbHVhdGVkIGFzIFwiYSA+IDEgb3JkZXJCeSBhIHx8IGI9PTEgb3JkZXJCeSBhXCIuXG4gICAgICAgIC8vIEEgZG9jdW1lbnQgd2l0aCBjb250ZW50IG9mIHtiOjF9IG1hdGNoZXMgdGhlIGZpbHRlcnMsIGJ1dCBkb2VzIG5vdCBtYXRjaCB0aGUgb3JkZXJCeSBiZWNhdXNlXG4gICAgICAgIC8vIGl0J3MgbWlzc2luZyB0aGUgZmllbGQgJ2EnLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgX19QUklWQVRFX3F1ZXJ5T3JkZXJCeShlKSkgXG4gICAgICAgIC8vIG9yZGVyIGJ5IGtleSBhbHdheXMgbWF0Y2hlc1xuICAgICAgICBpZiAoIW4uZmllbGQuaXNLZXlGaWVsZCgpICYmIG51bGwgPT09IHQuZGF0YS5maWVsZChuLmZpZWxkKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfShlLCB0KSAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzRmlsdGVycyhlLCB0KSB7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlLmZpbHRlcnMpIGlmICghbi5tYXRjaGVzKHQpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqIE1ha2VzIHN1cmUgYSBkb2N1bWVudCBpcyB3aXRoaW4gdGhlIGJvdW5kcywgaWYgcHJvdmlkZWQuICovIChlLCB0KSAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzQm91bmRzKGUsIHQpIHtcbiAgICAgICAgaWYgKGUuc3RhcnRBdCAmJiAhXG4gICAgICAgIC8qKlxuICogUmV0dXJucyB0cnVlIGlmIGEgZG9jdW1lbnQgc29ydHMgYmVmb3JlIGEgYm91bmQgdXNpbmcgdGhlIHByb3ZpZGVkIHNvcnRcbiAqIG9yZGVyLlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9ib3VuZFNvcnRzQmVmb3JlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9ib3VuZENvbXBhcmVUb0RvY3VtZW50KGUsIHQsIG4pO1xuICAgICAgICAgICAgcmV0dXJuIGUuaW5jbHVzaXZlID8gciA8PSAwIDogciA8IDA7XG4gICAgICAgIH0oZS5zdGFydEF0LCBfX1BSSVZBVEVfcXVlcnlPcmRlckJ5KGUpLCB0KSkgcmV0dXJuICExO1xuICAgICAgICBpZiAoZS5lbmRBdCAmJiAhZnVuY3Rpb24gX19QUklWQVRFX2JvdW5kU29ydHNBZnRlckRvY3VtZW50KGUsIHQsIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfYm91bmRDb21wYXJlVG9Eb2N1bWVudChlLCB0LCBuKTtcbiAgICAgICAgICAgIHJldHVybiBlLmluY2x1c2l2ZSA/IHIgPj0gMCA6IHIgPiAwO1xuICAgICAgICB9KGUuZW5kQXQsIF9fUFJJVkFURV9xdWVyeU9yZGVyQnkoZSksIHQpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRoZSBjb2xsZWN0aW9uIGdyb3VwIHRoYXQgdGhpcyBxdWVyeSB0YXJnZXRzLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgaW4gdGhlIFdlYiBTREsgdG8gZmFjaWxpdGF0ZSBtdWx0aS10YWJcbiAqIHN5bmNocm9uaXphdGlvbiBmb3IgcXVlcnkgcmVzdWx0cy5cbiAqLyAoZSwgdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeUNvbGxlY3Rpb25Hcm91cChlKSB7XG4gICAgcmV0dXJuIGUuY29sbGVjdGlvbkdyb3VwIHx8IChlLnBhdGgubGVuZ3RoICUgMiA9PSAxID8gZS5wYXRoLmxhc3RTZWdtZW50KCkgOiBlLnBhdGguZ2V0KGUucGF0aC5sZW5ndGggLSAyKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBjb21wYXJhdG9yIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tcGFyZSB0d28gZG9jdW1lbnRzXG4gKiBiYXNlZCBvbiB0aGUgUXVlcnkncyBvcmRlcmluZyBjb25zdHJhaW50LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUNvbXBhcmF0b3IoZSkge1xuICAgIHJldHVybiAodCwgbikgPT4ge1xuICAgICAgICBsZXQgciA9ICExO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2YgX19QUklWQVRFX3F1ZXJ5T3JkZXJCeShlKSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9jb21wYXJlRG9jcyhpLCB0LCBuKTtcbiAgICAgICAgICAgIGlmICgwICE9PSBlKSByZXR1cm4gZTtcbiAgICAgICAgICAgIHIgPSByIHx8IGkuZmllbGQuaXNLZXlGaWVsZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlRG9jcyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IGUuZmllbGQuaXNLZXlGaWVsZCgpID8gRG9jdW1lbnRLZXkuY29tcGFyYXRvcih0LmtleSwgbi5rZXkpIDogZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVEb2N1bWVudHNCeUZpZWxkKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IHQuZGF0YS5maWVsZChlKSwgaSA9IG4uZGF0YS5maWVsZChlKTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHIgJiYgbnVsbCAhPT0gaSA/IF9fUFJJVkFURV92YWx1ZUNvbXBhcmUociwgaSkgOiBmYWlsKCk7XG4gICAgfShlLmZpZWxkLCB0LCBuKTtcbiAgICBzd2l0Y2ggKGUuZGlyKSB7XG4gICAgICBjYXNlIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLyA6XG4gICAgICAgIHJldHVybiByO1xuXG4gICAgICBjYXNlIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovIDpcbiAgICAgICAgcmV0dXJuIC0xICogcjtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgbWFwIGltcGxlbWVudGF0aW9uIHRoYXQgdXNlcyBvYmplY3RzIGFzIGtleXMuIE9iamVjdHMgbXVzdCBoYXZlIGFuXG4gKiBhc3NvY2lhdGVkIGVxdWFscyBmdW5jdGlvbiBhbmQgbXVzdCBiZSBpbW11dGFibGUuIEVudHJpZXMgaW4gdGhlIG1hcCBhcmVcbiAqIHN0b3JlZCB0b2dldGhlciB3aXRoIHRoZSBrZXkgYmVpbmcgcHJvZHVjZWQgZnJvbSB0aGUgbWFwS2V5Rm4uIFRoaXMgbWFwXG4gKiBhdXRvbWF0aWNhbGx5IGhhbmRsZXMgY29sbGlzaW9ucyBvZiBrZXlzLlxuICovIGNsYXNzIE9iamVjdE1hcCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLm1hcEtleUZuID0gZSwgdGhpcy5lcXVhbHNGbiA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGlubmVyIG1hcCBmb3IgYSBrZXkvdmFsdWUgcGFpci4gRHVlIHRvIHRoZSBwb3NzaWJpbGl0eSBvZiBjb2xsaXNpb25zIHdlXG4gICAgICAgICAqIGtlZXAgYSBsaXN0IG9mIGVudHJpZXMgdGhhdCB3ZSBkbyBhIGxpbmVhciBzZWFyY2ggdGhyb3VnaCB0byBmaW5kIGFuIGFjdHVhbFxuICAgICAgICAgKiBtYXRjaC4gTm90ZSB0aGF0IGNvbGxpc2lvbnMgc2hvdWxkIGJlIHJhcmUsIHNvIHdlIHN0aWxsIGV4cGVjdCBuZWFyXG4gICAgICAgICAqIGNvbnN0YW50IHRpbWUgbG9va3VwcyBpbiBwcmFjdGljZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5uZXIgPSB7fSwgXG4gICAgICAgIC8qKiBUaGUgbnVtYmVyIG9mIGVudHJpZXMgc3RvcmVkIGluIHRoZSBtYXAgKi9cbiAgICAgICAgdGhpcy5pbm5lclNpemUgPSAwO1xuICAgIH1cbiAgICAvKiogR2V0IGEgdmFsdWUgZm9yIHRoaXMga2V5LCBvciB1bmRlZmluZWQgaWYgaXQgZG9lcyBub3QgZXhpc3QuICovICAgIGdldChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLm1hcEtleUZuKGUpLCBuID0gdGhpcy5pbm5lclt0XTtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gbikgZm9yIChjb25zdCBbdCwgcl0gb2YgbikgaWYgKHRoaXMuZXF1YWxzRm4odCwgZSkpIHJldHVybiByO1xuICAgIH1cbiAgICBoYXMoZSkge1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0aGlzLmdldChlKTtcbiAgICB9XG4gICAgLyoqIFB1dCB0aGlzIGtleSBhbmQgdmFsdWUgaW4gdGhlIG1hcC4gKi8gICAgc2V0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMubWFwS2V5Rm4oZSksIHIgPSB0aGlzLmlubmVyW25dO1xuICAgICAgICBpZiAodm9pZCAwID09PSByKSByZXR1cm4gdGhpcy5pbm5lcltuXSA9IFsgWyBlLCB0IF0gXSwgdm9pZCB0aGlzLmlubmVyU2l6ZSsrO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHIubGVuZ3RoOyBuKyspIGlmICh0aGlzLmVxdWFsc0ZuKHJbbl1bMF0sIGUpKSBcbiAgICAgICAgLy8gVGhpcyBpcyB1cGRhdGluZyBhbiBleGlzdGluZyBlbnRyeSBhbmQgZG9lcyBub3QgaW5jcmVhc2UgYGlubmVyU2l6ZWAuXG4gICAgICAgIHJldHVybiB2b2lkIChyW25dID0gWyBlLCB0IF0pO1xuICAgICAgICByLnB1c2goWyBlLCB0IF0pLCB0aGlzLmlubmVyU2l6ZSsrO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgdGhpcyBrZXkgZnJvbSB0aGUgbWFwLiBSZXR1cm5zIGEgYm9vbGVhbiBpZiBhbnl0aGluZyB3YXMgZGVsZXRlZC5cbiAgICAgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubWFwS2V5Rm4oZSksIG4gPSB0aGlzLmlubmVyW3RdO1xuICAgICAgICBpZiAodm9pZCAwID09PSBuKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgbi5sZW5ndGg7IHIrKykgaWYgKHRoaXMuZXF1YWxzRm4obltyXVswXSwgZSkpIHJldHVybiAxID09PSBuLmxlbmd0aCA/IGRlbGV0ZSB0aGlzLmlubmVyW3RdIDogbi5zcGxpY2UociwgMSksIFxuICAgICAgICB0aGlzLmlubmVyU2l6ZS0tLCAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgZm9yRWFjaCh0aGlzLmlubmVyLCAoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW3QsIHJdIG9mIG4pIGUodCwgcik7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIGlzRW1wdHkodGhpcy5pbm5lcik7XG4gICAgfVxuICAgIHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyU2l6ZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IGllID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcblxuZnVuY3Rpb24gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpIHtcbiAgICByZXR1cm4gaWU7XG59XG5cbmNvbnN0IHNlID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcblxuZnVuY3Rpb24gZG9jdW1lbnRNYXAoLi4uZSkge1xuICAgIGxldCB0ID0gc2U7XG4gICAgZm9yIChjb25zdCBuIG9mIGUpIHQgPSB0Lmluc2VydChuLmtleSwgbik7XG4gICAgcmV0dXJuIHQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb252ZXJ0T3ZlcmxheWVkRG9jdW1lbnRNYXBUb0RvY3VtZW50TWFwKGUpIHtcbiAgICBsZXQgdCA9IHNlO1xuICAgIHJldHVybiBlLmZvckVhY2goKChlLCBuKSA9PiB0ID0gdC5pbnNlcnQoZSwgbi5vdmVybGF5ZWREb2N1bWVudCkpKSwgdDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9uZXdEb2N1bWVudEtleU1hcCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3TXV0YXRpb25NYXAoKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9uZXdEb2N1bWVudEtleU1hcCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3RG9jdW1lbnRLZXlNYXAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RNYXAoKGUgPT4gZS50b1N0cmluZygpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKTtcbn1cblxuY29uc3Qgb2UgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuXG5jb25zdCBfZSA9IG5ldyBTb3J0ZWRTZXQoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCguLi5lKSB7XG4gICAgbGV0IHQgPSBfZTtcbiAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdCA9IHQuYWRkKG4pO1xuICAgIHJldHVybiB0O1xufVxuXG5jb25zdCBhZSA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKSB7XG4gICAgcmV0dXJuIGFlO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIGFuIERvdWJsZVZhbHVlIGZvciBgdmFsdWVgIHRoYXQgaXMgZW5jb2RlZCBiYXNlZCB0aGUgc2VyaWFsaXplcidzXG4gKiBgdXNlUHJvdG8zSnNvbmAgc2V0dGluZy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9Eb3VibGUoZSwgdCkge1xuICAgIGlmIChlLnVzZVByb3RvM0pzb24pIHtcbiAgICAgICAgaWYgKGlzTmFOKHQpKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiTmFOXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHQgPT09IDEgLyAwKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiSW5maW5pdHlcIlxuICAgICAgICB9O1xuICAgICAgICBpZiAodCA9PT0gLTEgLyAwKSByZXR1cm4ge1xuICAgICAgICAgICAgZG91YmxlVmFsdWU6IFwiLUluZmluaXR5XCJcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG91YmxlVmFsdWU6IF9fUFJJVkFURV9pc05lZ2F0aXZlWmVybyh0KSA/IFwiLTBcIiA6IHRcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgYW4gSW50ZWdlclZhbHVlIGZvciBgdmFsdWVgLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b0ludGVnZXIoZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGludGVnZXJWYWx1ZTogXCJcIiArIGVcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgYSB2YWx1ZSBmb3IgYSBudW1iZXIgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvIGEgcHJvdG8uXG4gKiBUaGUgcmV0dXJuIHZhbHVlIGlzIGFuIEludGVnZXJWYWx1ZSBpZiBpdCBjYW4gc2FmZWx5IHJlcHJlc2VudCB0aGUgdmFsdWUsXG4gKiBvdGhlcndpc2UgYSBEb3VibGVWYWx1ZSBpcyByZXR1cm5lZC5cbiAqLyBmdW5jdGlvbiB0b051bWJlcihlLCB0KSB7XG4gICAgcmV0dXJuIGlzU2FmZUludGVnZXIodCkgPyBfX1BSSVZBVEVfdG9JbnRlZ2VyKHQpIDogX19QUklWQVRFX3RvRG91YmxlKGUsIHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFVzZWQgdG8gcmVwcmVzZW50IGEgZmllbGQgdHJhbnNmb3JtIG9uIGEgbXV0YXRpb24uICovIGNsYXNzIFRyYW5zZm9ybU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBzdHJ1Y3R1cmFsIHR5cGUgb2YgYFRyYW5zZm9ybU9wZXJhdGlvbmAgaXMgdW5pcXVlLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy81NDUxXG4gICAgICAgIHRoaXMuXyA9IHZvaWQgMDtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIGxvY2FsIHRyYW5zZm9ybSByZXN1bHQgYWdhaW5zdCB0aGUgcHJvdmlkZWQgYHByZXZpb3VzVmFsdWVgLFxuICogb3B0aW9uYWxseSB1c2luZyB0aGUgcHJvdmlkZWQgbG9jYWxXcml0ZVRpbWUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9Mb2NhbFZpZXcoZSwgdCwgbikge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSA/IGZ1bmN0aW9uIHNlcnZlclRpbWVzdGFtcCQxKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHtcbiAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgIF9fdHlwZV9fOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcInNlcnZlcl90aW1lc3RhbXBcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgX19sb2NhbF93cml0ZV90aW1lX186IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IGUuc2Vjb25kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbm9zOiBlLm5hbm9zZWNvbmRzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIFdlIHNob3VsZCBhdm9pZCBzdG9yaW5nIGRlZXBseSBuZXN0ZWQgc2VydmVyIHRpbWVzdGFtcCBtYXAgdmFsdWVzXG4gICAgICAgIC8vIGJlY2F1c2Ugd2UgbmV2ZXIgdXNlIHRoZSBpbnRlcm1lZGlhdGUgXCJwcmV2aW91cyB2YWx1ZXNcIi5cbiAgICAgICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgICAgIC8vIHByZXZpb3VzOiA0MkwsIGFkZDogdDEsIHJlc3VsdDogdDEgLT4gNDJMXG4gICAgICAgIC8vIHByZXZpb3VzOiB0MSwgIGFkZDogdDIsIHJlc3VsdDogdDIgLT4gNDJMIChOT1QgdDIgLT4gdDEgLT4gNDJMKVxuICAgICAgICAvLyBwcmV2aW91czogdDIsICBhZGQ6IHQzLCByZXN1bHQ6IHQzIC0+IDQyTCAoTk9UIHQzIC0+IHQyIC0+IHQxIC0+IDQyTClcbiAgICAgICAgLy8gYGdldFByZXZpb3VzVmFsdWVgIHJlY3Vyc2l2ZWx5IHRyYXZlcnNlcyBzZXJ2ZXIgdGltZXN0YW1wcyB0byBmaW5kIHRoZVxuICAgICAgICAvLyBsZWFzdCByZWNlbnQgVmFsdWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQgJiYgX19QUklWQVRFX2lzU2VydmVyVGltZXN0YW1wKHQpICYmICh0ID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUodCkpLCBcbiAgICAgICAgdCAmJiAobi5maWVsZHMuX19wcmV2aW91c192YWx1ZV9fID0gdCksIHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiBuXG4gICAgICAgIH07XG4gICAgfShuLCB0KSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiA/IF9fUFJJVkFURV9hcHBseUFycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24oZSwgdCkgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uID8gX19QUklWQVRFX2FwcGx5QXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24oZSwgdCkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlOdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uVG9Mb2NhbFZpZXcoZSwgdCkge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFNpbmNlIEphdmFTY3JpcHQncyBpbnRlZ2VyIGFyaXRobWV0aWMgaXMgbGltaXRlZCB0byA1MyBiaXRcbiAgICAgICAgLy8gcHJlY2lzaW9uIGFuZCByZXNvbHZlcyBvdmVyZmxvd3MgYnkgcmVkdWNpbmcgcHJlY2lzaW9uLCB3ZSBkbyBub3RcbiAgICAgICAgLy8gbWFudWFsbHkgY2FwIG92ZXJmbG93cyBhdCAyXjYzLlxuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2NvbXB1dGVUcmFuc2Zvcm1PcGVyYXRpb25CYXNlVmFsdWUoZSwgdCksIHIgPSBhc051bWJlcihuKSArIGFzTnVtYmVyKGUuVGUpO1xuICAgICAgICByZXR1cm4gaXNJbnRlZ2VyKG4pICYmIGlzSW50ZWdlcihlLlRlKSA/IF9fUFJJVkFURV90b0ludGVnZXIocikgOiBfX1BSSVZBVEVfdG9Eb3VibGUoZS5zZXJpYWxpemVyLCByKTtcbiAgICB9KGUsIHQpO1xufVxuXG4vKipcbiAqIENvbXB1dGVzIGEgZmluYWwgdHJhbnNmb3JtIHJlc3VsdCBhZnRlciB0aGUgdHJhbnNmb3JtIGhhcyBiZWVuIGFja25vd2xlZGdlZFxuICogYnkgdGhlIHNlcnZlciwgcG90ZW50aWFsbHkgdXNpbmcgdGhlIHNlcnZlci1wcm92aWRlZCB0cmFuc2Zvcm1SZXN1bHQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgLy8gVGhlIHNlcnZlciBqdXN0IHNlbmRzIG51bGwgYXMgdGhlIHRyYW5zZm9ybSByZXN1bHQgZm9yIGFycmF5IG9wZXJhdGlvbnMsXG4gICAgLy8gc28gd2UgaGF2ZSB0byBjYWxjdWxhdGUgYSByZXN1bHQgdGhlIHNhbWUgYXMgd2UgZG8gZm9yIGxvY2FsXG4gICAgLy8gYXBwbGljYXRpb25zLlxuICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXBwbHlBcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiA/IF9fUFJJVkFURV9hcHBseUFycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogbjtcbn1cblxuLyoqXG4gKiBJZiB0aGlzIHRyYW5zZm9ybSBvcGVyYXRpb24gaXMgbm90IGlkZW1wb3RlbnQsIHJldHVybnMgdGhlIGJhc2UgdmFsdWUgdG9cbiAqIHBlcnNpc3QgZm9yIHRoaXMgdHJhbnNmb3JtLiBJZiBhIGJhc2UgdmFsdWUgaXMgcmV0dXJuZWQsIHRoZSB0cmFuc2Zvcm1cbiAqIG9wZXJhdGlvbiBpcyBhbHdheXMgYXBwbGllZCB0byB0aGlzIGJhc2UgdmFsdWUsIGV2ZW4gaWYgZG9jdW1lbnQgaGFzXG4gKiBhbHJlYWR5IGJlZW4gdXBkYXRlZC5cbiAqXG4gKiBCYXNlIHZhbHVlcyBwcm92aWRlIGNvbnNpc3RlbnQgYmVoYXZpb3IgZm9yIG5vbi1pZGVtcG90ZW50IHRyYW5zZm9ybXMgYW5kXG4gKiBhbGxvdyB1cyB0byByZXR1cm4gdGhlIHNhbWUgbGF0ZW5jeS1jb21wZW5zYXRlZCB2YWx1ZSBldmVuIGlmIHRoZSBiYWNrZW5kXG4gKiBoYXMgYWxyZWFkeSBhcHBsaWVkIHRoZSB0cmFuc2Zvcm0gb3BlcmF0aW9uLiBUaGUgYmFzZSB2YWx1ZSBpcyBudWxsIGZvclxuICogaWRlbXBvdGVudCB0cmFuc2Zvcm1zLCBhcyB0aGV5IGNhbiBiZSByZS1wbGF5ZWQgZXZlbiBpZiB0aGUgYmFja2VuZCBoYXNcbiAqIGFscmVhZHkgYXBwbGllZCB0aGVtLlxuICpcbiAqIEByZXR1cm5zIGEgYmFzZSB2YWx1ZSB0byBzdG9yZSBhbG9uZyB3aXRoIHRoZSBtdXRhdGlvbiwgb3IgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgdHJhbnNmb3Jtcy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcHV0ZVRyYW5zZm9ybU9wZXJhdGlvbkJhc2VWYWx1ZShlLCB0KSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbiA/IFxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBlaXRoZXIgYW4gSW50ZWdlclZhbHVlIG9yIGEgRG91YmxlVmFsdWUuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzTnVtYmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzSW50ZWdlcihlKSB8fCBmdW5jdGlvbiBfX1BSSVZBVEVfaXNEb3VibGUoZSkge1xuICAgICAgICAgICAgcmV0dXJuICEhZSAmJiBcImRvdWJsZVZhbHVlXCIgaW4gZTtcbiAgICAgICAgfShlKTtcbiAgICB9KHQpID8gdCA6IHtcbiAgICAgICAgaW50ZWdlclZhbHVlOiAwXG4gICAgfSA6IG51bGw7XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGEgdmFsdWUgaW50byBhIHNlcnZlci1nZW5lcmF0ZWQgdGltZXN0YW1wLiAqL1xuY2xhc3MgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7fVxuXG4vKiogVHJhbnNmb3JtcyBhbiBhcnJheSB2YWx1ZSB2aWEgYSB1bmlvbiBvcGVyYXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZWxlbWVudHMgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5QXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9jb2VyY2VkRmllbGRWYWx1ZXNBcnJheSh0KTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS5lbGVtZW50cykgbi5zb21lKChlID0+IF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLCB0KSkpIHx8IG4ucHVzaCh0KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGFuIGFycmF5IHZhbHVlIHZpYSBhIHJlbW92ZSBvcGVyYXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmVsZW1lbnRzID0gZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseUFycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIHtcbiAgICBsZXQgbiA9IF9fUFJJVkFURV9jb2VyY2VkRmllbGRWYWx1ZXNBcnJheSh0KTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS5lbGVtZW50cykgbiA9IG4uZmlsdGVyKChlID0+ICFfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZSwgdCkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyB0aGUgYmFja2VuZCBzZW1hbnRpY3MgZm9yIGxvY2FsbHkgY29tcHV0ZWQgTlVNRVJJQ19BREQgKGluY3JlbWVudClcbiAqIHRyYW5zZm9ybXMuIENvbnZlcnRzIGFsbCBmaWVsZCB2YWx1ZXMgdG8gaW50ZWdlcnMgb3IgZG91YmxlcywgYnV0IHVubGlrZSB0aGVcbiAqIGJhY2tlbmQgZG9lcyBub3QgY2FwIGludGVnZXIgdmFsdWVzIGF0IDJeNjMuIEluc3RlYWQsIEphdmFTY3JpcHQgbnVtYmVyXG4gKiBhcml0aG1ldGljIGlzIHVzZWQgYW5kIHByZWNpc2lvbiBsb3NzIGNhbiBvY2N1ciBmb3IgdmFsdWVzIGdyZWF0ZXIgdGhhbiAyXjUzLlxuICovIGNsYXNzIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuc2VyaWFsaXplciA9IGUsIHRoaXMuVGUgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYXNOdW1iZXIoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29lcmNlZEZpZWxkVmFsdWVzQXJyYXkoZSkge1xuICAgIHJldHVybiBpc0FycmF5KGUpICYmIGUuYXJyYXlWYWx1ZS52YWx1ZXMgPyBlLmFycmF5VmFsdWUudmFsdWVzLnNsaWNlKCkgOiBbXTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBBIGZpZWxkIHBhdGggYW5kIHRoZSBUcmFuc2Zvcm1PcGVyYXRpb24gdG8gcGVyZm9ybSB1cG9uIGl0LiAqLyBjbGFzcyBGaWVsZFRyYW5zZm9ybSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmZpZWxkID0gZSwgdGhpcy50cmFuc2Zvcm0gPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkVHJhbnNmb3JtRXF1YWxzKGUsIHQpIHtcbiAgICByZXR1cm4gZS5maWVsZC5pc0VxdWFsKHQuZmllbGQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV90cmFuc2Zvcm1PcGVyYXRpb25FcXVhbHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uICYmIHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiB8fCBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uICYmIHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZS5lbGVtZW50cywgdC5lbGVtZW50cywgX19QUklWQVRFX3ZhbHVlRXF1YWxzKSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbiAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZS5UZSwgdC5UZSkgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybTtcbiAgICB9KGUudHJhbnNmb3JtLCB0LnRyYW5zZm9ybSk7XG59XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHN1Y2Nlc3NmdWxseSBhcHBseWluZyBhIG11dGF0aW9uIHRvIHRoZSBiYWNrZW5kLiAqL1xuY2xhc3MgTXV0YXRpb25SZXN1bHQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBtdXRhdGlvbiB3YXMgY29tbWl0dGVkOlxuICAgICAqXG4gICAgICogLSBGb3IgbW9zdCBvcGVyYXRpb25zLCB0aGlzIGlzIHRoZSB1cGRhdGVUaW1lIGluIHRoZSBXcml0ZVJlc3VsdC5cbiAgICAgKiAtIEZvciBkZWxldGVzLCB0aGUgY29tbWl0VGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSAoYmVjYXVzZSBkZWxldGVzIGFyZVxuICAgICAqICAgbm90IHN0b3JlZCBhbmQgaGF2ZSBubyB1cGRhdGVUaW1lKS5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB0aGVzZSB2ZXJzaW9ucyBjYW4gYmUgZGlmZmVyZW50OiBOby1vcCB3cml0ZXMgd2lsbCBub3QgY2hhbmdlXG4gICAgICogdGhlIHVwZGF0ZVRpbWUgZXZlbiB0aG91Z2ggdGhlIGNvbW1pdFRpbWUgYWR2YW5jZXMuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIHJlc3VsdGluZyBmaWVsZHMgcmV0dXJuZWQgZnJvbSB0aGUgYmFja2VuZCBhZnRlciBhIG11dGF0aW9uXG4gICAgICogY29udGFpbmluZyBmaWVsZCB0cmFuc2Zvcm1zIGhhcyBiZWVuIGNvbW1pdHRlZC4gQ29udGFpbnMgb25lIEZpZWxkVmFsdWVcbiAgICAgKiBmb3IgZWFjaCBGaWVsZFRyYW5zZm9ybSB0aGF0IHdhcyBpbiB0aGUgbXV0YXRpb24uXG4gICAgICpcbiAgICAgKiBXaWxsIGJlIGVtcHR5IGlmIHRoZSBtdXRhdGlvbiBkaWQgbm90IGNvbnRhaW4gYW55IGZpZWxkIHRyYW5zZm9ybXMuXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICB0aGlzLnZlcnNpb24gPSBlLCB0aGlzLnRyYW5zZm9ybVJlc3VsdHMgPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgcHJlY29uZGl0aW9uIGZvciBhIG11dGF0aW9uLiBUaGlzIGZvbGxvd3MgdGhlIG1vZGVsIHRoYXQgdGhlXG4gKiBiYWNrZW5kIGFjY2VwdHMgd2l0aCB0aGUgc3BlY2lhbCBjYXNlIG9mIGFuIGV4cGxpY2l0IFwiZW1wdHlcIiBwcmVjb25kaXRpb25cbiAqIChtZWFuaW5nIG5vIHByZWNvbmRpdGlvbikuXG4gKi8gY2xhc3MgUHJlY29uZGl0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMudXBkYXRlVGltZSA9IGUsIHRoaXMuZXhpc3RzID0gdDtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgZW1wdHkgUHJlY29uZGl0aW9uLiAqLyAgICBzdGF0aWMgbm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmVjb25kaXRpb247XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IFByZWNvbmRpdGlvbiB3aXRoIGFuIGV4aXN0cyBmbGFnLiAqLyAgICBzdGF0aWMgZXhpc3RzKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmVjb25kaXRpb24odm9pZCAwLCBlKTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgUHJlY29uZGl0aW9uIGJhc2VkIG9uIGEgdmVyc2lvbiBhIGRvY3VtZW50IGV4aXN0cyBhdC4gKi8gICAgc3RhdGljIHVwZGF0ZVRpbWUoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByZWNvbmRpdGlvbihlKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgd2hldGhlciB0aGlzIFByZWNvbmRpdGlvbiBpcyBlbXB0eS4gKi8gICAgZ2V0IGlzTm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gdGhpcy51cGRhdGVUaW1lICYmIHZvaWQgMCA9PT0gdGhpcy5leGlzdHM7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5leGlzdHMgPT09IGUuZXhpc3RzICYmICh0aGlzLnVwZGF0ZVRpbWUgPyAhIWUudXBkYXRlVGltZSAmJiB0aGlzLnVwZGF0ZVRpbWUuaXNFcXVhbChlLnVwZGF0ZVRpbWUpIDogIWUudXBkYXRlVGltZSk7XG4gICAgfVxufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIHRoZSBwcmVjb25kaXRpb25zIGlzIHZhbGlkIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wcmVjb25kaXRpb25Jc1ZhbGlkRm9yRG9jdW1lbnQoZSwgdCkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudXBkYXRlVGltZSA/IHQuaXNGb3VuZERvY3VtZW50KCkgJiYgdC52ZXJzaW9uLmlzRXF1YWwoZS51cGRhdGVUaW1lKSA6IHZvaWQgMCA9PT0gZS5leGlzdHMgfHwgZS5leGlzdHMgPT09IHQuaXNGb3VuZERvY3VtZW50KCk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiBkZXNjcmliZXMgYSBzZWxmLWNvbnRhaW5lZCBjaGFuZ2UgdG8gYSBkb2N1bWVudC4gTXV0YXRpb25zIGNhblxuICogY3JlYXRlLCByZXBsYWNlLCBkZWxldGUsIGFuZCB1cGRhdGUgc3Vic2V0cyBvZiBkb2N1bWVudHMuXG4gKlxuICogTXV0YXRpb25zIG5vdCBvbmx5IGFjdCBvbiB0aGUgdmFsdWUgb2YgdGhlIGRvY3VtZW50IGJ1dCBhbHNvIGl0cyB2ZXJzaW9uLlxuICpcbiAqIEZvciBsb2NhbCBtdXRhdGlvbnMgKG11dGF0aW9ucyB0aGF0IGhhdmVuJ3QgYmVlbiBjb21taXR0ZWQgeWV0KSwgd2UgcHJlc2VydmVcbiAqIHRoZSBleGlzdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gRm9yIERlbGV0ZSBtdXRhdGlvbnMsIHdlXG4gKiByZXNldCB0aGUgdmVyc2lvbiB0byAwLlxuICpcbiAqIEhlcmUncyB0aGUgZXhwZWN0ZWQgdHJhbnNpdGlvbiB0YWJsZS5cbiAqXG4gKiBNVVRBVElPTiAgICAgICAgICAgQVBQTElFRCBUTyAgICAgICAgICAgIFJFU1VMVFMgSU5cbiAqXG4gKiBTZXRNdXRhdGlvbiAgICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogU2V0TXV0YXRpb24gICAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBEb2N1bWVudCh2MClcbiAqIFNldE11dGF0aW9uICAgICAgICBJbnZhbGlkRG9jdW1lbnQodjApICAgRG9jdW1lbnQodjApXG4gKiBQYXRjaE11dGF0aW9uICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBOb0RvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIEludmFsaWREb2N1bWVudCh2MCkgICBVbmtub3duRG9jdW1lbnQodjMpXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgTm9Eb2N1bWVudCh2MykgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgSW52YWxpZERvY3VtZW50KHYwKSAgIE5vRG9jdW1lbnQodjApXG4gKlxuICogRm9yIGFja25vd2xlZGdlZCBtdXRhdGlvbnMsIHdlIHVzZSB0aGUgdXBkYXRlVGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSBhc1xuICogdGhlIHJlc3VsdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gQXMgZGVsZXRlcyBoYXZlIG5vXG4gKiBleHBsaWNpdCB1cGRhdGUgdGltZSwgd2UgdXNlIHRoZSBjb21taXRUaW1lIG9mIHRoZSBXcml0ZVJlc3BvbnNlIGZvclxuICogRGVsZXRlIG11dGF0aW9ucy5cbiAqXG4gKiBJZiBhIG11dGF0aW9uIGlzIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZCBidXQgZmFpbHMgdGhlIHByZWNvbmRpdGlvbiBjaGVja1xuICogbG9jYWxseSwgd2UgdHJhbnNpdGlvbiB0byBhbiBgVW5rbm93bkRvY3VtZW50YCBhbmQgcmVseSBvbiBXYXRjaCB0byBzZW5kIHVzXG4gKiB0aGUgdXBkYXRlZCB2ZXJzaW9uLlxuICpcbiAqIEZpZWxkIHRyYW5zZm9ybXMgYXJlIHVzZWQgb25seSB3aXRoIFBhdGNoIGFuZCBTZXQgTXV0YXRpb25zLiBXZSB1c2UgdGhlXG4gKiBgdXBkYXRlVHJhbnNmb3Jtc2AgbWVzc2FnZSB0byBzdG9yZSB0cmFuc2Zvcm1zLCByYXRoZXIgdGhhbiB0aGUgYHRyYW5zZm9ybXNgc1xuICogbWVzc2FnZXMuXG4gKlxuICogIyMgU3ViY2xhc3NpbmcgTm90ZXNcbiAqXG4gKiBFdmVyeSB0eXBlIG9mIG11dGF0aW9uIG5lZWRzIHRvIGltcGxlbWVudCBpdHMgb3duIGFwcGx5VG9SZW1vdGVEb2N1bWVudCgpIGFuZFxuICogYXBwbHlUb0xvY2FsVmlldygpIHRvIGltcGxlbWVudCB0aGUgYWN0dWFsIGJlaGF2aW9yIG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvblxuICogdG8gc29tZSBzb3VyY2UgZG9jdW1lbnQgKHNlZSBgc2V0TXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoKWAgZm9yIGFuXG4gKiBleGFtcGxlKS5cbiAqLyBjbGFzcyBNdXRhdGlvbiB7fVxuXG4vKipcbiAqIEEgdXRpbGl0eSBtZXRob2QgdG8gY2FsY3VsYXRlIGEgYE11dGF0aW9uYCByZXByZXNlbnRpbmcgdGhlIG92ZXJsYXkgZnJvbSB0aGVcbiAqIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCwgYW5kIGEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIHRoZSBmaWVsZHMgdGhhdFxuICogYXJlIG11dGF0ZWQgYnkgdGhlIGxvY2FsIG11dGF0aW9ucy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY2FsY3VsYXRlT3ZlcmxheU11dGF0aW9uKGUsIHQpIHtcbiAgICBpZiAoIWUuaGFzTG9jYWxNdXRhdGlvbnMgfHwgdCAmJiAwID09PSB0LmZpZWxkcy5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgIC8vIG1hc2sgaXMgbnVsbCB3aGVuIHNldHMgb3IgZGVsZXRlcyBhcmUgYXBwbGllZCB0byB0aGUgY3VycmVudCBkb2N1bWVudC5cbiAgICAgICAgaWYgKG51bGwgPT09IHQpIHJldHVybiBlLmlzTm9Eb2N1bWVudCgpID8gbmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLmtleSwgUHJlY29uZGl0aW9uLm5vbmUoKSkgOiBuZXcgX19QUklWQVRFX1NldE11dGF0aW9uKGUua2V5LCBlLmRhdGEsIFByZWNvbmRpdGlvbi5ub25lKCkpO1xuICAgIHtcbiAgICAgICAgY29uc3QgbiA9IGUuZGF0YSwgciA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgICAgIGxldCBpID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgZm9yIChsZXQgZSBvZiB0LmZpZWxkcykgaWYgKCFpLmhhcyhlKSkge1xuICAgICAgICAgICAgbGV0IHQgPSBuLmZpZWxkKGUpO1xuICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGRlbGV0aW5nIGEgbmVzdGVkIGZpZWxkLCB3ZSB0YWtlIHRoZSBpbW1lZGlhdGUgcGFyZW50IGFzXG4gICAgICAgICAgICAvLyB0aGUgbWFzayB1c2VkIHRvIGNvbnN0cnVjdCB0aGUgcmVzdWx0aW5nIG11dGF0aW9uLlxuICAgICAgICAgICAgLy8gSnVzdGlmaWNhdGlvbjogTmVzdGVkIGZpZWxkcyBjYW4gY3JlYXRlIHBhcmVudCBmaWVsZHMgaW1wbGljaXRseS4gSWZcbiAgICAgICAgICAgIC8vIG9ubHkgYSBsZWFmIGVudHJ5IGlzIGRlbGV0ZWQgaW4gbGF0ZXIgbXV0YXRpb25zLCB0aGUgcGFyZW50IGZpZWxkXG4gICAgICAgICAgICAvLyBzaG91bGQgc3RpbGwgcmVtYWluLCBidXQgd2UgbWF5IGhhdmUgbG9zdCB0aGlzIGluZm9ybWF0aW9uLlxuICAgICAgICAgICAgLy8gQ29uc2lkZXIgbXV0YXRpb24gKGZvby5iYXIgMSksIHRoZW4gbXV0YXRpb24gKGZvby5iYXIgZGVsZXRlKCkpLlxuICAgICAgICAgICAgLy8gVGhpcyBsZWF2ZXMgdGhlIGZpbmFsIHJlc3VsdCAoZm9vLCB7fSkuIERlc3BpdGUgdGhlIGZhY3QgdGhhdCBgZG9jYFxuICAgICAgICAgICAgLy8gaGFzIHRoZSBjb3JyZWN0IHJlc3VsdCwgYGZvb2AgaXMgbm90IGluIGBtYXNrYCwgYW5kIHRoZSByZXN1bHRpbmdcbiAgICAgICAgICAgIC8vIG11dGF0aW9uIHdvdWxkIG1pc3MgYGZvb2AuXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSB0ICYmIGUubGVuZ3RoID4gMSAmJiAoZSA9IGUucG9wTGFzdCgpLCB0ID0gbi5maWVsZChlKSksIG51bGwgPT09IHQgPyByLmRlbGV0ZShlKSA6IHIuc2V0KGUsIHQpLCBcbiAgICAgICAgICAgIGkgPSBpLmFkZChlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUua2V5LCByLCBuZXcgRmllbGRNYXNrKGkudG9BcnJheSgpKSwgUHJlY29uZGl0aW9uLm5vbmUoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmcgYVxuICogbmV3IHJlbW90ZSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHN0YXRlXG4gKiAoZS5nLiBpdCBpcyBpbnZhbGlkIG9yIG91dGRhdGVkKSwgdGhlIGRvY3VtZW50IHR5cGUgbWF5IHRyYW5zaXRpb24gdG9cbiAqIHVua25vd24uXG4gKlxuICogQHBhcmFtIG11dGF0aW9uIC0gVGhlIG11dGF0aW9uIHRvIGFwcGx5LlxuICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIG11dGF0ZS4gVGhlIGlucHV0IGRvY3VtZW50IGNhbiBiZSBhblxuICogICAgIGludmFsaWQgZG9jdW1lbnQgaWYgdGhlIGNsaWVudCBoYXMgbm8ga25vd2xlZGdlIG9mIHRoZSBwcmUtbXV0YXRpb24gc3RhdGVcbiAqICAgICBvZiB0aGUgZG9jdW1lbnQuXG4gKiBAcGFyYW0gbXV0YXRpb25SZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvbiBmcm9tIHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXRNdXRhdGlvbiA/IGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRNdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBzZXRNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcsIGlmIHdlJ3JlIGFwcGx5aW5nIGEgbXV0YXRpb24gdG8gYVxuICAgICAgICAvLyByZW1vdGUgZG9jdW1lbnQgdGhlIHNlcnZlciBoYXMgYWNjZXB0ZWQgdGhlIG11dGF0aW9uIHNvIHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbXVzdCBoYXZlIGhlbGQuXG4gICAgICAgIGNvbnN0IHIgPSBlLnZhbHVlLmNsb25lKCksIGkgPSBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLmZpZWxkVHJhbnNmb3JtcywgdCwgbi50cmFuc2Zvcm1SZXN1bHRzKTtcbiAgICAgICAgci5zZXRBbGwoaSksIHQuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIHIpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0oZSwgdCwgbikgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1BhdGNoTXV0YXRpb24gPyBmdW5jdGlvbiBfX1BSSVZBVEVfcGF0Y2hNdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIFxuICAgICAgICAvLyBTaW5jZSB0aGUgbXV0YXRpb24gd2FzIG5vdCByZWplY3RlZCwgd2Uga25vdyB0aGF0IHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbWF0Y2hlZCBvbiB0aGUgYmFja2VuZC4gV2UgdGhlcmVmb3JlIG11c3Qgbm90IGhhdmUgdGhlIGV4cGVjdGVkIHZlcnNpb25cbiAgICAgICAgLy8gb2YgdGhlIGRvY3VtZW50IGluIG91ciBjYWNoZSBhbmQgY29udmVydCB0byBhbiBVbmtub3duRG9jdW1lbnQgd2l0aCBhXG4gICAgICAgIC8vIGtub3duIHVwZGF0ZVRpbWUuXG4gICAgICAgIHJldHVybiB2b2lkIHQuY29udmVydFRvVW5rbm93bkRvY3VtZW50KG4udmVyc2lvbik7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLmZpZWxkVHJhbnNmb3JtcywgdCwgbi50cmFuc2Zvcm1SZXN1bHRzKSwgaSA9IHQuZGF0YTtcbiAgICAgICAgaS5zZXRBbGwoX19QUklWQVRFX2dldFBhdGNoKGUpKSwgaS5zZXRBbGwociksIHQuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIGkpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0oZSwgdCwgbikgOiBmdW5jdGlvbiBfX1BSSVZBVEVfZGVsZXRlTXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICAvLyBVbmxpa2UgYXBwbHlUb0xvY2FsVmlldywgaWYgd2UncmUgYXBwbHlpbmcgYSBtdXRhdGlvbiB0byBhIHJlbW90ZVxuICAgICAgICAvLyBkb2N1bWVudCB0aGUgc2VydmVyIGhhcyBhY2NlcHRlZCB0aGUgbXV0YXRpb24gc28gdGhlIHByZWNvbmRpdGlvbiBtdXN0XG4gICAgICAgIC8vIGhhdmUgaGVsZC5cbiAgICAgICAgdC5jb252ZXJ0VG9Ob0RvY3VtZW50KG4udmVyc2lvbikuc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCk7XG4gICAgfSgwLCB0LCBuKTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIHRoaXMgbXV0YXRpb24gdG8gdGhlIGdpdmVuIGRvY3VtZW50IGZvciB0aGUgcHVycG9zZXMgb2YgY29tcHV0aW5nXG4gKiB0aGUgbmV3IGxvY2FsIHZpZXcgb2YgYSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlXG4gKiBleHBlY3RlZCBzdGF0ZSwgdGhlIGRvY3VtZW50IGlzIG5vdCBtb2RpZmllZC5cbiAqXG4gKiBAcGFyYW0gbXV0YXRpb24gLSBUaGUgbXV0YXRpb24gdG8gYXBwbHkuXG4gKiBAcGFyYW0gZG9jdW1lbnQgLSBUaGUgZG9jdW1lbnQgdG8gbXV0YXRlLiBUaGUgaW5wdXQgZG9jdW1lbnQgY2FuIGJlIGFuXG4gKiAgICAgaW52YWxpZCBkb2N1bWVudCBpZiB0aGUgY2xpZW50IGhhcyBubyBrbm93bGVkZ2Ugb2YgdGhlIHByZS1tdXRhdGlvbiBzdGF0ZVxuICogICAgIG9mIHRoZSBkb2N1bWVudC5cbiAqIEBwYXJhbSBwcmV2aW91c01hc2sgLSBUaGUgZmllbGRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgYmVmb3JlIGFwcGx5aW5nIHRoaXMgbXV0YXRpb24uXG4gKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBBIHRpbWVzdGFtcCBpbmRpY2F0aW5nIHRoZSBsb2NhbCB3cml0ZSB0aW1lIG9mIHRoZVxuICogICAgIGJhdGNoIHRoaXMgbXV0YXRpb24gaXMgYSBwYXJ0IG9mLlxuICogQHJldHVybnMgQSBgRmllbGRNYXNrYCByZXByZXNlbnRpbmcgdGhlIGZpZWxkcyB0aGF0IGFyZSBjaGFuZ2VkIGJ5IGFwcGx5aW5nIHRoaXMgbXV0YXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhlLCB0LCBuLCByKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2V0TXV0YXRpb24gPyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0TXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfcHJlY29uZGl0aW9uSXNWYWxpZEZvckRvY3VtZW50KGUucHJlY29uZGl0aW9uLCB0KSkgXG4gICAgICAgIC8vIFRoZSBtdXRhdGlvbiBmYWlsZWQgdG8gYXBwbHkgKGUuZy4gYSBkb2N1bWVudCBJRCBjcmVhdGVkIHdpdGggYWRkKClcbiAgICAgICAgLy8gY2F1c2VkIGEgbmFtZSBjb2xsaXNpb24pLlxuICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgY29uc3QgaSA9IGUudmFsdWUuY2xvbmUoKSwgcyA9IF9fUFJJVkFURV9sb2NhbFRyYW5zZm9ybVJlc3VsdHMoZS5maWVsZFRyYW5zZm9ybXMsIHIsIHQpO1xuICAgICAgICByZXR1cm4gaS5zZXRBbGwocyksIHQuY29udmVydFRvRm91bmREb2N1bWVudCh0LnZlcnNpb24sIGkpLnNldEhhc0xvY2FsTXV0YXRpb25zKCksIFxuICAgICAgICBudWxsO1xuIC8vIFNldE11dGF0aW9uIG92ZXJ3cml0ZXMgYWxsIGZpZWxkcy5cbiAgICAgICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IG1vZGlmaWVzIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgYXQgdGhlIGdpdmVuIGtleSB3aXRoIHRoZVxuICogZ2l2ZW4gdmFsdWVzLiBUaGUgdmFsdWVzIGFyZSBhcHBsaWVkIHRocm91Z2ggYSBmaWVsZCBtYXNrOlxuICpcbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBib3RoIHRoZSBtYXNrIGFuZCB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZyBmaWVsZFxuICogICAgaXMgdXBkYXRlZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBuZWl0aGVyIHRoZSBtYXNrIG5vciB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZ1xuICogICAgZmllbGQgaXMgdW5tb2RpZmllZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiB0aGUgbWFzayBidXQgbm90IGluIHRoZSB2YWx1ZXMsIHRoZSBjb3JyZXNwb25kaW5nIGZpZWxkXG4gKiAgICBpcyBkZWxldGVkLlxuICogICogV2hlbiBhIGZpZWxkIGlzIG5vdCBpbiB0aGUgbWFzayBidXQgaXMgaW4gdGhlIHZhbHVlcywgdGhlIHZhbHVlcyBtYXAgaXNcbiAqICAgIGlnbm9yZWQuXG4gKi8gKGUsIHQsIG4sIHIpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uID8gZnVuY3Rpb24gX19QUklWQVRFX3BhdGNoTXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfcHJlY29uZGl0aW9uSXNWYWxpZEZvckRvY3VtZW50KGUucHJlY29uZGl0aW9uLCB0KSkgcmV0dXJuIG47XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbG9jYWxUcmFuc2Zvcm1SZXN1bHRzKGUuZmllbGRUcmFuc2Zvcm1zLCByLCB0KSwgcyA9IHQuZGF0YTtcbiAgICAgICAgaWYgKHMuc2V0QWxsKF9fUFJJVkFURV9nZXRQYXRjaChlKSksIHMuc2V0QWxsKGkpLCB0LmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQodC52ZXJzaW9uLCBzKS5zZXRIYXNMb2NhbE11dGF0aW9ucygpLCBcbiAgICAgICAgbnVsbCA9PT0gbikgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiBuLnVuaW9uV2l0aChlLmZpZWxkTWFzay5maWVsZHMpLnVuaW9uV2l0aChlLmZpZWxkVHJhbnNmb3Jtcy5tYXAoKGUgPT4gZS5maWVsZCkpKTtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIGEgRmllbGRQYXRoL1ZhbHVlIG1hcCB3aXRoIHRoZSBjb250ZW50IG9mIHRoZSBQYXRjaE11dGF0aW9uLlxuICovIChlLCB0LCBuLCByKSA6IGZ1bmN0aW9uIF9fUFJJVkFURV9kZWxldGVNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcoZSwgdCwgbikge1xuICAgICAgICBpZiAoX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIHJldHVybiB0LmNvbnZlcnRUb05vRG9jdW1lbnQodC52ZXJzaW9uKS5zZXRIYXNMb2NhbE11dGF0aW9ucygpLCBcbiAgICAgICAgbnVsbDtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IHZlcmlmaWVzIHRoZSBleGlzdGVuY2Ugb2YgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aFxuICogdGhlIHByb3ZpZGVkIHByZWNvbmRpdGlvbi5cbiAqXG4gKiBUaGUgYHZlcmlmeWAgb3BlcmF0aW9uIGlzIG9ubHkgdXNlZCBpbiBUcmFuc2FjdGlvbnMsIGFuZCB0aGlzIGNsYXNzIHNlcnZlc1xuICogcHJpbWFyaWx5IHRvIGZhY2lsaXRhdGUgc2VyaWFsaXphdGlvbiBpbnRvIHByb3Rvcy5cbiAqLyAoZSwgdCwgbik7XG59XG5cbi8qKlxuICogSWYgdGhpcyBtdXRhdGlvbiBpcyBub3QgaWRlbXBvdGVudCwgcmV0dXJucyB0aGUgYmFzZSB2YWx1ZSB0byBwZXJzaXN0IHdpdGhcbiAqIHRoaXMgbXV0YXRpb24uIElmIGEgYmFzZSB2YWx1ZSBpcyByZXR1cm5lZCwgdGhlIG11dGF0aW9uIGlzIGFsd2F5cyBhcHBsaWVkXG4gKiB0byB0aGlzIGJhc2UgdmFsdWUsIGV2ZW4gaWYgZG9jdW1lbnQgaGFzIGFscmVhZHkgYmVlbiB1cGRhdGVkLlxuICpcbiAqIFRoZSBiYXNlIHZhbHVlIGlzIGEgc3BhcnNlIG9iamVjdCB0aGF0IGNvbnNpc3RzIG9mIG9ubHkgdGhlIGRvY3VtZW50XG4gKiBmaWVsZHMgZm9yIHdoaWNoIHRoaXMgbXV0YXRpb24gY29udGFpbnMgYSBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1hdGlvblxuICogKGUuZy4gYSBudW1lcmljIGluY3JlbWVudCkuIFRoZSBwcm92aWRlZCB2YWx1ZSBndWFyYW50ZWVzIGNvbnNpc3RlbnRcbiAqIGJlaGF2aW9yIGZvciBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1zIGFuZCBhbGxvdyB1cyB0byByZXR1cm4gdGhlIHNhbWVcbiAqIGxhdGVuY3ktY29tcGVuc2F0ZWQgdmFsdWUgZXZlbiBpZiB0aGUgYmFja2VuZCBoYXMgYWxyZWFkeSBhcHBsaWVkIHRoZVxuICogbXV0YXRpb24uIFRoZSBiYXNlIHZhbHVlIGlzIG51bGwgZm9yIGlkZW1wb3RlbnQgbXV0YXRpb25zLCBhcyB0aGV5IGNhbiBiZVxuICogcmUtcGxheWVkIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzIGFscmVhZHkgYXBwbGllZCB0aGVtLlxuICpcbiAqIEByZXR1cm5zIGEgYmFzZSB2YWx1ZSB0byBzdG9yZSBhbG9uZyB3aXRoIHRoZSBtdXRhdGlvbiwgb3IgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgbXV0YXRpb25zLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvbkV4dHJhY3RCYXNlVmFsdWUoZSwgdCkge1xuICAgIGxldCBuID0gbnVsbDtcbiAgICBmb3IgKGNvbnN0IHIgb2YgZS5maWVsZFRyYW5zZm9ybXMpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZChyLmZpZWxkKSwgaSA9IF9fUFJJVkFURV9jb21wdXRlVHJhbnNmb3JtT3BlcmF0aW9uQmFzZVZhbHVlKHIudHJhbnNmb3JtLCBlIHx8IG51bGwpO1xuICAgICAgICBudWxsICE9IGkgJiYgKG51bGwgPT09IG4gJiYgKG4gPSBPYmplY3RWYWx1ZS5lbXB0eSgpKSwgbi5zZXQoci5maWVsZCwgaSkpO1xuICAgIH1cbiAgICByZXR1cm4gbiB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25FcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBlLnR5cGUgPT09IHQudHlwZSAmJiAoISFlLmtleS5pc0VxdWFsKHQua2V5KSAmJiAoISFlLnByZWNvbmRpdGlvbi5pc0VxdWFsKHQucHJlY29uZGl0aW9uKSAmJiAoISFmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRUcmFuc2Zvcm1zQXJlRXF1YWwoZSwgdCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlICYmIHZvaWQgMCA9PT0gdCB8fCAhKCFlIHx8ICF0KSAmJiBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZSwgdCwgKChlLCB0KSA9PiBfX1BSSVZBVEVfZmllbGRUcmFuc2Zvcm1FcXVhbHMoZSwgdCkpKTtcbiAgICB9KGUuZmllbGRUcmFuc2Zvcm1zLCB0LmZpZWxkVHJhbnNmb3JtcykgJiYgKDAgLyogTXV0YXRpb25UeXBlLlNldCAqLyA9PT0gZS50eXBlID8gZS52YWx1ZS5pc0VxdWFsKHQudmFsdWUpIDogMSAvKiBNdXRhdGlvblR5cGUuUGF0Y2ggKi8gIT09IGUudHlwZSB8fCBlLmRhdGEuaXNFcXVhbCh0LmRhdGEpICYmIGUuZmllbGRNYXNrLmlzRXF1YWwodC5maWVsZE1hc2spKSkpKTtcbn1cblxuLyoqXG4gKiBBIG11dGF0aW9uIHRoYXQgY3JlYXRlcyBvciByZXBsYWNlcyB0aGUgZG9jdW1lbnQgYXQgdGhlIGdpdmVuIGtleSB3aXRoIHRoZVxuICogb2JqZWN0IHZhbHVlIGNvbnRlbnRzLlxuICovIGNsYXNzIF9fUFJJVkFURV9TZXRNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSBlLCB0aGlzLnZhbHVlID0gdCwgdGhpcy5wcmVjb25kaXRpb24gPSBuLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IHIsIFxuICAgICAgICB0aGlzLnR5cGUgPSAwIC8qIE11dGF0aW9uVHlwZS5TZXQgKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSBlLCB0aGlzLmRhdGEgPSB0LCB0aGlzLmZpZWxkTWFzayA9IG4sIHRoaXMucHJlY29uZGl0aW9uID0gciwgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gaSwgdGhpcy50eXBlID0gMSAvKiBNdXRhdGlvblR5cGUuUGF0Y2ggKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmllbGRNYXNrO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFBhdGNoKGUpIHtcbiAgICBjb25zdCB0ID0gbmV3IE1hcDtcbiAgICByZXR1cm4gZS5maWVsZE1hc2suZmllbGRzLmZvckVhY2goKG4gPT4ge1xuICAgICAgICBpZiAoIW4uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICBjb25zdCByID0gZS5kYXRhLmZpZWxkKG4pO1xuICAgICAgICAgICAgdC5zZXQobiwgcik7XG4gICAgICAgIH1cbiAgICB9KSksIHQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGxpc3Qgb2YgXCJ0cmFuc2Zvcm0gcmVzdWx0c1wiIChhIHRyYW5zZm9ybSByZXN1bHQgaXMgYSBmaWVsZCB2YWx1ZVxuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYSB0cmFuc2Zvcm0pIGZvciB1c2UgYWZ0ZXIgYSBtdXRhdGlvblxuICogY29udGFpbmluZyB0cmFuc2Zvcm1zIGhhcyBiZWVuIGFja25vd2xlZGdlZCBieSB0aGUgc2VydmVyLlxuICpcbiAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBUaGUgZmllbGQgdHJhbnNmb3JtcyB0byBhcHBseSB0aGUgcmVzdWx0IHRvLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkb2N1bWVudCBhZnRlciBhcHBseWluZyBhbGxcbiAqIHByZXZpb3VzIG11dGF0aW9ucy5cbiAqIEBwYXJhbSBzZXJ2ZXJUcmFuc2Zvcm1SZXN1bHRzIC0gVGhlIHRyYW5zZm9ybSByZXN1bHRzIHJlY2VpdmVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgbGlzdC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG5ldyBNYXA7XG4gICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS5sZW5ndGggPT09IG4ubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcyA9IGVbaV0sIG8gPSBzLnRyYW5zZm9ybSwgXyA9IHQuZGF0YS5maWVsZChzLmZpZWxkKTtcbiAgICAgICAgci5zZXQocy5maWVsZCwgX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9SZW1vdGVEb2N1bWVudChvLCBfLCBuW2ldKSk7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBsaXN0IG9mIFwidHJhbnNmb3JtIHJlc3VsdHNcIiAoYSB0cmFuc2Zvcm0gcmVzdWx0IGlzIGEgZmllbGQgdmFsdWVcbiAqIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGEgdHJhbnNmb3JtKSBmb3IgdXNlIHdoZW4gYXBwbHlpbmcgYVxuICogdHJhbnNmb3JtIGxvY2FsbHkuXG4gKlxuICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIFRoZSBmaWVsZCB0cmFuc2Zvcm1zIHRvIGFwcGx5IHRoZSByZXN1bHQgdG8uXG4gKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBUaGUgbG9jYWwgdGltZSBvZiB0aGUgbXV0YXRpb24gKHVzZWQgdG9cbiAqICAgICBnZW5lcmF0ZSBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMpLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhcHBseSB0cmFuc2Zvcm1zIG9uLlxuICogQHJldHVybnMgVGhlIHRyYW5zZm9ybSByZXN1bHRzIGxpc3QuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsVHJhbnNmb3JtUmVzdWx0cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG5ldyBNYXA7XG4gICAgZm9yIChjb25zdCBpIG9mIGUpIHtcbiAgICAgICAgY29uc3QgZSA9IGkudHJhbnNmb3JtLCBzID0gbi5kYXRhLmZpZWxkKGkuZmllbGQpO1xuICAgICAgICByLnNldChpLmZpZWxkLCBfX1BSSVZBVEVfYXBwbHlUcmFuc2Zvcm1PcGVyYXRpb25Ub0xvY2FsVmlldyhlLCBzLCB0KSk7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG4vKiogQSBtdXRhdGlvbiB0aGF0IGRlbGV0ZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkuICovIGNsYXNzIF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy5wcmVjb25kaXRpb24gPSB0LCB0aGlzLnR5cGUgPSAyIC8qIE11dGF0aW9uVHlwZS5EZWxldGUgKi8gLCBcbiAgICAgICAgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG4gICAgZ2V0RmllbGRNYXNrKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9WZXJpZnlNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy5wcmVjb25kaXRpb24gPSB0LCB0aGlzLnR5cGUgPSAzIC8qIE11dGF0aW9uVHlwZS5WZXJpZnkgKi8gLCBcbiAgICAgICAgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG4gICAgZ2V0RmllbGRNYXNrKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYmF0Y2ggb2YgbXV0YXRpb25zIHRoYXQgd2lsbCBiZSBzZW50IGFzIG9uZSB1bml0IHRvIHRoZSBiYWNrZW5kLlxuICovIGNsYXNzIE11dGF0aW9uQmF0Y2gge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBiYXRjaElkIC0gVGhlIHVuaXF1ZSBJRCBvZiB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIEBwYXJhbSBsb2NhbFdyaXRlVGltZSAtIFRoZSBvcmlnaW5hbCB3cml0ZSB0aW1lIG9mIHRoaXMgbXV0YXRpb24uXG4gICAgICogQHBhcmFtIGJhc2VNdXRhdGlvbnMgLSBNdXRhdGlvbnMgdGhhdCBhcmUgdXNlZCB0byBwb3B1bGF0ZSB0aGUgYmFzZVxuICAgICAqIHZhbHVlcyB3aGVuIHRoaXMgbXV0YXRpb24gaXMgYXBwbGllZCBsb2NhbGx5LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGxvY2FsbHlcbiAgICAgKiBvdmVyd3JpdGUgdmFsdWVzIHRoYXQgYXJlIHBlcnNpc3RlZCBpbiB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlLiBCYXNlXG4gICAgICogbXV0YXRpb25zIGFyZSBuZXZlciBzZW50IHRvIHRoZSBiYWNrZW5kLlxuICAgICAqIEBwYXJhbSBtdXRhdGlvbnMgLSBUaGUgdXNlci1wcm92aWRlZCBtdXRhdGlvbnMgaW4gdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBVc2VyLXByb3ZpZGVkIG11dGF0aW9ucyBhcmUgYXBwbGllZCBib3RoIGxvY2FsbHkgYW5kIHJlbW90ZWx5IG9uIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmJhdGNoSWQgPSBlLCB0aGlzLmxvY2FsV3JpdGVUaW1lID0gdCwgdGhpcy5iYXNlTXV0YXRpb25zID0gbiwgdGhpcy5tdXRhdGlvbnMgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGFsbCB0aGUgbXV0YXRpb25zIGluIHRoaXMgTXV0YXRpb25CYXRjaCB0byB0aGUgc3BlY2lmaWVkIGRvY3VtZW50XG4gICAgICogdG8gY29tcHV0ZSB0aGUgc3RhdGUgb2YgdGhlIHJlbW90ZSBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IG11dGF0aW9ucyB0by5cbiAgICAgKiBAcGFyYW0gYmF0Y2hSZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBNdXRhdGlvbkJhdGNoIHRvIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovICAgIGFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm11dGF0aW9uUmVzdWx0cztcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCB0aGlzLm11dGF0aW9ucy5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMubXV0YXRpb25zW3RdO1xuICAgICAgICAgICAgaWYgKHIua2V5LmlzRXF1YWwoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX211dGF0aW9uQXBwbHlUb1JlbW90ZURvY3VtZW50KHIsIGUsIG5bdF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIHRoZSBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQgZ2l2ZW4gYWxsIHRoZSBtdXRhdGlvbnMgaW4gdGhpc1xuICAgICAqIGJhdGNoLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IG11dGF0aW9ucyB0by5cbiAgICAgKiBAcGFyYW0gbXV0YXRlZEZpZWxkcyAtIEZpZWxkcyB0aGF0IGhhdmUgYmVlbiB1cGRhdGVkIGJlZm9yZSBhcHBseWluZyB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIEByZXR1cm5zIEEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIGFsbCB0aGUgZmllbGRzIHRoYXQgYXJlIG11dGF0ZWQuXG4gICAgICovICAgIGFwcGx5VG9Mb2NhbFZpZXcoZSwgdCkge1xuICAgICAgICAvLyBGaXJzdCwgYXBwbHkgdGhlIGJhc2Ugc3RhdGUuIFRoaXMgYWxsb3dzIHVzIHRvIGFwcGx5IG5vbi1pZGVtcG90ZW50XG4gICAgICAgIC8vIHRyYW5zZm9ybSBhZ2FpbnN0IGEgY29uc2lzdGVudCBzZXQgb2YgdmFsdWVzLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5iYXNlTXV0YXRpb25zKSBuLmtleS5pc0VxdWFsKGUua2V5KSAmJiAodCA9IF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcobiwgZSwgdCwgdGhpcy5sb2NhbFdyaXRlVGltZSkpO1xuICAgICAgICAvLyBTZWNvbmQsIGFwcGx5IGFsbCB1c2VyLXByb3ZpZGVkIG11dGF0aW9ucy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5tdXRhdGlvbnMpIG4ua2V5LmlzRXF1YWwoZS5rZXkpICYmICh0ID0gX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhuLCBlLCB0LCB0aGlzLmxvY2FsV3JpdGVUaW1lKSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBmb3IgYWxsIHByb3ZpZGVkIGRvY3VtZW50cyBnaXZlbiB0aGUgbXV0YXRpb25zIGluXG4gICAgICogdGhpcyBiYXRjaC4gUmV0dXJucyBhIGBEb2N1bWVudEtleWAgdG8gYE11dGF0aW9uYCBtYXAgd2hpY2ggY2FuIGJlIHVzZWQgdG9cbiAgICAgKiByZXBsYWNlIGFsbCB0aGUgbXV0YXRpb24gYXBwbGljYXRpb25zLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxEb2N1bWVudFNldChlLCB0KSB7XG4gICAgICAgIC8vIFRPRE8obXJzY2htaWR0KTogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBPKG5eMikuIElmIHdlIGFwcGx5IHRoZSBtdXRhdGlvbnNcbiAgICAgICAgLy8gZGlyZWN0bHkgKGFzIGRvbmUgaW4gYGFwcGx5VG9Mb2NhbFZpZXcoKWApLCB3ZSBjYW4gcmVkdWNlIHRoZSBjb21wbGV4aXR5XG4gICAgICAgIC8vIHRvIE8obikuXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3TXV0YXRpb25NYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25zLmZvckVhY2goKHIgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IGUuZ2V0KHIua2V5KSwgcyA9IGkub3ZlcmxheWVkRG9jdW1lbnQ7XG4gICAgICAgICAgICAvLyBUT0RPKG11dGFibGVkb2N1bWVudHMpOiBUaGlzIG1ldGhvZCBzaG91bGQgdGFrZSBhIE11dGFibGVEb2N1bWVudE1hcFxuICAgICAgICAgICAgLy8gYW5kIHdlIHNob3VsZCByZW1vdmUgdGhpcyBjYXN0LlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG8gPSB0aGlzLmFwcGx5VG9Mb2NhbFZpZXcocywgaS5tdXRhdGVkRmllbGRzKTtcbiAgICAgICAgICAgIC8vIFNldCBtdXRhdGVkRmllbGRzIHRvIG51bGwgaWYgdGhlIGRvY3VtZW50IGlzIG9ubHkgZnJvbSBsb2NhbCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAvLyBUaGlzIGNyZWF0ZXMgYSBTZXQgb3IgRGVsZXRlIG11dGF0aW9uLCBpbnN0ZWFkIG9mIHRyeWluZyB0byBjcmVhdGUgYVxuICAgICAgICAgICAgLy8gcGF0Y2ggbXV0YXRpb24gYXMgdGhlIG92ZXJsYXkuXG4gICAgICAgICAgICAgICAgICAgICAgICBvID0gdC5oYXMoci5rZXkpID8gbnVsbCA6IG87XG4gICAgICAgICAgICBjb25zdCBfID0gX19QUklWQVRFX2NhbGN1bGF0ZU92ZXJsYXlNdXRhdGlvbihzLCBvKTtcbiAgICAgICAgICAgIG51bGwgIT09IF8gJiYgbi5zZXQoci5rZXksIF8pLCBzLmlzVmFsaWREb2N1bWVudCgpIHx8IHMuY29udmVydFRvTm9Eb2N1bWVudChTbmFwc2hvdFZlcnNpb24ubWluKCkpO1xuICAgICAgICB9KSksIG47XG4gICAgfVxuICAgIGtleXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9ucy5yZWR1Y2UoKChlLCB0KSA9PiBlLmFkZCh0LmtleSkpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXRjaElkID09PSBlLmJhdGNoSWQgJiYgX19QUklWQVRFX2FycmF5RXF1YWxzKHRoaXMubXV0YXRpb25zLCBlLm11dGF0aW9ucywgKChlLCB0KSA9PiBfX1BSSVZBVEVfbXV0YXRpb25FcXVhbHMoZSwgdCkpKSAmJiBfX1BSSVZBVEVfYXJyYXlFcXVhbHModGhpcy5iYXNlTXV0YXRpb25zLCBlLmJhc2VNdXRhdGlvbnMsICgoZSwgdCkgPT4gX19QUklWQVRFX211dGF0aW9uRXF1YWxzKGUsIHQpKSk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIG11dGF0aW9uIGJhdGNoIHRvIHRoZSBiYWNrZW5kLiAqLyBjbGFzcyBNdXRhdGlvbkJhdGNoUmVzdWx0IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCBcbiAgICAvKipcbiAgICAgKiBBIHByZS1jb21wdXRlZCBtYXBwaW5nIGZyb20gZWFjaCBtdXRhdGVkIGRvY3VtZW50IHRvIHRoZSByZXN1bHRpbmdcbiAgICAgKiB2ZXJzaW9uLlxuICAgICAqL1xuICAgIHIpIHtcbiAgICAgICAgdGhpcy5iYXRjaCA9IGUsIHRoaXMuY29tbWl0VmVyc2lvbiA9IHQsIHRoaXMubXV0YXRpb25SZXN1bHRzID0gbiwgdGhpcy5kb2NWZXJzaW9ucyA9IHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTXV0YXRpb25CYXRjaFJlc3VsdCBmb3IgdGhlIGdpdmVuIGJhdGNoIGFuZCByZXN1bHRzLiBUaGVyZVxuICAgICAqIG11c3QgYmUgb25lIHJlc3VsdCBmb3IgZWFjaCBtdXRhdGlvbiBpbiB0aGUgYmF0Y2guIFRoaXMgc3RhdGljIGZhY3RvcnlcbiAgICAgKiBjYWNoZXMgYSBkb2N1bWVudD0mZ3Q7dmVyc2lvbiBtYXBwaW5nIChkb2NWZXJzaW9ucykuXG4gICAgICovICAgIHN0YXRpYyBmcm9tKGUsIHQsIG4pIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS5tdXRhdGlvbnMubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgICAgIGxldCByID0gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50VmVyc2lvbk1hcCgpIHtcbiAgICAgICAgICAgIHJldHVybiBvZTtcbiAgICAgICAgfSgpO1xuICAgICAgICBjb25zdCBpID0gZS5tdXRhdGlvbnM7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgaS5sZW5ndGg7IGUrKykgciA9IHIuaW5zZXJ0KGlbZV0ua2V5LCBuW2VdLnZlcnNpb24pO1xuICAgICAgICByZXR1cm4gbmV3IE11dGF0aW9uQmF0Y2hSZXN1bHQoZSwgdCwgbiwgcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhbiBvdmVybGF5IGNvbXB1dGVkIGJ5IEZpcmVzdG9yZS5cbiAqXG4gKiBIb2xkcyBpbmZvcm1hdGlvbiBhYm91dCBhIG11dGF0aW9uIGFuZCB0aGUgbGFyZ2VzdCBiYXRjaCBpZCBpbiBGaXJlc3RvcmUgd2hlblxuICogdGhlIG11dGF0aW9uIHdhcyBjcmVhdGVkLlxuICovIGNsYXNzIE92ZXJsYXkge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5sYXJnZXN0QmF0Y2hJZCA9IGUsIHRoaXMubXV0YXRpb24gPSB0O1xuICAgIH1cbiAgICBnZXRLZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9uLmtleTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlICYmIHRoaXMubXV0YXRpb24gPT09IGUubXV0YXRpb247XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYE92ZXJsYXl7XFxuICAgICAgbGFyZ2VzdEJhdGNoSWQ6ICR7dGhpcy5sYXJnZXN0QmF0Y2hJZH0sXFxuICAgICAgbXV0YXRpb246ICR7dGhpcy5tdXRhdGlvbi50b1N0cmluZygpfVxcbiAgICB9YDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbmNyZXRlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBBZ2dyZWdhdGUgdHlwZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQWdncmVnYXRlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLmFsaWFzID0gZSwgdGhpcy5FZSA9IHQsIHRoaXMuZmllbGRQYXRoID0gbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIEV4aXN0ZW5jZUZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gZSwgdGhpcy51bmNoYW5nZWROYW1lcyA9IHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBFcnJvciBDb2RlcyBkZXNjcmliaW5nIHRoZSBkaWZmZXJlbnQgd2F5cyBHUlBDIGNhbiBmYWlsLiBUaGVzZSBhcmUgY29waWVkXG4gKiBkaXJlY3RseSBmcm9tIEdSUEMncyBzb3VyY2VzIGhlcmU6XG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy9ibG9iL2JjZWVjOTRlYTRmYzVmMDA4NWQ4MTIzNWQ4ZTFjMDY3OThkYzM0MWEvaW5jbHVkZS9ncnBjJTJCJTJCL2ltcGwvY29kZWdlbi9zdGF0dXNfY29kZV9lbnVtLmhcbiAqXG4gKiBJbXBvcnRhbnQhIFRoZSBuYW1lcyBvZiB0aGVzZSBpZGVudGlmaWVycyBtYXR0ZXIgYmVjYXVzZSB0aGUgc3RyaW5nIGZvcm1zXG4gKiBhcmUgdXNlZCBmb3IgcmV2ZXJzZSBsb29rdXBzIGZyb20gdGhlIHdlYmNoYW5uZWwgc3RyZWFtLiBEbyBOT1QgY2hhbmdlIHRoZVxuICogbmFtZXMgb2YgdGhlc2UgaWRlbnRpZmllcnMgb3IgY2hhbmdlIHRoaXMgaW50byBhIGNvbnN0IGVudW0uXG4gKi8gdmFyIHVlLCBjZTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgY29kZSByZXByZXNlbnRzIGEgcGVybWFuZW50IGVycm9yIHdoZW4gcmVjZWl2ZWRcbiAqIGluIHJlc3BvbnNlIHRvIGEgbm9uLXdyaXRlIG9wZXJhdGlvbi5cbiAqXG4gKiBTZWUgaXNQZXJtYW5lbnRXcml0ZUVycm9yIGZvciBjbGFzc2lmeWluZyB3cml0ZSBlcnJvcnMuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1Blcm1hbmVudEVycm9yKGUpIHtcbiAgICBzd2l0Y2ggKGUpIHtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWlsKCk7XG5cbiAgICAgIGNhc2Ugdi5DQU5DRUxMRUQ6XG4gICAgICBjYXNlIHYuVU5LTk9XTjpcbiAgICAgIGNhc2Ugdi5ERUFETElORV9FWENFRURFRDpcbiAgICAgIGNhc2Ugdi5SRVNPVVJDRV9FWEhBVVNURUQ6XG4gICAgICBjYXNlIHYuSU5URVJOQUw6XG4gICAgICBjYXNlIHYuVU5BVkFJTEFCTEU6XG4gLy8gVW5hdXRoZW50aWNhdGVkIG1lYW5zIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggb3VyIHRva2VuIGFuZCB3ZSBuZWVkXG4gICAgICAgIC8vIHRvIHJldHJ5IHdpdGggbmV3IGNyZWRlbnRpYWxzIHdoaWNoIHdpbGwgaGFwcGVuIGF1dG9tYXRpY2FsbHkuXG4gICAgICAgICAgICAgIGNhc2Ugdi5VTkFVVEhFTlRJQ0FURUQ6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgY2FzZSB2LklOVkFMSURfQVJHVU1FTlQ6XG4gICAgICBjYXNlIHYuTk9UX0ZPVU5EOlxuICAgICAgY2FzZSB2LkFMUkVBRFlfRVhJU1RTOlxuICAgICAgY2FzZSB2LlBFUk1JU1NJT05fREVOSUVEOlxuICAgICAgY2FzZSB2LkZBSUxFRF9QUkVDT05ESVRJT046XG4gLy8gQWJvcnRlZCBtaWdodCBiZSByZXRyaWVkIGluIHNvbWUgc2NlbmFyaW9zLCBidXQgdGhhdCBpcyBkZXBlbmRhbnQgb25cbiAgICAgICAgLy8gdGhlIGNvbnRleHQgYW5kIHNob3VsZCBoYW5kbGVkIGluZGl2aWR1YWxseSBieSB0aGUgY2FsbGluZyBjb2RlLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2FwaXMvZGVzaWduL2Vycm9ycy5cbiAgICAgICAgICAgICAgY2FzZSB2LkFCT1JURUQ6XG4gICAgICBjYXNlIHYuT1VUX09GX1JBTkdFOlxuICAgICAgY2FzZSB2LlVOSU1QTEVNRU5URUQ6XG4gICAgICBjYXNlIHYuREFUQV9MT1NTOlxuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhbiBlcnJvciBjb2RlIHJlcHJlc2VudHMgYSBwZXJtYW5lbnQgZXJyb3Igd2hlbiByZWNlaXZlZFxuICogaW4gcmVzcG9uc2UgdG8gYSB3cml0ZSBvcGVyYXRpb24uXG4gKlxuICogV3JpdGUgb3BlcmF0aW9ucyBtdXN0IGJlIGhhbmRsZWQgc3BlY2lhbGx5IGJlY2F1c2UgYXMgb2YgYi8xMTk0Mzc3NjQsIEFCT1JURURcbiAqIGVycm9ycyBvbiB0aGUgd3JpdGUgc3RyZWFtIHNob3VsZCBiZSByZXRyaWVkIHRvbyAoZXZlbiB0aG91Z2ggQUJPUlRFRCBlcnJvcnNcbiAqIGFyZSBub3QgZ2VuZXJhbGx5IHJldHJ5YWJsZSkuXG4gKlxuICogTm90ZSB0aGF0IGR1cmluZyB0aGUgaW5pdGlhbCBoYW5kc2hha2Ugb24gdGhlIHdyaXRlIHN0cmVhbSBhbiBBQk9SVEVEIGVycm9yXG4gKiBzaWduYWxzIHRoYXQgd2Ugc2hvdWxkIGRpc2NhcmQgb3VyIHN0cmVhbSB0b2tlbiAoaS5lLiBpdCBpcyBwZXJtYW5lbnQpLiBUaGlzXG4gKiBtZWFucyBhIGhhbmRzaGFrZSBlcnJvciBzaG91bGQgYmUgY2xhc3NpZmllZCB3aXRoIGlzUGVybWFuZW50RXJyb3IsIGFib3ZlLlxuICovXG4vKipcbiAqIE1hcHMgYW4gZXJyb3IgQ29kZSBmcm9tIEdSUEMgc3RhdHVzIGNvZGUgbnVtYmVyLCBsaWtlIDAsIDEsIG9yIDE0LiBUaGVzZVxuICogYXJlIG5vdCB0aGUgc2FtZSBhcyBIVFRQIHN0YXR1cyBjb2Rlcy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBHUlBDIHN0YXR1cyBjb2RlLiBGYWlscyBpZiB0aGVyZVxuICogICAgIGlzIG5vIG1hdGNoLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbWFwQ29kZUZyb21ScGNDb2RlKGUpIHtcbiAgICBpZiAodm9pZCAwID09PSBlKSBcbiAgICAvLyBUaGlzIHNob3VsZG4ndCBub3JtYWxseSBoYXBwZW4sIGJ1dCBpbiBjZXJ0YWluIGVycm9yIGNhc2VzIChsaWtlIHRyeWluZ1xuICAgIC8vIHRvIHNlbmQgaW52YWxpZCBwcm90byBtZXNzYWdlcykgd2UgbWF5IGdldCBhbiBlcnJvciB3aXRoIG5vIEdSUEMgY29kZS5cbiAgICByZXR1cm4gX19QUklWQVRFX2xvZ0Vycm9yKFwiR1JQQyBlcnJvciBoYXMgbm8gLmNvZGVcIiksIHYuVU5LTk9XTjtcbiAgICBzd2l0Y2ggKGUpIHtcbiAgICAgIGNhc2UgdWUuT0s6XG4gICAgICAgIHJldHVybiB2Lk9LO1xuXG4gICAgICBjYXNlIHVlLkNBTkNFTExFRDpcbiAgICAgICAgcmV0dXJuIHYuQ0FOQ0VMTEVEO1xuXG4gICAgICBjYXNlIHVlLlVOS05PV046XG4gICAgICAgIHJldHVybiB2LlVOS05PV047XG5cbiAgICAgIGNhc2UgdWUuREVBRExJTkVfRVhDRUVERUQ6XG4gICAgICAgIHJldHVybiB2LkRFQURMSU5FX0VYQ0VFREVEO1xuXG4gICAgICBjYXNlIHVlLlJFU09VUkNFX0VYSEFVU1RFRDpcbiAgICAgICAgcmV0dXJuIHYuUkVTT1VSQ0VfRVhIQVVTVEVEO1xuXG4gICAgICBjYXNlIHVlLklOVEVSTkFMOlxuICAgICAgICByZXR1cm4gdi5JTlRFUk5BTDtcblxuICAgICAgY2FzZSB1ZS5VTkFWQUlMQUJMRTpcbiAgICAgICAgcmV0dXJuIHYuVU5BVkFJTEFCTEU7XG5cbiAgICAgIGNhc2UgdWUuVU5BVVRIRU5USUNBVEVEOlxuICAgICAgICByZXR1cm4gdi5VTkFVVEhFTlRJQ0FURUQ7XG5cbiAgICAgIGNhc2UgdWUuSU5WQUxJRF9BUkdVTUVOVDpcbiAgICAgICAgcmV0dXJuIHYuSU5WQUxJRF9BUkdVTUVOVDtcblxuICAgICAgY2FzZSB1ZS5OT1RfRk9VTkQ6XG4gICAgICAgIHJldHVybiB2Lk5PVF9GT1VORDtcblxuICAgICAgY2FzZSB1ZS5BTFJFQURZX0VYSVNUUzpcbiAgICAgICAgcmV0dXJuIHYuQUxSRUFEWV9FWElTVFM7XG5cbiAgICAgIGNhc2UgdWUuUEVSTUlTU0lPTl9ERU5JRUQ6XG4gICAgICAgIHJldHVybiB2LlBFUk1JU1NJT05fREVOSUVEO1xuXG4gICAgICBjYXNlIHVlLkZBSUxFRF9QUkVDT05ESVRJT046XG4gICAgICAgIHJldHVybiB2LkZBSUxFRF9QUkVDT05ESVRJT047XG5cbiAgICAgIGNhc2UgdWUuQUJPUlRFRDpcbiAgICAgICAgcmV0dXJuIHYuQUJPUlRFRDtcblxuICAgICAgY2FzZSB1ZS5PVVRfT0ZfUkFOR0U6XG4gICAgICAgIHJldHVybiB2Lk9VVF9PRl9SQU5HRTtcblxuICAgICAgY2FzZSB1ZS5VTklNUExFTUVOVEVEOlxuICAgICAgICByZXR1cm4gdi5VTklNUExFTUVOVEVEO1xuXG4gICAgICBjYXNlIHVlLkRBVEFfTE9TUzpcbiAgICAgICAgcmV0dXJuIHYuREFUQV9MT1NTO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBIVFRQIHJlc3BvbnNlJ3MgZXJyb3Igc3RhdHVzIHRvIHRoZSBlcXVpdmFsZW50IGVycm9yIGNvZGUuXG4gKlxuICogQHBhcmFtIHN0YXR1cyAtIEFuIEhUVFAgZXJyb3IgcmVzcG9uc2Ugc3RhdHVzIChcIkZBSUxFRF9QUkVDT05ESVRJT05cIixcbiAqIFwiVU5LTk9XTlwiLCBldGMuKVxuICogQHJldHVybnMgVGhlIGVxdWl2YWxlbnQgQ29kZS4gTm9uLW1hdGNoaW5nIHJlc3BvbnNlcyBhcmUgbWFwcGVkIHRvXG4gKiAgICAgQ29kZS5VTktOT1dOLlxuICovIChjZSA9IHVlIHx8ICh1ZSA9IHt9KSlbY2UuT0sgPSAwXSA9IFwiT0tcIiwgY2VbY2UuQ0FOQ0VMTEVEID0gMV0gPSBcIkNBTkNFTExFRFwiLCBcbmNlW2NlLlVOS05PV04gPSAyXSA9IFwiVU5LTk9XTlwiLCBjZVtjZS5JTlZBTElEX0FSR1VNRU5UID0gM10gPSBcIklOVkFMSURfQVJHVU1FTlRcIiwgXG5jZVtjZS5ERUFETElORV9FWENFRURFRCA9IDRdID0gXCJERUFETElORV9FWENFRURFRFwiLCBjZVtjZS5OT1RfRk9VTkQgPSA1XSA9IFwiTk9UX0ZPVU5EXCIsIFxuY2VbY2UuQUxSRUFEWV9FWElTVFMgPSA2XSA9IFwiQUxSRUFEWV9FWElTVFNcIiwgY2VbY2UuUEVSTUlTU0lPTl9ERU5JRUQgPSA3XSA9IFwiUEVSTUlTU0lPTl9ERU5JRURcIiwgXG5jZVtjZS5VTkFVVEhFTlRJQ0FURUQgPSAxNl0gPSBcIlVOQVVUSEVOVElDQVRFRFwiLCBjZVtjZS5SRVNPVVJDRV9FWEhBVVNURUQgPSA4XSA9IFwiUkVTT1VSQ0VfRVhIQVVTVEVEXCIsIFxuY2VbY2UuRkFJTEVEX1BSRUNPTkRJVElPTiA9IDldID0gXCJGQUlMRURfUFJFQ09ORElUSU9OXCIsIGNlW2NlLkFCT1JURUQgPSAxMF0gPSBcIkFCT1JURURcIiwgXG5jZVtjZS5PVVRfT0ZfUkFOR0UgPSAxMV0gPSBcIk9VVF9PRl9SQU5HRVwiLCBjZVtjZS5VTklNUExFTUVOVEVEID0gMTJdID0gXCJVTklNUExFTUVOVEVEXCIsIFxuY2VbY2UuSU5URVJOQUwgPSAxM10gPSBcIklOVEVSTkFMXCIsIGNlW2NlLlVOQVZBSUxBQkxFID0gMTRdID0gXCJVTkFWQUlMQUJMRVwiLCBjZVtjZS5EQVRBX0xPU1MgPSAxNV0gPSBcIkRBVEFfTE9TU1wiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBNYW5hZ2VzIFwidGVzdGluZyBob29rc1wiLCBob29rcyBpbnRvIHRoZSBpbnRlcm5hbHMgb2YgdGhlIFNESyB0byB2ZXJpZnlcbiAqIGludGVybmFsIHN0YXRlIGFuZCBldmVudHMgZHVyaW5nIGludGVncmF0aW9uIHRlc3RzLiBEbyBub3QgdXNlIHRoaXMgY2xhc3NcbiAqIGV4Y2VwdCBmb3IgdGVzdGluZyBwdXJwb3Nlcy5cbiAqXG4gKiBUaGVyZSBhcmUgdHdvIHdheXMgdG8gcmV0cmlldmUgdGhlIGdsb2JhbCBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzczpcbiAqIDEuIFRoZSBgaW5zdGFuY2VgIHByb3BlcnR5LCB3aGljaCByZXR1cm5zIG51bGwgaWYgdGhlIGdsb2JhbCBzaW5nbGV0b25cbiAqICAgICAgaW5zdGFuY2UgaGFzIG5vdCBiZWVuIGNyZWF0ZWQuIFVzZSB0aGlzIHByb3BlcnR5IGlmIHRoZSBjYWxsZXIgc2hvdWxkXG4gKiAgICAgIFwiZG8gbm90aGluZ1wiIGlmIHRoZXJlIGFyZSBubyB0ZXN0aW5nIGhvb2tzIHJlZ2lzdGVyZWQsIHN1Y2ggYXMgd2hlblxuICogICAgICBkZWxpdmVyaW5nIGFuIGV2ZW50IHRvIG5vdGlmeSByZWdpc3RlcmVkIGNhbGxiYWNrcy5cbiAqIDIuIFRoZSBgZ2V0T3JDcmVhdGVJbnN0YW5jZSgpYCBtZXRob2QsIHdoaWNoIGNyZWF0ZXMgdGhlIGdsb2JhbCBzaW5nbGV0b25cbiAqICAgICAgaW5zdGFuY2UgaWYgaXQgaGFzIG5vdCBiZWVuIGNyZWF0ZWQuIFVzZSB0aGlzIG1ldGhvZCBpZiB0aGUgaW5zdGFuY2UgaXNcbiAqICAgICAgbmVlZGVkIHRvLCBmb3IgZXhhbXBsZSwgcmVnaXN0ZXIgYSBjYWxsYmFjay5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgX19QUklWQVRFX1Rlc3RpbmdIb29rcyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMub25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaENhbGxiYWNrcyA9IG5ldyBNYXA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzLCBvciBudWxsIGlmIGl0IGhhcyBub3QgYmVlblxuICAgICAqIGluaXRpYWxpemVkLlxuICAgICAqLyAgICBzdGF0aWMgZ2V0IGluc3RhbmNlKCkge1xuICAgICAgICByZXR1cm4gbGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzLCBjcmVhdGluZyBpdCBpZiBpcyBoYXMgbmV2ZXJcbiAgICAgKiBiZWVuIGNyZWF0ZWQgYmVmb3JlLlxuICAgICAqLyAgICBzdGF0aWMgZ2V0T3JDcmVhdGVJbnN0YW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgPT09IGxlICYmIChsZSA9IG5ldyBfX1BSSVZBVEVfVGVzdGluZ0hvb2tzKSwgbGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVycyBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gYW4gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaFxuICAgICAqIG9jY3VycyBpbiB0aGUgV2F0Y2ggbGlzdGVuIHN0cmVhbS5cbiAgICAgKlxuICAgICAqIFRoZSByZWxhdGl2ZSBvcmRlciBpbiB3aGljaCBjYWxsYmFja3MgYXJlIG5vdGlmaWVkIGlzIHVuc3BlY2lmaWVkOyBkbyBub3RcbiAgICAgKiByZWx5IG9uIGFueSBwYXJ0aWN1bGFyIG9yZGVyaW5nLiBJZiBhIGdpdmVuIGNhbGxiYWNrIGlzIHJlZ2lzdGVyZWQgbXVsdGlwbGVcbiAgICAgKiB0aW1lcyB0aGVuIGl0IHdpbGwgYmUgbm90aWZpZWQgbXVsdGlwbGUgdGltZXMsIG9uY2UgcGVyIHJlZ2lzdHJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayB0aGUgY2FsbGJhY2sgdG8gaW52b2tlIHVwb24gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGNhbGxlZCwgdW5yZWdpc3RlcnMgdGhlIGdpdmVuIGNhbGxiYWNrOyBvbmx5XG4gICAgICogdGhlIGZpcnN0IGludm9jYXRpb24gb2YgdGhlIHJldHVybmVkIGZ1bmN0aW9uIGRvZXMgYW55dGhpbmc7IGFsbCBzdWJzZXF1ZW50XG4gICAgICogaW52b2NhdGlvbnMgZG8gbm90aGluZy5cbiAgICAgKi8gICAgb25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBTeW1ib2woKTtcbiAgICAgICAgcmV0dXJuIHRoaXMub25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaENhbGxiYWNrcy5zZXQodCwgZSksICgpID0+IHRoaXMub25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaENhbGxiYWNrcy5kZWxldGUodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEludm9rZXMgYWxsIGN1cnJlbnRseS1yZWdpc3RlcmVkIGBvbkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoYCBjYWxsYmFja3MuXG4gICAgICogQHBhcmFtIGluZm8gSW5mb3JtYXRpb24gYWJvdXQgdGhlIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guXG4gICAgICovICAgIG5vdGlmeU9uRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2goZSkge1xuICAgICAgICB0aGlzLm9uRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2hDYWxsYmFja3MuZm9yRWFjaCgodCA9PiB0KGUpKSk7XG4gICAgfVxufVxuXG4vKiogVGhlIGdsb2JhbCBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgYFRlc3RpbmdIb29rc2AuICovIGxldCBsZSA9IG51bGw7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluc3RhbmNlIG9mIHRoZSBQbGF0Zm9ybSdzICdUZXh0RW5jb2RlcicgaW1wbGVtZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCkge1xuICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXI7XG59XG5cbi8qKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIFBsYXRmb3JtJ3MgJ1RleHREZWNvZGVyJyBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IGhlID0gbmV3IEludGVnZXIoWyA0Mjk0OTY3Mjk1LCA0Mjk0OTY3Mjk1IF0sIDApO1xuXG4vLyBIYXNoIGEgc3RyaW5nIHVzaW5nIG1kNSBoYXNoaW5nIGFsZ29yaXRobS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRNZDVIYXNoVmFsdWUoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3VGV4dEVuY29kZXIoKS5lbmNvZGUoZSksIG4gPSBuZXcgTWQ1O1xuICAgIHJldHVybiBuLnVwZGF0ZSh0KSwgbmV3IFVpbnQ4QXJyYXkobi5kaWdlc3QoKSk7XG59XG5cbi8vIEludGVycHJldCB0aGUgMTYgYnl0ZXMgYXJyYXkgYXMgdHdvIDY0LWJpdCB1bnNpZ25lZCBpbnRlZ2VycywgZW5jb2RlZCB1c2luZ1xuLy8gMuKAmXMgY29tcGxlbWVudCB1c2luZyBsaXR0bGUgZW5kaWFuLlxuZnVuY3Rpb24gX19QUklWQVRFX2dldDY0Qml0VWludHMoZSkge1xuICAgIGNvbnN0IHQgPSBuZXcgRGF0YVZpZXcoZS5idWZmZXIpLCBuID0gdC5nZXRVaW50MzIoMCwgLyogbGl0dGxlRW5kaWFuPSAqLyAhMCksIHIgPSB0LmdldFVpbnQzMig0LCAvKiBsaXR0bGVFbmRpYW49ICovICEwKSwgaSA9IHQuZ2V0VWludDMyKDgsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITApLCBzID0gdC5nZXRVaW50MzIoMTIsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITApO1xuICAgIHJldHVybiBbIG5ldyBJbnRlZ2VyKFsgbiwgciBdLCAwKSwgbmV3IEludGVnZXIoWyBpLCBzIF0sIDApIF07XG59XG5cbmNsYXNzIEJsb29tRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIGlmICh0aGlzLmJpdG1hcCA9IGUsIHRoaXMucGFkZGluZyA9IHQsIHRoaXMuaGFzaENvdW50ID0gbiwgdCA8IDAgfHwgdCA+PSA4KSB0aHJvdyBuZXcgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IoYEludmFsaWQgcGFkZGluZzogJHt0fWApO1xuICAgICAgICBpZiAobiA8IDApIHRocm93IG5ldyBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvcihgSW52YWxpZCBoYXNoIGNvdW50OiAke259YCk7XG4gICAgICAgIGlmIChlLmxlbmd0aCA+IDAgJiYgMCA9PT0gdGhpcy5oYXNoQ291bnQpIFxuICAgICAgICAvLyBPbmx5IGVtcHR5IGJsb29tIGZpbHRlciBjYW4gaGF2ZSAwIGhhc2ggY291bnQuXG4gICAgICAgIHRocm93IG5ldyBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvcihgSW52YWxpZCBoYXNoIGNvdW50OiAke259YCk7XG4gICAgICAgIGlmICgwID09PSBlLmxlbmd0aCAmJiAwICE9PSB0KSBcbiAgICAgICAgLy8gRW1wdHkgYmxvb20gZmlsdGVyIHNob3VsZCBoYXZlIDAgcGFkZGluZy5cbiAgICAgICAgdGhyb3cgbmV3IF9fUFJJVkFURV9CbG9vbUZpbHRlckVycm9yKGBJbnZhbGlkIHBhZGRpbmcgd2hlbiBiaXRtYXAgbGVuZ3RoIGlzIDA6ICR7dH1gKTtcbiAgICAgICAgdGhpcy5kZSA9IDggKiBlLmxlbmd0aCAtIHQsIFxuICAgICAgICAvLyBTZXQgdGhlIGJpdCBjb3VudCBpbiBJbnRlZ2VyIHRvIGF2b2lkIHJlcGV0aXRpb24gaW4gbWlnaHRDb250YWluKCkuXG4gICAgICAgIHRoaXMuQWUgPSBJbnRlZ2VyLmZyb21OdW1iZXIodGhpcy5kZSk7XG4gICAgfVxuICAgIC8vIENhbGN1bGF0ZSB0aGUgaXRoIGhhc2ggdmFsdWUgYmFzZWQgb24gdGhlIGhhc2hlZCA2NGJpdCBpbnRlZ2VycyxcbiAgICAvLyBhbmQgY2FsY3VsYXRlIGl0cyBjb3JyZXNwb25kaW5nIGJpdCBpbmRleCBpbiB0aGUgYml0bWFwIHRvIGJlIGNoZWNrZWQuXG4gICAgUmUoZSwgdCwgbikge1xuICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaGVkIHZhbHVlIGgoaSkgPSBoMSArIChpICogaDIpLlxuICAgICAgICBsZXQgciA9IGUuYWRkKHQubXVsdGlwbHkoSW50ZWdlci5mcm9tTnVtYmVyKG4pKSk7XG4gICAgICAgIC8vIFdyYXAgaWYgaGFzaCB2YWx1ZSBvdmVyZmxvdyA2NGJpdC5cbiAgICAgICAgICAgICAgICByZXR1cm4gMSA9PT0gci5jb21wYXJlKGhlKSAmJiAociA9IG5ldyBJbnRlZ2VyKFsgci5nZXRCaXRzKDApLCByLmdldEJpdHMoMSkgXSwgMCkpLCBcbiAgICAgICAgci5tb2R1bG8odGhpcy5BZSkudG9OdW1iZXIoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJuIHdoZXRoZXIgdGhlIGJpdCBvbiB0aGUgZ2l2ZW4gaW5kZXggaW4gdGhlIGJpdG1hcCBpcyBzZXQgdG8gMS5cbiAgICBWZShlKSB7XG4gICAgICAgIHJldHVybiAwICE9ICh0aGlzLmJpdG1hcFtNYXRoLmZsb29yKGUgLyA4KV0gJiAxIDw8IGUgJSA4KTtcbiAgICB9XG4gICAgbWlnaHRDb250YWluKGUpIHtcbiAgICAgICAgLy8gRW1wdHkgYml0bWFwIHNob3VsZCBhbHdheXMgcmV0dXJuIGZhbHNlIG9uIG1lbWJlcnNoaXAgY2hlY2suXG4gICAgICAgIGlmICgwID09PSB0aGlzLmRlKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0TWQ1SGFzaFZhbHVlKGUpLCBbbiwgcl0gPSBfX1BSSVZBVEVfZ2V0NjRCaXRVaW50cyh0KTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmhhc2hDb3VudDsgZSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5SZShuLCByLCBlKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5WZSh0KSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqIENyZWF0ZSBibG9vbSBmaWx0ZXIgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seS4gKi8gICAgc3RhdGljIGNyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBlICUgOCA9PSAwID8gMCA6IDggLSBlICUgOCwgaSA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChlIC8gOCkpLCBzID0gbmV3IEJsb29tRmlsdGVyKGksIHIsIHQpO1xuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKChlID0+IHMuaW5zZXJ0KGUpKSksIHM7XG4gICAgfVxuICAgIGluc2VydChlKSB7XG4gICAgICAgIGlmICgwID09PSB0aGlzLmRlKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0TWQ1SGFzaFZhbHVlKGUpLCBbbiwgcl0gPSBfX1BSSVZBVEVfZ2V0NjRCaXRVaW50cyh0KTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmhhc2hDb3VudDsgZSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5SZShuLCByLCBlKTtcbiAgICAgICAgICAgIHRoaXMubWUodCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWUoZSkge1xuICAgICAgICBjb25zdCB0ID0gTWF0aC5mbG9vcihlIC8gOCksIG4gPSBlICUgODtcbiAgICAgICAgdGhpcy5iaXRtYXBbdF0gfD0gMSA8PCBuO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyksIHRoaXMubmFtZSA9IFwiQmxvb21GaWx0ZXJFcnJvclwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gZXZlbnQgZnJvbSB0aGUgUmVtb3RlU3RvcmUuIEl0IGlzIHNwbGl0IGludG8gdGFyZ2V0Q2hhbmdlcyAoY2hhbmdlcyB0byB0aGVcbiAqIHN0YXRlIG9yIHRoZSBzZXQgb2YgZG9jdW1lbnRzIGluIG91ciB3YXRjaGVkIHRhcmdldHMpIGFuZCBkb2N1bWVudFVwZGF0ZXNcbiAqIChjaGFuZ2VzIHRvIHRoZSBhY3R1YWwgZG9jdW1lbnRzKS5cbiAqLyBjbGFzcyBSZW1vdGVFdmVudCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIHNuYXBzaG90IHZlcnNpb24gdGhpcyBldmVudCBicmluZ3MgdXMgdXAgdG8sIG9yIE1JTiBpZiBub3Qgc2V0LlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEEgbWFwIGZyb20gdGFyZ2V0IHRvIGNoYW5nZXMgdG8gdGhlIHRhcmdldC4gU2VlIFRhcmdldENoYW5nZS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBBIG1hcCBvZiB0YXJnZXRzIHRoYXQgaXMga25vd24gdG8gYmUgaW5jb25zaXN0ZW50LCBhbmQgdGhlIHB1cnBvc2UgZm9yXG4gICAgICogcmUtbGlzdGVuaW5nLiBMaXN0ZW5zIGZvciB0aGVzZSB0YXJnZXRzIHNob3VsZCBiZSByZS1lc3RhYmxpc2hlZCB3aXRob3V0XG4gICAgICogcmVzdW1lIHRva2Vucy5cbiAgICAgKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBBIHNldCBvZiB3aGljaCBkb2N1bWVudHMgaGF2ZSBjaGFuZ2VkIG9yIGJlZW4gZGVsZXRlZCwgYWxvbmcgd2l0aCB0aGVcbiAgICAgKiBkb2MncyBuZXcgdmFsdWVzIChpZiBub3QgZGVsZXRlZCkuXG4gICAgICovXG4gICAgciwgXG4gICAgLyoqXG4gICAgICogQSBzZXQgb2Ygd2hpY2ggZG9jdW1lbnQgdXBkYXRlcyBhcmUgZHVlIG9ubHkgdG8gbGltYm8gcmVzb2x1dGlvbiB0YXJnZXRzLlxuICAgICAqL1xuICAgIGkpIHtcbiAgICAgICAgdGhpcy5zbmFwc2hvdFZlcnNpb24gPSBlLCB0aGlzLnRhcmdldENoYW5nZXMgPSB0LCB0aGlzLnRhcmdldE1pc21hdGNoZXMgPSBuLCB0aGlzLmRvY3VtZW50VXBkYXRlcyA9IHIsIFxuICAgICAgICB0aGlzLnJlc29sdmVkTGltYm9Eb2N1bWVudHMgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIQUNLOiBWaWV3cyByZXF1aXJlIFJlbW90ZUV2ZW50cyBpbiBvcmRlciB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgdmlldyBpc1xuICAgICAqIENVUlJFTlQsIGJ1dCBzZWNvbmRhcnkgdGFicyBkb24ndCByZWNlaXZlIHJlbW90ZSBldmVudHMuIFNvIHRoaXMgbWV0aG9kIGlzXG4gICAgICogdXNlZCB0byBjcmVhdGUgYSBzeW50aGVzaXplZCBSZW1vdGVFdmVudCB0aGF0IGNhbiBiZSB1c2VkIHRvIGFwcGx5IGFcbiAgICAgKiBDVVJSRU5UIHN0YXR1cyBjaGFuZ2UgdG8gYSBWaWV3LCBmb3IgcXVlcmllcyBleGVjdXRlZCBpbiBhIGRpZmZlcmVudCB0YWIuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIHN0YXRpYyBjcmVhdGVTeW50aGVzaXplZFJlbW90ZUV2ZW50Rm9yQ3VycmVudENoYW5nZShlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4gci5zZXQoZSwgVGFyZ2V0Q2hhbmdlLmNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZShlLCB0LCBuKSksIFxuICAgICAgICBuZXcgUmVtb3RlRXZlbnQoU25hcHNob3RWZXJzaW9uLm1pbigpLCByLCBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSwgX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgVGFyZ2V0Q2hhbmdlIHNwZWNpZmllcyB0aGUgc2V0IG9mIGNoYW5nZXMgZm9yIGEgc3BlY2lmaWMgdGFyZ2V0IGFzIHBhcnQgb2ZcbiAqIGEgUmVtb3RlRXZlbnQuIFRoZXNlIGNoYW5nZXMgdHJhY2sgd2hpY2ggZG9jdW1lbnRzIGFyZSBhZGRlZCwgbW9kaWZpZWQgb3JcbiAqIHJlbW92ZWQsIGFzIHdlbGwgYXMgdGhlIHRhcmdldCdzIHJlc3VtZSB0b2tlbiBhbmQgd2hldGhlciB0aGUgdGFyZ2V0IGlzXG4gKiBtYXJrZWQgQ1VSUkVOVC5cbiAqIFRoZSBhY3R1YWwgY2hhbmdlcyAqdG8qIGRvY3VtZW50cyBhcmUgbm90IHBhcnQgb2YgdGhlIFRhcmdldENoYW5nZSBzaW5jZVxuICogZG9jdW1lbnRzIG1heSBiZSBwYXJ0IG9mIG11bHRpcGxlIHRhcmdldHMuXG4gKi8gY2xhc3MgVGFyZ2V0Q2hhbmdlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHF1ZXJ5IHRvIGJlIHJlc3VtZWRcbiAgICAgKiBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXQgbWF0Y2hlcyB0aGVcbiAgICAgKiBxdWVyeS4gVGhlIHJlc3VtZSB0b2tlbiBlc3NlbnRpYWxseSBpZGVudGlmaWVzIGEgcG9pbnQgaW4gdGltZSBmcm9tIHdoaWNoXG4gICAgICogdGhlIHNlcnZlciBzaG91bGQgcmVzdW1lIHNlbmRpbmcgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgXCJjdXJyZW50XCIgKHN5bmNlZCkgc3RhdHVzIG9mIHRoaXMgdGFyZ2V0LiBOb3RlIHRoYXQgXCJjdXJyZW50XCJcbiAgICAgKiBoYXMgc3BlY2lhbCBtZWFuaW5nIGluIHRoZSBSUEMgcHJvdG9jb2wgdGhhdCBpbXBsaWVzIHRoYXQgYSB0YXJnZXQgaXNcbiAgICAgKiBib3RoIHVwLXRvLWRhdGUgYW5kIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgd2F0Y2ggc3RyZWFtLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgd2VyZSBuZXdseSBhc3NpZ25lZCB0byB0aGlzIHRhcmdldCBhcyBwYXJ0IG9mXG4gICAgICogdGhpcyByZW1vdGUgZXZlbnQuXG4gICAgICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCB3ZXJlIGFscmVhZHkgYXNzaWduZWQgdG8gdGhpcyB0YXJnZXQgYnV0IHJlY2VpdmVkXG4gICAgICogYW4gdXBkYXRlIGR1cmluZyB0aGlzIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICByLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IHdlcmUgcmVtb3ZlZCBmcm9tIHRoaXMgdGFyZ2V0IGFzIHBhcnQgb2YgdGhpc1xuICAgICAqIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICBpKSB7XG4gICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSBlLCB0aGlzLmN1cnJlbnQgPSB0LCB0aGlzLmFkZGVkRG9jdW1lbnRzID0gbiwgdGhpcy5tb2RpZmllZERvY3VtZW50cyA9IHIsIFxuICAgICAgICB0aGlzLnJlbW92ZWREb2N1bWVudHMgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGNyZWF0ZSBhIHN5bnRoZXNpemVkIFRhcmdldENoYW5nZXMgdGhhdCBjYW4gYmUgdXNlZCB0b1xuICAgICAqIGFwcGx5IGEgQ1VSUkVOVCBzdGF0dXMgY2hhbmdlIHRvIGEgVmlldyAoZm9yIHF1ZXJpZXMgZXhlY3V0ZWQgaW4gYSBkaWZmZXJlbnRcbiAgICAgKiB0YWIpIG9yIGZvciBuZXcgcXVlcmllcyAodG8gcmFpc2Ugc25hcHNob3RzIHdpdGggY29ycmVjdCBDVVJSRU5UIHN0YXR1cykuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldENoYW5nZShuLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBjaGFuZ2VkIGRvY3VtZW50IGFuZCBhIGxpc3Qgb2YgdGFyZ2V0IGlkcyB0byB3aGljaCB0aGlzIGNoYW5nZVxuICogYXBwbGllcy5cbiAqXG4gKiBJZiBkb2N1bWVudCBoYXMgYmVlbiBkZWxldGVkIE5vRG9jdW1lbnQgd2lsbCBiZSBwcm92aWRlZC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRG9jdW1lbnRXYXRjaENoYW5nZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSBuZXcgZG9jdW1lbnQgYXBwbGllcyB0byBhbGwgb2YgdGhlc2UgdGFyZ2V0cy4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIG5ldyBkb2N1bWVudCBpcyByZW1vdmVkIGZyb20gYWxsIG9mIHRoZXNlIHRhcmdldHMuICovXG4gICAgdCwgXG4gICAgLyoqIFRoZSBrZXkgb2YgdGhlIGRvY3VtZW50IGZvciB0aGlzIGNoYW5nZS4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgbmV3IGRvY3VtZW50IG9yIE5vRG9jdW1lbnQgaWYgaXQgd2FzIGRlbGV0ZWQuIElzIG51bGwgaWYgdGhlXG4gICAgICogZG9jdW1lbnQgd2VudCBvdXQgb2YgdmlldyB3aXRob3V0IHRoZSBzZXJ2ZXIgc2VuZGluZyBhIG5ldyBkb2N1bWVudC5cbiAgICAgKi9cbiAgICByKSB7XG4gICAgICAgIHRoaXMuZmUgPSBlLCB0aGlzLnJlbW92ZWRUYXJnZXRJZHMgPSB0LCB0aGlzLmtleSA9IG4sIHRoaXMuZ2UgPSByO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0V4aXN0ZW5jZUZpbHRlckNoYW5nZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnRhcmdldElkID0gZSwgdGhpcy5wZSA9IHQ7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfV2F0Y2hUYXJnZXRDaGFuZ2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBXaGF0IGtpbmQgb2YgY2hhbmdlIG9jY3VycmVkIHRvIHRoZSB3YXRjaCB0YXJnZXQuICovXG4gICAgZSwgXG4gICAgLyoqIFRoZSB0YXJnZXQgSURzIHRoYXQgd2VyZSBhZGRlZC9yZW1vdmVkL3NldC4gKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHRhcmdldCB0byBiZVxuICAgICAqIHJlc3VtZWQgYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0XG4gICAgICogbWF0Y2hlcyB0aGUgdGFyZ2V0LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpblxuICAgICAqIHRpbWUgZnJvbSB3aGljaCB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqL1xuICAgIG4gPSBCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HXG4gICAgLyoqIEFuIFJQQyBlcnJvciBpbmRpY2F0aW5nIHdoeSB0aGUgd2F0Y2ggZmFpbGVkLiAqLyAsIHIgPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBlLCB0aGlzLnRhcmdldElkcyA9IHQsIHRoaXMucmVzdW1lVG9rZW4gPSBuLCB0aGlzLmNhdXNlID0gcjtcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgdGhlIGludGVybmFsIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0LiAqLyBjbGFzcyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiBwZW5kaW5nIHJlc3BvbnNlcyAoYWRkcyBvciByZW1vdmVzKSB0aGF0IHdlIGFyZSB3YWl0aW5nIG9uLlxuICAgICAgICAgKiBXZSBvbmx5IGNvbnNpZGVyIHRhcmdldHMgYWN0aXZlIHRoYXQgaGF2ZSBubyBwZW5kaW5nIHJlc3BvbnNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMueWUgPSAwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSBkb2N1bWVudCBjaGFuZ2VzIHNpbmNlIHRoZSBsYXN0IHJhaXNlZCBzbmFwc2hvdC5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhlc2UgY2hhbmdlcyBhcmUgY29udGludW91c2x5IHVwZGF0ZWQgYXMgd2UgcmVjZWl2ZSBkb2N1bWVudCB1cGRhdGVzIGFuZFxuICAgICAgICAgKiBhbHdheXMgcmVmbGVjdCB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcyBhZ2FpbnN0IHRoZSBsYXN0IGlzc3VlZCBzbmFwc2hvdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2UgPSBfX1BSSVZBVEVfc25hcHNob3RDaGFuZ2VzTWFwKCksIFxuICAgICAgICAvKiogU2VlIHB1YmxpYyBnZXR0ZXJzIGZvciBleHBsYW5hdGlvbnMgb2YgdGhlc2UgZmllbGRzLiAqL1xuICAgICAgICB0aGlzLlNlID0gQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORywgdGhpcy5iZSA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgc3RhdGUgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBuZXh0IHNuYXBzaG90LiBXZVxuICAgICAgICAgKiBpbml0aWFsaXplIHRvIHRydWUgc28gdGhhdCBuZXdseS1hZGRlZCB0YXJnZXRzIGFyZSBpbmNsdWRlZCBpbiB0aGUgbmV4dFxuICAgICAgICAgKiBSZW1vdGVFdmVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuRGUgPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGlzIHRhcmdldCBoYXMgYmVlbiBtYXJrZWQgJ2N1cnJlbnQnLlxuICAgICAqXG4gICAgICogJ0N1cnJlbnQnIGhhcyBzcGVjaWFsIG1lYW5pbmcgaW4gdGhlIFJQQyBwcm90b2NvbDogSXQgaW1wbGllcyB0aGF0IHRoZVxuICAgICAqIFdhdGNoIGJhY2tlbmQgaGFzIHNlbnQgdXMgYWxsIGNoYW5nZXMgdXAgdG8gdGhlIHBvaW50IGF0IHdoaWNoIHRoZSB0YXJnZXRcbiAgICAgKiB3YXMgYWRkZWQgYW5kIHRoYXQgdGhlIHRhcmdldCBpcyBjb25zaXN0ZW50IHdpdGggdGhlIHJlc3Qgb2YgdGhlIHdhdGNoXG4gICAgICogc3RyZWFtLlxuICAgICAqLyAgICBnZXQgY3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmU7XG4gICAgfVxuICAgIC8qKiBUaGUgbGFzdCByZXN1bWUgdG9rZW4gc2VudCB0byB1cyBmb3IgdGhpcyB0YXJnZXQuICovICAgIGdldCByZXN1bWVUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuU2U7XG4gICAgfVxuICAgIC8qKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IGhhcyBwZW5kaW5nIHRhcmdldCBhZGRzIG9yIHRhcmdldCByZW1vdmVzLiAqLyAgICBnZXQgdmUoKSB7XG4gICAgICAgIHJldHVybiAwICE9PSB0aGlzLnllO1xuICAgIH1cbiAgICAvKiogV2hldGhlciB3ZSBoYXZlIG1vZGlmaWVkIGFueSBzdGF0ZSB0aGF0IHNob3VsZCB0cmlnZ2VyIGEgc25hcHNob3QuICovICAgIGdldCBDZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgdGhlIHJlc3VtZSB0b2tlbiB0byB0aGUgVGFyZ2V0Q2hhbmdlLCBidXQgb25seSB3aGVuIGl0IGhhcyBhIG5ld1xuICAgICAqIHZhbHVlLiBFbXB0eSByZXN1bWVUb2tlbnMgYXJlIGRpc2NhcmRlZC5cbiAgICAgKi8gICAgRmUoZSkge1xuICAgICAgICBlLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDAgJiYgKHRoaXMuRGUgPSAhMCwgdGhpcy5TZSA9IGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgdGFyZ2V0IGNoYW5nZSBmcm9tIHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogVG8gcmVzZXQgdGhlIGRvY3VtZW50IGNoYW5nZXMgYWZ0ZXIgcmFpc2luZyB0aGlzIHNuYXBzaG90LCBjYWxsXG4gICAgICogYGNsZWFyUGVuZGluZ0NoYW5nZXMoKWAuXG4gICAgICovICAgIE1lKCkge1xuICAgICAgICBsZXQgZSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0ID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMud2UuZm9yRWFjaCgoKHIsIGkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoaSkge1xuICAgICAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgZSA9IGUuYWRkKHIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgICAgICAgICAgICB0ID0gdC5hZGQocik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICAgICAgbiA9IG4uYWRkKHIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSksIG5ldyBUYXJnZXRDaGFuZ2UodGhpcy5TZSwgdGhpcy5iZSwgZSwgdCwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgZG9jdW1lbnQgY2hhbmdlcyBhbmQgc2V0cyBgaGFzUGVuZGluZ0NoYW5nZXNgIHRvIGZhbHNlLlxuICAgICAqLyAgICB4ZSgpIHtcbiAgICAgICAgdGhpcy5EZSA9ICExLCB0aGlzLndlID0gX19QUklWQVRFX3NuYXBzaG90Q2hhbmdlc01hcCgpO1xuICAgIH1cbiAgICBPZShlLCB0KSB7XG4gICAgICAgIHRoaXMuRGUgPSAhMCwgdGhpcy53ZSA9IHRoaXMud2UuaW5zZXJ0KGUsIHQpO1xuICAgIH1cbiAgICBOZShlKSB7XG4gICAgICAgIHRoaXMuRGUgPSAhMCwgdGhpcy53ZSA9IHRoaXMud2UucmVtb3ZlKGUpO1xuICAgIH1cbiAgICBCZSgpIHtcbiAgICAgICAgdGhpcy55ZSArPSAxO1xuICAgIH1cbiAgICBMZSgpIHtcbiAgICAgICAgdGhpcy55ZSAtPSAxO1xuICAgIH1cbiAgICBrZSgpIHtcbiAgICAgICAgdGhpcy5EZSA9ICEwLCB0aGlzLmJlID0gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHRvIGFjY3VtdWxhdGUgd2F0Y2ggY2hhbmdlcyBpbnRvIGEgUmVtb3RlRXZlbnQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9XYXRjaENoYW5nZUFnZ3JlZ2F0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5xZSA9IGUsIFxuICAgICAgICAvKiogVGhlIGludGVybmFsIHN0YXRlIG9mIGFsbCB0cmFja2VkIHRhcmdldHMuICovXG4gICAgICAgIHRoaXMuUWUgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqIEtlZXBzIHRyYWNrIG9mIHRoZSBkb2N1bWVudHMgdG8gdXBkYXRlIHNpbmNlIHRoZSBsYXN0IHJhaXNlZCBzbmFwc2hvdC4gKi9cbiAgICAgICAgdGhpcy5LZSA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgXG4gICAgICAgIC8qKiBBIG1hcHBpbmcgb2YgZG9jdW1lbnQga2V5cyB0byB0aGVpciBzZXQgb2YgdGFyZ2V0IElEcy4gKi9cbiAgICAgICAgdGhpcy4kZSA9IF9fUFJJVkFURV9kb2N1bWVudFRhcmdldE1hcCgpLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbWFwIG9mIHRhcmdldHMgd2l0aCBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuIFRoZXNlIHRhcmdldHMgYXJlXG4gICAgICAgICAqIGtub3duIHRvIGJlIGluY29uc2lzdGVudCBhbmQgdGhlaXIgbGlzdGVucyBuZWVkcyB0byBiZSByZS1lc3RhYmxpc2hlZCBieVxuICAgICAgICAgKiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVWUgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBEb2N1bWVudFdhdGNoQ2hhbmdlIHRvIHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzLlxuICAgICAqLyAgICBXZShlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLmZlKSBlLmdlICYmIGUuZ2UuaXNGb3VuZERvY3VtZW50KCkgPyB0aGlzLkdlKHQsIGUuZ2UpIDogdGhpcy56ZSh0LCBlLmtleSwgZS5nZSk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLnJlbW92ZWRUYXJnZXRJZHMpIHRoaXMuemUodCwgZS5rZXksIGUuZ2UpO1xuICAgIH1cbiAgICAvKiogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBXYXRjaFRhcmdldENoYW5nZSB0byB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy4gKi8gICAgamUoZSkge1xuICAgICAgICB0aGlzLmZvckVhY2hUYXJnZXQoZSwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuSGUodCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGUuc3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSAwIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuTm9DaGFuZ2UgKi8gOlxuICAgICAgICAgICAgICAgIHRoaXMuSmUodCkgJiYgbi5GZShlLnJlc3VtZVRva2VuKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDEgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLkxlKCksIG4udmUgfHwgXG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIGZyZXNobHkgYWRkZWQgdGFyZ2V0LCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGFueSBzdGF0ZVxuICAgICAgICAgICAgICAgIC8vIHRoYXQgd2UgaGFkIHByZXZpb3VzbHkuIFRoaXMgY2FuIGhhcHBlbiBlLmcuIHdoZW4gcmVtb3ZlIGFuZCBhZGRcbiAgICAgICAgICAgICAgICAvLyBiYWNrIGEgdGFyZ2V0IGZvciBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICAgICAgICAgICAgbi54ZSgpLCBuLkZlKGUucmVzdW1lVG9rZW4pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiByZW1vdmVkIHRhcmdldHMgdG8gd2UgY2FuIHBvc3QtZmlsdGVyIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgdGFyZ2V0IGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLkxlKCksIG4udmUgfHwgdGhpcy5yZW1vdmVUYXJnZXQodCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAzIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQ3VycmVudCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5KZSh0KSAmJiAobi5rZSgpLCBuLkZlKGUucmVzdW1lVG9rZW4pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDQgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZXNldCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5KZSh0KSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHRhcmdldCBhbmQgc3ludGhlc2l6ZXMgcmVtb3ZlcyBmb3IgYWxsIGV4aXN0aW5nXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzLiBUaGUgYmFja2VuZCB3aWxsIHJlLWFkZCBhbnkgZG9jdW1lbnRzIHRoYXQgc3RpbGxcbiAgICAgICAgICAgICAgICAvLyBtYXRjaCB0aGUgdGFyZ2V0IGJlZm9yZSBpdCBzZW5kcyB0aGUgbmV4dCBnbG9iYWwgc25hcHNob3QuXG4gICAgICAgICAgICAgICAgdGhpcy5ZZSh0KSwgbi5GZShlLnJlc3VtZVRva2VuKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhbGwgdGFyZ2V0SWRzIHRoYXQgdGhlIHdhdGNoIGNoYW5nZSBhcHBsaWVzIHRvOiBlaXRoZXIgdGhlXG4gICAgICogdGFyZ2V0SWRzIGV4cGxpY2l0bHkgbGlzdGVkIGluIHRoZSBjaGFuZ2Ugb3IgdGhlIHRhcmdldElkcyBvZiBhbGwgY3VycmVudGx5XG4gICAgICogYWN0aXZlIHRhcmdldHMuXG4gICAgICovICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICBlLnRhcmdldElkcy5sZW5ndGggPiAwID8gZS50YXJnZXRJZHMuZm9yRWFjaCh0KSA6IHRoaXMuUWUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuSmUobikgJiYgdChuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIGV4aXN0ZW5jZSBmaWx0ZXJzIGFuZCBzeW50aGVzaXplcyBkZWxldGVzIGZvciBmaWx0ZXIgbWlzbWF0Y2hlcy5cbiAgICAgKiBUYXJnZXRzIHRoYXQgYXJlIGludmFsaWRhdGVkIGJ5IGZpbHRlciBtaXNtYXRjaGVzIGFyZSBhZGRlZCB0b1xuICAgICAqIGBwZW5kaW5nVGFyZ2V0UmVzZXRzYC5cbiAgICAgKi8gICAgWmUoZSkge1xuICAgICAgICB2YXIgdCwgbjtcbiAgICAgICAgY29uc3QgciA9IGUudGFyZ2V0SWQsIGkgPSBlLnBlLmNvdW50LCBzID0gdGhpcy5YZShyKTtcbiAgICAgICAgaWYgKHMpIHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBzLnRhcmdldDtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfdGFyZ2V0SXNEb2N1bWVudFRhcmdldChvKSkgaWYgKDAgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgZXhpc3RlbmNlIGZpbHRlciB0b2xkIHVzIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBleGlzdC4gV2UgZGVkdWNlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB0aGlzIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0IGFuZCBhcHBseSBhIGRlbGV0ZWQgZG9jdW1lbnQgdG9cbiAgICAgICAgICAgICAgICAvLyBvdXIgdXBkYXRlcy4gV2l0aG91dCBhcHBseWluZyB0aGlzIGRlbGV0ZWQgZG9jdW1lbnQgdGhlcmUgbWlnaHQgYmVcbiAgICAgICAgICAgICAgICAvLyBhbm90aGVyIHF1ZXJ5IHRoYXQgd2lsbCByYWlzZSB0aGlzIGRvY3VtZW50IGFzIHBhcnQgb2YgYSBzbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIHVudGlsIGl0IGlzIHJlc29sdmVkLCBlc3NlbnRpYWxseSBleHBvc2luZyBpbmNvbnNpc3RlbmN5IGJldHdlZW5cbiAgICAgICAgICAgICAgICAvLyBxdWVyaWVzLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgRG9jdW1lbnRLZXkoby5wYXRoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnplKHIsIGUsIE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KGUsIFNuYXBzaG90VmVyc2lvbi5taW4oKSkpO1xuICAgICAgICAgICAgfSBlbHNlIF9fUFJJVkFURV9oYXJkQXNzZXJ0KDEgPT09IGkpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gdGhpcy5ldChyKTtcbiAgICAgICAgICAgICAgICAvLyBFeGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoLiBNYXJrIHRoZSBkb2N1bWVudHMgYXMgYmVpbmcgaW4gbGltYm8sIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJhaXNlIGEgc25hcHNob3Qgd2l0aCBgaXNGcm9tQ2FjaGU6dHJ1ZWAuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzICE9PSBpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IGJsb29tIGZpbHRlciB0byBpZGVudGlmeSBhbmQgbWFyayByZW1vdmVkIGRvY3VtZW50cy5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMudHQoZSwgcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgwIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuU3VjY2VzcyAqLyAhPT0gaS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGJsb29tIGZpbHRlciBhcHBsaWNhdGlvbiBmYWlscywgd2UgcmVzZXQgdGhlIG1hcHBpbmcgYW5kXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmlnZ2VyIHJlLXJ1biBvZiB0aGUgcXVlcnkuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlllKHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IDIgLyogQmxvb21GaWx0ZXJBcHBsaWNhdGlvblN0YXR1cy5GYWxzZVBvc2l0aXZlICovID09PSBpLnN0YXR1cyA/IFwiVGFyZ2V0UHVycG9zZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb21cIiAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb20gKi8gOiBcIlRhcmdldFB1cnBvc2VFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaFwiIC8qIFRhcmdldFB1cnBvc2UuRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2ggKi87XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlVlID0gdGhpcy5VZS5pbnNlcnQociwgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gKHQgPSBfX1BSSVZBVEVfVGVzdGluZ0hvb2tzLmluc3RhbmNlKSB8fCB2b2lkIDAgPT09IHQgfHwgdC5ub3RpZnlPbkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoKGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEluZm9Gb3JUZXN0aW5nSG9va3MoZSwgdCwgbiwgcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGksIHMsIG8sIF8sIGEsIHU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQ2FjaGVDb3VudDogbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGVuY2VGaWx0ZXJDb3VudDogci5jb3VudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgbCA9IHIudW5jaGFuZ2VkTmFtZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBsICYmIChjLmJsb29tRmlsdGVyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpZWQ6IDAgLyogQmxvb21GaWx0ZXJBcHBsaWNhdGlvblN0YXR1cy5TdWNjZXNzICovID09PSBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc2hDb3VudDogbnVsbCAhPT0gKGkgPSBudWxsID09IGwgPyB2b2lkIDAgOiBsLmhhc2hDb3VudCkgJiYgdm9pZCAwICE9PSBpID8gaSA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwTGVuZ3RoOiBudWxsICE9PSAoXyA9IG51bGwgPT09IChvID0gbnVsbCA9PT0gKHMgPSBudWxsID09IGwgPyB2b2lkIDAgOiBsLmJpdHMpIHx8IHZvaWQgMCA9PT0gcyA/IHZvaWQgMCA6IHMuYml0bWFwKSB8fCB2b2lkIDAgPT09IG8gPyB2b2lkIDAgOiBvLmxlbmd0aCkgJiYgdm9pZCAwICE9PSBfID8gXyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogbnVsbCAhPT0gKHUgPSBudWxsID09PSAoYSA9IG51bGwgPT0gbCA/IHZvaWQgMCA6IGwuYml0cykgfHwgdm9pZCAwID09PSBhID8gdm9pZCAwIDogYS5wYWRkaW5nKSAmJiB2b2lkIDAgIT09IHUgPyB1IDogMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdCAmJiAoYy5ibG9vbUZpbHRlci5taWdodENvbnRhaW4gPSB0KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAoaS5zdGF0dXMsIG51bGwgIT09IChuID0gaS5udCkgJiYgdm9pZCAwICE9PSBuID8gbiA6IG51bGwsIHMsIGUucGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbHkgYmxvb20gZmlsdGVyIHRvIHJlbW92ZSB0aGUgZGVsZXRlZCBkb2N1bWVudHMsIGFuZCByZXR1cm4gdGhlXG4gICAgICogYXBwbGljYXRpb24gc3RhdHVzLlxuICAgICAqLyAgICB0dChlLCB0KSB7XG4gICAgICAgIGNvbnN0IHt1bmNoYW5nZWROYW1lczogbiwgY291bnQ6IHJ9ID0gZS5wZTtcbiAgICAgICAgaWYgKCFuIHx8ICFuLmJpdHMpIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0dXM6IDFcbiAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlNraXBwZWQgKi8gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHtiaXRzOiB7Yml0bWFwOiBpID0gXCJcIiwgcGFkZGluZzogcyA9IDB9LCBoYXNoQ291bnQ6IG8gPSAwfSA9IG47XG4gICAgICAgIGxldCBfLCBhO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgXyA9IF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGkpLnRvVWludDhBcnJheSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9CYXNlNjREZWNvZGVFcnJvcikgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKFwiRGVjb2RpbmcgdGhlIGJhc2U2NCBibG9vbSBmaWx0ZXIgaW4gZXhpc3RlbmNlIGZpbHRlciBmYWlsZWQgKFwiICsgZS5tZXNzYWdlICsgXCIpOyBpZ25vcmluZyB0aGUgYmxvb20gZmlsdGVyIGFuZCBmYWxsaW5nIGJhY2sgdG8gZnVsbCByZS1xdWVyeS5cIiksIFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0YXR1czogMVxuIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuU2tpcHBlZCAqLyAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBCbG9vbUZpbHRlciB0aHJvd3MgZXJyb3IgaWYgdGhlIGlucHV0cyBhcmUgaW52YWxpZC5cbiAgICAgICAgICAgIGEgPSBuZXcgQmxvb21GaWx0ZXIoXywgcywgbyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nV2FybihlIGluc3RhbmNlb2YgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IgPyBcIkJsb29tRmlsdGVyIGVycm9yOiBcIiA6IFwiQXBwbHlpbmcgYmxvb20gZmlsdGVyIGZhaWxlZDogXCIsIGUpLCBcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IDFcbiAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlNraXBwZWQgKi8gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IF9fUFJJVkFURV9ibG9vbUZpbHRlck1pZ2h0Q29udGFpbiA9IGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMucWUucnQoKTtcbiAgICAgICAgICAgIHJldHVybiBhLm1pZ2h0Q29udGFpbihgcHJvamVjdHMvJHt0LnByb2plY3RJZH0vZGF0YWJhc2VzLyR7dC5kYXRhYmFzZX0vZG9jdW1lbnRzLyR7ZX1gKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKDAgPT09IGEuZGUpIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0dXM6IDFcbiAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlNraXBwZWQgKi8gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0dXM6IHIgPT09IHQgLSB0aGlzLml0KGUudGFyZ2V0SWQsIF9fUFJJVkFURV9ibG9vbUZpbHRlck1pZ2h0Q29udGFpbikgPyAwIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuU3VjY2VzcyAqLyA6IDIgLyogQmxvb21GaWx0ZXJBcHBsaWNhdGlvblN0YXR1cy5GYWxzZVBvc2l0aXZlICovICxcbiAgICAgICAgICAgIG50OiBfX1BSSVZBVEVfYmxvb21GaWx0ZXJNaWdodENvbnRhaW5cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmlsdGVyIG91dCByZW1vdmVkIGRvY3VtZW50cyBiYXNlZCBvbiBibG9vbSBmaWx0ZXIgbWVtYmVyc2hpcCByZXN1bHQgYW5kXG4gICAgICogcmV0dXJuIG51bWJlciBvZiBkb2N1bWVudHMgcmVtb3ZlZC5cbiAgICAgKi8gICAgaXQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5xZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpO1xuICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgdChuLnBhdGguY2Fub25pY2FsU3RyaW5nKCkpIHx8ICh0aGlzLnplKGUsIG4sIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpLCByKyspO1xuICAgICAgICB9KSksIHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBjdXJyZW50bHkgYWNjdW11bGF0ZWQgc3RhdGUgaW50byBhIHJlbW90ZSBldmVudCBhdCB0aGVcbiAgICAgKiBwcm92aWRlZCBzbmFwc2hvdCB2ZXJzaW9uLiBSZXNldHMgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYmVmb3JlIHJldHVybmluZy5cbiAgICAgKi8gICAgc3QoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IE1hcDtcbiAgICAgICAgdGhpcy5RZS5mb3JFYWNoKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuWGUocik7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGlmIChuLmN1cnJlbnQgJiYgX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQoaS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50IHF1ZXJpZXMgZm9yIGRvY3VtZW50IHRoYXQgZG9uJ3QgZXhpc3QgY2FuIHByb2R1Y2UgYW4gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0IHNldC4gVG8gdXBkYXRlIG91ciBsb2NhbCBjYWNoZSwgd2Ugc3ludGhlc2l6ZSBhIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpZiB3ZSBoYXZlIG5vdCBwcmV2aW91c2x5IHJlY2VpdmVkIHRoZSBkb2N1bWVudC4gVGhpc1xuICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlcyB0aGUgbGltYm8gc3RhdGUgb2YgdGhlIGRvY3VtZW50LCByZW1vdmluZyBpdCBmcm9tXG4gICAgICAgICAgICAgICAgICAgIC8vIGxpbWJvRG9jdW1lbnRSZWZzLlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElkZWFsbHkgd2Ugd291bGQgaGF2ZSBhbiBleHBsaWNpdCBsb29rdXAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQgcmVzdWx0aW5nIGluIGFuIGV4cGxpY2l0IGRlbGV0ZSBtZXNzYWdlIGFuZCB3ZSBjb3VsZFxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBzcGVjaWFsIGxvZ2ljLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IERvY3VtZW50S2V5KGkudGFyZ2V0LnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzLktlLmdldCh0KSB8fCB0aGlzLm90KHIsIHQpIHx8IHRoaXMuemUociwgdCwgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQodCwgZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuLkNlICYmICh0LnNldChyLCBuLk1lKCkpLCBuLnhlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIGxldCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIC8vIFdlIGV4dHJhY3QgdGhlIHNldCBvZiBsaW1iby1vbmx5IGRvY3VtZW50IHVwZGF0ZXMgYXMgdGhlIEdDIGxvZ2ljXG4gICAgICAgIC8vIHNwZWNpYWwtY2FzZXMgZG9jdW1lbnRzIHRoYXQgZG8gbm90IGFwcGVhciBpbiB0aGUgdGFyZ2V0IGNhY2hlLlxuICAgICAgICBcbiAgICAgICAgLy8gVE9ETyhnc29sdGlzKTogRXhwYW5kIG9uIHRoaXMgY29tbWVudCBvbmNlIEdDIGlzIGF2YWlsYWJsZSBpbiB0aGUgSlNcbiAgICAgICAgLy8gY2xpZW50LlxuICAgICAgICAgICAgICAgIHRoaXMuJGUuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGxldCByID0gITA7XG4gICAgICAgICAgICB0LmZvckVhY2hXaGlsZSgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuWGUoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICF0IHx8IFwiVGFyZ2V0UHVycG9zZUxpbWJvUmVzb2x1dGlvblwiIC8qIFRhcmdldFB1cnBvc2UuTGltYm9SZXNvbHV0aW9uICovID09PSB0LnB1cnBvc2UgfHwgKHIgPSAhMSwgXG4gICAgICAgICAgICAgICAgITEpO1xuICAgICAgICAgICAgfSkpLCByICYmIChuID0gbi5hZGQoZSkpO1xuICAgICAgICB9KSksIHRoaXMuS2UuZm9yRWFjaCgoKHQsIG4pID0+IG4uc2V0UmVhZFRpbWUoZSkpKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBSZW1vdGVFdmVudChlLCB0LCB0aGlzLlVlLCB0aGlzLktlLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuS2UgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIHRoaXMuJGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRNYXAoKSwgXG4gICAgICAgIHRoaXMuVWUgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSwgcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgdG8gdGhlIGludGVybmFsIGxpc3Qgb2YgZG9jdW1lbnQgdXBkYXRlcyBhbmRcbiAgICAgKiBpdHMgZG9jdW1lbnQga2V5IHRvIHRoZSBnaXZlbiB0YXJnZXQncyBtYXBwaW5nLlxuICAgICAqL1xuICAgIC8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gICAgR2UoZSwgdCkge1xuICAgICAgICBpZiAoIXRoaXMuSmUoZSkpIHJldHVybjtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3QoZSwgdC5rZXkpID8gMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDogMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovO1xuICAgICAgICB0aGlzLkhlKGUpLk9lKHQua2V5LCBuKSwgdGhpcy5LZSA9IHRoaXMuS2UuaW5zZXJ0KHQua2V5LCB0KSwgdGhpcy4kZSA9IHRoaXMuJGUuaW5zZXJ0KHQua2V5LCB0aGlzLl90KHQua2V5KS5hZGQoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBwcm92aWRlZCBkb2N1bWVudCBmcm9tIHRoZSB0YXJnZXQgbWFwcGluZy4gSWYgdGhlXG4gICAgICogZG9jdW1lbnQgbm8gbG9uZ2VyIG1hdGNoZXMgdGhlIHRhcmdldCwgYnV0IHRoZSBkb2N1bWVudCdzIHN0YXRlIGlzIHN0aWxsXG4gICAgICoga25vd24gKGUuZy4gd2Uga25vdyB0aGF0IHRoZSBkb2N1bWVudCB3YXMgZGVsZXRlZCBvciB3ZSByZWNlaXZlZCB0aGUgY2hhbmdlXG4gICAgICogdGhhdCBjYXVzZWQgdGhlIGZpbHRlciBtaXNtYXRjaCksIHRoZSBuZXcgZG9jdW1lbnQgY2FuIGJlIHByb3ZpZGVkXG4gICAgICogdG8gdXBkYXRlIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUuXG4gICAgICovXG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAgICB6ZShlLCB0LCBuKSB7XG4gICAgICAgIGlmICghdGhpcy5KZShlKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCByID0gdGhpcy5IZShlKTtcbiAgICAgICAgdGhpcy5vdChlLCB0KSA/IHIuT2UodCwgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8pIDogXG4gICAgICAgIC8vIFRoZSBkb2N1bWVudCBtYXkgaGF2ZSBlbnRlcmVkIGFuZCBsZWZ0IHRoZSB0YXJnZXQgYmVmb3JlIHdlIHJhaXNlZCBhXG4gICAgICAgIC8vIHNuYXBzaG90LCBzbyB3ZSBjYW4ganVzdCBpZ25vcmUgdGhlIGNoYW5nZS5cbiAgICAgICAgci5OZSh0KSwgdGhpcy4kZSA9IHRoaXMuJGUuaW5zZXJ0KHQsIHRoaXMuX3QodCkuZGVsZXRlKGUpKSwgbiAmJiAodGhpcy5LZSA9IHRoaXMuS2UuaW5zZXJ0KHQsIG4pKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUpIHtcbiAgICAgICAgdGhpcy5RZS5kZWxldGUoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgY291bnQgb2YgZG9jdW1lbnRzIGluIHRoZSB0YXJnZXQuIFRoaXMgaW5jbHVkZXMgYm90aFxuICAgICAqIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHRoYXQgdGhlIExvY2FsU3RvcmUgY29uc2lkZXJzIHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogdGFyZ2V0IGFzIHdlbGwgYXMgYW55IGFjY3VtdWxhdGVkIGNoYW5nZXMuXG4gICAgICovICAgIGV0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuSGUoZSkuTWUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucWUuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldChlKS5zaXplICsgdC5hZGRlZERvY3VtZW50cy5zaXplIC0gdC5yZW1vdmVkRG9jdW1lbnRzLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIGFja3MgbmVlZGVkIGZyb20gd2F0Y2ggYmVmb3JlIHdlIGNhbiBjb25zaWRlciB0aGVcbiAgICAgKiBzZXJ2ZXIgdG8gYmUgJ2luLXN5bmMnIHdpdGggdGhlIGNsaWVudCdzIGFjdGl2ZSB0YXJnZXRzLlxuICAgICAqLyAgICBCZShlKSB7XG4gICAgICAgIHRoaXMuSGUoZSkuQmUoKTtcbiAgICB9XG4gICAgSGUoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuUWUuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUsIHRoaXMuUWUuc2V0KGUsIHQpKSwgdDtcbiAgICB9XG4gICAgX3QoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuJGUuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCB0aGlzLiRlID0gdGhpcy4kZS5pbnNlcnQoZSwgdCkpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmVyaWZpZXMgdGhhdCB0aGUgdXNlciBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoaXMgdGFyZ2V0IChieSBjYWxsaW5nXG4gICAgICogYGdldFRhcmdldERhdGFGb3JUYXJnZXQoKWApIGFuZCB0aGF0IHdlIGFyZSBub3Qgd2FpdGluZyBmb3IgcGVuZGluZyBBRERzXG4gICAgICogZnJvbSB3YXRjaC5cbiAgICAgKi8gICAgSmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gbnVsbCAhPT0gdGhpcy5YZShlKTtcbiAgICAgICAgcmV0dXJuIHQgfHwgX19QUklWQVRFX2xvZ0RlYnVnKFwiV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yXCIsIFwiRGV0ZWN0ZWQgaW5hY3RpdmUgdGFyZ2V0XCIsIGUpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgVGFyZ2V0RGF0YSBmb3IgYW4gYWN0aXZlIHRhcmdldCAoaS5lLiBhIHRhcmdldCB0aGF0IHRoZSB1c2VyXG4gICAgICogaXMgc3RpbGwgaW50ZXJlc3RlZCBpbiB0aGF0IGhhcyBubyBvdXRzdGFuZGluZyB0YXJnZXQgY2hhbmdlIHJlcXVlc3RzKS5cbiAgICAgKi8gICAgWGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5RZS5nZXQoZSk7XG4gICAgICAgIHJldHVybiB0ICYmIHQudmUgPyBudWxsIDogdGhpcy5xZS51dChlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBzdGF0ZSBvZiBhIFdhdGNoIHRhcmdldCB0byBpdHMgaW5pdGlhbCBzdGF0ZSAoZS5nLiBzZXRzXG4gICAgICogJ2N1cnJlbnQnIHRvIGZhbHNlLCBjbGVhcnMgdGhlIHJlc3VtZSB0b2tlbiBhbmQgcmVtb3ZlcyBpdHMgdGFyZ2V0IG1hcHBpbmdcbiAgICAgKiBmcm9tIGFsbCBkb2N1bWVudHMpLlxuICAgICAqLyAgICBZZShlKSB7XG4gICAgICAgIHRoaXMuUWUuc2V0KGUsIG5ldyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUpO1xuICAgICAgICB0aGlzLnFlLmdldFJlbW90ZUtleXNGb3JUYXJnZXQoZSkuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICB0aGlzLnplKGUsIHQsIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgTG9jYWxTdG9yZSBjb25zaWRlcnMgdGhlIGRvY3VtZW50IHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogc3BlY2lmaWVkIHRhcmdldC5cbiAgICAgKi8gICAgb3QoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5xZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpLmhhcyh0KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldE1hcCgpIHtcbiAgICByZXR1cm4gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3NuYXBzaG90Q2hhbmdlc01hcCgpIHtcbiAgICByZXR1cm4gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbn1cblxuY29uc3QgUGUgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGUgPSB7XG4gICAgICAgIGFzYzogXCJBU0NFTkRJTkdcIixcbiAgICAgICAgZGVzYzogXCJERVNDRU5ESU5HXCJcbiAgICB9O1xuICAgIHJldHVybiBlO1xufSkoKSwgSWUgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGUgPSB7XG4gICAgICAgIFwiPFwiOiBcIkxFU1NfVEhBTlwiLFxuICAgICAgICBcIjw9XCI6IFwiTEVTU19USEFOX09SX0VRVUFMXCIsXG4gICAgICAgIFwiPlwiOiBcIkdSRUFURVJfVEhBTlwiLFxuICAgICAgICBcIj49XCI6IFwiR1JFQVRFUl9USEFOX09SX0VRVUFMXCIsXG4gICAgICAgIFwiPT1cIjogXCJFUVVBTFwiLFxuICAgICAgICBcIiE9XCI6IFwiTk9UX0VRVUFMXCIsXG4gICAgICAgIFwiYXJyYXktY29udGFpbnNcIjogXCJBUlJBWV9DT05UQUlOU1wiLFxuICAgICAgICBpbjogXCJJTlwiLFxuICAgICAgICBcIm5vdC1pblwiOiBcIk5PVF9JTlwiLFxuICAgICAgICBcImFycmF5LWNvbnRhaW5zLWFueVwiOiBcIkFSUkFZX0NPTlRBSU5TX0FOWVwiXG4gICAgfTtcbiAgICByZXR1cm4gZTtcbn0pKCksIFRlID0gKCgpID0+IHtcbiAgICBjb25zdCBlID0ge1xuICAgICAgICBhbmQ6IFwiQU5EXCIsXG4gICAgICAgIG9yOiBcIk9SXCJcbiAgICB9O1xuICAgIHJldHVybiBlO1xufSkoKTtcblxuLyoqXG4gKiBUaGlzIGNsYXNzIGdlbmVyYXRlcyBKc29uT2JqZWN0IHZhbHVlcyBmb3IgdGhlIERhdGFzdG9yZSBBUEkgc3VpdGFibGUgZm9yXG4gKiBzZW5kaW5nIHRvIGVpdGhlciBHUlBDIHN0dWIgbWV0aG9kcyBvciB2aWEgdGhlIEpTT04vSFRUUCBSRVNUIEFQSS5cbiAqXG4gKiBUaGUgc2VyaWFsaXplciBzdXBwb3J0cyBib3RoIFByb3RvYnVmLmpzIGFuZCBQcm90bzMgSlNPTiBmb3JtYXRzLiBCeVxuICogc2V0dGluZyBgdXNlUHJvdG8zSnNvbmAgdG8gdHJ1ZSwgdGhlIHNlcmlhbGl6ZXIgd2lsbCB1c2UgdGhlIFByb3RvMyBKU09OXG4gKiBmb3JtYXQuXG4gKlxuICogRm9yIGEgZGVzY3JpcHRpb24gb2YgdGhlIFByb3RvMyBKU09OIGZvcm1hdCBjaGVja1xuICogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy9kb2NzL3Byb3RvMyNqc29uXG4gKlxuICogVE9ETyhrbGltdCk6IFdlIGNhbiByZW1vdmUgdGhlIGRhdGFiYXNlSWQgYXJndW1lbnQgaWYgd2Uga2VlcCB0aGUgZnVsbFxuICogcmVzb3VyY2UgbmFtZSBpbiBkb2N1bWVudHMuXG4gKi9cbmNsYXNzIEpzb25Qcm90b1NlcmlhbGl6ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gZSwgdGhpcy51c2VQcm90bzNKc29uID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIG51bWJlciAob3IgbnVsbCkgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvXG4gKiBhIGdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlIHByb3RvLlxuICogRE8gTk9UIFVTRSBUSElTIEZPUiBBTllUSElORyBFTFNFLlxuICogVGhpcyBtZXRob2QgY2hlYXRzLiBJdCdzIHR5cGVkIGFzIHJldHVybmluZyBcIm51bWJlclwiIGJlY2F1c2UgdGhhdCdzIHdoYXRcbiAqIG91ciBnZW5lcmF0ZWQgcHJvdG8gaW50ZXJmYWNlcyBzYXkgSW50MzJWYWx1ZSBtdXN0IGJlLiBCdXQgR1JQQyBhY3R1YWxseVxuICogZXhwZWN0cyBhIHsgdmFsdWU6IDxudW1iZXI+IH0gc3RydWN0LlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9JbnQzMlByb3RvKGUsIHQpIHtcbiAgICByZXR1cm4gZS51c2VQcm90bzNKc29uIHx8IF9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZCh0KSA/IHQgOiB7XG4gICAgICAgIHZhbHVlOiB0XG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgbnVtYmVyIChvciBudWxsKSBmcm9tIGEgZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUgcHJvdG8uXG4gKi9cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIERhdGUgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvIGEgcHJvdG8uXG4gKi9cbmZ1bmN0aW9uIHRvVGltZXN0YW1wKGUsIHQpIHtcbiAgICBpZiAoZS51c2VQcm90bzNKc29uKSB7XG4gICAgICAgIHJldHVybiBgJHtuZXcgRGF0ZSgxZTMgKiB0LnNlY29uZHMpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkKi8sIFwiXCIpLnJlcGxhY2UoXCJaXCIsIFwiXCIpfS4keyhcIjAwMDAwMDAwMFwiICsgdC5uYW5vc2Vjb25kcykuc2xpY2UoLTkpfVpgO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBcIlwiICsgdC5zZWNvbmRzLFxuICAgICAgICBuYW5vczogdC5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBieXRlcyB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGluIGEgcHJvdG8uXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3RvQnl0ZXMoZSwgdCkge1xuICAgIHJldHVybiBlLnVzZVByb3RvM0pzb24gPyB0LnRvQmFzZTY0KCkgOiB0LnRvVWludDhBcnJheSgpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBCeXRlU3RyaW5nIGJhc2VkIG9uIHRoZSBwcm90byBzdHJpbmcgdmFsdWUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvVmVyc2lvbihlLCB0KSB7XG4gICAgcmV0dXJuIHRvVGltZXN0YW1wKGUsIHQudG9UaW1lc3RhbXAoKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tVmVyc2lvbihlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZSksIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKGZ1bmN0aW9uIGZyb21UaW1lc3RhbXAoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBUaW1lc3RhbXAodC5zZWNvbmRzLCB0Lm5hbm9zKTtcbiAgICB9KGUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUsIHQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2Z1bGx5UXVhbGlmaWVkUHJlZml4UGF0aChlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVzb3VyY2VQYXRoKFsgXCJwcm9qZWN0c1wiLCBlLnByb2plY3RJZCwgXCJkYXRhYmFzZXNcIiwgZS5kYXRhYmFzZSBdKTtcbiAgICB9KGUpLmNoaWxkKFwiZG9jdW1lbnRzXCIpLmNoaWxkKHQpLmNhbm9uaWNhbFN0cmluZygpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVJlc291cmNlTmFtZShlKSB7XG4gICAgY29uc3QgdCA9IFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChfX1BSSVZBVEVfaXNWYWxpZFJlc291cmNlTmFtZSh0KSksIHQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b05hbWUoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdG9SZXNvdXJjZU5hbWUoZS5kYXRhYmFzZUlkLCB0LnBhdGgpO1xufVxuXG5mdW5jdGlvbiBmcm9tTmFtZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9mcm9tUmVzb3VyY2VOYW1lKHQpO1xuICAgIGlmIChuLmdldCgxKSAhPT0gZS5kYXRhYmFzZUlkLnByb2plY3RJZCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJUcmllZCB0byBkZXNlcmlhbGl6ZSBrZXkgZnJvbSBkaWZmZXJlbnQgcHJvamVjdDogXCIgKyBuLmdldCgxKSArIFwiIHZzIFwiICsgZS5kYXRhYmFzZUlkLnByb2plY3RJZCk7XG4gICAgaWYgKG4uZ2V0KDMpICE9PSBlLmRhdGFiYXNlSWQuZGF0YWJhc2UpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IGRhdGFiYXNlOiBcIiArIG4uZ2V0KDMpICsgXCIgdnMgXCIgKyBlLmRhdGFiYXNlSWQuZGF0YWJhc2UpO1xuICAgIHJldHVybiBuZXcgRG9jdW1lbnRLZXkoX19QUklWQVRFX2V4dHJhY3RMb2NhbFBhdGhGcm9tUmVzb3VyY2VOYW1lKG4pKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvUXVlcnlQYXRoKGUsIHQpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUuZGF0YWJhc2VJZCwgdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUXVlcnlQYXRoKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Zyb21SZXNvdXJjZU5hbWUoZSk7XG4gICAgLy8gSW4gdjFiZXRhMSBxdWVyaWVzIGZvciBjb2xsZWN0aW9ucyBhdCB0aGUgcm9vdCBkaWQgbm90IGhhdmUgYSB0cmFpbGluZ1xuICAgIC8vIFwiL2RvY3VtZW50c1wiLiBJbiB2MSBhbGwgcmVzb3VyY2UgcGF0aHMgY29udGFpbiBcIi9kb2N1bWVudHNcIi4gUHJlc2VydmUgdGhlXG4gICAgLy8gYWJpbGl0eSB0byByZWFkIHRoZSB2MWJldGExIGZvcm0gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBxdWVyaWVzIHBlcnNpc3RlZFxuICAgIC8vIGluIHRoZSBsb2NhbCB0YXJnZXQgY2FjaGUuXG4gICAgICAgIHJldHVybiA0ID09PSB0Lmxlbmd0aCA/IFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSA6IF9fUFJJVkFURV9leHRyYWN0TG9jYWxQYXRoRnJvbVJlc291cmNlTmFtZSh0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldEVuY29kZWREYXRhYmFzZUlkKGUpIHtcbiAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aChbIFwicHJvamVjdHNcIiwgZS5kYXRhYmFzZUlkLnByb2plY3RJZCwgXCJkYXRhYmFzZXNcIiwgZS5kYXRhYmFzZUlkLmRhdGFiYXNlIF0pLmNhbm9uaWNhbFN0cmluZygpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZXh0cmFjdExvY2FsUGF0aEZyb21SZXNvdXJjZU5hbWUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChlLmxlbmd0aCA+IDQgJiYgXCJkb2N1bWVudHNcIiA9PT0gZS5nZXQoNCkpLCBlLnBvcEZpcnN0KDUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIERvY3VtZW50IHByb3RvIGZyb20ga2V5IGFuZCBmaWVsZHMgKGJ1dCBubyBjcmVhdGUvdXBkYXRlIHRpbWUpICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b011dGF0aW9uRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IF9fUFJJVkFURV90b05hbWUoZSwgdCksXG4gICAgICAgIGZpZWxkczogbi52YWx1ZS5tYXBWYWx1ZS5maWVsZHNcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURvY3VtZW50KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gZnJvbU5hbWUoZSwgdC5uYW1lKSwgaSA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LnVwZGF0ZVRpbWUpLCBzID0gdC5jcmVhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuY3JlYXRlVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIG8gPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiB0LmZpZWxkc1xuICAgICAgICB9XG4gICAgfSksIF8gPSBNdXRhYmxlRG9jdW1lbnQubmV3Rm91bmREb2N1bWVudChyLCBpLCBzLCBvKTtcbiAgICByZXR1cm4gbiAmJiBfLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpLCBuID8gXy5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKSA6IF87XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tQmF0Y2hHZXREb2N1bWVudHNSZXNwb25zZShlLCB0KSB7XG4gICAgcmV0dXJuIFwiZm91bmRcIiBpbiB0ID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Gb3VuZChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhdC5mb3VuZCksIHQuZm91bmQubmFtZSwgdC5mb3VuZC51cGRhdGVUaW1lO1xuICAgICAgICBjb25zdCBuID0gZnJvbU5hbWUoZSwgdC5mb3VuZC5uYW1lKSwgciA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LmZvdW5kLnVwZGF0ZVRpbWUpLCBpID0gdC5mb3VuZC5jcmVhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuZm91bmQuY3JlYXRlVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIHMgPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHQuZm91bmQuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld0ZvdW5kRG9jdW1lbnQobiwgciwgaSwgcyk7XG4gICAgfShlLCB0KSA6IFwibWlzc2luZ1wiIGluIHQgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbU1pc3NpbmcoZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghIXQubWlzc2luZyksIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhdC5yZWFkVGltZSk7XG4gICAgICAgIGNvbnN0IG4gPSBmcm9tTmFtZShlLCB0Lm1pc3NpbmcpLCByID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQucmVhZFRpbWUpO1xuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQobiwgcik7XG4gICAgfShlLCB0KSA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21XYXRjaENoYW5nZShlLCB0KSB7XG4gICAgbGV0IG47XG4gICAgaWYgKFwidGFyZ2V0Q2hhbmdlXCIgaW4gdCkge1xuICAgICAgICB0LnRhcmdldENoYW5nZTtcbiAgICAgICAgLy8gcHJvdG8zIGRlZmF1bHQgdmFsdWUgaXMgdW5zZXQgaW4gSlNPTiAodW5kZWZpbmVkKSwgc28gdXNlICdOT19DSEFOR0UnXG4gICAgICAgIC8vIGlmIHVuc2V0XG4gICAgICAgIGNvbnN0IHIgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUoZSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiTk9fQ0hBTkdFXCIgPT09IGUgPyAwIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuTm9DaGFuZ2UgKi8gOiBcIkFERFwiID09PSBlID8gMSAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLkFkZGVkICovIDogXCJSRU1PVkVcIiA9PT0gZSA/IDIgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZW1vdmVkICovIDogXCJDVVJSRU5UXCIgPT09IGUgPyAzIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQ3VycmVudCAqLyA6IFwiUkVTRVRcIiA9PT0gZSA/IDQgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZXNldCAqLyA6IGZhaWwoKTtcbiAgICAgICAgfSh0LnRhcmdldENoYW5nZS50YXJnZXRDaGFuZ2VUeXBlIHx8IFwiTk9fQ0hBTkdFXCIpLCBpID0gdC50YXJnZXRDaGFuZ2UudGFyZ2V0SWRzIHx8IFtdLCBzID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CeXRlcyhlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gZS51c2VQcm90bzNKc29uID8gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHZvaWQgMCA9PT0gdCB8fCBcInN0cmluZ1wiID09IHR5cGVvZiB0KSwgXG4gICAgICAgICAgICBCeXRlU3RyaW5nLmZyb21CYXNlNjRTdHJpbmcodCB8fCBcIlwiKSkgOiAoX19QUklWQVRFX2hhcmRBc3NlcnQodm9pZCAwID09PSB0IHx8IHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSwgXG4gICAgICAgICAgICBCeXRlU3RyaW5nLmZyb21VaW50OEFycmF5KHQgfHwgbmV3IFVpbnQ4QXJyYXkpKTtcbiAgICAgICAgfShlLCB0LnRhcmdldENoYW5nZS5yZXN1bWVUb2tlbiksIG8gPSB0LnRhcmdldENoYW5nZS5jYXVzZSwgXyA9IG8gJiYgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21ScGNTdGF0dXMoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHZvaWQgMCA9PT0gZS5jb2RlID8gdi5VTktOT1dOIDogX19QUklWQVRFX21hcENvZGVGcm9tUnBjQ29kZShlLmNvZGUpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBGaXJlc3RvcmVFcnJvcih0LCBlLm1lc3NhZ2UgfHwgXCJcIik7XG4gICAgICAgIH0obyk7XG4gICAgICAgIG4gPSBuZXcgX19QUklWQVRFX1dhdGNoVGFyZ2V0Q2hhbmdlKHIsIGksIHMsIF8gfHwgbnVsbCk7XG4gICAgfSBlbHNlIGlmIChcImRvY3VtZW50Q2hhbmdlXCIgaW4gdCkge1xuICAgICAgICB0LmRvY3VtZW50Q2hhbmdlO1xuICAgICAgICBjb25zdCByID0gdC5kb2N1bWVudENoYW5nZTtcbiAgICAgICAgci5kb2N1bWVudCwgci5kb2N1bWVudC5uYW1lLCByLmRvY3VtZW50LnVwZGF0ZVRpbWU7XG4gICAgICAgIGNvbnN0IGkgPSBmcm9tTmFtZShlLCByLmRvY3VtZW50Lm5hbWUpLCBzID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHIuZG9jdW1lbnQudXBkYXRlVGltZSksIG8gPSByLmRvY3VtZW50LmNyZWF0ZVRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24oci5kb2N1bWVudC5jcmVhdGVUaW1lKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXyA9IG5ldyBPYmplY3RWYWx1ZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczogci5kb2N1bWVudC5maWVsZHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksIGEgPSBNdXRhYmxlRG9jdW1lbnQubmV3Rm91bmREb2N1bWVudChpLCBzLCBvLCBfKSwgdSA9IHIudGFyZ2V0SWRzIHx8IFtdLCBjID0gci5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9Eb2N1bWVudFdhdGNoQ2hhbmdlKHUsIGMsIGEua2V5LCBhKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnREZWxldGVcIiBpbiB0KSB7XG4gICAgICAgIHQuZG9jdW1lbnREZWxldGU7XG4gICAgICAgIGNvbnN0IHIgPSB0LmRvY3VtZW50RGVsZXRlO1xuICAgICAgICByLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBpID0gZnJvbU5hbWUoZSwgci5kb2N1bWVudCksIHMgPSByLnJlYWRUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHIucmVhZFRpbWUpIDogU25hcHNob3RWZXJzaW9uLm1pbigpLCBvID0gTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQoaSwgcyksIF8gPSByLnJlbW92ZWRUYXJnZXRJZHMgfHwgW107XG4gICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2UoW10sIF8sIG8ua2V5LCBvKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnRSZW1vdmVcIiBpbiB0KSB7XG4gICAgICAgIHQuZG9jdW1lbnRSZW1vdmU7XG4gICAgICAgIGNvbnN0IHIgPSB0LmRvY3VtZW50UmVtb3ZlO1xuICAgICAgICByLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBpID0gZnJvbU5hbWUoZSwgci5kb2N1bWVudCksIHMgPSByLnJlbW92ZWRUYXJnZXRJZHMgfHwgW107XG4gICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2UoW10sIHMsIGksIG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghKFwiZmlsdGVyXCIgaW4gdCkpIHJldHVybiBmYWlsKCk7XG4gICAgICAgIHtcbiAgICAgICAgICAgIHQuZmlsdGVyO1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuZmlsdGVyO1xuICAgICAgICAgICAgZS50YXJnZXRJZDtcbiAgICAgICAgICAgIGNvbnN0IHtjb3VudDogciA9IDAsIHVuY2hhbmdlZE5hbWVzOiBpfSA9IGUsIHMgPSBuZXcgRXhpc3RlbmNlRmlsdGVyKHIsIGkpLCBvID0gZS50YXJnZXRJZDtcbiAgICAgICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0V4aXN0ZW5jZUZpbHRlckNoYW5nZShvLCBzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbjtcbn1cblxuZnVuY3Rpb24gdG9NdXRhdGlvbihlLCB0KSB7XG4gICAgbGV0IG47XG4gICAgaWYgKHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2V0TXV0YXRpb24pIG4gPSB7XG4gICAgICAgIHVwZGF0ZTogX19QUklWQVRFX3RvTXV0YXRpb25Eb2N1bWVudChlLCB0LmtleSwgdC52YWx1ZSlcbiAgICB9OyBlbHNlIGlmICh0IGluc3RhbmNlb2YgX19QUklWQVRFX0RlbGV0ZU11dGF0aW9uKSBuID0ge1xuICAgICAgICBkZWxldGU6IF9fUFJJVkFURV90b05hbWUoZSwgdC5rZXkpXG4gICAgfTsgZWxzZSBpZiAodCBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKSBuID0ge1xuICAgICAgICB1cGRhdGU6IF9fUFJJVkFURV90b011dGF0aW9uRG9jdW1lbnQoZSwgdC5rZXksIHQuZGF0YSksXG4gICAgICAgIHVwZGF0ZU1hc2s6IF9fUFJJVkFURV90b0RvY3VtZW50TWFzayh0LmZpZWxkTWFzaylcbiAgICB9OyBlbHNlIHtcbiAgICAgICAgaWYgKCEodCBpbnN0YW5jZW9mIF9fUFJJVkFURV9WZXJpZnlNdXRhdGlvbikpIHJldHVybiBmYWlsKCk7XG4gICAgICAgIG4gPSB7XG4gICAgICAgICAgICB2ZXJpZnk6IF9fUFJJVkFURV90b05hbWUoZSwgdC5rZXkpXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB0LmZpZWxkVHJhbnNmb3Jtcy5sZW5ndGggPiAwICYmIChuLnVwZGF0ZVRyYW5zZm9ybXMgPSB0LmZpZWxkVHJhbnNmb3Jtcy5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX3RvRmllbGRUcmFuc2Zvcm0oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC50cmFuc2Zvcm07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSkgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogdC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIHNldFRvU2VydmVyVmFsdWU6IFwiUkVRVUVTVF9USU1FXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogdC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIGFwcGVuZE1pc3NpbmdFbGVtZW50czoge1xuICAgICAgICAgICAgICAgIHZhbHVlczogbi5lbGVtZW50c1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogdC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIHJlbW92ZUFsbEZyb21BcnJheToge1xuICAgICAgICAgICAgICAgIHZhbHVlczogbi5lbGVtZW50c1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiB0LmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgaW5jcmVtZW50OiBuLlRlXG4gICAgICAgIH07XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9KDAsIGUpKSkpLCB0LnByZWNvbmRpdGlvbi5pc05vbmUgfHwgKG4uY3VycmVudERvY3VtZW50ID0gZnVuY3Rpb24gX19QUklWQVRFX3RvUHJlY29uZGl0aW9uKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdC51cGRhdGVUaW1lID8ge1xuICAgICAgICAgICAgdXBkYXRlVGltZTogX19QUklWQVRFX3RvVmVyc2lvbihlLCB0LnVwZGF0ZVRpbWUpXG4gICAgICAgIH0gOiB2b2lkIDAgIT09IHQuZXhpc3RzID8ge1xuICAgICAgICAgICAgZXhpc3RzOiB0LmV4aXN0c1xuICAgICAgICB9IDogZmFpbCgpO1xuICAgIH0oZSwgdC5wcmVjb25kaXRpb24pKSwgbjtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21NdXRhdGlvbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IHQuY3VycmVudERvY3VtZW50ID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21QcmVjb25kaXRpb24oZSkge1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlLnVwZGF0ZVRpbWUgPyBQcmVjb25kaXRpb24udXBkYXRlVGltZShfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS51cGRhdGVUaW1lKSkgOiB2b2lkIDAgIT09IGUuZXhpc3RzID8gUHJlY29uZGl0aW9uLmV4aXN0cyhlLmV4aXN0cykgOiBQcmVjb25kaXRpb24ubm9uZSgpO1xuICAgIH0odC5jdXJyZW50RG9jdW1lbnQpIDogUHJlY29uZGl0aW9uLm5vbmUoKSwgciA9IHQudXBkYXRlVHJhbnNmb3JtcyA/IHQudXBkYXRlVHJhbnNmb3Jtcy5tYXAoKHQgPT4gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWVsZFRyYW5zZm9ybShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gbnVsbDtcbiAgICAgICAgaWYgKFwic2V0VG9TZXJ2ZXJWYWx1ZVwiIGluIHQpIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwiUkVRVUVTVF9USU1FXCIgPT09IHQuc2V0VG9TZXJ2ZXJWYWx1ZSksIFxuICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm07IGVsc2UgaWYgKFwiYXBwZW5kTWlzc2luZ0VsZW1lbnRzXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuYXBwZW5kTWlzc2luZ0VsZW1lbnRzLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24oZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJyZW1vdmVBbGxGcm9tQXJyYXlcIiBpbiB0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5yZW1vdmVBbGxGcm9tQXJyYXkudmFsdWVzIHx8IFtdO1xuICAgICAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24oZSk7XG4gICAgICAgIH0gZWxzZSBcImluY3JlbWVudFwiIGluIHQgPyBuID0gbmV3IF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQuaW5jcmVtZW50KSA6IGZhaWwoKTtcbiAgICAgICAgY29uc3QgciA9IEZpZWxkUGF0aCQxLmZyb21TZXJ2ZXJGb3JtYXQodC5maWVsZFBhdGgpO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkVHJhbnNmb3JtKHIsIG4pO1xuICAgIH0oZSwgdCkpKSA6IFtdO1xuICAgIGlmICh0LnVwZGF0ZSkge1xuICAgICAgICB0LnVwZGF0ZS5uYW1lO1xuICAgICAgICBjb25zdCBpID0gZnJvbU5hbWUoZSwgdC51cGRhdGUubmFtZSksIHMgPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHQudXBkYXRlLmZpZWxkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHQudXBkYXRlTWFzaykge1xuICAgICAgICAgICAgY29uc3QgZSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRG9jdW1lbnRNYXNrKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5maWVsZFBhdGhzIHx8IFtdO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGRNYXNrKHQubWFwKChlID0+IEZpZWxkUGF0aCQxLmZyb21TZXJ2ZXJGb3JtYXQoZSkpKSk7XG4gICAgICAgICAgICB9KHQudXBkYXRlTWFzayk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGksIHMsIGUsIG4sIHIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1NldE11dGF0aW9uKGksIHMsIG4sIHIpO1xuICAgIH1cbiAgICBpZiAodC5kZWxldGUpIHtcbiAgICAgICAgY29uc3QgciA9IGZyb21OYW1lKGUsIHQuZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfRGVsZXRlTXV0YXRpb24ociwgbik7XG4gICAgfVxuICAgIGlmICh0LnZlcmlmeSkge1xuICAgICAgICBjb25zdCByID0gZnJvbU5hbWUoZSwgdC52ZXJpZnkpO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9WZXJpZnlNdXRhdGlvbihyLCBuKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Xcml0ZVJlc3VsdHMoZSwgdCkge1xuICAgIHJldHVybiBlICYmIGUubGVuZ3RoID4gMCA/IChfX1BSSVZBVEVfaGFyZEFzc2VydCh2b2lkIDAgIT09IHQpLCBlLm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdyaXRlUmVzdWx0KGUsIHQpIHtcbiAgICAgICAgLy8gTk9URTogRGVsZXRlcyBkb24ndCBoYXZlIGFuIHVwZGF0ZVRpbWUuXG4gICAgICAgIGxldCBuID0gZS51cGRhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKGUudXBkYXRlVGltZSkgOiBfX1BSSVZBVEVfZnJvbVZlcnNpb24odCk7XG4gICAgICAgIHJldHVybiBuLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSAmJiAoXG4gICAgICAgIC8vIFRoZSBGaXJlc3RvcmUgRW11bGF0b3IgY3VycmVudGx5IHJldHVybnMgYW4gdXBkYXRlIHRpbWUgb2YgMCBmb3JcbiAgICAgICAgLy8gZGVsZXRlcyBvZiBub24tZXhpc3RpbmcgZG9jdW1lbnRzIChyYXRoZXIgdGhhbiBudWxsKS4gVGhpcyBicmVha3MgdGhlXG4gICAgICAgIC8vIHRlc3QgXCJnZXQgZGVsZXRlZCBkb2Mgd2hpbGUgb2ZmbGluZSB3aXRoIHNvdXJjZT1jYWNoZVwiIGFzIE5vRG9jdW1lbnRzXG4gICAgICAgIC8vIHdpdGggdmVyc2lvbiAwIGFyZSBmaWx0ZXJlZCBieSBJbmRleGVkRGIncyBSZW1vdGVEb2N1bWVudENhY2hlLlxuICAgICAgICAvLyBUT0RPKCMyMTQ5KTogUmVtb3ZlIHRoaXMgd2hlbiBFbXVsYXRvciBpcyBmaXhlZFxuICAgICAgICBuID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQpKSwgbmV3IE11dGF0aW9uUmVzdWx0KG4sIGUudHJhbnNmb3JtUmVzdWx0cyB8fCBbXSk7XG4gICAgfShlLCB0KSkpKSA6IFtdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9Eb2N1bWVudHNUYXJnZXQoZSwgdCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGRvY3VtZW50czogWyBfX1BSSVZBVEVfdG9RdWVyeVBhdGgoZSwgdC5wYXRoKSBdXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvUXVlcnlUYXJnZXQoZSwgdCkge1xuICAgIC8vIERpc3NlY3QgdGhlIHBhdGggaW50byBwYXJlbnQsIGNvbGxlY3Rpb25JZCwgYW5kIG9wdGlvbmFsIGtleSBmaWx0ZXIuXG4gICAgY29uc3QgbiA9IHtcbiAgICAgICAgc3RydWN0dXJlZFF1ZXJ5OiB7fVxuICAgIH0sIHIgPSB0LnBhdGg7XG4gICAgbnVsbCAhPT0gdC5jb2xsZWN0aW9uR3JvdXAgPyAobi5wYXJlbnQgPSBfX1BSSVZBVEVfdG9RdWVyeVBhdGgoZSwgciksIG4uc3RydWN0dXJlZFF1ZXJ5LmZyb20gPSBbIHtcbiAgICAgICAgY29sbGVjdGlvbklkOiB0LmNvbGxlY3Rpb25Hcm91cCxcbiAgICAgICAgYWxsRGVzY2VuZGFudHM6ICEwXG4gICAgfSBdKSA6IChuLnBhcmVudCA9IF9fUFJJVkFURV90b1F1ZXJ5UGF0aChlLCByLnBvcExhc3QoKSksIG4uc3RydWN0dXJlZFF1ZXJ5LmZyb20gPSBbIHtcbiAgICAgICAgY29sbGVjdGlvbklkOiByLmxhc3RTZWdtZW50KClcbiAgICB9IF0pO1xuICAgIGNvbnN0IGkgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9GaWx0ZXJzKGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdG9GaWx0ZXIoQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShlLCBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLykpO1xuICAgIH0odC5maWx0ZXJzKTtcbiAgICBpICYmIChuLnN0cnVjdHVyZWRRdWVyeS53aGVyZSA9IGkpO1xuICAgIGNvbnN0IHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9PcmRlcihlKSB7XG4gICAgICAgIGlmICgwID09PSBlLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICByZXR1cm4gZS5tYXAoKGUgPT4gXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3RvUHJvcGVydHlPcmRlcihlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBfX1BSSVZBVEVfdG9EaXJlY3Rpb24oZS5kaXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KGUpKSk7XG4gICAgfSh0Lm9yZGVyQnkpO1xuICAgIHMgJiYgKG4uc3RydWN0dXJlZFF1ZXJ5Lm9yZGVyQnkgPSBzKTtcbiAgICBjb25zdCBvID0gX19QUklWQVRFX3RvSW50MzJQcm90byhlLCB0LmxpbWl0KTtcbiAgICByZXR1cm4gbnVsbCAhPT0gbyAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkubGltaXQgPSBvKSwgdC5zdGFydEF0ICYmIChuLnN0cnVjdHVyZWRRdWVyeS5zdGFydEF0ID0gZnVuY3Rpb24gX19QUklWQVRFX3RvU3RhcnRBdEN1cnNvcihlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWZvcmU6IGUuaW5jbHVzaXZlLFxuICAgICAgICAgICAgdmFsdWVzOiBlLnBvc2l0aW9uXG4gICAgICAgIH07XG4gICAgfSh0LnN0YXJ0QXQpKSwgdC5lbmRBdCAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkuZW5kQXQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9FbmRBdEN1cnNvcihlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWZvcmU6ICFlLmluY2x1c2l2ZSxcbiAgICAgICAgICAgIHZhbHVlczogZS5wb3NpdGlvblxuICAgICAgICB9O1xuICAgIH0odC5lbmRBdCkpLCBuO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29udmVydFF1ZXJ5VGFyZ2V0VG9RdWVyeShlKSB7XG4gICAgbGV0IHQgPSBfX1BSSVZBVEVfZnJvbVF1ZXJ5UGF0aChlLnBhcmVudCk7XG4gICAgY29uc3QgbiA9IGUuc3RydWN0dXJlZFF1ZXJ5LCByID0gbi5mcm9tID8gbi5mcm9tLmxlbmd0aCA6IDA7XG4gICAgbGV0IGkgPSBudWxsO1xuICAgIGlmIChyID4gMCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSByKTtcbiAgICAgICAgY29uc3QgZSA9IG4uZnJvbVswXTtcbiAgICAgICAgZS5hbGxEZXNjZW5kYW50cyA/IGkgPSBlLmNvbGxlY3Rpb25JZCA6IHQgPSB0LmNoaWxkKGUuY29sbGVjdGlvbklkKTtcbiAgICB9XG4gICAgbGV0IHMgPSBbXTtcbiAgICBuLndoZXJlICYmIChzID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWx0ZXJzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRmlsdGVyKGUpO1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24odCkpIHJldHVybiB0LmdldEZpbHRlcnMoKTtcbiAgICAgICAgcmV0dXJuIFsgdCBdO1xuICAgIH0obi53aGVyZSkpO1xuICAgIGxldCBvID0gW107XG4gICAgbi5vcmRlckJ5ICYmIChvID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21PcmRlcihlKSB7XG4gICAgICAgIHJldHVybiBlLm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVByb3BlcnR5T3JkZXIoZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPcmRlckJ5KF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUuZmllbGQpLCBcbiAgICAgICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGlyZWN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgXCJBU0NFTkRJTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLztcblxuICAgICAgICAgICAgICAgICAgY2FzZSBcIkRFU0NFTkRJTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICAgICAgKGUuZGlyZWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICAoZSkpKTtcbiAgICB9KG4ub3JkZXJCeSkpO1xuICAgIGxldCBfID0gbnVsbDtcbiAgICBuLmxpbWl0ICYmIChfID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21JbnQzMlByb3RvKGUpIHtcbiAgICAgICAgbGV0IHQ7XG4gICAgICAgIHJldHVybiB0ID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSA/IGUudmFsdWUgOiBlLCBfX1BSSVZBVEVfaXNOdWxsT3JVbmRlZmluZWQodCkgPyBudWxsIDogdDtcbiAgICB9KG4ubGltaXQpKTtcbiAgICBsZXQgYSA9IG51bGw7XG4gICAgbi5zdGFydEF0ICYmIChhID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21TdGFydEF0Q3Vyc29yKGUpIHtcbiAgICAgICAgY29uc3QgdCA9ICEhZS5iZWZvcmUsIG4gPSBlLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChuLCB0KTtcbiAgICB9KG4uc3RhcnRBdCkpO1xuICAgIGxldCB1ID0gbnVsbDtcbiAgICByZXR1cm4gbi5lbmRBdCAmJiAodSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRW5kQXRDdXJzb3IoZSkge1xuICAgICAgICBjb25zdCB0ID0gIWUuYmVmb3JlLCBuID0gZS52YWx1ZXMgfHwgW107XG4gICAgICAgIHJldHVybiBuZXcgQm91bmQobiwgdCk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAobi5lbmRBdCkpLCBfX1BSSVZBVEVfbmV3UXVlcnkodCwgaSwgbywgcywgXywgXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovICwgYSwgdSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0xpc3RlblJlcXVlc3RMYWJlbHMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9MYWJlbChlKSB7XG4gICAgICAgIHN3aXRjaCAoZSkge1xuICAgICAgICAgIGNhc2UgXCJUYXJnZXRQdXJwb3NlTGlzdGVuXCIgLyogVGFyZ2V0UHVycG9zZS5MaXN0ZW4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICBjYXNlIFwiVGFyZ2V0UHVycG9zZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoXCIgLyogVGFyZ2V0UHVycG9zZS5FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gXCJleGlzdGVuY2UtZmlsdGVyLW1pc21hdGNoXCI7XG5cbiAgICAgICAgICBjYXNlIFwiVGFyZ2V0UHVycG9zZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb21cIiAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb20gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFwiZXhpc3RlbmNlLWZpbHRlci1taXNtYXRjaC1ibG9vbVwiO1xuXG4gICAgICAgICAgY2FzZSBcIlRhcmdldFB1cnBvc2VMaW1ib1Jlc29sdXRpb25cIiAvKiBUYXJnZXRQdXJwb3NlLkxpbWJvUmVzb2x1dGlvbiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gXCJsaW1iby1kb2N1bWVudFwiO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9KHQucHVycG9zZSk7XG4gICAgcmV0dXJuIG51bGwgPT0gbiA/IG51bGwgOiB7XG4gICAgICAgIFwiZ29vZy1saXN0ZW4tdGFnc1wiOiBuXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWx0ZXIoZSkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudW5hcnlGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVVuYXJ5RmlsdGVyKGUpIHtcbiAgICAgICAgc3dpdGNoIChlLnVuYXJ5RmlsdGVyLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIklTX05BTlwiOlxuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZSh0LCBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjYXNlIFwiSVNfTlVMTFwiOlxuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShuLCBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjYXNlIFwiSVNfTk9UX05BTlwiOlxuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShyLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05PVF9OVUxMXCI6XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2Zyb21GaWVsZFBhdGhSZWZlcmVuY2UoZS51bmFyeUZpbHRlci5maWVsZCk7XG4gICAgICAgICAgICByZXR1cm4gRmllbGRGaWx0ZXIuY3JlYXRlKGksIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgfVxuICAgIH0oZSkgOiB2b2lkIDAgIT09IGUuZmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUZpZWxkRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkRmlsdGVyLmZpZWxkKSwgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21PcGVyYXRvck5hbWUoZSkge1xuICAgICAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJFUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIk5PVF9FUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJHUkVBVEVSX1RIQU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJHUkVBVEVSX1RIQU5fT1JfRVFVQUxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTEVTU19USEFOXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTEVTU19USEFOX09SX0VRVUFMXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiSU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpblwiIC8qIE9wZXJhdG9yLklOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJOT1RfSU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TX0FOWVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZS5maWVsZEZpbHRlci5vcCksIGUuZmllbGRGaWx0ZXIudmFsdWUpO1xuICAgIH0oZSkgOiB2b2lkIDAgIT09IGUuY29tcG9zaXRlRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Db21wb3NpdGVGaWx0ZXIoZSkge1xuICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShlLmNvbXBvc2l0ZUZpbHRlci5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfZnJvbUZpbHRlcihlKSkpLCBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUNvbXBvc2l0ZU9wZXJhdG9yTmFtZShlKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkFORFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiT1JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfShlLmNvbXBvc2l0ZUZpbHRlci5vcCkpO1xuICAgIH0oZSkgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RpcmVjdGlvbihlKSB7XG4gICAgcmV0dXJuIFBlW2VdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9PcGVyYXRvck5hbWUoZSkge1xuICAgIHJldHVybiBJZVtlXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvQ29tcG9zaXRlT3BlcmF0b3JOYW1lKGUpIHtcbiAgICByZXR1cm4gVGVbZV07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZmllbGRQYXRoOiBlLmNhbm9uaWNhbFN0cmluZygpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWVsZFBhdGhSZWZlcmVuY2UoZSkge1xuICAgIHJldHVybiBGaWVsZFBhdGgkMS5mcm9tU2VydmVyRm9ybWF0KGUuZmllbGRQYXRoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRmlsdGVyKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX3RvVW5hcnlPckZpZWxkRmlsdGVyKGUpIHtcbiAgICAgICAgaWYgKFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA9PT0gZS5vcCkge1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc05hblZhbHVlKGUudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfaXNOdWxsVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTlVMTFwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovID09PSBlLm9wKSB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzTmFuVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfaXNOdWxsVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05VTExcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICBvcDogX19QUklWQVRFX3RvT3BlcmF0b3JOYW1lKGUub3ApLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBlLnZhbHVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfShlKSA6IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9Db21wb3NpdGVGaWx0ZXIoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5nZXRGaWx0ZXJzKCkubWFwKChlID0+IF9fUFJJVkFURV90b0ZpbHRlcihlKSkpO1xuICAgICAgICBpZiAoMSA9PT0gdC5sZW5ndGgpIHJldHVybiB0WzBdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29tcG9zaXRlRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgb3A6IF9fUFJJVkFURV90b0NvbXBvc2l0ZU9wZXJhdG9yTmFtZShlLm9wKSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJzOiB0XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfShlKSA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRG9jdW1lbnRNYXNrKGUpIHtcbiAgICBjb25zdCB0ID0gW107XG4gICAgcmV0dXJuIGUuZmllbGRzLmZvckVhY2goKGUgPT4gdC5wdXNoKGUuY2Fub25pY2FsU3RyaW5nKCkpKSksIHtcbiAgICAgICAgZmllbGRQYXRoczogdFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKGUpIHtcbiAgICAvLyBSZXNvdXJjZSBuYW1lcyBoYXZlIGF0IGxlYXN0IDQgY29tcG9uZW50cyAocHJvamVjdCBJRCwgZGF0YWJhc2UgSUQpXG4gICAgcmV0dXJuIGUubGVuZ3RoID49IDQgJiYgXCJwcm9qZWN0c1wiID09PSBlLmdldCgwKSAmJiBcImRhdGFiYXNlc1wiID09PSBlLmdldCgyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIHNldCBvZiBtZXRhZGF0YSB0aGF0IHRoZSBsb2NhbCBzdG9yZSB0cmFja3MgZm9yIGVhY2ggdGFyZ2V0LlxuICovIGNsYXNzIFRhcmdldERhdGEge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdGFyZ2V0IGJlaW5nIGxpc3RlbmVkIHRvLiAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSB0YXJnZXQgSUQgdG8gd2hpY2ggdGhlIHRhcmdldCBjb3JyZXNwb25kczsgQXNzaWduZWQgYnkgdGhlXG4gICAgICogTG9jYWxTdG9yZSBmb3IgdXNlciBsaXN0ZW5zIGFuZCBieSB0aGUgU3luY0VuZ2luZSBmb3IgbGltYm8gd2F0Y2hlcy5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIHB1cnBvc2Ugb2YgdGhlIHRhcmdldC4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2VxdWVuY2UgbnVtYmVyIG9mIHRoZSBsYXN0IHRyYW5zYWN0aW9uIGR1cmluZyB3aGljaCB0aGlzIHRhcmdldCBkYXRhXG4gICAgICogd2FzIG1vZGlmaWVkLlxuICAgICAqL1xuICAgIHIsIFxuICAgIC8qKiBUaGUgbGF0ZXN0IHNuYXBzaG90IHZlcnNpb24gc2VlbiBmb3IgdGhpcyB0YXJnZXQuICovXG4gICAgaSA9IFNuYXBzaG90VmVyc2lvbi5taW4oKVxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIHNuYXBzaG90IHZlcnNpb24gYXQgd2hpY2ggdGhlIGFzc29jaWF0ZWQgdmlld1xuICAgICAqIGNvbnRhaW5lZCBubyBsaW1ibyBkb2N1bWVudHMuXG4gICAgICovICwgcyA9IFNuYXBzaG90VmVyc2lvbi5taW4oKVxuICAgIC8qKlxuICAgICAqIEFuIG9wYXF1ZSwgc2VydmVyLWFzc2lnbmVkIHRva2VuIHRoYXQgYWxsb3dzIHdhdGNoaW5nIGEgdGFyZ2V0IHRvIGJlXG4gICAgICogcmVzdW1lZCBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXRcbiAgICAgKiBtYXRjaGVzIHRoZSB0YXJnZXQuIFRoZSByZXN1bWUgdG9rZW4gZXNzZW50aWFsbHkgaWRlbnRpZmllcyBhIHBvaW50IGluXG4gICAgICogdGltZSBmcm9tIHdoaWNoIHRoZSBzZXJ2ZXIgc2hvdWxkIHJlc3VtZSBzZW5kaW5nIHJlc3VsdHMuXG4gICAgICovICwgbyA9IEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkdcbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIGRvY3VtZW50cyB0aGF0IGxhc3QgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIHJlc3VtZSB0b2tlbiBvclxuICAgICAqIHJlYWQgdGltZS4gRG9jdW1lbnRzIGFyZSBjb3VudGVkIG9ubHkgd2hlbiBtYWtpbmcgYSBsaXN0ZW4gcmVxdWVzdCB3aXRoXG4gICAgICogcmVzdW1lIHRva2VuIG9yIHJlYWQgdGltZSwgb3RoZXJ3aXNlLCBrZWVwIGl0IG51bGwuXG4gICAgICovICwgXyA9IG51bGwpIHtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBlLCB0aGlzLnRhcmdldElkID0gdCwgdGhpcy5wdXJwb3NlID0gbiwgdGhpcy5zZXF1ZW5jZU51bWJlciA9IHIsIHRoaXMuc25hcHNob3RWZXJzaW9uID0gaSwgXG4gICAgICAgIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA9IHMsIHRoaXMucmVzdW1lVG9rZW4gPSBvLCB0aGlzLmV4cGVjdGVkQ291bnQgPSBfO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgc2VxdWVuY2UgbnVtYmVyLiAqLyAgICB3aXRoU2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldERhdGEodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgZSwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdGhpcy5yZXN1bWVUb2tlbiwgdGhpcy5leHBlY3RlZENvdW50KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgcmVzdW1lIHRva2VuIGFuZFxuICAgICAqIHNuYXBzaG90IHZlcnNpb24uXG4gICAgICovICAgIHdpdGhSZXN1bWVUb2tlbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgVGFyZ2V0RGF0YSh0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRJZCwgdGhpcy5wdXJwb3NlLCB0aGlzLnNlcXVlbmNlTnVtYmVyLCB0LCB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24sIGUsIFxuICAgICAgICAvKiBleHBlY3RlZENvdW50PSAqLyBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgZXhwZWN0ZWQgY291bnQuXG4gICAgICovICAgIHdpdGhFeHBlY3RlZENvdW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXREYXRhKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIHRoaXMuc2VxdWVuY2VOdW1iZXIsIHRoaXMuc25hcHNob3RWZXJzaW9uLCB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24sIHRoaXMucmVzdW1lVG9rZW4sIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRhcmdldCBkYXRhIGluc3RhbmNlIHdpdGggYW4gdXBkYXRlZCBsYXN0IGxpbWJvIGZyZWVcbiAgICAgKiBzbmFwc2hvdCB2ZXJzaW9uIG51bWJlci5cbiAgICAgKi8gICAgd2l0aExhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldERhdGEodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdGhpcy5zZXF1ZW5jZU51bWJlciwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIGUsIHRoaXMucmVzdW1lVG9rZW4sIHRoaXMuZXhwZWN0ZWRDb3VudCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFNlcmlhbGl6ZXIgZm9yIHZhbHVlcyBzdG9yZWQgaW4gdGhlIExvY2FsU3RvcmUuICovIGNsYXNzIF9fUFJJVkFURV9Mb2NhbFNlcmlhbGl6ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5jdCA9IGU7XG4gICAgfVxufVxuXG4vKiogRGVjb2RlcyBhIHJlbW90ZSBkb2N1bWVudCBmcm9tIHN0b3JhZ2UgbG9jYWxseSB0byBhIERvY3VtZW50LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiUmVtb3RlRG9jdW1lbnQoZSwgdCkge1xuICAgIGxldCBuO1xuICAgIGlmICh0LmRvY3VtZW50KSBuID0gX19QUklWQVRFX2Zyb21Eb2N1bWVudChlLmN0LCB0LmRvY3VtZW50LCAhIXQuaGFzQ29tbWl0dGVkTXV0YXRpb25zKTsgZWxzZSBpZiAodC5ub0RvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IGUgPSBEb2N1bWVudEtleS5mcm9tU2VnbWVudHModC5ub0RvY3VtZW50LnBhdGgpLCByID0gX19QUklWQVRFX2Zyb21EYlRpbWVzdGFtcCh0Lm5vRG9jdW1lbnQucmVhZFRpbWUpO1xuICAgICAgICBuID0gTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQoZSwgciksIHQuaGFzQ29tbWl0dGVkTXV0YXRpb25zICYmIG4uc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCF0LnVua25vd25Eb2N1bWVudCkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgZSA9IERvY3VtZW50S2V5LmZyb21TZWdtZW50cyh0LnVua25vd25Eb2N1bWVudC5wYXRoKSwgciA9IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAodC51bmtub3duRG9jdW1lbnQudmVyc2lvbik7XG4gICAgICAgICAgICBuID0gTXV0YWJsZURvY3VtZW50Lm5ld1Vua25vd25Eb2N1bWVudChlLCByKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdC5yZWFkVGltZSAmJiBuLnNldFJlYWRUaW1lKGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXBLZXkoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IFRpbWVzdGFtcChlWzBdLCBlWzFdKTtcbiAgICAgICAgcmV0dXJuIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKHQpO1xuICAgIH0odC5yZWFkVGltZSkpLCBuO1xufVxuXG4vKiogRW5jb2RlcyBhIGRvY3VtZW50IGZvciBzdG9yYWdlIGxvY2FsbHkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b0RiUmVtb3RlRG9jdW1lbnQoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmtleSwgciA9IHtcbiAgICAgICAgcHJlZml4UGF0aDogbi5nZXRDb2xsZWN0aW9uUGF0aCgpLnBvcExhc3QoKS50b0FycmF5KCksXG4gICAgICAgIGNvbGxlY3Rpb25Hcm91cDogbi5jb2xsZWN0aW9uR3JvdXAsXG4gICAgICAgIGRvY3VtZW50SWQ6IG4ucGF0aC5sYXN0U2VnbWVudCgpLFxuICAgICAgICByZWFkVGltZTogX19QUklWQVRFX3RvRGJUaW1lc3RhbXBLZXkodC5yZWFkVGltZSksXG4gICAgICAgIGhhc0NvbW1pdHRlZE11dGF0aW9uczogdC5oYXNDb21taXR0ZWRNdXRhdGlvbnNcbiAgICB9O1xuICAgIGlmICh0LmlzRm91bmREb2N1bWVudCgpKSByLmRvY3VtZW50ID0gZnVuY3Rpb24gX19QUklWQVRFX3RvRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogX19QUklWQVRFX3RvTmFtZShlLCB0LmtleSksXG4gICAgICAgICAgICBmaWVsZHM6IHQuZGF0YS52YWx1ZS5tYXBWYWx1ZS5maWVsZHMsXG4gICAgICAgICAgICB1cGRhdGVUaW1lOiB0b1RpbWVzdGFtcChlLCB0LnZlcnNpb24udG9UaW1lc3RhbXAoKSksXG4gICAgICAgICAgICBjcmVhdGVUaW1lOiB0b1RpbWVzdGFtcChlLCB0LmNyZWF0ZVRpbWUudG9UaW1lc3RhbXAoKSlcbiAgICAgICAgfTtcbiAgICB9KGUuY3QsIHQpOyBlbHNlIGlmICh0LmlzTm9Eb2N1bWVudCgpKSByLm5vRG9jdW1lbnQgPSB7XG4gICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgIHJlYWRUaW1lOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0LnZlcnNpb24pXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghdC5pc1Vua25vd25Eb2N1bWVudCgpKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICByLnVua25vd25Eb2N1bWVudCA9IHtcbiAgICAgICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgICAgICB2ZXJzaW9uOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0LnZlcnNpb24pXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleShlKSB7XG4gICAgY29uc3QgdCA9IGUudG9UaW1lc3RhbXAoKTtcbiAgICByZXR1cm4gWyB0LnNlY29uZHMsIHQubmFub3NlY29uZHMgXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJUaW1lc3RhbXAoZSkge1xuICAgIGNvbnN0IHQgPSBlLnRvVGltZXN0YW1wKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogdC5zZWNvbmRzLFxuICAgICAgICBuYW5vc2Vjb25kczogdC5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZSkge1xuICAgIGNvbnN0IHQgPSBuZXcgVGltZXN0YW1wKGUuc2Vjb25kcywgZS5uYW5vc2Vjb25kcyk7XG4gICAgcmV0dXJuIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKHQpO1xufVxuXG4vKiogRW5jb2RlcyBhIGJhdGNoIG9mIG11dGF0aW9ucyBpbnRvIGEgRGJNdXRhdGlvbkJhdGNoIGZvciBsb2NhbCBzdG9yYWdlLiAqL1xuLyoqIERlY29kZXMgYSBEYk11dGF0aW9uQmF0Y2ggaW50byBhIE11dGF0aW9uQmF0Y2ggKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICBjb25zdCBuID0gKHQuYmFzZU11dGF0aW9ucyB8fCBbXSkubWFwKCh0ID0+IF9fUFJJVkFURV9mcm9tTXV0YXRpb24oZS5jdCwgdCkpKTtcbiAgICAvLyBTcXVhc2ggb2xkIHRyYW5zZm9ybSBtdXRhdGlvbnMgaW50byBleGlzdGluZyBwYXRjaCBvciBzZXQgbXV0YXRpb25zLlxuICAgIC8vIFRoZSByZXBsYWNlbWVudCBvZiByZXByZXNlbnRpbmcgYHRyYW5zZm9ybXNgIHdpdGggYHVwZGF0ZV90cmFuc2Zvcm1zYFxuICAgIC8vIG9uIHRoZSBTREsgbWVhbnMgdGhhdCBvbGQgYHRyYW5zZm9ybWAgbXV0YXRpb25zIHN0b3JlZCBpbiBJbmRleGVkREIgbmVlZFxuICAgIC8vIHRvIGJlIHVwZGF0ZWQgdG8gYHVwZGF0ZV90cmFuc2Zvcm1zYC5cbiAgICAvLyBUT0RPKGIvMTc0NjA4Mzc0KTogUmVtb3ZlIHRoaXMgY29kZSBvbmNlIHdlIHBlcmZvcm0gYSBzY2hlbWEgbWlncmF0aW9uLlxuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubXV0YXRpb25zLmxlbmd0aCAtIDE7ICsrZSkge1xuICAgICAgICBjb25zdCBuID0gdC5tdXRhdGlvbnNbZV07XG4gICAgICAgIGlmIChlICsgMSA8IHQubXV0YXRpb25zLmxlbmd0aCAmJiB2b2lkIDAgIT09IHQubXV0YXRpb25zW2UgKyAxXS50cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0Lm11dGF0aW9uc1tlICsgMV07XG4gICAgICAgICAgICBuLnVwZGF0ZVRyYW5zZm9ybXMgPSByLnRyYW5zZm9ybS5maWVsZFRyYW5zZm9ybXMsIHQubXV0YXRpb25zLnNwbGljZShlICsgMSwgMSksIFxuICAgICAgICAgICAgKytlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHIgPSB0Lm11dGF0aW9ucy5tYXAoKHQgPT4gX19QUklWQVRFX2Zyb21NdXRhdGlvbihlLmN0LCB0KSkpLCBpID0gVGltZXN0YW1wLmZyb21NaWxsaXModC5sb2NhbFdyaXRlVGltZU1zKTtcbiAgICByZXR1cm4gbmV3IE11dGF0aW9uQmF0Y2godC5iYXRjaElkLCBpLCBuLCByKTtcbn1cblxuLyoqIERlY29kZXMgYSBEYlRhcmdldCBpbnRvIFRhcmdldERhdGEgKi8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYlRhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5yZWFkVGltZSksIG4gPSB2b2lkIDAgIT09IGUubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA/IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKTtcbiAgICBsZXQgcjtcbiAgICByZXR1cm4gciA9IFxuICAgIC8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIGZpZ3VyaW5nIG91dCB3aGF0IGtpbmQgb2YgcXVlcnkgaGFzIGJlZW4gc3RvcmVkLlxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzRG9jdW1lbnRRdWVyeShlKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUuZG9jdW1lbnRzO1xuICAgIH1cbiAgICAvKiogRW5jb2RlcyBhIERiQnVuZGxlIHRvIGEgQnVuZGxlTWV0YWRhdGEgb2JqZWN0LiAqLyAoZS5xdWVyeSkgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURvY3VtZW50c1RhcmdldChlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSBlLmRvY3VtZW50cy5sZW5ndGgpLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKF9fUFJJVkFURV9mcm9tUXVlcnlQYXRoKGUuZG9jdW1lbnRzWzBdKSkpO1xuICAgIH0oZS5xdWVyeSkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KF9fUFJJVkFURV9jb252ZXJ0UXVlcnlUYXJnZXRUb1F1ZXJ5KGUpKTtcbiAgICB9KGUucXVlcnkpLCBuZXcgVGFyZ2V0RGF0YShyLCBlLnRhcmdldElkLCBcIlRhcmdldFB1cnBvc2VMaXN0ZW5cIiAvKiBUYXJnZXRQdXJwb3NlLkxpc3RlbiAqLyAsIGUubGFzdExpc3RlblNlcXVlbmNlTnVtYmVyLCB0LCBuLCBCeXRlU3RyaW5nLmZyb21CYXNlNjRTdHJpbmcoZS5yZXN1bWVUb2tlbikpO1xufVxuXG4vKiogRW5jb2RlcyBUYXJnZXREYXRhIGludG8gYSBEYlRhcmdldCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYlRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKHQuc25hcHNob3RWZXJzaW9uKSwgciA9IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbik7XG4gICAgbGV0IGk7XG4gICAgaSA9IF9fUFJJVkFURV90YXJnZXRJc0RvY3VtZW50VGFyZ2V0KHQudGFyZ2V0KSA/IF9fUFJJVkFURV90b0RvY3VtZW50c1RhcmdldChlLmN0LCB0LnRhcmdldCkgOiBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLmN0LCB0LnRhcmdldCk7XG4gICAgLy8gV2UgY2FuJ3Qgc3RvcmUgdGhlIHJlc3VtZVRva2VuIGFzIGEgQnl0ZVN0cmluZyBpbiBJbmRleGVkRGIsIHNvIHdlXG4gICAgLy8gY29udmVydCBpdCB0byBhIGJhc2U2NCBzdHJpbmcgZm9yIHN0b3JhZ2UuXG4gICAgICAgIGNvbnN0IHMgPSB0LnJlc3VtZVRva2VuLnRvQmFzZTY0KCk7XG4gICAgLy8gbGFzdExpc3RlblNlcXVlbmNlTnVtYmVyIGlzIGFsd2F5cyAwIHVudGlsIHdlIGRvIHJlYWwgR0MuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldElkOiB0LnRhcmdldElkLFxuICAgICAgICBjYW5vbmljYWxJZDogX19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KHQudGFyZ2V0KSxcbiAgICAgICAgcmVhZFRpbWU6IG4sXG4gICAgICAgIHJlc3VtZVRva2VuOiBzLFxuICAgICAgICBsYXN0TGlzdGVuU2VxdWVuY2VOdW1iZXI6IHQuc2VxdWVuY2VOdW1iZXIsXG4gICAgICAgIGxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb246IHIsXG4gICAgICAgIHF1ZXJ5OiBpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgYEJ1bmRsZWRRdWVyeWAgZnJvbSBidW5kbGUgcHJvdG8gdG8gYSBRdWVyeSBvYmplY3QuXG4gKlxuICogVGhpcyByZWNvbnN0cnVjdHMgdGhlIG9yaWdpbmFsIHF1ZXJ5IHVzZWQgdG8gYnVpbGQgdGhlIGJ1bmRsZSBiZWluZyBsb2FkZWQsXG4gKiBpbmNsdWRpbmcgZmVhdHVyZXMgZXhpc3RzIG9ubHkgaW4gU0RLcyAoZm9yIGV4YW1wbGU6IGxpbWl0LXRvLWxhc3QpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jb252ZXJ0UXVlcnlUYXJnZXRUb1F1ZXJ5KHtcbiAgICAgICAgcGFyZW50OiBlLnBhcmVudCxcbiAgICAgICAgc3RydWN0dXJlZFF1ZXJ5OiBlLnN0cnVjdHVyZWRRdWVyeVxuICAgIH0pO1xuICAgIHJldHVybiBcIkxBU1RcIiA9PT0gZS5saW1pdFR5cGUgPyBfX1BSSVZBVEVfcXVlcnlXaXRoTGltaXQodCwgdC5saW1pdCwgXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8pIDogdDtcbn1cblxuLyoqIEVuY29kZXMgYSBOYW1lZFF1ZXJ5IHByb3RvIG9iamVjdCB0byBhIE5hbWVkUXVlcnkgbW9kZWwgb2JqZWN0LiAqL1xuLyoqIEVuY29kZXMgYSBEYkRvY3VtZW50T3ZlcmxheSBvYmplY3QgdG8gYW4gT3ZlcmxheSBtb2RlbCBvYmplY3QuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiRG9jdW1lbnRPdmVybGF5KGUsIHQpIHtcbiAgICByZXR1cm4gbmV3IE92ZXJsYXkodC5sYXJnZXN0QmF0Y2hJZCwgX19QUklWQVRFX2Zyb21NdXRhdGlvbihlLmN0LCB0Lm92ZXJsYXlNdXRhdGlvbikpO1xufVxuXG4vKiogRGVjb2RlcyBhbiBPdmVybGF5IG1vZGVsIG9iamVjdCBpbnRvIGEgRGJEb2N1bWVudE92ZXJsYXkgb2JqZWN0LiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBEYkRvY3VtZW50T3ZlcmxheUtleSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiB1c2VyIGFuZFxuICogZG9jdW1lbnQga2V5LlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheUtleShlLCB0KSB7XG4gICAgY29uc3QgbiA9IHQucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgIHJldHVybiBbIGUsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoLnBvcExhc3QoKSksIG4gXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJJbmRleFN0YXRlKGUsIHQsIG4sIHIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbmRleElkOiBlLFxuICAgICAgICB1aWQ6IHQudWlkIHx8IFwiXCIsXG4gICAgICAgIHNlcXVlbmNlTnVtYmVyOiBuLFxuICAgICAgICByZWFkVGltZTogX19QUklWQVRFX3RvRGJUaW1lc3RhbXAoci5yZWFkVGltZSksXG4gICAgICAgIGRvY3VtZW50S2V5OiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHIuZG9jdW1lbnRLZXkucGF0aCksXG4gICAgICAgIGxhcmdlc3RCYXRjaElkOiByLmxhcmdlc3RCYXRjaElkXG4gICAgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYkJ1bmRsZUNhY2hlIHtcbiAgICBnZXRCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfYnVuZGxlc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmIChlKSByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYkJ1bmRsZShlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGUuYnVuZGxlSWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5jcmVhdGVUaW1lKSxcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZS52ZXJzaW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKiBFbmNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgdG8gYSBEYkJ1bmRsZS4gKi8gKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfYnVuZGxlc1N0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkJ1bmRsZShlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGJ1bmRsZUlkOiBlLmlkLFxuICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNyZWF0ZVRpbWUpKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBlLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLyoqIEVuY29kZXMgYSBEYk5hbWVkUXVlcnkgdG8gYSBOYW1lZFF1ZXJ5LiAqLyAodCkpO1xuICAgIH1cbiAgICBnZXROYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uYW1lZFF1ZXJpZXNTdG9yZShlKS5nZXQodCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAoZSkgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJOYW1lZFF1ZXJ5KGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlLmJ1bmRsZWRRdWVyeSksXG4gICAgICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUucmVhZFRpbWUpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKiBFbmNvZGVzIGEgTmFtZWRRdWVyeSBmcm9tIGEgYnVuZGxlIHByb3RvIHRvIGEgRGJOYW1lZFF1ZXJ5LiAqLyAoZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2F2ZU5hbWVkUXVlcnkoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX25hbWVkUXVlcmllc1N0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYk5hbWVkUXVlcnkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnJlYWRUaW1lKSksXG4gICAgICAgICAgICAgICAgYnVuZGxlZFF1ZXJ5OiBlLmJ1bmRsZWRRdWVyeVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgYnVuZGxlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2J1bmRsZXNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcImJ1bmRsZXNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBuYW1lZFF1ZXJpZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uYW1lZFF1ZXJpZXNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcIm5hbWVkUXVlcmllc1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2YgRG9jdW1lbnRPdmVybGF5Q2FjaGUgdXNpbmcgSW5kZXhlZERiLlxuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJEb2N1bWVudE92ZXJsYXlDYWNoZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHNlcmlhbGl6ZXIgLSBUaGUgZG9jdW1lbnQgc2VyaWFsaXplci5cbiAgICAgKiBAcGFyYW0gdXNlcklkIC0gVGhlIHVzZXJJZCBmb3Igd2hpY2ggd2UgYXJlIGFjY2Vzc2luZyBvdmVybGF5cy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGUsIHRoaXMudXNlcklkID0gdDtcbiAgICB9XG4gICAgc3RhdGljIGx0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQudWlkIHx8IFwiXCI7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0luZGV4ZWREYkRvY3VtZW50T3ZlcmxheUNhY2hlKGUsIG4pO1xuICAgIH1cbiAgICBnZXRPdmVybGF5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE92ZXJsYXlTdG9yZShlKS5nZXQoX19QUklWQVRFX3RvRGJEb2N1bWVudE92ZXJsYXlLZXkodGhpcy51c2VySWQsIHQpKS5uZXh0KChlID0+IGUgPyBfX1BSSVZBVEVfZnJvbURiRG9jdW1lbnRPdmVybGF5KHRoaXMuc2VyaWFsaXplciwgZSkgOiBudWxsKSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB0aGlzLmdldE92ZXJsYXkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBudWxsICE9PSBlICYmIG4uc2V0KHQsIGUpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIHNhdmVPdmVybGF5cyhlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgT3ZlcmxheSh0LCBpKTtcbiAgICAgICAgICAgIHIucHVzaCh0aGlzLmh0KGUsIHMpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihyKTtcbiAgICB9XG4gICAgcmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IG5ldyBTZXQ7XG4gICAgICAgIC8vIEdldCB0aGUgc2V0IG9mIHVuaXF1ZSBjb2xsZWN0aW9uIHBhdGhzLlxuICAgICAgICAgICAgICAgIHQuZm9yRWFjaCgoZSA9PiByLmFkZChfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKGUuZ2V0Q29sbGVjdGlvblBhdGgoKSkpKSk7XG4gICAgICAgIGNvbnN0IGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIHIuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgdCwgbiBdLCBbIHRoaXMudXNlcklkLCB0LCBuICsgMSBdLCBcbiAgICAgICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgICAgIGkucHVzaChfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkuSihcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHIpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCksIGkgPSBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHQpLCBzID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgaSwgbiBdLCBbIHRoaXMudXNlcklkLCBpLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE92ZXJsYXlTdG9yZShlKS5HKFwiY29sbGVjdGlvblBhdGhPdmVybGF5SW5kZXhcIiwgcykubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZnJvbURiRG9jdW1lbnRPdmVybGF5KHRoaXMuc2VyaWFsaXplciwgdCk7XG4gICAgICAgICAgICAgICAgci5zZXQoZS5nZXRLZXkoKSwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb25Hcm91cChlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpO1xuICAgICAgICBsZXQgcztcbiAgICAgICAgLy8gV2Ugd2FudCBiYXRjaCBJRHMgbGFyZ2VyIHRoYW4gYHNpbmNlQmF0Y2hJZGAsIGFuZCBzbyB0aGUgbG93ZXIgYm91bmRcbiAgICAgICAgLy8gaXMgbm90IGluY2x1c2l2ZS5cbiAgICAgICAgICAgICAgICBjb25zdCBvID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgdCwgbiBdLCBbIHRoaXMudXNlcklkLCB0LCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE92ZXJsYXlTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImNvbGxlY3Rpb25Hcm91cE92ZXJsYXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IG9cbiAgICAgICAgfSwgKChlLCB0LCBuKSA9PiB7XG4gICAgICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCB0byByZXR1cm4gcGFydGlhbCBiYXRjaCBvdmVybGF5cywgZXZlbiBpZiB0aGUgc2l6ZVxuICAgICAgICAgICAgLy8gb2YgdGhlIHJlc3VsdCBzZXQgZXhjZWVkcyB0aGUgZ2l2ZW4gYGNvdW50YCBhcmd1bWVudC4gVGhlcmVmb3JlLCB3ZVxuICAgICAgICAgICAgLy8gY29udGludWUgdG8gYWdncmVnYXRlIHJlc3VsdHMgZXZlbiBhZnRlciB0aGUgcmVzdWx0IHNpemUgZXhjZWVkc1xuICAgICAgICAgICAgLy8gYGNvdW50YCBpZiB0aGVyZSBhcmUgbW9yZSBvdmVybGF5cyBmcm9tIHRoZSBgY3VycmVudEJhdGNoSWRgLlxuICAgICAgICAgICAgY29uc3QgbyA9IF9fUFJJVkFURV9mcm9tRGJEb2N1bWVudE92ZXJsYXkodGhpcy5zZXJpYWxpemVyLCB0KTtcbiAgICAgICAgICAgIGkuc2l6ZSgpIDwgciB8fCBvLmxhcmdlc3RCYXRjaElkID09PSBzID8gKGkuc2V0KG8uZ2V0S2V5KCksIG8pLCBzID0gby5sYXJnZXN0QmF0Y2hJZCkgOiBuLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgaHQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheShlLCB0LCBuKSB7XG4gICAgICAgICAgICBjb25zdCBbciwgaSwgc10gPSBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheUtleSh0LCBuLm11dGF0aW9uLmtleSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogdCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uUGF0aDogaSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudElkOiBzLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Hcm91cDogbi5tdXRhdGlvbi5rZXkuZ2V0Q29sbGVjdGlvbkdyb3VwKCksXG4gICAgICAgICAgICAgICAgbGFyZ2VzdEJhdGNoSWQ6IG4ubGFyZ2VzdEJhdGNoSWQsXG4gICAgICAgICAgICAgICAgb3ZlcmxheU11dGF0aW9uOiB0b011dGF0aW9uKGUuY3QsIG4ubXV0YXRpb24pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHRoaXMuc2VyaWFsaXplciwgdGhpcy51c2VySWQsIHQpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCBvdmVybGF5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJkb2N1bWVudE92ZXJsYXlzXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gTm90ZTogVGhpcyBjb2RlIGlzIGNvcGllZCBmcm9tIHRoZSBiYWNrZW5kLiBDb2RlIHRoYXQgaXMgbm90IHVzZWQgYnlcbi8vIEZpcmVzdG9yZSB3YXMgcmVtb3ZlZC5cbi8qKiBGaXJlc3RvcmUgaW5kZXggdmFsdWUgd3JpdGVyLiAgKi9cbmNsYXNzIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHt9XG4gICAgLy8gVGhlIHdyaXRlIG1ldGhvZHMgYmVsb3cgc2hvcnQtY2lyY3VpdCB3cml0aW5nIHRlcm1pbmF0b3JzIGZvciB2YWx1ZXNcbiAgICAvLyBjb250YWluaW5nIGEgKHRlcm1pbmF0aW5nKSB0cnVuY2F0ZWQgdmFsdWUuXG4gICAgLy8gQXMgYW4gZXhhbXBsZSwgY29uc2lkZXIgdGhlIHJlc3VsdGluZyBlbmNvZGluZyBmb3I6XG4gICAgLy8gW1wiYmFyXCIsIFsyLCBcImZvb1wiXV0gLT4gKFNUUklORywgXCJiYXJcIiwgVEVSTSwgQVJSQVksIE5VTUJFUiwgMiwgU1RSSU5HLCBcImZvb1wiLCBURVJNLCBURVJNLCBURVJNKVxuICAgIC8vIFtcImJhclwiLCBbMiwgdHJ1bmNhdGVkKFwiZm9vXCIpXV0gLT4gKFNUUklORywgXCJiYXJcIiwgVEVSTSwgQVJSQVksIE5VTUJFUiwgMiwgU1RSSU5HLCBcImZvb1wiLCBUUlVOQylcbiAgICAvLyBbXCJiYXJcIiwgdHJ1bmNhdGVkKFtcImZvb1wiXSldIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLiBTVFJJTkcsIFwiZm9vXCIsIFRFUk0sIFRSVU5DKVxuICAgIC8qKiBXcml0ZXMgYW4gaW5kZXggdmFsdWUuICAqL1xuICAgIFB0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5JdChlLCB0KSwgXG4gICAgICAgIC8vIFdyaXRlIHNlcGFyYXRvciB0byBzcGxpdCBpbmRleCB2YWx1ZXNcbiAgICAgICAgLy8gKHNlZSBnby9maXJlc3RvcmUtc3RvcmFnZS1mb3JtYXQjZW5jb2RpbmdzKS5cbiAgICAgICAgdC5UdCgpO1xuICAgIH1cbiAgICBJdChlLCB0KSB7XG4gICAgICAgIGlmIChcIm51bGxWYWx1ZVwiIGluIGUpIHRoaXMuRXQodCwgNSk7IGVsc2UgaWYgKFwiYm9vbGVhblZhbHVlXCIgaW4gZSkgdGhpcy5FdCh0LCAxMCksIFxuICAgICAgICB0LmR0KGUuYm9vbGVhblZhbHVlID8gMSA6IDApOyBlbHNlIGlmIChcImludGVnZXJWYWx1ZVwiIGluIGUpIHRoaXMuRXQodCwgMTUpLCB0LmR0KF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5pbnRlZ2VyVmFsdWUpKTsgZWxzZSBpZiAoXCJkb3VibGVWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgaXNOYU4obikgPyB0aGlzLkV0KHQsIDEzKSA6ICh0aGlzLkV0KHQsIDE1KSwgX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKG4pID8gXG4gICAgICAgICAgICAvLyAtMC4wLCAwIGFuZCAwLjAgYXJlIGFsbCBjb25zaWRlcmVkIHRoZSBzYW1lXG4gICAgICAgICAgICB0LmR0KDApIDogdC5kdChuKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLnRpbWVzdGFtcFZhbHVlO1xuICAgICAgICAgICAgdGhpcy5FdCh0LCAyMCksIFwic3RyaW5nXCIgPT0gdHlwZW9mIG4gPyB0LkF0KG4pIDogKHQuQXQoYCR7bi5zZWNvbmRzIHx8IFwiXCJ9YCksIHQuZHQobi5uYW5vcyB8fCAwKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJzdHJpbmdWYWx1ZVwiIGluIGUpIHRoaXMuUnQoZS5zdHJpbmdWYWx1ZSwgdCksIHRoaXMuVnQodCk7IGVsc2UgaWYgKFwiYnl0ZXNWYWx1ZVwiIGluIGUpIHRoaXMuRXQodCwgMzApLCBcbiAgICAgICAgdC5mdChfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpKSwgdGhpcy5WdCh0KTsgZWxzZSBpZiAoXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUpIHRoaXMuZ3QoZS5yZWZlcmVuY2VWYWx1ZSwgdCk7IGVsc2UgaWYgKFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmdlb1BvaW50VmFsdWU7XG4gICAgICAgICAgICB0aGlzLkV0KHQsIDQ1KSwgdC5kdChuLmxhdGl0dWRlIHx8IDApLCB0LmR0KG4ubG9uZ2l0dWRlIHx8IDApO1xuICAgICAgICB9IGVsc2UgXCJtYXBWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfaXNNYXhWYWx1ZShlKSA/IHRoaXMuRXQodCwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpIDogKHRoaXMueXQoZS5tYXBWYWx1ZSwgdCksIFxuICAgICAgICB0aGlzLlZ0KHQpKSA6IFwiYXJyYXlWYWx1ZVwiIGluIGUgPyAodGhpcy53dChlLmFycmF5VmFsdWUsIHQpLCB0aGlzLlZ0KHQpKSA6IGZhaWwoKTtcbiAgICB9XG4gICAgUnQoZSwgdCkge1xuICAgICAgICB0aGlzLkV0KHQsIDI1KSwgdGhpcy5TdChlLCB0KTtcbiAgICB9XG4gICAgU3QoZSwgdCkge1xuICAgICAgICB0LkF0KGUpO1xuICAgIH1cbiAgICB5dChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLmZpZWxkcyB8fCB7fTtcbiAgICAgICAgdGhpcy5FdCh0LCA1NSk7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBPYmplY3Qua2V5cyhuKSkgdGhpcy5SdChlLCB0KSwgdGhpcy5JdChuW2VdLCB0KTtcbiAgICB9XG4gICAgd3QoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gZS52YWx1ZXMgfHwgW107XG4gICAgICAgIHRoaXMuRXQodCwgNTApO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgdGhpcy5JdChlLCB0KTtcbiAgICB9XG4gICAgZ3QoZSwgdCkge1xuICAgICAgICB0aGlzLkV0KHQsIDM3KTtcbiAgICAgICAgRG9jdW1lbnRLZXkuZnJvbU5hbWUoZSkucGF0aC5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuRXQodCwgNjApLCB0aGlzLlN0KGUsIHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIEV0KGUsIHQpIHtcbiAgICAgICAgZS5kdCh0KTtcbiAgICB9XG4gICAgVnQoZSkge1xuICAgICAgICAvLyBXaGlsZSB0aGUgU0RLIGRvZXMgbm90IGltcGxlbWVudCB0cnVuY2F0aW9uLCB0aGUgdHJ1bmNhdGlvbiBtYXJrZXIgaXNcbiAgICAgICAgLy8gdXNlZCB0byB0ZXJtaW5hdGUgYWxsIHZhcmlhYmxlIGxlbmd0aCB2YWx1ZXMgKHdoaWNoIGFyZSBzdHJpbmdzLCBieXRlcyxcbiAgICAgICAgLy8gcmVmZXJlbmNlcywgYXJyYXlzIGFuZCBtYXBzKS5cbiAgICAgICAgZS5kdCgyKTtcbiAgICB9XG59XG5cbl9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLmJ0ID0gbmV3IF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyO1xuXG4vKipcbiAqIENvdW50cyB0aGUgbnVtYmVyIG9mIHplcm9zIGluIGEgYnl0ZS5cbiAqXG4gKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbnVtYmVyT2ZMZWFkaW5nWmVyb3NJbkJ5dGUoZSkge1xuICAgIGlmICgwID09PSBlKSByZXR1cm4gODtcbiAgICBsZXQgdCA9IDA7XG4gICAgcmV0dXJuIGUgPj4gNCA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSBmaXJzdCBmb3VyIGJpdHMgYXJlIHplcm8uXG4gICAgdCArPSA0LCBlIDw8PSA0KSwgZSA+PiA2ID09IDAgJiYgKFxuICAgIC8vIFRlc3QgaWYgdGhlIGZpcnN0IHR3byAob3IgbmV4dCB0d28pIGJpdHMgYXJlIHplcm8uXG4gICAgdCArPSAyLCBlIDw8PSAyKSwgZSA+PiA3ID09IDAgJiYgKFxuICAgIC8vIFRlc3QgaWYgdGhlIHJlbWFpbmluZyBiaXQgaXMgemVyby5cbiAgICB0ICs9IDEpLCB0O1xufVxuXG4vKiogQ291bnRzIHRoZSBudW1iZXIgb2YgbGVhZGluZyB6ZXJvcyBpbiB0aGUgZ2l2ZW4gYnl0ZSBhcnJheS4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHJlcXVpcmVkIHRvIHN0b3JlIFwidmFsdWVcIi4gTGVhZGluZyB6ZXJvIGJ5dGVzXG4gKiBhcmUgc2tpcHBlZC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3Vuc2lnbmVkTnVtTGVuZ3RoKGUpIHtcbiAgICAvLyBUaGlzIGlzIGp1c3QgdGhlIG51bWJlciBvZiBieXRlcyBmb3IgdGhlIHVuc2lnbmVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBudW1iZXIuXG4gICAgY29uc3QgdCA9IDY0IC0gZnVuY3Rpb24gX19QUklWQVRFX251bWJlck9mTGVhZGluZ1plcm9zKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IDg7ICsrbikge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9udW1iZXJPZkxlYWRpbmdaZXJvc0luQnl0ZSgyNTUgJiBlW25dKTtcbiAgICAgICAgICAgIGlmICh0ICs9IHIsIDggIT09IHIpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgIH0oZSk7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0IC8gOCk7XG59XG5cbi8qKlxuICogT3JkZXJlZENvZGVXcml0ZXIgaXMgYSBtaW5pbWFsLWFsbG9jYXRpb24gaW1wbGVtZW50YXRpb24gb2YgdGhlIHdyaXRpbmdcbiAqIGJlaGF2aW9yIGRlZmluZWQgYnkgdGhlIGJhY2tlbmQuXG4gKlxuICogVGhlIGNvZGUgaXMgcG9ydGVkIGZyb20gaXRzIEphdmEgY291bnRlcnBhcnQuXG4gKi8gY2xhc3MgX19QUklWQVRFX09yZGVyZWRDb2RlV3JpdGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxMDI0KSwgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIER0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGVbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICBsZXQgbiA9IHQubmV4dCgpO1xuICAgICAgICBmb3IgKDshbi5kb25lOyApIHRoaXMudnQobi52YWx1ZSksIG4gPSB0Lm5leHQoKTtcbiAgICAgICAgdGhpcy5DdCgpO1xuICAgIH1cbiAgICBGdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgbGV0IG4gPSB0Lm5leHQoKTtcbiAgICAgICAgZm9yICg7IW4uZG9uZTsgKSB0aGlzLk10KG4udmFsdWUpLCBuID0gdC5uZXh0KCk7XG4gICAgICAgIHRoaXMueHQoKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyB1dGY4IGJ5dGVzIGludG8gdGhpcyBieXRlIHNlcXVlbmNlLCBhc2NlbmRpbmcuICovICAgIE90KGUpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBpZiAoZSA8IDEyOCkgdGhpcy52dChlKTsgZWxzZSBpZiAoZSA8IDIwNDgpIHRoaXMudnQoOTYwIHwgZSA+Pj4gNiksIHRoaXMudnQoMTI4IHwgNjMgJiBlKTsgZWxzZSBpZiAodCA8IFwiXFx1ZDgwMFwiIHx8IFwiXFx1ZGJmZlwiIDwgdCkgdGhpcy52dCg0ODAgfCBlID4+PiAxMiksIFxuICAgICAgICAgICAgdGhpcy52dCgxMjggfCA2MyAmIGUgPj4+IDYpLCB0aGlzLnZ0KDEyOCB8IDYzICYgZSk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNvZGVQb2ludEF0KDApO1xuICAgICAgICAgICAgICAgIHRoaXMudnQoMjQwIHwgZSA+Pj4gMTgpLCB0aGlzLnZ0KDEyOCB8IDYzICYgZSA+Pj4gMTIpLCB0aGlzLnZ0KDEyOCB8IDYzICYgZSA+Pj4gNiksIFxuICAgICAgICAgICAgICAgIHRoaXMudnQoMTI4IHwgNjMgJiBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLkN0KCk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgdXRmOCBieXRlcyBpbnRvIHRoaXMgYnl0ZSBzZXF1ZW5jZSwgZGVzY2VuZGluZyAqLyAgICBOdChlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKGUgPCAxMjgpIHRoaXMuTXQoZSk7IGVsc2UgaWYgKGUgPCAyMDQ4KSB0aGlzLk10KDk2MCB8IGUgPj4+IDYpLCB0aGlzLk10KDEyOCB8IDYzICYgZSk7IGVsc2UgaWYgKHQgPCBcIlxcdWQ4MDBcIiB8fCBcIlxcdWRiZmZcIiA8IHQpIHRoaXMuTXQoNDgwIHwgZSA+Pj4gMTIpLCBcbiAgICAgICAgICAgIHRoaXMuTXQoMTI4IHwgNjMgJiBlID4+PiA2KSwgdGhpcy5NdCgxMjggfCA2MyAmIGUpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdC5jb2RlUG9pbnRBdCgwKTtcbiAgICAgICAgICAgICAgICB0aGlzLk10KDI0MCB8IGUgPj4+IDE4KSwgdGhpcy5NdCgxMjggfCA2MyAmIGUgPj4+IDEyKSwgdGhpcy5NdCgxMjggfCA2MyAmIGUgPj4+IDYpLCBcbiAgICAgICAgICAgICAgICB0aGlzLk10KDEyOCB8IDYzICYgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy54dCgpO1xuICAgIH1cbiAgICBCdChlKSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGFjdHVhbCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5MdChlKSwgbiA9IF9fUFJJVkFURV91bnNpZ25lZE51bUxlbmd0aCh0KTtcbiAgICAgICAgdGhpcy5rdCgxICsgbiksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSAyNTUgJiBuO1xuICAgICAgICAvLyBXcml0ZSB0aGUgbGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGUgPSB0Lmxlbmd0aCAtIG47IGUgPCB0Lmxlbmd0aDsgKytlKSB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gMjU1ICYgdFtlXTtcbiAgICB9XG4gICAgcXQoZSkge1xuICAgICAgICAvLyBWYWx1ZXMgYXJlIGVuY29kZWQgd2l0aCBhIHNpbmdsZSBieXRlIGxlbmd0aCBwcmVmaXgsIGZvbGxvd2VkIGJ5IHRoZVxuICAgICAgICAvLyBpbnZlcnRlZCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5MdChlKSwgbiA9IF9fUFJJVkFURV91bnNpZ25lZE51bUxlbmd0aCh0KTtcbiAgICAgICAgdGhpcy5rdCgxICsgbiksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB+KDI1NSAmIG4pO1xuICAgICAgICAvLyBXcml0ZSB0aGUgbGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGUgPSB0Lmxlbmd0aCAtIG47IGUgPCB0Lmxlbmd0aDsgKytlKSB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gfigyNTUgJiB0W2VdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGVzIHRoZSBcImluZmluaXR5XCIgYnl0ZSBzZXF1ZW5jZSB0aGF0IHNvcnRzIGFmdGVyIGFsbCBvdGhlciBieXRlXG4gICAgICogc2VxdWVuY2VzIHdyaXR0ZW4gaW4gYXNjZW5kaW5nIG9yZGVyLlxuICAgICAqLyAgICBRdCgpIHtcbiAgICAgICAgdGhpcy5LdCgyNTUpLCB0aGlzLkt0KDI1NSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIG90aGVyIGJ5dGVcbiAgICAgKiBzZXF1ZW5jZXMgd3JpdHRlbiBpbiBkZXNjZW5kaW5nIG9yZGVyLlxuICAgICAqLyAgICAkdCgpIHtcbiAgICAgICAgdGhpcy5VdCgyNTUpLCB0aGlzLlV0KDI1NSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgYnVmZmVyIHN1Y2ggdGhhdCBpdCBpcyB0aGUgc2FtZSBhcyB3aGVuIGl0IHdhcyBuZXdseVxuICAgICAqIGNvbnN0cnVjdGVkLlxuICAgICAqLyAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIHNlZWQoZSkge1xuICAgICAgICB0aGlzLmt0KGUubGVuZ3RoKSwgdGhpcy5idWZmZXIuc2V0KGUsIHRoaXMucG9zaXRpb24pLCB0aGlzLnBvc2l0aW9uICs9IGUubGVuZ3RoO1xuICAgIH1cbiAgICAvKiogTWFrZXMgYSBjb3B5IG9mIHRoZSBlbmNvZGVkIGJ5dGVzIGluIHRoaXMgYnVmZmVyLiAgKi8gICAgV3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5zbGljZSgwLCB0aGlzLnBvc2l0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5jb2RlcyBgdmFsYCBpbnRvIGFuIGVuY29kaW5nIHNvIHRoYXQgdGhlIG9yZGVyIG1hdGNoZXMgdGhlIElFRUUgNzU0XG4gICAgICogZmxvYXRpbmctcG9pbnQgY29tcGFyaXNvbiByZXN1bHRzIHdpdGggdGhlIGZvbGxvd2luZyBleGNlcHRpb25zOlxuICAgICAqICAgLTAuMCA8IDAuMFxuICAgICAqICAgYWxsIG5vbi1OYU4gPCBOYU5cbiAgICAgKiAgIE5hTiA9IE5hTlxuICAgICAqLyAgICBMdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgLyoqIENvbnZlcnRzIGEgSmF2YVNjcmlwdCBudW1iZXIgdG8gYSBieXRlIGFycmF5ICh1c2luZyBiaWcgZW5kaWFuIGVuY29kaW5nKS4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2RvdWJsZVRvTG9uZ0JpdHMoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoOCkpO1xuICAgICAgICAgICAgcmV0dXJuIHQuc2V0RmxvYXQ2NCgwLCBlLCAvKiBsaXR0bGVFbmRpYW49ICovICExKSwgbmV3IFVpbnQ4QXJyYXkodC5idWZmZXIpO1xuICAgICAgICB9KGUpLCBuID0gMCAhPSAoMTI4ICYgdFswXSk7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBmaXJzdCBiaXQgaXMgc2V0LiBXZSB1c2UgYSBiaXQgbWFzayBzaW5jZSB2YWx1ZVswXSBpc1xuICAgICAgICAvLyBlbmNvZGVkIGFzIGEgbnVtYmVyIGZyb20gMCB0byAyNTUuXG4gICAgICAgICAgICAgICAgLy8gUmV2ZXJ0IHRoZSB0d28gY29tcGxlbWVudCB0byBnZXQgbmF0dXJhbCBvcmRlcmluZ1xuICAgICAgICB0WzBdIF49IG4gPyAyNTUgOiAxMjg7XG4gICAgICAgIGZvciAobGV0IGUgPSAxOyBlIDwgdC5sZW5ndGg7ICsrZSkgdFtlXSBePSBuID8gMjU1IDogMDtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgYSBzaW5nbGUgYnl0ZSBhc2NlbmRpbmcgdG8gdGhlIGJ1ZmZlci4gKi8gICAgdnQoZSkge1xuICAgICAgICBjb25zdCB0ID0gMjU1ICYgZTtcbiAgICAgICAgMCA9PT0gdCA/ICh0aGlzLkt0KDApLCB0aGlzLkt0KDI1NSkpIDogMjU1ID09PSB0ID8gKHRoaXMuS3QoMjU1KSwgdGhpcy5LdCgwKSkgOiB0aGlzLkt0KHQpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGEgc2luZ2xlIGJ5dGUgZGVzY2VuZGluZyB0byB0aGUgYnVmZmVyLiAgKi8gICAgTXQoZSkge1xuICAgICAgICBjb25zdCB0ID0gMjU1ICYgZTtcbiAgICAgICAgMCA9PT0gdCA/ICh0aGlzLlV0KDApLCB0aGlzLlV0KDI1NSkpIDogMjU1ID09PSB0ID8gKHRoaXMuVXQoMjU1KSwgdGhpcy5VdCgwKSkgOiB0aGlzLlV0KGUpO1xuICAgIH1cbiAgICBDdCgpIHtcbiAgICAgICAgdGhpcy5LdCgwKSwgdGhpcy5LdCgxKTtcbiAgICB9XG4gICAgeHQoKSB7XG4gICAgICAgIHRoaXMuVXQoMCksIHRoaXMuVXQoMSk7XG4gICAgfVxuICAgIEt0KGUpIHtcbiAgICAgICAgdGhpcy5rdCgxKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IGU7XG4gICAgfVxuICAgIFV0KGUpIHtcbiAgICAgICAgdGhpcy5rdCgxKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IH5lO1xuICAgIH1cbiAgICBrdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlICsgdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgaWYgKHQgPD0gdGhpcy5idWZmZXIubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIC8vIFRyeSBkb3VibGluZy5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IDIgKiB0aGlzLmJ1ZmZlci5sZW5ndGg7XG4gICAgICAgIC8vIFN0aWxsIG5vdCBiaWcgZW5vdWdoPyBKdXN0IGFsbG9jYXRlIHRoZSByaWdodCBzaXplLlxuICAgICAgICAgICAgICAgIG4gPCB0ICYmIChuID0gdCk7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3IGJ1ZmZlci5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFVpbnQ4QXJyYXkobik7XG4gICAgICAgIHIuc2V0KHRoaXMuYnVmZmVyKSwgLy8gY29weSBvbGQgZGF0YVxuICAgICAgICB0aGlzLmJ1ZmZlciA9IHI7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfQXNjZW5kaW5nSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLkd0ID0gZTtcbiAgICB9XG4gICAgZnQoZSkge1xuICAgICAgICB0aGlzLkd0LkR0KGUpO1xuICAgIH1cbiAgICBBdChlKSB7XG4gICAgICAgIHRoaXMuR3QuT3QoZSk7XG4gICAgfVxuICAgIGR0KGUpIHtcbiAgICAgICAgdGhpcy5HdC5CdChlKTtcbiAgICB9XG4gICAgVHQoKSB7XG4gICAgICAgIHRoaXMuR3QuUXQoKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9EZXNjZW5kaW5nSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLkd0ID0gZTtcbiAgICB9XG4gICAgZnQoZSkge1xuICAgICAgICB0aGlzLkd0LkZ0KGUpO1xuICAgIH1cbiAgICBBdChlKSB7XG4gICAgICAgIHRoaXMuR3QuTnQoZSk7XG4gICAgfVxuICAgIGR0KGUpIHtcbiAgICAgICAgdGhpcy5HdC5xdChlKTtcbiAgICB9XG4gICAgVHQoKSB7XG4gICAgICAgIHRoaXMuR3QuJHQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyBgRGlyZWN0aW9uYWxJbmRleEJ5dGVFbmNvZGVyYCB1c2luZyBgT3JkZXJlZENvZGVXcml0ZXJgIGZvciB0aGVcbiAqIGFjdHVhbCBlbmNvZGluZy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuR3QgPSBuZXcgX19QUklWQVRFX09yZGVyZWRDb2RlV3JpdGVyLCB0aGlzLnp0ID0gbmV3IF9fUFJJVkFURV9Bc2NlbmRpbmdJbmRleEJ5dGVFbmNvZGVyKHRoaXMuR3QpLCBcbiAgICAgICAgdGhpcy5qdCA9IG5ldyBfX1BSSVZBVEVfRGVzY2VuZGluZ0luZGV4Qnl0ZUVuY29kZXIodGhpcy5HdCk7XG4gICAgfVxuICAgIHNlZWQoZSkge1xuICAgICAgICB0aGlzLkd0LnNlZWQoZSk7XG4gICAgfVxuICAgIEh0KGUpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gZSA/IHRoaXMuenQgOiB0aGlzLmp0O1xuICAgIH1cbiAgICBXdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuR3QuV3QoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuR3QucmVzZXQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUmVwcmVzZW50cyBhbiBpbmRleCBlbnRyeSBzYXZlZCBieSB0aGUgU0RLIGluIHBlcnNpc3RlZCBzdG9yYWdlLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhFbnRyeSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmluZGV4SWQgPSBlLCB0aGlzLmRvY3VtZW50S2V5ID0gdCwgdGhpcy5hcnJheVZhbHVlID0gbiwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlID0gcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBJbmRleEVudHJ5IGVudHJ5IHRoYXQgc29ydHMgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGN1cnJlbnRcbiAgICAgKiBkaXJlY3Rpb25hbCB2YWx1ZS5cbiAgICAgKi8gICAgSnQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRpcmVjdGlvbmFsVmFsdWUubGVuZ3RoLCB0ID0gMCA9PT0gZSB8fCAyNTUgPT09IHRoaXMuZGlyZWN0aW9uYWxWYWx1ZVtlIC0gMV0gPyBlICsgMSA6IGUsIG4gPSBuZXcgVWludDhBcnJheSh0KTtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHRoaXMuZGlyZWN0aW9uYWxWYWx1ZSwgMCksIHQgIT09IGUgPyBuLnNldChbIDAgXSwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlLmxlbmd0aCkgOiArK25bbi5sZW5ndGggLSAxXSwgXG4gICAgICAgIG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeSh0aGlzLmluZGV4SWQsIHRoaXMuZG9jdW1lbnRLZXksIHRoaXMuYXJyYXlWYWx1ZSwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgdCkge1xuICAgIGxldCBuID0gZS5pbmRleElkIC0gdC5pbmRleElkO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IChuID0gX19QUklWQVRFX2NvbXBhcmVCeXRlQXJyYXlzKGUuYXJyYXlWYWx1ZSwgdC5hcnJheVZhbHVlKSwgXG4gICAgMCAhPT0gbiA/IG4gOiAobiA9IF9fUFJJVkFURV9jb21wYXJlQnl0ZUFycmF5cyhlLmRpcmVjdGlvbmFsVmFsdWUsIHQuZGlyZWN0aW9uYWxWYWx1ZSksIFxuICAgIDAgIT09IG4gPyBuIDogRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmRvY3VtZW50S2V5LCB0LmRvY3VtZW50S2V5KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUJ5dGVBcnJheXMoZSwgdCkge1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGggJiYgbiA8IHQubGVuZ3RoOyArK24pIHtcbiAgICAgICAgY29uc3QgciA9IGVbbl0gLSB0W25dO1xuICAgICAgICBpZiAoMCAhPT0gcikgcmV0dXJuIHI7XG4gICAgfVxuICAgIHJldHVybiBlLmxlbmd0aCAtIHQubGVuZ3RoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGxpZ2h0IHF1ZXJ5IHBsYW5uZXIgZm9yIEZpcmVzdG9yZS5cbiAqXG4gKiBUaGlzIGNsYXNzIG1hdGNoZXMgYSBgRmllbGRJbmRleGAgYWdhaW5zdCBhIEZpcmVzdG9yZSBRdWVyeSBgVGFyZ2V0YC4gSXRcbiAqIGRldGVybWluZXMgd2hldGhlciBhIGdpdmVuIGluZGV4IGNhbiBiZSB1c2VkIHRvIHNlcnZlIHRoZSBzcGVjaWZpZWQgdGFyZ2V0LlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgdGFibGUgc2hvd2Nhc2VzIHNvbWUgcG9zc2libGUgaW5kZXggY29uZmlndXJhdGlvbnM6XG4gKlxuICogUXVlcnkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgSW5kZXhcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiB3aGVyZSgnYScsICc9PScsICdhJykud2hlcmUoJ2InLCAnPT0nLCAnYicpICAgICAgICAgfCBhIEFTQywgYiBERVNDXG4gKiB3aGVyZSgnYScsICc9PScsICdhJykud2hlcmUoJ2InLCAnPT0nLCAnYicpICAgICAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYiBERVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpICAgICAgICAgICAgICAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnLCAnZGVzYycpICAgICAgICAgIHwgYSBERVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpLm9yZGVyQnkoJ2InKSAgICAgfCBhIEFTQywgYiBBU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJykub3JkZXJCeSgnYicpICAgICB8IGEgQVNDXG4gKiB3aGVyZSgnYScsICdhcnJheS1jb250YWlucycsICdhJykub3JkZXJCeSgnYicpICAgICAgfCBhIENPTlRBSU5TLCBiIEFTQ0VORElOR1xuICogd2hlcmUoJ2EnLCAnYXJyYXktY29udGFpbnMnLCAnYScpLm9yZGVyQnkoJ2InKSAgICAgIHwgYSBDT05UQUlOU1xuICovIGNsYXNzIF9fUFJJVkFURV9UYXJnZXRJbmRleE1hdGNoZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uSWQgPSBudWxsICE9IGUuY29sbGVjdGlvbkdyb3VwID8gZS5jb2xsZWN0aW9uR3JvdXAgOiBlLnBhdGgubGFzdFNlZ21lbnQoKSwgXG4gICAgICAgIHRoaXMuWXQgPSBlLm9yZGVyQnksIHRoaXMuWnQgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZmlsdGVycykge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQ7XG4gICAgICAgICAgICBlLmlzSW5lcXVhbGl0eSgpID8gdGhpcy5YdCA9IGUgOiB0aGlzLlp0LnB1c2goZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBpbmRleCBjYW4gYmUgdXNlZCB0byBzZXJ2ZSB0aGUgVGFyZ2V0SW5kZXhNYXRjaGVyJ3NcbiAgICAgKiB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBBbiBpbmRleCBpcyBjb25zaWRlcmVkIGNhcGFibGUgb2Ygc2VydmluZyB0aGUgdGFyZ2V0IHdoZW46XG4gICAgICogLSBUaGUgdGFyZ2V0IHVzZXMgYWxsIGluZGV4IHNlZ21lbnRzIGZvciBpdHMgZmlsdGVycyBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAqICAgVGhlIHRhcmdldCBjYW4gaGF2ZSBhZGRpdGlvbmFsIGZpbHRlciBhbmQgb3JkZXJCeSBjbGF1c2VzLCBidXQgbm90XG4gICAgICogICBmZXdlci5cbiAgICAgKiAtIElmIGFuIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueWZpbHRlciBpcyB1c2VkLCB0aGUgaW5kZXggbXVzdCBhbHNvXG4gICAgICogICBoYXZlIGEgY29ycmVzcG9uZGluZyBgQ09OVEFJTlNgIHNlZ21lbnQuXG4gICAgICogLSBBbGwgZGlyZWN0aW9uYWwgaW5kZXggc2VnbWVudHMgY2FuIGJlIG1hcHBlZCB0byB0aGUgdGFyZ2V0IGFzIGEgc2VyaWVzIG9mXG4gICAgICogICBlcXVhbGl0eSBmaWx0ZXJzLCBhIHNpbmdsZSBpbmVxdWFsaXR5IGZpbHRlciBhbmQgYSBzZXJpZXMgb2Ygb3JkZXJCeVxuICAgICAqICAgY2xhdXNlcy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGUgZXF1YWxpdHkgZmlsdGVycyBtYXkgYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgKiAtIFRoZSBvcHRpb25hbCBzZWdtZW50IGZvciB0aGUgaW5lcXVhbGl0eSBmaWx0ZXIgbXVzdCBhcHBlYXIgYWZ0ZXIgYWxsXG4gICAgICogICBlcXVhbGl0eSBzZWdtZW50cy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGF0IG9yZGVyQnkgY2xhdXNlIG9mIHRoZSB0YXJnZXQgbXVzdCBhcHBlYXJcbiAgICAgKiAgIGluIG9yZGVyIGFmdGVyIGFsbCBlcXVhbGl0eSBhbmQgaW5lcXVhbGl0eSBzZWdtZW50cy4gU2luZ2xlIG9yZGVyQnlcbiAgICAgKiAgIGNsYXVzZXMgY2Fubm90IGJlIHNraXBwZWQsIGJ1dCBhIGNvbnRpbnVvdXMgb3JkZXJCeSBzdWZmaXggbWF5IGJlXG4gICAgICogICBvbWl0dGVkLlxuICAgICAqLyAgICBlbihlKSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUuY29sbGVjdGlvbkdyb3VwID09PSB0aGlzLmNvbGxlY3Rpb25JZCk7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGFycmF5IGVsZW1lbnQsIGZpbmQgYSBtYXRjaGluZyBmaWx0ZXIuXG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZmllbGRJbmRleEdldEFycmF5U2VnbWVudChlKTtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCAmJiAhdGhpcy50bih0KSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpO1xuICAgICAgICBsZXQgciA9IG5ldyBTZXQsIGkgPSAwLCBzID0gMDtcbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgZXF1YWxpdGllcyBmaXJzdC4gRXF1YWxpdGllcyBjYW4gYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgICAgZm9yICg7aSA8IG4ubGVuZ3RoICYmIHRoaXMudG4obltpXSk7ICsraSkgciA9IHIuYWRkKG5baV0uZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpKTtcbiAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHByb2Nlc3NlZCBhbGwgc2VnbWVudHMsIGFsbCBzZWdtZW50cyBhcmUgdXNlZCB0byBzZXJ2ZVxuICAgICAgICAvLyB0aGUgZXF1YWxpdHkgZmlsdGVycyBhbmQgd2UgZG8gbm90IG5lZWQgdG8gbWFwIGFueSBzZWdtZW50cyB0byB0aGVcbiAgICAgICAgLy8gdGFyZ2V0J3MgaW5lcXVhbGl0eSBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAgICAgICAgICAgIGlmIChpID09PSBuLmxlbmd0aCkgcmV0dXJuICEwO1xuICAgICAgICBpZiAodm9pZCAwICE9PSB0aGlzLlh0KSB7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpbmVxdWFsaXR5IGZpbHRlciBhbmQgdGhlIGZpZWxkIHdhcyBub3QgaW4gb25lIG9mIHRoZVxuICAgICAgICAgICAgLy8gZXF1YWxpdHkgZmlsdGVycyBhYm92ZSwgdGhlIG5leHQgc2VnbWVudCBtdXN0IG1hdGNoIGJvdGggdGhlIGZpbHRlclxuICAgICAgICAgICAgLy8gYW5kIHRoZSBmaXJzdCBvcmRlckJ5IGNsYXVzZS5cbiAgICAgICAgICAgIGlmICghci5oYXModGhpcy5YdC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbltpXTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubm4odGhpcy5YdCwgZSkgfHwgIXRoaXMucm4odGhpcy5ZdFtzKytdLCBlKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKytpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsbCByZW1haW5pbmcgc2VnbWVudHMgbmVlZCB0byByZXByZXNlbnQgdGhlIHByZWZpeCBvZiB0aGUgdGFyZ2V0J3NcbiAgICAgICAgLy8gb3JkZXJCeS5cbiAgICAgICAgICAgICAgICBmb3IgKDtpIDwgbi5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5baV07XG4gICAgICAgICAgICBpZiAocyA+PSB0aGlzLll0Lmxlbmd0aCB8fCAhdGhpcy5ybih0aGlzLll0W3MrK10sIGUpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICB0bihlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLlp0KSBpZiAodGhpcy5ubih0LCBlKSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIG5uKGUsIHQpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSB8fCAhZS5maWVsZC5pc0VxdWFsKHQuZmllbGRQYXRoKSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovID09PSBlLm9wIHx8IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSBlLm9wO1xuICAgICAgICByZXR1cm4gMiAvKiBJbmRleEtpbmQuQ09OVEFJTlMgKi8gPT09IHQua2luZCA9PT0gbjtcbiAgICB9XG4gICAgcm4oZSwgdCkge1xuICAgICAgICByZXR1cm4gISFlLmZpZWxkLmlzRXF1YWwodC5maWVsZFBhdGgpICYmICgwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gPT09IHQua2luZCAmJiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gPT09IGUuZGlyIHx8IDEgLyogSW5kZXhLaW5kLkRFU0NFTkRJTkcgKi8gPT09IHQua2luZCAmJiBcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLyA9PT0gZS5kaXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCBoZWxwIHdpdGggYm9vbGVhbiBsb2dpYyB0cmFuc2Zvcm1hdGlvbnMgbmVlZGVkIGZvciBoYW5kbGluZ1xuICogY29tcGxleCBmaWx0ZXJzIHVzZWQgaW4gcXVlcmllcy5cbiAqL1xuLyoqXG4gKiBUaGUgYGluYCBmaWx0ZXIgaXMgb25seSBhIHN5bnRhY3RpYyBzdWdhciBvdmVyIGEgZGlzanVuY3Rpb24gb2YgZXF1YWxpdGllcy4gRm9yIGluc3RhbmNlOiBgYSBpblxuICogWzEsMiwzXWAgaXMgaW4gZmFjdCBgYT09MSB8fCBhPT0yIHx8IGE9PTNgLiBUaGlzIG1ldGhvZCBleHBhbmRzIGFueSBgaW5gIGZpbHRlciBpbiB0aGUgZ2l2ZW5cbiAqIGlucHV0IGludG8gYSBkaXNqdW5jdGlvbiBvZiBlcXVhbGl0eSBmaWx0ZXJzIGFuZCByZXR1cm5zIHRoZSBleHBhbmRlZCBmaWx0ZXIuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXB1dGVJbkV4cGFuc2lvbihlKSB7XG4gICAgdmFyIHQsIG47XG4gICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgX19QUklWQVRFX0luRmlsdGVyKSB7XG4gICAgICAgICAgICBjb25zdCByID0gKG51bGwgPT09IChuID0gbnVsbCA9PT0gKHQgPSBlLnZhbHVlLmFycmF5VmFsdWUpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQudmFsdWVzKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLm1hcCgodCA9PiBGaWVsZEZpbHRlci5jcmVhdGUoZS5maWVsZCwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwgdCkpKSkgfHwgW107XG4gICAgICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShyLCBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGhhdmUgcmVhY2hlZCBvdGhlciBraW5kcyBvZiBmaWVsZCBmaWx0ZXJzLlxuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgLy8gV2UgaGF2ZSBhIGNvbXBvc2l0ZSBmaWx0ZXIuXG4gICAgICAgIGNvbnN0IHIgPSBlLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9jb21wdXRlSW5FeHBhbnNpb24oZSkpKTtcbiAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShyLCBlLm9wKTtcbn1cblxuLyoqXG4gKiBHaXZlbiBhIGNvbXBvc2l0ZSBmaWx0ZXIsIHJldHVybnMgdGhlIGxpc3Qgb2YgdGVybXMgaW4gaXRzIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtLlxuICpcbiAqIDxwPkVhY2ggZWxlbWVudCBpbiB0aGUgcmV0dXJuIHZhbHVlIGlzIG9uZSB0ZXJtIG9mIHRoZSByZXN1bHRpbmcgRE5GLiBGb3IgaW5zdGFuY2U6IEZvciB0aGVcbiAqIGlucHV0OiAoQSB8fCBCKSAmJiBDLCB0aGUgRE5GIGZvcm0gaXM6IChBICYmIEMpIHx8IChCICYmIEMpLCBhbmQgdGhlIHJldHVybiB2YWx1ZSBpcyBhIGxpc3RcbiAqIHdpdGggdHdvIGVsZW1lbnRzOiBhIGNvbXBvc2l0ZSBmaWx0ZXIgdGhhdCBwZXJmb3JtcyAoQSAmJiBDKSwgYW5kIGEgY29tcG9zaXRlIGZpbHRlciB0aGF0XG4gKiBwZXJmb3JtcyAoQiAmJiBDKS5cbiAqXG4gKiBAcGFyYW0gZmlsdGVyIHRoZSBjb21wb3NpdGUgZmlsdGVyIHRvIGNhbGN1bGF0ZSBETkYgdHJhbnNmb3JtIGZvci5cbiAqIEByZXR1cm4gdGhlIHRlcm1zIGluIHRoZSBETkYgdHJhbnNmb3JtLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXREbmZUZXJtcyhlKSB7XG4gICAgaWYgKDAgPT09IGUuZ2V0RmlsdGVycygpLmxlbmd0aCkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY29tcHV0ZURpc3RyaWJ1dGVkTm9ybWFsRm9ybShfX1BSSVZBVEVfY29tcHV0ZUluRXhwYW5zaW9uKGUpKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoX19QUklWQVRFX2lzRGlzanVuY3RpdmVOb3JtYWxGb3JtKHQpKSwgX19QUklWQVRFX2lzU2luZ2xlRmllbGRGaWx0ZXIodCkgfHwgX19QUklWQVRFX2lzRmxhdENvbmp1bmN0aW9uKHQpID8gWyB0IF0gOiB0LmdldEZpbHRlcnMoKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIGEgc2luZ2xlIGZpZWxkIGZpbHRlci4gZS5nLiAoYSA9PSAxMCkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc1NpbmdsZUZpZWxkRmlsdGVyKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIHRoZSBjb25qdW5jdGlvbiBvZiBvbmUgb3IgbW9yZSBmaWVsZCBmaWx0ZXJzLiBlLmcuIChhID09IDEwXG4gKiAmJiBiID09IDIwKVxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0ZsYXRDb25qdW5jdGlvbihlKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdENvbmp1bmN0aW9uKGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGdpdmVuIGZpbHRlciBpcyBpbiBkaXNqdW5jdGl2ZSBub3JtYWwgZm9ybSAoRE5GKS5cbiAqXG4gKiA8cD5JbiBib29sZWFuIGxvZ2ljLCBhIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtIChETkYpIGlzIGEgY2Fub25pY2FsIG5vcm1hbCBmb3JtIG9mIGEgbG9naWNhbFxuICogZm9ybXVsYSBjb25zaXN0aW5nIG9mIGEgZGlzanVuY3Rpb24gb2YgY29uanVuY3Rpb25zOyBpdCBjYW4gYWxzbyBiZSBkZXNjcmliZWQgYXMgYW4gT1Igb2YgQU5Ecy5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGlzanVuY3RpdmVfbm9ybWFsX2Zvcm1cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNEaXNqdW5jdGl2ZU5vcm1hbEZvcm0oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfaXNTaW5nbGVGaWVsZEZpbHRlcihlKSB8fCBfX1BSSVZBVEVfaXNGbGF0Q29uanVuY3Rpb24oZSkgfHwgXG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIGZpbHRlciBpcyB0aGUgZGlzanVuY3Rpb24gb2Ygb25lIG9yIG1vcmUgXCJmbGF0IGNvbmp1bmN0aW9uc1wiIGFuZFxuICogZmllbGQgZmlsdGVycy4gZS5nLiAoYSA9PSAxMCkgfHwgKGI9PTIwICYmIGM9PTMwKVxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzRGlzanVuY3Rpb25PZkZpZWxkRmlsdGVyc0FuZEZsYXRDb25qdW5jdGlvbnMoZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNEaXNqdW5jdGlvbihlKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZ2V0RmlsdGVycygpKSBpZiAoIV9fUFJJVkFURV9pc1NpbmdsZUZpZWxkRmlsdGVyKHQpICYmICFfX1BSSVZBVEVfaXNGbGF0Q29uanVuY3Rpb24odCkpIHJldHVybiAhMTtcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITE7XG4gICAgfShlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXB1dGVEaXN0cmlidXRlZE5vcm1hbEZvcm0oZSkge1xuICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgfHwgZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlcikgcmV0dXJuIGU7XG4gICAgaWYgKDEgPT09IGUuZmlsdGVycy5sZW5ndGgpIHJldHVybiBfX1BSSVZBVEVfY29tcHV0ZURpc3RyaWJ1dGVkTm9ybWFsRm9ybShlLmZpbHRlcnNbMF0pO1xuICAgIC8vIENvbXB1dGUgRE5GIGZvciBlYWNoIG9mIHRoZSBzdWJmaWx0ZXJzIGZpcnN0XG4gICAgICAgIGNvbnN0IHQgPSBlLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9jb21wdXRlRGlzdHJpYnV0ZWROb3JtYWxGb3JtKGUpKSk7XG4gICAgbGV0IG4gPSBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHQsIGUub3ApO1xuICAgIHJldHVybiBuID0gX19QUklWQVRFX2FwcGx5QXNzb2NpYXRpb24obiksIF9fUFJJVkFURV9pc0Rpc2p1bmN0aXZlTm9ybWFsRm9ybShuKSA/IG4gOiAoX19QUklWQVRFX2hhcmRBc3NlcnQobiBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKG4pKSwgX19QUklWQVRFX2hhcmRBc3NlcnQobi5maWx0ZXJzLmxlbmd0aCA+IDEpLCBcbiAgICBuLmZpbHRlcnMucmVkdWNlKCgoZSwgdCkgPT4gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uKGUsIHQpKSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgdCkge1xuICAgIGxldCBuO1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgfHwgZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KHQgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCB0IGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgLy8gRmllbGRGaWx0ZXIgRmllbGRGaWx0ZXJcbiAgICBuID0gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRGaWx0ZXJzKGUsIHQpIHtcbiAgICAgICAgLy8gQ29uanVuY3Rpb24gZGlzdHJpYnV0aW9uIGZvciB0d28gZmllbGQgZmlsdGVycyBpcyB0aGUgY29uanVuY3Rpb24gb2YgdGhlbS5cbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoWyBlLCB0IF0sIFwiYW5kXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuQU5EICovKTtcbiAgICB9KGUsIHQpIDogX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKGUsIHQpIDogdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKHQsIGUpIDogZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uQ29tcG9zaXRlRmlsdGVycyhlLCB0KSB7XG4gICAgICAgIC8vIFRoZXJlIGFyZSBmb3VyIGNhc2VzOlxuICAgICAgICAvLyAoQSAmIEIpICYgKEMgJiBEKSAtLT4gKEEgJiBCICYgQyAmIEQpXG4gICAgICAgIC8vIChBICYgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEIgJiBDKSB8IChBICYgQiAmIEQpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyAmIEQpIC0tPiAoQyAmIEQgJiBBKSB8IChDICYgRCAmIEIpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEMpIHwgKEEgJiBEKSB8IChCICYgQykgfCAoQiAmIEQpXG4gICAgICAgIC8vIENhc2UgMSBpcyBhIG1lcmdlLlxuICAgICAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZS5maWx0ZXJzLmxlbmd0aCA+IDAgJiYgdC5maWx0ZXJzLmxlbmd0aCA+IDApLCBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbihlKSAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbih0KSkgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKGUsIHQuZ2V0RmlsdGVycygpKTtcbiAgICAgICAgLy8gQ2FzZSAyLDMsNCBhbGwgaGF2ZSBhdCBsZWFzdCBvbmUgc2lkZSAobGhzIG9yIHJocykgdGhhdCBpcyBhIGRpc2p1bmN0aW9uLiBJbiBhbGwgdGhyZWUgY2FzZXNcbiAgICAgICAgLy8gd2Ugc2hvdWxkIHRha2UgZWFjaCBlbGVtZW50IG9mIHRoZSBkaXNqdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSBpdCBvdmVyIHRoZSBvdGhlciBzaWRlLCBhbmRcbiAgICAgICAgLy8gcmV0dXJuIHRoZSBkaXNqdW5jdGlvbiBvZiB0aGUgZGlzdHJpYnV0aW9uIHJlc3VsdHMuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Rpc2p1bmN0aW9uKGUpID8gZSA6IHQsIHIgPSBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNEaXNqdW5jdGlvbihlKSA/IHQgOiBlLCBpID0gbi5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgcikpKTtcbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoaSwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9KGUsIHQpLCBfX1BSSVZBVEVfYXBwbHlBc3NvY2lhdGlvbihuKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKGUsIHQpIHtcbiAgICAvLyBUaGVyZSBhcmUgdHdvIGNhc2VzOlxuICAgIC8vIEEgJiAoQiAmIEMpIC0tPiAoQSAmIEIgJiBDKVxuICAgIC8vIEEgJiAoQiB8IEMpIC0tPiAoQSAmIEIpIHwgKEEgJiBDKVxuICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbih0KSkgXG4gICAgLy8gQ2FzZSAxXG4gICAgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKHQsIGUuZ2V0RmlsdGVycygpKTtcbiAgICB7XG4gICAgICAgIC8vIENhc2UgMlxuICAgICAgICBjb25zdCBuID0gdC5maWx0ZXJzLm1hcCgodCA9PiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgdCkpKTtcbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUobiwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyB0aGUgYXNzb2NpYXRpdml0eSBwcm9wZXJ0eSB0byB0aGUgZ2l2ZW4gZmlsdGVyIGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgZmlsdGVyLlxuICpcbiAqIDx1bD5cbiAqICAgPGxpPkEgfCAoQiB8IEMpID09IChBIHwgQikgfCBDID09IChBIHwgQiB8IEMpXG4gKiAgIDxsaT5BICYgKEIgJiBDKSA9PSAoQSAmIEIpICYgQyA9PSAoQSAmIEIgJiBDKVxuICogPC91bD5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXNzb2NpYXRpdmVfcHJvcGVydHkjUHJvcG9zaXRpb25hbF9sb2dpY1xuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKGUpIHtcbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyIHx8IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpLCBcbiAgICBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIpIHJldHVybiBlO1xuICAgIGNvbnN0IHQgPSBlLmdldEZpbHRlcnMoKTtcbiAgICAvLyBJZiB0aGUgY29tcG9zaXRlIGZpbHRlciBvbmx5IGNvbnRhaW5zIDEgZmlsdGVyLCBhcHBseSBhc3NvY2lhdGl2aXR5IHRvIGl0LlxuICAgICAgICBpZiAoMSA9PT0gdC5sZW5ndGgpIHJldHVybiBfX1BSSVZBVEVfYXBwbHlBc3NvY2lhdGlvbih0WzBdKTtcbiAgICAvLyBBc3NvY2lhdGl2aXR5IGFwcGxpZWQgdG8gYSBmbGF0IGNvbXBvc2l0ZSBmaWx0ZXIgcmVzdWx0cyBpcyBpdHNlbGYuXG4gICAgICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0KGUpKSByZXR1cm4gZTtcbiAgICAvLyBGaXJzdCBhcHBseSBhc3NvY2lhdGl2aXR5IHRvIGFsbCBzdWJmaWx0ZXJzLiBUaGlzIHdpbGwgaW4gdHVybiByZWN1cnNpdmVseSBhcHBseVxuICAgIC8vIGFzc29jaWF0aXZpdHkgdG8gYWxsIG5lc3RlZCBjb21wb3NpdGUgZmlsdGVycyBhbmQgZmllbGQgZmlsdGVycy5cbiAgICAgICAgY29uc3QgbiA9IHQubWFwKChlID0+IF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKGUpKSksIHIgPSBbXTtcbiAgICAvLyBGb3IgY29tcG9zaXRlIHN1YmZpbHRlcnMgdGhhdCBwZXJmb3JtIHRoZSBzYW1lIGtpbmQgb2YgbG9naWNhbCBvcGVyYXRpb24gYXMgYGNvbXBvc2l0ZUZpbHRlcmBcbiAgICAvLyB0YWtlIG91dCB0aGVpciBmaWx0ZXJzIGFuZCBhZGQgdGhlbSB0byBgY29tcG9zaXRlRmlsdGVyYC4gRm9yIGV4YW1wbGU6XG4gICAgLy8gY29tcG9zaXRlRmlsdGVyID0gKEEgfCAoQiB8IEMgfCBEKSlcbiAgICAvLyBjb21wb3NpdGVTdWJmaWx0ZXIgPSAoQiB8IEMgfCBEKVxuICAgIC8vIFJlc3VsdDogKEEgfCBCIHwgQyB8IEQpXG4gICAgLy8gTm90ZSB0aGF0IHRoZSBgY29tcG9zaXRlU3ViZmlsdGVyYCBoYXMgYmVlbiBlbGltaW5hdGVkLCBhbmQgaXRzIGZpbHRlcnMgKEIsIEMsIEQpIGhhdmUgYmVlblxuICAgIC8vIGFkZGVkIHRvIHRoZSB0b3AtbGV2ZWwgXCJjb21wb3NpdGVGaWx0ZXJcIi5cbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgodCA9PiB7XG4gICAgICAgIHQgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciA/IHIucHVzaCh0KSA6IHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgKHQub3AgPT09IGUub3AgPyBcbiAgICAgICAgLy8gY29tcG9zaXRlRmlsdGVyOiAoQSB8IChCIHwgQykpXG4gICAgICAgIC8vIGNvbXBvc2l0ZVN1YmZpbHRlcjogKEIgfCBDKVxuICAgICAgICAvLyBSZXN1bHQ6IChBIHwgQiB8IEMpXG4gICAgICAgIHIucHVzaCguLi50LmZpbHRlcnMpIDogXG4gICAgICAgIC8vIGNvbXBvc2l0ZUZpbHRlcjogKEEgfCAoQiAmIEMpKVxuICAgICAgICAvLyBjb21wb3NpdGVTdWJmaWx0ZXI6IChCICYgQylcbiAgICAgICAgLy8gUmVzdWx0OiAoQSB8IChCICYgQykpXG4gICAgICAgIHIucHVzaCh0KSk7XG4gICAgfSkpLCAxID09PSByLmxlbmd0aCA/IHJbMF0gOiBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHIsIGUub3ApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlJbmRleE1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNuID0gbmV3IF9fUFJJVkFURV9NZW1vcnlDb2xsZWN0aW9uUGFyZW50SW5kZXg7XG4gICAgfVxuICAgIGFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc24uYWRkKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRDb2xsZWN0aW9uUGFyZW50cyhlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnNuLmdldEVudHJpZXModCkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZShlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgwIC8qIEluZGV4VHlwZS5OT05FICovKTtcbiAgICB9XG4gICAgZ2V0RmllbGRJbmRleGVzKGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICB9XG4gICAgZ2V0TmV4dENvbGxlY3Rpb25Hcm91cFRvVXBkYXRlKGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoSW5kZXhPZmZzZXQubWluKCkpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXRGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKEluZGV4T2Zmc2V0Lm1pbigpKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUluZGV4RW50cmllcyhlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgY29sbGVjdGlvbi1wYXJlbnQgaW5kZXggZXhwb3NlZCBieSBNZW1vcnlJbmRleE1hbmFnZXIuXG4gKiBBbHNvIHVzZWQgZm9yIGluLW1lbW9yeSBjYWNoaW5nIGJ5IEluZGV4ZWREYkluZGV4TWFuYWdlciBhbmQgaW5pdGlhbCBpbmRleCBwb3B1bGF0aW9uXG4gKiBpbiBpbmRleGVkZGJfc2NoZW1hLnRzXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeUNvbGxlY3Rpb25QYXJlbnRJbmRleCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSB7fTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBmYWxzZSBpZiB0aGUgZW50cnkgYWxyZWFkeSBleGlzdGVkLlxuICAgIGFkZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmxhc3RTZWdtZW50KCksIG4gPSBlLnBvcExhc3QoKSwgciA9IHRoaXMuaW5kZXhbdF0gfHwgbmV3IFNvcnRlZFNldChSZXNvdXJjZVBhdGguY29tcGFyYXRvciksIGkgPSAhci5oYXMobik7XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4W3RdID0gci5hZGQobiksIGk7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmxhc3RTZWdtZW50KCksIG4gPSBlLnBvcExhc3QoKSwgciA9IHRoaXMuaW5kZXhbdF07XG4gICAgICAgIHJldHVybiByICYmIHIuaGFzKG4pO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKGUpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmluZGV4W2VdIHx8IG5ldyBTb3J0ZWRTZXQoUmVzb3VyY2VQYXRoLmNvbXBhcmF0b3IpKS50b0FycmF5KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBFZSA9IG5ldyBVaW50OEFycmF5KDApO1xuXG4vKipcbiAqIEEgcGVyc2lzdGVkIGltcGxlbWVudGF0aW9uIG9mIEluZGV4TWFuYWdlci5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFVubGlrZSBpT1MgYW5kIEFuZHJvaWQsIHRoZSBXZWIgU0RLIGRvZXMgbm90IG1lbW9pemUgaW5kZXhcbiAqIGRhdGEgYXMgaXQgc3VwcG9ydHMgbXVsdGktdGFiIGFjY2Vzcy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYkluZGV4TWFuYWdlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnVzZXIgPSBlLCB0aGlzLmRhdGFiYXNlSWQgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGluLW1lbW9yeSBjb3B5IG9mIHRoZSBpbmRleCBlbnRyaWVzIHdlJ3ZlIGFscmVhZHkgd3JpdHRlbiBzaW5jZSB0aGUgU0RLXG4gICAgICAgICAqIGxhdW5jaGVkLiBVc2VkIHRvIGF2b2lkIHJlLXdyaXRpbmcgdGhlIHNhbWUgZW50cnkgcmVwZWF0ZWRseS5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhpcyBpcyAqTk9UKiBhIGNvbXBsZXRlIGNhY2hlIG9mIHdoYXQncyBpbiBwZXJzaXN0ZW5jZSBhbmQgc28gY2FuIG5ldmVyIGJlXG4gICAgICAgICAqIHVzZWQgdG8gc2F0aXNmeSByZWFkcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub24gPSBuZXcgX19QUklWQVRFX01lbW9yeUNvbGxlY3Rpb25QYXJlbnRJbmRleCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYXBzIGZyb20gYSB0YXJnZXQgdG8gaXRzIGVxdWl2YWxlbnQgbGlzdCBvZiBzdWItdGFyZ2V0cy4gRWFjaCBzdWItdGFyZ2V0XG4gICAgICAgICAqIGNvbnRhaW5zIG9ubHkgb25lIHRlcm0gZnJvbSB0aGUgdGFyZ2V0J3MgZGlzanVuY3RpdmUgbm9ybWFsIGZvcm0gKERORikuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9uID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoZSkpLCAoKGUsIHQpID0+IF9fUFJJVkFURV90YXJnZXRFcXVhbHMoZSwgdCkpKSwgXG4gICAgICAgIHRoaXMudWlkID0gZS51aWQgfHwgXCJcIjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyBlbnRyeSB0byB0aGUgY29sbGVjdGlvbiBwYXJlbnQgaW5kZXguXG4gICAgICpcbiAgICAgKiBSZXBlYXRlZCBjYWxscyBmb3IgdGhlIHNhbWUgY29sbGVjdGlvblBhdGggc2hvdWxkIGJlIGF2b2lkZWQgd2l0aGluIGFcbiAgICAgKiB0cmFuc2FjdGlvbiBhcyBJbmRleGVkRGJJbmRleE1hbmFnZXIgb25seSBjYWNoZXMgd3JpdGVzIG9uY2UgYSB0cmFuc2FjdGlvblxuICAgICAqIGhhcyBiZWVuIGNvbW1pdHRlZC5cbiAgICAgKi8gICAgYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgoZSwgdCkge1xuICAgICAgICBpZiAoIXRoaXMub24uaGFzKHQpKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5sYXN0U2VnbWVudCgpLCByID0gdC5wb3BMYXN0KCk7XG4gICAgICAgICAgICBlLmFkZE9uQ29tbWl0dGVkTGlzdGVuZXIoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGNvbGxlY3Rpb24gdG8gdGhlIGluIG1lbW9yeSBjYWNoZSBvbmx5IGlmIHRoZSB0cmFuc2FjdGlvbiB3YXNcbiAgICAgICAgICAgICAgICAvLyBzdWNjZXNzZnVsbHkgY29tbWl0dGVkLlxuICAgICAgICAgICAgICAgIHRoaXMub24uYWRkKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgaSA9IHtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSWQ6IG4sXG4gICAgICAgICAgICAgICAgcGFyZW50OiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHIpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb2xsZWN0aW9uUGFyZW50c1N0b3JlKGUpLnB1dChpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0Q29sbGVjdGlvblBhcmVudHMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gW10sIHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIHQsIFwiXCIgXSwgWyBfX1BSSVZBVEVfaW1tZWRpYXRlU3VjY2Vzc29yKHQpLCBcIlwiIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb2xsZWN0aW9uUGFyZW50c1N0b3JlKGUpLkcocikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHIgb2YgZSkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgY29sbGVjdGlvbklkIGd1YXJkIHNob3VsZG4ndCBiZSBuZWNlc3NhcnkgKGFuZCBpc24ndCBhcyBsb25nXG4gICAgICAgICAgICAgICAgLy8gYXMgd2UncmUgcnVubmluZyBpbiBhIHJlYWwgYnJvd3NlciksIGJ1dCB0aGVyZSdzIGEgYnVnIGluXG4gICAgICAgICAgICAgICAgLy8gaW5kZXhlZGRic2hpbSB0aGF0IGJyZWFrcyBvdXIgcmFuZ2UgaW4gb3VyIHRlc3RzIHJ1bm5pbmcgaW4gbm9kZTpcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXhlbWNsaW9uL0luZGV4ZWREQlNoaW0vaXNzdWVzLzMzNFxuICAgICAgICAgICAgICAgIGlmIChyLmNvbGxlY3Rpb25JZCAhPT0gdCkgYnJlYWs7XG4gICAgICAgICAgICAgICAgbi5wdXNoKF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoci5wYXJlbnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGFkZEZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICAvLyBUT0RPKGluZGV4aW5nKTogVmVyaWZ5IHRoYXQgdGhlIGF1dG8taW5jcmVtZW50aW5nIGluZGV4IElEIHdvcmtzIGluXG4gICAgICAgIC8vIFNhZmFyaSAmIEZpcmVmb3guXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhDb25maWd1cmF0aW9uU3RvcmUoZSksIHIgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkluZGV4Q29uZmlndXJhdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGluZGV4SWQ6IGUuaW5kZXhJZCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IGUuY29sbGVjdGlvbkdyb3VwLFxuICAgICAgICAgICAgICAgIGZpZWxkczogZS5maWVsZHMubWFwKChlID0+IFsgZS5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIGUua2luZCBdKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0odCk7XG4gICAgICAgIGRlbGV0ZSByLmluZGV4SWQ7XG4gICAgICAgIC8vIGBpbmRleElkYCBpcyBhdXRvLXBvcHVsYXRlZCBieSBJbmRleGVkRGJcbiAgICAgICAgY29uc3QgaSA9IG4uYWRkKHIpO1xuICAgICAgICBpZiAodC5pbmRleFN0YXRlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKTtcbiAgICAgICAgICAgIHJldHVybiBpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIG4ucHV0KF9fUFJJVkFURV90b0RiSW5kZXhTdGF0ZShlLCB0aGlzLnVzZXIsIHQuaW5kZXhTdGF0ZS5zZXF1ZW5jZU51bWJlciwgdC5pbmRleFN0YXRlLm9mZnNldCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpLm5leHQoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhDb25maWd1cmF0aW9uU3RvcmUoZSksIHIgPSBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpLCBpID0gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpO1xuICAgICAgICByZXR1cm4gbi5kZWxldGUodC5pbmRleElkKS5uZXh0KCgoKSA9PiByLmRlbGV0ZShJREJLZXlSYW5nZS5ib3VuZChbIHQuaW5kZXhJZCBdLCBbIHQuaW5kZXhJZCArIDEgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApKSkpLm5leHQoKCgpID0+IGkuZGVsZXRlKElEQktleVJhbmdlLmJvdW5kKFsgdC5pbmRleElkIF0sIFsgdC5pbmRleElkICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCkpKSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKTtcbiAgICAgICAgbGV0IHIgPSAhMDtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBNYXA7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0aGlzLmFuKHQpLCAodCA9PiB0aGlzLnVuKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgciAmJiAociA9ICEhZSksIGkuc2V0KHQsIGUpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAocikge1xuICAgICAgICAgICAgICAgIGxldCBlID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChpLCAoKGksIHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiSW5kZXhNYW5hZ2VyXCIsIGBVc2luZyBpbmRleCAke2Z1bmN0aW9uIF9fUFJJVkFURV9maWVsZEluZGV4VG9TdHJpbmcoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBpZD0ke2UuaW5kZXhJZH18Y2c9JHtlLmNvbGxlY3Rpb25Hcm91cH18Zj0ke2UuZmllbGRzLm1hcCgoZSA9PiBgJHtlLmZpZWxkUGF0aH06JHtlLmtpbmR9YCkpLmpvaW4oXCIsXCIpfWA7XG4gICAgICAgICAgICAgICAgICAgIH0oaSl9IHRvIGV4ZWN1dGUgJHtfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQodCl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0QXJyYXlWYWx1ZXMoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9maWVsZEluZGV4R2V0QXJyYXlTZWdtZW50KHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gbikgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgX19QUklWQVRFX3RhcmdldEdldEZpZWxkRmlsdGVyc0ZvclBhdGgoZSwgbi5maWVsZFBhdGgpKSBzd2l0Y2ggKHQub3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQudmFsdWUuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbIHQudmFsdWUgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1haW5pbmcgZmlsdGVycyBhcmUgbm90IGFycmF5IGZpbHRlcnMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIFJldHVybnMgdGhlIGxpc3Qgb2YgdmFsdWVzIHRoYXQgYXJlIHVzZWQgaW4gIT0gb3IgTk9UX0lOIGZpbHRlcnMuIFJldHVybnNcbiAqIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gc3VjaCBmaWx0ZXJzLlxuICovIChzLCBpKSwgXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXROb3RJblZhbHVlcyhlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gbmV3IE1hcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHModCkpIGZvciAoY29uc3QgdCBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCByLmZpZWxkUGF0aCkpIHN3aXRjaCAodC5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNvZGUgZXF1YWxpdHkgcHJlZml4LCB3aGljaCBpcyBlbmNvZGVkIGluIHRoZSBpbmRleCB2YWx1ZSBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5lcXVhbGl0eSAoZS5nLiBgYSA9PSAnYScgJiYgYiAhPSAnYidgIGlzIGVuY29kZWQgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBgdmFsdWUgIT0gJ2FiJ2ApLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2V0KHIuZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpLCB0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RJbi9Ob3RFcXVhbCBpcyBhbHdheXMgYSBzdWZmaXguIFRoZXJlIGNhbm5vdCBiZSBhbnkgcmVtYWluaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VnbWVudHMgYW5kIGhlbmNlIHdlIGNhbiByZXR1cm4gZWFybHkgaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zZXQoci5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIHQudmFsdWUpLCBBcnJheS5mcm9tKG4udmFsdWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGNhbm5vdCBiZSB1c2VkIGFzIG5vdEluIGJvdW5kcy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIGxvd2VyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGEgc3RhcnRpbmcgcG9pbnQgdG9cbiAqIHNjYW4gdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNSU5fVkFMVUVgIGlmIG5vIGxvd2VyIGJvdW5kXG4gKiBleGlzdHMuXG4gKi8gKHMsIGkpLCBhID0gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldExvd2VyQm91bmQoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGEgbG93ZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0QXQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gaS5raW5kID8gX19QUklWQVRFX3RhcmdldEdldEFzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLnN0YXJ0QXQpIDogX19QUklWQVRFX3RhcmdldEdldERlc2NlbmRpbmdCb3VuZChlLCBpLmZpZWxkUGF0aCwgZS5zdGFydEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnB1c2godC52YWx1ZSksIHIgJiYgKHIgPSB0LmluY2x1c2l2ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJvdW5kKG4sIHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhbiB1cHBlciBib3VuZCBvZiBmaWVsZCB2YWx1ZXMgdGhhdCBjYW4gYmUgdXNlZCBhcyBhbiBlbmRpbmcgcG9pbnRcbiAqIHdoZW4gc2Nhbm5pbmcgdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNQVhfVkFMVUVgIGlmIG5vXG4gKiB1cHBlciBib3VuZCBleGlzdHMuXG4gKi8gKHMsIGkpLCB1ID0gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldFVwcGVyQm91bmQoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGFuIHVwcGVyIGJvdW5kIGlmIHRoZXJlIGlzIGEgc3VpdGFibGUgZmlsdGVyIG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmRBdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHModCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovID09PSBpLmtpbmQgPyBfX1BSSVZBVEVfdGFyZ2V0R2V0RGVzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLmVuZEF0KSA6IF9fUFJJVkFURV90YXJnZXRHZXRBc2NlbmRpbmdCb3VuZChlLCBpLmZpZWxkUGF0aCwgZS5lbmRBdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5wdXNoKHQudmFsdWUpLCByICYmIChyID0gdC5pbmNsdXNpdmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChuLCByKTtcbiAgICAgICAgICAgICAgICAgICAgfShzLCBpKSwgYyA9IHRoaXMuY24oaSwgcywgYSksIGwgPSB0aGlzLmNuKGksIHMsIHUpLCBoID0gdGhpcy5sbihpLCBzLCBfKSwgUCA9IHRoaXMuaG4oaS5pbmRleElkLCBvLCBjLCBhLmluY2x1c2l2ZSwgbCwgdS5pbmNsdXNpdmUsIGgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2goUCwgKGkgPT4gbi5IKGksIHQubGltaXQpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKHQuZG9jdW1lbnRLZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuaGFzKG4pIHx8IChlID0gZS5hZGQobiksIHIucHVzaChuKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYW4oZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuX24uZ2V0KGUpO1xuICAgICAgICBpZiAodCkgcmV0dXJuIHQ7XG4gICAgICAgIGlmICgwID09PSBlLmZpbHRlcnMubGVuZ3RoKSB0ID0gWyBlIF07IGVsc2Uge1xuICAgICAgICAgICAgdCA9IF9fUFJJVkFURV9nZXREbmZUZXJtcyhDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKGUuZmlsdGVycywgXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8pKS5tYXAoKHQgPT4gX19QUklWQVRFX25ld1RhcmdldChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBlLm9yZGVyQnksIHQuZ2V0RmlsdGVycygpLCBlLmxpbWl0LCBlLnN0YXJ0QXQsIGUuZW5kQXQpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX24uc2V0KGUsIHQpLCB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEga2V5IHJhbmdlIHF1ZXJ5IG9uIGBEYkluZGV4RW50cnlTdG9yZWAgdGhhdCB1bmlvbnMgYWxsXG4gICAgICogYm91bmRzLlxuICAgICAqLyAgICBobihlLCB0LCBuLCByLCBpLCBzLCBvKSB7XG4gICAgICAgIC8vIFRoZSBudW1iZXIgb2YgdG90YWwgaW5kZXggc2NhbnMgd2UgdW5pb24gdG9nZXRoZXIuIFRoaXMgaXMgc2ltaWxhciB0byBhXG4gICAgICAgIC8vIGRpc3RyaWJ1dGVkIG5vcm1hbCBmb3JtLCBidXQgYWRhcHRlZCBmb3IgYXJyYXkgdmFsdWVzLiBXZSBjcmVhdGUgYSBzaW5nbGVcbiAgICAgICAgLy8gaW5kZXggcmFuZ2UgcGVyIHZhbHVlIGluIGFuIEFSUkFZX0NPTlRBSU5TIG9yIEFSUkFZX0NPTlRBSU5TX0FOWSBmaWx0ZXJcbiAgICAgICAgLy8gY29tYmluZWQgd2l0aCB0aGUgdmFsdWVzIGZyb20gdGhlIHF1ZXJ5IGJvdW5kcy5cbiAgICAgICAgY29uc3QgXyA9IChudWxsICE9IHQgPyB0Lmxlbmd0aCA6IDEpICogTWF0aC5tYXgobi5sZW5ndGgsIGkubGVuZ3RoKSwgYSA9IF8gLyAobnVsbCAhPSB0ID8gdC5sZW5ndGggOiAxKSwgdSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IF87ICsrYykge1xuICAgICAgICAgICAgY29uc3QgXyA9IHQgPyB0aGlzLlBuKHRbYyAvIGFdKSA6IEVlLCBsID0gdGhpcy5JbihlLCBfLCBuW2MgJSBhXSwgciksIGggPSB0aGlzLlRuKGUsIF8sIGlbYyAlIGFdLCBzKSwgUCA9IG8ubWFwKCh0ID0+IHRoaXMuSW4oZSwgXywgdCwgXG4gICAgICAgICAgICAvKiBpbmNsdXNpdmU9ICovICEwKSkpO1xuICAgICAgICAgICAgdS5wdXNoKC4uLnRoaXMuY3JlYXRlUmFuZ2UobCwgaCwgUCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1O1xuICAgIH1cbiAgICAvKiogR2VuZXJhdGVzIHRoZSBsb3dlciBib3VuZCBmb3IgYGFycmF5VmFsdWVgIGFuZCBgZGlyZWN0aW9uYWxWYWx1ZWAuICovICAgIEluKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShlLCBEb2N1bWVudEtleS5lbXB0eSgpLCB0LCBuKTtcbiAgICAgICAgcmV0dXJuIHIgPyBpIDogaS5KdCgpO1xuICAgIH1cbiAgICAvKiogR2VuZXJhdGVzIHRoZSB1cHBlciBib3VuZCBmb3IgYGFycmF5VmFsdWVgIGFuZCBgZGlyZWN0aW9uYWxWYWx1ZWAuICovICAgIFRuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShlLCBEb2N1bWVudEtleS5lbXB0eSgpLCB0LCBuKTtcbiAgICAgICAgcmV0dXJuIHIgPyBpLkp0KCkgOiBpO1xuICAgIH1cbiAgICB1bihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX1RhcmdldEluZGV4TWF0Y2hlcih0KSwgciA9IG51bGwgIT0gdC5jb2xsZWN0aW9uR3JvdXAgPyB0LmNvbGxlY3Rpb25Hcm91cCA6IHQucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZEluZGV4ZXMoZSwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGluZGV4IHdpdGggdGhlIG1vc3QgbnVtYmVyIG9mIHNlZ21lbnRzLlxuICAgICAgICAgICAgbGV0IHQgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIGUpIHtcbiAgICAgICAgICAgICAgICBuLmVuKHIpICYmICghdCB8fCByLmZpZWxkcy5sZW5ndGggPiB0LmZpZWxkcy5sZW5ndGgpICYmICh0ID0gcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRJbmRleFR5cGUoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IDIgLyogSW5kZXhUeXBlLkZVTEwgKi87XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLmFuKHQpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gociwgKHQgPT4gdGhpcy51bihlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGUgPyAwIC8qIEluZGV4VHlwZS5OT05FICovICE9PSBuICYmIGUuZmllbGRzLmxlbmd0aCA8IGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXRTZWdtZW50Q291bnQoZSkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKSwgbiA9ICExO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBlLmZpbHRlcnMpIGZvciAoY29uc3QgZSBvZiByLmdldEZsYXR0ZW5lZEZpbHRlcnMoKSkgXG4gICAgICAgICAgICAgICAgLy8gX19uYW1lX18gaXMgbm90IGFuIGV4cGxpY2l0IHNlZ21lbnQgb2YgYW55IGluZGV4LCBzbyB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgLy8gY291bnQgaXQuXG4gICAgICAgICAgICAgICAgZS5maWVsZC5pc0tleUZpZWxkKCkgfHwgKFxuICAgICAgICAgICAgICAgIC8vIEFSUkFZX0NPTlRBSU5TIG9yIEFSUkFZX0NPTlRBSU5TX0FOWSBmaWx0ZXJzIG11c3QgYmUgY291bnRlZCBzZXBhcmF0ZWx5LlxuICAgICAgICAgICAgICAgIC8vIEZvciBpbnN0YW5jZSwgaXQgaXMgcG9zc2libGUgdG8gaGF2ZSBhbiBpbmRleCBmb3IgXCJhIEFSUkFZIGEgQVNDXCIuIEV2ZW5cbiAgICAgICAgICAgICAgICAvLyB0aG91Z2ggdGhlc2UgYXJlIG9uIHRoZSBzYW1lIGZpZWxkLCB0aGV5IHNob3VsZCBiZSBjb3VudGVkIGFzIHR3b1xuICAgICAgICAgICAgICAgIC8vIHNlcGFyYXRlIHNlZ21lbnRzIGluIGFuIGluZGV4LlxuICAgICAgICAgICAgICAgIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gZS5vcCB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gZS5vcCA/IG4gPSAhMCA6IHQgPSB0LmFkZChlLmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIGUub3JkZXJCeSkgXG4gICAgICAgICAgICAgICAgLy8gX19uYW1lX18gaXMgbm90IGFuIGV4cGxpY2l0IHNlZ21lbnQgb2YgYW55IGluZGV4LCBzbyB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgLy8gY291bnQgaXQuXG4gICAgICAgICAgICAgICAgbi5maWVsZC5pc0tleUZpZWxkKCkgfHwgKHQgPSB0LmFkZChuLmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuc2l6ZSArIChuID8gMSA6IDApO1xuICAgICAgICAgICAgfSh0KSAmJiAobiA9IDEgLyogSW5kZXhUeXBlLlBBUlRJQUwgKi8pIDogbiA9IDAgLyogSW5kZXhUeXBlLk5PTkUgKi87XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IFxuICAgICAgICAvLyBPUiBxdWVyaWVzIGhhdmUgbW9yZSB0aGFuIG9uZSBzdWItdGFyZ2V0IChvbmUgc3ViLXRhcmdldCBwZXIgRE5GIHRlcm0pLiBXZSBjdXJyZW50bHkgY29uc2lkZXJcbiAgICAgICAgLy8gT1IgcXVlcmllcyB0aGF0IGhhdmUgYSBgbGltaXRgIHRvIGhhdmUgYSBwYXJ0aWFsIGluZGV4LiBGb3Igc3VjaCBxdWVyaWVzIHdlIHBlcmZvcm0gc29ydGluZ1xuICAgICAgICAvLyBhbmQgYXBwbHkgdGhlIGxpbWl0IGluIG1lbW9yeSBhcyBhIHBvc3QtcHJvY2Vzc2luZyBzdGVwLlxuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0SGFzTGltaXQoZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IGUubGltaXQ7XG4gICAgICAgIH0odCkgJiYgci5sZW5ndGggPiAxICYmIDIgLyogSW5kZXhUeXBlLkZVTEwgKi8gPT09IG4gPyAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovIDogbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGVuY29kZWQgZm9ybSBvZiB0aGUgZGlyZWN0aW9uYWwgdmFsdWVzIGluIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgaGF2ZSBhbGwgZmllbGRzIHNwZWNpZmllZCBpbiB0aGVcbiAgICAgKiBpbmRleC5cbiAgICAgKi8gICAgRW4oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9JbmRleEJ5dGVFbmNvZGVyO1xuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5kYXRhLmZpZWxkKHIuZmllbGRQYXRoKTtcbiAgICAgICAgICAgIGlmIChudWxsID09IGUpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uSHQoci5raW5kKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLmJ0LlB0KGUsIGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuLld0KCk7XG4gICAgfVxuICAgIC8qKiBFbmNvZGVzIGEgc2luZ2xlIHZhbHVlIHRvIHRoZSBhc2NlbmRpbmcgaW5kZXggZm9ybWF0LiAqLyAgICBQbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXI7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci5idC5QdChlLCB0Lkh0KDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLykpLCBcbiAgICAgICAgdC5XdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGVuY29kZWQgZm9ybSBvZiB0aGUgZG9jdW1lbnQga2V5IHRoYXQgc29ydHMgYmFzZWQgb24gdGhlIGtleVxuICAgICAqIG9yZGVyaW5nIG9mIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKi8gICAgZG4oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9JbmRleEJ5dGVFbmNvZGVyO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIuYnQuUHQoX19QUklWQVRFX3JlZlZhbHVlKHRoaXMuZGF0YWJhc2VJZCwgdCksIG4uSHQoZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXRLZXlPcmRlcihlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpO1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IHQubGVuZ3RoID8gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovIDogdFt0Lmxlbmd0aCAtIDFdLmtpbmQ7XG4gICAgICAgIH0oZSkpKSwgbi5XdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZXMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLlxuICAgICAqIEZvciBJTiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBsbihlLCB0LCBuKSB7XG4gICAgICAgIGlmIChudWxsID09PSBuKSByZXR1cm4gW107XG4gICAgICAgIGxldCByID0gW107XG4gICAgICAgIHIucHVzaChuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXIpO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHMoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuW2krK107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgcikgaWYgKHRoaXMuQW4odCwgcy5maWVsZFBhdGgpICYmIGlzQXJyYXkoZSkpIHIgPSB0aGlzLlJuKHIsIHMsIGUpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbi5IdChzLmtpbmQpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLmJ0LlB0KGUsIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLlZuKHIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBib3VuZHMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLiBGb3IgSU5cbiAgICAgKiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBjbihlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxuKGUsIHQsIG4ucG9zaXRpb24pO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgYnl0ZSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIHByb3ZpZGVkIGVuY29kZXJzLiAqLyAgICBWbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgKytuKSB0W25dID0gZVtuXS5XdCgpO1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNlcGFyYXRlIGVuY29kZXIgZm9yIGVhY2ggZWxlbWVudCBvZiBhbiBhcnJheS5cbiAgICAgKlxuICAgICAqIFRoZSBtZXRob2QgYXBwZW5kcyBlYWNoIHZhbHVlIHRvIGFsbCBleGlzdGluZyBlbmNvZGVycyAoZS5nLiBmaWx0ZXIoXCJhXCIsXG4gICAgICogXCI9PVwiLCBcImExXCIpLmZpbHRlcihcImJcIiwgXCJpblwiLCBbXCJiMVwiLCBcImIyXCJdKSBiZWNvbWVzIFtcImExLGIxXCIsIFwiYTEsYjJcIl0pLiBBXG4gICAgICogbGlzdCBvZiBuZXcgZW5jb2RlcnMgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIFJuKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IFsgLi4uZSBdLCBpID0gW107XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBuLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdKSBmb3IgKGNvbnN0IG4gb2Ygcikge1xuICAgICAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2RlcjtcbiAgICAgICAgICAgIHIuc2VlZChuLld0KCkpLCBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci5idC5QdChlLCByLkh0KHQua2luZCkpLCBpLnB1c2gocik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICAgIEFuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuICEhZS5maWx0ZXJzLmZpbmQoKGUgPT4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyICYmIGUuZmllbGQuaXNFcXVhbCh0KSAmJiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSBlLm9wIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSBlLm9wKSkpO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZGV4ZXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuICh0ID8gbi5HKFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgSURCS2V5UmFuZ2UuYm91bmQodCwgdCkpIDogbi5HKCkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKGUsIChlID0+IHIuZ2V0KFsgZS5pbmRleElkLCB0aGlzLnVpZCBdKS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgICAgICB0LnB1c2goZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYkluZGV4Q29uZmlndXJhdGlvbihlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0ID8gbmV3IEluZGV4U3RhdGUodC5zZXF1ZW5jZU51bWJlciwgbmV3IEluZGV4T2Zmc2V0KF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAodC5yZWFkVGltZSksIG5ldyBEb2N1bWVudEtleShfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKHQuZG9jdW1lbnRLZXkpKSwgdC5sYXJnZXN0QmF0Y2hJZCkpIDogSW5kZXhTdGF0ZS5lbXB0eSgpLCByID0gZS5maWVsZHMubWFwKCgoW2UsIHRdKSA9PiBuZXcgSW5kZXhTZWdtZW50KEZpZWxkUGF0aCQxLmZyb21TZXJ2ZXJGb3JtYXQoZSksIHQpKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGRJbmRleChlLmluZGV4SWQsIGUuY29sbGVjdGlvbkdyb3VwLCByLCBuKTtcbiAgICAgICAgICAgICAgICB9KGUsIG4pKTtcbiAgICAgICAgICAgIH0pKSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXROZXh0Q29sbGVjdGlvbkdyb3VwVG9VcGRhdGUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZEluZGV4ZXMoZSkubmV4dCgoZSA9PiAwID09PSBlLmxlbmd0aCA/IG51bGwgOiAoZS5zb3J0KCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUuaW5kZXhTdGF0ZS5zZXF1ZW5jZU51bWJlciAtIHQuaW5kZXhTdGF0ZS5zZXF1ZW5jZU51bWJlcjtcbiAgICAgICAgICAgIHJldHVybiAwICE9PSBuID8gbiA6IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUuY29sbGVjdGlvbkdyb3VwLCB0LmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgICAgIH0pKSwgZVswXS5jb2xsZWN0aW9uR3JvdXApKSk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfaW5kZXhDb25maWd1cmF0aW9uU3RvcmUoZSksIGkgPSBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5tbihlKS5uZXh0KChlID0+IHIuRyhcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIElEQktleVJhbmdlLmJvdW5kKHQsIHQpKS5uZXh0KCh0ID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQsICh0ID0+IGkucHV0KF9fUFJJVkFURV90b0RiSW5kZXhTdGF0ZSh0LmluZGV4SWQsIHRoaXMudXNlciwgZSwgbikpKSkpKSkpO1xuICAgIH1cbiAgICB1cGRhdGVJbmRleEVudHJpZXMoZSwgdCkge1xuICAgICAgICAvLyBQb3J0aW5nIE5vdGU6IGBnZXRGaWVsZEluZGV4ZXMoKWAgb24gV2ViIGRvZXMgbm90IGNhY2hlIGluZGV4IGxvb2t1cHMgYXNcbiAgICAgICAgLy8gaXQgY291bGQgYmUgdXNlZCBhY3Jvc3MgZGlmZmVyZW50IEluZGV4ZWREQiB0cmFuc2FjdGlvbnMuIEFzIGFueSBjYWNoZWRcbiAgICAgICAgLy8gZGF0YSBtaWdodCBiZSBpbnZhbGlkYXRlZCBieSBvdGhlciBtdWx0aS10YWIgY2xpZW50cywgd2UgY2FuIG9ubHkgdHJ1c3RcbiAgICAgICAgLy8gZGF0YSB3aXRoaW4gYSBzaW5nbGUgSW5kZXhlZERCIHRyYW5zYWN0aW9uLiBXZSB0aGVyZWZvcmUgYWRkIGEgY2FjaGVcbiAgICAgICAgLy8gaGVyZS5cbiAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAoKHQsIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuLmdldCh0LmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgICAgICAgICByZXR1cm4gKGkgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShpKSA6IHRoaXMuZ2V0RmllbGRJbmRleGVzKGUsIHQuY29sbGVjdGlvbkdyb3VwKSkubmV4dCgoaSA9PiAobi5zZXQodC5jb2xsZWN0aW9uR3JvdXAsIGkpLCBcbiAgICAgICAgICAgIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKGksIChuID0+IHRoaXMuZm4oZSwgdCwgbikubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuZ24ociwgbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuaXNFcXVhbChpKSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLnBuKGUsIHIsIG4sIHQsIGkpO1xuICAgICAgICAgICAgfSkpKSkpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgeW4oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLnB1dCh7XG4gICAgICAgICAgICBpbmRleElkOiByLmluZGV4SWQsXG4gICAgICAgICAgICB1aWQ6IHRoaXMudWlkLFxuICAgICAgICAgICAgYXJyYXlWYWx1ZTogci5hcnJheVZhbHVlLFxuICAgICAgICAgICAgZGlyZWN0aW9uYWxWYWx1ZTogci5kaXJlY3Rpb25hbFZhbHVlLFxuICAgICAgICAgICAgb3JkZXJlZERvY3VtZW50S2V5OiB0aGlzLmRuKG4sIHQua2V5KSxcbiAgICAgICAgICAgIGRvY3VtZW50S2V5OiB0LmtleS5wYXRoLnRvQXJyYXkoKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgd24oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLmRlbGV0ZShbIHIuaW5kZXhJZCwgdGhpcy51aWQsIHIuYXJyYXlWYWx1ZSwgci5kaXJlY3Rpb25hbFZhbHVlLCB0aGlzLmRuKG4sIHQua2V5KSwgdC5rZXkucGF0aC50b0FycmF5KCkgXSk7XG4gICAgfVxuICAgIGZuKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKTtcbiAgICAgICAgbGV0IGkgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiByLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkoWyBuLmluZGV4SWQsIHRoaXMudWlkLCB0aGlzLmRuKG4sIHQpIF0pXG4gICAgICAgIH0sICgoZSwgcikgPT4ge1xuICAgICAgICAgICAgaSA9IGkuYWRkKG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShuLmluZGV4SWQsIHQsIHIuYXJyYXlWYWx1ZSwgci5kaXJlY3Rpb25hbFZhbHVlKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQuICovICAgIGduKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcik7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLkVuKHQsIGUpO1xuICAgICAgICBpZiAobnVsbCA9PSByKSByZXR1cm4gbjtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9maWVsZEluZGV4R2V0QXJyYXlTZWdtZW50KHQpO1xuICAgICAgICBpZiAobnVsbCAhPSBpKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gZS5kYXRhLmZpZWxkKGkuZmllbGRQYXRoKTtcbiAgICAgICAgICAgIGlmIChpc0FycmF5KHMpKSBmb3IgKGNvbnN0IGkgb2Ygcy5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkgbiA9IG4uYWRkKG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeSh0LmluZGV4SWQsIGUua2V5LCB0aGlzLlBuKGkpLCByKSk7XG4gICAgICAgIH0gZWxzZSBuID0gbi5hZGQobmV3IF9fUFJJVkFURV9JbmRleEVudHJ5KHQuaW5kZXhJZCwgZS5rZXksIEVlLCByKSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgYnkgZGVsZXRpbmcgZW50cmllc1xuICAgICAqIHRoYXQgYXJlIG5vIGxvbmdlciByZWZlcmVuY2VkIGluIGBuZXdFbnRyaWVzYCBhbmQgYWRkaW5nIGFsbCBuZXdseSBhZGRlZFxuICAgICAqIGVudHJpZXMuXG4gICAgICovICAgIHBuKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiSW5kZXhNYW5hZ2VyXCIsIFwiVXBkYXRpbmcgaW5kZXggZW50cmllcyBmb3IgZG9jdW1lbnQgJyVzJ1wiLCB0LmtleSk7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9kaWZmU29ydGVkU2V0cyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gZS5nZXRJdGVyYXRvcigpLCBvID0gdC5nZXRJdGVyYXRvcigpO1xuICAgICAgICAgICAgbGV0IF8gPSBfX1BSSVZBVEVfYWR2YW5jZUl0ZXJhdG9yKHMpLCBhID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihvKTtcbiAgICAgICAgICAgIC8vIFdhbGsgdGhyb3VnaCB0aGUgdHdvIHNldHMgYXQgdGhlIHNhbWUgdGltZSwgdXNpbmcgdGhlIG9yZGVyaW5nIGRlZmluZWQgYnlcbiAgICAgICAgICAgIC8vIGBjb21wYXJhdG9yYC5cbiAgICAgICAgICAgIGZvciAoO18gfHwgYTsgKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSAhMSwgdCA9ICExO1xuICAgICAgICAgICAgICAgIGlmIChfICYmIGEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IG4oXywgYSk7XG4gICAgICAgICAgICAgICAgICAgIHIgPCAwID8gXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHdhcyByZW1vdmVkIGlmIHRoZSBuZXh0IGVsZW1lbnQgaW4gb3VyIG9yZGVyZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gd2Fsa3Rocm91Z2ggaXMgb25seSBpbiBgYmVmb3JlYC5cbiAgICAgICAgICAgICAgICAgICAgdCA9ICEwIDogciA+IDAgJiYgKFxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgYWRkZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZCB3YWxrdGhyb3VnaFxuICAgICAgICAgICAgICAgICAgICAvLyBpcyBvbmx5IGluIGBhZnRlcmAuXG4gICAgICAgICAgICAgICAgICAgIGUgPSAhMCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIG51bGwgIT0gXyA/IHQgPSAhMCA6IGUgPSAhMDtcbiAgICAgICAgICAgICAgICBlID8gKHIoYSksIGEgPSBfX1BSSVZBVEVfYWR2YW5jZUl0ZXJhdG9yKG8pKSA6IHQgPyAoaShfKSwgXyA9IF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3IocykpIDogKF8gPSBfX1BSSVZBVEVfYWR2YW5jZUl0ZXJhdG9yKHMpLCBcbiAgICAgICAgICAgICAgICBhID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihvKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0ociwgaSwgX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yLCAoXG4gICAgICAgIC8qIG9uQWRkPSAqLyByID0+IHtcbiAgICAgICAgICAgIHMucHVzaCh0aGlzLnluKGUsIHQsIG4sIHIpKTtcbiAgICAgICAgfSksIChcbiAgICAgICAgLyogb25SZW1vdmU9ICovIHIgPT4ge1xuICAgICAgICAgICAgcy5wdXNoKHRoaXMud24oZSwgdCwgbiwgcikpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHMpO1xuICAgIH1cbiAgICBtbihlKSB7XG4gICAgICAgIGxldCB0ID0gMTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9pbmRleFN0YXRlU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogXCJzZXF1ZW5jZU51bWJlckluZGV4XCIsXG4gICAgICAgICAgICByZXZlcnNlOiAhMCxcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS51cHBlckJvdW5kKFsgdGhpcy51aWQsIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIF0pXG4gICAgICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgci5kb25lKCksIHQgPSBuLnNlcXVlbmNlTnVtYmVyICsgMTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIG5ldyBzZXQgb2YgSURCIHJhbmdlcyB0aGF0IHNwbGl0cyB0aGUgZXhpc3RpbmcgcmFuZ2UgYW5kIGV4Y2x1ZGVzXG4gICAgICogYW55IHZhbHVlcyB0aGF0IG1hdGNoIHRoZSBgbm90SW5WYWx1ZWAgZnJvbSB0aGVzZSByYW5nZXMuIEFzIGFuIGV4YW1wbGUsXG4gICAgICogJ1tmb28gPiAyICYmIGZvbyAhPSAzXWAgYmVjb21lcyAgYFtmb28gPiAyICYmIDwgMywgZm9vID4gM11gLlxuICAgICAqLyAgICBjcmVhdGVSYW5nZShlLCB0LCBuKSB7XG4gICAgICAgIC8vIFRoZSBub3RJbiB2YWx1ZXMgbmVlZCB0byBiZSBzb3J0ZWQgYW5kIHVuaXF1ZSBzbyB0aGF0IHdlIGNhbiByZXR1cm4gYVxuICAgICAgICAvLyBzb3J0ZWQgc2V0IG9mIG5vbi1vdmVybGFwcGluZyByYW5nZXMuXG4gICAgICAgIG4gPSBuLnNvcnQoKChlLCB0KSA9PiBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgdCkpKS5maWx0ZXIoKChlLCB0LCBuKSA9PiAhdCB8fCAwICE9PSBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgblt0IC0gMV0pKSk7XG4gICAgICAgIGNvbnN0IHIgPSBbXTtcbiAgICAgICAgci5wdXNoKGUpO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2Ygbikge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcihpLCBlKSwgcyA9IF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcihpLCB0KTtcbiAgICAgICAgICAgIGlmICgwID09PSBuKSBcbiAgICAgICAgICAgIC8vIGBub3RJblZhbHVlYCBpcyB0aGUgbG93ZXIgYm91bmQuIFdlIHRoZXJlZm9yZSBuZWVkIHRvIHJhaXNlIHRoZSBib3VuZFxuICAgICAgICAgICAgLy8gdG8gdGhlIG5leHQgdmFsdWUuXG4gICAgICAgICAgICByWzBdID0gZS5KdCgpOyBlbHNlIGlmIChuID4gMCAmJiBzIDwgMCkgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgaXMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIHIucHVzaChpKSwgci5wdXNoKGkuSnQoKSk7IGVsc2UgaWYgKHMgPiAwKSBcbiAgICAgICAgICAgIC8vIGBub3RJblZhbHVlYCAoYW5kIGFsbCBmb2xsb3dpbmcgdmFsdWVzKSBhcmUgb3V0IG9mIHRoZSByYW5nZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgci5wdXNoKHQpO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgci5sZW5ndGg7IGUgKz0gMikge1xuICAgICAgICAgICAgLy8gSWYgd2UgZW5jb3VudGVyIHR3byBib3VuZHMgdGhhdCB3aWxsIGNyZWF0ZSBhbiB1bm1hdGNoYWJsZSBrZXkgcmFuZ2UsXG4gICAgICAgICAgICAvLyB0aGVuIHdlIHJldHVybiBhbiBlbXB0eSBzZXQgb2Yga2V5IHJhbmdlcy5cbiAgICAgICAgICAgIGlmICh0aGlzLlNuKHJbZV0sIHJbZSArIDFdKSkgcmV0dXJuIFtdO1xuICAgICAgICAgICAgY29uc3QgdCA9IFsgcltlXS5pbmRleElkLCB0aGlzLnVpZCwgcltlXS5hcnJheVZhbHVlLCByW2VdLmRpcmVjdGlvbmFsVmFsdWUsIEVlLCBbXSBdLCBuID0gWyByW2UgKyAxXS5pbmRleElkLCB0aGlzLnVpZCwgcltlICsgMV0uYXJyYXlWYWx1ZSwgcltlICsgMV0uZGlyZWN0aW9uYWxWYWx1ZSwgRWUsIFtdIF07XG4gICAgICAgICAgICBpLnB1c2goSURCS2V5UmFuZ2UuYm91bmQodCwgbikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgICBTbihlLCB0KSB7XG4gICAgICAgIC8vIElmIGxvd2VyIGJvdW5kIGlzIGdyZWF0ZXIgdGhhbiB0aGUgdXBwZXIgYm91bmQsIHRoZW4gdGhlIGtleVxuICAgICAgICAvLyByYW5nZSBjYW4gbmV2ZXIgYmUgbWF0Y2hlZC5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcihlLCB0KSA+IDA7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZEluZGV4ZXMoZSwgdCkubmV4dChfX1BSSVZBVEVfZ2V0TWluT2Zmc2V0RnJvbUZpZWxkSW5kZXhlcyk7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldChlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UubWFwQXJyYXkodGhpcy5hbih0KSwgKHQgPT4gdGhpcy51bihlLCB0KS5uZXh0KChlID0+IGUgfHwgZmFpbCgpKSkpKS5uZXh0KF9fUFJJVkFURV9nZXRNaW5PZmZzZXRGcm9tRmllbGRJbmRleGVzKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBjb2xsZWN0aW9uUGFyZW50c1xuICogZG9jdW1lbnQgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbGxlY3Rpb25QYXJlbnRzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJjb2xsZWN0aW9uUGFyZW50c1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IGVudHJ5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhFbnRyaWVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJpbmRleEVudHJpZXNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBpbmRleCBjb25maWd1cmF0aW9uIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhDb25maWd1cmF0aW9uU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJpbmRleENvbmZpZ3VyYXRpb25cIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBpbmRleCBzdGF0ZSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcImluZGV4U3RhdGVcIik7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRNaW5PZmZzZXRGcm9tRmllbGRJbmRleGVzKGUpIHtcbiAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgwICE9PSBlLmxlbmd0aCk7XG4gICAgbGV0IHQgPSBlWzBdLmluZGV4U3RhdGUub2Zmc2V0LCBuID0gdC5sYXJnZXN0QmF0Y2hJZDtcbiAgICBmb3IgKGxldCByID0gMTsgciA8IGUubGVuZ3RoOyByKyspIHtcbiAgICAgICAgY29uc3QgaSA9IGVbcl0uaW5kZXhTdGF0ZS5vZmZzZXQ7XG4gICAgICAgIF9fUFJJVkFURV9pbmRleE9mZnNldENvbXBhcmF0b3IoaSwgdCkgPCAwICYmICh0ID0gaSksIG4gPCBpLmxhcmdlc3RCYXRjaElkICYmIChuID0gaS5sYXJnZXN0QmF0Y2hJZCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQodC5yZWFkVGltZSwgdC5kb2N1bWVudEtleSwgbik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IGRlID0ge1xuICAgIGRpZFJ1bjogITEsXG4gICAgc2VxdWVuY2VOdW1iZXJzQ29sbGVjdGVkOiAwLFxuICAgIHRhcmdldHNSZW1vdmVkOiAwLFxuICAgIGRvY3VtZW50c1JlbW92ZWQ6IDBcbn07XG5cbmNsYXNzIExydVBhcmFtcyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLy8gV2hlbiB3ZSBhdHRlbXB0IHRvIGNvbGxlY3QsIHdlIHdpbGwgb25seSBkbyBzbyBpZiB0aGUgY2FjaGUgc2l6ZSBpcyBncmVhdGVyIHRoYW4gdGhpc1xuICAgIC8vIHRocmVzaG9sZC4gUGFzc2luZyBgQ09MTEVDVElPTl9ESVNBQkxFRGAgaGVyZSB3aWxsIGNhdXNlIGNvbGxlY3Rpb24gdG8gYWx3YXlzIGJlIHNraXBwZWQuXG4gICAgZSwgXG4gICAgLy8gVGhlIHBlcmNlbnRhZ2Ugb2Ygc2VxdWVuY2UgbnVtYmVycyB0aGF0IHdlIHdpbGwgYXR0ZW1wdCB0byBjb2xsZWN0XG4gICAgdCwgXG4gICAgLy8gQSBjYXAgb24gdGhlIHRvdGFsIG51bWJlciBvZiBzZXF1ZW5jZSBudW1iZXJzIHRoYXQgd2lsbCBiZSBjb2xsZWN0ZWQuIFRoaXMgcHJldmVudHNcbiAgICAvLyB1cyBmcm9tIGNvbGxlY3RpbmcgYSBodWdlIG51bWJlciBvZiBzZXF1ZW5jZSBudW1iZXJzIGlmIHRoZSBjYWNoZSBoYXMgZ3Jvd24gdmVyeSBsYXJnZS5cbiAgICBuKSB7XG4gICAgICAgIHRoaXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCA9IGUsIHRoaXMucGVyY2VudGlsZVRvQ29sbGVjdCA9IHQsIHRoaXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCA9IG47XG4gICAgfVxuICAgIHN0YXRpYyB3aXRoQ2FjaGVTaXplKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMcnVQYXJhbXMoZSwgTHJ1UGFyYW1zLkRFRkFVTFRfQ09MTEVDVElPTl9QRVJDRU5USUxFLCBMcnVQYXJhbXMuREVGQVVMVF9NQVhfU0VRVUVOQ0VfTlVNQkVSU19UT19DT0xMRUNUKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERlbGV0ZSBhIG11dGF0aW9uIGJhdGNoIGFuZCB0aGUgYXNzb2NpYXRlZCBkb2N1bWVudCBtdXRhdGlvbnMuXG4gKiBAcmV0dXJucyBBIFBlcnNpc3RlbmNlUHJvbWlzZSBvZiB0aGUgZG9jdW1lbnQgbXV0YXRpb25zIHRoYXQgd2VyZSByZW1vdmVkLlxuICovXG5mdW5jdGlvbiByZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gZS5zdG9yZShcIm11dGF0aW9uc1wiKSwgaSA9IGUuc3RvcmUoXCJkb2N1bWVudE11dGF0aW9uc1wiKSwgcyA9IFtdLCBvID0gSURCS2V5UmFuZ2Uub25seShuLmJhdGNoSWQpO1xuICAgIGxldCBfID0gMDtcbiAgICBjb25zdCBhID0gci5aKHtcbiAgICAgICAgcmFuZ2U6IG9cbiAgICB9LCAoKGUsIHQsIG4pID0+IChfKyssIG4uZGVsZXRlKCkpKSk7XG4gICAgcy5wdXNoKGEubmV4dCgoKCkgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSBfKTtcbiAgICB9KSkpO1xuICAgIGNvbnN0IHUgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGUgb2Ygbi5tdXRhdGlvbnMpIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25LZXkodCwgZS5rZXkucGF0aCwgbi5iYXRjaElkKTtcbiAgICAgICAgcy5wdXNoKGkuZGVsZXRlKHIpKSwgdS5wdXNoKGUua2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHMpLm5leHQoKCgpID0+IHUpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIGFwcHJveGltYXRlIHNpemUgZm9yIHRoZSBnaXZlbiBkb2N1bWVudC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUoZSkge1xuICAgIGlmICghZSkgcmV0dXJuIDA7XG4gICAgbGV0IHQ7XG4gICAgaWYgKGUuZG9jdW1lbnQpIHQgPSBlLmRvY3VtZW50OyBlbHNlIGlmIChlLnVua25vd25Eb2N1bWVudCkgdCA9IGUudW5rbm93bkRvY3VtZW50OyBlbHNlIHtcbiAgICAgICAgaWYgKCFlLm5vRG9jdW1lbnQpIHRocm93IGZhaWwoKTtcbiAgICAgICAgdCA9IGUubm9Eb2N1bWVudDtcbiAgICB9XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHQpLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBBIG11dGF0aW9uIHF1ZXVlIGZvciBhIHNwZWNpZmljIHVzZXIsIGJhY2tlZCBieSBJbmRleGVkREIuICovIExydVBhcmFtcy5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSA9IDEwLCBcbkxydVBhcmFtcy5ERUZBVUxUX01BWF9TRVFVRU5DRV9OVU1CRVJTX1RPX0NPTExFQ1QgPSAxZTMsIExydVBhcmFtcy5ERUZBVUxUID0gbmV3IExydVBhcmFtcyg0MTk0MzA0MCwgTHJ1UGFyYW1zLkRFRkFVTFRfQ09MTEVDVElPTl9QRVJDRU5USUxFLCBMcnVQYXJhbXMuREVGQVVMVF9NQVhfU0VRVUVOQ0VfTlVNQkVSU19UT19DT0xMRUNUKSwgXG5McnVQYXJhbXMuRElTQUJMRUQgPSBuZXcgTHJ1UGFyYW1zKC0xLCAwLCAwKTtcblxuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYk11dGF0aW9uUXVldWUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBub3JtYWxpemVkIHVzZXJJZCAoZS5nLiBudWxsIFVJRCA9PiBcIlwiIHVzZXJJZCkgdXNlZCB0byBzdG9yZSAvXG4gICAgICogcmV0cmlldmUgbXV0YXRpb25zLlxuICAgICAqL1xuICAgIGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy51c2VySWQgPSBlLCB0aGlzLnNlcmlhbGl6ZXIgPSB0LCB0aGlzLmluZGV4TWFuYWdlciA9IG4sIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSByLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhY2hlcyB0aGUgZG9jdW1lbnQga2V5cyBmb3IgcGVuZGluZyBtdXRhdGlvbiBiYXRjaGVzLiBJZiB0aGUgbXV0YXRpb25cbiAgICAgICAgICogaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIEluZGV4ZWREYiwgdGhlIGNhY2hlZCB2YWx1ZSBtYXkgY29udGludWUgdG9cbiAgICAgICAgICogYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgYmF0Y2gncyBkb2N1bWVudCBrZXlzLiBUbyByZW1vdmUgYSBjYWNoZWQgdmFsdWVcbiAgICAgICAgICogbG9jYWxseSwgYHJlbW92ZUNhY2hlZE11dGF0aW9uS2V5cygpYCBzaG91bGQgYmUgaW52b2tlZCBlaXRoZXIgZGlyZWN0bHlcbiAgICAgICAgICogb3IgdGhyb3VnaCBgcmVtb3ZlTXV0YXRpb25CYXRjaGVzKClgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaXRoIG11bHRpLXRhYiwgd2hlbiB0aGUgcHJpbWFyeSBjbGllbnQgYWNrbm93bGVkZ2VzIG9yIHJlamVjdHMgYSBtdXRhdGlvbixcbiAgICAgICAgICogdGhpcyBjYWNoZSBpcyB1c2VkIGJ5IHNlY29uZGFyeSBjbGllbnRzIHRvIGludmFsaWRhdGUgdGhlIGxvY2FsXG4gICAgICAgICAqIHZpZXcgb2YgdGhlIGRvY3VtZW50cyB0aGF0IHdlcmUgcHJldmlvdXNseSBhZmZlY3RlZCBieSB0aGUgbXV0YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICB0aGlzLmJuID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgbXV0YXRpb24gcXVldWUgZm9yIHRoZSBnaXZlbiB1c2VyLlxuICAgICAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIG11dGF0aW9uIHF1ZXVlLlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHdoZW4gcGVyc2lzdGluZyB0byBJbmRleGVkRGIuXG4gICAgICovICAgIHN0YXRpYyBsdChlLCB0LCBuLCByKSB7XG4gICAgICAgIC8vIFRPRE8obWNnKTogRmlndXJlIG91dCB3aGF0IGNvbnN0cmFpbnRzIHRoZXJlIGFyZSBvbiB1c2VySURzXG4gICAgICAgIC8vIEluIHBhcnRpY3VsYXIsIGFyZSB0aGVyZSBhbnkgcmVzZXJ2ZWQgY2hhcmFjdGVycz8gYXJlIGVtcHR5IGlkcyBhbGxvd2VkP1xuICAgICAgICAvLyBGb3IgdGhlIG1vbWVudCBzdG9yZSB0aGVzZSB0b2dldGhlciBpbiB0aGUgc2FtZSBtdXRhdGlvbnMgdGFibGUgYXNzdW1pbmdcbiAgICAgICAgLy8gdGhhdCBlbXB0eSB1c2VySURzIGFyZW4ndCBhbGxvd2VkLlxuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChcIlwiICE9PSBlLnVpZCk7XG4gICAgICAgIGNvbnN0IGkgPSBlLmlzQXV0aGVudGljYXRlZCgpID8gZS51aWQgOiBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJNdXRhdGlvblF1ZXVlKGksIHQsIG4sIHIpO1xuICAgIH1cbiAgICBjaGVja0VtcHR5KGUpIHtcbiAgICAgICAgbGV0IHQgPSAhMDtcbiAgICAgICAgY29uc3QgbiA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIHRoaXMudXNlcklkLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogXCJ1c2VyTXV0YXRpb25zSW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBuXG4gICAgICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgdCA9ICExLCByLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICB9XG4gICAgYWRkTXV0YXRpb25CYXRjaChlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKSwgcyA9IF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKTtcbiAgICAgICAgLy8gVGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBpbiBDaHJvbWUgKGFuZCBGaXJlZm94KSBkb2VzIG5vdCBoYW5kbGVcbiAgICAgICAgLy8gY29tcG91bmQgaW5kaWNlcyB0aGF0IGluY2x1ZGUgYXV0by1nZW5lcmF0ZWQga2V5cyBjb3JyZWN0bHkuIFRvIGVuc3VyZVxuICAgICAgICAvLyB0aGF0IHRoZSBpbmRleCBlbnRyeSBpcyBhZGRlZCBjb3JyZWN0bHkgaW4gYWxsIGJyb3dzZXJzLCB3ZSBwZXJmb3JtIHR3b1xuICAgICAgICAvLyB3cml0ZXM6IFRoZSBmaXJzdCB3cml0ZSBpcyB1c2VkIHRvIHJldHJpZXZlIHRoZSBuZXh0IGF1dG8tZ2VuZXJhdGVkIEJhdGNoXG4gICAgICAgIC8vIElELCBhbmQgdGhlIHNlY29uZCB3cml0ZSBwb3B1bGF0ZXMgdGhlIGluZGV4IGFuZCBzdG9yZXMgdGhlIGFjdHVhbFxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgICAgLy8gU2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD03MDE5NzJcbiAgICAgICAgLy8gV2Ugd3JpdGUgYW4gZW1wdHkgb2JqZWN0IHRvIG9idGFpbiBrZXlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHMuYWRkKHt9KS5uZXh0KChvID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwibnVtYmVyXCIgPT0gdHlwZW9mIG8pO1xuICAgICAgICAgICAgY29uc3QgXyA9IG5ldyBNdXRhdGlvbkJhdGNoKG8sIHQsIG4sIHIpLCBhID0gZnVuY3Rpb24gX19QUklWQVRFX3RvRGJNdXRhdGlvbkJhdGNoKGUsIHQsIG4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbi5iYXNlTXV0YXRpb25zLm1hcCgodCA9PiB0b011dGF0aW9uKGUuY3QsIHQpKSksIGkgPSBuLm11dGF0aW9ucy5tYXAoKHQgPT4gdG9NdXRhdGlvbihlLmN0LCB0KSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogdCxcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hJZDogbi5iYXRjaElkLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbFdyaXRlVGltZU1zOiBuLmxvY2FsV3JpdGVUaW1lLnRvTWlsbGlzKCksXG4gICAgICAgICAgICAgICAgICAgIGJhc2VNdXRhdGlvbnM6IHIsXG4gICAgICAgICAgICAgICAgICAgIG11dGF0aW9uczogaVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KHRoaXMuc2VyaWFsaXplciwgdGhpcy51c2VySWQsIF8pLCB1ID0gW107XG4gICAgICAgICAgICBsZXQgYyA9IG5ldyBTb3J0ZWRTZXQoKChlLCB0KSA9PiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmNhbm9uaWNhbFN0cmluZygpLCB0LmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvbktleSh0aGlzLnVzZXJJZCwgZS5rZXkucGF0aCwgbyk7XG4gICAgICAgICAgICAgICAgYyA9IGMuYWRkKGUua2V5LnBhdGgucG9wTGFzdCgpKSwgdS5wdXNoKHMucHV0KGEpKSwgdS5wdXNoKGkucHV0KHQsIE8pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHUucHVzaCh0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0KSk7XG4gICAgICAgICAgICB9KSksIGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYm5bb10gPSBfLmtleXMoKTtcbiAgICAgICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IodSkubmV4dCgoKCkgPT4gXykpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGxvb2t1cE11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IGUgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQoZS51c2VySWQgPT09IHRoaXMudXNlcklkKSwgXG4gICAgICAgIF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgZSkpIDogbnVsbCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBkb2N1bWVudCBrZXlzIGZvciB0aGUgbXV0YXRpb24gYmF0Y2ggd2l0aCB0aGUgZ2l2ZW4gYmF0Y2hJZC5cbiAgICAgKiBGb3IgcHJpbWFyeSBjbGllbnRzLCB0aGlzIG1ldGhvZCByZXR1cm5zIGBudWxsYCBhZnRlclxuICAgICAqIGByZW1vdmVNdXRhdGlvbkJhdGNoZXMoKWAgaGFzIGJlZW4gY2FsbGVkLiBTZWNvbmRhcnkgY2xpZW50cyByZXR1cm4gYVxuICAgICAqIGNhY2hlZCByZXN1bHQgdW50aWwgYHJlbW92ZUNhY2hlZE11dGF0aW9uS2V5cygpYCBpcyBpbnZva2VkLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgRG4oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iblt0XSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuYm5bdF0pIDogdGhpcy5sb29rdXBNdXRhdGlvbkJhdGNoKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gZS5rZXlzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm5bdF0gPSBuLCBuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdCArIDEsIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKFsgdGhpcy51c2VySWQsIG4gXSk7XG4gICAgICAgIGxldCBpID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcInVzZXJNdXRhdGlvbnNJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHJcbiAgICAgICAgfSwgKChlLCB0LCByKSA9PiB7XG4gICAgICAgICAgICB0LnVzZXJJZCA9PT0gdGhpcy51c2VySWQgJiYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHQuYmF0Y2hJZCA+PSBuKSwgaSA9IF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgdCkpLCBcbiAgICAgICAgICAgIHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IElEQktleVJhbmdlLnVwcGVyQm91bmQoWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICBsZXQgbiA9IC0xO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogdCxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0sICgoZSwgdCwgcikgPT4ge1xuICAgICAgICAgICAgbiA9IHQuYmF0Y2hJZCwgci5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCAtMSBdLCBbIHRoaXMudXNlcklkLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuRyhcInVzZXJNdXRhdGlvbnNJbmRleFwiLCB0KS5uZXh0KChlID0+IGUubWFwKChlID0+IF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgZSkpKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleShlLCB0KSB7XG4gICAgICAgIC8vIFNjYW4gdGhlIGRvY3VtZW50LW11dGF0aW9uIGluZGV4IHN0YXJ0aW5nIHdpdGggYSBwcmVmaXggc3RhcnRpbmcgd2l0aFxuICAgICAgICAvLyB0aGUgZ2l2ZW4gZG9jdW1lbnRLZXkuXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0aGlzLnVzZXJJZCwgdC5wYXRoKSwgciA9IElEQktleVJhbmdlLmxvd2VyQm91bmQobiksIGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE11dGF0aW9uc1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgcmFuZ2U6IHJcbiAgICAgICAgfSwgKChuLCByLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbbywgXywgYV0gPSBuLCB1ID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChfKTtcbiAgICAgICAgICAgIC8vIE9ubHkgY29uc2lkZXIgcm93cyBtYXRjaGluZyBleGFjdGx5IHRoZSBzcGVjaWZpYyBrZXkgb2ZcbiAgICAgICAgICAgIC8vIGludGVyZXN0LiBOb3RlIHRoYXQgYmVjYXVzZSB3ZSBvcmRlciBieSBwYXRoIGZpcnN0LCBhbmQgd2VcbiAgICAgICAgICAgIC8vIG9yZGVyIHRlcm1pbmF0b3JzIGJlZm9yZSBwYXRoIHNlcGFyYXRvcnMsIHdlJ2xsIGVuY291bnRlciBhbGxcbiAgICAgICAgICAgIC8vIHRoZSBpbmRleCByb3dzIGZvciBkb2N1bWVudEtleSBjb250aWd1b3VzbHkuIEluIHBhcnRpY3VsYXIsIGFsbFxuICAgICAgICAgICAgLy8gdGhlIHJvd3MgZm9yIGRvY3VtZW50S2V5IHdpbGwgb2NjdXIgYmVmb3JlIGFueSByb3dzIGZvclxuICAgICAgICAgICAgLy8gZG9jdW1lbnRzIG5lc3RlZCBpbiBhIHN1YmNvbGxlY3Rpb24gYmVuZWF0aCBkb2N1bWVudEtleSBzbyB3ZVxuICAgICAgICAgICAgLy8gY2FuIHN0b3AgYXMgc29vbiBhcyB3ZSBoaXQgYW55IHN1Y2ggcm93LlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8gPT09IHRoaXMudXNlcklkICYmIHQucGF0aC5pc0VxdWFsKHUpKSBcbiAgICAgICAgICAgIC8vIExvb2sgdXAgdGhlIG11dGF0aW9uIGJhdGNoIGluIHRoZSBzdG9yZS5cbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuZ2V0KGEpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUudXNlcklkID09PSB0aGlzLnVzZXJJZCksIGkucHVzaChfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHMuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleXMoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpO1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25QcmVmaXhGb3JQYXRoKHRoaXMudXNlcklkLCB0LnBhdGgpLCBzID0gSURCS2V5UmFuZ2UubG93ZXJCb3VuZChpKSwgbyA9IF9fUFJJVkFURV9kb2N1bWVudE11dGF0aW9uc1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgICAgIHJhbmdlOiBzXG4gICAgICAgICAgICB9LCAoKGUsIHIsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBbcywgbywgX10gPSBlLCBhID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChvKTtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IGNvbnNpZGVyIHJvd3MgbWF0Y2hpbmcgZXhhY3RseSB0aGUgc3BlY2lmaWMga2V5IG9mXG4gICAgICAgICAgICAgICAgLy8gaW50ZXJlc3QuIE5vdGUgdGhhdCBiZWNhdXNlIHdlIG9yZGVyIGJ5IHBhdGggZmlyc3QsIGFuZCB3ZVxuICAgICAgICAgICAgICAgIC8vIG9yZGVyIHRlcm1pbmF0b3JzIGJlZm9yZSBwYXRoIHNlcGFyYXRvcnMsIHdlJ2xsIGVuY291bnRlciBhbGxcbiAgICAgICAgICAgICAgICAvLyB0aGUgaW5kZXggcm93cyBmb3IgZG9jdW1lbnRLZXkgY29udGlndW91c2x5LiBJbiBwYXJ0aWN1bGFyLCBhbGxcbiAgICAgICAgICAgICAgICAvLyB0aGUgcm93cyBmb3IgZG9jdW1lbnRLZXkgd2lsbCBvY2N1ciBiZWZvcmUgYW55IHJvd3MgZm9yXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzIG5lc3RlZCBpbiBhIHN1YmNvbGxlY3Rpb24gYmVuZWF0aCBkb2N1bWVudEtleSBzbyB3ZVxuICAgICAgICAgICAgICAgIC8vIGNhbiBzdG9wIGFzIHNvb24gYXMgd2UgaGl0IGFueSBzdWNoIHJvdy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9PT0gdGhpcy51c2VySWQgJiYgdC5wYXRoLmlzRXF1YWwoYSkgPyBuID0gbi5hZGQoXykgOiBpLmRvbmUoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHIucHVzaChvKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihyKS5uZXh0KCgoKSA9PiB0aGlzLnZuKGUsIG4pKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ1F1ZXJ5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQucGF0aCwgciA9IG4ubGVuZ3RoICsgMSwgaSA9IF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25QcmVmaXhGb3JQYXRoKHRoaXMudXNlcklkLCBuKSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoaSk7XG4gICAgICAgIC8vIENvbGxlY3QgdXAgdW5pcXVlIGJhdGNoSURzIGVuY291bnRlcmVkIGR1cmluZyBhIHNjYW4gb2YgdGhlIGluZGV4LiBVc2UgYVxuICAgICAgICAvLyBTb3J0ZWRTZXQgdG8gYWNjdW11bGF0ZSBiYXRjaCBJRHMgc28gdGhleSBjYW4gYmUgdHJhdmVyc2VkIGluIG9yZGVyIGluIGFcbiAgICAgICAgLy8gc2NhbiBvZiB0aGUgbWFpbiB0YWJsZS5cbiAgICAgICAgbGV0IG8gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE11dGF0aW9uc1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgcmFuZ2U6IHNcbiAgICAgICAgfSwgKChlLCB0LCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbcywgXywgYV0gPSBlLCB1ID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChfKTtcbiAgICAgICAgICAgIHMgPT09IHRoaXMudXNlcklkICYmIG4uaXNQcmVmaXhPZih1KSA/IFxuICAgICAgICAgICAgLy8gUm93cyB3aXRoIGRvY3VtZW50IGtleXMgbW9yZSB0aGFuIG9uZSBzZWdtZW50IGxvbmdlciB0aGFuIHRoZVxuICAgICAgICAgICAgLy8gcXVlcnkgcGF0aCBjYW4ndCBiZSBtYXRjaGVzLiBGb3IgZXhhbXBsZSwgYSBxdWVyeSBvbiAncm9vbXMnXG4gICAgICAgICAgICAvLyBjYW4ndCBtYXRjaCB0aGUgZG9jdW1lbnQgL3Jvb21zL2FiYy9tZXNzYWdlcy94eXguXG4gICAgICAgICAgICAvLyBUT0RPKG1jZyk6IHdlJ2xsIG5lZWQgYSBkaWZmZXJlbnQgc2Nhbm5lciB3aGVuIHdlIGltcGxlbWVudFxuICAgICAgICAgICAgLy8gYW5jZXN0b3IgcXVlcmllcy5cbiAgICAgICAgICAgIHUubGVuZ3RoID09PSByICYmIChvID0gby5hZGQoYSkpIDogaS5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0aGlzLnZuKGUsIG8pKSk7XG4gICAgfVxuICAgIHZuKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdLCByID0gW107XG4gICAgICAgIC8vIFRPRE8ocm9ja3dvb2QpOiBJbXBsZW1lbnQgdGhpcyB1c2luZyBpdGVyYXRlLlxuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHIucHVzaChfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuZ2V0KHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChudWxsID09PSBlKSB0aHJvdyBmYWlsKCk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS51c2VySWQgPT09IHRoaXMudXNlcklkKSwgbi5wdXNoKF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgZSkpO1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihyKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIHJlbW92ZU11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlTXV0YXRpb25CYXRjaChlLnVlLCB0aGlzLnVzZXJJZCwgdCkubmV4dCgobiA9PiAoZS5hZGRPbkNvbW1pdHRlZExpc3RlbmVyKCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLkNuKHQuYmF0Y2hJZCk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gobiwgKHQgPT4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5tYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgdGhlIGNhY2hlZCBrZXlzIGZvciBhIG11dGF0aW9uIGJhdGNoLiBUaGlzIG1ldGhvZCBzaG91bGQgYmVcbiAgICAgKiBjYWxsZWQgYnkgc2Vjb25kYXJ5IGNsaWVudHMgYWZ0ZXIgdGhleSBwcm9jZXNzIG11dGF0aW9uIHVwZGF0ZXMuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgZG9lcyBub3QgaGF2ZSB0byBiZSBjYWxsZWQgZnJvbSBwcmltYXJ5IGNsaWVudHMgYXNcbiAgICAgKiB0aGUgY29ycmVzcG9uZGluZyBjYWNoZSBlbnRyaWVzIGFyZSBjbGVhcmVkIHdoZW4gYW4gYWNrbm93bGVkZ2VkIG9yXG4gICAgICogcmVqZWN0ZWQgYmF0Y2ggaXMgcmVtb3ZlZCBmcm9tIHRoZSBtdXRhdGlvbiBxdWV1ZS5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5XG4gICAgQ24oZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5ibltlXTtcbiAgICB9XG4gICAgcGVyZm9ybUNvbnNpc3RlbmN5Q2hlY2soZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0VtcHR5KGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgaWYgKCF0KSByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGFyZSBubyBlbnRyaWVzIGluIHRoZSBkb2N1bWVudE11dGF0aW9ucyBpbmRleCBpZlxuICAgICAgICAgICAgLy8gdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoXG4gICAgICAgICAgICAvKipcbiAqIENyZWF0ZXMgYSBbdXNlcklkXSBrZXkgZm9yIHVzZSBpbiB0aGUgRGJEb2N1bWVudE11dGF0aW9ucyBpbmRleCB0byBpdGVyYXRlXG4gKiBvdmVyIGFsbCBvZiBhIHVzZXIncyBkb2N1bWVudCBtdXRhdGlvbnMuXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25QcmVmaXhGb3JVc2VyKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWyBlIF07XG4gICAgICAgICAgICB9KHRoaXMudXNlcklkKSksIHIgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgICAgICByYW5nZTogblxuICAgICAgICAgICAgfSwgKChlLCB0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVbMF0gPT09IHRoaXMudXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKGVbMV0pO1xuICAgICAgICAgICAgICAgICAgICByLnB1c2godCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIG4uZG9uZSgpO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgwID09PSByLmxlbmd0aCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY29udGFpbnNLZXkoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uUXVldWVDb250YWluc0tleShlLCB0aGlzLnVzZXJJZCwgdCk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkgKHN0YXRlIGlzIGhlbGQgaW4gbWVtb3J5IGluIG90aGVyIGNsaWVudHMpLlxuICAgIC8qKiBSZXR1cm5zIHRoZSBtdXRhdGlvbiBxdWV1ZSdzIG1ldGFkYXRhIGZyb20gSW5kZXhlZERiLiAqL1xuICAgIEZuKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlc1N0b3JlKGUpLmdldCh0aGlzLnVzZXJJZCkubmV4dCgoZSA9PiBlIHx8IHtcbiAgICAgICAgICAgIHVzZXJJZDogdGhpcy51c2VySWQsXG4gICAgICAgICAgICBsYXN0QWNrbm93bGVkZ2VkQmF0Y2hJZDogLTEsXG4gICAgICAgICAgICBsYXN0U3RyZWFtVG9rZW46IFwiXCJcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBtdXRhdGlvbiBxdWV1ZSBmb3IgdGhlIGdpdmVuIHVzZXIgY29udGFpbnMgYSBwZW5kaW5nXG4gKiAgICAgICAgIG11dGF0aW9uIGZvciB0aGUgZ2l2ZW4ga2V5LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlQ29udGFpbnNLZXkoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0LCBuLnBhdGgpLCBpID0gclsxXSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQocik7XG4gICAgbGV0IG8gPSAhMTtcbiAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgIHJhbmdlOiBzLFxuICAgICAgICBZOiAhMFxuICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICBjb25zdCBbcywgXywgLypiYXRjaElEKi8gYV0gPSBlO1xuICAgICAgICBzID09PSB0ICYmIF8gPT09IGkgJiYgKG8gPSAhMCksIHIuZG9uZSgpO1xuICAgIH0pKS5uZXh0KCgoKSA9PiBvKSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYW55IG11dGF0aW9uIHF1ZXVlIGNvbnRhaW5zIHRoZSBnaXZlbiBkb2N1bWVudC4gKi9cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvbnMgb2JqZWN0IHN0b3JlLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJtdXRhdGlvbnNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJkb2N1bWVudE11dGF0aW9uc1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIG11dGF0aW9uUXVldWVzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZXNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcIm11dGF0aW9uUXVldWVzXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIE9mZnNldCB0byBlbnN1cmUgbm9uLW92ZXJsYXBwaW5nIHRhcmdldCBpZHMuICovXG4vKipcbiAqIEdlbmVyYXRlcyBtb25vdG9uaWNhbGx5IGluY3JlYXNpbmcgdGFyZ2V0IElEcyBmb3Igc2VuZGluZyB0YXJnZXRzIHRvIHRoZVxuICogd2F0Y2ggc3RyZWFtLlxuICpcbiAqIFRoZSBjbGllbnQgY29uc3RydWN0cyB0d28gZ2VuZXJhdG9ycywgb25lIGZvciB0aGUgdGFyZ2V0IGNhY2hlLCBhbmQgb25lIGZvclxuICogZm9yIHRoZSBzeW5jIGVuZ2luZSAodG8gZ2VuZXJhdGUgbGltYm8gZG9jdW1lbnRzIHRhcmdldHMpLiBUaGVzZVxuICogZ2VuZXJhdG9ycyBwcm9kdWNlIG5vbi1vdmVybGFwcGluZyBJRHMgKGJ5IHVzaW5nIGV2ZW4gYW5kIG9kZCBJRHNcbiAqIHJlc3BlY3RpdmVseSkuXG4gKlxuICogQnkgc2VwYXJhdGluZyB0aGUgdGFyZ2V0IElEIHNwYWNlLCB0aGUgcXVlcnkgY2FjaGUgY2FuIGdlbmVyYXRlIHRhcmdldCBJRHNcbiAqIHRoYXQgcGVyc2lzdCBhY3Jvc3MgY2xpZW50IHJlc3RhcnRzLCB3aGlsZSBzeW5jIGVuZ2luZSBjYW4gaW5kZXBlbmRlbnRseVxuICogZ2VuZXJhdGUgaW4tbWVtb3J5IHRhcmdldCBJRHMgdGhhdCBhcmUgdHJhbnNpZW50IGFuZCBjYW4gYmUgcmV1c2VkIGFmdGVyIGFcbiAqIHJlc3RhcnQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLk1uID0gZTtcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTW4gKz0gMiwgdGhpcy5NbjtcbiAgICB9XG4gICAgc3RhdGljIHhuKCkge1xuICAgICAgICAvLyBUaGUgdGFyZ2V0IGNhY2hlIGdlbmVyYXRvciBtdXN0IHJldHVybiAnMicgaW4gaXRzIGZpcnN0IGNhbGwgdG8gYG5leHQoKWBcbiAgICAgICAgLy8gYXMgdGhlcmUgaXMgbm8gZGlmZmVyZW50aWF0aW9uIGluIHRoZSBwcm90b2NvbCBsYXllciBiZXR3ZWVuIGFuIHVuc2V0XG4gICAgICAgIC8vIG51bWJlciBhbmQgdGhlIG51bWJlciAnMCcuIElmIHdlIHdlcmUgdG8gc2VudCBhIHRhcmdldCB3aXRoIHRhcmdldCBJRFxuICAgICAgICAvLyAnMCcsIHRoZSBiYWNrZW5kIHdvdWxkIGNvbnNpZGVyIGl0IHVuc2V0IGFuZCByZXBsYWNlIGl0IHdpdGggaXRzIG93biBJRC5cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IoMCk7XG4gICAgfVxuICAgIHN0YXRpYyBPbigpIHtcbiAgICAgICAgLy8gU3luYyBlbmdpbmUgYXNzaWducyB0YXJnZXQgSURzIGZvciBsaW1ibyBkb2N1bWVudCBkZXRlY3Rpb24uXG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yKC0xKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJUYXJnZXRDYWNoZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gZSwgdGhpcy5zZXJpYWxpemVyID0gdDtcbiAgICB9XG4gICAgLy8gUE9SVElORyBOT1RFOiBXZSBkb24ndCBjYWNoZSBnbG9iYWwgbWV0YWRhdGEgZm9yIHRoZSB0YXJnZXQgY2FjaGUsIHNpbmNlXG4gICAgLy8gc29tZSBvZiBpdCAoaW4gcGFydGljdWxhciBgaGlnaGVzdFRhcmdldElkYCkgY2FuIGJlIG1vZGlmaWVkIGJ5IHNlY29uZGFyeVxuICAgIC8vIHRhYnMuIFdlIGNvdWxkIHBlcmhhcHMgYmUgbW9yZSBncmFudWxhciAoYW5kIGUuZy4gc3RpbGwgY2FjaGVcbiAgICAvLyBgbGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbmAgaW4gbWVtb3J5KSBidXQgZm9yIHNpbXBsaWNpdHkgd2UgY3VycmVudGx5IGdvXG4gICAgLy8gdG8gSW5kZXhlZERiIHdoZW5ldmVyIHdlIG5lZWQgdG8gcmVhZCBtZXRhZGF0YS4gV2UgY2FuIHJldmlzaXQgaWYgaXQgdHVybnNcbiAgICAvLyBvdXQgdG8gaGF2ZSBhIG1lYW5pbmdmdWwgcGVyZm9ybWFuY2UgaW1wYWN0LlxuICAgIGFsbG9jYXRlVGFyZ2V0SWQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ObihlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yKHQuaGlnaGVzdFRhcmdldElkKTtcbiAgICAgICAgICAgIHJldHVybiB0LmhpZ2hlc3RUYXJnZXRJZCA9IG4ubmV4dCgpLCB0aGlzLkJuKGUsIHQpLm5leHQoKCgpID0+IHQuaGlnaGVzdFRhcmdldElkKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLk5uKGUpLm5leHQoKGUgPT4gU25hcHNob3RWZXJzaW9uLmZyb21UaW1lc3RhbXAobmV3IFRpbWVzdGFtcChlLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24uc2Vjb25kcywgZS5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uLm5hbm9zZWNvbmRzKSkpKTtcbiAgICB9XG4gICAgZ2V0SGlnaGVzdFNlcXVlbmNlTnVtYmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTm4oZSkubmV4dCgoZSA9PiBlLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlcikpO1xuICAgIH1cbiAgICBzZXRUYXJnZXRzTWV0YWRhdGEoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5ObihlKS5uZXh0KChyID0+IChyLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IHQsIG4gJiYgKHIubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbiA9IG4udG9UaW1lc3RhbXAoKSksIFxuICAgICAgICB0ID4gci5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgJiYgKHIuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyID0gdCksIHRoaXMuQm4oZSwgcikpKSk7XG4gICAgfVxuICAgIGFkZFRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5MbihlLCB0KS5uZXh0KCgoKSA9PiB0aGlzLk5uKGUpLm5leHQoKG4gPT4gKG4udGFyZ2V0Q291bnQgKz0gMSwgdGhpcy5rbih0LCBuKSwgXG4gICAgICAgIHRoaXMuQm4oZSwgbikpKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlVGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxuKGUsIHQpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgdC50YXJnZXRJZCkubmV4dCgoKCkgPT4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5kZWxldGUodC50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiB0aGlzLk5uKGUpKSkubmV4dCgodCA9PiAoX19QUklWQVRFX2hhcmRBc3NlcnQodC50YXJnZXRDb3VudCA+IDApLCBcbiAgICAgICAgdC50YXJnZXRDb3VudCAtPSAxLCB0aGlzLkJuKGUsIHQpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcm9wcyBhbnkgdGFyZ2V0cyB3aXRoIHNlcXVlbmNlIG51bWJlciBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHVwcGVyIGJvdW5kLCBleGNlcHRpbmcgdGhvc2VcbiAgICAgKiBwcmVzZW50IGluIGBhY3RpdmVUYXJnZXRJZHNgLiBEb2N1bWVudCBhc3NvY2lhdGlvbnMgZm9yIHRoZSByZW1vdmVkIHRhcmdldHMgYXJlIGFsc28gcmVtb3ZlZC5cbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGFyZ2V0cyByZW1vdmVkLlxuICAgICAqLyAgICByZW1vdmVUYXJnZXRzKGUsIHQsIG4pIHtcbiAgICAgICAgbGV0IHIgPSAwO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLlooKChzLCBvKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBfID0gX19QUklWQVRFX2Zyb21EYlRhcmdldChvKTtcbiAgICAgICAgICAgIF8uc2VxdWVuY2VOdW1iZXIgPD0gdCAmJiBudWxsID09PSBuLmdldChfLnRhcmdldElkKSAmJiAocisrLCBpLnB1c2godGhpcy5yZW1vdmVUYXJnZXREYXRhKGUsIF8pKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKSkpLm5leHQoKCgpID0+IHIpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbCBwcm92aWRlZCBmdW5jdGlvbiB3aXRoIGVhY2ggYFRhcmdldERhdGFgIHRoYXQgd2UgaGF2ZSBjYWNoZWQuXG4gICAgICovICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5aKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9mcm9tRGJUYXJnZXQobik7XG4gICAgICAgICAgICB0KHIpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIE5uKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9nbG9iYWxUYXJnZXRTdG9yZShlKS5nZXQoXCJ0YXJnZXRHbG9iYWxLZXlcIikubmV4dCgoZSA9PiAoX19QUklWQVRFX2hhcmRBc3NlcnQobnVsbCAhPT0gZSksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICBCbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZ2xvYmFsVGFyZ2V0U3RvcmUoZSkucHV0KFwidGFyZ2V0R2xvYmFsS2V5XCIsIHQpO1xuICAgIH1cbiAgICBMbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLnB1dChfX1BSSVZBVEVfdG9EYlRhcmdldCh0aGlzLnNlcmlhbGl6ZXIsIHQpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW4tcGxhY2UgdXBkYXRlcyB0aGUgcHJvdmlkZWQgbWV0YWRhdGEgdG8gYWNjb3VudCBmb3IgdmFsdWVzIGluIHRoZSBnaXZlblxuICAgICAqIFRhcmdldERhdGEuIFNhdmluZyBpcyBkb25lIHNlcGFyYXRlbHkuIFJldHVybnMgdHJ1ZSBpZiB0aGVyZSB3ZXJlIGFueVxuICAgICAqIGNoYW5nZXMgdG8gdGhlIG1ldGFkYXRhLlxuICAgICAqLyAgICBrbihlLCB0KSB7XG4gICAgICAgIGxldCBuID0gITE7XG4gICAgICAgIHJldHVybiBlLnRhcmdldElkID4gdC5oaWdoZXN0VGFyZ2V0SWQgJiYgKHQuaGlnaGVzdFRhcmdldElkID0gZS50YXJnZXRJZCwgbiA9ICEwKSwgXG4gICAgICAgIGUuc2VxdWVuY2VOdW1iZXIgPiB0LmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciAmJiAodC5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgPSBlLnNlcXVlbmNlTnVtYmVyLCBcbiAgICAgICAgbiA9ICEwKSwgbjtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0Q291bnQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ObihlKS5uZXh0KChlID0+IGUudGFyZ2V0Q291bnQpKTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIC8vIEl0ZXJhdGluZyBieSB0aGUgY2Fub25pY2FsSWQgbWF5IHlpZWxkIG1vcmUgdGhhbiBvbmUgcmVzdWx0IGJlY2F1c2VcbiAgICAgICAgLy8gY2Fub25pY2FsSWQgdmFsdWVzIGFyZSBub3QgcmVxdWlyZWQgdG8gYmUgdW5pcXVlIHBlciB0YXJnZXQuIFRoaXMgcXVlcnlcbiAgICAgICAgLy8gZGVwZW5kcyBvbiB0aGUgcXVlcnlUYXJnZXRzIGluZGV4IHRvIGJlIGVmZmljaWVudC5cbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldCh0KSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgbiwgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIF0sIFsgbiwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICBsZXQgaSA9IG51bGw7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgcmFuZ2U6IHIsXG4gICAgICAgICAgICBpbmRleDogXCJxdWVyeVRhcmdldHNJbmRleFwiXG4gICAgICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9mcm9tRGJUYXJnZXQobik7XG4gICAgICAgICAgICAvLyBBZnRlciBmaW5kaW5nIGEgcG90ZW50aWFsIG1hdGNoLCBjaGVjayB0aGF0IHRoZSB0YXJnZXQgaXNcbiAgICAgICAgICAgIC8vIGFjdHVhbGx5IGVxdWFsIHRvIHRoZSByZXF1ZXN0ZWQgdGFyZ2V0LlxuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX3RhcmdldEVxdWFscyh0LCBzLnRhcmdldCkgJiYgKGkgPSBzLCByLmRvbmUoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGFkZE1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIHJldmVyc2UgaW5kZXggKGRvY3VtZW50c1RhcmdldHMpIGlzIG1haW50YWluZWQgYnlcbiAgICAgICAgLy8gSW5kZXhlZERiLlxuICAgICAgICBjb25zdCByID0gW10sIGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0LnBhdGgpO1xuICAgICAgICAgICAgci5wdXNoKGkucHV0KHtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogbixcbiAgICAgICAgICAgICAgICBwYXRoOiBzXG4gICAgICAgICAgICB9KSksIHIucHVzaCh0aGlzLnJlZmVyZW5jZURlbGVnYXRlLmFkZFJlZmVyZW5jZShlLCBuLCB0KSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3Iocik7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIHJldmVyc2UgaW5kZXggKGRvY3VtZW50c1RhcmdldHMpIGlzIG1haW50YWluZWQgYnlcbiAgICAgICAgLy8gSW5kZXhlZERiLlxuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0LnBhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKFsgci5kZWxldGUoWyBuLCBpIF0pLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZShlLCBuLCB0KSBdKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdCBdLCBbIHQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIG4uZGVsZXRlKHIpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5ib3VuZChbIHQgXSwgWyB0ICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCksIHIgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKTtcbiAgICAgICAgbGV0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgcmV0dXJuIHIuWih7XG4gICAgICAgICAgICByYW5nZTogbixcbiAgICAgICAgICAgIFk6ICEwXG4gICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoZVsxXSksIHMgPSBuZXcgRG9jdW1lbnRLZXkocik7XG4gICAgICAgICAgICBpID0gaS5hZGQocyk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoKSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgbiBdLCBbIF9fUFJJVkFURV9pbW1lZGlhdGVTdWNjZXNzb3IobikgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50VGFyZ2V0c0luZGV4XCIsXG4gICAgICAgICAgICBZOiAhMCxcbiAgICAgICAgICAgIHJhbmdlOiByXG4gICAgICAgIH0sICgoW2UsIHRdLCBuLCByKSA9PiB7XG4gICAgICAgICAgICAvLyBIYXZpbmcgYSBzZW50aW5lbCByb3cgZm9yIGEgZG9jdW1lbnQgZG9lcyBub3QgY291bnQgYXMgY29udGFpbmluZyB0aGF0IGRvY3VtZW50O1xuICAgICAgICAgICAgLy8gRm9yIHRoZSB0YXJnZXQgY2FjaGUsIGNvbnRhaW5pbmcgdGhlIGRvY3VtZW50IG1lYW5zIHRoZSBkb2N1bWVudCBpcyBwYXJ0IG9mIHNvbWVcbiAgICAgICAgICAgIC8vIHRhcmdldC5cbiAgICAgICAgICAgIDAgIT09IGUgJiYgKGkrKywgci5kb25lKCkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSA+IDApKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgYSBUYXJnZXREYXRhIGVudHJ5IGJ5IHRhcmdldCBJRC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YXJnZXRJZCAtIFRoZSB0YXJnZXQgSUQgb2YgdGhlIFRhcmdldERhdGEgZW50cnkgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2FjaGVkIFRhcmdldERhdGEgZW50cnksIG9yIG51bGwgaWYgdGhlIGNhY2hlIGhhcyBubyBlbnRyeSBmb3JcbiAgICAgKiB0aGUgdGFyZ2V0LlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgdXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5nZXQodCkubmV4dCgoZSA9PiBlID8gX19QUklWQVRFX2Zyb21EYlRhcmdldChlKSA6IG51bGwpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBxdWVyaWVzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwidGFyZ2V0c1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIHRhcmdldCBnbG9iYWxzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZ2xvYmFsVGFyZ2V0U3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJ0YXJnZXRHbG9iYWxcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCB0YXJnZXQgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwidGFyZ2V0RG9jdW1lbnRzXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYnVmZmVyRW50cnlDb21wYXJhdG9yKFtlLCB0XSwgW24sIHJdKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUsIG4pO1xuICAgIHJldHVybiAwID09PSBpID8gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IodCwgcikgOiBpO1xufVxuXG4vKipcbiAqIFVzZWQgdG8gY2FsY3VsYXRlIHRoZSBudGggc2VxdWVuY2UgbnVtYmVyLiBLZWVwcyBhIHJvbGxpbmcgYnVmZmVyIG9mIHRoZVxuICogbG93ZXN0IG4gdmFsdWVzIHBhc3NlZCB0byBgYWRkRWxlbWVudGAsIGFuZCBmaW5hbGx5IHJlcG9ydHMgdGhlIGxhcmdlc3Qgb2ZcbiAqIHRoZW0gaW4gYG1heFZhbHVlYC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUm9sbGluZ1NlcXVlbmNlTnVtYmVyQnVmZmVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMucW4gPSBlLCB0aGlzLmJ1ZmZlciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX2J1ZmZlckVudHJ5Q29tcGFyYXRvciksIHRoaXMuUW4gPSAwO1xuICAgIH1cbiAgICBLbigpIHtcbiAgICAgICAgcmV0dXJuICsrdGhpcy5RbjtcbiAgICB9XG4gICAgJG4oZSkge1xuICAgICAgICBjb25zdCB0ID0gWyBlLCB0aGlzLktuKCkgXTtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnNpemUgPCB0aGlzLnFuKSB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmFkZCh0KTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5idWZmZXIubGFzdCgpO1xuICAgICAgICAgICAgX19QUklWQVRFX2J1ZmZlckVudHJ5Q29tcGFyYXRvcih0LCBlKSA8IDAgJiYgKHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuZGVsZXRlKGUpLmFkZCh0KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG1heFZhbHVlKCkge1xuICAgICAgICAvLyBHdWFyYW50ZWVkIHRvIGJlIG5vbi1lbXB0eS4gSWYgd2UgZGVjaWRlIHdlIGFyZSBub3QgY29sbGVjdGluZyBhbnlcbiAgICAgICAgLy8gc2VxdWVuY2UgbnVtYmVycywgbnRoU2VxdWVuY2VOdW1iZXIgYmVsb3cgc2hvcnQtY2lyY3VpdHMuIElmIHdlIGhhdmVcbiAgICAgICAgLy8gZGVjaWRlZCB0aGF0IHdlIGFyZSBjb2xsZWN0aW5nIG4gc2VxdWVuY2UgbnVtYmVycywgaXQncyBiZWNhdXNlIG4gaXMgc29tZVxuICAgICAgICAvLyBwZXJjZW50YWdlIG9mIHRoZSBleGlzdGluZyBzZXF1ZW5jZSBudW1iZXJzLiBUaGF0IG1lYW5zIHdlIHNob3VsZCBuZXZlclxuICAgICAgICAvLyBiZSBpbiBhIHNpdHVhdGlvbiB3aGVyZSB3ZSBhcmUgY29sbGVjdGluZyBzZXF1ZW5jZSBudW1iZXJzIGJ1dCBkb24ndFxuICAgICAgICAvLyBhY3R1YWxseSBoYXZlIGFueS5cbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLmxhc3QoKVswXTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgdGhlIHNjaGVkdWxpbmcgb2YgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbi4gSXQgaGFuZGxlcyBjaGVja2luZ1xuICogd2hldGhlciBvciBub3QgR0MgaXMgZW5hYmxlZCwgYXMgd2VsbCBhcyB3aGljaCBkZWxheSB0byB1c2UgYmVmb3JlIHRoZSBuZXh0IHJ1bi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTHJ1U2NoZWR1bGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IGUsIHRoaXMuYXN5bmNRdWV1ZSA9IHQsIHRoaXMubG9jYWxTdG9yZSA9IG4sIHRoaXMuVW4gPSBudWxsO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgLTEgIT09IHRoaXMuZ2FyYmFnZUNvbGxlY3Rvci5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCAmJiB0aGlzLlduKDZlNCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuVW4gJiYgKHRoaXMuVW4uY2FuY2VsKCksIHRoaXMuVW4gPSBudWxsKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLlVuO1xuICAgIH1cbiAgICBXbihlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgYEdhcmJhZ2UgY29sbGVjdGlvbiBzY2hlZHVsZWQgaW4gJHtlfW1zYCksIFxuICAgICAgICB0aGlzLlVuID0gdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBZnRlckRlbGF5KFwibHJ1X2dhcmJhZ2VfY29sbGVjdGlvblwiIC8qIFRpbWVySWQuTHJ1R2FyYmFnZUNvbGxlY3Rpb24gKi8gLCBlLCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5VbiA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9jYWxTdG9yZS5jb2xsZWN0R2FyYmFnZSh0aGlzLmdhcmJhZ2VDb2xsZWN0b3IpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkgPyBfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIFwiSWdub3JpbmcgSW5kZXhlZERCIGVycm9yIGR1cmluZyBnYXJiYWdlIGNvbGxlY3Rpb246IFwiLCBlKSA6IGF3YWl0IF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3MoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLlduKDNlNSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyB0aGUgc3RlcHMgZm9yIExSVSBnYXJiYWdlIGNvbGxlY3Rpb24uXG4gKi8gY2xhc3MgX19QUklWQVRFX0xydUdhcmJhZ2VDb2xsZWN0b3JJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuR24gPSBlLCB0aGlzLnBhcmFtcyA9IHQ7XG4gICAgfVxuICAgIGNhbGN1bGF0ZVRhcmdldENvdW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuR24uem4oZSkubmV4dCgoZSA9PiBNYXRoLmZsb29yKHQgLyAxMDAgKiBlKSkpO1xuICAgIH1cbiAgICBudGhTZXF1ZW5jZU51bWJlcihlLCB0KSB7XG4gICAgICAgIGlmICgwID09PSB0KSByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlKTtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfUm9sbGluZ1NlcXVlbmNlTnVtYmVyQnVmZmVyKHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5Hbi5mb3JFYWNoVGFyZ2V0KGUsIChlID0+IG4uJG4oZS5zZXF1ZW5jZU51bWJlcikpKS5uZXh0KCgoKSA9PiB0aGlzLkduLmpuKGUsIChlID0+IG4uJG4oZSkpKSkpLm5leHQoKCgpID0+IG4ubWF4VmFsdWUpKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkduLnJlbW92ZVRhcmdldHMoZSwgdCwgbik7XG4gICAgfVxuICAgIHJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuR24ucmVtb3ZlT3JwaGFuZWREb2N1bWVudHMoZSwgdCk7XG4gICAgfVxuICAgIGNvbGxlY3QoZSwgdCkge1xuICAgICAgICByZXR1cm4gLTEgPT09IHRoaXMucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPyAoX19QUklWQVRFX2xvZ0RlYnVnKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBcIkdhcmJhZ2UgY29sbGVjdGlvbiBza2lwcGVkOyBkaXNhYmxlZFwiKSwgXG4gICAgICAgIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGRlKSkgOiB0aGlzLmdldENhY2hlU2l6ZShlKS5uZXh0KChuID0+IG4gPCB0aGlzLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgYEdhcmJhZ2UgY29sbGVjdGlvbiBza2lwcGVkOyBDYWNoZSBzaXplICR7bn0gaXMgbG93ZXIgdGhhbiB0aHJlc2hvbGQgJHt0aGlzLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkfWApLCBcbiAgICAgICAgZGUpIDogdGhpcy5IbihlLCB0KSkpO1xuICAgIH1cbiAgICBnZXRDYWNoZVNpemUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Hbi5nZXRDYWNoZVNpemUoZSk7XG4gICAgfVxuICAgIEhuKGUsIHQpIHtcbiAgICAgICAgbGV0IG4sIHIsIGksIHMsIG8sIGEsIHU7XG4gICAgICAgIGNvbnN0IGMgPSBEYXRlLm5vdygpO1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVUYXJnZXRDb3VudChlLCB0aGlzLnBhcmFtcy5wZXJjZW50aWxlVG9Db2xsZWN0KS5uZXh0KCh0ID0+IChcbiAgICAgICAgLy8gQ2FwIGF0IHRoZSBjb25maWd1cmVkIG1heFxuICAgICAgICB0ID4gdGhpcy5wYXJhbXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBDYXBwaW5nIHNlcXVlbmNlIG51bWJlcnMgdG8gY29sbGVjdCBkb3duIHRvIHRoZSBtYXhpbXVtIG9mICR7dGhpcy5wYXJhbXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdH0gZnJvbSAke3R9YCksIFxuICAgICAgICByID0gdGhpcy5wYXJhbXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCkgOiByID0gdCwgcyA9IERhdGUubm93KCksIHRoaXMubnRoU2VxdWVuY2VOdW1iZXIoZSwgcikpKSkubmV4dCgociA9PiAobiA9IHIsIFxuICAgICAgICBvID0gRGF0ZS5ub3coKSwgdGhpcy5yZW1vdmVUYXJnZXRzKGUsIG4sIHQpKSkpLm5leHQoKHQgPT4gKGkgPSB0LCBhID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIHRoaXMucmVtb3ZlT3JwaGFuZWREb2N1bWVudHMoZSwgbikpKSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAodSA9IERhdGUubm93KCksIF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgTFJVIEdhcmJhZ2UgQ29sbGVjdGlvblxcblxcdENvdW50ZWQgdGFyZ2V0cyBpbiAke3MgLSBjfW1zXFxuXFx0RGV0ZXJtaW5lZCBsZWFzdCByZWNlbnRseSB1c2VkICR7cn0gaW4gYCArIChvIC0gcykgKyBcIm1zXFxuXCIgKyBgXFx0UmVtb3ZlZCAke2l9IHRhcmdldHMgaW4gYCArIChhIC0gbykgKyBcIm1zXFxuXCIgKyBgXFx0UmVtb3ZlZCAke2V9IGRvY3VtZW50cyBpbiBgICsgKHUgLSBhKSArIFwibXNcXG5cIiArIGBUb3RhbCBEdXJhdGlvbjogJHt1IC0gY31tc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgICBkaWRSdW46ICEwLFxuICAgICAgICAgICAgICAgIHNlcXVlbmNlTnVtYmVyc0NvbGxlY3RlZDogcixcbiAgICAgICAgICAgICAgICB0YXJnZXRzUmVtb3ZlZDogaSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudHNSZW1vdmVkOiBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX25ld0xydUdhcmJhZ2VDb2xsZWN0b3IoZSwgdCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX0xydUdhcmJhZ2VDb2xsZWN0b3JJbXBsKGUsIHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFByb3ZpZGVzIExSVSBmdW5jdGlvbmFsaXR5IGZvciBJbmRleGVkREIgcGVyc2lzdGVuY2UuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJMcnVEZWxlZ2F0ZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5kYiA9IGUsIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IF9fUFJJVkFURV9uZXdMcnVHYXJiYWdlQ29sbGVjdG9yKHRoaXMsIHQpO1xuICAgIH1cbiAgICB6bihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLkpuKGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLmdldFRhcmdldENvdW50KGUpLm5leHQoKGUgPT4gdC5uZXh0KCh0ID0+IGUgKyB0KSkpKTtcbiAgICB9XG4gICAgSm4oZSkge1xuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLmpuKGUsIChlID0+IHtcbiAgICAgICAgICAgIHQrKztcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICB9XG4gICAgZm9yRWFjaFRhcmdldChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFRhcmdldENhY2hlKCkuZm9yRWFjaFRhcmdldChlLCB0KTtcbiAgICB9XG4gICAgam4oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ZbihlLCAoKGUsIG4pID0+IHQobikpKTtcbiAgICB9XG4gICAgYWRkUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cml0ZVNlbnRpbmVsS2V5KGUsIG4pO1xuICAgIH1cbiAgICByZW1vdmVSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgbik7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHMoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLnJlbW92ZVRhcmdldHMoZSwgdCwgbik7XG4gICAgfVxuICAgIG1hcmtQb3RlbnRpYWxseU9ycGhhbmVkKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cml0ZVNlbnRpbmVsS2V5KGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYW55dGhpbmcgd291bGQgcHJldmVudCB0aGlzIGRvY3VtZW50IGZyb20gYmVpbmcgZ2FyYmFnZVxuICAgICAqIGNvbGxlY3RlZCwgZ2l2ZW4gdGhhdCB0aGUgZG9jdW1lbnQgaW4gcXVlc3Rpb24gaXMgbm90IHByZXNlbnQgaW4gYW55XG4gICAgICogdGFyZ2V0cyBhbmQgaGFzIGEgc2VxdWVuY2UgbnVtYmVyIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdXBwZXIgYm91bmQgZm9yXG4gICAgICogdGhlIGNvbGxlY3Rpb24gcnVuLlxuICAgICAqLyAgICBabihlLCB0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZXNDb250YWluS2V5KGUsIHQpIHtcbiAgICAgICAgICAgIGxldCBuID0gITE7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uUXVldWVzU3RvcmUoZSkuWCgociA9PiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZUNvbnRhaW5zS2V5KGUsIHIsIHQpLm5leHQoKGUgPT4gKGUgJiYgKG4gPSAhMCksIFxuICAgICAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoIWUpKSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgICAgICB9KGUsIHQpO1xuICAgIH1cbiAgICByZW1vdmVPcnBoYW5lZERvY3VtZW50cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRiLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5uZXdDaGFuZ2VCdWZmZXIoKSwgciA9IFtdO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLlluKGUsICgocywgbykgPT4ge1xuICAgICAgICAgICAgaWYgKG8gPD0gdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLlpuKGUsIHMpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXQpIFxuICAgICAgICAgICAgICAgICAgICAvLyBPdXIgc2l6ZSBhY2NvdW50aW5nIHJlcXVpcmVzIHVzIHRvIHJlYWQgYWxsIGRvY3VtZW50cyBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZpbmcgdGhlbS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkrKywgbi5nZXRFbnRyeShlLCBzKS5uZXh0KCgoKSA9PiAobi5yZW1vdmVFbnRyeShzLCBTbmFwc2hvdFZlcnNpb24ubWluKCkpLCBcbiAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSkuZGVsZXRlKGZ1bmN0aW9uIF9fUFJJVkFURV9zZW50aW5lbEtleSQxKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbIDAsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgoZS5wYXRoKSBdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogQHJldHVybnMgQSB2YWx1ZSBzdWl0YWJsZSBmb3Igd3JpdGluZyBhIHNlbnRpbmVsIHJvdyBpbiB0aGUgdGFyZ2V0LWRvY3VtZW50XG4gKiBzdG9yZS5cbiAqLyAocykpKSkpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICByLnB1c2godCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihyKSkpLm5leHQoKCgpID0+IG4uYXBwbHkoZSkpKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LndpdGhTZXF1ZW5jZU51bWJlcihlLmN1cnJlbnRTZXF1ZW5jZU51bWJlcik7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFRhcmdldENhY2hlKCkudXBkYXRlVGFyZ2V0RGF0YShlLCBuKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JpdGVTZW50aW5lbEtleShlLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbCBwcm92aWRlZCBmdW5jdGlvbiBmb3IgZWFjaCBkb2N1bWVudCBpbiB0aGUgY2FjaGUgdGhhdCBpcyAnb3JwaGFuZWQnLiBPcnBoYW5lZFxuICAgICAqIG1lYW5zIG5vdCBhIHBhcnQgb2YgYW55IHRhcmdldCwgc28gdGhlIG9ubHkgZW50cnkgaW4gdGhlIHRhcmdldC1kb2N1bWVudCBpbmRleCBmb3JcbiAgICAgKiB0aGF0IGRvY3VtZW50IHdpbGwgYmUgdGhlIHNlbnRpbmVsIHJvdyAodGFyZ2V0SWQgMCksIHdoaWNoIHdpbGwgYWxzbyBoYXZlIHRoZSBzZXF1ZW5jZVxuICAgICAqIG51bWJlciBmb3IgdGhlIGxhc3QgdGltZSB0aGUgZG9jdW1lbnQgd2FzIGFjY2Vzc2VkLlxuICAgICAqLyAgICBZbihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKTtcbiAgICAgICAgbGV0IHIsIGkgPSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWU7XG4gICAgICAgIHJldHVybiBuLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRUYXJnZXRzSW5kZXhcIlxuICAgICAgICB9LCAoKFtlLCBuXSwge3BhdGg6IHMsIHNlcXVlbmNlTnVtYmVyOiBvfSkgPT4ge1xuICAgICAgICAgICAgMCA9PT0gZSA/IChcbiAgICAgICAgICAgIC8vIGlmIG5leHRUb1JlcG9ydCBpcyB2YWxpZCwgcmVwb3J0IGl0LCB0aGlzIGlzIGEgbmV3IGtleSBzbyB0aGVcbiAgICAgICAgICAgIC8vIGxhc3Qgb25lIG11c3Qgbm90IGJlIGEgbWVtYmVyIG9mIGFueSB0YXJnZXRzLlxuICAgICAgICAgICAgaSAhPT0gX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlICYmIHQobmV3IERvY3VtZW50S2V5KF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgocikpLCBpKSwgXG4gICAgICAgICAgICAvLyBzZXQgbmV4dFRvUmVwb3J0IHRvIGJlIHRoaXMgc2VxdWVuY2UgbnVtYmVyLiBJdCdzIHRoZSBuZXh0IG9uZSB3ZVxuICAgICAgICAgICAgLy8gbWlnaHQgcmVwb3J0LCBpZiB3ZSBkb24ndCBmaW5kIGFueSB0YXJnZXRzIGZvciB0aGlzIGRvY3VtZW50LlxuICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBzZXF1ZW5jZSBudW1iZXIgbXVzdCBiZSBkZWZpbmVkIHdoZW4gdGhlIHRhcmdldElkXG4gICAgICAgICAgICAvLyBpcyAwLlxuICAgICAgICAgICAgaSA9IG8sIHIgPSBzKSA6IFxuICAgICAgICAgICAgLy8gc2V0IG5leHRUb1JlcG9ydCB0byBiZSBpbnZhbGlkLCB3ZSBrbm93IHdlIGRvbid0IG5lZWQgdG8gcmVwb3J0XG4gICAgICAgICAgICAvLyB0aGlzIG9uZSBzaW5jZSB3ZSBmb3VuZCBhIHRhcmdldCBmb3IgaXQuXG4gICAgICAgICAgICBpID0gX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gU2luY2Ugd2UgcmVwb3J0IHNlcXVlbmNlIG51bWJlcnMgYWZ0ZXIgZ2V0dGluZyB0byB0aGUgbmV4dCBrZXksIHdlXG4gICAgICAgICAgICAvLyBuZWVkIHRvIGNoZWNrIGlmIHRoZSBsYXN0IGtleSB3ZSBpdGVyYXRlZCBvdmVyIHdhcyBhbiBvcnBoYW5lZFxuICAgICAgICAgICAgLy8gZG9jdW1lbnQgYW5kIHJlcG9ydCBpdC5cbiAgICAgICAgICAgIGkgIT09IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZSAmJiB0KG5ldyBEb2N1bWVudEtleShfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKHIpKSwgaSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0Q2FjaGVTaXplKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLmdldFNpemUoZSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfd3JpdGVTZW50aW5lbEtleShlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfc2VudGluZWxSb3coZSwgdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFyZ2V0SWQ6IDAsXG4gICAgICAgICAgICBwYXRoOiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKGUucGF0aCksXG4gICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogdFxuICAgICAgICB9O1xuICAgIH0odCwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW4tbWVtb3J5IGJ1ZmZlciBvZiBlbnRyaWVzIHRvIGJlIHdyaXR0ZW4gdG8gYSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICogSXQgY2FuIGJlIHVzZWQgdG8gYmF0Y2ggdXAgYSBzZXQgb2YgY2hhbmdlcyB0byBiZSB3cml0dGVuIHRvIHRoZSBjYWNoZSwgYnV0XG4gKiBhZGRpdGlvbmFsbHkgc3VwcG9ydHMgcmVhZGluZyBlbnRyaWVzIGJhY2sgd2l0aCB0aGUgYGdldEVudHJ5KClgIG1ldGhvZCxcbiAqIGZhbGxpbmcgYmFjayB0byB0aGUgdW5kZXJseWluZyBSZW1vdGVEb2N1bWVudENhY2hlIGlmIG5vIGVudHJ5IGlzXG4gKiBidWZmZXJlZC5cbiAqXG4gKiBFbnRyaWVzIGFkZGVkIHRvIHRoZSBjYWNoZSAqbXVzdCogYmUgcmVhZCBmaXJzdC4gVGhpcyBpcyB0byBmYWNpbGl0YXRlXG4gKiBjYWxjdWxhdGluZyB0aGUgc2l6ZSBkZWx0YSBvZiB0aGUgcGVuZGluZyBjaGFuZ2VzLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBjbGFzcyB3YXMgaW1wbGVtZW50ZWQgdGhlbiByZW1vdmVkIGZyb20gb3RoZXIgcGxhdGZvcm1zLlxuICogSWYgYnl0ZS1jb3VudGluZyBlbmRzIHVwIGJlaW5nIG5lZWRlZCBvbiB0aGUgb3RoZXIgcGxhdGZvcm1zLCBjb25zaWRlclxuICogcG9ydGluZyB0aGlzIGNsYXNzIGFzIHBhcnQgb2YgdGhhdCBpbXBsZW1lbnRhdGlvbiB3b3JrLlxuICovIGNsYXNzIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gQSBtYXBwaW5nIG9mIGRvY3VtZW50IGtleSB0byB0aGUgbmV3IGNhY2hlIGVudHJ5IHRoYXQgc2hvdWxkIGJlIHdyaXR0ZW4uXG4gICAgICAgIHRoaXMuY2hhbmdlcyA9IG5ldyBPYmplY3RNYXAoKGUgPT4gZS50b1N0cmluZygpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKSwgdGhpcy5jaGFuZ2VzQXBwbGllZCA9ICExO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBCdWZmZXJzIGEgYFJlbW90ZURvY3VtZW50Q2FjaGUuYWRkRW50cnkoKWAgY2FsbC5cbiAgICAgKlxuICAgICAqIFlvdSBjYW4gb25seSBtb2RpZnkgZG9jdW1lbnRzIHRoYXQgaGF2ZSBhbHJlYWR5IGJlZW4gcmV0cmlldmVkIHZpYVxuICAgICAqIGBnZXRFbnRyeSgpL2dldEVudHJpZXMoKWAgKGVuZm9yY2VkIHZpYSBJbmRleGVkRGJzIGBhcHBseSgpYCkuXG4gICAgICovICAgIGFkZEVudHJ5KGUpIHtcbiAgICAgICAgdGhpcy5hc3NlcnROb3RBcHBsaWVkKCksIHRoaXMuY2hhbmdlcy5zZXQoZS5rZXksIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBCdWZmZXJzIGEgYFJlbW90ZURvY3VtZW50Q2FjaGUucmVtb3ZlRW50cnkoKWAgY2FsbC5cbiAgICAgKlxuICAgICAqIFlvdSBjYW4gb25seSByZW1vdmUgZG9jdW1lbnRzIHRoYXQgaGF2ZSBhbHJlYWR5IGJlZW4gcmV0cmlldmVkIHZpYVxuICAgICAqIGBnZXRFbnRyeSgpL2dldEVudHJpZXMoKWAgKGVuZm9yY2VkIHZpYSBJbmRleGVkRGJzIGBhcHBseSgpYCkuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KGUsIHQpIHtcbiAgICAgICAgdGhpcy5hc3NlcnROb3RBcHBsaWVkKCksIHRoaXMuY2hhbmdlcy5zZXQoZSwgTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudChlKS5zZXRSZWFkVGltZSh0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIGFuIGVudHJ5IGluIHRoZSBjYWNoZS4gVGhlIGJ1ZmZlcmVkIGNoYW5nZXMgd2lsbCBmaXJzdCBiZSBjaGVja2VkLFxuICAgICAqIGFuZCBpZiBubyBidWZmZXJlZCBjaGFuZ2UgYXBwbGllcywgdGhpcyB3aWxsIGZvcndhcmQgdG9cbiAgICAgKiBgUmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeSgpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSB0cmFuc2FjdGlvbiBpbiB3aGljaCB0byBwZXJmb3JtIGFueSBwZXJzaXN0ZW5jZVxuICAgICAqICAgICBvcGVyYXRpb25zLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudEtleSAtIFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgVGhlIGNhY2hlZCBkb2N1bWVudCBvciBhbiBpbnZhbGlkIGRvY3VtZW50IGlmIHdlIGhhdmUgbm90aGluZ1xuICAgICAqIGNhY2hlZC5cbiAgICAgKi8gICAgZ2V0RW50cnkoZSwgdCkge1xuICAgICAgICB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuY2hhbmdlcy5nZXQodCk7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IG4gPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShuKSA6IHRoaXMuZ2V0RnJvbUNhY2hlKGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBzZXZlcmFsIGVudHJpZXMgaW4gdGhlIGNhY2hlLCBmb3J3YXJkaW5nIHRvXG4gICAgICogYFJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gaW4gd2hpY2ggdG8gcGVyZm9ybSBhbnkgcGVyc2lzdGVuY2VcbiAgICAgKiAgICAgb3BlcmF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXlzIC0gVGhlIGtleXMgb2YgdGhlIGVudHJpZXMgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBBIG1hcCBvZiBjYWNoZWQgZG9jdW1lbnRzLCBpbmRleGVkIGJ5IGtleS4gSWYgYW4gZW50cnkgY2Fubm90IGJlXG4gICAgICogICAgIGZvdW5kLCB0aGUgY29ycmVzcG9uZGluZyBrZXkgd2lsbCBiZSBtYXBwZWQgdG8gYW4gaW52YWxpZCBkb2N1bWVudC5cbiAgICAgKi8gICAgZ2V0RW50cmllcyhlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbEZyb21DYWNoZShlLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyBidWZmZXJlZCBjaGFuZ2VzIHRvIHRoZSB1bmRlcmx5aW5nIFJlbW90ZURvY3VtZW50Q2FjaGUsIHVzaW5nXG4gICAgICogdGhlIHByb3ZpZGVkIHRyYW5zYWN0aW9uLlxuICAgICAqLyAgICBhcHBseShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKSwgdGhpcy5jaGFuZ2VzQXBwbGllZCA9ICEwLCB0aGlzLmFwcGx5Q2hhbmdlcyhlKTtcbiAgICB9XG4gICAgLyoqIEhlbHBlciB0byBhc3NlcnQgdGhpcy5jaGFuZ2VzIGlzIG5vdCBudWxsICAqLyAgICBhc3NlcnROb3RBcHBsaWVkKCkge31cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIFJlbW90ZURvY3VtZW50Q2FjaGUgZm9yIEluZGV4ZWREYi4gVG8gY29uc3RydWN0LCBpbnZva2VcbiAqIGBuZXdJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlKClgLlxuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBlO1xuICAgIH1cbiAgICBzZXRJbmRleE1hbmFnZXIoZSkge1xuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgdGhlIHN1cHBsaWVkIGVudHJpZXMgdG8gdGhlIGNhY2hlLlxuICAgICAqXG4gICAgICogQWxsIGNhbGxzIG9mIGBhZGRFbnRyeWAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYCB0byBlbnN1cmUgcHJvcGVyIGFjY291bnRpbmcgb2YgbWV0YWRhdGEuXG4gICAgICovICAgIGFkZEVudHJ5KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5wdXQobik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSBkb2N1bWVudCBmcm9tIHRoZSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgcmVtb3ZlRW50cnlgICBhcmUgcmVxdWlyZWQgdG8gZ28gdGhyb3VnaCB0aGUgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXJcbiAgICAgKiByZXR1cm5lZCBieSBgbmV3Q2hhbmdlQnVmZmVyKClgIHRvIGVuc3VyZSBwcm9wZXIgYWNjb3VudGluZyBvZiBtZXRhZGF0YS5cbiAgICAgKi8gICAgcmVtb3ZlRW50cnkoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLmRlbGV0ZShcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEga2V5IHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRvY3VtZW50IGxvb2t1cHMgdmlhIHRoZSBwcmltYXJ5IGtleSBvZlxuICogdGhlIERiUmVtb3RlRG9jdW1lbnQgb2JqZWN0IHN0b3JlLlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9kYlJlYWRUaW1lS2V5KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLnBhdGgudG9BcnJheSgpO1xuICAgICAgICAgICAgcmV0dXJuIFsgXG4gICAgICAgICAgICAvKiBwcmVmaXggcGF0aCAqLyBuLnNsaWNlKDAsIG4ubGVuZ3RoIC0gMiksIFxuICAgICAgICAgICAgLyogY29sbGVjdGlvbiBpZCAqLyBuW24ubGVuZ3RoIC0gMl0sIF9fUFJJVkFURV90b0RiVGltZXN0YW1wS2V5KHQpLCBcbiAgICAgICAgICAgIC8qIGRvY3VtZW50IGlkICovIG5bbi5sZW5ndGggLSAxXSBdO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudENvbGxlY3Rpb25Hcm91cEluZGV4YCBpbmRleC5cbiAqLyAodCwgbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjdXJyZW50IGNhY2hlIHNpemUuXG4gICAgICpcbiAgICAgKiBDYWxsZXJzIHRvIGBhZGRFbnRyeSgpYCBhbmQgYHJlbW92ZUVudHJ5KClgICptdXN0KiBjYWxsIHRoaXMgYWZ0ZXJ3YXJkcyB0byB1cGRhdGUgdGhlXG4gICAgICogY2FjaGUncyBtZXRhZGF0YS5cbiAgICAgKi8gICAgdXBkYXRlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YShlKS5uZXh0KChuID0+IChuLmJ5dGVTaXplICs9IHQsIHRoaXMuWG4oZSwgbikpKSk7XG4gICAgfVxuICAgIGdldEVudHJ5KGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KHQpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkoX19QUklWQVRFX2RiS2V5KHQpKVxuICAgICAgICB9LCAoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG4gPSB0aGlzLmVyKHQsIHIpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhbiBlbnRyeSBpbiB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXkgLSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgZG9jdW1lbnQgZW50cnkgYW5kIGl0cyBzaXplLlxuICAgICAqLyAgICB0cihlLCB0KSB7XG4gICAgICAgIGxldCBuID0ge1xuICAgICAgICAgICAgc2l6ZTogMCxcbiAgICAgICAgICAgIGRvY3VtZW50OiBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KHQpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogXCJkb2N1bWVudEtleUluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2Uub25seShfX1BSSVZBVEVfZGJLZXkodCkpXG4gICAgICAgIH0sICgoZSwgcikgPT4ge1xuICAgICAgICAgICAgbiA9IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudDogdGhpcy5lcih0LCByKSxcbiAgICAgICAgICAgICAgICBzaXplOiBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUocilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIGdldEVudHJpZXMoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubnIoZSwgdCwgKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gdGhpcy5lcihlLCB0KTtcbiAgICAgICAgICAgIG4gPSBuLmluc2VydChlLCByKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgc2V2ZXJhbCBlbnRyaWVzIGluIHRoZSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudEtleXMgLSBUaGUgc2V0IG9mIGtleXMgZW50cmllcyB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIEEgbWFwIG9mIGRvY3VtZW50cyBpbmRleGVkIGJ5IGtleSBhbmQgYSBtYXAgb2Ygc2l6ZXMgaW5kZXhlZCBieVxuICAgICAqICAgICBrZXkgKHplcm8gaWYgdGhlIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0KS5cbiAgICAgKi8gICAgcnIoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgciA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiB0aGlzLm5yKGUsIHQsICgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuZXIoZSwgdCk7XG4gICAgICAgICAgICBuID0gbi5pbnNlcnQoZSwgaSksIHIgPSByLmluc2VydChlLCBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUodCkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gKHtcbiAgICAgICAgICAgIGRvY3VtZW50czogbixcbiAgICAgICAgICAgIGlyOiByXG4gICAgICAgIH0pKSk7XG4gICAgfVxuICAgIG5yKGUsIHQsIG4pIHtcbiAgICAgICAgaWYgKHQuaXNFbXB0eSgpKSByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgbGV0IHIgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9kYktleUNvbXBhcmF0b3IpO1xuICAgICAgICB0LmZvckVhY2goKGUgPT4gciA9IHIuYWRkKGUpKSk7XG4gICAgICAgIGNvbnN0IGkgPSBJREJLZXlSYW5nZS5ib3VuZChfX1BSSVZBVEVfZGJLZXkoci5maXJzdCgpKSwgX19QUklWQVRFX2RiS2V5KHIubGFzdCgpKSksIHMgPSByLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGxldCBvID0gcy5nZXROZXh0KCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogXCJkb2N1bWVudEtleUluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogaVxuICAgICAgICB9LCAoKGUsIHQsIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBEb2N1bWVudEtleS5mcm9tU2VnbWVudHMoWyAuLi50LnByZWZpeFBhdGgsIHQuY29sbGVjdGlvbkdyb3VwLCB0LmRvY3VtZW50SWQgXSk7XG4gICAgICAgICAgICAvLyBHbyB0aHJvdWdoIGtleXMgbm90IGZvdW5kIGluIGNhY2hlLlxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7byAmJiBfX1BSSVZBVEVfZGJLZXlDb21wYXJhdG9yKG8sIGkpIDwgMDsgKSBuKG8sIG51bGwpLCBvID0gcy5nZXROZXh0KCk7XG4gICAgICAgICAgICBvICYmIG8uaXNFcXVhbChpKSAmJiAoXG4gICAgICAgICAgICAvLyBLZXkgZm91bmQgaW4gY2FjaGUuXG4gICAgICAgICAgICBuKG8sIHQpLCBvID0gcy5oYXNOZXh0KCkgPyBzLmdldE5leHQoKSA6IG51bGwpLCBcbiAgICAgICAgICAgIC8vIFNraXAgdG8gdGhlIG5leHQga2V5IChpZiB0aGVyZSBpcyBvbmUpLlxuICAgICAgICAgICAgbyA/IHIuVyhfX1BSSVZBVEVfZGJLZXkobykpIDogci5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgcmVzdCBvZiB0aGUga2V5cyBhcmUgbm90IGluIHRoZSBjYWNoZS4gT25lIGNhc2Ugd2hlcmUgYGl0ZXJhdGVgXG4gICAgICAgICAgICAvLyBhYm92ZSB3b24ndCBnbyB0aHJvdWdoIHRoZW0gaXMgd2hlbiB0aGUgY2FjaGUgaXMgZW1wdHkuXG4gICAgICAgICAgICBmb3IgKDtvOyApIG4obywgbnVsbCksIG8gPSBzLmhhc05leHQoKSA/IHMuZ2V0TmV4dCgpIDogbnVsbDtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IHQucGF0aCwgcyA9IFsgaS5wb3BMYXN0KCkudG9BcnJheSgpLCBpLmxhc3RTZWdtZW50KCksIF9fUFJJVkFURV90b0RiVGltZXN0YW1wS2V5KG4ucmVhZFRpbWUpLCBuLmRvY3VtZW50S2V5LnBhdGguaXNFbXB0eSgpID8gXCJcIiA6IG4uZG9jdW1lbnRLZXkucGF0aC5sYXN0U2VnbWVudCgpIF0sIG8gPSBbIGkucG9wTGFzdCgpLnRvQXJyYXkoKSwgaS5sYXN0U2VnbWVudCgpLCBbIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiBdLCBcIlwiIF07XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkuRyhJREJLZXlSYW5nZS5ib3VuZChzLCBvLCAhMCkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmVyKERvY3VtZW50S2V5LmZyb21TZWdtZW50cyhpLnByZWZpeFBhdGguY29uY2F0KGkuY29sbGVjdGlvbkdyb3VwLCBpLmRvY3VtZW50SWQpKSwgaSk7XG4gICAgICAgICAgICAgICAgZS5pc0ZvdW5kRG9jdW1lbnQoKSAmJiAoX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyh0LCBlKSB8fCByLmhhcyhlLmtleSkpICYmIChcbiAgICAgICAgICAgICAgICAvLyBFaXRoZXIgdGhlIGRvY3VtZW50IG1hdGNoZXMgdGhlIGdpdmVuIHF1ZXJ5LCBvciBpdCBpcyBtdXRhdGVkLlxuICAgICAgICAgICAgICAgIG4gPSBuLmluc2VydChlLmtleSwgZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuLCByKSB7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX2RiQ29sbGVjdGlvbkdyb3VwS2V5KHQsIG4pLCBvID0gX19QUklWQVRFX2RiQ29sbGVjdGlvbkdyb3VwS2V5KHQsIEluZGV4T2Zmc2V0Lm1heCgpKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2UuYm91bmQocywgbywgITApXG4gICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuZXIoRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKHQucHJlZml4UGF0aC5jb25jYXQodC5jb2xsZWN0aW9uR3JvdXAsIHQuZG9jdW1lbnRJZCkpLCB0KTtcbiAgICAgICAgICAgIGkgPSBpLmluc2VydChzLmtleSwgcyksIGkuc2l6ZSA9PT0gciAmJiBuLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgbmV3Q2hhbmdlQnVmZmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIodGhpcywgISFlICYmIGUudHJhY2tSZW1vdmFscyk7XG4gICAgfVxuICAgIGdldFNpemUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YShlKS5uZXh0KChlID0+IGUuYnl0ZVNpemUpKTtcbiAgICB9XG4gICAgZ2V0TWV0YWRhdGEoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50R2xvYmFsU3RvcmUoZSkuZ2V0KFwicmVtb3RlRG9jdW1lbnRHbG9iYWxLZXlcIikubmV4dCgoZSA9PiAoX19QUklWQVRFX2hhcmRBc3NlcnQoISFlKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIFhuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudEdsb2JhbFN0b3JlKGUpLnB1dChcInJlbW90ZURvY3VtZW50R2xvYmFsS2V5XCIsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWNvZGVzIGBkYlJlbW90ZURvY2AgYW5kIHJldHVybnMgdGhlIGRvY3VtZW50IChvciBhbiBpbnZhbGlkIGRvY3VtZW50IGlmXG4gICAgICogdGhlIGRvY3VtZW50IGNvcnJlc3BvbmRzIHRvIHRoZSBmb3JtYXQgdXNlZCBmb3Igc2VudGluZWwgZGVsZXRlcykuXG4gICAgICovICAgIGVyKGUsIHQpIHtcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZnJvbURiUmVtb3RlRG9jdW1lbnQodGhpcy5zZXJpYWxpemVyLCB0KTtcbiAgICAgICAgICAgIC8vIFdoZXRoZXIgdGhlIGRvY3VtZW50IGlzIGEgc2VudGluZWwgcmVtb3ZhbCBhbmQgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiB0aGVcbiAgICAgICAgICAgIC8vIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGUuaXNOb0RvY3VtZW50KCkgJiYgZS52ZXJzaW9uLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSkpIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KGUpO1xuICAgIH1cbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGVJbXBsKGUpO1xufVxuXG4vKipcbiAqIEhhbmRsZXMgdGhlIGRldGFpbHMgb2YgYWRkaW5nIGFuZCB1cGRhdGluZyBkb2N1bWVudHMgaW4gdGhlIEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKlxuICogVW5saWtlIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciwgdGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBjb21wdXRlcyB0aGUgc2l6ZVxuICogZGVsdGEgZm9yIGFsbCBzdWJtaXR0ZWQgY2hhbmdlcy4gVGhpcyBhdm9pZHMgaGF2aW5nIHRvIHJlLXJlYWQgYWxsIGRvY3VtZW50cyBmcm9tIEluZGV4ZWREYlxuICogd2hlbiB3ZSBhcHBseSB0aGUgY2hhbmdlcy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIgZXh0ZW5kcyBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGRvY3VtZW50Q2FjaGUgLSBUaGUgSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSB0byBhcHBseSB0aGUgY2hhbmdlcyB0by5cbiAgICAgKiBAcGFyYW0gdHJhY2tSZW1vdmFscyAtIFdoZXRoZXIgdG8gY3JlYXRlIHNlbnRpbmVsIGRlbGV0ZXMgdGhhdCBjYW4gYmUgdHJhY2tlZCBieVxuICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnNyID0gZSwgdGhpcy50cmFja1JlbW92YWxzID0gdCwgXG4gICAgICAgIC8vIEEgbWFwIG9mIGRvY3VtZW50IHNpemVzIGFuZCByZWFkIHRpbWVzIHByaW9yIHRvIGFwcGx5aW5nIHRoZSBjaGFuZ2VzIGluXG4gICAgICAgIC8vIHRoaXMgYnVmZmVyLlxuICAgICAgICB0aGlzLl9yID0gbmV3IE9iamVjdE1hcCgoZSA9PiBlLnRvU3RyaW5nKCkpLCAoKGUsIHQpID0+IGUuaXNFcXVhbCh0KSkpO1xuICAgIH1cbiAgICBhcHBseUNoYW5nZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGxldCBuID0gMCwgciA9IG5ldyBTb3J0ZWRTZXQoKChlLCB0KSA9PiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmNhbm9uaWNhbFN0cmluZygpLCB0LmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VzLmZvckVhY2goKChpLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gdGhpcy5fci5nZXQoaSk7XG4gICAgICAgICAgICBpZiAodC5wdXNoKHRoaXMuc3IucmVtb3ZlRW50cnkoZSwgaSwgby5yZWFkVGltZSkpLCBzLmlzVmFsaWREb2N1bWVudCgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgXyA9IF9fUFJJVkFURV90b0RiUmVtb3RlRG9jdW1lbnQodGhpcy5zci5zZXJpYWxpemVyLCBzKTtcbiAgICAgICAgICAgICAgICByID0gci5hZGQoaS5wYXRoLnBvcExhc3QoKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IF9fUFJJVkFURV9kYkRvY3VtZW50U2l6ZShfKTtcbiAgICAgICAgICAgICAgICBuICs9IGEgLSBvLnNpemUsIHQucHVzaCh0aGlzLnNyLmFkZEVudHJ5KGUsIGksIF8pKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobiAtPSBvLnNpemUsIHRoaXMudHJhY2tSZW1vdmFscykge1xuICAgICAgICAgICAgICAgIC8vIEluIG9yZGVyIHRvIHRyYWNrIHJlbW92YWxzLCB3ZSBzdG9yZSBhIFwic2VudGluZWwgZGVsZXRlXCIgaW4gdGhlXG4gICAgICAgICAgICAgICAgLy8gUmVtb3RlRG9jdW1lbnRDYWNoZS4gVGhpcyBlbnRyeSBpcyByZXByZXNlbnRlZCBieSBhIE5vRG9jdW1lbnRcbiAgICAgICAgICAgICAgICAvLyB3aXRoIGEgdmVyc2lvbiBvZiAwIGFuZCBpZ25vcmVkIGJ5IGBtYXliZURlY29kZURvY3VtZW50KClgIGJ1dFxuICAgICAgICAgICAgICAgIC8vIHByZXNlcnZlZCBpbiBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdG9EYlJlbW90ZURvY3VtZW50KHRoaXMuc3Iuc2VyaWFsaXplciwgcy5jb252ZXJ0VG9Ob0RvY3VtZW50KFNuYXBzaG90VmVyc2lvbi5taW4oKSkpO1xuICAgICAgICAgICAgICAgIHQucHVzaCh0aGlzLnNyLmFkZEVudHJ5KGUsIGksIG4pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCByLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgdC5wdXNoKHRoaXMuc3IuaW5kZXhNYW5hZ2VyLmFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KGUsIG4pKTtcbiAgICAgICAgfSkpLCB0LnB1c2godGhpcy5zci51cGRhdGVNZXRhZGF0YShlLCBuKSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHQpO1xuICAgIH1cbiAgICBnZXRGcm9tQ2FjaGUoZSwgdCkge1xuICAgICAgICAvLyBSZWNvcmQgdGhlIHNpemUgb2YgZXZlcnl0aGluZyB3ZSBsb2FkIGZyb20gdGhlIGNhY2hlIHNvIHdlIGNhbiBjb21wdXRlIGEgZGVsdGEgbGF0ZXIuXG4gICAgICAgIHJldHVybiB0aGlzLnNyLnRyKGUsIHQpLm5leHQoKGUgPT4gKHRoaXMuX3Iuc2V0KHQsIHtcbiAgICAgICAgICAgIHNpemU6IGUuc2l6ZSxcbiAgICAgICAgICAgIHJlYWRUaW1lOiBlLmRvY3VtZW50LnJlYWRUaW1lXG4gICAgICAgIH0pLCBlLmRvY3VtZW50KSkpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ2FjaGUoZSwgdCkge1xuICAgICAgICAvLyBSZWNvcmQgdGhlIHNpemUgb2YgZXZlcnl0aGluZyB3ZSBsb2FkIGZyb20gdGhlIGNhY2hlIHNvIHdlIGNhbiBjb21wdXRlXG4gICAgICAgIC8vIGEgZGVsdGEgbGF0ZXIuXG4gICAgICAgIHJldHVybiB0aGlzLnNyLnJyKGUsIHQpLm5leHQoKCh7ZG9jdW1lbnRzOiBlLCBpcjogdH0pID0+IChcbiAgICAgICAgLy8gTm90ZTogYGdldEFsbEZyb21DYWNoZWAgcmV0dXJucyB0d28gbWFwcyBpbnN0ZWFkIG9mIGEgc2luZ2xlIG1hcCBmcm9tXG4gICAgICAgIC8vIGtleXMgdG8gYERvY3VtZW50U2l6ZUVudHJ5YHMuIFRoaXMgaXMgdG8gYWxsb3cgcmV0dXJuaW5nIHRoZVxuICAgICAgICAvLyBgTXV0YWJsZURvY3VtZW50TWFwYCBkaXJlY3RseSwgd2l0aG91dCBhIGNvbnZlcnNpb24uXG4gICAgICAgIHQuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3Iuc2V0KHQsIHtcbiAgICAgICAgICAgICAgICBzaXplOiBuLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBlLmdldCh0KS5yZWFkVGltZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKSwgZSkpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudEdsb2JhbFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSByZW1vdGVEb2N1bWVudHMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcInJlbW90ZURvY3VtZW50c1YxNFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEga2V5IHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRvY3VtZW50IGxvb2t1cHMgb24gdGhlXG4gKiBgRGJSZW1vdGVEb2N1bWVudERvY3VtZW50S2V5SW5kZXhgIGluZGV4LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kYktleShlKSB7XG4gICAgY29uc3QgdCA9IGUucGF0aC50b0FycmF5KCk7XG4gICAgcmV0dXJuIFsgXG4gICAgLyogcHJlZml4IHBhdGggKi8gdC5zbGljZSgwLCB0Lmxlbmd0aCAtIDIpLCBcbiAgICAvKiBjb2xsZWN0aW9uIGlkICovIHRbdC5sZW5ndGggLSAyXSwgXG4gICAgLyogZG9jdW1lbnQgaWQgKi8gdFt0Lmxlbmd0aCAtIDFdIF07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9kYkNvbGxlY3Rpb25Hcm91cEtleShlLCB0KSB7XG4gICAgY29uc3QgbiA9IHQuZG9jdW1lbnRLZXkucGF0aC50b0FycmF5KCk7XG4gICAgcmV0dXJuIFsgXG4gICAgLyogY29sbGVjdGlvbiBpZCAqLyBlLCBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleSh0LnJlYWRUaW1lKSwgXG4gICAgLyogcHJlZml4IHBhdGggKi8gbi5zbGljZSgwLCBuLmxlbmd0aCAtIDIpLCBcbiAgICAvKiBkb2N1bWVudCBpZCAqLyBuLmxlbmd0aCA+IDAgPyBuW24ubGVuZ3RoIC0gMV0gOiBcIlwiIF07XG59XG5cbi8qKlxuICogQ29tcGFyYXRvciB0aGF0IGNvbXBhcmVzIGRvY3VtZW50IGtleXMgYWNjb3JkaW5nIHRvIHRoZSBwcmltYXJ5IGtleSBzb3J0aW5nXG4gKiB1c2VkIGJ5IHRoZSBgRGJSZW1vdGVEb2N1bWVudERvY3VtZW50YCBzdG9yZSAoYnkgcHJlZml4IHBhdGgsIGNvbGxlY3Rpb24gaWRcbiAqIGFuZCB0aGVuIGRvY3VtZW50IElEKS5cbiAqXG4gKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kYktleUNvbXBhcmF0b3IoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBlLnBhdGgudG9BcnJheSgpLCByID0gdC5wYXRoLnRvQXJyYXkoKTtcbiAgICAvLyBUaGUgb3JkZXJpbmcgaXMgYmFzZWQgb24gaHR0cHM6Ly9jaHJvbWl1bS5nb29nbGVzb3VyY2UuY29tL2Nocm9taXVtL2JsaW5rLysvZmU1YzIxZmVmOTRkYWU3MWMxYzMzNDQ3NzViOGQ4YTdmN2U2ZDllYy9Tb3VyY2UvbW9kdWxlcy9pbmRleGVkZGIvSURCS2V5LmNwcCM3NFxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGxldCBlID0gMDsgZSA8IG4ubGVuZ3RoIC0gMiAmJiBlIDwgci5sZW5ndGggLSAyOyArK2UpIGlmIChpID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IobltlXSwgcltlXSksIFxuICAgIGkpIHJldHVybiBpO1xuICAgIHJldHVybiBpID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Iobi5sZW5ndGgsIHIubGVuZ3RoKSwgaSB8fCAoaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG5bbi5sZW5ndGggLSAyXSwgcltyLmxlbmd0aCAtIDJdKSwgXG4gICAgaSB8fCBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuW24ubGVuZ3RoIC0gMV0sIHJbci5sZW5ndGggLSAxXSkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTY2hlbWEgVmVyc2lvbiBmb3IgdGhlIFdlYiBjbGllbnQ6XG4gKiAxLiAgSW5pdGlhbCB2ZXJzaW9uIGluY2x1ZGluZyBNdXRhdGlvbiBRdWV1ZSwgUXVlcnkgQ2FjaGUsIGFuZCBSZW1vdGVcbiAqICAgICBEb2N1bWVudCBDYWNoZVxuICogMi4gIFVzZWQgdG8gZW5zdXJlIGEgdGFyZ2V0R2xvYmFsIG9iamVjdCBleGlzdHMgYW5kIGFkZCB0YXJnZXRDb3VudCB0byBpdC4gTm9cbiAqICAgICBsb25nZXIgcmVxdWlyZWQgYmVjYXVzZSBtaWdyYXRpb24gMyB1bmNvbmRpdGlvbmFsbHkgY2xlYXJzIGl0LlxuICogMy4gIERyb3BwZWQgYW5kIHJlLWNyZWF0ZWQgUXVlcnkgQ2FjaGUgdG8gZGVhbCB3aXRoIGNhY2hlIGNvcnJ1cHRpb24gcmVsYXRlZFxuICogICAgIHRvIGxpbWJvIHJlc29sdXRpb24uIEFkZHJlc3Nlc1xuICogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1pb3Mtc2RrL2lzc3Vlcy8xNTQ4XG4gKiA0LiAgTXVsdGktVGFiIFN1cHBvcnQuXG4gKiA1LiAgUmVtb3ZhbCBvZiBoZWxkIHdyaXRlIGFja3MuXG4gKiA2LiAgQ3JlYXRlIGRvY3VtZW50IGdsb2JhbCBmb3IgdHJhY2tpbmcgZG9jdW1lbnQgY2FjaGUgc2l6ZS5cbiAqIDcuICBFbnN1cmUgZXZlcnkgY2FjaGVkIGRvY3VtZW50IGhhcyBhIHNlbnRpbmVsIHJvdyB3aXRoIGEgc2VxdWVuY2UgbnVtYmVyLlxuICogOC4gIEFkZCBjb2xsZWN0aW9uLXBhcmVudCBpbmRleCBmb3IgQ29sbGVjdGlvbiBHcm91cCBxdWVyaWVzLlxuICogOS4gIENoYW5nZSBSZW1vdGVEb2N1bWVudENoYW5nZXMgc3RvcmUgdG8gYmUga2V5ZWQgYnkgcmVhZFRpbWUgcmF0aGVyIHRoYW5cbiAqICAgICBhbiBhdXRvLWluY3JlbWVudGluZyBJRC4gVGhpcyBpcyByZXF1aXJlZCBmb3IgSW5kZXgtRnJlZSBxdWVyaWVzLlxuICogMTAuIFJld3JpdGUgdGhlIGNhbm9uaWNhbCBJRHMgdG8gdGhlIGV4cGxpY2l0IFByb3RvYnVmLWJhc2VkIGZvcm1hdC5cbiAqIDExLiBBZGQgYnVuZGxlcyBhbmQgbmFtZWRfcXVlcmllcyBmb3IgYnVuZGxlIHN1cHBvcnQuXG4gKiAxMi4gQWRkIGRvY3VtZW50IG92ZXJsYXlzLlxuICogMTMuIFJld3JpdGUgdGhlIGtleXMgb2YgdGhlIHJlbW90ZSBkb2N1bWVudCBjYWNoZSB0byBhbGxvdyBmb3IgZWZmaWNpZW50XG4gKiAgICAgZG9jdW1lbnQgbG9va3VwIHZpYSBgZ2V0QWxsKClgLlxuICogMTQuIEFkZCBvdmVybGF5cy5cbiAqIDE1LiBBZGQgaW5kZXhpbmcgc3VwcG9ydC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGxvY2FsIHZpZXcgKG92ZXJsYXkpIG9mIGEgZG9jdW1lbnQsIGFuZCB0aGUgZmllbGRzIHRoYXQgYXJlXG4gKiBsb2NhbGx5IG11dGF0ZWQuXG4gKi9cbmNsYXNzIE92ZXJsYXllZERvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgZmllbGRzIHRoYXQgYXJlIGxvY2FsbHkgbXV0YXRlZCBieSBwYXRjaCBtdXRhdGlvbnMuXG4gICAgICpcbiAgICAgKiBJZiB0aGUgb3ZlcmxheWVkXHRkb2N1bWVudCBpcyBmcm9tIHNldCBvciBkZWxldGUgbXV0YXRpb25zLCB0aGlzIGlzIGBudWxsYC5cbiAgICAgKiBJZiB0aGVyZSBpcyBubyBvdmVybGF5IChtdXRhdGlvbikgZm9yIHRoZSBkb2N1bWVudCwgdGhpcyBpcyBhbiBlbXB0eSBgRmllbGRNYXNrYC5cbiAgICAgKi9cbiAgICB0KSB7XG4gICAgICAgIHRoaXMub3ZlcmxheWVkRG9jdW1lbnQgPSBlLCB0aGlzLm11dGF0ZWRGaWVsZHMgPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSByZWFkb25seSB2aWV3IG9mIHRoZSBsb2NhbCBzdGF0ZSBvZiBhbGwgZG9jdW1lbnRzIHdlJ3JlIHRyYWNraW5nIChpLmUuIHdlXG4gKiBoYXZlIGEgY2FjaGVkIHZlcnNpb24gaW4gcmVtb3RlRG9jdW1lbnRDYWNoZSBvciBsb2NhbCBtdXRhdGlvbnMgZm9yIHRoZVxuICogZG9jdW1lbnQpLiBUaGUgdmlldyBpcyBjb21wdXRlZCBieSBhcHBseWluZyB0aGUgbXV0YXRpb25zIGluIHRoZVxuICogTXV0YXRpb25RdWV1ZSB0byB0aGUgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAqLyBjbGFzcyBMb2NhbERvY3VtZW50c1ZpZXcge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlID0gZSwgdGhpcy5tdXRhdGlvblF1ZXVlID0gdCwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSA9IG4sIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbG9jYWwgdmlldyBvZiB0aGUgZG9jdW1lbnQgaWRlbnRpZmllZCBieSBga2V5YC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIExvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50IG9yIG51bGwgaWYgd2UgZG9uJ3QgaGF2ZSBhbnkgY2FjaGVkXG4gICAgICogc3RhdGUgZm9yIGl0LlxuICAgICAqLyAgICBnZXREb2N1bWVudChlLCB0KSB7XG4gICAgICAgIGxldCBuID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheShlLCB0KS5uZXh0KChyID0+IChuID0gciwgdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KGUsIHQpKSkpLm5leHQoKGUgPT4gKG51bGwgIT09IG4gJiYgX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhuLm11dGF0aW9uLCBlLCBGaWVsZE1hc2suZW1wdHkoKSwgVGltZXN0YW1wLm5vdygpKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50cyBpZGVudGlmaWVkIGJ5IGBrZXlzYC5cbiAgICAgKlxuICAgICAqIElmIHdlIGRvbid0IGhhdmUgY2FjaGVkIHN0YXRlIGZvciBhIGRvY3VtZW50IGluIGBrZXlzYCwgYSBOb0RvY3VtZW50IHdpbGxcbiAgICAgKiBiZSBzdG9yZWQgZm9yIHRoYXQga2V5IGluIHRoZSByZXN1bHRpbmcgc2V0LlxuICAgICAqLyAgICBnZXREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJpZXMoZSwgdCkubmV4dCgodCA9PiB0aGlzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIHQsIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKS5uZXh0KCgoKSA9PiB0KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2ltaWxhciB0byBgZ2V0RG9jdW1lbnRzYCwgYnV0IGNyZWF0ZXMgdGhlIGxvY2FsIHZpZXcgZnJvbSB0aGUgZ2l2ZW5cbiAgICAgKiBgYmFzZURvY3NgIHdpdGhvdXQgcmV0cmlldmluZyBkb2N1bWVudHMgZnJvbSB0aGUgbG9jYWwgc3RvcmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gdGhpcyBvcGVyYXRpb24gaXMgc2NvcGVkIHRvLlxuICAgICAqIEBwYXJhbSBkb2NzIC0gVGhlIGRvY3VtZW50cyB0byBhcHBseSBsb2NhbCBtdXRhdGlvbnMgdG8gZ2V0IHRoZSBsb2NhbCB2aWV3cy5cbiAgICAgKiBAcGFyYW0gZXhpc3RlbmNlU3RhdGVDaGFuZ2VkIC0gVGhlIHNldCBvZiBkb2N1bWVudCBrZXlzIHdob3NlIGV4aXN0ZW5jZSBzdGF0ZVxuICAgICAqICAgaXMgY2hhbmdlZC4gVGhpcyBpcyB1c2VmdWwgdG8gZGV0ZXJtaW5lIGlmIHNvbWUgZG9jdW1lbnRzIG92ZXJsYXkgbmVlZHNcbiAgICAgKiAgIHRvIGJlIHJlY2FsY3VsYXRlZC5cbiAgICAgKi8gICAgZ2V0TG9jYWxWaWV3T2ZEb2N1bWVudHMoZSwgdCwgbiA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5wb3B1bGF0ZU92ZXJsYXlzKGUsIHIsIHQpLm5leHQoKCgpID0+IHRoaXMuY29tcHV0ZVZpZXdzKGUsIHQsIHIsIG4pLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbGV0IHQgPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICB0ID0gdC5pbnNlcnQoZSwgbi5vdmVybGF5ZWREb2N1bWVudCk7XG4gICAgICAgICAgICB9KSksIHQ7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBvdmVybGF5ZWQgZG9jdW1lbnRzIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQgbWFwLCB3aGljaCB3aWxsIGluY2x1ZGVcbiAgICAgKiB0aGUgbG9jYWwgdmlldyBvZiB0aG9zZSBkb2N1bWVudHMgYW5kIGEgYEZpZWxkTWFza2AgaW5kaWNhdGluZyB3aGljaCBmaWVsZHNcbiAgICAgKiBhcmUgbXV0YXRlZCBsb2NhbGx5LCBgbnVsbGAgaWYgb3ZlcmxheSBpcyBhIFNldCBvciBEZWxldGUgbXV0YXRpb24uXG4gICAgICovICAgIGdldE92ZXJsYXllZERvY3VtZW50cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5wb3B1bGF0ZU92ZXJsYXlzKGUsIG4sIHQpLm5leHQoKCgpID0+IHRoaXMuY29tcHV0ZVZpZXdzKGUsIHQsIG4sIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaGVzIHRoZSBvdmVybGF5cyBmb3Ige0Bjb2RlIGRvY3N9IGFuZCBhZGRzIHRoZW0gdG8gcHJvdmlkZWQgb3ZlcmxheSBtYXBcbiAgICAgKiBpZiB0aGUgbWFwIGRvZXMgbm90IGFscmVhZHkgY29udGFpbiBhbiBlbnRyeSBmb3IgdGhlIGdpdmVuIGRvY3VtZW50IGtleS5cbiAgICAgKi8gICAgcG9wdWxhdGVPdmVybGF5cyhlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0LmhhcyhlKSB8fCByLnB1c2goZSk7XG4gICAgICAgIH0pKSwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5nZXRPdmVybGF5cyhlLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICB0LnNldChlLCBuKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2NzIC0gVGhlIGRvY3VtZW50cyB0byBjb21wdXRlIHZpZXdzIGZvci4gSXQgYWxzbyBoYXMgdGhlIGJhc2VcbiAgICAgKiAgIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb3ZlcmxheXMgLSBUaGUgb3ZlcmxheXMgdGhhdCBuZWVkIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGdpdmVuIGJhc2VcbiAgICAgKiAgIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gZXhpc3RlbmNlU3RhdGVDaGFuZ2VkIC0gQSBzZXQgb2YgZG9jdW1lbnRzIHdob3NlIGV4aXN0ZW5jZSBzdGF0ZXNcbiAgICAgKiAgIG1pZ2h0IGhhdmUgY2hhbmdlZC4gVGhpcyBpcyB1c2VkIHRvIGRldGVybWluZSBpZiB3ZSBuZWVkIHRvIHJlLWNhbGN1bGF0ZVxuICAgICAqICAgb3ZlcmxheXMgZnJvbSBtdXRhdGlvbiBxdWV1ZXMuXG4gICAgICogQHJldHVybiBBIG1hcCByZXByZXNlbnRzIHRoZSBsb2NhbCBkb2N1bWVudHMgdmlldy5cbiAgICAgKi8gICAgY29tcHV0ZVZpZXdzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIGNvbnN0IHMgPSBfX1BSSVZBVEVfbmV3RG9jdW1lbnRLZXlNYXAoKSwgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdPdmVybGF5ZWREb2N1bWVudE1hcCgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmV3RG9jdW1lbnRLZXlNYXAoKTtcbiAgICAgICAgfSgpO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IG4uZ2V0KHQua2V5KTtcbiAgICAgICAgICAgIC8vIFJlY2FsY3VsYXRlIGFuIG92ZXJsYXkgaWYgdGhlIGRvY3VtZW50J3MgZXhpc3RlbmNlIHN0YXRlIGNoYW5nZWQgZHVlIHRvXG4gICAgICAgICAgICAvLyBhIHJlbW90ZSBldmVudCAqYW5kKiB0aGUgb3ZlcmxheSBpcyBhIFBhdGNoTXV0YXRpb24uIFRoaXMgaXMgYmVjYXVzZVxuICAgICAgICAgICAgLy8gZG9jdW1lbnQgZXhpc3RlbmNlIHN0YXRlIGNhbiBjaGFuZ2UgaWYgc29tZSBwYXRjaCBtdXRhdGlvbidzXG4gICAgICAgICAgICAvLyBwcmVjb25kaXRpb25zIGFyZSBtZXQuXG4gICAgICAgICAgICAvLyBOT1RFOiB3ZSByZWNhbGN1bGF0ZSB3aGVuIGBvdmVybGF5YCBpcyB1bmRlZmluZWQgYXMgd2VsbCwgYmVjYXVzZSB0aGVyZVxuICAgICAgICAgICAgLy8gbWlnaHQgYmUgYSBwYXRjaCBtdXRhdGlvbiB3aG9zZSBwcmVjb25kaXRpb24gZG9lcyBub3QgbWF0Y2ggYmVmb3JlIHRoZVxuICAgICAgICAgICAgLy8gY2hhbmdlIChoZW5jZSBvdmVybGF5IGlzIHVuZGVmaW5lZCksIGJ1dCB3b3VsZCBub3cgbWF0Y2guXG4gICAgICAgICAgICAgICAgICAgICAgICByLmhhcyh0LmtleSkgJiYgKHZvaWQgMCA9PT0gbyB8fCBvLm11dGF0aW9uIGluc3RhbmNlb2YgX19QUklWQVRFX1BhdGNoTXV0YXRpb24pID8gaSA9IGkuaW5zZXJ0KHQua2V5LCB0KSA6IHZvaWQgMCAhPT0gbyA/IChzLnNldCh0LmtleSwgby5tdXRhdGlvbi5nZXRGaWVsZE1hc2soKSksIFxuICAgICAgICAgICAgX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhvLm11dGF0aW9uLCB0LCBvLm11dGF0aW9uLmdldEZpZWxkTWFzaygpLCBUaW1lc3RhbXAubm93KCkpKSA6IFxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxheSBleGlzdHNcbiAgICAgICAgICAgIC8vIFVzaW5nIEVNUFRZIHRvIGluZGljYXRlIHRoZXJlIGlzIG5vIG92ZXJsYXkgZm9yIHRoZSBkb2N1bWVudC5cbiAgICAgICAgICAgIHMuc2V0KHQua2V5LCBGaWVsZE1hc2suZW1wdHkoKSk7XG4gICAgICAgIH0pKSwgdGhpcy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5cyhlLCBpKS5uZXh0KChlID0+IChlLmZvckVhY2goKChlLCB0KSA9PiBzLnNldChlLCB0KSkpLCBcbiAgICAgICAgdC5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgdmFyIG47XG4gICAgICAgICAgICByZXR1cm4gby5zZXQoZSwgbmV3IE92ZXJsYXllZERvY3VtZW50KHQsIG51bGwgIT09IChuID0gcy5nZXQoZSkpICYmIHZvaWQgMCAhPT0gbiA/IG4gOiBudWxsKSk7XG4gICAgICAgIH0pKSwgbykpKTtcbiAgICB9XG4gICAgcmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCk7XG4gICAgICAgIC8vIEEgcmV2ZXJzZSBsb29rdXAgbWFwIGZyb20gYmF0Y2ggaWQgdG8gdGhlIGRvY3VtZW50cyB3aXRoaW4gdGhhdCBiYXRjaC5cbiAgICAgICAgICAgICAgICBsZXQgciA9IG5ldyBTb3J0ZWRNYXAoKChlLCB0KSA9PiBlIC0gdCkpLCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9uUXVldWUuZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIGUpIGkua2V5cygpLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB0LmdldChlKTtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gcykgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGxldCBvID0gbi5nZXQoZSkgfHwgRmllbGRNYXNrLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgbyA9IGkuYXBwbHlUb0xvY2FsVmlldyhzLCBvKSwgbi5zZXQoZSwgbyk7XG4gICAgICAgICAgICAgICAgY29uc3QgXyA9IChyLmdldChpLmJhdGNoSWQpIHx8IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKS5hZGQoZSk7XG4gICAgICAgICAgICAgICAgciA9IHIuaW5zZXJ0KGkuYmF0Y2hJZCwgXyk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gW10sIG8gPSByLmdldFJldmVyc2VJdGVyYXRvcigpO1xuICAgICAgICAgICAgLy8gSXRlcmF0ZSBpbiBkZXNjZW5kaW5nIG9yZGVyIG9mIGJhdGNoIElEcywgYW5kIHNraXAgZG9jdW1lbnRzIHRoYXQgYXJlXG4gICAgICAgICAgICAvLyBhbHJlYWR5IHNhdmVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7by5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBvLmdldE5leHQoKSwgXyA9IHIua2V5LCBhID0gci52YWx1ZSwgdSA9IF9fUFJJVkFURV9uZXdNdXRhdGlvbk1hcCgpO1xuICAgICAgICAgICAgICAgIGEuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaS5oYXMoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfY2FsY3VsYXRlT3ZlcmxheU11dGF0aW9uKHQuZ2V0KGUpLCBuLmdldChlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSByICYmIHUuc2V0KGUsIHIpLCBpID0gaS5hZGQoZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSksIHMucHVzaCh0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlLnNhdmVPdmVybGF5cyhlLCBfLCB1KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3Iocyk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlY2FsY3VsYXRlcyBvdmVybGF5cyBieSByZWFkaW5nIHRoZSBkb2N1bWVudHMgZnJvbSByZW1vdGUgZG9jdW1lbnQgY2FjaGVcbiAgICAgKiBmaXJzdCwgYW5kIHNhdmVzIHRoZW0gYWZ0ZXIgdGhleSBhcmUgY2FsY3VsYXRlZC5cbiAgICAgKi8gICAgcmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJpZXMoZSwgdCkubmV4dCgodCA9PiB0aGlzLnJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzKGUsIHQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGEgcXVlcnkgYWdhaW5zdCB0aGUgbG9jYWwgdmlldyBvZiBhbGwgZG9jdW1lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIC0gVGhlIHBlcnNpc3RlbmNlIHRyYW5zYWN0aW9uLlxuICAgICAqIEBwYXJhbSBxdWVyeSAtIFRoZSBxdWVyeSB0byBtYXRjaCBkb2N1bWVudHMgYWdhaW5zdC5cbiAgICAgKiBAcGFyYW0gb2Zmc2V0IC0gUmVhZCB0aW1lIGFuZCBrZXkgdG8gc3RhcnQgc2Nhbm5pbmcgYnkgKGV4Y2x1c2l2ZSkuXG4gICAgICovICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbikge1xuICAgICAgICAvKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgcXVlcnkgbWF0Y2hlcyBhIHNpbmdsZSBkb2N1bWVudCBieSBwYXRoIChyYXRoZXIgdGhhbiBhXG4gKiBjb2xsZWN0aW9uKS5cbiAqL1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2lzRG9jdW1lbnRRdWVyeSQxKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUucGF0aCkgJiYgbnVsbCA9PT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gZS5maWx0ZXJzLmxlbmd0aDtcbiAgICAgICAgfSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KGUsIHQucGF0aCkgOiBfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeShlLCB0LCBuKSA6IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkoZSwgdCwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgY29sbGVjdGlvbiBncm91cCwgcmV0dXJucyB0aGUgbmV4dCBkb2N1bWVudHMgdGhhdCBmb2xsb3cgdGhlIHByb3ZpZGVkIG9mZnNldCwgYWxvbmdcbiAgICAgKiB3aXRoIGFuIHVwZGF0ZWQgYmF0Y2ggSUQuXG4gICAgICpcbiAgICAgKiA8cD5UaGUgZG9jdW1lbnRzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kIGFyZSBvcmRlcmVkIGJ5IHJlbW90ZSB2ZXJzaW9uIGZyb20gdGhlIHByb3ZpZGVkXG4gICAgICogb2Zmc2V0LiBJZiB0aGVyZSBhcmUgbm8gbW9yZSByZW1vdGUgZG9jdW1lbnRzIGFmdGVyIHRoZSBwcm92aWRlZCBvZmZzZXQsIGRvY3VtZW50cyB3aXRoXG4gICAgICogbXV0YXRpb25zIGluIG9yZGVyIG9mIGJhdGNoIGlkIGZyb20gdGhlIG9mZnNldCBhcmUgcmV0dXJuZWQuIFNpbmNlIGFsbCBkb2N1bWVudHMgaW4gYSBiYXRjaCBhcmVcbiAgICAgKiByZXR1cm5lZCB0b2dldGhlciwgdGhlIHRvdGFsIG51bWJlciBvZiBkb2N1bWVudHMgcmV0dXJuZWQgY2FuIGV4Y2VlZCB7QGNvZGUgY291bnR9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb25Hcm91cCBUaGUgY29sbGVjdGlvbiBncm91cCBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgdG8gaW5kZXggaW50by5cbiAgICAgKiBAcGFyYW0gY291bnQgVGhlIG51bWJlciBvZiBkb2N1bWVudHMgdG8gcmV0dXJuXG4gICAgICogQHJldHVybiBBIExvY2FsV3JpdGVSZXN1bHQgd2l0aCB0aGUgZG9jdW1lbnRzIHRoYXQgZm9sbG93IHRoZSBwcm92aWRlZCBvZmZzZXQgYW5kIHRoZSBsYXN0IHByb2Nlc3NlZCBiYXRjaCBpZC5cbiAgICAgKi8gICAgZ2V0TmV4dERvY3VtZW50cyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuLCByKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSByIC0gaS5zaXplID4gMCA/IHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbi5sYXJnZXN0QmF0Y2hJZCwgciAtIGkuc2l6ZSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpKTtcbiAgICAgICAgICAgIC8vIFRoZSBjYWxsc2l0ZSB3aWxsIHVzZSB0aGUgbGFyZ2VzdCBiYXRjaCBJRCB0b2dldGhlciB3aXRoIHRoZSBsYXRlc3QgcmVhZCB0aW1lIHRvIGNyZWF0ZVxuICAgICAgICAgICAgLy8gYSBuZXcgaW5kZXggb2Zmc2V0LiBTaW5jZSB3ZSBvbmx5IHByb2Nlc3MgYmF0Y2ggSURzIGlmIGFsbCByZW1vdGUgZG9jdW1lbnRzIGhhdmUgYmVlbiByZWFkLFxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxheSB3aWxsIGluY3JlYXNlIHRoZSBvdmVyYWxsIHJlYWQgdGltZS4gVGhpcyBpcyB3aHkgd2Ugb25seSBuZWVkIHRvIHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgLy8gdGhlIGJhdGNoIGlkLlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG8gPSAtMSwgXyA9IGk7XG4gICAgICAgICAgICByZXR1cm4gcy5uZXh0KCh0ID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQsICgodCwgbikgPT4gKG8gPCBuLmxhcmdlc3RCYXRjaElkICYmIChvID0gbi5sYXJnZXN0QmF0Y2hJZCksIFxuICAgICAgICAgICAgaS5nZXQodCkgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIF8gPSBfLmluc2VydCh0LCBlKTtcbiAgICAgICAgICAgIH0pKSkpKS5uZXh0KCgoKSA9PiB0aGlzLnBvcHVsYXRlT3ZlcmxheXMoZSwgdCwgaSkpKS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCBfLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkpKS5uZXh0KChlID0+ICh7XG4gICAgICAgICAgICAgICAgYmF0Y2hJZDogbyxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiBfX1BSSVZBVEVfY29udmVydE92ZXJsYXllZERvY3VtZW50TWFwVG9Eb2N1bWVudE1hcChlKVxuICAgICAgICAgICAgfSkpKSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nRG9jdW1lbnRRdWVyeShlLCB0KSB7XG4gICAgICAgIC8vIEp1c3QgZG8gYSBzaW1wbGUgZG9jdW1lbnQgbG9va3VwLlxuICAgICAgICByZXR1cm4gdGhpcy5nZXREb2N1bWVudChlLCBuZXcgRG9jdW1lbnRLZXkodCkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbGV0IHQgPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKHQgPSB0Lmluc2VydChlLmtleSwgZSkpLCB0O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nQ29sbGVjdGlvbkdyb3VwUXVlcnkoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gdC5jb2xsZWN0aW9uR3JvdXA7XG4gICAgICAgIGxldCBpID0gZG9jdW1lbnRNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyLmdldENvbGxlY3Rpb25QYXJlbnRzKGUsIHIpLm5leHQoKHMgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gocywgKHMgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9hc0NvbGxlY3Rpb25RdWVyeUF0UGF0aChlLCB0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKHQsIFxuICAgICAgICAgICAgICAgIC8qY29sbGVjdGlvbkdyb3VwPSovIG51bGwsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgZS5zdGFydEF0LCBlLmVuZEF0KTtcbiAgICAgICAgICAgIH0odCwgcy5jaGlsZChyKSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREb2N1bWVudHNNYXRjaGluZ0NvbGxlY3Rpb25RdWVyeShlLCBvLCBuKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBpLmluc2VydChlLCB0KTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkoZSwgdCwgbikge1xuICAgICAgICAvLyBRdWVyeSB0aGUgcmVtb3RlIGRvY3VtZW50cyBhbmQgb3ZlcmxheSBtdXRhdGlvbnMuXG4gICAgICAgIGxldCByO1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5nZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24oZSwgdC5wYXRoLCBuLmxhcmdlc3RCYXRjaElkKS5uZXh0KChpID0+IChyID0gaSwgXG4gICAgICAgIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIHIpKSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgLy8gQXMgZG9jdW1lbnRzIG1pZ2h0IG1hdGNoIHRoZSBxdWVyeSBiZWNhdXNlIG9mIHRoZWlyIG92ZXJsYXkgd2UgbmVlZCB0b1xuICAgICAgICAgICAgLy8gaW5jbHVkZSBkb2N1bWVudHMgZm9yIGFsbCBvdmVybGF5cyBpbiB0aGUgaW5pdGlhbCBkb2N1bWVudCBzZXQuXG4gICAgICAgICAgICByLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG4uZ2V0S2V5KCk7XG4gICAgICAgICAgICAgICAgbnVsbCA9PT0gZS5nZXQocikgJiYgKGUgPSBlLmluc2VydChyLCBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KHIpKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvLyBBcHBseSB0aGUgb3ZlcmxheXMgYW5kIG1hdGNoIGFnYWluc3QgdGhlIHF1ZXJ5LlxuICAgICAgICAgICAgbGV0IG4gPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gci5nZXQoZSk7XG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBzICYmIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcocy5tdXRhdGlvbiwgaSwgRmllbGRNYXNrLmVtcHR5KCksIFRpbWVzdGFtcC5ub3coKSksIFxuICAgICAgICAgICAgICAgIC8vIEZpbmFsbHksIGluc2VydCB0aGUgZG9jdW1lbnRzIHRoYXQgc3RpbGwgbWF0Y2ggdGhlIHF1ZXJ5XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyh0LCBpKSAmJiAobiA9IG4uaW5zZXJ0KGUsIGkpKTtcbiAgICAgICAgICAgIH0pKSwgbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeUJ1bmRsZUNhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGUsIHRoaXMuYXIgPSBuZXcgTWFwLCB0aGlzLnVyID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5hci5nZXQodCkpO1xuICAgIH1cbiAgICBzYXZlQnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hci5zZXQodC5pZCwgXG4gICAgICAgIC8qKiBEZWNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgcHJvdG8gaW50byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CdW5kbGVNZXRhZGF0YShlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBlLmlkLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IGUudmVyc2lvbixcbiAgICAgICAgICAgICAgICBjcmVhdGVUaW1lOiBfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS5jcmVhdGVUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldE5hbWVkUXVlcnkoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy51ci5nZXQodCkpO1xuICAgIH1cbiAgICBzYXZlTmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVyLnNldCh0Lm5hbWUsIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUHJvdG9OYW1lZFF1ZXJ5KGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlLmJ1bmRsZWRRdWVyeSksXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnJlYWRUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgRG9jdW1lbnRPdmVybGF5Q2FjaGUuXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeURvY3VtZW50T3ZlcmxheUNhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gQSBtYXAgc29ydGVkIGJ5IERvY3VtZW50S2V5LCB3aG9zZSB2YWx1ZSBpcyBhIHBhaXIgb2YgdGhlIGxhcmdlc3QgYmF0Y2ggaWRcbiAgICAgICAgLy8gZm9yIHRoZSBvdmVybGF5IGFuZCB0aGUgb3ZlcmxheSBpdHNlbGYuXG4gICAgICAgIHRoaXMub3ZlcmxheXMgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpLCB0aGlzLmNyID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLm92ZXJsYXlzLmdldCh0KSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB0aGlzLmdldE92ZXJsYXkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBudWxsICE9PSBlICYmIG4uc2V0KHQsIGUpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIHNhdmVPdmVybGF5cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmh0KGUsIHQsIHIpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gciAmJiAoci5mb3JFYWNoKChlID0+IHRoaXMub3ZlcmxheXMgPSB0aGlzLm92ZXJsYXlzLnJlbW92ZShlKSkpLCBcbiAgICAgICAgdGhpcy5jci5kZWxldGUobikpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKSwgaSA9IHQubGVuZ3RoICsgMSwgcyA9IG5ldyBEb2N1bWVudEtleSh0LmNoaWxkKFwiXCIpKSwgbyA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3JGcm9tKHMpO1xuICAgICAgICBmb3IgKDtvLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gby5nZXROZXh0KCkudmFsdWUsIHMgPSBlLmdldEtleSgpO1xuICAgICAgICAgICAgaWYgKCF0LmlzUHJlZml4T2Yocy5wYXRoKSkgYnJlYWs7XG4gICAgICAgICAgICAvLyBEb2N1bWVudHMgZnJvbSBzdWItY29sbGVjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHMucGF0aC5sZW5ndGggPT09IGkgJiYgKGUubGFyZ2VzdEJhdGNoSWQgPiBuICYmIHIuc2V0KGUuZ2V0S2V5KCksIGUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUocik7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSBuZXcgU29ydGVkTWFwKCgoZSwgdCkgPT4gZSAtIHQpKTtcbiAgICAgICAgY29uc3QgcyA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7cy5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHMuZ2V0TmV4dCgpLnZhbHVlO1xuICAgICAgICAgICAgaWYgKGUuZ2V0S2V5KCkuZ2V0Q29sbGVjdGlvbkdyb3VwKCkgPT09IHQgJiYgZS5sYXJnZXN0QmF0Y2hJZCA+IG4pIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IGkuZ2V0KGUubGFyZ2VzdEJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIG51bGwgPT09IHQgJiYgKHQgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpLCBpID0gaS5pbnNlcnQoZS5sYXJnZXN0QmF0Y2hJZCwgdCkpLCBcbiAgICAgICAgICAgICAgICB0LnNldChlLmdldEtleSgpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKSwgXyA9IGkuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7Xy5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgaWYgKF8uZ2V0TmV4dCgpLnZhbHVlLmZvckVhY2goKChlLCB0KSA9PiBvLnNldChlLCB0KSkpLCBvLnNpemUoKSA+PSByKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobyk7XG4gICAgfVxuICAgIGh0KGUsIHQsIG4pIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhc3NvY2lhdGlvbiBvZiB0aGUgb3ZlcmxheSB0byBpdHMgYmF0Y2ggaWQuXG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLm92ZXJsYXlzLmdldChuLmtleSk7XG4gICAgICAgIGlmIChudWxsICE9PSByKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5jci5nZXQoci5sYXJnZXN0QmF0Y2hJZCkuZGVsZXRlKG4ua2V5KTtcbiAgICAgICAgICAgIHRoaXMuY3Iuc2V0KHIubGFyZ2VzdEJhdGNoSWQsIGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3ZlcmxheXMgPSB0aGlzLm92ZXJsYXlzLmluc2VydChuLmtleSwgbmV3IE92ZXJsYXkodCwgbikpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGFzc29jaWF0aW9uIG9mIHRoaXMgb3ZlcmxheSB0byB0aGUgZ2l2ZW4gbGFyZ2VzdEJhdGNoSWQuXG4gICAgICAgIGxldCBpID0gdGhpcy5jci5nZXQodCk7XG4gICAgICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0aGlzLmNyLnNldCh0LCBpKSksIHRoaXMuY3Iuc2V0KHQsIGkuYWRkKG4ua2V5KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNvbGxlY3Rpb24gb2YgcmVmZXJlbmNlcyB0byBhIGRvY3VtZW50IGZyb20gc29tZSBraW5kIG9mIG51bWJlcmVkIGVudGl0eVxuICogKGVpdGhlciBhIHRhcmdldCBJRCBvciBiYXRjaCBJRCkuIEFzIHJlZmVyZW5jZXMgYXJlIGFkZGVkIHRvIG9yIHJlbW92ZWQgZnJvbVxuICogdGhlIHNldCBjb3JyZXNwb25kaW5nIGV2ZW50cyBhcmUgZW1pdHRlZCB0byBhIHJlZ2lzdGVyZWQgZ2FyYmFnZSBjb2xsZWN0b3IuXG4gKlxuICogRWFjaCByZWZlcmVuY2UgaXMgcmVwcmVzZW50ZWQgYnkgYSBEb2N1bWVudFJlZmVyZW5jZSBvYmplY3QuIEVhY2ggb2YgdGhlbVxuICogY29udGFpbnMgZW5vdWdoIGluZm9ybWF0aW9uIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IHRoZSByZWZlcmVuY2UuIFRoZXkgYXJlIGFsbFxuICogc3RvcmVkIHByaW1hcmlseSBpbiBhIHNldCBzb3J0ZWQgYnkga2V5LiBBIGRvY3VtZW50IGlzIGNvbnNpZGVyZWQgZ2FyYmFnZSBpZlxuICogdGhlcmUncyBubyByZWZlcmVuY2VzIGluIHRoYXQgc2V0ICh0aGlzIGNhbiBiZSBlZmZpY2llbnRseSBjaGVja2VkIHRoYW5rcyB0b1xuICogc29ydGluZyBieSBrZXkpLlxuICpcbiAqIFJlZmVyZW5jZVNldCBhbHNvIGtlZXBzIGEgc2Vjb25kYXJ5IHNldCB0aGF0IGNvbnRhaW5zIHJlZmVyZW5jZXMgc29ydGVkIGJ5XG4gKiBJRHMuIFRoaXMgb25lIGlzIHVzZWQgdG8gZWZmaWNpZW50bHkgaW1wbGVtZW50IHJlbW92YWwgb2YgYWxsIHJlZmVyZW5jZXMgYnlcbiAqIHNvbWUgdGFyZ2V0IElELlxuICovIGNsYXNzIF9fUFJJVkFURV9SZWZlcmVuY2VTZXQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IGtleS5cbiAgICAgICAgdGhpcy5sciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5ociksIFxuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IHRhcmdldCBpZC5cbiAgICAgICAgdGhpcy5QciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5Jcik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZSBzZXQgY29udGFpbnMgbm8gcmVmZXJlbmNlcy4gKi8gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubHIuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW4gSUQuICovICAgIGFkZFJlZmVyZW5jZShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCB0KTtcbiAgICAgICAgdGhpcy5sciA9IHRoaXMubHIuYWRkKG4pLCB0aGlzLlByID0gdGhpcy5Qci5hZGQobik7XG4gICAgfVxuICAgIC8qKiBBZGQgcmVmZXJlbmNlcyB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5cyBmb3IgdGhlIGdpdmVuIElELiAqLyAgICBUcihlLCB0KSB7XG4gICAgICAgIGUuZm9yRWFjaCgoZSA9PiB0aGlzLmFkZFJlZmVyZW5jZShlLCB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgcmVmZXJlbmNlIHRvIHRoZSBnaXZlbiBkb2N1bWVudCBrZXkgZm9yIHRoZSBnaXZlblxuICAgICAqIElELlxuICAgICAqLyAgICByZW1vdmVSZWZlcmVuY2UoZSwgdCkge1xuICAgICAgICB0aGlzLkVyKG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIHQpKTtcbiAgICB9XG4gICAgZHIoZSwgdCkge1xuICAgICAgICBlLmZvckVhY2goKGUgPT4gdGhpcy5yZW1vdmVSZWZlcmVuY2UoZSwgdCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGFsbCByZWZlcmVuY2VzIHdpdGggYSBnaXZlbiBJRC4gQ2FsbHMgcmVtb3ZlUmVmKCkgZm9yIGVhY2gga2V5XG4gICAgICogcmVtb3ZlZC5cbiAgICAgKi8gICAgQXIoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IERvY3VtZW50S2V5KG5ldyBSZXNvdXJjZVBhdGgoW10pKSwgbiA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIGUpLCByID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgZSArIDEpLCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLlByLmZvckVhY2hJblJhbmdlKFsgbiwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLkVyKGUpLCBpLnB1c2goZS5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIFJyKCkge1xuICAgICAgICB0aGlzLmxyLmZvckVhY2goKGUgPT4gdGhpcy5FcihlKSkpO1xuICAgIH1cbiAgICBFcihlKSB7XG4gICAgICAgIHRoaXMubHIgPSB0aGlzLmxyLmRlbGV0ZShlKSwgdGhpcy5QciA9IHRoaXMuUHIuZGVsZXRlKGUpO1xuICAgIH1cbiAgICBWcihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgRG9jdW1lbnRLZXkobmV3IFJlc291cmNlUGF0aChbXSkpLCBuID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgZSksIHIgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCBlICsgMSk7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLlByLmZvckVhY2hJblJhbmdlKFsgbiwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICBpID0gaS5hZGQoZS5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIDApLCBuID0gdGhpcy5sci5maXJzdEFmdGVyT3JFcXVhbCh0KTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IG4gJiYgZS5pc0VxdWFsKG4ua2V5KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9Eb2NSZWZlcmVuY2Uge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCB0aGlzLm1yID0gdDtcbiAgICB9XG4gICAgLyoqIENvbXBhcmUgYnkga2V5IHRoZW4gYnkgSUQgKi8gICAgc3RhdGljIGhyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KSB8fCBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLm1yLCB0Lm1yKTtcbiAgICB9XG4gICAgLyoqIENvbXBhcmUgYnkgSUQgdGhlbiBieSBrZXkgKi8gICAgc3RhdGljIElyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUubXIsIHQubXIpIHx8IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlNdXRhdGlvblF1ZXVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gZSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNldCBvZiBhbGwgbXV0YXRpb25zIHRoYXQgaGF2ZSBiZWVuIHNlbnQgYnV0IG5vdCB5ZXQgYmVlbiBhcHBsaWVkIHRvXG4gICAgICAgICAqIHRoZSBiYWNrZW5kLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tdXRhdGlvblF1ZXVlID0gW10sIFxuICAgICAgICAvKiogTmV4dCB2YWx1ZSB0byB1c2Ugd2hlbiBhc3NpZ25pbmcgc2VxdWVudGlhbCBJRHMgdG8gZWFjaCBtdXRhdGlvbiBiYXRjaC4gKi9cbiAgICAgICAgdGhpcy5nciA9IDEsIFxuICAgICAgICAvKiogQW4gb3JkZXJlZCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgbXV0YXRpb25zIGJhdGNoIElEcy4gKi9cbiAgICAgICAgdGhpcy5wciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5ocik7XG4gICAgfVxuICAgIGNoZWNrRW1wdHkoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoMCA9PT0gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2goZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gdGhpcy5ncjtcbiAgICAgICAgdGhpcy5ncisrLCB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoID4gMCAmJiB0aGlzLm11dGF0aW9uUXVldWVbdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBzID0gbmV3IE11dGF0aW9uQmF0Y2goaSwgdCwgbiwgcik7XG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZS5wdXNoKHMpO1xuICAgICAgICAvLyBUcmFjayByZWZlcmVuY2VzIGJ5IGRvY3VtZW50IGtleSBhbmQgaW5kZXggY29sbGVjdGlvbiBwYXJlbnRzLlxuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgcikgdGhpcy5wciA9IHRoaXMucHIuYWRkKG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQua2V5LCBpKSksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0LmtleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShzKTtcbiAgICB9XG4gICAgbG9va3VwTXV0YXRpb25CYXRjaChlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnlyKHQpKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdCArIDEsIHIgPSB0aGlzLndyKG4pLCBpID0gciA8IDAgPyAwIDogcjtcbiAgICAgICAgLy8gVGhlIHJlcXVlc3RlZCBiYXRjaElkIG1heSBzdGlsbCBiZSBvdXQgb2YgcmFuZ2Ugc28gbm9ybWFsaXplIGl0IHRvIHRoZVxuICAgICAgICAvLyBzdGFydCBvZiB0aGUgcXVldWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggPiBpID8gdGhpcy5tdXRhdGlvblF1ZXVlW2ldIDogbnVsbCk7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQoKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgwID09PSB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoID8gLTEgOiB0aGlzLmdyIC0gMSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlcyhlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLm11dGF0aW9uUXVldWUuc2xpY2UoKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ0RvY3VtZW50S2V5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIDApLCByID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5wci5mb3JFYWNoSW5SYW5nZShbIG4sIHIgXSwgKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMueXIoZS5tcik7XG4gICAgICAgICAgICBpLnB1c2godCk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoaSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ0RvY3VtZW50S2V5cyhlLCB0KSB7XG4gICAgICAgIGxldCBuID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIDApLCByID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UoZSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTtcbiAgICAgICAgICAgIHRoaXMucHIuZm9yRWFjaEluUmFuZ2UoWyB0LCByIF0sIChlID0+IHtcbiAgICAgICAgICAgICAgICBuID0gbi5hZGQoZS5tcik7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5TcihuKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ1F1ZXJ5KGUsIHQpIHtcbiAgICAgICAgLy8gVXNlIHRoZSBxdWVyeSBwYXRoIGFzIGEgcHJlZml4IGZvciB0ZXN0aW5nIGlmIGEgZG9jdW1lbnQgbWF0Y2hlcyB0aGVcbiAgICAgICAgLy8gcXVlcnkuXG4gICAgICAgIGNvbnN0IG4gPSB0LnBhdGgsIHIgPSBuLmxlbmd0aCArIDE7XG4gICAgICAgIC8vIENvbnN0cnVjdCBhIGRvY3VtZW50IHJlZmVyZW5jZSBmb3IgYWN0dWFsbHkgc2Nhbm5pbmcgdGhlIGluZGV4LiBVbmxpa2VcbiAgICAgICAgLy8gdGhlIHByZWZpeCB0aGUgZG9jdW1lbnQga2V5IGluIHRoaXMgcmVmZXJlbmNlIG11c3QgaGF2ZSBhbiBldmVuIG51bWJlciBvZlxuICAgICAgICAvLyBzZWdtZW50cy4gVGhlIGVtcHR5IHNlZ21lbnQgY2FuIGJlIHVzZWQgYSBzdWZmaXggb2YgdGhlIHF1ZXJ5IHBhdGhcbiAgICAgICAgLy8gYmVjYXVzZSBpdCBwcmVjZWRlcyBhbGwgb3RoZXIgc2VnbWVudHMgaW4gYW4gb3JkZXJlZCB0cmF2ZXJzYWwuXG4gICAgICAgIGxldCBpID0gbjtcbiAgICAgICAgRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShpKSB8fCAoaSA9IGkuY2hpbGQoXCJcIikpO1xuICAgICAgICBjb25zdCBzID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UobmV3IERvY3VtZW50S2V5KGkpLCAwKTtcbiAgICAgICAgLy8gRmluZCB1bmlxdWUgYmF0Y2hJRHMgcmVmZXJlbmNlZCBieSBhbGwgZG9jdW1lbnRzIHBvdGVudGlhbGx5IG1hdGNoaW5nIHRoZVxuICAgICAgICAvLyBxdWVyeS5cbiAgICAgICAgICAgICAgICBsZXQgbyA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdGhpcy5wci5mb3JFYWNoV2hpbGUoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IGUua2V5LnBhdGg7XG4gICAgICAgICAgICByZXR1cm4gISFuLmlzUHJlZml4T2YodCkgJiYgKFxuICAgICAgICAgICAgLy8gUm93cyB3aXRoIGRvY3VtZW50IGtleXMgbW9yZSB0aGFuIG9uZSBzZWdtZW50IGxvbmdlciB0aGFuIHRoZSBxdWVyeVxuICAgICAgICAgICAgLy8gcGF0aCBjYW4ndCBiZSBtYXRjaGVzLiBGb3IgZXhhbXBsZSwgYSBxdWVyeSBvbiAncm9vbXMnIGNhbid0IG1hdGNoXG4gICAgICAgICAgICAvLyB0aGUgZG9jdW1lbnQgL3Jvb21zL2FiYy9tZXNzYWdlcy94eXguXG4gICAgICAgICAgICAvLyBUT0RPKG1jZyk6IHdlJ2xsIG5lZWQgYSBkaWZmZXJlbnQgc2Nhbm5lciB3aGVuIHdlIGltcGxlbWVudFxuICAgICAgICAgICAgLy8gYW5jZXN0b3IgcXVlcmllcy5cbiAgICAgICAgICAgIHQubGVuZ3RoID09PSByICYmIChvID0gby5hZGQoZS5tcikpLCAhMCk7XG4gICAgICAgIH0pLCBzKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5TcihvKSk7XG4gICAgfVxuICAgIFNyKGUpIHtcbiAgICAgICAgLy8gQ29uc3RydWN0IGFuIGFycmF5IG9mIG1hdGNoaW5nIGJhdGNoZXMsIHNvcnRlZCBieSBiYXRjaElEIHRvIGVuc3VyZSB0aGF0XG4gICAgICAgIC8vIG11bHRpcGxlIG11dGF0aW9ucyBhZmZlY3RpbmcgdGhlIHNhbWUgZG9jdW1lbnQga2V5IGFyZSBhcHBsaWVkIGluIG9yZGVyLlxuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMueXIoZSk7XG4gICAgICAgICAgICBudWxsICE9PSBuICYmIHQucHVzaChuKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbiAgICByZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMCA9PT0gdGhpcy5icih0LmJhdGNoSWQsIFwicmVtb3ZlZFwiKSksIHRoaXMubXV0YXRpb25RdWV1ZS5zaGlmdCgpO1xuICAgICAgICBsZXQgbiA9IHRoaXMucHI7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0Lm11dGF0aW9ucywgKHIgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHIua2V5LCB0LmJhdGNoSWQpO1xuICAgICAgICAgICAgcmV0dXJuIG4gPSBuLmRlbGV0ZShpKSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5tYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCByLmtleSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByID0gbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBDbihlKSB7XG4gICAgICAgIC8vIE5vLW9wIHNpbmNlIHRoZSBtZW1vcnkgbXV0YXRpb24gcXVldWUgZG9lcyBub3QgbWFpbnRhaW4gYSBzZXBhcmF0ZSBjYWNoZS5cbiAgICB9XG4gICAgY29udGFpbnNLZXkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgMCksIHIgPSB0aGlzLnByLmZpcnN0QWZ0ZXJPckVxdWFsKG4pO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodC5pc0VxdWFsKHIgJiYgci5rZXkpKTtcbiAgICB9XG4gICAgcGVyZm9ybUNvbnNpc3RlbmN5Q2hlY2soZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmluZHMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBiYXRjaElkIGluIHRoZSBtdXRhdGlvbiBxdWV1ZSBhbmQgYXNzZXJ0cyB0aGF0XG4gICAgICogdGhlIHJlc3VsdGluZyBpbmRleCBpcyB3aXRoaW4gdGhlIGJvdW5kcyBvZiB0aGUgcXVldWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmF0Y2hJZCAtIFRoZSBiYXRjaElkIHRvIHNlYXJjaCBmb3JcbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQSBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoZSBjYWxsZXIgaXMgZG9pbmcsIHBocmFzZWQgaW4gcGFzc2l2ZVxuICAgICAqIGZvcm0gKGUuZy4gXCJhY2tub3dsZWRnZWRcIiBpbiBhIHJvdXRpbmUgdGhhdCBhY2tub3dsZWRnZXMgYmF0Y2hlcykuXG4gICAgICovICAgIGJyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud3IoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWUuIFRoaXMgb3BlcmF0aW9uXG4gICAgICogaXMgTygxKS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBjb21wdXRlZCBpbmRleCBvZiB0aGUgYmF0Y2ggd2l0aCB0aGUgZ2l2ZW4gYmF0Y2hJZCwgYmFzZWQgb25cbiAgICAgKiB0aGUgc3RhdGUgb2YgdGhlIHF1ZXVlLiBOb3RlIHRoaXMgaW5kZXggY2FuIGJlIG5lZ2F0aXZlIGlmIHRoZSByZXF1ZXN0ZWRcbiAgICAgKiBiYXRjaElkIGhhcyBhbHJlYWR5IGJlZW4gcmVtdm9lZCBmcm9tIHRoZSBxdWV1ZSBvciBwYXN0IHRoZSBlbmQgb2YgdGhlXG4gICAgICogcXVldWUgaWYgdGhlIGJhdGNoSWQgaXMgbGFyZ2VyIHRoYW4gdGhlIGxhc3QgYWRkZWQgYmF0Y2guXG4gICAgICovICAgIHdyKGUpIHtcbiAgICAgICAgaWYgKDAgPT09IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpIFxuICAgICAgICAvLyBBcyBhbiBpbmRleCB0aGlzIGlzIHBhc3QgdGhlIGVuZCBvZiB0aGUgcXVldWVcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIC8vIEV4YW1pbmUgdGhlIGZyb250IG9mIHRoZSBxdWV1ZSB0byBmaWd1cmUgb3V0IHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdGhlXG4gICAgICAgIC8vIGJhdGNoSWQgYW5kIGluZGV4ZXMgaW4gdGhlIGFycmF5LiBOb3RlIHRoYXQgc2luY2UgdGhlIHF1ZXVlIGlzIG9yZGVyZWRcbiAgICAgICAgLy8gYnkgYmF0Y2hJZCwgaWYgdGhlIGZpcnN0IGJhdGNoIGhhcyBhIGxhcmdlciBiYXRjaElkIHRoZW4gdGhlIHJlcXVlc3RlZFxuICAgICAgICAvLyBiYXRjaElkIGRvZXNuJ3QgZXhpc3QgaW4gdGhlIHF1ZXVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBlIC0gdGhpcy5tdXRhdGlvblF1ZXVlWzBdLmJhdGNoSWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgdmVyc2lvbiBvZiBsb29rdXBNdXRhdGlvbkJhdGNoIHRoYXQgZG9lc24ndCByZXR1cm4gYSBwcm9taXNlLCB0aGlzIG1ha2VzXG4gICAgICogb3RoZXIgZnVuY3Rpb25zIHRoYXQgdXNlcyB0aGlzIGNvZGUgZWFzaWVyIHRvIHJlYWQgYW5kIG1vcmUgZWZmaWNlbnQuXG4gICAgICovICAgIHlyKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMud3IoZSk7XG4gICAgICAgIGlmICh0IDwgMCB8fCB0ID49IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlW3RdO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIG1lbW9yeS1vbmx5IFJlbW90ZURvY3VtZW50Q2FjaGUgZm9yIEluZGV4ZWREYi4gVG8gY29uc3RydWN0LCBpbnZva2VcbiAqIGBuZXdNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlKClgLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZUltcGwge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBzaXplciAtIFVzZWQgdG8gYXNzZXNzIHRoZSBzaXplIG9mIGEgZG9jdW1lbnQuIEZvciBlYWdlciBHQywgdGhpcyBpc1xuICAgICAqIGV4cGVjdGVkIHRvIGp1c3QgcmV0dXJuIDAgdG8gYXZvaWQgdW5uZWNlc3NhcmlseSBkb2luZyB0aGUgd29yayBvZlxuICAgICAqIGNhbGN1bGF0aW5nIHRoZSBzaXplLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5EciA9IGUsIFxuICAgICAgICAvKiogVW5kZXJseWluZyBjYWNoZSBvZiBkb2N1bWVudHMgYW5kIHRoZWlyIHJlYWQgdGltZXMuICovXG4gICAgICAgIHRoaXMuZG9jcyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudEVudHJ5TWFwKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgICAgIH0oKSwgXG4gICAgICAgIC8qKiBTaXplIG9mIGFsbCBjYWNoZWQgZG9jdW1lbnRzLiAqL1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBzZXRJbmRleE1hbmFnZXIoZSkge1xuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgdGhlIHN1cHBsaWVkIGVudHJ5IHRvIHRoZSBjYWNoZSBhbmQgdXBkYXRlcyB0aGUgY2FjaGUgc2l6ZSBhcyBhcHByb3ByaWF0ZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgYWRkRW50cnlgICBhcmUgcmVxdWlyZWQgdG8gZ28gdGhyb3VnaCB0aGUgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXJcbiAgICAgKiByZXR1cm5lZCBieSBgbmV3Q2hhbmdlQnVmZmVyKClgLlxuICAgICAqLyAgICBhZGRFbnRyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LmtleSwgciA9IHRoaXMuZG9jcy5nZXQobiksIGkgPSByID8gci5zaXplIDogMCwgcyA9IHRoaXMuRHIodCk7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3MgPSB0aGlzLmRvY3MuaW5zZXJ0KG4sIHtcbiAgICAgICAgICAgIGRvY3VtZW50OiB0Lm11dGFibGVDb3B5KCksXG4gICAgICAgICAgICBzaXplOiBzXG4gICAgICAgIH0pLCB0aGlzLnNpemUgKz0gcyAtIGksIHRoaXMuaW5kZXhNYW5hZ2VyLmFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KGUsIG4ucGF0aC5wb3BMYXN0KCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgZW50cnkgZnJvbSB0aGUgY2FjaGUgYW5kIHVwZGF0ZXMgdGhlIGNhY2hlIHNpemUgYXMgYXBwcm9wcmlhdGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYHJlbW92ZUVudHJ5YCBhcmUgcmVxdWlyZWQgdG8gZ28gdGhyb3VnaCB0aGUgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXJcbiAgICAgKiByZXR1cm5lZCBieSBgbmV3Q2hhbmdlQnVmZmVyKClgLlxuICAgICAqLyAgICByZW1vdmVFbnRyeShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRvY3MuZ2V0KGUpO1xuICAgICAgICB0ICYmICh0aGlzLmRvY3MgPSB0aGlzLmRvY3MucmVtb3ZlKGUpLCB0aGlzLnNpemUgLT0gdC5zaXplKTtcbiAgICB9XG4gICAgZ2V0RW50cnkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5kb2NzLmdldCh0KTtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG4gPyBuLmRvY3VtZW50Lm11dGFibGVDb3B5KCkgOiBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KHQpKTtcbiAgICB9XG4gICAgZ2V0RW50cmllcyhlLCB0KSB7XG4gICAgICAgIGxldCBuID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLmRvY3MuZ2V0KGUpO1xuICAgICAgICAgICAgbiA9IG4uaW5zZXJ0KGUsIHQgPyB0LmRvY3VtZW50Lm11dGFibGVDb3B5KCkgOiBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KGUpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShuKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCB0LCBuLCByKSB7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICAvLyBEb2N1bWVudHMgYXJlIG9yZGVyZWQgYnkga2V5LCBzbyB3ZSBjYW4gdXNlIGEgcHJlZml4IHNjYW4gdG8gbmFycm93IGRvd25cbiAgICAgICAgLy8gdGhlIGRvY3VtZW50cyB3ZSBuZWVkIHRvIG1hdGNoIHRoZSBxdWVyeSBhZ2FpbnN0LlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB0LnBhdGgsIG8gPSBuZXcgRG9jdW1lbnRLZXkocy5jaGlsZChcIlwiKSksIF8gPSB0aGlzLmRvY3MuZ2V0SXRlcmF0b3JGcm9tKG8pO1xuICAgICAgICBmb3IgKDtfLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCB7a2V5OiBlLCB2YWx1ZToge2RvY3VtZW50OiBvfX0gPSBfLmdldE5leHQoKTtcbiAgICAgICAgICAgIGlmICghcy5pc1ByZWZpeE9mKGUucGF0aCkpIGJyZWFrO1xuICAgICAgICAgICAgZS5wYXRoLmxlbmd0aCA+IHMubGVuZ3RoICsgMSB8fCAoX19QUklWQVRFX2luZGV4T2Zmc2V0Q29tcGFyYXRvcihfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRGcm9tRG9jdW1lbnQobyksIG4pIDw9IDAgfHwgKHIuaGFzKG8ua2V5KSB8fCBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKHQsIG8pKSAmJiAoaSA9IGkuaW5zZXJ0KG8ua2V5LCBvLm11dGFibGVDb3B5KCkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGkpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gdGhlIEluZGV4QmFja2ZpbGxlciBpZiBwZXJzaXN0ZW5jZVxuICAgICAgICAvLyBpcyBlbmFibGVkLlxuICAgICAgICBmYWlsKCk7XG4gICAgfVxuICAgIHZyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuZG9jcywgKGUgPT4gdChlKSkpO1xuICAgIH1cbiAgICBuZXdDaGFuZ2VCdWZmZXIoZSkge1xuICAgICAgICAvLyBgdHJhY2tSZW1vdmFsc2AgaXMgaWdub3JlcyBzaW5jZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZSBrZWVwc1xuICAgICAgICAvLyBhIHNlcGFyYXRlIGNoYW5nZWxvZyBhbmQgZG9lcyBub3QgbmVlZCBzcGVjaWFsIGhhbmRsaW5nIGZvciByZW1vdmFscy5cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIodGhpcyk7XG4gICAgfVxuICAgIGdldFNpemUoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5zaXplKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtZW1vcnktb25seSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIEBwYXJhbSBzaXplciAtIFVzZWQgdG8gYXNzZXNzIHRoZSBzaXplIG9mIGEgZG9jdW1lbnQuIEZvciBlYWdlciBHQywgdGhpcyBpc1xuICogZXhwZWN0ZWQgdG8ganVzdCByZXR1cm4gMCB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGRvaW5nIHRoZSB3b3JrIG9mXG4gKiBjYWxjdWxhdGluZyB0aGUgc2l6ZS5cbiAqL1xuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIgZXh0ZW5kcyBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnNyID0gZTtcbiAgICB9XG4gICAgYXBwbHlDaGFuZ2VzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICByLmlzVmFsaWREb2N1bWVudCgpID8gdC5wdXNoKHRoaXMuc3IuYWRkRW50cnkoZSwgcikpIDogdGhpcy5zci5yZW1vdmVFbnRyeShuKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcih0KTtcbiAgICB9XG4gICAgZ2V0RnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3IuZ2V0RW50cnkoZSwgdCk7XG4gICAgfVxuICAgIGdldEFsbEZyb21DYWNoZShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNyLmdldEVudHJpZXMoZSwgdCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5VGFyZ2V0Q2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFwcyBhIHRhcmdldCB0byB0aGUgZGF0YSBhYm91dCB0aGF0IHRhcmdldFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5DciA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KGUpKSwgX19QUklWQVRFX3RhcmdldEVxdWFscyksIFxuICAgICAgICAvKiogVGhlIGxhc3QgcmVjZWl2ZWQgc25hcHNob3QgdmVyc2lvbi4gKi9cbiAgICAgICAgdGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyoqIFRoZSBoaWdoZXN0IG51bWJlcmVkIHRhcmdldCBJRCBlbmNvdW50ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSAwLCBcbiAgICAgICAgLyoqIFRoZSBoaWdoZXN0IHNlcXVlbmNlIG51bWJlciBlbmNvdW50ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5GciA9IDAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBvcmRlcmVkIGJpZGlyZWN0aW9uYWwgbWFwcGluZyBiZXR3ZWVuIGRvY3VtZW50cyBhbmQgdGhlIHJlbW90ZSB0YXJnZXRcbiAgICAgICAgICogSURzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5NciA9IG5ldyBfX1BSSVZBVEVfUmVmZXJlbmNlU2V0LCB0aGlzLnRhcmdldENvdW50ID0gMCwgdGhpcy5PciA9IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvci54bigpO1xuICAgIH1cbiAgICBmb3JFYWNoVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQ3IuZm9yRWFjaCgoKGUsIG4pID0+IHQobikpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24pO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0U2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5Gcik7XG4gICAgfVxuICAgIGFsbG9jYXRlVGFyZ2V0SWQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSB0aGlzLk9yLm5leHQoKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5oaWdoZXN0VGFyZ2V0SWQpO1xuICAgIH1cbiAgICBzZXRUYXJnZXRzTWV0YWRhdGEoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbiAmJiAodGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gbiksIHQgPiB0aGlzLkZyICYmICh0aGlzLkZyID0gdCksIFxuICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBMbihlKSB7XG4gICAgICAgIHRoaXMuQ3Iuc2V0KGUudGFyZ2V0LCBlKTtcbiAgICAgICAgY29uc3QgdCA9IGUudGFyZ2V0SWQ7XG4gICAgICAgIHQgPiB0aGlzLmhpZ2hlc3RUYXJnZXRJZCAmJiAodGhpcy5PciA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IodCksIHRoaXMuaGlnaGVzdFRhcmdldElkID0gdCksIFxuICAgICAgICBlLnNlcXVlbmNlTnVtYmVyID4gdGhpcy5GciAmJiAodGhpcy5GciA9IGUuc2VxdWVuY2VOdW1iZXIpO1xuICAgIH1cbiAgICBhZGRUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTG4odCksIHRoaXMudGFyZ2V0Q291bnQgKz0gMSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlVGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxuKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQ3IuZGVsZXRlKHQudGFyZ2V0KSwgdGhpcy5Nci5Bcih0LnRhcmdldElkKSwgdGhpcy50YXJnZXRDb3VudCAtPSAxLCBcbiAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIGxldCByID0gMDtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5Dci5mb3JFYWNoKCgocywgbykgPT4ge1xuICAgICAgICAgICAgby5zZXF1ZW5jZU51bWJlciA8PSB0ICYmIG51bGwgPT09IG4uZ2V0KG8udGFyZ2V0SWQpICYmICh0aGlzLkNyLmRlbGV0ZShzKSwgaS5wdXNoKHRoaXMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgby50YXJnZXRJZCkpLCBcbiAgICAgICAgICAgIHIrKyk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSkubmV4dCgoKCkgPT4gcikpO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDb3VudChlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnRhcmdldENvdW50KTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLkNyLmdldCh0KSB8fCBudWxsO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobik7XG4gICAgfVxuICAgIGFkZE1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLk1yLlRyKHQsIG4pLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXMoZSwgdCwgbikge1xuICAgICAgICB0aGlzLk1yLmRyKHQsIG4pO1xuICAgICAgICBjb25zdCByID0gdGhpcy5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gciAmJiB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHIubWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKGkpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLk1yLkFyKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLk1yLlZyKHQpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobik7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuTXIuY29udGFpbnNLZXkodCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBtZW1vcnktYmFja2VkIGluc3RhbmNlIG9mIFBlcnNpc3RlbmNlLiBEYXRhIGlzIHN0b3JlZCBvbmx5IGluIFJBTSBhbmRcbiAqIG5vdCBwZXJzaXN0ZWQgYWNyb3NzIHNlc3Npb25zLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5UGVyc2lzdGVuY2Uge1xuICAgIC8qKlxuICAgICAqIFRoZSBjb25zdHJ1Y3RvciBhY2NlcHRzIGEgZmFjdG9yeSBmb3IgY3JlYXRpbmcgYSByZWZlcmVuY2UgZGVsZWdhdGUuIFRoaXNcbiAgICAgKiBhbGxvd3MgYm90aCB0aGUgZGVsZWdhdGUgYW5kIHRoaXMgaW5zdGFuY2UgdG8gaGF2ZSBzdHJvbmcgcmVmZXJlbmNlcyB0b1xuICAgICAqIGVhY2ggb3RoZXIgd2l0aG91dCBoYXZpbmcgbnVsbGFibGUgZmllbGRzIHRoYXQgd291bGQgdGhlbiBuZWVkIHRvIGJlXG4gICAgICogY2hlY2tlZCBvciBhc3NlcnRlZCBvbiBldmVyeSBhY2Nlc3MuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLk5yID0ge30sIHRoaXMub3ZlcmxheXMgPSB7fSwgdGhpcy5CciA9IG5ldyBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UoMCksIHRoaXMuTHIgPSAhMSwgXG4gICAgICAgIHRoaXMuTHIgPSAhMCwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IGUodGhpcyksIHRoaXMua3IgPSBuZXcgX19QUklWQVRFX01lbW9yeVRhcmdldENhY2hlKHRoaXMpO1xuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5SW5kZXhNYW5hZ2VyLCB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3TWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZShlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlSW1wbChlKTtcbiAgICAgICAgfSgoZSA9PiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLnFyKGUpKSksIHRoaXMuc2VyaWFsaXplciA9IG5ldyBfX1BSSVZBVEVfTG9jYWxTZXJpYWxpemVyKHQpLCBcbiAgICAgICAgdGhpcy5RciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5QnVuZGxlQ2FjaGUodGhpcy5zZXJpYWxpemVyKTtcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIC8vIE5vIGR1cmFibGUgc3RhdGUgdG8gZW5zdXJlIGlzIGNsb3NlZCBvbiBzaHV0ZG93bi5cbiAgICAgICAgcmV0dXJuIHRoaXMuTHIgPSAhMSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5McjtcbiAgICB9XG4gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBzZXROZXR3b3JrRW5hYmxlZCgpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGdldEluZGV4TWFuYWdlcihlKSB7XG4gICAgICAgIC8vIFdlIGRvIG5vdCBjdXJyZW50bHkgc3VwcG9ydCBpbmRpY2VzIGZvciBtZW1vcnkgcGVyc2lzdGVuY2UsIHNvIHdlIGNhblxuICAgICAgICAvLyByZXR1cm4gdGhlIHNhbWUgc2hhcmVkIGluc3RhbmNlIG9mIHRoZSBtZW1vcnkgaW5kZXggbWFuYWdlci5cbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5vdmVybGF5c1tlLnRvS2V5KCldO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5RG9jdW1lbnRPdmVybGF5Q2FjaGUsIHRoaXMub3ZlcmxheXNbZS50b0tleSgpXSA9IHQpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgZ2V0TXV0YXRpb25RdWV1ZShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gdGhpcy5OcltlLnRvS2V5KCldO1xuICAgICAgICByZXR1cm4gbiB8fCAobiA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5TXV0YXRpb25RdWV1ZSh0LCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlKSwgdGhpcy5OcltlLnRvS2V5KCldID0gbiksIFxuICAgICAgICBuO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua3I7XG4gICAgfVxuICAgIGdldFJlbW90ZURvY3VtZW50Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGU7XG4gICAgfVxuICAgIGdldEJ1bmRsZUNhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5RcjtcbiAgICB9XG4gICAgcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJNZW1vcnlQZXJzaXN0ZW5jZVwiLCBcIlN0YXJ0aW5nIHRyYW5zYWN0aW9uOlwiLCBlKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5VHJhbnNhY3Rpb24odGhpcy5Cci5uZXh0KCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5LcigpLCBuKHIpLm5leHQoKGUgPT4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS4kcihyKS5uZXh0KCgoKSA9PiBlKSkpKS50b1Byb21pc2UoKS50aGVuKChlID0+IChyLnJhaXNlT25Db21taXR0ZWRFdmVudCgpLCBcbiAgICAgICAgZSkpKTtcbiAgICB9XG4gICAgVXIoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm9yKE9iamVjdC52YWx1ZXModGhpcy5OcikubWFwKChuID0+ICgpID0+IG4uY29udGFpbnNLZXkoZSwgdCkpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1lbW9yeSBwZXJzaXN0ZW5jZSBpcyBub3QgYWN0dWFsbHkgdHJhbnNhY3Rpb25hbCwgYnV0IGZ1dHVyZSBpbXBsZW1lbnRhdGlvbnNcbiAqIG1heSBoYXZlIHRyYW5zYWN0aW9uLXNjb3BlZCBzdGF0ZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5VHJhbnNhY3Rpb24gZXh0ZW5kcyBQZXJzaXN0ZW5jZVRyYW5zYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuY3VycmVudFNlcXVlbmNlTnVtYmVyID0gZTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBlLCBcbiAgICAgICAgLyoqIFRyYWNrcyBhbGwgZG9jdW1lbnRzIHRoYXQgYXJlIGFjdGl2ZSBpbiBRdWVyeSB2aWV3cy4gKi9cbiAgICAgICAgdGhpcy5XciA9IG5ldyBfX1BSSVZBVEVfUmVmZXJlbmNlU2V0LCBcbiAgICAgICAgLyoqIFRoZSBsaXN0IG9mIGRvY3VtZW50cyB0aGF0IGFyZSBwb3RlbnRpYWxseSBHQ2VkIGFmdGVyIGVhY2ggdHJhbnNhY3Rpb24uICovXG4gICAgICAgIHRoaXMuR3IgPSBudWxsO1xuICAgIH1cbiAgICBzdGF0aWMgenIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlKGUpO1xuICAgIH1cbiAgICBnZXQganIoKSB7XG4gICAgICAgIGlmICh0aGlzLkdyKSByZXR1cm4gdGhpcy5HcjtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICBhZGRSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5Xci5hZGRSZWZlcmVuY2UobiwgdCksIHRoaXMuanIuZGVsZXRlKG4udG9TdHJpbmcoKSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVJlZmVyZW5jZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLldyLnJlbW92ZVJlZmVyZW5jZShuLCB0KSwgdGhpcy5qci5hZGQobi50b1N0cmluZygpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgbWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5qci5hZGQodC50b1N0cmluZygpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5Xci5Bcih0LnRhcmdldElkKS5mb3JFYWNoKChlID0+IHRoaXMuanIuYWRkKGUudG9TdHJpbmcoKSkpKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKTtcbiAgICAgICAgcmV0dXJuIG4uZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgdC50YXJnZXRJZCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlLmZvckVhY2goKGUgPT4gdGhpcy5qci5hZGQoZS50b1N0cmluZygpKSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbi5yZW1vdmVUYXJnZXREYXRhKGUsIHQpKSk7XG4gICAgfVxuICAgIEtyKCkge1xuICAgICAgICB0aGlzLkdyID0gbmV3IFNldDtcbiAgICB9XG4gICAgJHIoZSkge1xuICAgICAgICAvLyBSZW1vdmUgbmV3bHkgb3JwaGFuZWQgZG9jdW1lbnRzLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkubmV3Q2hhbmdlQnVmZmVyKCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0aGlzLmpyLCAobiA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gRG9jdW1lbnRLZXkuZnJvbVBhdGgobik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5IcihlLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlIHx8IHQucmVtb3ZlRW50cnkociwgU25hcHNob3RWZXJzaW9uLm1pbigpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh0aGlzLkdyID0gbnVsbCwgdC5hcHBseShlKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkhyKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZSA/IHRoaXMuanIuZGVsZXRlKHQudG9TdHJpbmcoKSkgOiB0aGlzLmpyLmFkZCh0LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHFyKGUpIHtcbiAgICAgICAgLy8gRm9yIGVhZ2VyIEdDLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZSBkb2N1bWVudCBzaXplLCB0aGVyZSBhcmUgbm8gc2l6ZSB0aHJlc2hvbGRzLlxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgSHIoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm9yKFsgKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5Xci5jb250YWluc0tleSh0KSksICgpID0+IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5jb250YWluc0tleShlLCB0KSwgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5VcihlLCB0KSBdKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gZSwgdGhpcy5KciA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLnBhdGgpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKSwgXG4gICAgICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IF9fUFJJVkFURV9uZXdMcnVHYXJiYWdlQ29sbGVjdG9yKHRoaXMsIHQpO1xuICAgIH1cbiAgICBzdGF0aWMgenIoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZShlLCB0KTtcbiAgICB9XG4gICAgLy8gTm8tb3BzLCBwcmVzZW50IHNvIG1lbW9yeSBwZXJzaXN0ZW5jZSBkb2Vzbid0IGhhdmUgdG8gY2FyZSB3aGljaCBkZWxlZ2F0ZVxuICAgIC8vIGl0IGhhcy5cbiAgICBLcigpIHt9XG4gICAgJHIoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZm9yRWFjaFRhcmdldChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkuZm9yRWFjaFRhcmdldChlLCB0KTtcbiAgICB9XG4gICAgem4oZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5KbihlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5nZXRUYXJnZXRDb3VudChlKS5uZXh0KChlID0+IHQubmV4dCgodCA9PiBlICsgdCkpKSk7XG4gICAgfVxuICAgIEpuKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy5qbihlLCAoZSA9PiB7XG4gICAgICAgICAgICB0Kys7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIGpuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuSnIsICgobiwgcikgPT4gdGhpcy5abihlLCBuLCByKS5uZXh0KChlID0+IGUgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogdChyKSkpKSk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHMoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLnJlbW92ZVRhcmdldHMoZSwgdCwgbik7XG4gICAgfVxuICAgIHJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSAwO1xuICAgICAgICBjb25zdCByID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCksIGkgPSByLm5ld0NoYW5nZUJ1ZmZlcigpO1xuICAgICAgICByZXR1cm4gci52cihlLCAociA9PiB0aGlzLlpuKGUsIHIsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZSB8fCAobisrLCBpLnJlbW92ZUVudHJ5KHIsIFNuYXBzaG90VmVyc2lvbi5taW4oKSkpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBtYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpyLnNldCh0LCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LndpdGhTZXF1ZW5jZU51bWJlcihlLmN1cnJlbnRTZXF1ZW5jZU51bWJlcik7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkudXBkYXRlVGFyZ2V0RGF0YShlLCBuKTtcbiAgICB9XG4gICAgYWRkUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSnIuc2V0KG4sIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSnIuc2V0KG4sIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpyLnNldCh0LCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHFyKGUpIHtcbiAgICAgICAgbGV0IHQgPSBlLmtleS50b1N0cmluZygpLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKHQgKz0gX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUoZS5kYXRhLnZhbHVlKSksIHQ7XG4gICAgfVxuICAgIFpuKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5vcihbICgpID0+IHRoaXMucGVyc2lzdGVuY2UuVXIoZSwgdCksICgpID0+IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5jb250YWluc0tleShlLCB0KSwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuSnIuZ2V0KHQpO1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHZvaWQgMCAhPT0gZSAmJiBlID4gbik7XG4gICAgICAgIH0gXSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5nZXRTaXplKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBQZXJmb3JtcyBkYXRhYmFzZSBjcmVhdGlvbiBhbmQgc2NoZW1hIHVwZ3JhZGVzLiAqLyBjbGFzcyBfX1BSSVZBVEVfU2NoZW1hQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGRhdGFiYXNlIGNyZWF0aW9uIGFuZCBzY2hlbWEgdXBncmFkZXMuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgaW4gcHJvZHVjdGlvbiwgdGhpcyBtZXRob2QgaXMgb25seSBldmVyIHVzZWQgdG8gdXBncmFkZSB0aGUgc2NoZW1hXG4gICAgICogdG8gU0NIRU1BX1ZFUlNJT04uIERpZmZlcmVudCB2YWx1ZXMgb2YgdG9WZXJzaW9uIGFyZSBvbmx5IHVzZWQgZm9yIHRlc3RpbmdcbiAgICAgKiBhbmQgbG9jYWwgZmVhdHVyZSBkZXZlbG9wbWVudC5cbiAgICAgKi8gICAgQihlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgX19QUklWQVRFX1NpbXBsZURiVHJhbnNhY3Rpb24oXCJjcmVhdGVPclVwZ3JhZGVcIiwgdCk7XG4gICAgICAgIG4gPCAxICYmIHIgPj0gMSAmJiAoIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVQcmltYXJ5Q2xpZW50U3RvcmUoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcIm93bmVyXCIpO1xuICAgICAgICB9KGUpLCBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlTXV0YXRpb25RdWV1ZShlKSB7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25RdWV1ZXNcIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IFwidXNlcklkXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcIm11dGF0aW9uc1wiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogXCJiYXRjaElkXCIsXG4gICAgICAgICAgICAgICAgYXV0b0luY3JlbWVudDogITBcbiAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwidXNlck11dGF0aW9uc0luZGV4XCIsIHgsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICB9KSwgZS5jcmVhdGVPYmplY3RTdG9yZShcImRvY3VtZW50TXV0YXRpb25zXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogVXBncmFkZSBmdW5jdGlvbiB0byBtaWdyYXRlIHRoZSAnbXV0YXRpb25zJyBzdG9yZSBmcm9tIFYxIHRvIFYzLiBMb2Fkc1xuICogYW5kIHJld3JpdGVzIGFsbCBkYXRhLlxuICovIChlKSwgX19QUklWQVRFX2NyZWF0ZVF1ZXJ5Q2FjaGUoZSksIGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVMZWdhY3lSZW1vdGVEb2N1bWVudENhY2hlKGUpIHtcbiAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIik7XG4gICAgICAgIH0oZSkpO1xuICAgICAgICAvLyBNaWdyYXRpb24gMiB0byBwb3B1bGF0ZSB0aGUgdGFyZ2V0R2xvYmFsIG9iamVjdCBubyBsb25nZXIgbmVlZGVkIHNpbmNlXG4gICAgICAgIC8vIG1pZ3JhdGlvbiAzIHVuY29uZGl0aW9uYWxseSBjbGVhcnMgaXQuXG4gICAgICAgICAgICAgICAgbGV0IHMgPSBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICByZXR1cm4gbiA8IDMgJiYgciA+PSAzICYmIChcbiAgICAgICAgLy8gQnJhbmQgbmV3IGNsaWVudHMgZG9uJ3QgbmVlZCB0byBkcm9wIGFuZCByZWNyZWF0ZS0tb25seSBjbGllbnRzIHRoYXRcbiAgICAgICAgLy8gcG90ZW50aWFsbHkgaGF2ZSBjb3JydXB0IGRhdGEuXG4gICAgICAgIDAgIT09IG4gJiYgKCFmdW5jdGlvbiBfX1BSSVZBVEVfZHJvcFF1ZXJ5Q2FjaGUoZSkge1xuICAgICAgICAgICAgZS5kZWxldGVPYmplY3RTdG9yZShcInRhcmdldERvY3VtZW50c1wiKSwgZS5kZWxldGVPYmplY3RTdG9yZShcInRhcmdldHNcIiksIGUuZGVsZXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRHbG9iYWxcIik7XG4gICAgICAgIH0oZSksIF9fUFJJVkFURV9jcmVhdGVRdWVyeUNhY2hlKGUpKSwgcyA9IHMubmV4dCgoKCkgPT4gXG4gICAgICAgIC8qKlxuICogQ3JlYXRlcyB0aGUgdGFyZ2V0IGdsb2JhbCBzaW5nbGV0b24gcm93LlxuICpcbiAqIEBwYXJhbSB0eG4gLSBUaGUgdmVyc2lvbiB1cGdyYWRlIHRyYW5zYWN0aW9uIGZvciBpbmRleGVkZGJcbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfd3JpdGVFbXB0eVRhcmdldEdsb2JhbEVudHJ5KGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKFwidGFyZ2V0R2xvYmFsXCIpLCBuID0ge1xuICAgICAgICAgICAgICAgIGhpZ2hlc3RUYXJnZXRJZDogMCxcbiAgICAgICAgICAgICAgICBoaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXI6IDAsXG4gICAgICAgICAgICAgICAgbGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbjogU25hcHNob3RWZXJzaW9uLm1pbigpLnRvVGltZXN0YW1wKCksXG4gICAgICAgICAgICAgICAgdGFyZ2V0Q291bnQ6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gdC5wdXQoXCJ0YXJnZXRHbG9iYWxLZXlcIiwgbik7XG4gICAgICAgIH0oaSkpKSksIG4gPCA0ICYmIHIgPj0gNCAmJiAoMCAhPT0gbiAmJiAoXG4gICAgICAgIC8vIFNjaGVtYSB2ZXJzaW9uIDMgdXNlcyBhdXRvLWdlbmVyYXRlZCBrZXlzIHRvIGdlbmVyYXRlIGdsb2JhbGx5IHVuaXF1ZVxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaCBJRHMgKHRoaXMgd2FzIHByZXZpb3VzbHkgZW5zdXJlZCBpbnRlcm5hbGx5IGJ5IHRoZVxuICAgICAgICAvLyBjbGllbnQpLiBUbyBtaWdyYXRlIHRvIHRoZSBuZXcgc2NoZW1hLCB3ZSBoYXZlIHRvIHJlYWQgYWxsIG11dGF0aW9uc1xuICAgICAgICAvLyBhbmQgd3JpdGUgdGhlbSBiYWNrIG91dC4gV2UgcHJlc2VydmUgdGhlIGV4aXN0aW5nIGJhdGNoIElEcyB0byBndWFyYW50ZWVcbiAgICAgICAgLy8gY29uc2lzdGVuY3kgd2l0aCBvdGhlciBvYmplY3Qgc3RvcmVzLiBBbnkgZnVydGhlciBtdXRhdGlvbiBiYXRjaCBJRHMgd2lsbFxuICAgICAgICAvLyBiZSBhdXRvLWdlbmVyYXRlZC5cbiAgICAgICAgcyA9IHMubmV4dCgoKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX3VwZ3JhZGVNdXRhdGlvbkJhdGNoU2NoZW1hQW5kTWlncmF0ZURhdGEoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJtdXRhdGlvbnNcIikuRygpLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIGUuZGVsZXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvbnNcIik7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcIm11dGF0aW9uc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiYmF0Y2hJZFwiLFxuICAgICAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwidXNlck11dGF0aW9uc0luZGV4XCIsIHgsIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0LnN0b3JlKFwibXV0YXRpb25zXCIpLCBpID0gbi5tYXAoKGUgPT4gci5wdXQoZSkpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0oZSwgaSkpKSksIHMgPSBzLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlQ2xpZW50TWV0YWRhdGFTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcImNsaWVudE1ldGFkYXRhXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJjbGllbnRJZFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KGUpO1xuICAgICAgICB9KSkpLCBuIDwgNSAmJiByID49IDUgJiYgKHMgPSBzLm5leHQoKCgpID0+IHRoaXMuWXIoaSkpKSksIG4gPCA2ICYmIHIgPj0gNiAmJiAocyA9IHMubmV4dCgoKCkgPT4gKGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVEb2N1bWVudEdsb2JhbFN0b3JlKGUpIHtcbiAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiKTtcbiAgICAgICAgfShlKSwgdGhpcy5acihpKSkpKSksIG4gPCA3ICYmIHIgPj0gNyAmJiAocyA9IHMubmV4dCgoKCkgPT4gdGhpcy5YcihpKSkpKSwgbiA8IDggJiYgciA+PSA4ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLmVpKGUsIGkpKSkpLCBcbiAgICAgICAgbiA8IDkgJiYgciA+PSA5ICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBNdWx0aS1UYWIgdXNlZCB0byBtYW5hZ2UgaXRzIG93biBjaGFuZ2Vsb2csIGJ1dCB0aGlzIGhhcyBiZWVuIG1vdmVkXG4gICAgICAgICAgICAvLyB0byB0aGUgRGJSZW1vdGVEb2N1bWVudCBvYmplY3Qgc3RvcmUgaXRzZWxmLiBTaW5jZSB0aGUgcHJldmlvdXMgY2hhbmdlXG4gICAgICAgICAgICAvLyBsb2cgb25seSBjb250YWluZWQgdHJhbnNpZW50IGRhdGEsIHdlIGNhbiBkcm9wIGl0cyBvYmplY3Qgc3RvcmUuXG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2Ryb3BSZW1vdGVEb2N1bWVudENoYW5nZXNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFwicmVtb3RlRG9jdW1lbnRDaGFuZ2VzXCIpICYmIGUuZGVsZXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudENoYW5nZXNcIik7XG4gICAgICAgICAgICB9KGUpO1xuICAgICAgICAgICAgLy8gTm90ZTogU2NoZW1hIHZlcnNpb24gOSB1c2VkIHRvIGNyZWF0ZSBhIHJlYWQgdGltZSBpbmRleCBmb3IgdGhlXG4gICAgICAgICAgICAvLyBSZW1vdGVEb2N1bWVudENhY2hlLiBUaGlzIGlzIG5vdyBkb25lIHdpdGggc2NoZW1hIHZlcnNpb24gMTMuXG4gICAgICAgICAgICAgICAgfSkpKSwgbiA8IDEwICYmIHIgPj0gMTAgJiYgKHMgPSBzLm5leHQoKCgpID0+IHRoaXMudGkoaSkpKSksIG4gPCAxMSAmJiByID49IDExICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUJ1bmRsZXNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcImJ1bmRsZXNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJ1bmRsZUlkXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSksIGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVOYW1lZFF1ZXJpZXNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcIm5hbWVkUXVlcmllc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwibmFtZVwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KGUpO1xuICAgICAgICB9KSkpLCBuIDwgMTIgJiYgciA+PSAxMiAmJiAocyA9IHMubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVEb2N1bWVudE92ZXJsYXlTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJkb2N1bWVudE92ZXJsYXlzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogelxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHQuY3JlYXRlSW5kZXgoXCJjb2xsZWN0aW9uUGF0aE92ZXJsYXlJbmRleFwiLCBqLCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KSwgdC5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cE92ZXJsYXlJbmRleFwiLCBILCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgIH0pKSksIG4gPCAxMyAmJiByID49IDEzICYmIChzID0gcy5uZXh0KCgoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlUmVtb3RlRG9jdW1lbnRDYWNoZShlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5jcmVhdGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50c1YxNFwiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogTlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0LmNyZWF0ZUluZGV4KFwiZG9jdW1lbnRLZXlJbmRleFwiLCBCKSwgdC5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIEwpO1xuICAgICAgICB9KGUpKSkubmV4dCgoKCkgPT4gdGhpcy5uaShlLCBpKSkpLm5leHQoKCgpID0+IGUuZGVsZXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIikpKSksIFxuICAgICAgICBuIDwgMTQgJiYgciA+PSAxNCAmJiAocyA9IHMubmV4dCgoKCkgPT4gdGhpcy5yaShlLCBpKSkpKSwgbiA8IDE1ICYmIHIgPj0gMTUgJiYgKHMgPSBzLm5leHQoKCgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVGaWVsZEluZGV4KGUpIHtcbiAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJpbmRleENvbmZpZ3VyYXRpb25cIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiaW5kZXhJZFwiLFxuICAgICAgICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6ICEwXG4gICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJpbmRleFN0YXRlXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiAkXG4gICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcInNlcXVlbmNlTnVtYmVySW5kZXhcIiwgVSwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4RW50cmllc1wiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogV1xuICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJkb2N1bWVudEtleUluZGV4XCIsIEcsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfShlKSkpKSwgcztcbiAgICB9XG4gICAgWnIoZSkge1xuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIHJldHVybiBlLnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpLlooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICB0ICs9IF9fUFJJVkFURV9kYkRvY3VtZW50U2l6ZShuKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB7XG4gICAgICAgICAgICAgICAgYnl0ZVNpemU6IHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gZS5zdG9yZShcInJlbW90ZURvY3VtZW50R2xvYmFsXCIpLnB1dChcInJlbW90ZURvY3VtZW50R2xvYmFsS2V5XCIsIG4pO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFlyKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuc3RvcmUoXCJtdXRhdGlvblF1ZXVlc1wiKSwgbiA9IGUuc3RvcmUoXCJtdXRhdGlvbnNcIik7XG4gICAgICAgIHJldHVybiB0LkcoKS5uZXh0KCh0ID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQsICh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIHQudXNlcklkLCAtMSBdLCBbIHQudXNlcklkLCB0Lmxhc3RBY2tub3dsZWRnZWRCYXRjaElkIF0pO1xuICAgICAgICAgICAgcmV0dXJuIG4uRyhcInVzZXJNdXRhdGlvbnNJbmRleFwiLCByKS5uZXh0KChuID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKG4sIChuID0+IHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChuLnVzZXJJZCA9PT0gdC51c2VySWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIG4pO1xuICAgICAgICAgICAgICAgIHJldHVybiByZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQudXNlcklkLCByKS5uZXh0KCgoKSA9PiB7fSkpO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnN1cmVzIHRoYXQgZXZlcnkgZG9jdW1lbnQgaW4gdGhlIHJlbW90ZSBkb2N1bWVudCBjYWNoZSBoYXMgYSBjb3JyZXNwb25kaW5nIHNlbnRpbmVsIHJvd1xuICAgICAqIHdpdGggYSBzZXF1ZW5jZSBudW1iZXIuIE1pc3Npbmcgcm93cyBhcmUgZ2l2ZW4gdGhlIG1vc3QgcmVjZW50bHkgdXNlZCBzZXF1ZW5jZSBudW1iZXIuXG4gICAgICovICAgIFhyKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuc3RvcmUoXCJ0YXJnZXREb2N1bWVudHNcIiksIG4gPSBlLnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpO1xuICAgICAgICByZXR1cm4gZS5zdG9yZShcInRhcmdldEdsb2JhbFwiKS5nZXQoXCJ0YXJnZXRHbG9iYWxLZXlcIikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgICAgICByZXR1cm4gbi5aKCgobiwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgUmVzb3VyY2VQYXRoKG4pLCBvID0gZnVuY3Rpb24gX19QUklWQVRFX3NlbnRpbmVsS2V5KGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgMCwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlKSBdO1xuICAgICAgICAgICAgICAgIH0ocyk7XG4gICAgICAgICAgICAgICAgci5wdXNoKHQuZ2V0KG8pLm5leHQoKG4gPT4gbiA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkgOiAobiA9PiB0LnB1dCh7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldElkOiAwLFxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKG4pLFxuICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcjogZS5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXJcbiAgICAgICAgICAgICAgICB9KSkocykpKSk7XG4gICAgICAgICAgICB9KSkubmV4dCgoKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBlaShlLCB0KSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgaW5kZXguXG4gICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJjb2xsZWN0aW9uUGFyZW50c1wiLCB7XG4gICAgICAgICAgICBrZXlQYXRoOiBLXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBuID0gdC5zdG9yZShcImNvbGxlY3Rpb25QYXJlbnRzXCIpLCByID0gbmV3IF9fUFJJVkFURV9NZW1vcnlDb2xsZWN0aW9uUGFyZW50SW5kZXgsIGFkZEVudHJ5ID0gZSA9PiB7XG4gICAgICAgICAgICBpZiAoci5hZGQoZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5sYXN0U2VnbWVudCgpLCByID0gZS5wb3BMYXN0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucHV0KHtcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbklkOiB0LFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgocilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gSGVscGVyIHRvIGFkZCBhbiBpbmRleCBlbnRyeSBpZmYgd2UgaGF2ZW4ndCBhbHJlYWR5IHdyaXR0ZW4gaXQuXG4gICAgICAgICAgICAgICAgLy8gSW5kZXggZXhpc3RpbmcgcmVtb3RlIGRvY3VtZW50cy5cbiAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIikuWih7XG4gICAgICAgICAgICBZOiAhMFxuICAgICAgICB9LCAoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgUmVzb3VyY2VQYXRoKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGFkZEVudHJ5KG4ucG9wTGFzdCgpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQuc3RvcmUoXCJkb2N1bWVudE11dGF0aW9uc1wiKS5aKHtcbiAgICAgICAgICAgIFk6ICEwXG4gICAgICAgIH0sICgoW2UsIHQsIG5dLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aCh0KTtcbiAgICAgICAgICAgIHJldHVybiBhZGRFbnRyeShpLnBvcExhc3QoKSk7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICB0aShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKFwidGFyZ2V0c1wiKTtcbiAgICAgICAgcmV0dXJuIHQuWigoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZnJvbURiVGFyZ2V0KG4pLCBpID0gX19QUklWQVRFX3RvRGJUYXJnZXQodGhpcy5zZXJpYWxpemVyLCByKTtcbiAgICAgICAgICAgIHJldHVybiB0LnB1dChpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBuaShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpLCByID0gW107XG4gICAgICAgIHJldHVybiBuLlooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gdC5zdG9yZShcInJlbW90ZURvY3VtZW50c1YxNFwiKSwgcyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9leHRyYWN0S2V5KGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5kb2N1bWVudCA/IG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhlLmRvY3VtZW50Lm5hbWUpLnBvcEZpcnN0KDUpKSA6IGUubm9Eb2N1bWVudCA/IERvY3VtZW50S2V5LmZyb21TZWdtZW50cyhlLm5vRG9jdW1lbnQucGF0aCkgOiBlLnVua25vd25Eb2N1bWVudCA/IERvY3VtZW50S2V5LmZyb21TZWdtZW50cyhlLnVua25vd25Eb2N1bWVudC5wYXRoKSA6IGZhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChuKS5wYXRoLnRvQXJyYXkoKSwgbyA9IHtcbiAgICAgICAgICAgICAgICBwcmVmaXhQYXRoOiBzLnNsaWNlKDAsIHMubGVuZ3RoIC0gMiksXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbkdyb3VwOiBzW3MubGVuZ3RoIC0gMl0sXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZDogc1tzLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBuLnJlYWRUaW1lIHx8IFsgMCwgMCBdLFxuICAgICAgICAgICAgICAgIHVua25vd25Eb2N1bWVudDogbi51bmtub3duRG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgbm9Eb2N1bWVudDogbi5ub0RvY3VtZW50LFxuICAgICAgICAgICAgICAgIGRvY3VtZW50OiBuLmRvY3VtZW50LFxuICAgICAgICAgICAgICAgIGhhc0NvbW1pdHRlZE11dGF0aW9uczogISFuLmhhc0NvbW1pdHRlZE11dGF0aW9uc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHIucHVzaChpLnB1dChvKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihyKSkpO1xuICAgIH1cbiAgICByaShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnN0b3JlKFwibXV0YXRpb25zXCIpLCByID0gX19QUklWQVRFX25ld0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUodGhpcy5zZXJpYWxpemVyKSwgaSA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5UGVyc2lzdGVuY2UoX19QUklWQVRFX01lbW9yeUVhZ2VyRGVsZWdhdGUuenIsIHRoaXMuc2VyaWFsaXplci5jdCk7XG4gICAgICAgIHJldHVybiBuLkcoKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgTWFwO1xuICAgICAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHQ7XG4gICAgICAgICAgICAgICAgbGV0IHIgPSBudWxsICE9PSAodCA9IG4uZ2V0KGUudXNlcklkKSkgJiYgdm9pZCAwICE9PSB0ID8gdCA6IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgZSkua2V5cygpLmZvckVhY2goKGUgPT4gciA9IHIuYWRkKGUpKSksIFxuICAgICAgICAgICAgICAgIG4uc2V0KGUudXNlcklkLCByKTtcbiAgICAgICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gobiwgKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBVc2VyKG4pLCBvID0gX19QUklWQVRFX0luZGV4ZWREYkRvY3VtZW50T3ZlcmxheUNhY2hlLmx0KHRoaXMuc2VyaWFsaXplciwgcyksIF8gPSBpLmdldEluZGV4TWFuYWdlcihzKSwgYSA9IF9fUFJJVkFURV9JbmRleGVkRGJNdXRhdGlvblF1ZXVlLmx0KHMsIHRoaXMuc2VyaWFsaXplciwgXywgaS5yZWZlcmVuY2VEZWxlZ2F0ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMb2NhbERvY3VtZW50c1ZpZXcociwgYSwgbywgXykucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMobmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbih0LCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUpLCBlKS5uZXh0KCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVRdWVyeUNhY2hlKGUpIHtcbiAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwidGFyZ2V0RG9jdW1lbnRzXCIsIHtcbiAgICAgICAga2V5UGF0aDogcVxuICAgIH0pLmNyZWF0ZUluZGV4KFwiZG9jdW1lbnRUYXJnZXRzSW5kZXhcIiwgUSwge1xuICAgICAgICB1bmlxdWU6ICEwXG4gICAgfSk7XG4gICAgLy8gTk9URTogVGhpcyBpcyB1bmlxdWUgb25seSBiZWNhdXNlIHRoZSBUYXJnZXRJZCBpcyB0aGUgc3VmZml4LlxuICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRzXCIsIHtcbiAgICAgICAga2V5UGF0aDogXCJ0YXJnZXRJZFwiXG4gICAgfSkuY3JlYXRlSW5kZXgoXCJxdWVyeVRhcmdldHNJbmRleFwiLCBrLCB7XG4gICAgICAgIHVuaXF1ZTogITBcbiAgICB9KSwgZS5jcmVhdGVPYmplY3RTdG9yZShcInRhcmdldEdsb2JhbFwiKTtcbn1cblxuY29uc3QgQWUgPSBcIkZhaWxlZCB0byBvYnRhaW4gZXhjbHVzaXZlIGFjY2VzcyB0byB0aGUgcGVyc2lzdGVuY2UgbGF5ZXIuIFRvIGFsbG93IHNoYXJlZCBhY2Nlc3MsIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24gaGFzIHRvIGJlIGVuYWJsZWQgaW4gYWxsIHRhYnMuIElmIHlvdSBhcmUgdXNpbmcgYGV4cGVyaW1lbnRhbEZvcmNlT3duaW5nVGFiOnRydWVgLCBtYWtlIHN1cmUgdGhhdCBvbmx5IG9uZSB0YWIgaGFzIHBlcnNpc3RlbmNlIGVuYWJsZWQgYXQgYW55IGdpdmVuIHRpbWUuXCI7XG5cbi8qKlxuICogT2xkZXN0IGFjY2VwdGFibGUgYWdlIGluIG1pbGxpc2Vjb25kcyBmb3IgY2xpZW50IG1ldGFkYXRhIGJlZm9yZSB0aGUgY2xpZW50XG4gKiBpcyBjb25zaWRlcmVkIGluYWN0aXZlIGFuZCBpdHMgYXNzb2NpYXRlZCBkYXRhIGlzIGdhcmJhZ2UgY29sbGVjdGVkLlxuICovXG4vKipcbiAqIEFuIEluZGV4ZWREQi1iYWNrZWQgaW5zdGFuY2Ugb2YgUGVyc2lzdGVuY2UuIERhdGEgaXMgc3RvcmVkIHBlcnNpc3RlbnRseVxuICogYWNyb3NzIHNlc3Npb25zLlxuICpcbiAqIE9uIFdlYiBvbmx5LCB0aGUgRmlyZXN0b3JlIFNES3Mgc3VwcG9ydCBzaGFyZWQgYWNjZXNzIHRvIGl0cyBwZXJzaXN0ZW5jZVxuICogbGF5ZXIuIFRoaXMgYWxsb3dzIG11bHRpcGxlIGJyb3dzZXIgdGFicyB0byByZWFkIGFuZCB3cml0ZSB0byBJbmRleGVkRGIgYW5kXG4gKiB0byBzeW5jaHJvbml6ZSBzdGF0ZSBldmVuIHdpdGhvdXQgbmV0d29yayBjb25uZWN0aXZpdHkuIFNoYXJlZCBhY2Nlc3MgaXNcbiAqIGN1cnJlbnRseSBvcHRpb25hbCBhbmQgbm90IGVuYWJsZWQgdW5sZXNzIGFsbCBjbGllbnRzIGludm9rZVxuICogYGVuYWJsZVBlcnNpc3RlbmNlKClgIHdpdGggYHtzeW5jaHJvbml6ZVRhYnM6dHJ1ZX1gLlxuICpcbiAqIEluIG11bHRpLXRhYiBtb2RlLCBpZiBtdWx0aXBsZSBjbGllbnRzIGFyZSBhY3RpdmUgYXQgdGhlIHNhbWUgdGltZSwgdGhlIFNES1xuICogd2lsbCBkZXNpZ25hdGUgb25lIGNsaWVudCBhcyB0aGUg4oCccHJpbWFyeSBjbGllbnTigJ0uIEFuIGVmZm9ydCBpcyBtYWRlIHRvIHBpY2tcbiAqIGEgdmlzaWJsZSwgbmV0d29yay1jb25uZWN0ZWQgYW5kIGFjdGl2ZSBjbGllbnQsIGFuZCB0aGlzIGNsaWVudCBpc1xuICogcmVzcG9uc2libGUgZm9yIGxldHRpbmcgb3RoZXIgY2xpZW50cyBrbm93IGFib3V0IGl0cyBwcmVzZW5jZS4gVGhlIHByaW1hcnlcbiAqIGNsaWVudCB3cml0ZXMgYSB1bmlxdWUgY2xpZW50LWdlbmVyYXRlZCBpZGVudGlmaWVyICh0aGUgY2xpZW50IElEKSB0b1xuICogSW5kZXhlZERi4oCZcyDigJxvd25lcuKAnSBzdG9yZSBldmVyeSA0IHNlY29uZHMuIElmIHRoZSBwcmltYXJ5IGNsaWVudCBmYWlscyB0b1xuICogdXBkYXRlIHRoaXMgZW50cnksIGFub3RoZXIgY2xpZW50IGNhbiBhY3F1aXJlIHRoZSBsZWFzZSBhbmQgdGFrZSBvdmVyIGFzXG4gKiBwcmltYXJ5LlxuICpcbiAqIFNvbWUgcGVyc2lzdGVuY2Ugb3BlcmF0aW9ucyBpbiB0aGUgU0RLIGFyZSBkZXNpZ25hdGVkIGFzIHByaW1hcnktY2xpZW50IG9ubHlcbiAqIG9wZXJhdGlvbnMuIFRoaXMgaW5jbHVkZXMgdGhlIGFja25vd2xlZGdtZW50IG9mIG11dGF0aW9ucyBhbmQgYWxsIHVwZGF0ZXMgb2ZcbiAqIHJlbW90ZSBkb2N1bWVudHMuIFRoZSBlZmZlY3RzIG9mIHRoZXNlIG9wZXJhdGlvbnMgYXJlIHdyaXR0ZW4gdG8gcGVyc2lzdGVuY2VcbiAqIGFuZCB0aGVuIGJyb2FkY2FzdCB0byBvdGhlciB0YWJzIHZpYSBMb2NhbFN0b3JhZ2UgKHNlZVxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWApLCB3aGljaCB0aGVuIHJlZnJlc2ggdGhlaXIgc3RhdGUgZnJvbVxuICogcGVyc2lzdGVuY2UuXG4gKlxuICogU2ltaWxhcmx5LCB0aGUgcHJpbWFyeSBjbGllbnQgbGlzdGVucyB0byBub3RpZmljYXRpb25zIHNlbnQgYnkgc2Vjb25kYXJ5XG4gKiBjbGllbnRzIHRvIGRpc2NvdmVyIHBlcnNpc3RlbmNlIGNoYW5nZXMgd3JpdHRlbiBieSBzZWNvbmRhcnkgY2xpZW50cywgc3VjaCBhc1xuICogdGhlIGFkZGl0aW9uIG9mIG5ldyBtdXRhdGlvbnMgYW5kIHF1ZXJ5IHRhcmdldHMuXG4gKlxuICogSWYgbXVsdGktdGFiIGlzIG5vdCBlbmFibGVkIGFuZCBhbm90aGVyIHRhYiBhbHJlYWR5IG9idGFpbmVkIHRoZSBwcmltYXJ5XG4gKiBsZWFzZSwgSW5kZXhlZERiUGVyc2lzdGVuY2UgZW50ZXJzIGEgZmFpbGVkIHN0YXRlIGFuZCBhbGwgc3Vic2VxdWVudFxuICogb3BlcmF0aW9ucyB3aWxsIGF1dG9tYXRpY2FsbHkgZmFpbC5cbiAqXG4gKiBBZGRpdGlvbmFsbHksIHRoZXJlIGlzIGFuIG9wdGltaXphdGlvbiBzbyB0aGF0IHdoZW4gYSB0YWIgaXMgY2xvc2VkLCB0aGVcbiAqIHByaW1hcnkgbGVhc2UgaXMgcmVsZWFzZWQgaW1tZWRpYXRlbHkgKHRoaXMgaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgdG8gbWFrZVxuICogc3VyZSB0aGF0IGEgcmVmcmVzaGVkIHRhYiBpcyBhYmxlIHRvIGltbWVkaWF0ZWx5IHJlLWFjcXVpcmUgdGhlIHByaW1hcnlcbiAqIGxlYXNlKS4gVW5mb3J0dW5hdGVseSwgSW5kZXhlZERCIGNhbm5vdCBiZSByZWxpYWJseSB1c2VkIGluIHdpbmRvdy51bmxvYWRcbiAqIHNpbmNlIGl0IGlzIGFuIGFzeW5jaHJvbm91cyBBUEkuIFNvIGluIGFkZGl0aW9uIHRvIGF0dGVtcHRpbmcgdG8gZ2l2ZSB1cCB0aGVcbiAqIGxlYXNlLCB0aGUgbGVhc2Vob2xkZXIgd3JpdGVzIGl0cyBjbGllbnQgSUQgdG8gYSBcInpvbWJpZWRDbGllbnRcIiBlbnRyeSBpblxuICogTG9jYWxTdG9yYWdlIHdoaWNoIGFjdHMgYXMgYW4gaW5kaWNhdG9yIHRoYXQgYW5vdGhlciB0YWIgc2hvdWxkIGdvIGFoZWFkIGFuZFxuICogdGFrZSB0aGUgcHJpbWFyeSBsZWFzZSBpbW1lZGlhdGVseSByZWdhcmRsZXNzIG9mIHRoZSBjdXJyZW50IGxlYXNlIHRpbWVzdGFtcC5cbiAqXG4gKiBUT0RPKGIvMTE0MjI2MjM0KTogUmVtb3ZlIGBzeW5jaHJvbml6ZVRhYnNgIHNlY3Rpb24gd2hlbiBtdWx0aS10YWIgaXMgbm9cbiAqIGxvbmdlciBvcHRpb25hbC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlBlcnNpc3RlbmNlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIHN5bmNocm9uaXplIHRoZSBpbi1tZW1vcnkgc3RhdGUgb2YgbXVsdGlwbGUgdGFicyBhbmQgc2hhcmVcbiAgICAgKiBhY2Nlc3MgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gICAgICovXG4gICAgZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSwgXG4gICAgLyoqXG4gICAgICogSWYgc2V0IHRvIHRydWUsIGZvcmNlZnVsbHkgb2J0YWlucyBkYXRhYmFzZSBhY2Nlc3MuIEV4aXN0aW5nIHRhYnMgd2lsbFxuICAgICAqIG5vIGxvbmdlciBiZSBhYmxlIHRvIGFjY2VzcyBJbmRleGVkREIuXG4gICAgICovXG4gICAgdSwgYyA9IDE1KSB7XG4gICAgICAgIGlmICh0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uID0gZSwgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IHQsIHRoaXMuY2xpZW50SWQgPSBuLCBcbiAgICAgICAgdGhpcy5paSA9IGksIHRoaXMud2luZG93ID0gcywgdGhpcy5kb2N1bWVudCA9IG8sIHRoaXMuc2kgPSBhLCB0aGlzLm9pID0gdSwgdGhpcy5faSA9IGMsIFxuICAgICAgICB0aGlzLkJyID0gbnVsbCwgdGhpcy5MciA9ICExLCB0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLm5ldHdvcmtFbmFibGVkID0gITAsIFxuICAgICAgICAvKiogT3VyIHdpbmRvdy51bmxvYWQgaGFuZGxlciwgaWYgcmVnaXN0ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5haSA9IG51bGwsIHRoaXMuaW5Gb3JlZ3JvdW5kID0gITEsIFxuICAgICAgICAvKiogT3VyICd2aXNpYmlsaXR5Y2hhbmdlJyBsaXN0ZW5lciBpZiByZWdpc3RlcmVkLiAqL1xuICAgICAgICB0aGlzLnVpID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgY2xpZW50IG1ldGFkYXRhIHJlZnJlc2ggdGFzay4gKi9cbiAgICAgICAgdGhpcy5jaSA9IG51bGwsIFxuICAgICAgICAvKiogVGhlIGxhc3QgdGltZSB3ZSBnYXJiYWdlIGNvbGxlY3RlZCB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS4gKi9cbiAgICAgICAgdGhpcy5saSA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgXG4gICAgICAgIC8qKiBBIGxpc3RlbmVyIHRvIG5vdGlmeSBvbiBwcmltYXJ5IHN0YXRlIGNoYW5nZXMuICovXG4gICAgICAgIHRoaXMuaGkgPSBlID0+IFByb21pc2UucmVzb2x2ZSgpLCAhX19QUklWQVRFX0luZGV4ZWREYlBlcnNpc3RlbmNlLnYoKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuVU5JTVBMRU1FTlRFRCwgXCJUaGlzIHBsYXRmb3JtIGlzIGVpdGhlciBtaXNzaW5nIEluZGV4ZWREQiBvciBpcyBrbm93biB0byBoYXZlIGFuIGluY29tcGxldGUgaW1wbGVtZW50YXRpb24uIE9mZmxpbmUgcGVyc2lzdGVuY2UgaGFzIGJlZW4gZGlzYWJsZWQuXCIpO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJMcnVEZWxlZ2F0ZUltcGwodGhpcywgciksIHRoaXMuUGkgPSB0ICsgXCJtYWluXCIsIFxuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBuZXcgX19QUklWQVRFX0xvY2FsU2VyaWFsaXplcihfKSwgdGhpcy5JaSA9IG5ldyBfX1BSSVZBVEVfU2ltcGxlRGIodGhpcy5QaSwgdGhpcy5faSwgbmV3IF9fUFJJVkFURV9TY2hlbWFDb252ZXJ0ZXIodGhpcy5zZXJpYWxpemVyKSksIFxuICAgICAgICB0aGlzLmtyID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUYXJnZXRDYWNoZSh0aGlzLnJlZmVyZW5jZURlbGVnYXRlLCB0aGlzLnNlcmlhbGl6ZXIpLCBcbiAgICAgICAgdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlID0gX19QUklWQVRFX25ld0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUodGhpcy5zZXJpYWxpemVyKSwgXG4gICAgICAgIHRoaXMuUXIgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYkJ1bmRsZUNhY2hlLCB0aGlzLndpbmRvdyAmJiB0aGlzLndpbmRvdy5sb2NhbFN0b3JhZ2UgPyB0aGlzLlRpID0gdGhpcy53aW5kb3cubG9jYWxTdG9yYWdlIDogKHRoaXMuVGkgPSBudWxsLCBcbiAgICAgICAgITEgPT09IHUgJiYgX19QUklWQVRFX2xvZ0Vycm9yKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJMb2NhbFN0b3JhZ2UgaXMgdW5hdmFpbGFibGUuIEFzIGEgcmVzdWx0LCBwZXJzaXN0ZW5jZSBtYXkgbm90IHdvcmsgcmVsaWFibHkuIEluIHBhcnRpY3VsYXIgZW5hYmxlUGVyc2lzdGVuY2UoKSBjb3VsZCBmYWlsIGltbWVkaWF0ZWx5IGFmdGVyIHJlZnJlc2hpbmcgdGhlIHBhZ2UuXCIpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0ZW1wdCB0byBzdGFydCBJbmRleGVkRGIgcGVyc2lzdGVuY2UuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHBlcnNpc3RlbmNlIHdhcyBlbmFibGVkLlxuICAgICAqLyAgICBzdGFydCgpIHtcbiAgICAgICAgLy8gTk9URTogVGhpcyBpcyBleHBlY3RlZCB0byBmYWlsIHNvbWV0aW1lcyAoaW4gdGhlIGNhc2Ugb2YgYW5vdGhlciB0YWJcbiAgICAgICAgLy8gYWxyZWFkeSBoYXZpbmcgdGhlIHBlcnNpc3RlbmNlIGxvY2spLCBzbyBpdCdzIHRoZSBmaXJzdCB0aGluZyB3ZSBzaG91bGRcbiAgICAgICAgLy8gZG8uXG4gICAgICAgIHJldHVybiB0aGlzLkVpKCkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUHJpbWFyeSAmJiAhdGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbikgXG4gICAgICAgICAgICAvLyBGYWlsIGBzdGFydCgpYCBpZiBgc3luY2hyb25pemVUYWJzYCBpcyBkaXNhYmxlZCBhbmQgd2UgY2Fubm90XG4gICAgICAgICAgICAvLyBvYnRhaW4gdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBBZSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaSgpLCB0aGlzLkFpKCksIHRoaXMuUmkoKSwgdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlclwiLCBcInJlYWRvbmx5XCIsIChlID0+IHRoaXMua3IuZ2V0SGlnaGVzdFNlcXVlbmNlTnVtYmVyKGUpKSk7XG4gICAgICAgIH0pKS50aGVuKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuQnIgPSBuZXcgX19QUklWQVRFX0xpc3RlblNlcXVlbmNlKGUsIHRoaXMuc2kpO1xuICAgICAgICB9KSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5MciA9ICEwO1xuICAgICAgICB9KSkuY2F0Y2goKGUgPT4gKHRoaXMuSWkgJiYgdGhpcy5JaS5jbG9zZSgpLCBQcm9taXNlLnJlamVjdChlKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBwcmltYXJ5IHN0YXRlIG9mIHRoZVxuICAgICAqIGluc3RhbmNlIGNoYW5nZXMuIFVwb24gcmVnaXN0ZXJpbmcsIHRoaXMgbGlzdGVuZXIgaXMgaW52b2tlZCBpbW1lZGlhdGVseVxuICAgICAqIHdpdGggdGhlIGN1cnJlbnQgcHJpbWFyeSBzdGF0ZS5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIFZpKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGkgPSBhc3luYyB0ID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHJldHVybiBlKHQpO1xuICAgICAgICB9LCBlKHRoaXMuaXNQcmltYXJ5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBkYXRhYmFzZSByZWNlaXZlcyBhXG4gICAgICogdmVyc2lvbiBjaGFuZ2UgZXZlbnQgaW5kaWNhdGluZyB0aGF0IGl0IGhhcyBkZWxldGVkLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoZSkge1xuICAgICAgICB0aGlzLklpLmsoKGFzeW5jIHQgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIGRlbGV0ZSBJbmRleGVkREIuXG4gICAgICAgICAgICBudWxsID09PSB0Lm5ld1ZlcnNpb24gJiYgYXdhaXQgZSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkanVzdHMgdGhlIGN1cnJlbnQgbmV0d29yayBzdGF0ZSBpbiB0aGUgY2xpZW50J3MgbWV0YWRhdGEsIHBvdGVudGlhbGx5XG4gICAgICogYWZmZWN0aW5nIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0TmV0d29ya0VuYWJsZWQoZSkge1xuICAgICAgICB0aGlzLm5ldHdvcmtFbmFibGVkICE9PSBlICYmICh0aGlzLm5ldHdvcmtFbmFibGVkID0gZSwgXG4gICAgICAgIC8vIFNjaGVkdWxlIGEgcHJpbWFyeSBsZWFzZSByZWZyZXNoIGZvciBpbW1lZGlhdGUgZXhlY3V0aW9uLiBUaGUgZXZlbnR1YWxcbiAgICAgICAgLy8gbGVhc2UgdXBkYXRlIHdpbGwgYmUgcHJvcGFnYXRlZCB2aWEgYHByaW1hcnlTdGF0ZUxpc3RlbmVyYC5cbiAgICAgICAgdGhpcy5paS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgJiYgYXdhaXQgdGhpcy5FaSgpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjbGllbnQgbWV0YWRhdGEgaW4gSW5kZXhlZERiIGFuZCBhdHRlbXB0cyB0byBlaXRoZXIgb2J0YWluIG9yXG4gICAgICogZXh0ZW5kIHRoZSBwcmltYXJ5IGxlYXNlIGZvciB0aGUgbG9jYWwgY2xpZW50LiBBc3luY2hyb25vdXNseSBub3RpZmllcyB0aGVcbiAgICAgKiBwcmltYXJ5IHN0YXRlIGxpc3RlbmVyIGlmIHRoZSBjbGllbnQgZWl0aGVyIG5ld2x5IG9idGFpbmVkIG9yIHJlbGVhc2VkIGl0c1xuICAgICAqIHByaW1hcnkgbGVhc2UuXG4gICAgICovICAgIEVpKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcInVwZGF0ZUNsaWVudE1ldGFkYXRhQW5kVHJ5QmVjb21lUHJpbWFyeVwiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5wdXQoe1xuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICB1cGRhdGVUaW1lTXM6IERhdGUubm93KCksXG4gICAgICAgICAgICBuZXR3b3JrRW5hYmxlZDogdGhpcy5uZXR3b3JrRW5hYmxlZCxcbiAgICAgICAgICAgIGluRm9yZWdyb3VuZDogdGhpcy5pbkZvcmVncm91bmRcbiAgICAgICAgfSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmltYXJ5KSByZXR1cm4gdGhpcy5taShlKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlIHx8ICh0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLmlpLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHRoaXMuaGkoITEpKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5maShlKSkpLm5leHQoKHQgPT4gdGhpcy5pc1ByaW1hcnkgJiYgIXQgPyB0aGlzLmdpKGUpLm5leHQoKCgpID0+ICExKSkgOiAhIXQgJiYgdGhpcy5waShlKS5uZXh0KCgoKSA9PiAhMCkpKSkpKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgXG4gICAgICAgICAgICAvLyBQcm9jZWVkIHdpdGggdGhlIGV4aXN0aW5nIHN0YXRlLiBBbnkgc3Vic2VxdWVudCBhY2Nlc3MgdG9cbiAgICAgICAgICAgIC8vIEluZGV4ZWREQiB3aWxsIHZlcmlmeSB0aGUgbGVhc2UuXG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJGYWlsZWQgdG8gZXh0ZW5kIG93bmVyIGxlYXNlOiBcIiwgZSksIFxuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIHRocm93IGU7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJSZWxlYXNpbmcgb3duZXIgbGVhc2UgYWZ0ZXIgZXJyb3IgZHVyaW5nIGxlYXNlIHJlZnJlc2hcIiwgZSksIFxuICAgICAgICAgICAgLyogaXNQcmltYXJ5PSAqLyAhMTtcbiAgICAgICAgfSkpLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgIT09IGUgJiYgdGhpcy5paS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmhpKGUpKSksIHRoaXMuaXNQcmltYXJ5ID0gZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBtaShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChcIm93bmVyXCIpLm5leHQoKGUgPT4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy55aShlKSkpKTtcbiAgICB9XG4gICAgd2koZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NsaWVudE1ldGFkYXRhU3RvcmUoZSkuZGVsZXRlKHRoaXMuY2xpZW50SWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgZ2FyYmFnZSBjb2xsZWN0aW9uIHRocmVzaG9sZCBoYXMgcGFzc2VkLCBwcnVuZXMgdGhlXG4gICAgICogUmVtb3RlRG9jdW1lbnRDaGFuZ2VzIGFuZCB0aGUgQ2xpZW50TWV0YWRhdGEgc3RvcmUgYmFzZWQgb24gdGhlIGxhc3QgdXBkYXRlXG4gICAgICogdGltZSBvZiBhbGwgY2xpZW50cy5cbiAgICAgKi8gICAgYXN5bmMgU2koKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUHJpbWFyeSAmJiAhdGhpcy5iaSh0aGlzLmxpLCAxOGU1KSkge1xuICAgICAgICAgICAgdGhpcy5saSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgdGhpcy5ydW5UcmFuc2FjdGlvbihcIm1heWJlR2FyYmFnZUNvbGxlY3RNdWx0aUNsaWVudFN0YXRlXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJjbGllbnRNZXRhZGF0YVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5HKCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLkRpKGUsIDE4ZTUpLCByID0gZS5maWx0ZXIoKGUgPT4gLTEgPT09IG4uaW5kZXhPZihlKSkpO1xuICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgbWV0YWRhdGEgZm9yIGNsaWVudHMgdGhhdCBhcmUgbm8gbG9uZ2VyIGNvbnNpZGVyZWQgYWN0aXZlLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gociwgKGUgPT4gdC5kZWxldGUoZS5jbGllbnRJZCkpKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLmNhdGNoKCgoKSA9PiBbXSkpO1xuICAgICAgICAgICAgLy8gRGVsZXRlIHBvdGVudGlhbCBsZWZ0b3ZlciBlbnRyaWVzIHRoYXQgbWF5IGNvbnRpbnVlIHRvIG1hcmsgdGhlXG4gICAgICAgICAgICAvLyBpbmFjdGl2ZSBjbGllbnRzIGFzIHpvbWJpZWQgaW4gTG9jYWxTdG9yYWdlLlxuICAgICAgICAgICAgLy8gSWRlYWxseSB3ZSdkIGRlbGV0ZSB0aGUgSW5kZXhlZERiIGFuZCBMb2NhbFN0b3JhZ2Ugem9tYmllIGVudHJpZXMgZm9yXG4gICAgICAgICAgICAvLyB0aGUgY2xpZW50IGF0b21pY2FsbHksIGJ1dCB3ZSBjYW4ndC4gU28gd2Ugb3B0IHRvIGRlbGV0ZSB0aGUgSW5kZXhlZERiXG4gICAgICAgICAgICAvLyBlbnRyaWVzIGZpcnN0IHRvIGF2b2lkIHBvdGVudGlhbGx5IHJldml2aW5nIGEgem9tYmllZCBjbGllbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5UaSkgZm9yIChjb25zdCB0IG9mIGUpIHRoaXMuVGkucmVtb3ZlSXRlbSh0aGlzLnZpKHQuY2xpZW50SWQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYSByZWN1cnJpbmcgdGltZXIgdG8gdXBkYXRlIHRoZSBjbGllbnQgbWV0YWRhdGEgYW5kIHRvIGVpdGhlclxuICAgICAqIGV4dGVuZCBvciBhY3F1aXJlIHRoZSBwcmltYXJ5IGxlYXNlIGlmIHRoZSBjbGllbnQgaXMgZWxpZ2libGUuXG4gICAgICovICAgIFJpKCkge1xuICAgICAgICB0aGlzLmNpID0gdGhpcy5paS5lbnF1ZXVlQWZ0ZXJEZWxheShcImNsaWVudF9tZXRhZGF0YV9yZWZyZXNoXCIgLyogVGltZXJJZC5DbGllbnRNZXRhZGF0YVJlZnJlc2ggKi8gLCA0ZTMsICgoKSA9PiB0aGlzLkVpKCkudGhlbigoKCkgPT4gdGhpcy5TaSgpKSkudGhlbigoKCkgPT4gdGhpcy5SaSgpKSkpKTtcbiAgICB9XG4gICAgLyoqIENoZWNrcyB3aGV0aGVyIGBjbGllbnRgIGlzIHRoZSBsb2NhbCBjbGllbnQuICovICAgIHlpKGUpIHtcbiAgICAgICAgcmV0dXJuICEhZSAmJiBlLm93bmVySWQgPT09IHRoaXMuY2xpZW50SWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV2YWx1YXRlIHRoZSBzdGF0ZSBvZiBhbGwgYWN0aXZlIGNsaWVudHMgYW5kIGRldGVybWluZSB3aGV0aGVyIHRoZSBsb2NhbFxuICAgICAqIGNsaWVudCBpcyBvciBjYW4gYWN0IGFzIHRoZSBob2xkZXIgb2YgdGhlIHByaW1hcnkgbGVhc2UuIFJldHVybnMgd2hldGhlclxuICAgICAqIHRoZSBjbGllbnQgaXMgZWxpZ2libGUgZm9yIHRoZSBsZWFzZSwgYnV0IGRvZXMgbm90IGFjdHVhbGx5IGFjcXVpcmUgaXQuXG4gICAgICogTWF5IHJldHVybiAnZmFsc2UnIGV2ZW4gaWYgdGhlcmUgaXMgbm8gYWN0aXZlIGxlYXNlaG9sZGVyIGFuZCBhbm90aGVyXG4gICAgICogKGZvcmVncm91bmQpIGNsaWVudCBzaG91bGQgYmVjb21lIGxlYXNlaG9sZGVyIGluc3RlYWQuXG4gICAgICovICAgIGZpKGUpIHtcbiAgICAgICAgaWYgKHRoaXMub2kpIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSghMCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChcIm93bmVyXCIpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgLy8gQSBjbGllbnQgaXMgZWxpZ2libGUgZm9yIHRoZSBwcmltYXJ5IGxlYXNlIGlmOlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCB0aGUgY2xpZW50J3MgdGFiIGlzIGluIHRoZSBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW4gdGhlXG4gICAgICAgICAgICAvLyAgIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIGV2ZXJ5IGNsaWVudHMgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgdGhlIGNsaWVudCdzIHRhYiBpcyBpbiB0aGVcbiAgICAgICAgICAgIC8vICAgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gZXZlcnkgY2xpZW50cyBuZXR3b3JrIGlzIGRpc2FibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW5cbiAgICAgICAgICAgIC8vICAgdGhlIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIHRoZSBgZm9yY2VPd25pbmdUYWJgIHNldHRpbmcgd2FzIHBhc3NlZCBpbi5cbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0ICYmIHRoaXMuYmkodC5sZWFzZVRpbWVzdGFtcE1zLCA1ZTMpICYmICF0aGlzLkNpKHQub3duZXJJZCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy55aSh0KSAmJiB0aGlzLm5ldHdvcmtFbmFibGVkKSByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnlpKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdC5hbGxvd1RhYlN5bmNocm9uaXphdGlvbikgXG4gICAgICAgICAgICAgICAgICAgIC8vIEZhaWwgdGhlIGBjYW5BY3RBc1ByaW1hcnlgIGNoZWNrIGlmIHRoZSBjdXJyZW50IGxlYXNlaG9sZGVyIGhhc1xuICAgICAgICAgICAgICAgICAgICAvLyBub3Qgb3B0ZWQgaW50byBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uLiBJZiB0aGlzIGhhcHBlbnMgYXRcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xpZW50IHN0YXJ0dXAsIHdlIHJlamVjdCB0aGUgUHJvbWlzZSByZXR1cm5lZCBieVxuICAgICAgICAgICAgICAgICAgICAvLyBgZW5hYmxlUGVyc2lzdGVuY2UoKWAgYW5kIHRoZSB1c2VyIGNhbiBjb250aW51ZSB0byB1c2UgRmlyZXN0b3JlXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpdGggaW4tbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGZhaWxzIGR1cmluZyBhIGxlYXNlIHJlZnJlc2gsIHdlIHdpbGwgaW5zdGVhZCBibG9jayB0aGVcbiAgICAgICAgICAgICAgICAgICAgLy8gQXN5bmNRdWV1ZSBmcm9tIGV4ZWN1dGluZyBmdXJ0aGVyIG9wZXJhdGlvbnMuIE5vdGUgdGhhdCB0aGlzIGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGFjY2VwdGFibGUgc2luY2UgbWl4aW5nICYgbWF0Y2hpbmcgZGlmZmVyZW50IGBzeW5jaHJvbml6ZVRhYnNgXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldHRpbmdzIGlzIG5vdCBzdXBwb3J0ZWQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgdGhpcyBjaGVjayB3aGVuIGBzeW5jaHJvbml6ZVRhYnNgIGNhblxuICAgICAgICAgICAgICAgICAgICAvLyBubyBsb25nZXIgYmUgdHVybmVkIG9mZi5cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuRkFJTEVEX1BSRUNPTkRJVElPTiwgQWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICEoIXRoaXMubmV0d29ya0VuYWJsZWQgfHwgIXRoaXMuaW5Gb3JlZ3JvdW5kKSB8fCBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5HKCkubmV4dCgoZSA9PiB2b2lkIDAgPT09IHRoaXMuRGkoZSwgNWUzKS5maW5kKChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGllbnRJZCAhPT0gZS5jbGllbnRJZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gIXRoaXMubmV0d29ya0VuYWJsZWQgJiYgZS5uZXR3b3JrRW5hYmxlZCwgbiA9ICF0aGlzLmluRm9yZWdyb3VuZCAmJiBlLmluRm9yZWdyb3VuZCwgciA9IHRoaXMubmV0d29ya0VuYWJsZWQgPT09IGUubmV0d29ya0VuYWJsZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0IHx8IG4gJiYgcikgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgfSkpLm5leHQoKGUgPT4gKHRoaXMuaXNQcmltYXJ5ICE9PSBlICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIGBDbGllbnQgJHtlID8gXCJpc1wiIDogXCJpcyBub3RcIn0gZWxpZ2libGUgZm9yIGEgcHJpbWFyeSBsZWFzZS5gKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIGFzeW5jIHNodXRkb3duKCkge1xuICAgICAgICAvLyBUaGUgc2h1dGRvd24oKSBvcGVyYXRpb25zIGFyZSBpZGVtcG90ZW50IGFuZCBjYW4gYmUgY2FsbGVkIGV2ZW4gd2hlblxuICAgICAgICAvLyBzdGFydCgpIGFib3J0ZWQgKGUuZy4gYmVjYXVzZSBpdCBjb3VsZG4ndCBhY3F1aXJlIHRoZSBwZXJzaXN0ZW5jZSBsZWFzZSkuXG4gICAgICAgIHRoaXMuTHIgPSAhMSwgdGhpcy5GaSgpLCB0aGlzLmNpICYmICh0aGlzLmNpLmNhbmNlbCgpLCB0aGlzLmNpID0gbnVsbCksIHRoaXMuTWkoKSwgXG4gICAgICAgIHRoaXMueGkoKSwgXG4gICAgICAgIC8vIFVzZSBgU2ltcGxlRGIucnVuVHJhbnNhY3Rpb25gIGRpcmVjdGx5IHRvIGF2b2lkIGZhaWxpbmcgaWYgYW5vdGhlciB0YWJcbiAgICAgICAgLy8gaGFzIG9idGFpbmVkIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAgICBhd2FpdCB0aGlzLklpLnJ1blRyYW5zYWN0aW9uKFwic2h1dGRvd25cIiwgXCJyZWFkd3JpdGVcIiwgWyBcIm93bmVyXCIsIFwiY2xpZW50TWV0YWRhdGFcIiBdLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbihlLCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2kodCkubmV4dCgoKCkgPT4gdGhpcy53aSh0KSkpO1xuICAgICAgICB9KSksIHRoaXMuSWkuY2xvc2UoKSwgXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZW50cnkgbWFya2luZyB0aGUgY2xpZW50IGFzIHpvbWJpZWQgZnJvbSBMb2NhbFN0b3JhZ2Ugc2luY2VcbiAgICAgICAgLy8gd2Ugc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgaXRzIG1ldGFkYXRhIGZyb20gSW5kZXhlZERiLlxuICAgICAgICB0aGlzLk9pKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgY2xpZW50cyB0aGF0IGFyZSBub3Qgem9tYmllZCBhbmQgaGF2ZSBhbiB1cGRhdGVUaW1lIHdpdGhpbiB0aGVcbiAgICAgKiBwcm92aWRlZCB0aHJlc2hvbGQuXG4gICAgICovICAgIERpKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUuZmlsdGVyKChlID0+IHRoaXMuYmkoZS51cGRhdGVUaW1lTXMsIHQpICYmICF0aGlzLkNpKGUuY2xpZW50SWQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIElEcyBvZiB0aGUgY2xpZW50cyB0aGF0IGFyZSBjdXJyZW50bHkgYWN0aXZlLiBJZiBtdWx0aS10YWJcbiAgICAgKiBpcyBub3Qgc3VwcG9ydGVkLCByZXR1cm5zIGFuIGFycmF5IHRoYXQgb25seSBjb250YWlucyB0aGUgbG9jYWwgY2xpZW50J3NcbiAgICAgKiBJRC5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIE5pKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEFjdGl2ZUNsaWVudHNcIiwgXCJyZWFkb25seVwiLCAoZSA9PiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5HKCkubmV4dCgoZSA9PiB0aGlzLkRpKGUsIDE4ZTUpLm1hcCgoZSA9PiBlLmNsaWVudElkKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgc3RhcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTHI7XG4gICAgfVxuICAgIGdldE11dGF0aW9uUXVldWUoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX0luZGV4ZWREYk11dGF0aW9uUXVldWUubHQoZSwgdGhpcy5zZXJpYWxpemVyLCB0LCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlKTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtyO1xuICAgIH1cbiAgICBnZXRSZW1vdGVEb2N1bWVudENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlO1xuICAgIH1cbiAgICBnZXRJbmRleE1hbmFnZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJJbmRleE1hbmFnZXIoZSwgdGhpcy5zZXJpYWxpemVyLmN0LmRhdGFiYXNlSWQpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfSW5kZXhlZERiRG9jdW1lbnRPdmVybGF5Q2FjaGUubHQodGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICB9XG4gICAgZ2V0QnVuZGxlQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlFyO1xuICAgIH1cbiAgICBydW5UcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiU3RhcnRpbmcgdHJhbnNhY3Rpb246XCIsIGUpO1xuICAgICAgICBjb25zdCByID0gXCJyZWFkb25seVwiID09PSB0ID8gXCJyZWFkb25seVwiIDogXCJyZWFkd3JpdGVcIiwgaSA9IFxuICAgICAgICAvKiogUmV0dXJucyB0aGUgb2JqZWN0IHN0b3JlcyBmb3IgdGhlIHByb3ZpZGVkIHNjaGVtYS4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2dldE9iamVjdFN0b3JlcyhlKSB7XG4gICAgICAgICAgICByZXR1cm4gMTUgPT09IGUgPyBlZSA6IDE0ID09PSBlID8gWCA6IDEzID09PSBlID8gWiA6IDEyID09PSBlID8gWSA6IDExID09PSBlID8gSiA6IHZvaWQgZmFpbCgpO1xuICAgICAgICB9KHRoaXMuX2kpO1xuICAgICAgICBsZXQgcztcbiAgICAgICAgLy8gRG8gYWxsIHRyYW5zYWN0aW9ucyBhcyByZWFkd3JpdGUgYWdhaW5zdCBhbGwgb2JqZWN0IHN0b3Jlcywgc2luY2Ugd2VcbiAgICAgICAgLy8gYXJlIHRoZSBvbmx5IHJlYWRlci93cml0ZXIuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuSWkucnVuVHJhbnNhY3Rpb24oZSwgciwgaSwgKHIgPT4gKHMgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uKHIsIHRoaXMuQnIgPyB0aGlzLkJyLm5leHQoKSA6IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZSksIFxuICAgICAgICBcInJlYWR3cml0ZS1wcmltYXJ5XCIgPT09IHQgPyB0aGlzLm1pKHMpLm5leHQoKGUgPT4gISFlIHx8IHRoaXMuZmkocykpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICghdCkgdGhyb3cgX19QUklWQVRFX2xvZ0Vycm9yKGBGYWlsZWQgdG8gb2J0YWluIHByaW1hcnkgbGVhc2UgZm9yIGFjdGlvbiAnJHtlfScuYCksIFxuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgPSAhMSwgdGhpcy5paS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmhpKCExKSkpLCBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBGKTtcbiAgICAgICAgICAgIHJldHVybiBuKHMpO1xuICAgICAgICB9KSkubmV4dCgoZSA9PiB0aGlzLnBpKHMpLm5leHQoKCgpID0+IGUpKSkpIDogdGhpcy5CaShzKS5uZXh0KCgoKSA9PiBuKHMpKSkpKSkudGhlbigoZSA9PiAocy5yYWlzZU9uQ29tbWl0dGVkRXZlbnQoKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIHRoYXQgdGhlIGN1cnJlbnQgdGFiIGlzIHRoZSBwcmltYXJ5IGxlYXNlaG9sZGVyIG9yIGFsdGVybmF0aXZlbHlcbiAgICAgKiB0aGF0IHRoZSBsZWFzZWhvbGRlciBoYXMgb3B0ZWQgaW50byBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uLlxuICAgICAqL1xuICAgIC8vIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgdGhpcyBjaGVjayB3aGVuIGBzeW5jaHJvbml6ZVRhYnNgIGNhbiBubyBsb25nZXJcbiAgICAvLyBiZSB0dXJuZWQgb2ZmLlxuICAgIEJpKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltYXJ5Q2xpZW50U3RvcmUoZSkuZ2V0KFwib3duZXJcIikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZSAmJiB0aGlzLmJpKGUubGVhc2VUaW1lc3RhbXBNcywgNWUzKSAmJiAhdGhpcy5DaShlLm93bmVySWQpICYmICF0aGlzLnlpKGUpICYmICEodGhpcy5vaSB8fCB0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uICYmIGUuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBBZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT2J0YWlucyBvciBleHRlbmRzIHRoZSBuZXcgcHJpbWFyeSBsZWFzZSBmb3IgdGhlIGxvY2FsIGNsaWVudC4gVGhpc1xuICAgICAqIG1ldGhvZCBkb2VzIG5vdCB2ZXJpZnkgdGhhdCB0aGUgY2xpZW50IGlzIGVsaWdpYmxlIGZvciB0aGlzIGxlYXNlLlxuICAgICAqLyAgICBwaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBvd25lcklkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgICAgYWxsb3dUYWJTeW5jaHJvbml6YXRpb246IHRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24sXG4gICAgICAgICAgICBsZWFzZVRpbWVzdGFtcE1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLnB1dChcIm93bmVyXCIsIHQpO1xuICAgIH1cbiAgICBzdGF0aWMgdigpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9TaW1wbGVEYi52KCk7XG4gICAgfVxuICAgIC8qKiBDaGVja3MgdGhlIHByaW1hcnkgbGVhc2UgYW5kIHJlbW92ZXMgaXQgaWYgd2UgYXJlIHRoZSBjdXJyZW50IHByaW1hcnkuICovICAgIGdpKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9wcmltYXJ5Q2xpZW50U3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0LmdldChcIm93bmVyXCIpLm5leHQoKGUgPT4gdGhpcy55aShlKSA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIlJlbGVhc2luZyBwcmltYXJ5IGxlYXNlLlwiKSwgXG4gICAgICAgIHQuZGVsZXRlKFwib3duZXJcIikpIDogUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKSkpO1xuICAgIH1cbiAgICAvKiogVmVyaWZpZXMgdGhhdCBgdXBkYXRlVGltZU1zYCBpcyB3aXRoaW4gYG1heEFnZU1zYC4gKi8gICAgYmkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuICEoZSA8IG4gLSB0KSAmJiAoIShlID4gbikgfHwgKF9fUFJJVkFURV9sb2dFcnJvcihgRGV0ZWN0ZWQgYW4gdXBkYXRlIHRpbWUgdGhhdCBpcyBpbiB0aGUgZnV0dXJlOiAke2V9ID4gJHtufWApLCBcbiAgICAgICAgITEpKTtcbiAgICB9XG4gICAgZGkoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuZG9jdW1lbnQgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJiYgKHRoaXMudWkgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlpLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLmluRm9yZWdyb3VuZCA9IFwidmlzaWJsZVwiID09PSB0aGlzLmRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSwgXG4gICAgICAgICAgICB0aGlzLkVpKCkpKSk7XG4gICAgICAgIH0sIHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy51aSksIHRoaXMuaW5Gb3JlZ3JvdW5kID0gXCJ2aXNpYmxlXCIgPT09IHRoaXMuZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlKTtcbiAgICB9XG4gICAgTWkoKSB7XG4gICAgICAgIHRoaXMudWkgJiYgKHRoaXMuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy51aSksIHRoaXMudWkgPSBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0YWNoZXMgYSB3aW5kb3cudW5sb2FkIGhhbmRsZXIgdGhhdCB3aWxsIHN5bmNocm9ub3VzbHkgd3JpdGUgb3VyXG4gICAgICogY2xpZW50SWQgdG8gYSBcInpvbWJpZSBjbGllbnQgaWRcIiBsb2NhdGlvbiBpbiBMb2NhbFN0b3JhZ2UuIFRoaXMgY2FuIGJlIHVzZWRcbiAgICAgKiBieSB0YWJzIHRyeWluZyB0byBhY3F1aXJlIHRoZSBwcmltYXJ5IGxlYXNlIHRvIGRldGVybWluZSB0aGF0IHRoZSBsZWFzZVxuICAgICAqIGlzIG5vIGxvbmdlciB2YWxpZCBldmVuIGlmIHRoZSB0aW1lc3RhbXAgaXMgcmVjZW50LiBUaGlzIGlzIHBhcnRpY3VsYXJseVxuICAgICAqIGltcG9ydGFudCBmb3IgdGhlIHJlZnJlc2ggY2FzZSAoc28gdGhlIHRhYiBjb3JyZWN0bHkgcmUtYWNxdWlyZXMgdGhlXG4gICAgICogcHJpbWFyeSBsZWFzZSkuIExvY2FsU3RvcmFnZSBpcyB1c2VkIGZvciB0aGlzIHJhdGhlciB0aGFuIEluZGV4ZWREYiBiZWNhdXNlXG4gICAgICogaXQgaXMgYSBzeW5jaHJvbm91cyBBUEkgYW5kIHNvIGNhbiBiZSB1c2VkIHJlbGlhYmx5IGZyb20gIGFuIHVubG9hZFxuICAgICAqIGhhbmRsZXIuXG4gICAgICovICAgIEFpKCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiAobnVsbCA9PT0gKGUgPSB0aGlzLndpbmRvdykgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5hZGRFdmVudExpc3RlbmVyKSAmJiAodGhpcy5haSA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIE5vdGU6IEluIHRoZW9yeSwgdGhpcyBzaG91bGQgYmUgc2NoZWR1bGVkIG9uIHRoZSBBc3luY1F1ZXVlIHNpbmNlIGl0XG4gICAgICAgICAgICAvLyBhY2Nlc3NlcyBpbnRlcm5hbCBzdGF0ZS4gV2UgZXhlY3V0ZSB0aGlzIGNvZGUgZGlyZWN0bHkgZHVyaW5nIHNodXRkb3duXG4gICAgICAgICAgICAvLyB0byBtYWtlIHN1cmUgaXQgZ2V0cyBhIGNoYW5jZSB0byBydW4uXG4gICAgICAgICAgICB0aGlzLkZpKCk7XG4gICAgICAgICAgICBjb25zdCBlID0gLyg/OlZlcnNpb258TW9iaWxlKVxcLzFbNDU2XS87XG4gICAgICAgICAgICBpc1NhZmFyaSgpICYmIChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5tYXRjaChlKSB8fCBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKGUpKSAmJiBcbiAgICAgICAgICAgIC8vIE9uIFNhZmFyaSAxNCwgMTUsIGFuZCAxNiwgd2UgZG8gbm90IHJ1biBhbnkgY2xlYW51cCBhY3Rpb25zIGFzIGl0IG1pZ2h0XG4gICAgICAgICAgICAvLyB0cmlnZ2VyIGEgYnVnIHRoYXQgcHJldmVudHMgU2FmYXJpIGZyb20gcmUtb3BlbmluZyBJbmRleGVkREIgZHVyaW5nXG4gICAgICAgICAgICAvLyB0aGUgbmV4dCBwYWdlIGxvYWQuXG4gICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTIyNjU0N1xuICAgICAgICAgICAgdGhpcy5paS5lbnRlclJlc3RyaWN0ZWRNb2RlKC8qIHB1cmdlRXhpc3RpbmdUYXNrcz0gKi8gITApLCB0aGlzLmlpLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IHRoaXMuc2h1dGRvd24oKSkpO1xuICAgICAgICB9LCB0aGlzLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicGFnZWhpZGVcIiwgdGhpcy5haSkpO1xuICAgIH1cbiAgICB4aSgpIHtcbiAgICAgICAgdGhpcy5haSAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBhZ2VoaWRlXCIsIHRoaXMuYWkpLCB0aGlzLmFpID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBhIGNsaWVudCBpcyBcInpvbWJpZWRcIiBiYXNlZCBvbiBpdHMgTG9jYWxTdG9yYWdlIGVudHJ5LlxuICAgICAqIENsaWVudHMgYmVjb21lIHpvbWJpZWQgd2hlbiB0aGVpciB0YWIgY2xvc2VzIHdpdGhvdXQgcnVubmluZyBhbGwgb2YgdGhlXG4gICAgICogY2xlYW51cCBsb2dpYyBpbiBgc2h1dGRvd24oKWAuXG4gICAgICovICAgIENpKGUpIHtcbiAgICAgICAgdmFyIHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBuID0gbnVsbCAhPT0gKG51bGwgPT09ICh0ID0gdGhpcy5UaSkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5nZXRJdGVtKHRoaXMudmkoZSkpKTtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBgQ2xpZW50ICcke2V9JyAke24gPyBcImlzXCIgOiBcImlzIG5vdFwifSB6b21iaWVkIGluIExvY2FsU3RvcmFnZWApLCBcbiAgICAgICAgICAgIG47XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIEdyYWNlZnVsbHkgaGFuZGxlIGlmIExvY2FsU3RvcmFnZSBpc24ndCB3b3JraW5nLlxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dFcnJvcihcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiRmFpbGVkIHRvIGdldCB6b21iaWVkIGNsaWVudCBpZC5cIiwgZSksIFxuICAgICAgICAgICAgITE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVjb3JkIGNsaWVudCBhcyB6b21iaWVkIChhIGNsaWVudCB0aGF0IGhhZCBpdHMgdGFiIGNsb3NlZCkuIFpvbWJpZWRcbiAgICAgKiBjbGllbnRzIGFyZSBpZ25vcmVkIGR1cmluZyBwcmltYXJ5IHRhYiBzZWxlY3Rpb24uXG4gICAgICovICAgIEZpKCkge1xuICAgICAgICBpZiAodGhpcy5UaSkgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuVGkuc2V0SXRlbSh0aGlzLnZpKHRoaXMuY2xpZW50SWQpLCBTdHJpbmcoRGF0ZS5ub3coKSkpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3QgYXZhaWxhYmxlIC8gd29ya2luZy5cbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihcIkZhaWxlZCB0byBzZXQgem9tYmllIGNsaWVudCBpZC5cIiwgZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIFJlbW92ZXMgdGhlIHpvbWJpZWQgY2xpZW50IGVudHJ5IGlmIGl0IGV4aXN0cy4gKi8gICAgT2koKSB7XG4gICAgICAgIGlmICh0aGlzLlRpKSB0cnkge1xuICAgICAgICAgICAgdGhpcy5UaS5yZW1vdmVJdGVtKHRoaXMudmkodGhpcy5jbGllbnRJZCkpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBJZ25vcmVcbiAgICAgICAgfVxuICAgIH1cbiAgICB2aShlKSB7XG4gICAgICAgIHJldHVybiBgZmlyZXN0b3JlX3pvbWJpZV8ke3RoaXMucGVyc2lzdGVuY2VLZXl9XyR7ZX1gO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIHByaW1hcnkgY2xpZW50IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwib3duZXJcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBjbGllbnQgbWV0YWRhdGEgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jbGllbnRNZXRhZGF0YVN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiY2xpZW50TWV0YWRhdGFcIik7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgc3RyaW5nIHVzZWQgYXMgYSBwcmVmaXggd2hlbiBzdG9yaW5nIGRhdGEgaW4gSW5kZXhlZERCIGFuZFxuICogTG9jYWxTdG9yYWdlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pbmRleGVkRGJTdG9yYWdlUHJlZml4KGUsIHQpIHtcbiAgICAvLyBVc2UgdHdvIGRpZmZlcmVudCBwcmVmaXggZm9ybWF0czpcbiAgICAvLyAgICogZmlyZXN0b3JlIC8gcGVyc2lzdGVuY2VLZXkgLyBwcm9qZWN0SUQgLiBkYXRhYmFzZUlEIC8gLi4uXG4gICAgLy8gICAqIGZpcmVzdG9yZSAvIHBlcnNpc3RlbmNlS2V5IC8gcHJvamVjdElEIC8gLi4uXG4gICAgLy8gcHJvamVjdElEcyBhcmUgRE5TLWNvbXBhdGlibGUgbmFtZXMgYW5kIGNhbm5vdCBjb250YWluIGRvdHNcbiAgICAvLyBzbyB0aGVyZSdzIG5vIGRhbmdlciBvZiBjb2xsaXNpb25zLlxuICAgIGxldCBuID0gZS5wcm9qZWN0SWQ7XG4gICAgcmV0dXJuIGUuaXNEZWZhdWx0RGF0YWJhc2UgfHwgKG4gKz0gXCIuXCIgKyBlLmRhdGFiYXNlKSwgXCJmaXJlc3RvcmUvXCIgKyB0ICsgXCIvXCIgKyBuICsgXCIvXCI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgc2V0IG9mIGNoYW5nZXMgdG8gd2hhdCBkb2N1bWVudHMgYXJlIGN1cnJlbnRseSBpbiB2aWV3IGFuZCBvdXQgb2YgdmlldyBmb3JcbiAqIGEgZ2l2ZW4gcXVlcnkuIFRoZXNlIGNoYW5nZXMgYXJlIHNlbnQgdG8gdGhlIExvY2FsU3RvcmUgYnkgdGhlIFZpZXcgKHZpYVxuICogdGhlIFN5bmNFbmdpbmUpIGFuZCBhcmUgdXNlZCB0byBwaW4gLyB1bnBpbiBkb2N1bWVudHMgYXMgYXBwcm9wcmlhdGUuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbFZpZXdDaGFuZ2VzIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0SWQgPSBlLCB0aGlzLmZyb21DYWNoZSA9IHQsIHRoaXMuTGkgPSBuLCB0aGlzLmtpID0gcjtcbiAgICB9XG4gICAgc3RhdGljIHFpKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgciA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5kb2NDaGFuZ2VzKSBzd2l0Y2ggKGUudHlwZSkge1xuICAgICAgICAgIGNhc2UgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovIDpcbiAgICAgICAgICAgIG4gPSBuLmFkZChlLmRvYy5rZXkpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovIDpcbiAgICAgICAgICAgIHIgPSByLmFkZChlLmRvYy5rZXkpO1xuIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0xvY2FsVmlld0NoYW5nZXMoZSwgdC5mcm9tQ2FjaGUsIG4sIHIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIEZpcmVzdG9yZSBxdWVyeSBlbmdpbmUuXG4gKlxuICogRmlyZXN0b3JlIHF1ZXJpZXMgY2FuIGJlIGV4ZWN1dGVkIGluIHRocmVlIG1vZGVzLiBUaGUgUXVlcnkgRW5naW5lIGRldGVybWluZXNcbiAqIHdoYXQgbW9kZSB0byB1c2UgYmFzZWQgb24gd2hhdCBkYXRhIGlzIHBlcnNpc3RlZC4gVGhlIG1vZGUgb25seSBkZXRlcm1pbmVzXG4gKiB0aGUgcnVudGltZSBjb21wbGV4aXR5IG9mIHRoZSBxdWVyeSAtIHRoZSByZXN1bHQgc2V0IGlzIGVxdWl2YWxlbnQgYWNyb3NzIGFsbFxuICogaW1wbGVtZW50YXRpb25zLlxuICpcbiAqIFRoZSBRdWVyeSBlbmdpbmUgd2lsbCB1c2UgaW5kZXhlZC1iYXNlZCBleGVjdXRpb24gaWYgYSB1c2VyIGhhcyBjb25maWd1cmVkXG4gKiBhbnkgaW5kZXggdGhhdCBjYW4gYmUgdXNlZCB0byBleGVjdXRlIHF1ZXJ5ICh2aWEgYHNldEluZGV4Q29uZmlndXJhdGlvbigpYCkuXG4gKiBPdGhlcndpc2UsIHRoZSBlbmdpbmUgd2lsbCB0cnkgdG8gb3B0aW1pemUgdGhlIHF1ZXJ5IGJ5IHJlLXVzaW5nIGEgcHJldmlvdXNseVxuICogcGVyc2lzdGVkIHF1ZXJ5IHJlc3VsdC4gSWYgdGhhdCBpcyBub3QgcG9zc2libGUsIHRoZSBxdWVyeSB3aWxsIGJlIGV4ZWN1dGVkXG4gKiB2aWEgYSBmdWxsIGNvbGxlY3Rpb24gc2Nhbi5cbiAqXG4gKiBJbmRleC1iYXNlZCBleGVjdXRpb24gaXMgdGhlIGRlZmF1bHQgd2hlbiBhdmFpbGFibGUuIFRoZSBxdWVyeSBlbmdpbmVcbiAqIHN1cHBvcnRzIHBhcnRpYWwgaW5kZXhlZCBleGVjdXRpb24gYW5kIG1lcmdlcyB0aGUgcmVzdWx0IGZyb20gdGhlIGluZGV4XG4gKiBsb29rdXAgd2l0aCBkb2N1bWVudHMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBpbmRleGVkLiBUaGUgaW5kZXggZXZhbHVhdGlvblxuICogbWF0Y2hlcyB0aGUgYmFja2VuZCdzIGZvcm1hdCBhbmQgYXMgc3VjaCwgdGhlIFNESyBjYW4gdXNlIGluZGV4aW5nIGZvciBhbGxcbiAqIHF1ZXJpZXMgdGhhdCB0aGUgYmFja2VuZCBzdXBwb3J0cy5cbiAqXG4gKiBJZiBubyBpbmRleCBleGlzdHMsIHRoZSBxdWVyeSBlbmdpbmUgdHJpZXMgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHRhcmdldFxuICogZG9jdW1lbnQgbWFwcGluZyBpbiB0aGUgVGFyZ2V0Q2FjaGUuIFRoZXNlIG1hcHBpbmdzIGV4aXN0cyBmb3IgYWxsIHF1ZXJpZXNcbiAqIHRoYXQgaGF2ZSBiZWVuIHN5bmNlZCB3aXRoIHRoZSBiYWNrZW5kIGF0IGxlYXN0IG9uY2UgYW5kIGFsbG93IHRoZSBxdWVyeVxuICogZW5naW5lIHRvIG9ubHkgcmVhZCBkb2N1bWVudHMgdGhhdCBwcmV2aW91c2x5IG1hdGNoZWQgYSBxdWVyeSBwbHVzIGFueVxuICogZG9jdW1lbnRzIHRoYXQgd2VyZSBlZGl0ZWQgYWZ0ZXIgdGhlIHF1ZXJ5IHdhcyBsYXN0IGxpc3RlbmVkIHRvLlxuICpcbiAqIFRoZXJlIGFyZSBzb21lIGNhc2VzIHdoZW4gdGhpcyBvcHRpbWl6YXRpb24gaXMgbm90IGd1YXJhbnRlZWQgdG8gcHJvZHVjZVxuICogdGhlIHNhbWUgcmVzdWx0cyBhcyBmdWxsIGNvbGxlY3Rpb24gc2NhbnMuIEluIHRoZXNlIGNhc2VzLCBxdWVyeVxuICogcHJvY2Vzc2luZyBmYWxscyBiYWNrIHRvIGZ1bGwgc2NhbnMuIFRoZXNlIGNhc2VzIGFyZTpcbiAqXG4gKiAtIExpbWl0IHF1ZXJpZXMgd2hlcmUgYSBkb2N1bWVudCB0aGF0IG1hdGNoZWQgdGhlIHF1ZXJ5IHByZXZpb3VzbHkgbm8gbG9uZ2VyXG4gKiAgIG1hdGNoZXMgdGhlIHF1ZXJ5LlxuICpcbiAqIC0gTGltaXQgcXVlcmllcyB3aGVyZSBhIGRvY3VtZW50IGVkaXQgbWF5IGNhdXNlIHRoZSBkb2N1bWVudCB0byBzb3J0IGJlbG93XG4gKiAgIGFub3RoZXIgZG9jdW1lbnQgdGhhdCBpcyBpbiB0aGUgbG9jYWwgY2FjaGUuXG4gKlxuICogLSBRdWVyaWVzIHRoYXQgaGF2ZSBuZXZlciBiZWVuIENVUlJFTlQgb3IgZnJlZSBvZiBsaW1ibyBkb2N1bWVudHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1F1ZXJ5RW5naW5lIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5RaSA9ICExO1xuICAgIH1cbiAgICAvKiogU2V0cyB0aGUgZG9jdW1lbnQgdmlldyB0byBxdWVyeSBhZ2FpbnN0LiAqLyAgICBpbml0aWFsaXplKGUsIHQpIHtcbiAgICAgICAgdGhpcy5LaSA9IGUsIHRoaXMuaW5kZXhNYW5hZ2VyID0gdCwgdGhpcy5RaSA9ICEwO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbGwgbG9jYWwgZG9jdW1lbnRzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcXVlcnkuICovICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gdGhpcy4kaShlLCB0KS5uZXh0KChpID0+IGkgfHwgdGhpcy5VaShlLCB0LCByLCBuKSkpLm5leHQoKG4gPT4gbiB8fCB0aGlzLldpKGUsIHQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGFuIGluZGV4ZWQgcXVlcnkgdGhhdCBldmFsdWF0ZXMgdGhlIHF1ZXJ5IGJhc2VkIG9uIGEgY29sbGVjdGlvbidzXG4gICAgICogcGVyc2lzdGVkIGluZGV4IHZhbHVlcy4gUmV0dXJucyBgbnVsbGAgaWYgYW4gaW5kZXggaXMgbm90IGF2YWlsYWJsZS5cbiAgICAgKi8gICAgJGkoZSwgdCkge1xuICAgICAgICBpZiAoX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0FsbERvY3VtZW50cyh0KSkgXG4gICAgICAgIC8vIFF1ZXJpZXMgdGhhdCBtYXRjaCBhbGwgZG9jdW1lbnRzIGRvbid0IGJlbmVmaXQgZnJvbSB1c2luZ1xuICAgICAgICAvLyBrZXktYmFzZWQgbG9va3Vwcy4gSXQgaXMgbW9yZSBlZmZpY2llbnQgdG8gc2NhbiBhbGwgZG9jdW1lbnRzIGluIGFcbiAgICAgICAgLy8gY29sbGVjdGlvbiwgcmF0aGVyIHRoYW4gdG8gcGVyZm9ybSBpbmRpdmlkdWFsIGxvb2t1cHMuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyLmdldEluZGV4VHlwZShlLCBuKS5uZXh0KChyID0+IDAgLyogSW5kZXhUeXBlLk5PTkUgKi8gPT09IHIgPyBudWxsIDogKG51bGwgIT09IHQubGltaXQgJiYgMSAvKiBJbmRleFR5cGUuUEFSVElBTCAqLyA9PT0gciAmJiAoXG4gICAgICAgIC8vIFdlIGNhbm5vdCBhcHBseSBhIGxpbWl0IGZvciB0YXJnZXRzIHRoYXQgYXJlIHNlcnZlZCB1c2luZyBhIHBhcnRpYWxcbiAgICAgICAgLy8gaW5kZXguIElmIGEgcGFydGlhbCBpbmRleCB3aWxsIGJlIHVzZWQgdG8gc2VydmUgdGhlIHRhcmdldCwgdGhlXG4gICAgICAgIC8vIHF1ZXJ5IG1heSByZXR1cm4gYSBzdXBlcnNldCBvZiBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGUgdGFyZ2V0XG4gICAgICAgIC8vIChlLmcuIGlmIHRoZSBpbmRleCBkb2Vzbid0IGluY2x1ZGUgYWxsIHRoZSB0YXJnZXQncyBmaWx0ZXJzKSwgb3JcbiAgICAgICAgLy8gbWF5IHJldHVybiB0aGUgY29ycmVjdCBzZXQgb2YgZG9jdW1lbnRzIGluIHRoZSB3cm9uZyBvcmRlciAoZS5nLiBpZlxuICAgICAgICAvLyB0aGUgaW5kZXggZG9lc24ndCBpbmNsdWRlIGEgc2VnbWVudCBmb3Igb25lIG9mIHRoZSBvcmRlckJ5cykuXG4gICAgICAgIC8vIFRoZXJlZm9yZSwgYSBsaW1pdCBzaG91bGQgbm90IGJlIGFwcGxpZWQgaW4gc3VjaCBjYXNlcy5cbiAgICAgICAgdCA9IF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdCh0LCBudWxsLCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pLCBuID0gX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQodCkpLCBcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQoZSwgbikubmV4dCgociA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KC4uLnIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuS2kuZ2V0RG9jdW1lbnRzKGUsIGkpLm5leHQoKHIgPT4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0TWluT2Zmc2V0KGUsIG4pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLkdpKHQsIHIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnppKHQsIHMsIGksIG4ucmVhZFRpbWUpID8gdGhpcy4kaShlLCBfX1BSSVZBVEVfcXVlcnlXaXRoTGltaXQodCwgbnVsbCwgXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovKSkgOiB0aGlzLmppKGUsIHMsIHQsIG4pO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYSBxdWVyeSBiYXNlZCBvbiB0aGUgdGFyZ2V0J3MgcGVyc2lzdGVkIHF1ZXJ5IG1hcHBpbmcuIFJldHVybnNcbiAgICAgKiBgbnVsbGAgaWYgdGhlIG1hcHBpbmcgaXMgbm90IGF2YWlsYWJsZSBvciBjYW5ub3QgYmUgdXNlZC5cbiAgICAgKi8gICAgVWkoZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0FsbERvY3VtZW50cyh0KSB8fCByLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSA/IHRoaXMuV2koZSwgdCkgOiB0aGlzLktpLmdldERvY3VtZW50cyhlLCBuKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLkdpKHQsIGkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuemkodCwgcywgbiwgcikgPyB0aGlzLldpKGUsIHQpIDogKF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiUmUtdXNpbmcgcHJldmlvdXMgcmVzdWx0IGZyb20gJXMgdG8gZXhlY3V0ZSBxdWVyeTogJXNcIiwgci50b1N0cmluZygpLCBfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodCkpLCBcbiAgICAgICAgICAgIHRoaXMuamkoZSwgcywgdCwgX19QUklWQVRFX25ld0luZGV4T2Zmc2V0U3VjY2Vzc29yRnJvbVJlYWRUaW1lKHIsIC0xKSkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIC8vIFF1ZXJpZXMgdGhhdCBoYXZlIG5ldmVyIHNlZW4gYSBzbmFwc2hvdCB3aXRob3V0IGxpbWJvIGZyZWUgZG9jdW1lbnRzXG4gICAgICAgIC8vIHNob3VsZCBhbHNvIGJlIHJ1biBhcyBhIGZ1bGwgY29sbGVjdGlvbiBzY2FuLlxuICAgICAgICB9XG4gICAgLyoqIEFwcGxpZXMgdGhlIHF1ZXJ5IGZpbHRlciBhbmQgc29ydGluZyB0byB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiAgKi8gICAgR2koZSwgdCkge1xuICAgICAgICAvLyBTb3J0IHRoZSBkb2N1bWVudHMgYW5kIHJlLWFwcGx5IHRoZSBxdWVyeSBmaWx0ZXIgc2luY2UgcHJldmlvdXNseVxuICAgICAgICAvLyBtYXRjaGluZyBkb2N1bWVudHMgZG8gbm90IG5lY2Vzc2FyaWx5IHN0aWxsIG1hdGNoIHRoZSBxdWVyeS5cbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9uZXdRdWVyeUNvbXBhcmF0b3IoZSkpO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCgodCwgcikgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyhlLCByKSAmJiAobiA9IG4uYWRkKHIpKTtcbiAgICAgICAgfSkpLCBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGEgbGltaXQgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgZnJvbSBjYWNoZSwgbWFraW5nIGl0XG4gICAgICogaW5lbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBleGVjdXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkuXG4gICAgICogQHBhcmFtIHNvcnRlZFByZXZpb3VzUmVzdWx0cyAtIFRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSB3aGVuIGl0XG4gICAgICogd2FzIGxhc3Qgc3luY2hyb25pemVkLCBzb3J0ZWQgYnkgdGhlIHF1ZXJ5J3MgY29tcGFyYXRvci5cbiAgICAgKiBAcGFyYW0gcmVtb3RlS2V5cyAtIFRoZSBkb2N1bWVudCBrZXlzIHRoYXQgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIGxhc3RcbiAgICAgKiBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gbGltYm9GcmVlU25hcHNob3RWZXJzaW9uIC0gVGhlIHZlcnNpb24gb2YgdGhlIHNuYXBzaG90IHdoZW4gdGhlXG4gICAgICogcXVlcnkgd2FzIGxhc3Qgc3luY2hyb25pemVkLlxuICAgICAqLyAgICB6aShlLCB0LCBuLCByKSB7XG4gICAgICAgIGlmIChudWxsID09PSBlLmxpbWl0KSBcbiAgICAgICAgLy8gUXVlcmllcyB3aXRob3V0IGxpbWl0cyBkbyBub3QgbmVlZCB0byBiZSByZWZpbGxlZC5cbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBpZiAobi5zaXplICE9PSB0LnNpemUpIFxuICAgICAgICAvLyBUaGUgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgaWYgYSBwcmV2aW91c2x5IG1hdGNoaW5nIGRvY3VtZW50IG5vXG4gICAgICAgIC8vIGxvbmdlciBtYXRjaGVzLlxuICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIC8vIExpbWl0IHF1ZXJpZXMgYXJlIG5vdCBlbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBxdWVyeSBleGVjdXRpb24gaWYgdGhlcmUgaXNcbiAgICAgICAgLy8gYSBwb3RlbnRpYWwgdGhhdCBhbiBvbGRlciBkb2N1bWVudCBmcm9tIGNhY2hlIG5vdyBzb3J0cyBiZWZvcmUgYSBkb2N1bWVudFxuICAgICAgICAvLyB0aGF0IHdhcyBwcmV2aW91c2x5IHBhcnQgb2YgdGhlIGxpbWl0LiBUaGlzLCBob3dldmVyLCBjYW4gb25seSBoYXBwZW4gaWZcbiAgICAgICAgLy8gdGhlIGRvY3VtZW50IGF0IHRoZSBlZGdlIG9mIHRoZSBsaW1pdCBnb2VzIG91dCBvZiBsaW1pdC5cbiAgICAgICAgLy8gSWYgYSBkb2N1bWVudCB0aGF0IGlzIG5vdCB0aGUgbGltaXQgYm91bmRhcnkgc29ydHMgZGlmZmVyZW50bHksXG4gICAgICAgIC8vIHRoZSBib3VuZGFyeSBvZiB0aGUgbGltaXQgaXRzZWxmIGRpZCBub3QgY2hhbmdlIGFuZCBkb2N1bWVudHMgZnJvbSBjYWNoZVxuICAgICAgICAvLyB3aWxsIGNvbnRpbnVlIHRvIGJlIFwicmVqZWN0ZWRcIiBieSB0aGlzIGJvdW5kYXJ5LiBUaGVyZWZvcmUsIHdlIGNhbiBpZ25vcmVcbiAgICAgICAgLy8gYW55IG1vZGlmaWNhdGlvbnMgdGhhdCBkb24ndCBhZmZlY3QgdGhlIGxhc3QgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gZS5saW1pdFR5cGUgPyB0Lmxhc3QoKSA6IHQuZmlyc3QoKTtcbiAgICAgICAgcmV0dXJuICEhaSAmJiAoaS5oYXNQZW5kaW5nV3JpdGVzIHx8IGkudmVyc2lvbi5jb21wYXJlVG8ocikgPiAwKTtcbiAgICB9XG4gICAgV2koZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dldExvZ0xldmVsKCkgPD0gTG9nTGV2ZWwuREVCVUcgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiUXVlcnlFbmdpbmVcIiwgXCJVc2luZyBmdWxsIGNvbGxlY3Rpb24gc2NhbiB0byBleGVjdXRlIHF1ZXJ5OlwiLCBfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodCkpLCBcbiAgICAgICAgdGhpcy5LaS5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIEluZGV4T2Zmc2V0Lm1pbigpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgdGhlIHJlc3VsdHMgZnJvbSBhbiBpbmRleGVkIGV4ZWN1dGlvbiB3aXRoIHRoZSByZW1haW5pbmcgZG9jdW1lbnRzXG4gICAgICogdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBpbmRleGVkLlxuICAgICAqLyAgICBqaShlLCB0LCBuLCByKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIGFsbCByZXN1bHRzIGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlIHVwZGF0ZWQgc2luY2UgdGhlIG9mZnNldC5cbiAgICAgICAgcmV0dXJuIHRoaXMuS2kuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCBuLCByKS5uZXh0KChlID0+IChcbiAgICAgICAgLy8gTWVyZ2Ugd2l0aCBleGlzdGluZyByZXN1bHRzXG4gICAgICAgIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlID0gZS5pbnNlcnQodC5rZXksIHQpO1xuICAgICAgICB9KSksIGUpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbXBsZW1lbnRzIGBMb2NhbFN0b3JlYCBpbnRlcmZhY2UuXG4gKlxuICogTm90ZTogc29tZSBmaWVsZCBkZWZpbmVkIGluIHRoaXMgY2xhc3MgbWlnaHQgaGF2ZSBwdWJsaWMgYWNjZXNzIGxldmVsLCBidXRcbiAqIHRoZSBjbGFzcyBpcyBub3QgZXhwb3J0ZWQgc28gdGhleSBhcmUgb25seSBhY2Nlc3NpYmxlIGZyb20gdGhpcyBtb2R1bGUuXG4gKiBUaGlzIGlzIHVzZWZ1bCB0byBpbXBsZW1lbnQgb3B0aW9uYWwgZmVhdHVyZXMgKGxpa2UgYnVuZGxlcykgaW4gZnJlZVxuICogZnVuY3Rpb25zLCBzdWNoIHRoYXQgdGhleSBhcmUgdHJlZS1zaGFrZWFibGUuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbFN0b3JlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIE1hbmFnZXMgb3VyIGluLW1lbW9yeSBvciBkdXJhYmxlIHBlcnNpc3RlbmNlLiAqL1xuICAgIGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IGUsIHRoaXMuSGkgPSB0LCB0aGlzLnNlcmlhbGl6ZXIgPSByLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgYSB0YXJnZXRJRCB0byBkYXRhIGFib3V0IGl0cyB0YXJnZXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogV2UgYXJlIHVzaW5nIGFuIGltbXV0YWJsZSBkYXRhIHN0cnVjdHVyZSBvbiBXZWIgdG8gbWFrZSByZS1ydW5zXG4gICAgICAgICAqIG9mIGBhcHBseVJlbW90ZUV2ZW50KClgIGlkZW1wb3RlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkppID0gbmV3IFNvcnRlZE1hcChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIFxuICAgICAgICAvKiogTWFwcyBhIHRhcmdldCB0byBpdHMgdGFyZ2V0SUQuICovXG4gICAgICAgIC8vIFRPRE8od3VhbmR5KTogRXZhbHVhdGUgaWYgVGFyZ2V0SWQgY2FuIGJlIHBhcnQgb2YgVGFyZ2V0LlxuICAgICAgICB0aGlzLllpID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoZSkpLCBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHBlciBjb2xsZWN0aW9uIGdyb3VwIGluZGV4IG9mIHRoZSBsYXN0IHJlYWQgdGltZSBwcm9jZXNzZWQgYnlcbiAgICAgICAgICogYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuWmkgPSBuZXcgTWFwLCB0aGlzLlhpID0gZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCksIHRoaXMua3IgPSBlLmdldFRhcmdldENhY2hlKCksIFxuICAgICAgICB0aGlzLlFyID0gZS5nZXRCdW5kbGVDYWNoZSgpLCB0aGlzLmVzKG4pO1xuICAgIH1cbiAgICBlcyhlKSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOiBBZGQgc3BlYyB0ZXN0cyB0aGF0IHRlc3QgdGhlc2UgY29tcG9uZW50cyBjaGFuZ2UgYWZ0ZXIgYVxuICAgICAgICAvLyB1c2VyIGNoYW5nZVxuICAgICAgICB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSwgdGhpcy5pbmRleE1hbmFnZXIgPSB0aGlzLnBlcnNpc3RlbmNlLmdldEluZGV4TWFuYWdlcihlKSwgXG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZSA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0TXV0YXRpb25RdWV1ZShlLCB0aGlzLmluZGV4TWFuYWdlciksIHRoaXMubG9jYWxEb2N1bWVudHMgPSBuZXcgTG9jYWxEb2N1bWVudHNWaWV3KHRoaXMuWGksIHRoaXMubXV0YXRpb25RdWV1ZSwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSwgdGhpcy5pbmRleE1hbmFnZXIpLCBcbiAgICAgICAgdGhpcy5YaS5zZXRJbmRleE1hbmFnZXIodGhpcy5pbmRleE1hbmFnZXIpLCB0aGlzLkhpLmluaXRpYWxpemUodGhpcy5sb2NhbERvY3VtZW50cywgdGhpcy5pbmRleE1hbmFnZXIpO1xuICAgIH1cbiAgICBjb2xsZWN0R2FyYmFnZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29sbGVjdCBnYXJiYWdlXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4gZS5jb2xsZWN0KHQsIHRoaXMuSmkpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3TG9jYWxTdG9yZShcbi8qKiBNYW5hZ2VzIG91ciBpbi1tZW1vcnkgb3IgZHVyYWJsZSBwZXJzaXN0ZW5jZS4gKi9cbmUsIHQsIG4sIHIpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9Mb2NhbFN0b3JlSW1wbChlLCB0LCBuLCByKTtcbn1cblxuLyoqXG4gKiBUZWxscyB0aGUgTG9jYWxTdG9yZSB0aGF0IHRoZSBjdXJyZW50bHkgYXV0aGVudGljYXRlZCB1c2VyIGhhcyBjaGFuZ2VkLlxuICpcbiAqIEluIHJlc3BvbnNlIHRoZSBsb2NhbCBzdG9yZSBzd2l0Y2hlcyB0aGUgbXV0YXRpb24gcXVldWUgdG8gdGhlIG5ldyB1c2VyIGFuZFxuICogcmV0dXJucyBhbnkgcmVzdWx0aW5nIGRvY3VtZW50IGNoYW5nZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogQW5kcm9pZCBhbmQgaU9TIG9ubHkgcmV0dXJuIHRoZSBkb2N1bWVudHMgYWZmZWN0ZWQgYnkgdGhlXG4vLyBjaGFuZ2UuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUhhbmRsZVVzZXJDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiBhd2FpdCBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiSGFuZGxlIHVzZXIgY2hhbmdlXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4ge1xuICAgICAgICAvLyBTd2FwIG91dCB0aGUgbXV0YXRpb24gcXVldWUsIGdyYWJiaW5nIHRoZSBwZW5kaW5nIG11dGF0aW9uIGJhdGNoZXNcbiAgICAgICAgLy8gYmVmb3JlIGFuZCBhZnRlci5cbiAgICAgICAgbGV0IHI7XG4gICAgICAgIHJldHVybiBuLm11dGF0aW9uUXVldWUuZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpLm5leHQoKGkgPT4gKHIgPSBpLCBuLmVzKHQpLCBuLm11dGF0aW9uUXVldWUuZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpKSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IFtdLCBzID0gW107XG4gICAgICAgICAgICAvLyBVbmlvbiB0aGUgb2xkL25ldyBjaGFuZ2VkIGtleXMuXG4gICAgICAgICAgICBsZXQgbyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIHtcbiAgICAgICAgICAgICAgICBpLnB1c2goZS5iYXRjaElkKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZS5tdXRhdGlvbnMpIG8gPSBvLmFkZCh0LmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkge1xuICAgICAgICAgICAgICAgIHMucHVzaChlLmJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBlLm11dGF0aW9ucykgbyA9IG8uYWRkKHQua2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgc2V0IG9mIGFsbCAocG90ZW50aWFsbHkpIGNoYW5nZWQgZG9jdW1lbnRzIGFuZCB0aGUgbGlzdFxuICAgICAgICAgICAgLy8gb2YgbXV0YXRpb24gYmF0Y2ggSURzIHRoYXQgd2VyZSBhZmZlY3RlZCBieSBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudHMoZSwgbykubmV4dCgoZSA9PiAoe1xuICAgICAgICAgICAgICAgIHRzOiBlLFxuICAgICAgICAgICAgICAgIHJlbW92ZWRCYXRjaElkczogaSxcbiAgICAgICAgICAgICAgICBhZGRlZEJhdGNoSWRzOiBzXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9KSk7XG4gICAgfSkpO1xufVxuXG4vKiBBY2NlcHRzIGxvY2FsbHkgZ2VuZXJhdGVkIE11dGF0aW9ucyBhbmQgY29tbWl0IHRoZW0gdG8gc3RvcmFnZS4gKi9cbi8qKlxuICogQWNrbm93bGVkZ2VzIHRoZSBnaXZlbiBiYXRjaC5cbiAqXG4gKiBPbiB0aGUgaGFwcHkgcGF0aCB3aGVuIGEgYmF0Y2ggaXMgYWNrbm93bGVkZ2VkLCB0aGUgbG9jYWwgc3RvcmUgd2lsbFxuICpcbiAqICArIHJlbW92ZSB0aGUgYmF0Y2ggZnJvbSB0aGUgbXV0YXRpb24gcXVldWU7XG4gKiAgKyBhcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlO1xuICogICsgcmVjYWxjdWxhdGUgdGhlIGxhdGVuY3kgY29tcGVuc2F0ZWQgdmlldyBpbXBsaWVkIGJ5IHRob3NlIGNoYW5nZXMgKHRoZXJlXG4gKiAgICBtYXkgYmUgbXV0YXRpb25zIGluIHRoZSBxdWV1ZSB0aGF0IGFmZmVjdCB0aGUgZG9jdW1lbnRzIGJ1dCBoYXZlbid0IGJlZW5cbiAqICAgIGFja25vd2xlZGdlZCB5ZXQpOyBhbmRcbiAqICArIGdpdmUgdGhlIGNoYW5nZWQgZG9jdW1lbnRzIGJhY2sgdGhlIHN5bmMgZW5naW5lXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyAobW9kaWZpZWQpIGRvY3VtZW50cy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVBY2tub3dsZWRnZUJhdGNoKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkFja25vd2xlZGdlIGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICBjb25zdCByID0gdC5iYXRjaC5rZXlzKCksIGkgPSBuLlhpLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgICAgICB0cmFja1JlbW92YWxzOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseVdyaXRlVG9SZW1vdGVEb2N1bWVudHMoZSwgdCwgbiwgcikge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uYmF0Y2gsIHMgPSBpLmtleXMoKTtcbiAgICAgICAgICAgIGxldCBvID0gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBzLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIG8gPSBvLm5leHQoKCgpID0+IHIuZ2V0RW50cnkodCwgZSkpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IG4uZG9jVmVyc2lvbnMuZ2V0KGUpO1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsICE9PSBzKSwgdC52ZXJzaW9uLmNvbXBhcmVUbyhzKSA8IDAgJiYgKGkuYXBwbHlUb1JlbW90ZURvY3VtZW50KHQsIG4pLCBcbiAgICAgICAgICAgICAgICAgICAgdC5pc1ZhbGlkRG9jdW1lbnQoKSAmJiAoXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIHVzZSB0aGUgY29tbWl0VmVyc2lvbiBhcyB0aGUgcmVhZFRpbWUgcmF0aGVyIHRoYW4gdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50J3MgdXBkYXRlVGltZSBzaW5jZSB0aGUgdXBkYXRlVGltZSBpcyBub3QgYWR2YW5jZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHVwZGF0ZXMgdGhhdCBkbyBub3QgbW9kaWZ5IHRoZSB1bmRlcmx5aW5nIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgICAgICB0LnNldFJlYWRUaW1lKG4uY29tbWl0VmVyc2lvbiksIHIuYWRkRW50cnkodCkpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSksIG8ubmV4dCgoKCkgPT4gZS5tdXRhdGlvblF1ZXVlLnJlbW92ZU11dGF0aW9uQmF0Y2godCwgaSkpKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyB0aGUgbG9jYWwgdmlldyBvZiB0aGUgZG9jdW1lbnRzIGFmZmVjdGVkIGJ5IGEgbXV0YXRpb24gYmF0Y2guICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuLCBlLCB0LCBpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gbi5tdXRhdGlvblF1ZXVlLnBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKGUpKSkubmV4dCgoKCkgPT4gbi5kb2N1bWVudE92ZXJsYXlDYWNoZS5yZW1vdmVPdmVybGF5c0ZvckJhdGNoSWQoZSwgciwgdC5iYXRjaC5iYXRjaElkKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMoZSwgZnVuY3Rpb24gX19QUklWQVRFX2dldEtleXNXaXRoVHJhbnNmb3JtUmVzdWx0cyhlKSB7XG4gICAgICAgICAgICBsZXQgdCA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLm11dGF0aW9uUmVzdWx0cy5sZW5ndGg7ICsrbikge1xuICAgICAgICAgICAgICAgIGUubXV0YXRpb25SZXN1bHRzW25dLnRyYW5zZm9ybVJlc3VsdHMubGVuZ3RoID4gMCAmJiAodCA9IHQuYWRkKGUuYmF0Y2gubXV0YXRpb25zW25dLmtleSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZW1vdmVzIG11dGF0aW9ucyBmcm9tIHRoZSBNdXRhdGlvblF1ZXVlIGZvciB0aGUgc3BlY2lmaWVkIGJhdGNoO1xuICogTG9jYWxEb2N1bWVudHMgd2lsbCBiZSByZWNhbGN1bGF0ZWQuXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyBtb2RpZmllZCBkb2N1bWVudHMuXG4gKi8gKHQpKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKGUsIHIpKSk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGxhc3QgY29uc2lzdGVudCBzbmFwc2hvdCBwcm9jZXNzZWQgKHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvXG4gKiBkZXRlcm1pbmUgd2hldGhlciB0byBidWZmZXIgaW5jb21pbmcgc25hcHNob3RzIGZyb20gdGhlIGJhY2tlbmQpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IGxhc3QgcmVtb3RlIHNuYXBzaG90IHZlcnNpb25cIiwgXCJyZWFkb25seVwiLCAoZSA9PiB0LmtyLmdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkpKTtcbn1cblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBcImdyb3VuZC1zdGF0ZVwiIChyZW1vdGUpIGRvY3VtZW50cy4gV2UgYXNzdW1lIHRoYXQgdGhlIHJlbW90ZVxuICogZXZlbnQgcmVmbGVjdHMgYW55IHdyaXRlIGJhdGNoZXMgdGhhdCBoYXZlIGJlZW4gYWNrbm93bGVkZ2VkIG9yIHJlamVjdGVkXG4gKiAoaS5lLiB3ZSBkbyBub3QgcmUtYXBwbHkgbG9jYWwgbXV0YXRpb25zIHRvIHVwZGF0ZXMgZnJvbSB0aGlzIGV2ZW50KS5cbiAqXG4gKiBMb2NhbERvY3VtZW50cyBhcmUgcmUtY2FsY3VsYXRlZCBpZiB0aGVyZSBhcmUgcmVtYWluaW5nIG11dGF0aW9ucyBpbiB0aGVcbiAqIHF1ZXVlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlSZW1vdGVFdmVudFRvTG9jYWxDYWNoZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSB0LnNuYXBzaG90VmVyc2lvbjtcbiAgICBsZXQgaSA9IG4uSmk7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJBcHBseSByZW1vdGUgZXZlbnRcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAoZSA9PiB7XG4gICAgICAgIGNvbnN0IHMgPSBuLlhpLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgICAgICB0cmFja1JlbW92YWxzOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVzZXQgbmV3VGFyZ2V0RGF0YUJ5VGFyZ2V0TWFwIGluIGNhc2UgdGhpcyB0cmFuc2FjdGlvbiBnZXRzIHJlLXJ1bi5cbiAgICAgICAgICAgICAgICBpID0gbi5KaTtcbiAgICAgICAgY29uc3QgbyA9IFtdO1xuICAgICAgICB0LnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKHMsIF8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGEgPSBpLmdldChfKTtcbiAgICAgICAgICAgIGlmICghYSkgcmV0dXJuO1xuICAgICAgICAgICAgLy8gT25seSB1cGRhdGUgdGhlIHJlbW90ZSBrZXlzIGlmIHRoZSB0YXJnZXQgaXMgc3RpbGwgYWN0aXZlLiBUaGlzXG4gICAgICAgICAgICAvLyBlbnN1cmVzIHRoYXQgd2UgY2FuIHBlcnNpc3QgdGhlIHVwZGF0ZWQgdGFyZ2V0IGRhdGEgYWxvbmcgd2l0aFxuICAgICAgICAgICAgLy8gdGhlIHVwZGF0ZWQgYXNzaWdubWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIG8ucHVzaChuLmtyLnJlbW92ZU1hdGNoaW5nS2V5cyhlLCBzLnJlbW92ZWREb2N1bWVudHMsIF8pLm5leHQoKCgpID0+IG4ua3IuYWRkTWF0Y2hpbmdLZXlzKGUsIHMuYWRkZWREb2N1bWVudHMsIF8pKSkpO1xuICAgICAgICAgICAgbGV0IHUgPSBhLndpdGhTZXF1ZW5jZU51bWJlcihlLmN1cnJlbnRTZXF1ZW5jZU51bWJlcik7XG4gICAgICAgICAgICBudWxsICE9PSB0LnRhcmdldE1pc21hdGNoZXMuZ2V0KF8pID8gdSA9IHUud2l0aFJlc3VtZVRva2VuKEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcsIFNuYXBzaG90VmVyc2lvbi5taW4oKSkud2l0aExhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24oU25hcHNob3RWZXJzaW9uLm1pbigpKSA6IHMucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCAmJiAodSA9IHUud2l0aFJlc3VtZVRva2VuKHMucmVzdW1lVG9rZW4sIHIpKSwgXG4gICAgICAgICAgICBpID0gaS5pbnNlcnQoXywgdSksIFxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB0YXJnZXQgZGF0YSBpZiB0aGVyZSBhcmUgdGFyZ2V0IGNoYW5nZXMgKG9yIGlmXG4gICAgICAgICAgICAvLyBzdWZmaWNpZW50IHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUpLlxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIG5ld1RhcmdldERhdGEgc2hvdWxkIGJlIHBlcnNpc3RlZCBkdXJpbmcgYW4gdXBkYXRlIG9mXG4gKiBhbiBhY3RpdmUgdGFyZ2V0LiBUYXJnZXREYXRhIHNob3VsZCBhbHdheXMgYmUgcGVyc2lzdGVkIHdoZW4gYSB0YXJnZXQgaXNcbiAqIGJlaW5nIHJlbGVhc2VkIGFuZCBzaG91bGQgbm90IGNhbGwgdGhpcyBmdW5jdGlvbi5cbiAqXG4gKiBXaGlsZSB0aGUgdGFyZ2V0IGlzIGFjdGl2ZSwgVGFyZ2V0RGF0YSB1cGRhdGVzIGNhbiBiZSBvbWl0dGVkIHdoZW4gbm90aGluZ1xuICogYWJvdXQgdGhlIHRhcmdldCBoYXMgY2hhbmdlZCBleGNlcHQgbWV0YWRhdGEgbGlrZSB0aGUgcmVzdW1lIHRva2VuIG9yXG4gKiBzbmFwc2hvdCB2ZXJzaW9uLiBPY2Nhc2lvbmFsbHkgaXQncyB3b3J0aCB0aGUgZXh0cmEgd3JpdGUgdG8gcHJldmVudCB0aGVzZVxuICogdmFsdWVzIGZyb20gZ2V0dGluZyB0b28gc3RhbGUgYWZ0ZXIgYSBjcmFzaCwgYnV0IHRoaXMgZG9lc24ndCBoYXZlIHRvIGJlXG4gKiB0b28gZnJlcXVlbnQuXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9zaG91bGRQZXJzaXN0VGFyZ2V0RGF0YShlLCB0LCBuKSB7XG4gICAgICAgICAgICAgICAgLy8gQWx3YXlzIHBlcnNpc3QgdGFyZ2V0IGRhdGEgaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIGEgcmVzdW1lIHRva2VuLlxuICAgICAgICAgICAgICAgIGlmICgwID09PSBlLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSkgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIC8vIERvbid0IGFsbG93IHJlc3VtZSB0b2tlbiBjaGFuZ2VzIHRvIGJlIGJ1ZmZlcmVkIGluZGVmaW5pdGVseS4gVGhpc1xuICAgICAgICAgICAgICAgIC8vIGFsbG93cyB1cyB0byBiZSByZWFzb25hYmx5IHVwLXRvLWRhdGUgYWZ0ZXIgYSBjcmFzaCBhbmQgYXZvaWRzIG5lZWRpbmdcbiAgICAgICAgICAgICAgICAvLyB0byBsb29wIG92ZXIgYWxsIGFjdGl2ZSBxdWVyaWVzIG9uIHNodXRkb3duLiBFc3BlY2lhbGx5IGluIHRoZSBicm93c2VyXG4gICAgICAgICAgICAgICAgLy8gd2UgbWF5IG5vdCBnZXQgdGltZSB0byBkbyBhbnl0aGluZyBpbnRlcmVzdGluZyB3aGlsZSB0aGUgY3VycmVudCB0YWIgaXNcbiAgICAgICAgICAgICAgICAvLyBjbG9zaW5nLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5zbmFwc2hvdFZlcnNpb24udG9NaWNyb3NlY29uZHMoKSAtIGUuc25hcHNob3RWZXJzaW9uLnRvTWljcm9zZWNvbmRzKCkgPj0gM2U4KSByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGlmIHRoZSBvbmx5IHRoaW5nIHRoYXQgaGFzIGNoYW5nZWQgYWJvdXQgYSB0YXJnZXQgaXMgaXRzIHJlc3VtZVxuICAgICAgICAgICAgICAgIC8vIHRva2VuIGl0J3Mgbm90IHdvcnRoIHBlcnNpc3RpbmcuIE5vdGUgdGhhdCB0aGUgUmVtb3RlU3RvcmUga2VlcHMgYW5cbiAgICAgICAgICAgICAgICAvLyBpbi1tZW1vcnkgdmlldyBvZiB0aGUgY3VycmVudGx5IGFjdGl2ZSB0YXJnZXRzIHdoaWNoIGluY2x1ZGVzIHRoZSBjdXJyZW50XG4gICAgICAgICAgICAgICAgLy8gcmVzdW1lIHRva2VuLCBzbyBzdHJlYW0gZmFpbHVyZSBvciB1c2VyIGNoYW5nZXMgd2lsbCBzdGlsbCB1c2UgYW5cbiAgICAgICAgICAgICAgICAvLyB1cC10by1kYXRlIHJlc3VtZSB0b2tlbiByZWdhcmRsZXNzIG9mIHdoYXQgd2UgZG8gaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uYWRkZWREb2N1bWVudHMuc2l6ZSArIG4ubW9kaWZpZWREb2N1bWVudHMuc2l6ZSArIG4ucmVtb3ZlZERvY3VtZW50cy5zaXplID4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogTm90aWZpZXMgbG9jYWwgc3RvcmUgb2YgdGhlIGNoYW5nZWQgdmlld3MgdG8gbG9jYWxseSBwaW4gZG9jdW1lbnRzLlxuICovIChhLCB1LCBzKSAmJiBvLnB1c2gobi5rci51cGRhdGVUYXJnZXREYXRhKGUsIHUpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICBsZXQgXyA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgYSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAvLyBIQUNLOiBUaGUgb25seSByZWFzb24gd2UgYWxsb3cgYSBudWxsIHNuYXBzaG90IHZlcnNpb24gaXMgc28gdGhhdCB3ZVxuICAgICAgICAvLyBjYW4gc3ludGhlc2l6ZSByZW1vdGUgZXZlbnRzIHdoZW4gd2UgZ2V0IHBlcm1pc3Npb24gZGVuaWVkIGVycm9ycyB3aGlsZVxuICAgICAgICAvLyB0cnlpbmcgdG8gcmVzb2x2ZSB0aGUgc3RhdGUgb2YgYSBsb2NhbGx5IGNhY2hlZCBkb2N1bWVudCB0aGF0IGlzIGluXG4gICAgICAgIC8vIGxpbWJvLlxuICAgICAgICBpZiAodC5kb2N1bWVudFVwZGF0ZXMuZm9yRWFjaCgociA9PiB7XG4gICAgICAgICAgICB0LnJlc29sdmVkTGltYm9Eb2N1bWVudHMuaGFzKHIpICYmIG8ucHVzaChuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnVwZGF0ZUxpbWJvRG9jdW1lbnQoZSwgcikpO1xuICAgICAgICB9KSksIFxuICAgICAgICAvLyBFYWNoIGxvb3AgaXRlcmF0aW9uIG9ubHkgYWZmZWN0cyBpdHMgXCJvd25cIiBkb2MsIHNvIGl0J3Mgc2FmZSB0byBnZXQgYWxsXG4gICAgICAgIC8vIHRoZSByZW1vdGUgZG9jdW1lbnRzIGluIGFkdmFuY2UgaW4gYSBzaW5nbGUgY2FsbC5cbiAgICAgICAgby5wdXNoKF9fUFJJVkFURV9wb3B1bGF0ZURvY3VtZW50Q2hhbmdlQnVmZmVyKGUsIHMsIHQuZG9jdW1lbnRVcGRhdGVzKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIF8gPSBlLm5zLCBhID0gZS5ycztcbiAgICAgICAgfSkpKSwgIXIuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbi5rci5nZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUpLm5leHQoKHQgPT4gbi5rci5zZXRUYXJnZXRzTWV0YWRhdGEoZSwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIsIHIpKSk7XG4gICAgICAgICAgICBvLnB1c2godCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKG8pLm5leHQoKCgpID0+IHMuYXBwbHkoZSkpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIF8sIGEpKSkubmV4dCgoKCkgPT4gXykpO1xuICAgIH0pKS50aGVuKChlID0+IChuLkppID0gaSwgZSkpKTtcbn1cblxuLyoqXG4gKiBQb3B1bGF0ZXMgZG9jdW1lbnQgY2hhbmdlIGJ1ZmZlciB3aXRoIGRvY3VtZW50cyBmcm9tIGJhY2tlbmQgb3IgYSBidW5kbGUuXG4gKiBSZXR1cm5zIHRoZSBkb2N1bWVudCBjaGFuZ2VzIHJlc3VsdGluZyBmcm9tIGFwcGx5aW5nIHRob3NlIGRvY3VtZW50cywgYW5kXG4gKiBhbHNvIGEgc2V0IG9mIGRvY3VtZW50cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGUgYXJlIGNoYW5nZWQgYXMgYSByZXN1bHQuXG4gKlxuICogQHBhcmFtIHR4biAtIFRyYW5zYWN0aW9uIHRvIHVzZSB0byByZWFkIGV4aXN0aW5nIGRvY3VtZW50cyBmcm9tIHN0b3JhZ2UuXG4gKiBAcGFyYW0gZG9jdW1lbnRCdWZmZXIgLSBEb2N1bWVudCBidWZmZXIgdG8gY29sbGVjdCB0aGUgcmVzdWx0ZWQgY2hhbmdlcyB0byBiZVxuICogICAgICAgIGFwcGxpZWQgdG8gc3RvcmFnZS5cbiAqIEBwYXJhbSBkb2N1bWVudHMgLSBEb2N1bWVudHMgdG8gYmUgYXBwbGllZC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcG9wdWxhdGVEb2N1bWVudENoYW5nZUJ1ZmZlcihlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgIHJldHVybiBuLmZvckVhY2goKGUgPT4gciA9IHIuYWRkKGUpKSksIHQuZ2V0RW50cmllcyhlLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgbGV0IHIgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gZS5nZXQobik7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBzZWUgaWYgdGhlcmUgaXMgYSBleGlzdGVuY2Ugc3RhdGUgY2hhbmdlIGZvciB0aGlzIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgcy5pc0ZvdW5kRG9jdW1lbnQoKSAhPT0gby5pc0ZvdW5kRG9jdW1lbnQoKSAmJiAoaSA9IGkuYWRkKG4pKSwgXG4gICAgICAgICAgICAvLyBOb3RlOiBUaGUgb3JkZXIgb2YgdGhlIHN0ZXBzIGJlbG93IGlzIGltcG9ydGFudCwgc2luY2Ugd2Ugd2FudFxuICAgICAgICAgICAgLy8gdG8gZW5zdXJlIHRoYXQgcmVqZWN0ZWQgbGltYm8gcmVzb2x1dGlvbnMgKHdoaWNoIGZhYnJpY2F0ZVxuICAgICAgICAgICAgLy8gTm9Eb2N1bWVudHMgd2l0aCBTbmFwc2hvdFZlcnNpb24ubWluKCkpIG5ldmVyIGFkZCBkb2N1bWVudHMgdG9cbiAgICAgICAgICAgIC8vIGNhY2hlLlxuICAgICAgICAgICAgcy5pc05vRG9jdW1lbnQoKSAmJiBzLnZlcnNpb24uaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpID8gKFxuICAgICAgICAgICAgLy8gTm9Eb2N1bWVudHMgd2l0aCBTbmFwc2hvdFZlcnNpb24ubWluKCkgYXJlIHVzZWQgaW4gbWFudWZhY3R1cmVkXG4gICAgICAgICAgICAvLyBldmVudHMuIFdlIHJlbW92ZSB0aGVzZSBkb2N1bWVudHMgZnJvbSBjYWNoZSBzaW5jZSB3ZSBsb3N0XG4gICAgICAgICAgICAvLyBhY2Nlc3MuXG4gICAgICAgICAgICB0LnJlbW92ZUVudHJ5KG4sIHMucmVhZFRpbWUpLCByID0gci5pbnNlcnQobiwgcykpIDogIW8uaXNWYWxpZERvY3VtZW50KCkgfHwgcy52ZXJzaW9uLmNvbXBhcmVUbyhvLnZlcnNpb24pID4gMCB8fCAwID09PSBzLnZlcnNpb24uY29tcGFyZVRvKG8udmVyc2lvbikgJiYgby5oYXNQZW5kaW5nV3JpdGVzID8gKHQuYWRkRW50cnkocyksIFxuICAgICAgICAgICAgciA9IHIuaW5zZXJ0KG4sIHMpKSA6IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxvY2FsU3RvcmVcIiwgXCJJZ25vcmluZyBvdXRkYXRlZCB3YXRjaCB1cGRhdGUgZm9yIFwiLCBuLCBcIi4gQ3VycmVudCB2ZXJzaW9uOlwiLCBvLnZlcnNpb24sIFwiIFdhdGNoIHZlcnNpb246XCIsIHMudmVyc2lvbik7XG4gICAgICAgIH0pKSwge1xuICAgICAgICAgICAgbnM6IHIsXG4gICAgICAgICAgICByczogaVxuICAgICAgICB9O1xuICAgIH0pKTtcbn1cblxuLyoqXG4gKiBHZXRzIHRoZSBtdXRhdGlvbiBiYXRjaCBhZnRlciB0aGUgcGFzc2VkIGluIGJhdGNoSWQgaW4gdGhlIG11dGF0aW9uIHF1ZXVlXG4gKiBvciBudWxsIGlmIGVtcHR5LlxuICogQHBhcmFtIGFmdGVyQmF0Y2hJZCAtIElmIHByb3ZpZGVkLCB0aGUgYmF0Y2ggdG8gc2VhcmNoIGFmdGVyLlxuICogQHJldHVybnMgVGhlIG5leHQgbXV0YXRpb24gb3IgbnVsbCBpZiB0aGVyZSB3YXNuJ3Qgb25lLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldE5leHRNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBuZXh0IG11dGF0aW9uIGJhdGNoXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gKHZvaWQgMCA9PT0gdCAmJiAodCA9IC0xKSwgXG4gICAgbi5tdXRhdGlvblF1ZXVlLmdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKGUsIHQpKSkpO1xufVxuXG4vKipcbiAqIFJlYWRzIHRoZSBjdXJyZW50IHZhbHVlIG9mIGEgRG9jdW1lbnQgd2l0aCBhIGdpdmVuIGtleSBvciBudWxsIGlmIG5vdFxuICogZm91bmQgLSB1c2VkIGZvciB0ZXN0aW5nLlxuICovXG4vKipcbiAqIEFzc2lnbnMgdGhlIGdpdmVuIHRhcmdldCBhbiBpbnRlcm5hbCBJRCBzbyB0aGF0IGl0cyByZXN1bHRzIGNhbiBiZSBwaW5uZWQgc29cbiAqIHRoZXkgZG9uJ3QgZ2V0IEdDJ2QuIEEgdGFyZ2V0IG11c3QgYmUgYWxsb2NhdGVkIGluIHRoZSBsb2NhbCBzdG9yZSBiZWZvcmVcbiAqIHRoZSBzdG9yZSBjYW4gYmUgdXNlZCB0byBtYW5hZ2UgaXRzIHZpZXcuXG4gKlxuICogQWxsb2NhdGluZyBhbiBhbHJlYWR5IGFsbG9jYXRlZCBgVGFyZ2V0YCB3aWxsIHJldHVybiB0aGUgZXhpc3RpbmcgYFRhcmdldERhdGFgXG4gKiBmb3IgdGhhdCBgVGFyZ2V0YC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJBbGxvY2F0ZSB0YXJnZXRcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4ge1xuICAgICAgICBsZXQgcjtcbiAgICAgICAgcmV0dXJuIG4ua3IuZ2V0VGFyZ2V0RGF0YShlLCB0KS5uZXh0KChpID0+IGkgPyAoXG4gICAgICAgIC8vIFRoaXMgdGFyZ2V0IGhhcyBiZWVuIGxpc3RlbmVkIHRvIHByZXZpb3VzbHksIHNvIHJldXNlIHRoZVxuICAgICAgICAvLyBwcmV2aW91cyB0YXJnZXRJRC5cbiAgICAgICAgLy8gVE9ETyhtY2cpOiBmcmVzaGVuIGxhc3QgYWNjZXNzZWQgZGF0ZT9cbiAgICAgICAgciA9IGksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHIpKSA6IG4ua3IuYWxsb2NhdGVUYXJnZXRJZChlKS5uZXh0KChpID0+IChyID0gbmV3IFRhcmdldERhdGEodCwgaSwgXCJUYXJnZXRQdXJwb3NlTGlzdGVuXCIgLyogVGFyZ2V0UHVycG9zZS5MaXN0ZW4gKi8gLCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFxuICAgICAgICBuLmtyLmFkZFRhcmdldERhdGEoZSwgcikubmV4dCgoKCkgPT4gcikpKSkpKSk7XG4gICAgfSkpLnRoZW4oKGUgPT4ge1xuICAgICAgICAvLyBJZiBNdWx0aS1UYWIgaXMgZW5hYmxlZCwgdGhlIGV4aXN0aW5nIHRhcmdldCBkYXRhIG1heSBiZSBuZXdlciB0aGFuXG4gICAgICAgIC8vIHRoZSBpbi1tZW1vcnkgZGF0YVxuICAgICAgICBjb25zdCByID0gbi5KaS5nZXQoZS50YXJnZXRJZCk7XG4gICAgICAgIHJldHVybiAobnVsbCA9PT0gciB8fCBlLnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8oci5zbmFwc2hvdFZlcnNpb24pID4gMCkgJiYgKG4uSmkgPSBuLkppLmluc2VydChlLnRhcmdldElkLCBlKSwgXG4gICAgICAgIG4uWWkuc2V0KHQsIGUudGFyZ2V0SWQpKSwgZTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgVGFyZ2V0RGF0YSBhcyBzZWVuIGJ5IHRoZSBMb2NhbFN0b3JlLCBpbmNsdWRpbmcgdXBkYXRlcyB0aGF0IG1heVxuICogaGF2ZSBub3QgeWV0IGJlZW4gcGVyc2lzdGVkIHRvIHRoZSBUYXJnZXRDYWNoZS5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbi8qKlxuICogVW5waW5zIGFsbCB0aGUgZG9jdW1lbnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gdGFyZ2V0LiBJZlxuICogYGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhYCBpcyBzZXQgdG8gZmFsc2UgYW5kIEVhZ2VyIEdDIGVuYWJsZWQsIHRoZSBtZXRob2RcbiAqIGRpcmVjdGx5IHJlbW92ZXMgdGhlIGFzc29jaWF0ZWQgdGFyZ2V0IGRhdGEgZnJvbSB0aGUgdGFyZ2V0IGNhY2hlLlxuICpcbiAqIFJlbGVhc2luZyBhIG5vbi1leGlzdGluZyBgVGFyZ2V0YCBpcyBhIG5vLW9wLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IGBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YWAgaXMgbXVsdGktdGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBpID0gci5KaS5nZXQodCksIHMgPSBuID8gXCJyZWFkd3JpdGVcIiA6IFwicmVhZHdyaXRlLXByaW1hcnlcIjtcbiAgICB0cnkge1xuICAgICAgICBuIHx8IGF3YWl0IHIucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJSZWxlYXNlIHRhcmdldFwiLCBzLCAoZSA9PiByLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVRhcmdldChlLCBpKSkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpKSB0aHJvdyBlO1xuICAgICAgICAvLyBBbGwgYHJlbGVhc2VUYXJnZXRgIGRvZXMgaXMgcmVjb3JkIHRoZSBmaW5hbCBtZXRhZGF0YSBzdGF0ZSBmb3IgdGhlXG4gICAgICAgIC8vIHRhcmdldCwgYnV0IHdlJ3ZlIGJlZW4gcmVjb3JkaW5nIHRoaXMgcGVyaW9kaWNhbGx5IGR1cmluZyB0YXJnZXRcbiAgICAgICAgLy8gYWN0aXZpdHkuIElmIHdlIGxvc2UgdGhpcyB3cml0ZSB0aGlzIGNvdWxkIGNhdXNlIGEgdmVyeSBzbGlnaHRcbiAgICAgICAgLy8gZGlmZmVyZW5jZSBpbiB0aGUgb3JkZXIgb2YgdGFyZ2V0IGRlbGV0aW9uIGR1cmluZyBHQywgYnV0IHdlXG4gICAgICAgIC8vIGRvbid0IGRlZmluZSBleGFjdCBMUlUgc2VtYW50aWNzIHNvIHRoaXMgaXMgYWNjZXB0YWJsZS5cbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiTG9jYWxTdG9yZVwiLCBgRmFpbGVkIHRvIHVwZGF0ZSBzZXF1ZW5jZSBudW1iZXJzIGZvciB0YXJnZXQgJHt0fTogJHtlfWApO1xuICAgIH1cbiAgICByLkppID0gci5KaS5yZW1vdmUodCksIHIuWWkuZGVsZXRlKGkudGFyZ2V0KTtcbn1cblxuLyoqXG4gKiBSdW5zIHRoZSBzcGVjaWZpZWQgcXVlcnkgYWdhaW5zdCB0aGUgbG9jYWwgc3RvcmUgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMsXG4gKiBwb3RlbnRpYWxseSB0YWtpbmcgYWR2YW50YWdlIG9mIHF1ZXJ5IGRhdGEgZnJvbSBwcmV2aW91cyBleGVjdXRpb25zIChzdWNoXG4gKiBhcyB0aGUgc2V0IG9mIHJlbW90ZSBrZXlzKS5cbiAqXG4gKiBAcGFyYW0gdXNlUHJldmlvdXNSZXN1bHRzIC0gV2hldGhlciByZXN1bHRzIGZyb20gcHJldmlvdXMgZXhlY3V0aW9ucyBjYW5cbiAqIGJlIHVzZWQgdG8gb3B0aW1pemUgdGhpcyBxdWVyeSBleGVjdXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVFeGVjdXRlUXVlcnkoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCBpID0gU25hcHNob3RWZXJzaW9uLm1pbigpLCBzID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgcmV0dXJuIHIucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJFeGVjdXRlIHF1ZXJ5XCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRUYXJnZXREYXRhKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSByLllpLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gaSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHIuSmkuZ2V0KGkpKSA6IHIua3IuZ2V0VGFyZ2V0RGF0YSh0LCBuKTtcbiAgICB9KHIsIGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgaWYgKHQpIHJldHVybiBpID0gdC5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCByLmtyLmdldE1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQudGFyZ2V0SWQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgcyA9IGU7XG4gICAgICAgIH0pKTtcbiAgICB9KSkubmV4dCgoKCkgPT4gci5IaS5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4gPyBpIDogU25hcHNob3RWZXJzaW9uLm1pbigpLCBuID8gcyA6IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSkpLm5leHQoKGUgPT4gKF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShyLCBfX1BSSVZBVEVfcXVlcnlDb2xsZWN0aW9uR3JvdXAodCksIGUpLCBcbiAgICB7XG4gICAgICAgIGRvY3VtZW50czogZSxcbiAgICAgICAgc3M6IHNcbiAgICB9KSkpKSk7XG59XG5cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldENhY2hlZFRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KG4ua3IpLCBpID0gbi5KaS5nZXQodCk7XG4gICAgcmV0dXJuIGkgPyBQcm9taXNlLnJlc29sdmUoaS50YXJnZXQpIDogbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCB0YXJnZXQgZGF0YVwiLCBcInJlYWRvbmx5XCIsIChlID0+IHIudXQoZSwgdCkubmV4dCgoZSA9PiBlID8gZS50YXJnZXQgOiBudWxsKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgc2luY2UgdGhlIGxhc3QgY2FsbC5cbiAqIElmIHRoaXMgaXMgdGhlIGZpcnN0IGNhbGwsIHJldHVybnMgdGhlIHNldCBvZiBjaGFuZ2VzIHNpbmNlIGNsaWVudFxuICogaW5pdGlhbGl6YXRpb24uIEZ1cnRoZXIgaW52b2NhdGlvbnMgd2lsbCByZXR1cm4gZG9jdW1lbnQgdGhhdCBoYXZlIGNoYW5nZWRcbiAqIHNpbmNlIHRoZSBwcmlvciBjYWxsLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gbi5aaS5nZXQodCkgfHwgU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBtYXhpbXVtIHJlYWQgdGltZSBmb3IgdGhlIGNvbGxlY3Rpb24uIFRoaXMgc2hvdWxkIGFsd2F5c1xuICAgIC8vIGV4aXN0LCBidXQgdG8gcmVkdWNlIHRoZSBjaGFuY2UgZm9yIHJlZ3Jlc3Npb25zIHdlIGRlZmF1bHQgdG9cbiAgICAvLyBTbmFwc2hvdFZlcnNpb24uTWluKClcbiAgICAvLyBUT0RPKGluZGV4aW5nKTogQ29uc2lkZXIgcmVtb3ZpbmcgdGhlIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5ldyBkb2N1bWVudCBjaGFuZ2VzXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5YaS5nZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQsIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShyLCAtMSksIFxuICAgIC8qIGxpbWl0PSAqLyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikpKS50aGVuKChlID0+IChfX1BSSVZBVEVfc2V0TWF4UmVhZFRpbWUobiwgdCwgZSksIFxuICAgIGUpKSk7XG59XG5cbi8qKiBTZXRzIHRoZSBjb2xsZWN0aW9uIGdyb3VwJ3MgbWF4aW11bSByZWFkIHRpbWUgZnJvbSB0aGUgZ2l2ZW4gZG9jdW1lbnRzLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBlLlppLmdldCh0KSB8fCBTbmFwc2hvdFZlcnNpb24ubWluKCk7XG4gICAgbi5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICB0LnJlYWRUaW1lLmNvbXBhcmVUbyhyKSA+IDAgJiYgKHIgPSB0LnJlYWRUaW1lKTtcbiAgICB9KSksIGUuWmkuc2V0KHQsIHIpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IHVzaW5nIHRoZSBnaXZlbiBidW5kbGUgbmFtZSwgd2hpY2ggd2lsbCBiZSB1c2VkIHRvXG4gKiBob2xkIHRoZSBrZXlzIG9mIGFsbCBkb2N1bWVudHMgZnJvbSB0aGUgYnVuZGxlIGluIHF1ZXJ5LWRvY3VtZW50IG1hcHBpbmdzLlxuICogVGhpcyBlbnN1cmVzIHRoYXQgdGhlIGxvYWRlZCBkb2N1bWVudHMgZG8gbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZFxuICogcmlnaHQgYXdheS5cbiAqL1xuLyoqXG4gKiBBcHBsaWVzIHRoZSBkb2N1bWVudHMgZnJvbSBhIGJ1bmRsZSB0byB0aGUgXCJncm91bmQtc3RhdGVcIiAocmVtb3RlKVxuICogZG9jdW1lbnRzLlxuICpcbiAqIExvY2FsRG9jdW1lbnRzIGFyZSByZS1jYWxjdWxhdGVkIGlmIHRoZXJlIGFyZSByZW1haW5pbmcgbXV0YXRpb25zIGluIHRoZVxuICogcXVldWUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlCdW5kbGVkRG9jdW1lbnRzKGUsIHQsIG4sIHIpIHtcbiAgICBjb25zdCBpID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBsZXQgcyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBvID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgIGZvciAoY29uc3QgZSBvZiBuKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm9zKGUubWV0YWRhdGEubmFtZSk7XG4gICAgICAgIGUuZG9jdW1lbnQgJiYgKHMgPSBzLmFkZChuKSk7XG4gICAgICAgIGNvbnN0IHIgPSB0Ll9zKGUpO1xuICAgICAgICByLnNldFJlYWRUaW1lKHQudXMoZS5tZXRhZGF0YS5yZWFkVGltZSkpLCBvID0gby5pbnNlcnQobiwgcik7XG4gICAgfVxuICAgIGNvbnN0IF8gPSBpLlhpLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgIHRyYWNrUmVtb3ZhbHM6ICEwXG4gICAgfSksIGEgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFsbG9jYXRlVGFyZ2V0KGksIGZ1bmN0aW9uIF9fUFJJVkFURV91bWJyZWxsYVRhcmdldChlKSB7XG4gICAgICAgIC8vIEl0IGlzIE9LIHRoYXQgdGhlIHBhdGggdXNlZCBmb3IgdGhlIHF1ZXJ5IGlzIG5vdCB2YWxpZCwgYmVjYXVzZSB0aGlzIHdpbGxcbiAgICAgICAgLy8gbm90IGJlIHJlYWQgYW5kIHF1ZXJpZWQuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGBfX2J1bmRsZV9fL2RvY3MvJHtlfWApKSk7XG4gICAgfShyKSk7XG4gICAgLy8gQWxsb2NhdGVzIGEgdGFyZ2V0IHRvIGhvbGQgYWxsIGRvY3VtZW50IGtleXMgZnJvbSB0aGUgYnVuZGxlLCBzdWNoIHRoYXRcbiAgICAvLyB0aGV5IHdpbGwgbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZCByaWdodCBhd2F5LlxuICAgICAgICByZXR1cm4gaS5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkFwcGx5IGJ1bmRsZSBkb2N1bWVudHNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gX19QUklWQVRFX3BvcHVsYXRlRG9jdW1lbnRDaGFuZ2VCdWZmZXIoZSwgXywgbykubmV4dCgodCA9PiAoXy5hcHBseShlKSwgXG4gICAgdCkpKS5uZXh0KCh0ID0+IGkua3IucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgYS50YXJnZXRJZCkubmV4dCgoKCkgPT4gaS5rci5hZGRNYXRjaGluZ0tleXMoZSwgcywgYS50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLmxvY2FsRG9jdW1lbnRzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIHQubnMsIHQucnMpKSkubmV4dCgoKCkgPT4gdC5ucykpKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgaWYgdGhlIGdpdmVuIGJ1bmRsZSBoYXMgYWxyZWFkeVxuICogYmVlbiBsb2FkZWQgYW5kIHRoZSBjcmVhdGUgdGltZSBpcyBuZXdlciB0aGFuIHRoZSBjdXJyZW50IGxvYWRpbmcgYnVuZGxlLlxuICovXG4vKipcbiAqIFNhdmVzIHRoZSBnaXZlbiBgTmFtZWRRdWVyeWAgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlU2F2ZU5hbWVkUXVlcnkoZSwgdCwgbiA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSB7XG4gICAgLy8gQWxsb2NhdGUgYSB0YXJnZXQgZm9yIHRoZSBuYW1lZCBxdWVyeSBzdWNoIHRoYXQgaXQgY2FuIGJlIHJlc3VtZWRcbiAgICAvLyBmcm9tIGFzc29jaWF0ZWQgcmVhZCB0aW1lIGlmIHVzZXJzIHVzZSBpdCB0byBsaXN0ZW4uXG4gICAgLy8gTk9URTogdGhpcyBhbHNvIG1lYW5zIGlmIG5vIGNvcnJlc3BvbmRpbmcgdGFyZ2V0IGV4aXN0cywgdGhlIG5ldyB0YXJnZXRcbiAgICAvLyB3aWxsIHJlbWFpbiBhY3RpdmUgYW5kIHdpbGwgbm90IGdldCBjb2xsZWN0ZWQsIHVubGVzcyB1c2VycyBoYXBwZW4gdG9cbiAgICAvLyB1bmxpc3RlbiB0aGUgcXVlcnkgc29tZWhvdy5cbiAgICBjb25zdCByID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChlLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeSh0LmJ1bmRsZWRRdWVyeSkpKSwgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIGkucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIG5hbWVkIHF1ZXJ5XCIsIFwicmVhZHdyaXRlXCIsIChlID0+IHtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LnJlYWRUaW1lKTtcbiAgICAgICAgLy8gU2ltcGx5IHNhdmUgdGhlIHF1ZXJ5IGl0c2VsZiBpZiBpdCBpcyBvbGRlciB0aGFuIHdoYXQgdGhlIFNESyBhbHJlYWR5XG4gICAgICAgIC8vIGhhcy5cbiAgICAgICAgICAgICAgICBpZiAoci5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHMpID49IDApIHJldHVybiBpLlFyLnNhdmVOYW1lZFF1ZXJ5KGUsIHQpO1xuICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgdGFyZ2V0IGRhdGEgYmVjYXVzZSB0aGUgcXVlcnkgZnJvbSB0aGUgYnVuZGxlIGlzIG5ld2VyLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSByLndpdGhSZXN1bWVUb2tlbihCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HLCBzKTtcbiAgICAgICAgcmV0dXJuIGkuSmkgPSBpLkppLmluc2VydChvLnRhcmdldElkLCBvKSwgaS5rci51cGRhdGVUYXJnZXREYXRhKGUsIG8pLm5leHQoKCgpID0+IGkua3IucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgci50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLmtyLmFkZE1hdGNoaW5nS2V5cyhlLCBuLCByLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkuUXIuc2F2ZU5hbWVkUXVlcnkoZSwgdCkpKTtcbiAgICB9KSk7XG59XG5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZSAqL1xuZnVuY3Rpb24gY3JlYXRlV2ViU3RvcmFnZUNsaWVudFN0YXRlS2V5KGUsIHQpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV9jbGllbnRzXyR7ZX1fJHt0fWA7XG59XG5cbi8vIFRoZSBmb3JtYXQgb2YgdGhlIFdlYlN0b3JhZ2Uga2V5IHRoYXQgc3RvcmVzIHRoZSBtdXRhdGlvbiBzdGF0ZSBpczpcbi8vICAgICBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5cbi8vICAgICAoZm9yIHVuYXV0aGVudGljYXRlZCB1c2Vycylcbi8vIG9yOiBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5fPHVzZXJfdWlkPlxuXG4vLyAndXNlcl91aWQnIGlzIGxhc3QgdG8gYXZvaWQgbmVlZGluZyB0byBlc2NhcGUgJ18nIGNoYXJhY3RlcnMgdGhhdCBpdCBtaWdodFxuLy8gY29udGFpbi5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBtdXRhdGlvbiBiYXRjaCBpbiBXZWJTdG9yYWdlICovXG5mdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlTXV0YXRpb25CYXRjaEtleShlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBgZmlyZXN0b3JlX211dGF0aW9uc18ke2V9XyR7bn1gO1xuICAgIHJldHVybiB0LmlzQXV0aGVudGljYXRlZCgpICYmIChyICs9IGBfJHt0LnVpZH1gKSwgcjtcbn1cblxuLy8gVGhlIGZvcm1hdCBvZiB0aGUgV2ViU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgYSBxdWVyeSB0YXJnZXQncyBtZXRhZGF0YSBpczpcbi8vICAgICBmaXJlc3RvcmVfdGFyZ2V0c188cGVyc2lzdGVuY2VfcHJlZml4Pl88dGFyZ2V0X2lkPlxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIHF1ZXJ5IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KGUsIHQpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV90YXJnZXRzXyR7ZX1fJHt0fWA7XG59XG5cbi8vIFRoZSBXZWJTdG9yYWdlIHByZWZpeCB0aGF0IHN0b3JlcyB0aGUgcHJpbWFyeSB0YWIncyBvbmxpbmUgc3RhdGUuIFRoZVxuLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4vLyAgICAgZmlyZXN0b3JlX29ubGluZV9zdGF0ZV88cGVyc2lzdGVuY2VfcHJlZml4PlxuLyoqXG4gKiBIb2xkcyB0aGUgc3RhdGUgb2YgYSBtdXRhdGlvbiBiYXRjaCwgaW5jbHVkaW5nIGl0cyB1c2VyIElELCBiYXRjaCBJRCBhbmRcbiAqIHdoZXRoZXIgdGhlIGJhdGNoIGlzICdwZW5kaW5nJywgJ2Fja25vd2xlZGdlZCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX011dGF0aW9uTWV0YWRhdGEge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy51c2VyID0gZSwgdGhpcy5iYXRjaElkID0gdCwgdGhpcy5zdGF0ZSA9IG4sIHRoaXMuZXJyb3IgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBNdXRhdGlvbk1ldGFkYXRhIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgY3MoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gSlNPTi5wYXJzZShuKTtcbiAgICAgICAgbGV0IGksIHMgPSBcIm9iamVjdFwiID09IHR5cGVvZiByICYmIC0xICE9PSBbIFwicGVuZGluZ1wiLCBcImFja25vd2xlZGdlZFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKHIuc3RhdGUpICYmICh2b2lkIDAgPT09IHIuZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygci5lcnJvcik7XG4gICAgICAgIHJldHVybiBzICYmIHIuZXJyb3IgJiYgKHMgPSBcInN0cmluZ1wiID09IHR5cGVvZiByLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygci5lcnJvci5jb2RlLCBcbiAgICAgICAgcyAmJiAoaSA9IG5ldyBGaXJlc3RvcmVFcnJvcihyLmVycm9yLmNvZGUsIHIuZXJyb3IubWVzc2FnZSkpKSwgcyA/IG5ldyBfX1BSSVZBVEVfTXV0YXRpb25NZXRhZGF0YShlLCB0LCByLnN0YXRlLCBpKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG11dGF0aW9uIHN0YXRlIGZvciBJRCAnJHt0fSc6ICR7bn1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICBscygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmIChlLmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgcXVlcnkgdGFyZ2V0LCBpbmNsdWRpbmcgaXRzIHRhcmdldCBJRCBhbmQgd2hldGhlciB0aGVcbiAqIHRhcmdldCBpcyAnbm90LWN1cnJlbnQnLCAnY3VycmVudCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IGUsIHRoaXMuc3RhdGUgPSB0LCB0aGlzLmVycm9yID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUXVlcnlUYXJnZXRNZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIGNzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgIGxldCByLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbiAmJiAtMSAhPT0gWyBcIm5vdC1jdXJyZW50XCIsIFwiY3VycmVudFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKG4uc3RhdGUpICYmICh2b2lkIDAgPT09IG4uZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygbi5lcnJvcik7XG4gICAgICAgIHJldHVybiBpICYmIG4uZXJyb3IgJiYgKGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiBuLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygbi5lcnJvci5jb2RlLCBcbiAgICAgICAgaSAmJiAociA9IG5ldyBGaXJlc3RvcmVFcnJvcihuLmVycm9yLmNvZGUsIG4uZXJyb3IubWVzc2FnZSkpKSwgaSA/IG5ldyBfX1BSSVZBVEVfUXVlcnlUYXJnZXRNZXRhZGF0YShlLCBuLnN0YXRlLCByKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIHRhcmdldCBzdGF0ZSBmb3IgSUQgJyR7ZX0nOiAke3R9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgbHMoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB7XG4gICAgICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZVRpbWVNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvciAmJiAoZS5lcnJvciA9IHtcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuZXJyb3IuY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuZXJyb3IubWVzc2FnZVxuICAgICAgICB9KSwgSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgaW1tdXRhYmxlIENsaWVudFN0YXRlIGZvciBhIGNsaWVudCByZWFkIGZyb21cbiAqIFdlYlN0b3JhZ2UsIGNvbnRhaW5pbmcgdGhlIGxpc3Qgb2YgYWN0aXZlIHF1ZXJ5IHRhcmdldHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1JlbW90ZUNsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuY2xpZW50SWQgPSBlLCB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIFJlbW90ZUNsaWVudFN0YXRlIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgY3MoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gSlNPTi5wYXJzZSh0KTtcbiAgICAgICAgbGV0IHIgPSBcIm9iamVjdFwiID09IHR5cGVvZiBuICYmIG4uYWN0aXZlVGFyZ2V0SWRzIGluc3RhbmNlb2YgQXJyYXksIGkgPSBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IHIgJiYgZSA8IG4uYWN0aXZlVGFyZ2V0SWRzLmxlbmd0aDsgKytlKSByID0gaXNTYWZlSW50ZWdlcihuLmFjdGl2ZVRhcmdldElkc1tlXSksIFxuICAgICAgICBpID0gaS5hZGQobi5hY3RpdmVUYXJnZXRJZHNbZV0pO1xuICAgICAgICByZXR1cm4gciA/IG5ldyBfX1BSSVZBVEVfUmVtb3RlQ2xpZW50U3RhdGUoZSwgaSkgOiAoX19QUklWQVRFX2xvZ0Vycm9yKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgYEZhaWxlZCB0byBwYXJzZSBjbGllbnQgZGF0YSBmb3IgaW5zdGFuY2UgJyR7ZX0nOiAke3R9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyByZXByZXNlbnRzIHRoZSBvbmxpbmUgc3RhdGUgZm9yIGFsbCBjbGllbnRzIHBhcnRpY2lwYXRpbmcgaW5cbiAqIG11bHRpLXRhYi4gVGhlIG9ubGluZSBzdGF0ZSBpcyBvbmx5IHdyaXR0ZW4gdG8gYnkgdGhlIHByaW1hcnkgY2xpZW50LCBhbmRcbiAqIHVzZWQgaW4gc2Vjb25kYXJ5IGNsaWVudHMgdG8gdXBkYXRlIHRoZWlyIHF1ZXJ5IHZpZXdzLlxuICovIGNsYXNzIF9fUFJJVkFURV9TaGFyZWRPbmxpbmVTdGF0ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmNsaWVudElkID0gZSwgdGhpcy5vbmxpbmVTdGF0ZSA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIFNoYXJlZE9ubGluZVN0YXRlIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgY3MoZSkge1xuICAgICAgICBjb25zdCB0ID0gSlNPTi5wYXJzZShlKTtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgJiYgLTEgIT09IFsgXCJVbmtub3duXCIsIFwiT25saW5lXCIsIFwiT2ZmbGluZVwiIF0uaW5kZXhPZih0Lm9ubGluZVN0YXRlKSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0LmNsaWVudElkID8gbmV3IF9fUFJJVkFURV9TaGFyZWRPbmxpbmVTdGF0ZSh0LmNsaWVudElkLCB0Lm9ubGluZVN0YXRlKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG9ubGluZSBzdGF0ZTogJHtlfWApLCBcbiAgICAgICAgbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1ldGFkYXRhIHN0YXRlIG9mIHRoZSBsb2NhbCBjbGllbnQuIFVubGlrZSBgUmVtb3RlQ2xpZW50U3RhdGVgLCB0aGlzIGNsYXNzIGlzXG4gKiBtdXRhYmxlIGFuZCBrZWVwcyB0cmFjayBvZiBhbGwgcGVuZGluZyBtdXRhdGlvbnMsIHdoaWNoIGFsbG93cyB1cyB0b1xuICogdXBkYXRlIHRoZSByYW5nZSBvZiBwZW5kaW5nIG11dGF0aW9uIGJhdGNoIElEcyBhcyBuZXcgbXV0YXRpb25zIGFyZSBhZGRlZCBvclxuICogcmVtb3ZlZC5cbiAqXG4gKiBUaGUgZGF0YSBpbiBgTG9jYWxDbGllbnRTdGF0ZWAgaXMgbm90IHJlYWQgZnJvbSBXZWJTdG9yYWdlIGFuZCBpbnN0ZWFkXG4gKiB1cGRhdGVkIHZpYSBpdHMgaW5zdGFuY2UgbWV0aG9kcy4gVGhlIHVwZGF0ZWQgc3RhdGUgY2FuIGJlIHNlcmlhbGl6ZWQgdmlhXG4gKiBgdG9XZWJTdG9yYWdlSlNPTigpYC5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXJnZXRJZHMgPSBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKTtcbiAgICB9XG4gICAgaHMoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmFkZChlKTtcbiAgICB9XG4gICAgUHMoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmRlbGV0ZShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBlbnRyeSBpbnRvIGEgSlNPTi1lbmNvZGVkIGZvcm1hdCB3ZSBjYW4gdXNlIGZvciBXZWJTdG9yYWdlLlxuICAgICAqIERvZXMgbm90IGVuY29kZSBgY2xpZW50SWRgIGFzIGl0IGlzIHBhcnQgb2YgdGhlIGtleSBpbiBXZWJTdG9yYWdlLlxuICAgICAqLyAgICBscygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGFjdGl2ZVRhcmdldElkczogdGhpcy5hY3RpdmVUYXJnZXRJZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgdXNlcyBXZWJTdG9yYWdlICh3aW5kb3cubG9jYWxTdG9yYWdlKSBhcyB0aGVcbiAqIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSBTaGFyZWRDbGllbnRTdGF0ZS4gSXQga2VlcHMgdHJhY2sgb2YgYWxsIGFjdGl2ZVxuICogY2xpZW50cyBhbmQgc3VwcG9ydHMgbW9kaWZpY2F0aW9ucyBvZiB0aGUgbG9jYWwgY2xpZW50J3MgZGF0YS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMud2luZG93ID0gZSwgdGhpcy5paSA9IHQsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBuLCB0aGlzLklzID0gciwgdGhpcy5zeW5jRW5naW5lID0gbnVsbCwgXG4gICAgICAgIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gbnVsbCwgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIgPSBudWxsLCB0aGlzLlRzID0gdGhpcy5Fcy5iaW5kKHRoaXMpLCBcbiAgICAgICAgdGhpcy5kcyA9IG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCB0aGlzLnN0YXJ0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYXB0dXJlcyBXZWJTdG9yYWdlIGV2ZW50cyB0aGF0IG9jY3VyIGJlZm9yZSBgc3RhcnQoKWAgaXMgY2FsbGVkLiBUaGVzZVxuICAgICAgICAgKiBldmVudHMgYXJlIHJlcGxheWVkIG9uY2UgYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgaXMgc3RhcnRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuQXMgPSBbXTtcbiAgICAgICAgLy8gRXNjYXBlIHRoZSBzcGVjaWFsIGNoYXJhY3RlcnMgbWVudGlvbmVkIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvR3VpZGUvUmVndWxhcl9FeHByZXNzaW9uc1xuICAgICAgICBjb25zdCBzID0gbi5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSwgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMuUnMgPSBjcmVhdGVXZWJTdG9yYWdlQ2xpZW50U3RhdGVLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgdGhpcy5JcyksIFxuICAgICAgICB0aGlzLlZzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIGN1cnJlbnQgc2VxdWVuY2UgbnVtYmVyLiAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlU2VxdWVuY2VOdW1iZXJLZXkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGBmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXyR7ZX1gO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy5kcyA9IHRoaXMuZHMuaW5zZXJ0KHRoaXMuSXMsIG5ldyBfX1BSSVZBVEVfTG9jYWxDbGllbnRTdGF0ZSksIFxuICAgICAgICB0aGlzLmZzID0gbmV3IFJlZ0V4cChgXmZpcmVzdG9yZV9jbGllbnRzXyR7c31fKFteX10qKSRgKSwgdGhpcy5ncyA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfbXV0YXRpb25zXyR7c31fKFxcXFxkKykoPzpfKC4qKSk/JGApLCBcbiAgICAgICAgdGhpcy5wcyA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfdGFyZ2V0c18ke3N9XyhcXFxcZCspJGApLCB0aGlzLnlzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIG9ubGluZSBzdGF0ZSBvZiB0aGUgcHJpbWFyeSB0YWIuICovXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdlYlN0b3JhZ2VPbmxpbmVTdGF0ZUtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9vbmxpbmVfc3RhdGVfJHtlfWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIFdlYlN0b3JhZ2UgcHJlZml4IHRoYXQgcGxheXMgYXMgYSBldmVudCB0byBpbmRpY2F0ZSB0aGUgcmVtb3RlIGRvY3VtZW50c1xuICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQgZHVlIHRvIHNvbWUgc2Vjb25kYXJ5IHRhYnMgbG9hZGluZyBhIGJ1bmRsZS5cbiAgICAgICAgLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4gICAgICAgIC8vICAgICBmaXJlc3RvcmVfYnVuZGxlX2xvYWRlZF92Ml88cGVyc2lzdGVuY2VLZXk+XG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIGVuZGluZyB3aXRoIFwidjJcIiBzdG9yZXMgdGhlIGxpc3Qgb2YgbW9kaWZpZWQgY29sbGVjdGlvbiBncm91cHMuXG4gICAgICAgICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy53cyA9IGZ1bmN0aW9uIGNyZWF0ZUJ1bmRsZUxvYWRlZEtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9idW5kbGVfbG9hZGVkX3YyXyR7ZX1gO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBXZWJTdG9yYWdlIGtleSBwcmVmaXggZm9yIHRoZSBrZXkgdGhhdCBzdG9yZXMgdGhlIGxhc3Qgc2VxdWVuY2UgbnVtYmVyIGFsbG9jYXRlZC4gVGhlIGtleVxuICAgICAgICAvLyBsb29rcyBsaWtlICdmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXzxwZXJzaXN0ZW5jZV9wcmVmaXg+Jy5cbiAgICAgICAgKHRoaXMucGVyc2lzdGVuY2VLZXkpLCBcbiAgICAgICAgLy8gUmF0aGVyIHRoYW4gYWRkaW5nIHRoZSBzdG9yYWdlIG9ic2VydmVyIGR1cmluZyBzdGFydCgpLCB3ZSBhZGQgdGhlXG4gICAgICAgIC8vIHN0b3JhZ2Ugb2JzZXJ2ZXIgZHVyaW5nIGluaXRpYWxpemF0aW9uLiBUaGlzIGVuc3VyZXMgdGhhdCB3ZSBjb2xsZWN0XG4gICAgICAgIC8vIGV2ZW50cyBiZWZvcmUgb3RoZXIgY29tcG9uZW50cyBwb3B1bGF0ZSB0aGVpciBpbml0aWFsIHN0YXRlIChkdXJpbmcgdGhlaXJcbiAgICAgICAgLy8gcmVzcGVjdGl2ZSBzdGFydCgpIGNhbGxzKS4gT3RoZXJ3aXNlLCB3ZSBtaWdodCBmb3IgZXhhbXBsZSBtaXNzIGFcbiAgICAgICAgLy8gbXV0YXRpb24gdGhhdCBpcyBhZGRlZCBhZnRlciBMb2NhbFN0b3JlJ3Mgc3RhcnQoKSBwcm9jZXNzZWQgdGhlIGV4aXN0aW5nXG4gICAgICAgIC8vIG11dGF0aW9ucyBidXQgYmVmb3JlIHdlIG9ic2VydmUgV2ViU3RvcmFnZSBldmVudHMuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzdG9yYWdlXCIsIHRoaXMuVHMpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyAndHJ1ZScgaWYgV2ViU3RvcmFnZSBpcyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuICovICAgIHN0YXRpYyB2KGUpIHtcbiAgICAgICAgcmV0dXJuICEoIWUgfHwgIWUubG9jYWxTdG9yYWdlKTtcbiAgICB9XG4gICAgYXN5bmMgc3RhcnQoKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGNsaWVudHMgdG8gYmFja2ZpbGwgdGhlIGRhdGEgaW5cbiAgICAgICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLnN5bmNFbmdpbmUuTmkoKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGlmICh0ID09PSB0aGlzLklzKSBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmdldEl0ZW0oY3JlYXRlV2ViU3RvcmFnZUNsaWVudFN0YXRlS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIHQpKTtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9SZW1vdGVDbGllbnRTdGF0ZS5jcyh0LCBlKTtcbiAgICAgICAgICAgICAgICBuICYmICh0aGlzLmRzID0gdGhpcy5kcy5pbnNlcnQobi5jbGllbnRJZCwgbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuU3MoKTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW4gZXhpc3Rpbmcgb25saW5lIHN0YXRlIGFuZCBjYWxsIHRoZSBjYWxsYmFjayBoYW5kbGVyXG4gICAgICAgIC8vIGlmIGFwcGxpY2FibGUuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnlzKTtcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmJzKHQpO1xuICAgICAgICAgICAgZSAmJiB0aGlzLkRzKGUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLkFzKSB0aGlzLkVzKGUpO1xuICAgICAgICB0aGlzLkFzID0gW10sIFxuICAgICAgICAvLyBSZWdpc3RlciBhIHdpbmRvdyB1bmxvYWQgaG9vayB0byByZW1vdmUgdGhlIGNsaWVudCBtZXRhZGF0YSBlbnRyeSBmcm9tXG4gICAgICAgIC8vIFdlYlN0b3JhZ2UgZXZlbiBpZiBgc2h1dGRvd24oKWAgd2FzIG5vdCBjYWxsZWQuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwYWdlaGlkZVwiLCAoKCkgPT4gdGhpcy5zaHV0ZG93bigpKSksIHRoaXMuc3RhcnRlZCA9ICEwO1xuICAgIH1cbiAgICB3cml0ZVNlcXVlbmNlTnVtYmVyKGUpIHtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHRoaXMuVnMsIEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgICB9XG4gICAgZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy52cyh0aGlzLmRzKTtcbiAgICB9XG4gICAgaXNBY3RpdmVRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gITE7XG4gICAgICAgIHJldHVybiB0aGlzLmRzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICByLmFjdGl2ZVRhcmdldElkcy5oYXMoZSkgJiYgKHQgPSAhMCk7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG4gICAgYWRkUGVuZGluZ011dGF0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5DcyhlLCBcInBlbmRpbmdcIik7XG4gICAgfVxuICAgIHVwZGF0ZU11dGF0aW9uU3RhdGUoZSwgdCwgbikge1xuICAgICAgICB0aGlzLkNzKGUsIHQsIG4pLCBcbiAgICAgICAgLy8gT25jZSBhIGZpbmFsIG11dGF0aW9uIHJlc3VsdCBpcyBvYnNlcnZlZCBieSBvdGhlciBjbGllbnRzLCB0aGV5IG5vIGxvbmdlclxuICAgICAgICAvLyBhY2Nlc3MgdGhlIG11dGF0aW9uJ3MgbWV0YWRhdGEgZW50cnkuIFNpbmNlIFdlYlN0b3JhZ2UgcmVwbGF5cyBldmVudHNcbiAgICAgICAgLy8gaW4gb3JkZXIsIGl0IGlzIHNhZmUgdG8gZGVsZXRlIHRoZSBlbnRyeSByaWdodCBhZnRlciB1cGRhdGluZyBpdC5cbiAgICAgICAgdGhpcy5GcyhlKTtcbiAgICB9XG4gICAgYWRkTG9jYWxRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gXCJub3QtY3VycmVudFwiO1xuICAgICAgICAvLyBMb29rdXAgYW4gZXhpc3RpbmcgcXVlcnkgc3RhdGUgaWYgdGhlIHRhcmdldCBJRCB3YXMgYWxyZWFkeSByZWdpc3RlcmVkXG4gICAgICAgIC8vIGJ5IGFub3RoZXIgdGFiXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmVRdWVyeVRhcmdldChlKSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIGUpKTtcbiAgICAgICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9RdWVyeVRhcmdldE1ldGFkYXRhLmNzKGUsIG4pO1xuICAgICAgICAgICAgICAgIHIgJiYgKHQgPSByLnN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5Ncy5ocyhlKSwgdGhpcy5TcygpLCB0O1xuICAgIH1cbiAgICByZW1vdmVMb2NhbFF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgdGhpcy5Ncy5QcyhlKSwgdGhpcy5TcygpO1xuICAgIH1cbiAgICBpc0xvY2FsUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Ncy5hY3RpdmVUYXJnZXRJZHMuaGFzKGUpO1xuICAgIH1cbiAgICBjbGVhclF1ZXJ5U3RhdGUoZSkge1xuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oY3JlYXRlV2ViU3RvcmFnZVF1ZXJ5VGFyZ2V0TWV0YWRhdGFLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgZSkpO1xuICAgIH1cbiAgICB1cGRhdGVRdWVyeVN0YXRlKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy54cyhlLCB0LCBuKTtcbiAgICB9XG4gICAgaGFuZGxlVXNlckNoYW5nZShlLCB0LCBuKSB7XG4gICAgICAgIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLkZzKGUpO1xuICAgICAgICB9KSksIHRoaXMuY3VycmVudFVzZXIgPSBlLCBuLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRQZW5kaW5nTXV0YXRpb24oZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0T25saW5lU3RhdGUoZSkge1xuICAgICAgICB0aGlzLk9zKGUpO1xuICAgIH1cbiAgICBub3RpZnlCdW5kbGVMb2FkZWQoZSkge1xuICAgICAgICB0aGlzLk5zKGUpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5zdGFydGVkICYmICh0aGlzLndpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwic3RvcmFnZVwiLCB0aGlzLlRzKSwgdGhpcy5yZW1vdmVJdGVtKHRoaXMuUnMpLCBcbiAgICAgICAgdGhpcy5zdGFydGVkID0gITEpO1xuICAgIH1cbiAgICBnZXRJdGVtKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGUpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJSRUFEXCIsIGUsIHQpLCB0O1xuICAgIH1cbiAgICBzZXRJdGVtKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJTRVRcIiwgZSwgdCksIHRoaXMuc3RvcmFnZS5zZXRJdGVtKGUsIHQpO1xuICAgIH1cbiAgICByZW1vdmVJdGVtKGUpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJSRU1PVkVcIiwgZSksIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGUpO1xuICAgIH1cbiAgICBFcyhlKSB7XG4gICAgICAgIC8vIE5vdGU6IFRoZSBmdW5jdGlvbiBpcyB0eXBlZCB0byB0YWtlIEV2ZW50IHRvIGJlIGludGVyZmFjZS1jb21wYXRpYmxlIHdpdGhcbiAgICAgICAgLy8gYFdpbmRvdy5hZGRFdmVudExpc3RlbmVyYC5cbiAgICAgICAgY29uc3QgdCA9IGU7XG4gICAgICAgIGlmICh0LnN0b3JhZ2VBcmVhID09PSB0aGlzLnN0b3JhZ2UpIHtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIkVWRU5UXCIsIHQua2V5LCB0Lm5ld1ZhbHVlKSwgdC5rZXkgPT09IHRoaXMuUnMpIHJldHVybiB2b2lkIF9fUFJJVkFURV9sb2dFcnJvcihcIlJlY2VpdmVkIFdlYlN0b3JhZ2Ugbm90aWZpY2F0aW9uIGZvciBsb2NhbCBjaGFuZ2UuIEFub3RoZXIgY2xpZW50IG1pZ2h0IGhhdmUgZ2FyYmFnZS1jb2xsZWN0ZWQgb3VyIHN0YXRlXCIpO1xuICAgICAgICAgICAgdGhpcy5paS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gdC5rZXkpIGlmICh0aGlzLmZzLnRlc3QodC5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuQnModC5rZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkxzKGUsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmtzKHQua2V5LCB0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMuTHMoZS5jbGllbnRJZCwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5ncy50ZXN0KHQua2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IHQubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5xcyh0LmtleSwgdC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiB0aGlzLlFzKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHMudGVzdCh0LmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuS3ModC5rZXksIHQubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSByZXR1cm4gdGhpcy4kcyhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmtleSA9PT0gdGhpcy55cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IHQubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5icyh0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMuRHMoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5rZXkgPT09IHRoaXMuVnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdlYlN0b3JhZ2VTZXF1ZW5jZU51bWJlcihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHQgPSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gZSkgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwibnVtYmVyXCIgPT0gdHlwZW9mIG4pLCB0ID0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiRmFpbGVkIHRvIHJlYWQgc2VxdWVuY2UgbnVtYmVyIGZyb20gV2ViU3RvcmFnZVwiLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAqIGBNZW1vcnlTaGFyZWRDbGllbnRTdGF0ZWAgaXMgYSBzaW1wbGUgaW1wbGVtZW50YXRpb24gb2YgU2hhcmVkQ2xpZW50U3RhdGUgZm9yXG4gKiBjbGllbnRzIHVzaW5nIG1lbW9yeSBwZXJzaXN0ZW5jZS4gVGhlIHN0YXRlIGluIHRoaXMgY2xhc3MgcmVtYWlucyBmdWxseVxuICogaXNvbGF0ZWQgYW5kIG5vIHN5bmNocm9uaXphdGlvbiBpcyBwZXJmb3JtZWQuXG4gKi8gKHQubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZSAhPT0gX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlICYmIHRoaXMuc2VxdWVuY2VOdW1iZXJIYW5kbGVyKGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQua2V5ID09PSB0aGlzLndzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5Vcyh0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKGUubWFwKChlID0+IHRoaXMuc3luY0VuZ2luZS5XcyhlKSkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLkFzLnB1c2godCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IE1zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kcy5nZXQodGhpcy5Jcyk7XG4gICAgfVxuICAgIFNzKCkge1xuICAgICAgICB0aGlzLnNldEl0ZW0odGhpcy5ScywgdGhpcy5Ncy5scygpKTtcbiAgICB9XG4gICAgQ3MoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9NdXRhdGlvbk1ldGFkYXRhKHRoaXMuY3VycmVudFVzZXIsIGUsIHQsIG4pLCBpID0gY3JlYXRlV2ViU3RvcmFnZU11dGF0aW9uQmF0Y2hLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgdGhpcy5jdXJyZW50VXNlciwgZSk7XG4gICAgICAgIHRoaXMuc2V0SXRlbShpLCByLmxzKCkpO1xuICAgIH1cbiAgICBGcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBjcmVhdGVXZWJTdG9yYWdlTXV0YXRpb25CYXRjaEtleSh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0aGlzLmN1cnJlbnRVc2VyLCBlKTtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtKHQpO1xuICAgIH1cbiAgICBPcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBjbGllbnRJZDogdGhpcy5JcyxcbiAgICAgICAgICAgIG9ubGluZVN0YXRlOiBlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHRoaXMueXMsIEpTT04uc3RyaW5naWZ5KHQpKTtcbiAgICB9XG4gICAgeHMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gY3JlYXRlV2ViU3RvcmFnZVF1ZXJ5VGFyZ2V0TWV0YWRhdGFLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgZSksIGkgPSBuZXcgX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEoZSwgdCwgbik7XG4gICAgICAgIHRoaXMuc2V0SXRlbShyLCBpLmxzKCkpO1xuICAgIH1cbiAgICBOcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBKU09OLnN0cmluZ2lmeShBcnJheS5mcm9tKGUpKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHRoaXMud3MsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBjbGllbnQgc3RhdGUga2V5IGluIFdlYlN0b3JhZ2UuIFJldHVybnMgbnVsbCBpZiB0aGUga2V5IGRvZXMgbm90XG4gICAgICogbWF0Y2ggdGhlIGV4cGVjdGVkIGtleSBmb3JtYXQuXG4gICAgICovICAgIEJzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZnMuZXhlYyhlKTtcbiAgICAgICAgcmV0dXJuIHQgPyB0WzFdIDogbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgY2xpZW50IHN0YXRlIGluIFdlYlN0b3JhZ2UuIFJldHVybnMgJ251bGwnIGlmIHRoZSB2YWx1ZSBjb3VsZCBub3RcbiAgICAgKiBiZSBwYXJzZWQuXG4gICAgICovICAgIGtzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuQnMoZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfUmVtb3RlQ2xpZW50U3RhdGUuY3MobiwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIG11dGF0aW9uIGJhdGNoIHN0YXRlIGluIFdlYlN0b3JhZ2UuIFJldHVybnMgJ251bGwnIGlmIHRoZSB2YWx1ZVxuICAgICAqIGNvdWxkIG5vdCBiZSBwYXJzZWQuXG4gICAgICovICAgIHFzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZ3MuZXhlYyhlKSwgciA9IE51bWJlcihuWzFdKSwgaSA9IHZvaWQgMCAhPT0gblsyXSA/IG5bMl0gOiBudWxsO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX011dGF0aW9uTWV0YWRhdGEuY3MobmV3IFVzZXIoaSksIHIsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBxdWVyeSB0YXJnZXQgc3RhdGUgZnJvbSBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBLcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnBzLmV4ZWMoZSksIHIgPSBOdW1iZXIoblsxXSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfUXVlcnlUYXJnZXRNZXRhZGF0YS5jcyhyLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGFuIG9ubGluZSBzdGF0ZSBmcm9tIFdlYlN0b3JhZ2UuIFJldHVybnMgJ251bGwnIGlmIHRoZSB2YWx1ZVxuICAgICAqIGNvdWxkIG5vdCBiZSBwYXJzZWQuXG4gICAgICovICAgIGJzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9TaGFyZWRPbmxpbmVTdGF0ZS5jcyhlKTtcbiAgICB9XG4gICAgVXMoZSkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShlKTtcbiAgICB9XG4gICAgYXN5bmMgUXMoZSkge1xuICAgICAgICBpZiAoZS51c2VyLnVpZCA9PT0gdGhpcy5jdXJyZW50VXNlci51aWQpIHJldHVybiB0aGlzLnN5bmNFbmdpbmUuR3MoZS5iYXRjaElkLCBlLnN0YXRlLCBlLmVycm9yKTtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgYElnbm9yaW5nIG11dGF0aW9uIGZvciBub24tYWN0aXZlIHVzZXIgJHtlLnVzZXIudWlkfWApO1xuICAgIH1cbiAgICAkcyhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN5bmNFbmdpbmUuenMoZS50YXJnZXRJZCwgZS5zdGF0ZSwgZS5lcnJvcik7XG4gICAgfVxuICAgIExzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQgPyB0aGlzLmRzLmluc2VydChlLCB0KSA6IHRoaXMuZHMucmVtb3ZlKGUpLCByID0gdGhpcy52cyh0aGlzLmRzKSwgaSA9IHRoaXMudnMobiksIHMgPSBbXSwgbyA9IFtdO1xuICAgICAgICByZXR1cm4gaS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHIuaGFzKGUpIHx8IHMucHVzaChlKTtcbiAgICAgICAgfSkpLCByLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgaS5oYXMoZSkgfHwgby5wdXNoKGUpO1xuICAgICAgICB9KSksIHRoaXMuc3luY0VuZ2luZS5qcyhzLCBvKS50aGVuKCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRzID0gbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBEcyhlKSB7XG4gICAgICAgIC8vIFdlIGNoZWNrIHdoZXRoZXIgdGhlIGNsaWVudCB0aGF0IHdyb3RlIHRoaXMgb25saW5lIHN0YXRlIGlzIHN0aWxsIGFjdGl2ZVxuICAgICAgICAvLyBieSBjb21wYXJpbmcgaXRzIGNsaWVudCBJRCB0byB0aGUgbGlzdCBvZiBjbGllbnRzIGtlcHQgYWN0aXZlIGluXG4gICAgICAgIC8vIEluZGV4ZWREYi4gSWYgYSBjbGllbnQgZG9lcyBub3QgdXBkYXRlIHRoZWlyIEluZGV4ZWREYiBjbGllbnQgc3RhdGVcbiAgICAgICAgLy8gd2l0aGluIDUgc2Vjb25kcywgaXQgaXMgY29uc2lkZXJlZCBpbmFjdGl2ZSBhbmQgd2UgZG9uJ3QgZW1pdCBhbiBvbmxpbmVcbiAgICAgICAgLy8gc3RhdGUgZXZlbnQuXG4gICAgICAgIHRoaXMuZHMuZ2V0KGUuY2xpZW50SWQpICYmIHRoaXMub25saW5lU3RhdGVIYW5kbGVyKGUub25saW5lU3RhdGUpO1xuICAgIH1cbiAgICB2cyhlKSB7XG4gICAgICAgIGxldCB0ID0gX19QUklWQVRFX3RhcmdldElkU2V0KCk7XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICB0ID0gdC51bmlvbldpdGgobi5hY3RpdmVUYXJnZXRJZHMpO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5U2hhcmVkQ2xpZW50U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLkhzID0gbmV3IF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlLCB0aGlzLkpzID0ge30sIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gbnVsbCwgXG4gICAgICAgIHRoaXMuc2VxdWVuY2VOdW1iZXJIYW5kbGVyID0gbnVsbDtcbiAgICB9XG4gICAgYWRkUGVuZGluZ011dGF0aW9uKGUpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHVwZGF0ZU11dGF0aW9uU3RhdGUoZSwgdCwgbikge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgYWRkTG9jYWxRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkhzLmhzKGUpLCB0aGlzLkpzW2VdIHx8IFwibm90LWN1cnJlbnRcIjtcbiAgICB9XG4gICAgdXBkYXRlUXVlcnlTdGF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuSnNbZV0gPSB0O1xuICAgIH1cbiAgICByZW1vdmVMb2NhbFF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgdGhpcy5Icy5QcyhlKTtcbiAgICB9XG4gICAgaXNMb2NhbFF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSHMuYWN0aXZlVGFyZ2V0SWRzLmhhcyhlKTtcbiAgICB9XG4gICAgY2xlYXJRdWVyeVN0YXRlKGUpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuSnNbZV07XG4gICAgfVxuICAgIGdldEFsbEFjdGl2ZVF1ZXJ5VGFyZ2V0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSHMuYWN0aXZlVGFyZ2V0SWRzO1xuICAgIH1cbiAgICBpc0FjdGl2ZVF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSHMuYWN0aXZlVGFyZ2V0SWRzLmhhcyhlKTtcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkhzID0gbmV3IF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlLCBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgaGFuZGxlVXNlckNoYW5nZShlLCB0LCBuKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBzZXRPbmxpbmVTdGF0ZShlKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBzaHV0ZG93bigpIHt9XG4gICAgd3JpdGVTZXF1ZW5jZU51bWJlcihlKSB7fVxuICAgIG5vdGlmeUJ1bmRsZUxvYWRlZChlKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX05vb3BDb25uZWN0aXZpdHlNb25pdG9yIHtcbiAgICBZcyhlKSB7XG4gICAgICAgIC8vIE5vLW9wLlxuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgLy8gTm8tb3AuXG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBCcm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvci5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbi8qKlxuICogQnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBDb25uZWN0aXZpdHlNb25pdG9yLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfQnJvd3NlckNvbm5lY3Rpdml0eU1vbml0b3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlpzID0gKCkgPT4gdGhpcy5YcygpLCB0aGlzLmVvID0gKCkgPT4gdGhpcy5ubygpLCB0aGlzLnJvID0gW10sIHRoaXMuaW8oKTtcbiAgICB9XG4gICAgWXMoZSkge1xuICAgICAgICB0aGlzLnJvLnB1c2goZSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCB0aGlzLlpzKSwgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIHRoaXMuZW8pO1xuICAgIH1cbiAgICBpbygpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmxpbmVcIiwgdGhpcy5acyksIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCB0aGlzLmVvKTtcbiAgICB9XG4gICAgWHMoKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkNvbm5lY3Rpdml0eU1vbml0b3JcIiwgXCJOZXR3b3JrIGNvbm5lY3Rpdml0eSBjaGFuZ2VkOiBBVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLnJvKSBlKDAgLyogTmV0d29ya1N0YXR1cy5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICBubygpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiQ29ubmVjdGl2aXR5TW9uaXRvclwiLCBcIk5ldHdvcmsgY29ubmVjdGl2aXR5IGNoYW5nZWQ6IFVOQVZBSUxBQkxFXCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5ybykgZSgxIC8qIE5ldHdvcmtTdGF0dXMuVU5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICAvLyBUT0RPKGNoZW5icmlhbik6IENvbnNpZGVyIHBhc3NpbmcgaW4gd2luZG93IGVpdGhlciBpbnRvIHRoaXMgY29tcG9uZW50IG9yXG4gICAgLy8gaGVyZSBmb3IgdGVzdGluZyB2aWEgRmFrZVdpbmRvdy5cbiAgICAvKiogQ2hlY2tzIHRoYXQgYWxsIHVzZWQgYXR0cmlidXRlcyBvZiB3aW5kb3cgYXJlIGF2YWlsYWJsZS4gKi9cbiAgICBzdGF0aWMgdigpIHtcbiAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyAmJiB2b2lkIDAgIT09IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICYmIHZvaWQgMCAhPT0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXI7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgdmFsdWUgcmV0dXJuZWQgZnJvbSB0aGUgbW9zdCByZWNlbnQgaW52b2NhdGlvbiBvZlxuICogYGdlbmVyYXRlVW5pcXVlRGVidWdJZCgpYCwgb3IgbnVsbCBpZiBpdCBoYXMgbmV2ZXIgYmVlbiBpbnZva2VkLlxuICovIGxldCBSZSA9IG51bGw7XG5cbi8qKlxuICogR2VuZXJhdGVzIGFuZCByZXR1cm5zIGFuIGluaXRpYWwgdmFsdWUgZm9yIGBsYXN0VW5pcXVlRGVidWdJZGAuXG4gKlxuICogVGhlIHJldHVybmVkIHZhbHVlIGlzIHJhbmRvbWx5IHNlbGVjdGVkIGZyb20gYSByYW5nZSBvZiBpbnRlZ2VycyB0aGF0IGFyZVxuICogcmVwcmVzZW50ZWQgYXMgOCBoZXhhZGVjaW1hbCBkaWdpdHMuIFRoaXMgbWVhbnMgdGhhdCAod2l0aGluIHJlYXNvbikgYW55XG4gKiBudW1iZXJzIGdlbmVyYXRlZCBieSBpbmNyZW1lbnRpbmcgdGhlIHJldHVybmVkIG51bWJlciBieSAxIHdpbGwgYWxzbyBiZVxuICogcmVwcmVzZW50ZWQgYnkgOCBoZXhhZGVjaW1hbCBkaWdpdHMuIFRoaXMgbGVhZHMgdG8gYWxsIFwiSURzXCIgaGF2aW5nIHRoZSBzYW1lXG4gKiBsZW5ndGggd2hlbiBjb252ZXJ0ZWQgdG8gYSBoZXhhZGVjaW1hbCBzdHJpbmcsIG1ha2luZyByZWFkaW5nIGxvZ3MgY29udGFpbmluZ1xuICogdGhlc2UgSURzIGVhc2llciB0byBmb2xsb3cuIEFuZCBzaW5jZSB0aGUgcmV0dXJuIHZhbHVlIGlzIHJhbmRvbWx5IHNlbGVjdGVkXG4gKiBpdCB3aWxsIGhlbHAgdG8gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGxvZ3MgZnJvbSBkaWZmZXJlbnQgZXhlY3V0aW9ucy5cbiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgYW5kIHJldHVybnMgYSB1bmlxdWUgSUQgYXMgYSBoZXhhZGVjaW1hbCBzdHJpbmcuXG4gKlxuICogVGhlIHJldHVybmVkIElEIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgaW4gZGVidWcgbG9nZ2luZyBtZXNzYWdlcyB0byBoZWxwXG4gKiBjb3JyZWxhdGUgbG9nIG1lc3NhZ2VzIHRoYXQgbWF5IGJlIHNwYXRpYWxseSBzZXBhcmF0ZWQgaW4gdGhlIGxvZ3MsIGJ1dFxuICogbG9naWNhbGx5IHJlbGF0ZWQuIEZvciBleGFtcGxlLCBhIG5ldHdvcmsgY29ubmVjdGlvbiBjb3VsZCBpbmNsdWRlIHRoZSBzYW1lXG4gKiBcImRlYnVnIElEXCIgc3RyaW5nIGluIGFsbCBvZiBpdHMgbG9nIG1lc3NhZ2VzIHRvIGhlbHAgdHJhY2UgYSBzcGVjaWZpY1xuICogY29ubmVjdGlvbiBvdmVyIHRpbWUuXG4gKlxuICogQHJldHVybiB0aGUgMTAtY2hhcmFjdGVyIGdlbmVyYXRlZCBJRCAoZS5nLiBcIjB4YTFiMmMzZDRcIikuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKSB7XG4gICAgcmV0dXJuIG51bGwgPT09IFJlID8gUmUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZ2VuZXJhdGVJbml0aWFsVW5pcXVlRGVidWdJZCgpIHtcbiAgICAgICAgcmV0dXJuIDI2ODQzNTQ1NiArIE1hdGgucm91bmQoMjE0NzQ4MzY0OCAqIE1hdGgucmFuZG9tKCkpO1xuICAgIH0oKSA6IFJlKyssIFwiMHhcIiArIFJlLnRvU3RyaW5nKDE2KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgVmUgPSB7XG4gICAgQmF0Y2hHZXREb2N1bWVudHM6IFwiYmF0Y2hHZXRcIixcbiAgICBDb21taXQ6IFwiY29tbWl0XCIsXG4gICAgUnVuUXVlcnk6IFwicnVuUXVlcnlcIixcbiAgICBSdW5BZ2dyZWdhdGlvblF1ZXJ5OiBcInJ1bkFnZ3JlZ2F0aW9uUXVlcnlcIlxufTtcblxuLyoqXG4gKiBNYXBzIFJQQyBuYW1lcyB0byB0aGUgY29ycmVzcG9uZGluZyBSRVNUIGVuZHBvaW50IG5hbWUuXG4gKlxuICogV2UgdXNlIGFycmF5IG5vdGF0aW9uIHRvIGF2b2lkIG1hbmdsaW5nLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyBhIHNpbXBsZSBoZWxwZXIgY2xhc3MgdGhhdCBpbXBsZW1lbnRzIHRoZSBTdHJlYW0gaW50ZXJmYWNlIHRvXG4gKiBicmlkZ2UgdG8gb3RoZXIgaW1wbGVtZW50YXRpb25zIHRoYXQgYXJlIHN0cmVhbXMgYnV0IGRvIG5vdCBpbXBsZW1lbnQgdGhlXG4gKiBpbnRlcmZhY2UuIFRoZSBzdHJlYW0gY2FsbGJhY2tzIGFyZSBpbnZva2VkIHdpdGggdGhlIGNhbGxPbi4uLiBtZXRob2RzLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfU3RyZWFtQnJpZGdlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc28gPSBlLnNvLCB0aGlzLm9vID0gZS5vbztcbiAgICB9XG4gICAgX28oZSkge1xuICAgICAgICB0aGlzLmFvID0gZTtcbiAgICB9XG4gICAgdW8oZSkge1xuICAgICAgICB0aGlzLmNvID0gZTtcbiAgICB9XG4gICAgb25NZXNzYWdlKGUpIHtcbiAgICAgICAgdGhpcy5sbyA9IGU7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLm9vKCk7XG4gICAgfVxuICAgIHNlbmQoZSkge1xuICAgICAgICB0aGlzLnNvKGUpO1xuICAgIH1cbiAgICBobygpIHtcbiAgICAgICAgdGhpcy5hbygpO1xuICAgIH1cbiAgICBQbyhlKSB7XG4gICAgICAgIHRoaXMuY28oZSk7XG4gICAgfVxuICAgIElvKGUpIHtcbiAgICAgICAgdGhpcy5sbyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IG1lID0gXCJXZWJDaGFubmVsQ29ubmVjdGlvblwiO1xuXG5jbGFzcyBfX1BSSVZBVEVfV2ViQ2hhbm5lbENvbm5lY3Rpb24gZXh0ZW5kcyBcbi8qKlxuICogQmFzZSBjbGFzcyBmb3IgYWxsIFJlc3QtYmFzZWQgY29ubmVjdGlvbnMgdG8gdGhlIGJhY2tlbmQgKFdlYkNoYW5uZWwgYW5kXG4gKiBIVFRQKS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1Jlc3RDb25uZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJbmZvID0gZSwgdGhpcy5kYXRhYmFzZUlkID0gZS5kYXRhYmFzZUlkO1xuICAgICAgICBjb25zdCB0ID0gZS5zc2wgPyBcImh0dHBzXCIgOiBcImh0dHBcIiwgbiA9IGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkKSwgciA9IGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2UpO1xuICAgICAgICB0aGlzLlRvID0gdCArIFwiOi8vXCIgKyBlLmhvc3QsIHRoaXMuRW8gPSBgcHJvamVjdHMvJHtufS9kYXRhYmFzZXMvJHtyfWAsIHRoaXMuQW8gPSBcIihkZWZhdWx0KVwiID09PSB0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2UgPyBgcHJvamVjdF9pZD0ke259YCA6IGBwcm9qZWN0X2lkPSR7bn0mZGF0YWJhc2VfaWQ9JHtyfWA7XG4gICAgfVxuICAgIGdldCBSbygpIHtcbiAgICAgICAgLy8gQm90aCBgaW52b2tlUlBDKClgIGFuZCBgaW52b2tlU3RyZWFtaW5nUlBDKClgIHVzZSB0aGVpciBgcGF0aGAgYXJndW1lbnRzIHRvIGRldGVybWluZVxuICAgICAgICAvLyB3aGVyZSB0byBydW4gdGhlIHF1ZXJ5LCBhbmQgZXhwZWN0IHRoZSBgcmVxdWVzdGAgdG8gTk9UIHNwZWNpZnkgdGhlIFwicGF0aFwiLlxuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIFZvKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKSwgbyA9IHRoaXMubW8oZSwgdCk7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlJlc3RDb25uZWN0aW9uXCIsIGBTZW5kaW5nIFJQQyAnJHtlfScgJHtzfTpgLCBvLCBuKTtcbiAgICAgICAgY29uc3QgXyA9IHtcbiAgICAgICAgICAgIFwiZ29vZ2xlLWNsb3VkLXJlc291cmNlLXByZWZpeFwiOiB0aGlzLkVvLFxuICAgICAgICAgICAgXCJ4LWdvb2ctcmVxdWVzdC1wYXJhbXNcIjogdGhpcy5Bb1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5mbyhfLCByLCBpKSwgdGhpcy5wbyhlLCBvLCBfLCBuKS50aGVuKCh0ID0+IChfX1BSSVZBVEVfbG9nRGVidWcoXCJSZXN0Q29ubmVjdGlvblwiLCBgUmVjZWl2ZWQgUlBDICcke2V9JyAke3N9OiBgLCB0KSwgXG4gICAgICAgIHQpKSwgKHQgPT4ge1xuICAgICAgICAgICAgdGhyb3cgX19QUklWQVRFX2xvZ1dhcm4oXCJSZXN0Q29ubmVjdGlvblwiLCBgUlBDICcke2V9JyAke3N9IGZhaWxlZCB3aXRoIGVycm9yOiBgLCB0LCBcInVybDogXCIsIG8sIFwicmVxdWVzdDpcIiwgbiksIFxuICAgICAgICAgICAgdDtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB5byhlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgICAgIC8vIFRoZSBSRVNUIEFQSSBhdXRvbWF0aWNhbGx5IGFnZ3JlZ2F0ZXMgYWxsIG9mIHRoZSBzdHJlYW1lZCByZXN1bHRzLCBzbyB3ZVxuICAgICAgICAvLyBjYW4ganVzdCB1c2UgdGhlIG5vcm1hbCBpbnZva2UoKSBtZXRob2QuXG4gICAgICAgIHJldHVybiB0aGlzLlZvKGUsIHQsIG4sIHIsIGkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNb2RpZmllcyB0aGUgaGVhZGVycyBmb3IgYSByZXF1ZXN0LCBhZGRpbmcgYW55IGF1dGhvcml6YXRpb24gdG9rZW4gaWZcbiAgICAgKiBwcmVzZW50IGFuZCBhbnkgYWRkaXRpb25hbCBoZWFkZXJzIGZvciB0aGUgcmVxdWVzdC5cbiAgICAgKi8gICAgZm8oZSwgdCwgbikge1xuICAgICAgICBlW1wiWC1Hb29nLUFwaS1DbGllbnRcIl0gPSBcbiAgICAgICAgLy8gU0RLX1ZFUlNJT04gaXMgdXBkYXRlZCB0byBkaWZmZXJlbnQgdmFsdWUgYXQgcnVudGltZSBkZXBlbmRpbmcgb24gdGhlIGVudHJ5IHBvaW50LFxuICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGdldCBpdHMgdmFsdWUgd2hlbiB3ZSBuZWVkIGl0IGluIGEgZnVuY3Rpb24uXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRHb29nQXBpQ2xpZW50VmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJnbC1qcy8gZmlyZS9cIiArIGI7XG4gICAgICAgIH0oKSwgXG4gICAgICAgIC8vIENvbnRlbnQtVHlwZTogdGV4dC9wbGFpbiB3aWxsIGF2b2lkIHByZWZsaWdodCByZXF1ZXN0cyB3aGljaCBtaWdodFxuICAgICAgICAvLyBtZXNzIHdpdGggQ09SUyBhbmQgcmVkaXJlY3RzIGJ5IHByb3hpZXMuIElmIHdlIGFkZCBjdXN0b20gaGVhZGVyc1xuICAgICAgICAvLyB3ZSB3aWxsIG5lZWQgdG8gY2hhbmdlIHRoaXMgY29kZSB0byBwb3RlbnRpYWxseSB1c2UgdGhlICRodHRwT3ZlcndyaXRlXG4gICAgICAgIC8vIHBhcmFtZXRlciBzdXBwb3J0ZWQgYnkgRVNGIHRvIGF2b2lkIHRyaWdnZXJpbmcgcHJlZmxpZ2h0IHJlcXVlc3RzLlxuICAgICAgICBlW1wiQ29udGVudC1UeXBlXCJdID0gXCJ0ZXh0L3BsYWluXCIsIHRoaXMuZGF0YWJhc2VJbmZvLmFwcElkICYmIChlW1wiWC1GaXJlYmFzZS1HTVBJRFwiXSA9IHRoaXMuZGF0YWJhc2VJbmZvLmFwcElkKSwgXG4gICAgICAgIHQgJiYgdC5oZWFkZXJzLmZvckVhY2goKCh0LCBuKSA9PiBlW25dID0gdCkpLCBuICYmIG4uaGVhZGVycy5mb3JFYWNoKCgodCwgbikgPT4gZVtuXSA9IHQpKTtcbiAgICB9XG4gICAgbW8oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gVmVbZV07XG4gICAgICAgIHJldHVybiBgJHt0aGlzLlRvfS92MS8ke3R9OiR7bn1gO1xuICAgIH1cbn0ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoZSksIHRoaXMuZm9yY2VMb25nUG9sbGluZyA9IGUuZm9yY2VMb25nUG9sbGluZywgdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSBlLmF1dG9EZXRlY3RMb25nUG9sbGluZywgXG4gICAgICAgIHRoaXMudXNlRmV0Y2hTdHJlYW1zID0gZS51c2VGZXRjaFN0cmVhbXMsIHRoaXMubG9uZ1BvbGxpbmdPcHRpb25zID0gZS5sb25nUG9sbGluZ09wdGlvbnM7XG4gICAgfVxuICAgIHBvKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgocywgbykgPT4ge1xuICAgICAgICAgICAgY29uc3QgXyA9IG5ldyBYaHJJbztcbiAgICAgICAgICAgIF8uc2V0V2l0aENyZWRlbnRpYWxzKCEwKSwgXy5saXN0ZW5PbmNlKEV2ZW50VHlwZS5DT01QTEVURSwgKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF8uZ2V0TGFzdEVycm9yQ29kZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBFcnJvckNvZGUuTk9fRVJST1I6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gXy5nZXRSZXNwb25zZUpzb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhtZSwgYFhIUiBmb3IgUlBDICcke2V9JyAke2l9IHJlY2VpdmVkOmAsIEpTT04uc3RyaW5naWZ5KHQpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBzKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5USU1FT1VUOlxuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyAke2l9IHRpbWVkIG91dGApLCBvKG5ldyBGaXJlc3RvcmVFcnJvcih2LkRFQURMSU5FX0VYQ0VFREVELCBcIlJlcXVlc3QgdGltZSBvdXRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5IVFRQX0VSUk9SOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF8uZ2V0U3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyAke2l9IGZhaWxlZCB3aXRoIHN0YXR1czpgLCBuLCBcInJlc3BvbnNlIHRleHQ6XCIsIF8uZ2V0UmVzcG9uc2VUZXh0KCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG4gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGUgPSBfLmdldFJlc3BvbnNlSnNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoZSkgJiYgKGUgPSBlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiB0LnN0YXR1cyAmJiB0Lm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9tYXBDb2RlRnJvbUh0dHBSZXNwb25zZUVycm9yU3RhdHVzKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCBcIi1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh2KS5pbmRleE9mKHQpID49IDAgPyB0IDogdi5VTktOT1dOO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KHQuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyhuZXcgRmlyZXN0b3JlRXJyb3IoZSwgdC5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIG8obmV3IEZpcmVzdG9yZUVycm9yKHYuVU5LTk9XTiwgXCJTZXJ2ZXIgcmVzcG9uZGVkIHdpdGggc3RhdHVzIFwiICsgXy5nZXRTdGF0dXMoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgcmVjZWl2ZWQgYW4gSFRUUF9FUlJPUiBidXQgdGhlcmUncyBubyBzdGF0dXMgY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0J3MgbW9zdCBwcm9iYWJseSBhIGNvbm5lY3Rpb24gaXNzdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIG8obmV3IEZpcmVzdG9yZUVycm9yKHYuVU5BVkFJTEFCTEUsIFwiQ29ubmVjdGlvbiBmYWlsZWQuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhtZSwgYFJQQyAnJHtlfScgJHtpfSBjb21wbGV0ZWQuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgYSA9IEpTT04uc3RyaW5naWZ5KHIpO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyAke2l9IHNlbmRpbmcgcmVxdWVzdDpgLCByKSwgXy5zZW5kKHQsIFwiUE9TVFwiLCBhLCBuLCAxNSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgd28oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2dlbmVyYXRlVW5pcXVlRGVidWdJZCgpLCBpID0gWyB0aGlzLlRvLCBcIi9cIiwgXCJnb29nbGUuZmlyZXN0b3JlLnYxLkZpcmVzdG9yZVwiLCBcIi9cIiwgZSwgXCIvY2hhbm5lbFwiIF0sIHMgPSBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0KCksIG8gPSBnZXRTdGF0RXZlbnRUYXJnZXQoKSwgXyA9IHtcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBiYWNrZW5kIHN0aWNraW5lc3MsIHJvdXRpbmcgYmVoYXZpb3IgaXMgYmFzZWQgb24gdGhpc1xuICAgICAgICAgICAgLy8gcGFyYW1ldGVyLlxuICAgICAgICAgICAgaHR0cFNlc3Npb25JZFBhcmFtOiBcImdzZXNzaW9uaWRcIixcbiAgICAgICAgICAgIGluaXRNZXNzYWdlSGVhZGVyczoge30sXG4gICAgICAgICAgICBtZXNzYWdlVXJsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBwYXJhbSBpcyB1c2VkIHRvIGltcHJvdmUgcm91dGluZyBhbmQgcHJvamVjdCBpc29sYXRpb24gYnkgdGhlXG4gICAgICAgICAgICAgICAgLy8gYmFja2VuZCBhbmQgbXVzdCBiZSBpbmNsdWRlZCBpbiBldmVyeSByZXF1ZXN0LlxuICAgICAgICAgICAgICAgIGRhdGFiYXNlOiBgcHJvamVjdHMvJHt0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkfS9kYXRhYmFzZXMvJHt0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2V9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRSYXdKc29uOiAhMCxcbiAgICAgICAgICAgIHN1cHBvcnRzQ3Jvc3NEb21haW5YaHI6ICEwLFxuICAgICAgICAgICAgaW50ZXJuYWxDaGFubmVsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgdGltZW91dCAocmFuZG9taXplZCBiZXR3ZWVuIDEwLTIwIHNlY29uZHMpIHNpbmNlXG4gICAgICAgICAgICAgICAgLy8gYSBsYXJnZSB3cml0ZSBiYXRjaCBvbiBhIHNsb3cgaW50ZXJuZXQgY29ubmVjdGlvbiBtYXkgdGFrZSBhIGxvbmdcbiAgICAgICAgICAgICAgICAvLyB0aW1lIHRvIHNlbmQgdG8gdGhlIGJhY2tlbmQuIFJhdGhlciB0aGFuIGhhdmUgV2ViQ2hhbm5lbCBpbXBvc2UgYVxuICAgICAgICAgICAgICAgIC8vIHRpZ2h0IHRpbWVvdXQgd2hpY2ggY291bGQgbGVhZCB0byBpbmZpbml0ZSB0aW1lb3V0cyBhbmQgcmV0cmllcywgd2VcbiAgICAgICAgICAgICAgICAvLyBzZXQgaXQgdmVyeSBsYXJnZSAoNS0xMCBtaW51dGVzKSBhbmQgcmVseSBvbiB0aGUgYnJvd3NlcidzIGJ1aWx0aW5cbiAgICAgICAgICAgICAgICAvLyB0aW1lb3V0cyB0byBraWNrIGluIGlmIHRoZSByZXF1ZXN0IGlzbid0IHdvcmtpbmcuXG4gICAgICAgICAgICAgICAgZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zOiA2ZTVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JjZUxvbmdQb2xsaW5nOiB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcsXG4gICAgICAgICAgICBkZXRlY3RCdWZmZXJpbmdQcm94eTogdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmdcbiAgICAgICAgfSwgYSA9IHRoaXMubG9uZ1BvbGxpbmdPcHRpb25zLnRpbWVvdXRTZWNvbmRzO1xuICAgICAgICB2b2lkIDAgIT09IGEgJiYgKF8ubG9uZ1BvbGxpbmdUaW1lb3V0ID0gTWF0aC5yb3VuZCgxZTMgKiBhKSksIHRoaXMudXNlRmV0Y2hTdHJlYW1zICYmIChfLnhtbEh0dHBGYWN0b3J5ID0gbmV3IEZldGNoWG1sSHR0cEZhY3Rvcnkoe30pKSwgXG4gICAgICAgIHRoaXMuZm8oXy5pbml0TWVzc2FnZUhlYWRlcnMsIHQsIG4pLCBcbiAgICAgICAgLy8gU2VuZGluZyB0aGUgY3VzdG9tIGhlYWRlcnMgd2UganVzdCBhZGRlZCB0byByZXF1ZXN0LmluaXRNZXNzYWdlSGVhZGVyc1xuICAgICAgICAvLyAoQXV0aG9yaXphdGlvbiwgZXRjLikgd2lsbCB0cmlnZ2VyIHRoZSBicm93c2VyIHRvIG1ha2UgYSBDT1JTIHByZWZsaWdodFxuICAgICAgICAvLyByZXF1ZXN0IGJlY2F1c2UgdGhlIFhIUiB3aWxsIG5vIGxvbmdlciBtZWV0IHRoZSBjcml0ZXJpYSBmb3IgYSBcInNpbXBsZVwiXG4gICAgICAgIC8vIENPUlMgcmVxdWVzdDpcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9DT1JTI1NpbXBsZV9yZXF1ZXN0c1xuICAgICAgICAvLyBUaGVyZWZvcmUgdG8gYXZvaWQgdGhlIENPUlMgcHJlZmxpZ2h0IHJlcXVlc3QgKGFuIGV4dHJhIG5ldHdvcmtcbiAgICAgICAgLy8gcm91bmR0cmlwKSwgd2UgdXNlIHRoZSBlbmNvZGVJbml0TWVzc2FnZUhlYWRlcnMgb3B0aW9uIHRvIHNwZWNpZnkgdGhhdFxuICAgICAgICAvLyB0aGUgaGVhZGVycyBzaG91bGQgaW5zdGVhZCBiZSBlbmNvZGVkIGluIHRoZSByZXF1ZXN0J3MgUE9TVCBwYXlsb2FkLFxuICAgICAgICAvLyB3aGljaCBpcyByZWNvZ25pemVkIGJ5IHRoZSB3ZWJjaGFubmVsIGJhY2tlbmQuXG4gICAgICAgIF8uZW5jb2RlSW5pdE1lc3NhZ2VIZWFkZXJzID0gITA7XG4gICAgICAgIGNvbnN0IHUgPSBpLmpvaW4oXCJcIik7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhtZSwgYENyZWF0aW5nIFJQQyAnJHtlfScgc3RyZWFtICR7cn06ICR7dX1gLCBfKTtcbiAgICAgICAgY29uc3QgYyA9IHMuY3JlYXRlV2ViQ2hhbm5lbCh1LCBfKTtcbiAgICAgICAgLy8gV2ViQ2hhbm5lbCBzdXBwb3J0cyBzZW5kaW5nIHRoZSBmaXJzdCBtZXNzYWdlIHdpdGggdGhlIGhhbmRzaGFrZSAtIHNhdmluZ1xuICAgICAgICAvLyBhIG5ldHdvcmsgcm91bmQgdHJpcC4gSG93ZXZlciwgaXQgd2lsbCBoYXZlIHRvIGNhbGwgc2VuZCBpbiB0aGUgc2FtZVxuICAgICAgICAvLyBKUyBldmVudCBsb29wIGFzIG9wZW4uIEluIG9yZGVyIHRvIGVuZm9yY2UgdGhpcywgd2UgZGVsYXkgYWN0dWFsbHlcbiAgICAgICAgLy8gb3BlbmluZyB0aGUgV2ViQ2hhbm5lbCB1bnRpbCBzZW5kIGlzIGNhbGxlZC4gV2hldGhlciB3ZSBoYXZlIGNhbGxlZFxuICAgICAgICAvLyBvcGVuIGlzIHRyYWNrZWQgd2l0aCB0aGlzIHZhcmlhYmxlLlxuICAgICAgICAgICAgICAgIGxldCBsID0gITEsIGggPSAhMTtcbiAgICAgICAgLy8gQSBmbGFnIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSBzdHJlYW0gd2FzIGNsb3NlZCAoYnkgdXMgb3IgdGhyb3VnaCBhblxuICAgICAgICAvLyBlcnJvci9jbG9zZSBldmVudCkgdG8gYXZvaWQgZGVsaXZlcmluZyBtdWx0aXBsZSBjbG9zZSBldmVudHMgb3Igc2VuZGluZ1xuICAgICAgICAvLyBvbiBhIGNsb3NlZCBzdHJlYW1cbiAgICAgICAgICAgICAgICBjb25zdCBQID0gbmV3IF9fUFJJVkFURV9TdHJlYW1CcmlkZ2Uoe1xuICAgICAgICAgICAgc286IHQgPT4ge1xuICAgICAgICAgICAgICAgIGggPyBfX1BSSVZBVEVfbG9nRGVidWcobWUsIGBOb3Qgc2VuZGluZyBiZWNhdXNlIFJQQyAnJHtlfScgc3RyZWFtICR7cn0gaXMgY2xvc2VkOmAsIHQpIDogKGwgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhtZSwgYE9wZW5pbmcgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQuYCksIFxuICAgICAgICAgICAgICAgIGMub3BlbigpLCBsID0gITApLCBfX1BSSVZBVEVfbG9nRGVidWcobWUsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHNlbmRpbmc6YCwgdCksIFxuICAgICAgICAgICAgICAgIGMuc2VuZCh0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb286ICgpID0+IGMuY2xvc2UoKVxuICAgICAgICB9KSwgX19QUklWQVRFX3VuZ3VhcmRlZEV2ZW50TGlzdGVuID0gKGUsIHQsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8oZGltb25kKTogY2xvc3VyZSB0eXBpbmcgc2VlbXMgYnJva2VuIGJlY2F1c2UgV2ViQ2hhbm5lbCBkb2VzXG4gICAgICAgICAgICAvLyBub3QgaW1wbGVtZW50IGdvb2cuZXZlbnRzLkxpc3RlbmFibGVcbiAgICAgICAgICAgIGUubGlzdGVuKHQsIChlID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBuKGUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgfSksIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gQ2xvc3VyZSBldmVudHMgYXJlIGd1YXJkZWQgYW5kIGV4Y2VwdGlvbnMgYXJlIHN3YWxsb3dlZCwgc28gY2F0Y2ggYW55XG4gICAgICAgIC8vIGV4Y2VwdGlvbiBhbmQgcmV0aHJvdyB1c2luZyBhIHNldFRpbWVvdXQgc28gdGhleSBiZWNvbWUgdmlzaWJsZSBhZ2Fpbi5cbiAgICAgICAgLy8gTm90ZSB0aGF0IGV2ZW50dWFsbHkgdGhpcyBmdW5jdGlvbiBjb3VsZCBnbyBhd2F5IGlmIHdlIGFyZSBjb25maWRlbnRcbiAgICAgICAgLy8gZW5vdWdoIHRoZSBjb2RlIGlzIGV4Y2VwdGlvbiBmcmVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4oYywgV2ViQ2hhbm5lbC5FdmVudFR5cGUuT1BFTiwgKCgpID0+IHtcbiAgICAgICAgICAgIGggfHwgX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQgb3BlbmVkLmApO1xuICAgICAgICB9KSksIF9fUFJJVkFURV91bmd1YXJkZWRFdmVudExpc3RlbihjLCBXZWJDaGFubmVsLkV2ZW50VHlwZS5DTE9TRSwgKCgpID0+IHtcbiAgICAgICAgICAgIGggfHwgKGggPSAhMCwgX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQgY2xvc2VkYCksIFxuICAgICAgICAgICAgUC5QbygpKTtcbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4oYywgV2ViQ2hhbm5lbC5FdmVudFR5cGUuRVJST1IsICh0ID0+IHtcbiAgICAgICAgICAgIGggfHwgKGggPSAhMCwgX19QUklWQVRFX2xvZ1dhcm4obWUsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHRyYW5zcG9ydCBlcnJvcmVkOmAsIHQpLCBcbiAgICAgICAgICAgIFAuUG8obmV3IEZpcmVzdG9yZUVycm9yKHYuVU5BVkFJTEFCTEUsIFwiVGhlIG9wZXJhdGlvbiBjb3VsZCBub3QgYmUgY29tcGxldGVkXCIpKSk7XG4gICAgICAgIH0pKSwgX19QUklWQVRFX3VuZ3VhcmRlZEV2ZW50TGlzdGVuKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLk1FU1NBR0UsICh0ID0+IHtcbiAgICAgICAgICAgIHZhciBuO1xuICAgICAgICAgICAgaWYgKCFoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHQuZGF0YVswXTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghIWkpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oYi8zNTE0Mzg5MSk6IFRoZXJlIGlzIGEgYnVnIGluIE9uZSBQbGF0Zm9ybSB0aGF0IGNhdXNlZCBlcnJvcnNcbiAgICAgICAgICAgICAgICAvLyAoYW5kIG9ubHkgZXJyb3JzKSB0byBiZSB3cmFwcGVkIGluIGFuIGV4dHJhIGFycmF5LiBUbyBiZSBmb3J3YXJkXG4gICAgICAgICAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIHRoZSBidWcgd2UgbmVlZCB0byBjaGVjayBlaXRoZXIgY29uZGl0aW9uLiBUaGUgbGF0dGVyXG4gICAgICAgICAgICAgICAgLy8gY2FuIGJlIHJlbW92ZWQgb25jZSB0aGUgZml4IGhhcyBiZWVuIHJvbGxlZCBvdXQuXG4gICAgICAgICAgICAgICAgLy8gVXNlIGFueSBiZWNhdXNlIG1zZ0RhdGEuZXJyb3IgaXMgbm90IHR5cGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBpLCBvID0gcy5lcnJvciB8fCAobnVsbCA9PT0gKG4gPSBzWzBdKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLmVycm9yKTtcbiAgICAgICAgICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcobWUsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHJlY2VpdmVkIGVycm9yOmAsIG8pO1xuICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5zdGF0dXMgd2lsbCBiZSBhIHN0cmluZyBsaWtlICdPSycgb3IgJ05PVF9GT1VORCcuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBvLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IG4gPSBcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBhIEdSUEMgc3RhdHVzIGlkZW50aWZpZXIgbGlrZSAnTk9UX0ZPVU5EJy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBzdGF0dXMgc3RyaW5nIG9yIHVuZGVmaW5lZCBpZlxuICogICAgIHRoZXJlIGlzIG5vIG1hdGNoLlxuICovXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY1N0YXR1cyhlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29rdXAgYnkgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHVlW2VdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCkgcmV0dXJuIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY0NvZGUodCk7XG4gICAgICAgICAgICAgICAgICAgIH0odCksIGkgPSBvLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gbiAmJiAobiA9IHYuSU5URVJOQUwsIGkgPSBcIlVua25vd24gZXJyb3Igc3RhdHVzOiBcIiArIHQgKyBcIiB3aXRoIG1lc3NhZ2UgXCIgKyBvLm1lc3NhZ2UpLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBjbG9zZWQgc28gbm8gZnVydGhlciBldmVudHMgYXJlIHByb3BhZ2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgaCA9ICEwLCBQLlBvKG5ldyBGaXJlc3RvcmVFcnJvcihuLCBpKSksIGMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSByZWNlaXZlZDpgLCBpKSwgUC5JbyhpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4obywgRXZlbnQuU1RBVF9FVkVOVCwgKHQgPT4ge1xuICAgICAgICAgICAgdC5zdGF0ID09PSBTdGF0LlBST1hZID8gX19QUklWQVRFX2xvZ0RlYnVnKG1lLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSBkZXRlY3RlZCBidWZmZXJpbmcgcHJveHlgKSA6IHQuc3RhdCA9PT0gU3RhdC5OT1BST1hZICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhtZSwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gZGV0ZWN0ZWQgbm8gYnVmZmVyaW5nIHByb3h5YCk7XG4gICAgICAgIH0pKSwgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGVjaG5pY2FsbHkgd2UgY291bGQvc2hvdWxkIHdhaXQgZm9yIHRoZSBXZWJDaGFubmVsIG9wZW5lZCBldmVudCxcbiAgICAgICAgICAgIC8vIGJ1dCBiZWNhdXNlIHdlIHdhbnQgdG8gc2VuZCB0aGUgZmlyc3QgbWVzc2FnZSB3aXRoIHRoZSBXZWJDaGFubmVsXG4gICAgICAgICAgICAvLyBoYW5kc2hha2Ugd2UgcHJldGVuZCB0aGUgY2hhbm5lbCBvcGVuZWQgaGVyZSAoYXN5bmNocm9ub3VzbHkpLCBhbmRcbiAgICAgICAgICAgIC8vIHRoZW4gZGVsYXkgdGhlIGFjdHVhbCBvcGVuIHVudGlsIHRoZSBmaXJzdCBtZXNzYWdlIGlzIHNlbnQuXG4gICAgICAgICAgICBQLmhvKCk7XG4gICAgICAgIH0pLCAwKSwgUDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogSW5pdGlhbGl6ZXMgdGhlIFdlYkNoYW5uZWxDb25uZWN0aW9uIGZvciB0aGUgYnJvd3Nlci4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogVGhlIFBsYXRmb3JtJ3MgJ3dpbmRvdycgaW1wbGVtZW50YXRpb24gb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFdpbmRvdygpIHtcbiAgICAvLyBgd2luZG93YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IG51bGw7XG59XG5cbi8qKiBUaGUgUGxhdGZvcm0ncyAnZG9jdW1lbnQnIGltcGxlbWVudGF0aW9uIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZS4gKi8gZnVuY3Rpb24gZ2V0RG9jdW1lbnQoKSB7XG4gICAgLy8gYGRvY3VtZW50YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGRvY3VtZW50ID8gZG9jdW1lbnQgOiBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcihlKSB7XG4gICAgcmV0dXJuIG5ldyBKc29uUHJvdG9TZXJpYWxpemVyKGUsIC8qIHVzZVByb3RvM0pzb249ICovICEwKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBoZWxwZXIgZm9yIHJ1bm5pbmcgZGVsYXllZCB0YXNrcyBmb2xsb3dpbmcgYW4gZXhwb25lbnRpYWwgYmFja29mZiBjdXJ2ZVxuICogYmV0d2VlbiBhdHRlbXB0cy5cbiAqXG4gKiBFYWNoIGRlbGF5IGlzIG1hZGUgdXAgb2YgYSBcImJhc2VcIiBkZWxheSB3aGljaCBmb2xsb3dzIHRoZSBleHBvbmVudGlhbFxuICogYmFja29mZiBjdXJ2ZSwgYW5kIGEgKy8tIDUwJSBcImppdHRlclwiIHRoYXQgaXMgY2FsY3VsYXRlZCBhbmQgYWRkZWQgdG8gdGhlXG4gKiBiYXNlIGRlbGF5LiBUaGlzIHByZXZlbnRzIGNsaWVudHMgZnJvbSBhY2NpZGVudGFsbHkgc3luY2hyb25pemluZyB0aGVpclxuICogZGVsYXlzIGNhdXNpbmcgc3Bpa2VzIG9mIGxvYWQgdG8gdGhlIGJhY2tlbmQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBBc3luY1F1ZXVlIHRvIHJ1biBiYWNrb2ZmIG9wZXJhdGlvbnMgb24uXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIElEIHRvIHVzZSB3aGVuIHNjaGVkdWxpbmcgYmFja29mZiBvcGVyYXRpb25zIG9uIHRoZSBBc3luY1F1ZXVlLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBpbml0aWFsIGRlbGF5ICh1c2VkIGFzIHRoZSBiYXNlIGRlbGF5IG9uIHRoZSBmaXJzdCByZXRyeSBhdHRlbXB0KS5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIGxpdHRsZSBhcyAwLjUqaW5pdGlhbERlbGF5TXMuXG4gICAgICovXG4gICAgbiA9IDFlM1xuICAgIC8qKlxuICAgICAqIFRoZSBtdWx0aXBsaWVyIHRvIHVzZSB0byBkZXRlcm1pbmUgdGhlIGV4dGVuZGVkIGJhc2UgZGVsYXkgYWZ0ZXIgZWFjaFxuICAgICAqIGF0dGVtcHQuXG4gICAgICovICwgciA9IDEuNVxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIGJhc2UgZGVsYXkgYWZ0ZXIgd2hpY2ggbm8gZnVydGhlciBiYWNrb2ZmIGlzIHBlcmZvcm1lZC5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIG11Y2ggYXMgMS41Km1heERlbGF5TXMuXG4gICAgICovICwgaSA9IDZlNCkge1xuICAgICAgICB0aGlzLmlpID0gZSwgdGhpcy50aW1lcklkID0gdCwgdGhpcy5TbyA9IG4sIHRoaXMuYm8gPSByLCB0aGlzLkRvID0gaSwgdGhpcy52byA9IDAsIFxuICAgICAgICB0aGlzLkNvID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgbGFzdCBiYWNrb2ZmIGF0dGVtcHQsIGFzIGVwb2NoIG1pbGxpc2Vjb25kcy4gKi9cbiAgICAgICAgdGhpcy5GbyA9IERhdGUubm93KCksIHRoaXMucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBiYWNrb2ZmIGRlbGF5LlxuICAgICAqXG4gICAgICogVGhlIHZlcnkgbmV4dCBiYWNrb2ZmQW5kV2FpdCgpIHdpbGwgaGF2ZSBubyBkZWxheS4gSWYgaXQgaXMgY2FsbGVkIGFnYWluXG4gICAgICogKGkuZS4gZHVlIHRvIGFuIGVycm9yKSwgaW5pdGlhbERlbGF5TXMgKHBsdXMgaml0dGVyKSB3aWxsIGJlIHVzZWQsIGFuZFxuICAgICAqIHN1YnNlcXVlbnQgb25lcyB3aWxsIGluY3JlYXNlIGFjY29yZGluZyB0byB0aGUgYmFja29mZkZhY3Rvci5cbiAgICAgKi8gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMudm8gPSAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJhY2tvZmYgZGVsYXkgdG8gdGhlIG1heGltdW0gZGVsYXkgKGUuZy4gZm9yIHVzZSBhZnRlciBhXG4gICAgICogUkVTT1VSQ0VfRVhIQVVTVEVEIGVycm9yKS5cbiAgICAgKi8gICAgTW8oKSB7XG4gICAgICAgIHRoaXMudm8gPSB0aGlzLkRvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIGN1cnJlbnREZWxheU1zLCBhbmQgaW5jcmVhc2VzIHRoZVxuICAgICAqIGRlbGF5IGZvciBhbnkgc3Vic2VxdWVudCBhdHRlbXB0cy4gSWYgdGhlcmUgd2FzIGEgcGVuZGluZyBiYWNrb2ZmIG9wZXJhdGlvblxuICAgICAqIGFscmVhZHksIGl0IHdpbGwgYmUgY2FuY2VsZWQuXG4gICAgICovICAgIHhvKGUpIHtcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBwZW5kaW5nIGJhY2tvZmYgb3BlcmF0aW9uLlxuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgICAgICAvLyBGaXJzdCBzY2hlZHVsZSB1c2luZyB0aGUgY3VycmVudCBiYXNlICh3aGljaCBtYXkgYmUgMCBhbmQgc2hvdWxkIGJlXG4gICAgICAgIC8vIGhvbm9yZWQgYXMgc3VjaCkuXG4gICAgICAgIGNvbnN0IHQgPSBNYXRoLmZsb29yKHRoaXMudm8gKyB0aGlzLk9vKCkpLCBuID0gTWF0aC5tYXgoMCwgRGF0ZS5ub3coKSAtIHRoaXMuRm8pLCByID0gTWF0aC5tYXgoMCwgdCAtIG4pO1xuICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IGxhc3RBdHRlbXB0VGltZSBiZWluZyBpbiB0aGUgZnV0dXJlIGR1ZSB0byBhIGNsb2NrIGNoYW5nZS5cbiAgICAgICAgICAgICAgICByID4gMCAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJFeHBvbmVudGlhbEJhY2tvZmZcIiwgYEJhY2tpbmcgb2ZmIGZvciAke3J9IG1zIChiYXNlIGRlbGF5OiAke3RoaXMudm99IG1zLCBkZWxheSB3aXRoIGppdHRlcjogJHt0fSBtcywgbGFzdCBhdHRlbXB0OiAke259IG1zIGFnbylgKSwgXG4gICAgICAgIHRoaXMuQ28gPSB0aGlzLmlpLmVucXVldWVBZnRlckRlbGF5KHRoaXMudGltZXJJZCwgciwgKCgpID0+ICh0aGlzLkZvID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIGUoKSkpKSwgXG4gICAgICAgIC8vIEFwcGx5IGJhY2tvZmYgZmFjdG9yIHRvIGRldGVybWluZSBuZXh0IGRlbGF5IGFuZCBlbnN1cmUgaXQgaXMgd2l0aGluXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgdGhpcy52byAqPSB0aGlzLmJvLCB0aGlzLnZvIDwgdGhpcy5TbyAmJiAodGhpcy52byA9IHRoaXMuU28pLCB0aGlzLnZvID4gdGhpcy5EbyAmJiAodGhpcy52byA9IHRoaXMuRG8pO1xuICAgIH1cbiAgICBObygpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5DbyAmJiAodGhpcy5Dby5za2lwRGVsYXkoKSwgdGhpcy5DbyA9IG51bGwpO1xuICAgIH1cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuQ28gJiYgKHRoaXMuQ28uY2FuY2VsKCksIHRoaXMuQ28gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByYW5kb20gdmFsdWUgaW4gdGhlIHJhbmdlIFstY3VycmVudEJhc2VNcy8yLCBjdXJyZW50QmFzZU1zLzJdICovICAgIE9vKCkge1xuICAgICAgICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiB0aGlzLnZvO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIGlzIGFuIGFic3RyYWN0IGJhc2UgY2xhc3MgdGhhdCByZXByZXNlbnRzIGEgc3RyZWFtaW5nIFJQQ1xuICogdG8gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLiBJdCdzIGJ1aWx0IG9uIHRvcCBvZiB0aGUgY29ubmVjdGlvbnMgb3duIHN1cHBvcnRcbiAqIGZvciBzdHJlYW1pbmcgUlBDcywgYW5kIGFkZHMgc2V2ZXJhbCBjcml0aWNhbCBmZWF0dXJlcyBmb3Igb3VyIGNsaWVudHM6XG4gKlxuICogICAtIEV4cG9uZW50aWFsIGJhY2tvZmYgb24gZmFpbHVyZVxuICogICAtIEF1dGhlbnRpY2F0aW9uIHZpYSBDcmVkZW50aWFsc1Byb3ZpZGVyXG4gKiAgIC0gRGlzcGF0Y2hpbmcgYWxsIGNhbGxiYWNrcyBpbnRvIHRoZSBzaGFyZWQgd29ya2VyIHF1ZXVlXG4gKiAgIC0gQ2xvc2luZyBpZGxlIHN0cmVhbXMgYWZ0ZXIgNjAgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XG4gKlxuICogU3ViY2xhc3NlcyBvZiBQZXJzaXN0ZW50U3RyZWFtIGltcGxlbWVudCBzZXJpYWxpemF0aW9uIG9mIG1vZGVscyB0byBhbmRcbiAqIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIHByb3RvY29sIGJ1ZmZlcnMgZm9yIGEgc3BlY2lmaWNcbiAqIHN0cmVhbWluZyBSUEMuXG4gKlxuICogIyMgU3RhcnRpbmcgYW5kIFN0b3BwaW5nXG4gKlxuICogU3RyZWFtaW5nIFJQQ3MgYXJlIHN0YXRlZnVsIGFuZCBuZWVkIHRvIGJlIHN0YXJ0KCllZCBiZWZvcmUgbWVzc2FnZXMgY2FuXG4gKiBiZSBzZW50IGFuZCByZWNlaXZlZC4gVGhlIFBlcnNpc3RlbnRTdHJlYW0gd2lsbCBjYWxsIHRoZSBvbk9wZW4oKSBmdW5jdGlvblxuICogb2YgdGhlIGxpc3RlbmVyIG9uY2UgdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgcmVxdWVzdHMuXG4gKlxuICogU2hvdWxkIGEgc3RhcnQoKSBmYWlsLCBQZXJzaXN0ZW50U3RyZWFtIHdpbGwgY2FsbCB0aGUgcmVnaXN0ZXJlZCBvbkNsb3NlKClcbiAqIGxpc3RlbmVyIHdpdGggYSBGaXJlc3RvcmVFcnJvciBpbmRpY2F0aW5nIHdoYXQgd2VudCB3cm9uZy5cbiAqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gY2FuIGJlIHN0YXJ0ZWQgYW5kIHN0b3BwZWQgcmVwZWF0ZWRseS5cbiAqXG4gKiBHZW5lcmljIHR5cGVzOlxuICogIFNlbmRUeXBlOiBUaGUgdHlwZSBvZiB0aGUgb3V0Z29pbmcgbWVzc2FnZSBvZiB0aGUgdW5kZXJseWluZ1xuICogICAgY29ubmVjdGlvbiBzdHJlYW1cbiAqICBSZWNlaXZlVHlwZTogVGhlIHR5cGUgb2YgdGhlIGluY29taW5nIG1lc3NhZ2Ugb2YgdGhlIHVuZGVybHlpbmdcbiAqICAgIGNvbm5lY3Rpb24gc3RyZWFtXG4gKiAgTGlzdGVuZXJUeXBlOiBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXIgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGNhbGxiYWNrc1xuICovXG5jbGFzcyBfX1BSSVZBVEVfUGVyc2lzdGVudFN0cmVhbSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXykge1xuICAgICAgICB0aGlzLmlpID0gZSwgdGhpcy5CbyA9IG4sIHRoaXMuTG8gPSByLCB0aGlzLmNvbm5lY3Rpb24gPSBpLCB0aGlzLmF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyID0gcywgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyID0gbywgdGhpcy5saXN0ZW5lciA9IF8sIHRoaXMuc3RhdGUgPSAwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovICwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGNsb3NlIGNvdW50IHRoYXQncyBpbmNyZW1lbnRlZCBldmVyeSB0aW1lIHRoZSBzdHJlYW0gaXMgY2xvc2VkOyB1c2VkIGJ5XG4gICAgICAgICAqIGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIoKSB0byBpbnZhbGlkYXRlIGNhbGxiYWNrcyB0aGF0IGhhcHBlbiBhZnRlclxuICAgICAgICAgKiBjbG9zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMua28gPSAwLCB0aGlzLnFvID0gbnVsbCwgdGhpcy5RbyA9IG51bGwsIHRoaXMuc3RyZWFtID0gbnVsbCwgdGhpcy5LbyA9IG5ldyBfX1BSSVZBVEVfRXhwb25lbnRpYWxCYWNrb2ZmKGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgc3RhcnQoKSBoYXMgYmVlbiBjYWxsZWQgYW5kIG5vIGVycm9yIGhhcyBvY2N1cnJlZC4gVHJ1ZVxuICAgICAqIGluZGljYXRlcyB0aGUgc3RyZWFtIGlzIG9wZW4gb3IgaW4gdGhlIHByb2Nlc3Mgb2Ygb3BlbmluZyAod2hpY2hcbiAgICAgKiBlbmNvbXBhc3NlcyByZXNwZWN0aW5nIGJhY2tvZmYsIGdldHRpbmcgYXV0aCB0b2tlbnMsIGFuZCBzdGFydGluZyB0aGVcbiAgICAgKiBhY3R1YWwgUlBDKS4gVXNlIGlzT3BlbigpIHRvIGRldGVybWluZSBpZiB0aGUgc3RyZWFtIGlzIG9wZW4gYW5kIHJlYWR5IGZvclxuICAgICAqIG91dGJvdW5kIHJlcXVlc3RzLlxuICAgICAqLyAgICAkbygpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLlN0YXJ0aW5nICovID09PSB0aGlzLnN0YXRlIHx8IDUgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkJhY2tvZmYgKi8gPT09IHRoaXMuc3RhdGUgfHwgdGhpcy5VbygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVuZGVybHlpbmcgUlBDIGlzIG9wZW4gKHRoZSBvbk9wZW4oKSBsaXN0ZW5lciBoYXMgYmVlblxuICAgICAqIGNhbGxlZCkgYW5kIHRoZSBzdHJlYW0gaXMgcmVhZHkgZm9yIG91dGJvdW5kIHJlcXVlc3RzLlxuICAgICAqLyAgICBVbygpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLk9wZW4gKi8gPT09IHRoaXMuc3RhdGUgfHwgMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyA9PT0gdGhpcy5zdGF0ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhcnRzIHRoZSBSUEMuIE9ubHkgYWxsb3dlZCBpZiBpc1N0YXJ0ZWQoKSByZXR1cm5zIGZhbHNlLiBUaGUgc3RyZWFtIGlzXG4gICAgICogbm90IGltbWVkaWF0ZWx5IHJlYWR5IGZvciB1c2U6IG9uT3BlbigpIHdpbGwgYmUgaW52b2tlZCB3aGVuIHRoZSBSUEMgaXNcbiAgICAgKiByZWFkeSBmb3Igb3V0Ym91bmQgcmVxdWVzdHMsIGF0IHdoaWNoIHBvaW50IGlzT3BlbigpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICpcbiAgICAgKiBXaGVuIHN0YXJ0IHJldHVybnMsIGlzU3RhcnRlZCgpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICovICAgIHN0YXJ0KCkge1xuICAgICAgICA0IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5FcnJvciAqLyAhPT0gdGhpcy5zdGF0ZSA/IHRoaXMuYXV0aCgpIDogdGhpcy5XbygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdG9wcyB0aGUgUlBDLiBUaGlzIGNhbGwgaXMgaWRlbXBvdGVudCBhbmQgYWxsb3dlZCByZWdhcmRsZXNzIG9mIHRoZVxuICAgICAqIGN1cnJlbnQgaXNTdGFydGVkKCkgc3RhdGUuXG4gICAgICpcbiAgICAgKiBXaGVuIHN0b3AgcmV0dXJucywgaXNTdGFydGVkKCkgYW5kIGlzT3BlbigpIHdpbGwgYm90aCByZXR1cm4gZmFsc2UuXG4gICAgICovICAgIGFzeW5jIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuJG8oKSAmJiBhd2FpdCB0aGlzLmNsb3NlKDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZnRlciBhbiBlcnJvciB0aGUgc3RyZWFtIHdpbGwgdXN1YWxseSBiYWNrIG9mZiBvbiB0aGUgbmV4dCBhdHRlbXB0IHRvXG4gICAgICogc3RhcnQgaXQuIElmIHRoZSBlcnJvciB3YXJyYW50cyBhbiBpbW1lZGlhdGUgcmVzdGFydCBvZiB0aGUgc3RyZWFtLCB0aGVcbiAgICAgKiBzZW5kZXIgY2FuIHVzZSB0aGlzIHRvIGluZGljYXRlIHRoYXQgdGhlIHJlY2VpdmVyIHNob3VsZCBub3QgYmFjayBvZmYuXG4gICAgICpcbiAgICAgKiBFYWNoIGVycm9yIHdpbGwgY2FsbCB0aGUgb25DbG9zZSgpIGxpc3RlbmVyLiBUaGF0IGZ1bmN0aW9uIGNhbiBkZWNpZGUgdG9cbiAgICAgKiBpbmhpYml0IGJhY2tvZmYgaWYgcmVxdWlyZWQuXG4gICAgICovICAgIEdvKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gMCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSW5pdGlhbCAqLyAsIHRoaXMuS28ucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFya3MgdGhpcyBzdHJlYW0gYXMgaWRsZS4gSWYgbm8gZnVydGhlciBhY3Rpb25zIGFyZSBwZXJmb3JtZWQgb24gdGhlXG4gICAgICogc3RyZWFtIGZvciBvbmUgbWludXRlLCB0aGUgc3RyZWFtIHdpbGwgYXV0b21hdGljYWxseSBjbG9zZSBpdHNlbGYgYW5kXG4gICAgICogbm90aWZ5IHRoZSBzdHJlYW0ncyBvbkNsb3NlKCkgaGFuZGxlciB3aXRoIFN0YXR1cy5PSy4gVGhlIHN0cmVhbSB3aWxsIHRoZW5cbiAgICAgKiBiZSBpbiBhICFpc1N0YXJ0ZWQoKSBzdGF0ZSwgcmVxdWlyaW5nIHRoZSBjYWxsZXIgdG8gc3RhcnQgdGhlIHN0cmVhbSBhZ2FpblxuICAgICAqIGJlZm9yZSBmdXJ0aGVyIHVzZS5cbiAgICAgKlxuICAgICAqIE9ubHkgc3RyZWFtcyB0aGF0IGFyZSBpbiBzdGF0ZSAnT3BlbicgY2FuIGJlIG1hcmtlZCBpZGxlLCBhcyBhbGwgb3RoZXJcbiAgICAgKiBzdGF0ZXMgaW1wbHkgcGVuZGluZyBuZXR3b3JrIG9wZXJhdGlvbnMuXG4gICAgICovICAgIHpvKCkge1xuICAgICAgICAvLyBTdGFydHMgdGhlIGlkbGUgdGltZSBpZiB3ZSBhcmUgaW4gc3RhdGUgJ09wZW4nIGFuZCBhcmUgbm90IHlldCBhbHJlYWR5XG4gICAgICAgIC8vIHJ1bm5pbmcgYSB0aW1lciAoaW4gd2hpY2ggY2FzZSB0aGUgcHJldmlvdXMgaWRsZSB0aW1lb3V0IHN0aWxsIGFwcGxpZXMpLlxuICAgICAgICB0aGlzLlVvKCkgJiYgbnVsbCA9PT0gdGhpcy5xbyAmJiAodGhpcy5xbyA9IHRoaXMuaWkuZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy5CbywgNmU0LCAoKCkgPT4gdGhpcy5qbygpKSkpO1xuICAgIH1cbiAgICAvKiogU2VuZHMgYSBtZXNzYWdlIHRvIHRoZSB1bmRlcmx5aW5nIHN0cmVhbS4gKi8gICAgSG8oZSkge1xuICAgICAgICB0aGlzLkpvKCksIHRoaXMuc3RyZWFtLnNlbmQoZSk7XG4gICAgfVxuICAgIC8qKiBDYWxsZWQgYnkgdGhlIGlkbGUgdGltZXIgd2hlbiB0aGUgc3RyZWFtIHNob3VsZCBjbG9zZSBkdWUgdG8gaW5hY3Rpdml0eS4gKi8gICAgYXN5bmMgam8oKSB7XG4gICAgICAgIGlmICh0aGlzLlVvKCkpIFxuICAgICAgICAvLyBXaGVuIHRpbWluZyBvdXQgYW4gaWRsZSBzdHJlYW0gdGhlcmUncyBubyByZWFzb24gdG8gZm9yY2UgdGhlIHN0cmVhbSBpbnRvIGJhY2tvZmYgd2hlblxuICAgICAgICAvLyBpdCByZXN0YXJ0cyBzbyBzZXQgdGhlIHN0cmVhbSBzdGF0ZSB0byBJbml0aWFsIGluc3RlYWQgb2YgRXJyb3IuXG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlKDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8pO1xuICAgIH1cbiAgICAvKiogTWFya3MgdGhlIHN0cmVhbSBhcyBhY3RpdmUgYWdhaW4uICovICAgIEpvKCkge1xuICAgICAgICB0aGlzLnFvICYmICh0aGlzLnFvLmNhbmNlbCgpLCB0aGlzLnFvID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKiBDYW5jZWxzIHRoZSBoZWFsdGggY2hlY2sgZGVsYXllZCBvcGVyYXRpb24uICovICAgIFlvKCkge1xuICAgICAgICB0aGlzLlFvICYmICh0aGlzLlFvLmNhbmNlbCgpLCB0aGlzLlFvID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsb3NlcyB0aGUgc3RyZWFtIGFuZCBjbGVhbnMgdXAgYXMgbmVjZXNzYXJ5OlxuICAgICAqXG4gICAgICogKiBjbG9zZXMgdGhlIHVuZGVybHlpbmcgR1JQQyBzdHJlYW07XG4gICAgICogKiBjYWxscyB0aGUgb25DbG9zZSBoYW5kbGVyIHdpdGggdGhlIGdpdmVuICdlcnJvcic7XG4gICAgICogKiBzZXRzIGludGVybmFsIHN0cmVhbSBzdGF0ZSB0byAnZmluYWxTdGF0ZSc7XG4gICAgICogKiBhZGp1c3RzIHRoZSBiYWNrb2ZmIHRpbWVyIGJhc2VkIG9uIHRoZSBlcnJvclxuICAgICAqXG4gICAgICogQSBuZXcgc3RyZWFtIGNhbiBiZSBvcGVuZWQgYnkgY2FsbGluZyBzdGFydCgpLlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbmFsU3RhdGUgLSB0aGUgaW50ZW5kZWQgc3RhdGUgb2YgdGhlIHN0cmVhbSBhZnRlciBjbG9zaW5nLlxuICAgICAqIEBwYXJhbSBlcnJvciAtIHRoZSBlcnJvciB0aGUgY29ubmVjdGlvbiB3YXMgY2xvc2VkIHdpdGguXG4gICAgICovICAgIGFzeW5jIGNsb3NlKGUsIHQpIHtcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBvdXRzdGFuZGluZyB0aW1lcnMgKHRoZXkncmUgZ3VhcmFudGVlZCBub3QgdG8gZXhlY3V0ZSkuXG4gICAgICAgIHRoaXMuSm8oKSwgdGhpcy5ZbygpLCB0aGlzLktvLmNhbmNlbCgpLCBcbiAgICAgICAgLy8gSW52YWxpZGF0ZXMgYW55IHN0cmVhbS1yZWxhdGVkIGNhbGxiYWNrcyAoZS5nLiBmcm9tIGF1dGggb3IgdGhlXG4gICAgICAgIC8vIHVuZGVybHlpbmcgc3RyZWFtKSwgZ3VhcmFudGVlaW5nIHRoZXkgd29uJ3QgZXhlY3V0ZS5cbiAgICAgICAgdGhpcy5rbysrLCA0IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5FcnJvciAqLyAhPT0gZSA/IFxuICAgICAgICAvLyBJZiB0aGlzIGlzIGFuIGludGVudGlvbmFsIGNsb3NlIGVuc3VyZSB3ZSBkb24ndCBkZWxheSBvdXIgbmV4dCBjb25uZWN0aW9uIGF0dGVtcHQuXG4gICAgICAgIHRoaXMuS28ucmVzZXQoKSA6IHQgJiYgdC5jb2RlID09PSB2LlJFU09VUkNFX0VYSEFVU1RFRCA/IChcbiAgICAgICAgLy8gTG9nIHRoZSBlcnJvci4gKFByb2JhYmx5IGVpdGhlciAncXVvdGEgZXhjZWVkZWQnIG9yICdtYXggcXVldWUgbGVuZ3RoIHJlYWNoZWQnLilcbiAgICAgICAgX19QUklWQVRFX2xvZ0Vycm9yKHQudG9TdHJpbmcoKSksIF9fUFJJVkFURV9sb2dFcnJvcihcIlVzaW5nIG1heGltdW0gYmFja29mZiBkZWxheSB0byBwcmV2ZW50IG92ZXJsb2FkaW5nIHRoZSBiYWNrZW5kLlwiKSwgXG4gICAgICAgIHRoaXMuS28uTW8oKSkgOiB0ICYmIHQuY29kZSA9PT0gdi5VTkFVVEhFTlRJQ0FURUQgJiYgMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyAhPT0gdGhpcy5zdGF0ZSAmJiAoXG4gICAgICAgIC8vIFwidW5hdXRoZW50aWNhdGVkXCIgZXJyb3IgbWVhbnMgdGhlIHRva2VuIHdhcyByZWplY3RlZC4gVGhpcyBzaG91bGQgcmFyZWx5XG4gICAgICAgIC8vIGhhcHBlbiBzaW5jZSBib3RoIEF1dGggYW5kIEFwcENoZWNrIGVuc3VyZSBhIHN1ZmZpY2llbnQgVFRMIHdoZW4gd2VcbiAgICAgICAgLy8gcmVxdWVzdCBhIHRva2VuLiBJZiBhIHVzZXIgbWFudWFsbHkgcmVzZXRzIHRoZWlyIHN5c3RlbSBjbG9jayB0aGlzIGNhblxuICAgICAgICAvLyBmYWlsLCBob3dldmVyLiBJbiB0aGlzIGNhc2UsIHdlIHNob3VsZCBnZXQgYSBDb2RlLlVOQVVUSEVOVElDQVRFRCBlcnJvclxuICAgICAgICAvLyBiZWZvcmUgd2UgcmVjZWl2ZWQgdGhlIGZpcnN0IG1lc3NhZ2UgYW5kIHdlIG5lZWQgdG8gaW52YWxpZGF0ZSB0aGUgdG9rZW5cbiAgICAgICAgLy8gdG8gZW5zdXJlIHRoYXQgd2UgZmV0Y2ggYSBuZXcgdG9rZW4uXG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzUHJvdmlkZXIuaW52YWxpZGF0ZVRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyLmludmFsaWRhdGVUb2tlbigpKSwgXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBiZWNhdXNlIHdlIGFyZSBubyBsb25nZXIgaW50ZXJlc3RlZCBpbiBldmVudHMuXG4gICAgICAgIG51bGwgIT09IHRoaXMuc3RyZWFtICYmICh0aGlzLlpvKCksIHRoaXMuc3RyZWFtLmNsb3NlKCksIHRoaXMuc3RyZWFtID0gbnVsbCksIFxuICAgICAgICAvLyBUaGlzIHN0YXRlIG11c3QgYmUgYXNzaWduZWQgYmVmb3JlIGNhbGxpbmcgb25DbG9zZSgpIHRvIGFsbG93IHRoZSBjYWxsYmFjayB0b1xuICAgICAgICAvLyBpbmhpYml0IGJhY2tvZmYgb3Igb3RoZXJ3aXNlIG1hbmlwdWxhdGUgdGhlIHN0YXRlIGluIGl0cyBub24tc3RhcnRlZCBzdGF0ZS5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IGUsIFxuICAgICAgICAvLyBOb3RpZnkgdGhlIGxpc3RlbmVyIHRoYXQgdGhlIHN0cmVhbSBjbG9zZWQuXG4gICAgICAgIGF3YWl0IHRoaXMubGlzdGVuZXIudW8odCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbiBiZSBvdmVycmlkZGVuIHRvIHBlcmZvcm0gYWRkaXRpb25hbCBjbGVhbnVwIGJlZm9yZSB0aGUgc3RyZWFtIGlzIGNsb3NlZC5cbiAgICAgKiBDYWxsaW5nIHN1cGVyLnRlYXJEb3duKCkgaXMgbm90IHJlcXVpcmVkLlxuICAgICAqLyAgICBabygpIHt9XG4gICAgYXV0aCgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDEgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLlN0YXJ0aW5nICovO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5Ybyh0aGlzLmtvKSwgdCA9IHRoaXMua287XG4gICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSnVzdCB1c2UgZGlzcGF0Y2hJZk5vdENsb3NlZCwgYnV0IHNlZSBUT0RPIGJlbG93LlxuICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpIF0pLnRoZW4oKChbZSwgbl0pID0+IHtcbiAgICAgICAgICAgIC8vIFN0cmVhbSBjYW4gYmUgc3RvcHBlZCB3aGlsZSB3YWl0aW5nIGZvciBhdXRoZW50aWNhdGlvbi5cbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogV2UgcmVhbGx5IHNob3VsZCBqdXN0IHVzZSBkaXNwYXRjaElmTm90Q2xvc2VkXG4gICAgICAgICAgICAvLyBhbmQgbGV0IHRoaXMgZGlzcGF0Y2ggb250byB0aGUgcXVldWUsIGJ1dCB0aGF0IG9wZW5lZCBhIHNwZWMgdGVzdCBjYW5cbiAgICAgICAgICAgIC8vIG9mIHdvcm1zIHRoYXQgSSBkb24ndCB3YW50IHRvIGRlYWwgd2l0aCBpbiB0aGlzIFBSLlxuICAgICAgICAgICAgdGhpcy5rbyA9PT0gdCAmJiBcbiAgICAgICAgICAgIC8vIE5vcm1hbGx5IHdlJ2QgaGF2ZSB0byBzY2hlZHVsZSB0aGUgY2FsbGJhY2sgb24gdGhlIEFzeW5jUXVldWUuXG4gICAgICAgICAgICAvLyBIb3dldmVyLCB0aGUgZm9sbG93aW5nIGNhbGxzIGFyZSBzYWZlIHRvIGJlIGNhbGxlZCBvdXRzaWRlIHRoZVxuICAgICAgICAgICAgLy8gQXN5bmNRdWV1ZSBzaW5jZSB0aGV5IGRvbid0IGNoYWluIGFzeW5jaHJvbm91cyBjYWxsc1xuICAgICAgICAgICAgdGhpcy5lXyhlLCBuKTtcbiAgICAgICAgfSksICh0ID0+IHtcbiAgICAgICAgICAgIGUoKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IEZpcmVzdG9yZUVycm9yKHYuVU5LTk9XTiwgXCJGZXRjaGluZyBhdXRoIHRva2VuIGZhaWxlZDogXCIgKyB0Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRfKGUpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGVfKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuWG8odGhpcy5rbyk7XG4gICAgICAgIHRoaXMuc3RyZWFtID0gdGhpcy5uXyhlLCB0KSwgdGhpcy5zdHJlYW0uX28oKCgpID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+ICh0aGlzLnN0YXRlID0gMiAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuT3BlbiAqLyAsIHRoaXMuUW8gPSB0aGlzLmlpLmVucXVldWVBZnRlckRlbGF5KHRoaXMuTG8sIDFlNCwgKCgpID0+ICh0aGlzLlVvKCkgJiYgKHRoaXMuc3RhdGUgPSAzIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5IZWFsdGh5ICovKSwgXG4gICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKSwgdGhpcy5saXN0ZW5lci5fbygpKSkpO1xuICAgICAgICB9KSksIHRoaXMuc3RyZWFtLnVvKChlID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+IHRoaXMudF8oZSkpKTtcbiAgICAgICAgfSkpLCB0aGlzLnN0cmVhbS5vbk1lc3NhZ2UoKGUgPT4ge1xuICAgICAgICAgICAgbigoKCkgPT4gdGhpcy5vbk1lc3NhZ2UoZSkpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBXbygpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDUgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkJhY2tvZmYgKi8gLCB0aGlzLktvLnhvKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gMCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSW5pdGlhbCAqLyAsIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvLyBWaXNpYmxlIGZvciB0ZXN0c1xuICAgIHRfKGUpIHtcbiAgICAgICAgLy8gSW4gdGhlb3J5IHRoZSBzdHJlYW0gY291bGQgY2xvc2UgY2xlYW5seSwgaG93ZXZlciwgaW4gb3VyIGN1cnJlbnQgbW9kZWxcbiAgICAgICAgLy8gd2UgbmV2ZXIgZXhwZWN0IHRoaXMgdG8gaGFwcGVuIGJlY2F1c2UgaWYgd2Ugc3RvcCBhIHN0cmVhbSBvdXJzZWx2ZXMsXG4gICAgICAgIC8vIHRoaXMgY2FsbGJhY2sgd2lsbCBuZXZlciBiZSBjYWxsZWQuIFRvIHByZXZlbnQgY2FzZXMgd2hlcmUgd2UgcmV0cnlcbiAgICAgICAgLy8gd2l0aG91dCBhIGJhY2tvZmYgYWNjaWRlbnRhbGx5LCB3ZSBzZXQgdGhlIHN0cmVhbSB0byBlcnJvciBpbiBhbGwgY2FzZXMuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcoXCJQZXJzaXN0ZW50U3RyZWFtXCIsIGBjbG9zZSB3aXRoIGVycm9yOiAke2V9YCksIHRoaXMuc3RyZWFtID0gbnVsbCwgXG4gICAgICAgIHRoaXMuY2xvc2UoNCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuRXJyb3IgKi8gLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIFwiZGlzcGF0Y2hlclwiIGZ1bmN0aW9uIHRoYXQgZGlzcGF0Y2hlcyBvcGVyYXRpb25zIG9udG8gdGhlXG4gICAgICogQXN5bmNRdWV1ZSBidXQgb25seSBydW5zIHRoZW0gaWYgY2xvc2VDb3VudCByZW1haW5zIHVuY2hhbmdlZC4gVGhpcyBhbGxvd3NcbiAgICAgKiB1cyB0byB0dXJuIGF1dGggLyBzdHJlYW0gY2FsbGJhY2tzIGludG8gbm8tb3BzIGlmIHRoZSBzdHJlYW0gaXMgY2xvc2VkIC9cbiAgICAgKiByZS1vcGVuZWQsIGV0Yy5cbiAgICAgKi8gICAgWG8oZSkge1xuICAgICAgICByZXR1cm4gdCA9PiB7XG4gICAgICAgICAgICB0aGlzLmlpLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IHRoaXMua28gPT09IGUgPyB0KCkgOiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiUGVyc2lzdGVudFN0cmVhbVwiLCBcInN0cmVhbSBjYWxsYmFjayBza2lwcGVkIGJ5IGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIuXCIpLCBcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpO1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gdGhhdCBpbXBsZW1lbnRzIHRoZSBMaXN0ZW4gUlBDLlxuICpcbiAqIE9uY2UgdGhlIExpc3RlbiBzdHJlYW0gaGFzIGNhbGxlZCB0aGUgb25PcGVuKCkgbGlzdGVuZXIsIGFueSBudW1iZXIgb2ZcbiAqIGxpc3RlbigpIGFuZCB1bmxpc3RlbigpIGNhbGxzIGNhbiBiZSBtYWRlIHRvIGNvbnRyb2wgd2hhdCBjaGFuZ2VzIHdpbGwgYmVcbiAqIHNlbnQgZnJvbSB0aGUgc2VydmVyIGZvciBMaXN0ZW5SZXNwb25zZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1BlcnNpc3RlbnRMaXN0ZW5TdHJlYW0gZXh0ZW5kcyBfX1BSSVZBVEVfUGVyc2lzdGVudFN0cmVhbSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcykge1xuICAgICAgICBzdXBlcihlLCBcImxpc3Rlbl9zdHJlYW1fY29ubmVjdGlvbl9iYWNrb2ZmXCIgLyogVGltZXJJZC5MaXN0ZW5TdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwibGlzdGVuX3N0cmVhbV9pZGxlXCIgLyogVGltZXJJZC5MaXN0ZW5TdHJlYW1JZGxlICovICwgXCJoZWFsdGhfY2hlY2tfdGltZW91dFwiIC8qIFRpbWVySWQuSGVhbHRoQ2hlY2tUaW1lb3V0ICovICwgdCwgbiwgciwgcyksIFxuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBpO1xuICAgIH1cbiAgICBuXyhlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24ud28oXCJMaXN0ZW5cIiwgZSwgdCk7XG4gICAgfVxuICAgIG9uTWVzc2FnZShlKSB7XG4gICAgICAgIC8vIEEgc3VjY2Vzc2Z1bCByZXNwb25zZSBtZWFucyB0aGUgc3RyZWFtIGlzIGhlYWx0aHlcbiAgICAgICAgdGhpcy5Lby5yZXNldCgpO1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2Zyb21XYXRjaENoYW5nZSh0aGlzLnNlcmlhbGl6ZXIsIGUpLCBuID0gZnVuY3Rpb24gX19QUklWQVRFX3ZlcnNpb25Gcm9tTGlzdGVuUmVzcG9uc2UoZSkge1xuICAgICAgICAgICAgLy8gV2UgaGF2ZSBvbmx5IHJlYWNoZWQgYSBjb25zaXN0ZW50IHNuYXBzaG90IGZvciB0aGUgZW50aXJlIHN0cmVhbSBpZiB0aGVyZVxuICAgICAgICAgICAgLy8gaXMgYSByZWFkX3RpbWUgc2V0IGFuZCBpdCBhcHBsaWVzIHRvIGFsbCB0YXJnZXRzIChpLmUuIHRoZSBsaXN0IG9mXG4gICAgICAgICAgICAvLyB0YXJnZXRzIGlzIGVtcHR5KS4gVGhlIGJhY2tlbmQgaXMgZ3VhcmFudGVlZCB0byBzZW5kIHN1Y2ggcmVzcG9uc2VzLlxuICAgICAgICAgICAgaWYgKCEoXCJ0YXJnZXRDaGFuZ2VcIiBpbiBlKSkgcmV0dXJuIFNuYXBzaG90VmVyc2lvbi5taW4oKTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRhcmdldENoYW5nZTtcbiAgICAgICAgICAgIHJldHVybiB0LnRhcmdldElkcyAmJiB0LnRhcmdldElkcy5sZW5ndGggPyBTbmFwc2hvdFZlcnNpb24ubWluKCkgOiB0LnJlYWRUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQucmVhZFRpbWUpIDogU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgICAgICB9KGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci5yXyh0LCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGludGVyZXN0IGluIHRoZSByZXN1bHRzIG9mIHRoZSBnaXZlbiB0YXJnZXQuIElmIHRoZSB0YXJnZXRcbiAgICAgKiBpbmNsdWRlcyBhIHJlc3VtZVRva2VuIGl0IHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHJlcXVlc3QuIFJlc3VsdHMgdGhhdFxuICAgICAqIGFmZmVjdCB0aGUgdGFyZ2V0IHdpbGwgYmUgc3RyZWFtZWQgYmFjayBhcyBXYXRjaENoYW5nZSBtZXNzYWdlcyB0aGF0XG4gICAgICogcmVmZXJlbmNlIHRoZSB0YXJnZXRJZC5cbiAgICAgKi8gICAgaV8oZSkge1xuICAgICAgICBjb25zdCB0ID0ge307XG4gICAgICAgIHQuZGF0YWJhc2UgPSBfX1BSSVZBVEVfZ2V0RW5jb2RlZERhdGFiYXNlSWQodGhpcy5zZXJpYWxpemVyKSwgdC5hZGRUYXJnZXQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9UYXJnZXQoZSwgdCkge1xuICAgICAgICAgICAgbGV0IG47XG4gICAgICAgICAgICBjb25zdCByID0gdC50YXJnZXQ7XG4gICAgICAgICAgICBpZiAobiA9IF9fUFJJVkFURV90YXJnZXRJc0RvY3VtZW50VGFyZ2V0KHIpID8ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50czogX19QUklWQVRFX3RvRG9jdW1lbnRzVGFyZ2V0KGUsIHIpXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLCByKVxuICAgICAgICAgICAgfSwgbi50YXJnZXRJZCA9IHQudGFyZ2V0SWQsIHQucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgIG4ucmVzdW1lVG9rZW4gPSBfX1BSSVZBVEVfdG9CeXRlcyhlLCB0LnJlc3VtZVRva2VuKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3RvSW50MzJQcm90byhlLCB0LmV4cGVjdGVkQ291bnQpO1xuICAgICAgICAgICAgICAgIG51bGwgIT09IHIgJiYgKG4uZXhwZWN0ZWRDb3VudCA9IHIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0LnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8oU25hcHNob3RWZXJzaW9uLm1pbigpKSA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHd1YW5keSk6IENvbnNpZGVyIHJlbW92aW5nIGFib3ZlIGNoZWNrIGJlY2F1c2UgaXQgaXMgbW9zdCBsaWtlbHkgdHJ1ZS5cbiAgICAgICAgICAgICAgICAvLyBSaWdodCBub3csIG1hbnkgdGVzdHMgZGVwZW5kIG9uIHRoaXMgYmVoYXZpb3VyIHRob3VnaCAobGVhdmluZyBtaW4oKSBvdXRcbiAgICAgICAgICAgICAgICAvLyBvZiBzZXJpYWxpemF0aW9uKS5cbiAgICAgICAgICAgICAgICBuLnJlYWRUaW1lID0gdG9UaW1lc3RhbXAoZSwgdC5zbmFwc2hvdFZlcnNpb24udG9UaW1lc3RhbXAoKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV90b0ludDMyUHJvdG8oZSwgdC5leHBlY3RlZENvdW50KTtcbiAgICAgICAgICAgICAgICBudWxsICE9PSByICYmIChuLmV4cGVjdGVkQ291bnQgPSByKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuO1xuICAgICAgICB9KHRoaXMuc2VyaWFsaXplciwgZSk7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdG9MaXN0ZW5SZXF1ZXN0TGFiZWxzKHRoaXMuc2VyaWFsaXplciwgZSk7XG4gICAgICAgIG4gJiYgKHQubGFiZWxzID0gbiksIHRoaXMuSG8odCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVucmVnaXN0ZXJzIGludGVyZXN0IGluIHRoZSByZXN1bHRzIG9mIHRoZSB0YXJnZXQgYXNzb2NpYXRlZCB3aXRoIHRoZVxuICAgICAqIGdpdmVuIHRhcmdldElkLlxuICAgICAqLyAgICBzXyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7fTtcbiAgICAgICAgdC5kYXRhYmFzZSA9IF9fUFJJVkFURV9nZXRFbmNvZGVkRGF0YWJhc2VJZCh0aGlzLnNlcmlhbGl6ZXIpLCB0LnJlbW92ZVRhcmdldCA9IGUsIFxuICAgICAgICB0aGlzLkhvKHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIFN0cmVhbSB0aGF0IGltcGxlbWVudHMgdGhlIFdyaXRlIFJQQy5cbiAqXG4gKiBUaGUgV3JpdGUgUlBDIHJlcXVpcmVzIHRoZSBjYWxsZXIgdG8gbWFpbnRhaW4gc3BlY2lhbCBzdHJlYW1Ub2tlblxuICogc3RhdGUgaW4gYmV0d2VlbiBjYWxscywgdG8gaGVscCB0aGUgc2VydmVyIHVuZGVyc3RhbmQgd2hpY2ggcmVzcG9uc2VzIHRoZVxuICogY2xpZW50IGhhcyBwcm9jZXNzZWQgYnkgdGhlIHRpbWUgdGhlIG5leHQgcmVxdWVzdCBpcyBtYWRlLiBFdmVyeSByZXNwb25zZVxuICogd2lsbCBjb250YWluIGEgc3RyZWFtVG9rZW47IHRoaXMgdmFsdWUgbXVzdCBiZSBwYXNzZWQgdG8gdGhlIG5leHRcbiAqIHJlcXVlc3QuXG4gKlxuICogQWZ0ZXIgY2FsbGluZyBzdGFydCgpIG9uIHRoaXMgc3RyZWFtLCB0aGUgbmV4dCByZXF1ZXN0IG11c3QgYmUgYSBoYW5kc2hha2UsXG4gKiBjb250YWluaW5nIHdoYXRldmVyIHN0cmVhbVRva2VuIGlzIG9uIGhhbmQuIE9uY2UgYSByZXNwb25zZSB0byB0aGlzXG4gKiByZXF1ZXN0IGlzIHJlY2VpdmVkLCBhbGwgcGVuZGluZyBtdXRhdGlvbnMgbWF5IGJlIHN1Ym1pdHRlZC4gV2hlblxuICogc3VibWl0dGluZyBtdWx0aXBsZSBiYXRjaGVzIG9mIG11dGF0aW9ucyBhdCB0aGUgc2FtZSB0aW1lLCBpdCdzXG4gKiBva2F5IHRvIHVzZSB0aGUgc2FtZSBzdHJlYW1Ub2tlbiBmb3IgdGhlIGNhbGxzIHRvIHdyaXRlTXV0YXRpb25zLlxuICpcbiAqIFRPRE8oYi8zMzI3MTIzNSk6IFVzZSBwcm90byB0eXBlc1xuICovIGNsYXNzIF9fUFJJVkFURV9QZXJzaXN0ZW50V3JpdGVTdHJlYW0gZXh0ZW5kcyBfX1BSSVZBVEVfUGVyc2lzdGVudFN0cmVhbSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcykge1xuICAgICAgICBzdXBlcihlLCBcIndyaXRlX3N0cmVhbV9jb25uZWN0aW9uX2JhY2tvZmZcIiAvKiBUaW1lcklkLldyaXRlU3RyZWFtQ29ubmVjdGlvbkJhY2tvZmYgKi8gLCBcIndyaXRlX3N0cmVhbV9pZGxlXCIgLyogVGltZXJJZC5Xcml0ZVN0cmVhbUlkbGUgKi8gLCBcImhlYWx0aF9jaGVja190aW1lb3V0XCIgLyogVGltZXJJZC5IZWFsdGhDaGVja1RpbWVvdXQgKi8gLCB0LCBuLCByLCBzKSwgXG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGksIHRoaXMub18gPSAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgb3Igbm90IGEgaGFuZHNoYWtlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBleGNoYW5nZWQgYW5kXG4gICAgICogdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgbXV0YXRpb25zLlxuICAgICAqLyAgICBnZXQgX18oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9fO1xuICAgIH1cbiAgICAvLyBPdmVycmlkZSBvZiBQZXJzaXN0ZW50U3RyZWFtLnN0YXJ0XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMub18gPSAhMSwgdGhpcy5sYXN0U3RyZWFtVG9rZW4gPSB2b2lkIDAsIHN1cGVyLnN0YXJ0KCk7XG4gICAgfVxuICAgIFpvKCkge1xuICAgICAgICB0aGlzLm9fICYmIHRoaXMuYV8oW10pO1xuICAgIH1cbiAgICBuXyhlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24ud28oXCJXcml0ZVwiLCBlLCB0KTtcbiAgICB9XG4gICAgb25NZXNzYWdlKGUpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBBbHdheXMgY2FwdHVyZSB0aGUgbGFzdCBzdHJlYW0gdG9rZW4uXG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZS5zdHJlYW1Ub2tlbiksIHRoaXMubGFzdFN0cmVhbVRva2VuID0gZS5zdHJlYW1Ub2tlbiwgdGhpcy5vXykge1xuICAgICAgICAgICAgLy8gQSBzdWNjZXNzZnVsIGZpcnN0IHdyaXRlIHJlc3BvbnNlIG1lYW5zIHRoZSBzdHJlYW0gaXMgaGVhbHRoeSxcbiAgICAgICAgICAgIC8vIE5vdGUsIHRoYXQgd2UgY291bGQgY29uc2lkZXIgYSBzdWNjZXNzZnVsIGhhbmRzaGFrZSBoZWFsdGh5LCBob3dldmVyLFxuICAgICAgICAgICAgLy8gdGhlIHdyaXRlIGl0c2VsZiBtaWdodCBiZSBjYXVzaW5nIGFuIGVycm9yIHdlIHdhbnQgdG8gYmFjayBvZmYgZnJvbS5cbiAgICAgICAgICAgIHRoaXMuS28ucmVzZXQoKTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVdyaXRlUmVzdWx0cyhlLndyaXRlUmVzdWx0cywgZS5jb21taXRUaW1lKSwgbiA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNvbW1pdFRpbWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIudV8obiwgdCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIGZpcnN0IHJlc3BvbnNlIGlzIGFsd2F5cyB0aGUgaGFuZHNoYWtlIHJlc3BvbnNlXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydCghZS53cml0ZVJlc3VsdHMgfHwgMCA9PT0gZS53cml0ZVJlc3VsdHMubGVuZ3RoKSwgdGhpcy5vXyA9ICEwLCBcbiAgICAgICAgdGhpcy5saXN0ZW5lci5jXygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZW5kcyBhbiBpbml0aWFsIHN0cmVhbVRva2VuIHRvIHRoZSBzZXJ2ZXIsIHBlcmZvcm1pbmcgdGhlIGhhbmRzaGFrZVxuICAgICAqIHJlcXVpcmVkIHRvIG1ha2UgdGhlIFN0cmVhbWluZ1dyaXRlIFJQQyB3b3JrLiBTdWJzZXF1ZW50XG4gICAgICogY2FsbHMgc2hvdWxkIHdhaXQgdW50aWwgb25IYW5kc2hha2VDb21wbGV0ZSB3YXMgY2FsbGVkLlxuICAgICAqLyAgICBsXygpIHtcbiAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiBTdXBwb3J0IHN0cmVhbSByZXN1bXB0aW9uLiBXZSBpbnRlbnRpb25hbGx5IGRvIG5vdCBzZXQgdGhlXG4gICAgICAgIC8vIHN0cmVhbSB0b2tlbiBvbiB0aGUgaGFuZHNoYWtlLCBpZ25vcmluZyBhbnkgc3RyZWFtIHRva2VuIHdlIG1pZ2h0IGhhdmUuXG4gICAgICAgIGNvbnN0IGUgPSB7fTtcbiAgICAgICAgZS5kYXRhYmFzZSA9IF9fUFJJVkFURV9nZXRFbmNvZGVkRGF0YWJhc2VJZCh0aGlzLnNlcmlhbGl6ZXIpLCB0aGlzLkhvKGUpO1xuICAgIH1cbiAgICAvKiogU2VuZHMgYSBncm91cCBvZiBtdXRhdGlvbnMgdG8gdGhlIEZpcmVzdG9yZSBiYWNrZW5kIHRvIGFwcGx5LiAqLyAgICBhXyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBzdHJlYW1Ub2tlbjogdGhpcy5sYXN0U3RyZWFtVG9rZW4sXG4gICAgICAgICAgICB3cml0ZXM6IGUubWFwKChlID0+IHRvTXV0YXRpb24odGhpcy5zZXJpYWxpemVyLCBlKSkpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuSG8odCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEYXRhc3RvcmUgYW5kIGl0cyByZWxhdGVkIG1ldGhvZHMgYXJlIGEgd3JhcHBlciBhcm91bmQgdGhlIGV4dGVybmFsIEdvb2dsZVxuICogQ2xvdWQgRGF0YXN0b3JlIGdycGMgQVBJLCB3aGljaCBwcm92aWRlcyBhbiBpbnRlcmZhY2UgdGhhdCBpcyBtb3JlIGNvbnZlbmllbnRcbiAqIGZvciB0aGUgcmVzdCBvZiB0aGUgY2xpZW50IFNESyBhcmNoaXRlY3R1cmUgdG8gY29uc3VtZS5cbiAqL1xuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBEYXRhc3RvcmUgdGhhdCBleHBvc2VzIGFkZGl0aW9uYWwgc3RhdGUgZm9yIGludGVybmFsXG4gKiBjb25zdW1wdGlvbi5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0RhdGFzdG9yZUltcGwgZXh0ZW5kcyBjbGFzcyBEYXRhc3RvcmUge30ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5hdXRoQ3JlZGVudGlhbHMgPSBlLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMgPSB0LCB0aGlzLmNvbm5lY3Rpb24gPSBuLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gciwgdGhpcy5oXyA9ICExO1xuICAgIH1cbiAgICBQXygpIHtcbiAgICAgICAgaWYgKHRoaXMuaF8pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICAvKiogSW52b2tlcyB0aGUgcHJvdmlkZWQgUlBDIHdpdGggYXV0aCBhbmQgQXBwQ2hlY2sgdG9rZW5zLiAqLyAgICBWbyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlBfKCksIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmdldFRva2VuKCkgXSkudGhlbigoKFtyLCBpXSkgPT4gdGhpcy5jb25uZWN0aW9uLlZvKGUsIHQsIG4sIHIsIGkpKSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgdGhyb3cgXCJGaXJlYmFzZUVycm9yXCIgPT09IGUubmFtZSA/IChlLmNvZGUgPT09IHYuVU5BVVRIRU5USUNBVEVEICYmICh0aGlzLmF1dGhDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSwgXG4gICAgICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCkpLCBlKSA6IG5ldyBGaXJlc3RvcmVFcnJvcih2LlVOS05PV04sIGUudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqIEludm9rZXMgdGhlIHByb3ZpZGVkIFJQQyB3aXRoIHN0cmVhbWVkIHJlc3VsdHMgd2l0aCBhdXRoIGFuZCBBcHBDaGVjayB0b2tlbnMuICovICAgIHlvKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUF8oKSwgUHJvbWlzZS5hbGwoWyB0aGlzLmF1dGhDcmVkZW50aWFscy5nZXRUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSBdKS50aGVuKCgoW2ksIHNdKSA9PiB0aGlzLmNvbm5lY3Rpb24ueW8oZSwgdCwgbiwgaSwgcywgcikpKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aHJvdyBcIkZpcmViYXNlRXJyb3JcIiA9PT0gZS5uYW1lID8gKGUuY29kZSA9PT0gdi5VTkFVVEhFTlRJQ0FURUQgJiYgKHRoaXMuYXV0aENyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpLCBcbiAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSksIGUpIDogbmV3IEZpcmVzdG9yZUVycm9yKHYuVU5LTk9XTiwgZS50b1N0cmluZygpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHRoaXMuaF8gPSAhMDtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JleHApOiBNYWtlIHN1cmUgdGhlcmUgaXMgb25seSBvbmUgRGF0YXN0b3JlIGluc3RhbmNlIHBlclxuLy8gZmlyZXN0b3JlLWV4cCBjbGllbnQuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW52b2tlUnVuQWdncmVnYXRpb25RdWVyeVJwYyhlLCB0LCBuKSB7XG4gICAgdmFyIHI7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHtyZXF1ZXN0OiBzLCBJXzogb30gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9SdW5BZ2dyZWdhdGlvblF1ZXJ5UmVxdWVzdChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLCB0KSwgaSA9IHt9LCBzID0gW107XG4gICAgICAgIGxldCBvID0gMDtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAvLyBNYXAgYWxsIGNsaWVudC1zaWRlIGFsaWFzZXMgdG8gYSB1bmlxdWUgc2hvcnQtZm9ybVxuICAgICAgICAgICAgLy8gYWxpYXMuIFRoaXMgYXZvaWRzIGlzc3VlcyB3aXRoIGNsaWVudC1zaWRlIGFsaWFzZXMgdGhhdFxuICAgICAgICAgICAgLy8gZXhjZWVkIHRoZSAxNTAwLWJ5dGUgc3RyaW5nIHNpemUgbGltaXQuXG4gICAgICAgICAgICBjb25zdCB0ID0gXCJhZ2dyZWdhdGVfXCIgKyBvKys7XG4gICAgICAgICAgICBpW3RdID0gZS5hbGlhcywgXCJjb3VudFwiID09PSBlLkVlID8gcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBhbGlhczogdCxcbiAgICAgICAgICAgICAgICBjb3VudDoge31cbiAgICAgICAgICAgIH0pIDogXCJhdmdcIiA9PT0gZS5FZSA/IHMucHVzaCh7XG4gICAgICAgICAgICAgICAgYWxpYXM6IHQsXG4gICAgICAgICAgICAgICAgYXZnOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZFBhdGgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkgOiBcInN1bVwiID09PSBlLkVlICYmIHMucHVzaCh7XG4gICAgICAgICAgICAgICAgYWxpYXM6IHQsXG4gICAgICAgICAgICAgICAgc3VtOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZFBhdGgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKSwge1xuICAgICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgICAgIHN0cnVjdHVyZWRBZ2dyZWdhdGlvblF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0aW9uczogcyxcbiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlZFF1ZXJ5OiByLnN0cnVjdHVyZWRRdWVyeVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcGFyZW50OiByLnBhcmVudFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIElfOiBpXG4gICAgICAgIH07XG4gICAgfShpLnNlcmlhbGl6ZXIsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpLCBuKSwgXyA9IHMucGFyZW50O1xuICAgIGkuY29ubmVjdGlvbi5SbyB8fCBkZWxldGUgcy5wYXJlbnQ7XG4gICAgY29uc3QgYSA9IChhd2FpdCBpLnlvKFwiUnVuQWdncmVnYXRpb25RdWVyeVwiLCBfLCBzLCAvKmV4cGVjdGVkUmVzcG9uc2VDb3VudD0qLyAxKSkuZmlsdGVyKChlID0+ICEhZS5yZXN1bHQpKTtcbiAgICAvLyBPbWl0IFJ1bkFnZ3JlZ2F0aW9uUXVlcnlSZXNwb25zZSB0aGF0IG9ubHkgY29udGFpbiByZWFkVGltZXMuXG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KDEgPT09IGEubGVuZ3RoKTtcbiAgICAvLyBSZW1hcCB0aGUgc2hvcnQtZm9ybSBhbGlhc2VzIHRoYXQgd2VyZSBzZW50IHRvIHRoZSBzZXJ2ZXJcbiAgICAvLyB0byB0aGUgY2xpZW50LXNpZGUgYWxpYXNlcy4gVXNlcnMgd2lsbCBhY2Nlc3MgdGhlIHJlc3VsdHNcbiAgICAvLyB1c2luZyB0aGUgY2xpZW50LXNpZGUgYWxpYXMuXG4gICAgY29uc3QgdSA9IG51bGwgPT09IChyID0gYVswXS5yZXN1bHQpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuYWdncmVnYXRlRmllbGRzO1xuICAgIHJldHVybiBPYmplY3Qua2V5cyh1KS5yZWR1Y2UoKChlLCB0KSA9PiAoZVtvW3RdXSA9IHVbdF0sIGUpKSwge30pO1xufVxuXG4vKipcbiAqIEEgY29tcG9uZW50IHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvIHRyYWNrIHRoZSBPbmxpbmVTdGF0ZSAodGhhdCBpcyxcbiAqIHdoZXRoZXIgb3Igbm90IHRoZSBjbGllbnQgYXMgYSB3aG9sZSBzaG91bGQgYmUgY29uc2lkZXJlZCB0byBiZSBvbmxpbmUgb3JcbiAqIG9mZmxpbmUpLCBpbXBsZW1lbnRpbmcgdGhlIGFwcHJvcHJpYXRlIGhldXJpc3RpY3MuXG4gKlxuICogSW4gcGFydGljdWxhciwgd2hlbiB0aGUgY2xpZW50IGlzIHRyeWluZyB0byBjb25uZWN0IHRvIHRoZSBiYWNrZW5kLCB3ZVxuICogYWxsb3cgdXAgdG8gTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUyB3aXRoaW4gT05MSU5FX1NUQVRFX1RJTUVPVVRfTVMgZm9yXG4gKiBhIGNvbm5lY3Rpb24gdG8gc3VjY2VlZC4gSWYgd2UgaGF2ZSB0b28gbWFueSBmYWlsdXJlcyBvciB0aGUgdGltZW91dCBlbGFwc2VzLFxuICogdGhlbiB3ZSBzZXQgdGhlIE9ubGluZVN0YXRlIHRvIE9mZmxpbmUsIGFuZCB0aGUgY2xpZW50IHdpbGwgYmVoYXZlIGFzIGlmXG4gKiBpdCBpcyBvZmZsaW5lIChnZXQoKXMgd2lsbCByZXR1cm4gY2FjaGVkIGRhdGEsIGV0Yy4pLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfT25saW5lU3RhdGVUcmFja2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZSA9IGUsIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gdCwgXG4gICAgICAgIC8qKiBUaGUgY3VycmVudCBPbmxpbmVTdGF0ZS4gKi9cbiAgICAgICAgdGhpcy5zdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgY291bnQgb2YgY29uc2VjdXRpdmUgZmFpbHVyZXMgdG8gb3BlbiB0aGUgc3RyZWFtLiBJZiBpdCByZWFjaGVzIHRoZVxuICAgICAgICAgKiBtYXhpbXVtIGRlZmluZWQgYnkgTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUywgd2UnbGwgc2V0IHRoZSBPbmxpbmVTdGF0ZSB0b1xuICAgICAgICAgKiBPZmZsaW5lLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5UXyA9IDAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSB0aW1lciB0aGF0IGVsYXBzZXMgYWZ0ZXIgT05MSU5FX1NUQVRFX1RJTUVPVVRfTVMsIGF0IHdoaWNoIHBvaW50IHdlXG4gICAgICAgICAqIHRyYW5zaXRpb24gZnJvbSBPbmxpbmVTdGF0ZS5Vbmtub3duIHRvIE9ubGluZVN0YXRlLk9mZmxpbmUgd2l0aG91dCB3YWl0aW5nXG4gICAgICAgICAqIGZvciB0aGUgc3RyZWFtIHRvIGFjdHVhbGx5IGZhaWwgKE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMgdGltZXMpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5FXyA9IG51bGwsIFxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgY2xpZW50IHNob3VsZCBsb2cgYSB3YXJuaW5nIG1lc3NhZ2UgaWYgaXQgZmFpbHMgdG8gY29ubmVjdCB0b1xuICAgICAgICAgKiB0aGUgYmFja2VuZCAoaW5pdGlhbGx5IHRydWUsIGNsZWFyZWQgYWZ0ZXIgYSBzdWNjZXNzZnVsIHN0cmVhbSwgb3IgaWYgd2UndmVcbiAgICAgICAgICogbG9nZ2VkIHRoZSBtZXNzYWdlIGFscmVhZHkpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kXyA9ICEwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgYnkgUmVtb3RlU3RvcmUgd2hlbiBhIHdhdGNoIHN0cmVhbSBpcyBzdGFydGVkIChpbmNsdWRpbmcgb24gZWFjaFxuICAgICAqIGJhY2tvZmYgYXR0ZW1wdCkuXG4gICAgICpcbiAgICAgKiBJZiB0aGlzIGlzIHRoZSBmaXJzdCBhdHRlbXB0LCBpdCBzZXRzIHRoZSBPbmxpbmVTdGF0ZSB0byBVbmtub3duIGFuZCBzdGFydHNcbiAgICAgKiB0aGUgb25saW5lU3RhdGVUaW1lci5cbiAgICAgKi8gICAgQV8oKSB7XG4gICAgICAgIDAgPT09IHRoaXMuVF8gJiYgKHRoaXMuUl8oXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIHRoaXMuRV8gPSB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFmdGVyRGVsYXkoXCJvbmxpbmVfc3RhdGVfdGltZW91dFwiIC8qIFRpbWVySWQuT25saW5lU3RhdGVUaW1lb3V0ICovICwgMWU0LCAoKCkgPT4gKHRoaXMuRV8gPSBudWxsLCBcbiAgICAgICAgdGhpcy5WXyhcIkJhY2tlbmQgZGlkbid0IHJlc3BvbmQgd2l0aGluIDEwIHNlY29uZHMuXCIpLCB0aGlzLlJfKFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8pLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIG91ciBPbmxpbmVTdGF0ZSBhcyBhcHByb3ByaWF0ZSBhZnRlciB0aGUgd2F0Y2ggc3RyZWFtIHJlcG9ydHMgYVxuICAgICAqIGZhaWx1cmUuIFRoZSBmaXJzdCBmYWlsdXJlIG1vdmVzIHVzIHRvIHRoZSAnVW5rbm93bicgc3RhdGUuIFdlIHRoZW4gbWF5XG4gICAgICogYWxsb3cgbXVsdGlwbGUgZmFpbHVyZXMgKGJhc2VkIG9uIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMpIGJlZm9yZSB3ZVxuICAgICAqIGFjdHVhbGx5IHRyYW5zaXRpb24gdG8gdGhlICdPZmZsaW5lJyBzdGF0ZS5cbiAgICAgKi8gICAgbV8oZSkge1xuICAgICAgICBcIk9ubGluZVwiIC8qIE9ubGluZVN0YXRlLk9ubGluZSAqLyA9PT0gdGhpcy5zdGF0ZSA/IHRoaXMuUl8oXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykgOiAodGhpcy5UXysrLCBcbiAgICAgICAgdGhpcy5UXyA+PSAxICYmICh0aGlzLmZfKCksIHRoaXMuVl8oYENvbm5lY3Rpb24gZmFpbGVkIDEgdGltZXMuIE1vc3QgcmVjZW50IGVycm9yOiAke2UudG9TdHJpbmcoKX1gKSwgXG4gICAgICAgIHRoaXMuUl8oXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwbGljaXRseSBzZXRzIHRoZSBPbmxpbmVTdGF0ZSB0byB0aGUgc3BlY2lmaWVkIHN0YXRlLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgcmVzZXRzIG91ciB0aW1lcnMgLyBmYWlsdXJlIGNvdW50ZXJzLCBldGMuIHVzZWQgYnkgb3VyXG4gICAgICogT2ZmbGluZSBoZXVyaXN0aWNzLCBzbyBtdXN0IG5vdCBiZSB1c2VkIGluIHBsYWNlIG9mXG4gICAgICogaGFuZGxlV2F0Y2hTdHJlYW1TdGFydCgpIGFuZCBoYW5kbGVXYXRjaFN0cmVhbUZhaWx1cmUoKS5cbiAgICAgKi8gICAgc2V0KGUpIHtcbiAgICAgICAgdGhpcy5mXygpLCB0aGlzLlRfID0gMCwgXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8gPT09IGUgJiYgKFxuICAgICAgICAvLyBXZSd2ZSBjb25uZWN0ZWQgdG8gd2F0Y2ggYXQgbGVhc3Qgb25jZS4gRG9uJ3Qgd2FybiB0aGUgZGV2ZWxvcGVyXG4gICAgICAgIC8vIGFib3V0IGJlaW5nIG9mZmxpbmUgZ29pbmcgZm9yd2FyZC5cbiAgICAgICAgdGhpcy5kXyA9ICExKSwgdGhpcy5SXyhlKTtcbiAgICB9XG4gICAgUl8oZSkge1xuICAgICAgICBlICE9PSB0aGlzLnN0YXRlICYmICh0aGlzLnN0YXRlID0gZSwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIoZSkpO1xuICAgIH1cbiAgICBWXyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBgQ291bGQgbm90IHJlYWNoIENsb3VkIEZpcmVzdG9yZSBiYWNrZW5kLiAke2V9XFxuVGhpcyB0eXBpY2FsbHkgaW5kaWNhdGVzIHRoYXQgeW91ciBkZXZpY2UgZG9lcyBub3QgaGF2ZSBhIGhlYWx0aHkgSW50ZXJuZXQgY29ubmVjdGlvbiBhdCB0aGUgbW9tZW50LiBUaGUgY2xpZW50IHdpbGwgb3BlcmF0ZSBpbiBvZmZsaW5lIG1vZGUgdW50aWwgaXQgaXMgYWJsZSB0byBzdWNjZXNzZnVsbHkgY29ubmVjdCB0byB0aGUgYmFja2VuZC5gO1xuICAgICAgICB0aGlzLmRfID8gKF9fUFJJVkFURV9sb2dFcnJvcih0KSwgdGhpcy5kXyA9ICExKSA6IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIk9ubGluZVN0YXRlVHJhY2tlclwiLCB0KTtcbiAgICB9XG4gICAgZl8oKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuRV8gJiYgKHRoaXMuRV8uY2FuY2VsKCksIHRoaXMuRV8gPSBudWxsKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9SZW1vdGVTdG9yZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBsb2NhbCBzdG9yZSwgdXNlZCB0byBmaWxsIHRoZSB3cml0ZSBwaXBlbGluZSB3aXRoIG91dGJvdW5kIG11dGF0aW9ucy5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGNsaWVudC1zaWRlIHByb3h5IGZvciBpbnRlcmFjdGluZyB3aXRoIHRoZSBiYWNrZW5kLiAqL1xuICAgIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlID0gZSwgdGhpcy5kYXRhc3RvcmUgPSB0LCB0aGlzLmFzeW5jUXVldWUgPSBuLCB0aGlzLnJlbW90ZVN5bmNlciA9IHt9LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbGlzdCBvZiB1cCB0byBNQVhfUEVORElOR19XUklURVMgd3JpdGVzIHRoYXQgd2UgaGF2ZSBmZXRjaGVkIGZyb20gdGhlXG4gICAgICAgICAqIExvY2FsU3RvcmUgdmlhIGZpbGxXcml0ZVBpcGVsaW5lKCkgYW5kIGhhdmUgb3Igd2lsbCBzZW5kIHRvIHRoZSB3cml0ZVxuICAgICAgICAgKiBzdHJlYW0uXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW5ldmVyIHdyaXRlUGlwZWxpbmUubGVuZ3RoID4gMCB0aGUgUmVtb3RlU3RvcmUgd2lsbCBhdHRlbXB0IHRvIHN0YXJ0IG9yXG4gICAgICAgICAqIHJlc3RhcnQgdGhlIHdyaXRlIHN0cmVhbS4gV2hlbiB0aGUgc3RyZWFtIGlzIGVzdGFibGlzaGVkIHRoZSB3cml0ZXMgaW4gdGhlXG4gICAgICAgICAqIHBpcGVsaW5lIHdpbGwgYmUgc2VudCBpbiBvcmRlci5cbiAgICAgICAgICpcbiAgICAgICAgICogV3JpdGVzIHJlbWFpbiBpbiB3cml0ZVBpcGVsaW5lIHVudGlsIHRoZXkgYXJlIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZFxuICAgICAgICAgKiBhbmQgdGh1cyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgcmUtc2VudCBpZiB0aGUgc3RyZWFtIGlzIGludGVycnVwdGVkIC9cbiAgICAgICAgICogcmVzdGFydGVkIGJlZm9yZSB0aGV5J3JlIGFja25vd2xlZGdlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogV3JpdGUgcmVzcG9uc2VzIGZyb20gdGhlIGJhY2tlbmQgYXJlIGxpbmtlZCB0byB0aGVpciBvcmlnaW5hdGluZyByZXF1ZXN0XG4gICAgICAgICAqIHB1cmVseSBiYXNlZCBvbiBvcmRlciwgYW5kIHNvIHdlIGNhbiBqdXN0IHNoaWZ0KCkgd3JpdGVzIGZyb20gdGhlIGZyb250IG9mXG4gICAgICAgICAqIHRoZSB3cml0ZVBpcGVsaW5lIGFzIHdlIHJlY2VpdmUgcmVzcG9uc2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nXyA9IFtdLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbWFwcGluZyBvZiB3YXRjaGVkIHRhcmdldHMgdGhhdCB0aGUgY2xpZW50IGNhcmVzIGFib3V0IHRyYWNraW5nIGFuZCB0aGVcbiAgICAgICAgICogdXNlciBoYXMgZXhwbGljaXRseSBjYWxsZWQgYSAnbGlzdGVuJyBmb3IgdGhpcyB0YXJnZXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZXNlIHRhcmdldHMgbWF5IG9yIG1heSBub3QgaGF2ZSBiZWVuIHNlbnQgdG8gb3IgYWNrbm93bGVkZ2VkIGJ5IHRoZVxuICAgICAgICAgKiBzZXJ2ZXIuIE9uIHJlLWVzdGFibGlzaGluZyB0aGUgbGlzdGVuIHN0cmVhbSwgdGhlc2UgdGFyZ2V0cyBzaG91bGQgYmUgc2VudFxuICAgICAgICAgKiB0byB0aGUgc2VydmVyLiBUaGUgdGFyZ2V0cyByZW1vdmVkIHdpdGggdW5saXN0ZW5zIGFyZSByZW1vdmVkIGVhZ2VybHlcbiAgICAgICAgICogd2l0aG91dCB3YWl0aW5nIGZvciBjb25maXJtYXRpb24gZnJvbSB0aGUgbGlzdGVuIHN0cmVhbS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucF8gPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgc2V0IG9mIHJlYXNvbnMgZm9yIHdoeSB0aGUgUmVtb3RlU3RvcmUgbWF5IGJlIG9mZmxpbmUuIElmIGVtcHR5LCB0aGVcbiAgICAgICAgICogUmVtb3RlU3RvcmUgbWF5IHN0YXJ0IGl0cyBuZXR3b3JrIGNvbm5lY3Rpb25zLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy55XyA9IG5ldyBTZXQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogRXZlbnQgaGFuZGxlcnMgdGhhdCBnZXQgY2FsbGVkIHdoZW4gdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQgb3IgZW5hYmxlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogUE9SVElORyBOT1RFOiBUaGVzZSBmdW5jdGlvbnMgYXJlIHVzZWQgb24gdGhlIFdlYiBjbGllbnQgdG8gY3JlYXRlIHRoZVxuICAgICAgICAgKiB1bmRlcmx5aW5nIHN0cmVhbXMgKHRvIHN1cHBvcnQgdHJlZS1zaGFrZWFibGUgc3RyZWFtcykuIE9uIEFuZHJvaWQgYW5kIGlPUyxcbiAgICAgICAgICogdGhlIHN0cmVhbXMgYXJlIGNyZWF0ZWQgZHVyaW5nIGNvbnN0cnVjdGlvbiBvZiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud18gPSBbXSwgdGhpcy5TXyA9IGksIHRoaXMuU18uWXMoKGUgPT4ge1xuICAgICAgICAgICAgbi5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gUG9ydGluZyBOb3RlOiBVbmxpa2UgaU9TLCBgcmVzdGFydE5ldHdvcmsoKWAgaXMgY2FsbGVkIGV2ZW4gd2hlbiB0aGVcbiAgICAgICAgICAgICAgICAvLyBuZXR3b3JrIGJlY29tZXMgdW5yZWFjaGFibGUgYXMgd2UgZG9uJ3QgaGF2ZSBhbnkgb3RoZXIgd2F5IHRvIHRlYXJcbiAgICAgICAgICAgICAgICAvLyBkb3duIG91ciBzdHJlYW1zLlxuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKHRoaXMpICYmIChfX1BSSVZBVEVfbG9nRGVidWcoXCJSZW1vdGVTdG9yZVwiLCBcIlJlc3RhcnRpbmcgc3RyZWFtcyBmb3IgbmV0d29yayByZWFjaGFiaWxpdHkgY2hhbmdlLlwiKSwgXG4gICAgICAgICAgICAgICAgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3Jlc3RhcnROZXR3b3JrKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICAgICAgICAgIHQueV8uYWRkKDQgLyogT2ZmbGluZUNhdXNlLkNvbm5lY3Rpdml0eUNoYW5nZSAqLyksIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKHQpLCBcbiAgICAgICAgICAgICAgICAgICAgdC5iXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIHQueV8uZGVsZXRlKDQgLyogT2ZmbGluZUNhdXNlLkNvbm5lY3Rpdml0eUNoYW5nZSAqLyksIFxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZW5hYmxlTmV0d29ya0ludGVybmFsKHQpO1xuICAgICAgICAgICAgICAgIH0odGhpcykpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSksIHRoaXMuYl8gPSBuZXcgX19QUklWQVRFX09ubGluZVN0YXRlVHJhY2tlcihuLCByKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwoZSkge1xuICAgIGlmIChfX1BSSVZBVEVfY2FuVXNlTmV0d29yayhlKSkgZm9yIChjb25zdCB0IG9mIGUud18pIGF3YWl0IHQoLyogZW5hYmxlZD0gKi8gITApO1xufVxuXG4vKipcbiAqIFRlbXBvcmFyaWx5IGRpc2FibGVzIHRoZSBuZXR3b3JrLiBUaGUgbmV0d29yayBjYW4gYmUgcmUtZW5hYmxlZCB1c2luZ1xuICogZW5hYmxlTmV0d29yaygpLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKGUpIHtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS53XykgYXdhaXQgdCgvKiBlbmFibGVkPSAqLyAhMSk7XG59XG5cbi8qKlxuICogU3RhcnRzIG5ldyBsaXN0ZW4gZm9yIHRoZSBnaXZlbiB0YXJnZXQuIFVzZXMgcmVzdW1lIHRva2VuIGlmIHByb3ZpZGVkLiBJdFxuICogaXMgYSBuby1vcCBpZiB0aGUgdGFyZ2V0IG9mIGdpdmVuIGBUYXJnZXREYXRhYCBpcyBhbHJlYWR5IGJlaW5nIGxpc3RlbmVkIHRvLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIG4ucF8uaGFzKHQudGFyZ2V0SWQpIHx8IChcbiAgICAvLyBNYXJrIHRoaXMgYXMgc29tZXRoaW5nIHRoZSBjbGllbnQgaXMgY3VycmVudGx5IGxpc3RlbmluZyBmb3IuXG4gICAgbi5wXy5zZXQodC50YXJnZXRJZCwgdCksIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKG4pID8gXG4gICAgLy8gVGhlIGxpc3RlbiB3aWxsIGJlIHNlbnQgaW4gb25XYXRjaFN0cmVhbU9wZW5cbiAgICBfX1BSSVZBVEVfc3RhcnRXYXRjaFN0cmVhbShuKSA6IF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShuKS5VbygpICYmIF9fUFJJVkFURV9zZW5kV2F0Y2hSZXF1ZXN0KG4sIHQpKTtcbn1cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBsaXN0ZW4gZnJvbSBzZXJ2ZXIuIEl0IGlzIGEgbm8tb3AgaWYgdGhlIGdpdmVuIHRhcmdldCBpZCBpc1xuICogbm90IGJlaW5nIGxpc3RlbmVkIHRvLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShuKTtcbiAgICBuLnBfLmRlbGV0ZSh0KSwgci5VbygpICYmIF9fUFJJVkFURV9zZW5kVW53YXRjaFJlcXVlc3QobiwgdCksIDAgPT09IG4ucF8uc2l6ZSAmJiAoci5VbygpID8gci56bygpIDogX19QUklWQVRFX2NhblVzZU5ldHdvcmsobikgJiYgXG4gICAgLy8gUmV2ZXJ0IHRvIE9ubGluZVN0YXRlLlVua25vd24gaWYgdGhlIHdhdGNoIHN0cmVhbSBpcyBub3Qgb3BlbiBhbmQgd2VcbiAgICAvLyBoYXZlIG5vIGxpc3RlbmVycywgc2luY2Ugd2l0aG91dCBhbnkgbGlzdGVucyB0byBzZW5kIHdlIGNhbm5vdFxuICAgIC8vIGNvbmZpcm0gaWYgdGhlIHN0cmVhbSBpcyBoZWFsdGh5IGFuZCB1cGdyYWRlIHRvIE9ubGluZVN0YXRlLk9ubGluZS5cbiAgICBuLmJfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSk7XG59XG5cbi8qKlxuICogV2UgbmVlZCB0byBpbmNyZW1lbnQgdGhlIHRoZSBleHBlY3RlZCBudW1iZXIgb2YgcGVuZGluZyByZXNwb25zZXMgd2UncmUgZHVlXG4gKiBmcm9tIHdhdGNoIHNvIHdlIHdhaXQgZm9yIHRoZSBhY2sgdG8gcHJvY2VzcyBhbnkgbWVzc2FnZXMgZnJvbSB0aGlzIHRhcmdldC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VuZFdhdGNoUmVxdWVzdChlLCB0KSB7XG4gICAgaWYgKGUuRF8uQmUodC50YXJnZXRJZCksIHQucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCB8fCB0LnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8oU25hcHNob3RWZXJzaW9uLm1pbigpKSA+IDApIHtcbiAgICAgICAgY29uc3QgbiA9IGUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQodC50YXJnZXRJZCkuc2l6ZTtcbiAgICAgICAgdCA9IHQud2l0aEV4cGVjdGVkQ291bnQobik7XG4gICAgfVxuICAgIF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShlKS5pXyh0KTtcbn1cblxuLyoqXG4gKiBXZSBuZWVkIHRvIGluY3JlbWVudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIHdlJ3JlIGR1ZVxuICogZnJvbSB3YXRjaCBzbyB3ZSB3YWl0IGZvciB0aGUgcmVtb3ZhbCBvbiB0aGUgc2VydmVyIGJlZm9yZSB3ZSBwcm9jZXNzIGFueVxuICogbWVzc2FnZXMgZnJvbSB0aGlzIHRhcmdldC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VuZFVud2F0Y2hSZXF1ZXN0KGUsIHQpIHtcbiAgICBlLkRfLkJlKHQpLCBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0oZSkuc18odCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zdGFydFdhdGNoU3RyZWFtKGUpIHtcbiAgICBlLkRfID0gbmV3IF9fUFJJVkFURV9XYXRjaENoYW5nZUFnZ3JlZ2F0b3Ioe1xuICAgICAgICBnZXRSZW1vdGVLZXlzRm9yVGFyZ2V0OiB0ID0+IGUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQodCksXG4gICAgICAgIHV0OiB0ID0+IGUucF8uZ2V0KHQpIHx8IG51bGwsXG4gICAgICAgIHJ0OiAoKSA9PiBlLmRhdGFzdG9yZS5zZXJpYWxpemVyLmRhdGFiYXNlSWRcbiAgICB9KSwgX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpLnN0YXJ0KCksIGUuYl8uQV8oKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHdhdGNoIHN0cmVhbSBzaG91bGQgYmUgc3RhcnRlZCBiZWNhdXNlIGl0J3MgbmVjZXNzYXJ5XG4gKiBhbmQgaGFzIG5vdCB5ZXQgYmVlbiBzdGFydGVkLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkgJiYgIV9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShlKS4kbygpICYmIGUucF8uc2l6ZSA+IDA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gMCA9PT0gX19QUklWQVRFX2RlYnVnQ2FzdChlKS55Xy5zaXplO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2xlYW5VcFdhdGNoU3RyZWFtU3RhdGUoZSkge1xuICAgIGUuRF8gPSB2b2lkIDA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldhdGNoU3RyZWFtT3BlbihlKSB7XG4gICAgZS5wXy5mb3JFYWNoKCgodCwgbikgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfc2VuZFdhdGNoUmVxdWVzdChlLCB0KTtcbiAgICB9KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2xvc2UoZSwgdCkge1xuICAgIF9fUFJJVkFURV9jbGVhblVwV2F0Y2hTdHJlYW1TdGF0ZShlKSwgXG4gICAgLy8gSWYgd2Ugc3RpbGwgbmVlZCB0aGUgd2F0Y2ggc3RyZWFtLCByZXRyeSB0aGUgY29ubmVjdGlvbi5cbiAgICBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXYXRjaFN0cmVhbShlKSA/IChlLmJfLm1fKHQpLCBfX1BSSVZBVEVfc3RhcnRXYXRjaFN0cmVhbShlKSkgOiBcbiAgICAvLyBObyBuZWVkIHRvIHJlc3RhcnQgd2F0Y2ggc3RyZWFtIGJlY2F1c2UgdGhlcmUgYXJlIG5vIGFjdGl2ZSB0YXJnZXRzLlxuICAgIC8vIFRoZSBvbmxpbmUgc3RhdGUgaXMgc2V0IHRvIHVua25vd24gYmVjYXVzZSB0aGVyZSBpcyBubyBhY3RpdmUgYXR0ZW1wdFxuICAgIC8vIGF0IGVzdGFibGlzaGluZyBhIGNvbm5lY3Rpb25cbiAgICBlLmJfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV2F0Y2hTdHJlYW1DaGFuZ2UoZSwgdCwgbikge1xuICAgIGlmIChcbiAgICAvLyBNYXJrIHRoZSBjbGllbnQgYXMgb25saW5lIHNpbmNlIHdlIGdvdCBhIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyXG4gICAgZS5iXy5zZXQoXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8pLCB0IGluc3RhbmNlb2YgX19QUklWQVRFX1dhdGNoVGFyZ2V0Q2hhbmdlICYmIDIgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZW1vdmVkICovID09PSB0LnN0YXRlICYmIHQuY2F1c2UpIFxuICAgIC8vIFRoZXJlIHdhcyBhbiBlcnJvciBvbiBhIHRhcmdldCwgZG9uJ3Qgd2FpdCBmb3IgYSBjb25zaXN0ZW50IHNuYXBzaG90XG4gICAgLy8gdG8gcmFpc2UgZXZlbnRzXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgXG4gICAgICAgIC8qKiBIYW5kbGVzIGFuIGVycm9yIG9uIGEgdGFyZ2V0ICovXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9oYW5kbGVUYXJnZXRFcnJvcihlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5jYXVzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiB0LnRhcmdldElkcykgXG4gICAgICAgICAgICAvLyBBIHdhdGNoZWQgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkuXG4gICAgICAgICAgICBlLnBfLmhhcyhyKSAmJiAoYXdhaXQgZS5yZW1vdGVTeW5jZXIucmVqZWN0TGlzdGVuKHIsIG4pLCBlLnBfLmRlbGV0ZShyKSwgZS5EXy5yZW1vdmVUYXJnZXQocikpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQXR0ZW1wdHMgdG8gZmlsbCBvdXIgd3JpdGUgcGlwZWxpbmUgd2l0aCB3cml0ZXMgZnJvbSB0aGUgTG9jYWxTdG9yZS5cbiAqXG4gKiBDYWxsZWQgaW50ZXJuYWxseSB0byBib290c3RyYXAgb3IgcmVmaWxsIHRoZSB3cml0ZSBwaXBlbGluZSBhbmQgYnlcbiAqIFN5bmNFbmdpbmUgd2hlbmV2ZXIgdGhlcmUgYXJlIG5ldyBtdXRhdGlvbnMgdG8gcHJvY2Vzcy5cbiAqXG4gKiBTdGFydHMgdGhlIHdyaXRlIHN0cmVhbSBpZiBuZWNlc3NhcnkuXG4gKi8gKGUsIHQpO1xuICAgIH0gY2F0Y2ggKG4pIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgXCJGYWlsZWQgdG8gcmVtb3ZlIHRhcmdldHMgJXM6ICVzIFwiLCB0LnRhcmdldElkcy5qb2luKFwiLFwiKSwgbiksIFxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KGUsIG4pO1xuICAgIH0gZWxzZSBpZiAodCBpbnN0YW5jZW9mIF9fUFJJVkFURV9Eb2N1bWVudFdhdGNoQ2hhbmdlID8gZS5EXy5XZSh0KSA6IHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfRXhpc3RlbmNlRmlsdGVyQ2hhbmdlID8gZS5EXy5aZSh0KSA6IGUuRF8uamUodCksIFxuICAgICFuLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSkgdHJ5IHtcbiAgICAgICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlLmxvY2FsU3RvcmUpO1xuICAgICAgICBuLmNvbXBhcmVUbyh0KSA+PSAwICYmIFxuICAgICAgICAvLyBXZSBoYXZlIHJlY2VpdmVkIGEgdGFyZ2V0IGNoYW5nZSB3aXRoIGEgZ2xvYmFsIHNuYXBzaG90IGlmIHRoZSBzbmFwc2hvdFxuICAgICAgICAvLyB2ZXJzaW9uIGlzIG5vdCBlcXVhbCB0byBTbmFwc2hvdFZlcnNpb24ubWluKCkuXG4gICAgICAgIGF3YWl0IFxuICAgICAgICAvKipcbiAqIFRha2VzIGEgYmF0Y2ggb2YgY2hhbmdlcyBmcm9tIHRoZSBEYXRhc3RvcmUsIHJlcGFja2FnZXMgdGhlbSBhcyBhXG4gKiBSZW1vdGVFdmVudCwgYW5kIHBhc3NlcyB0aGF0IG9uIHRvIHRoZSBsaXN0ZW5lciwgd2hpY2ggaXMgdHlwaWNhbGx5IHRoZVxuICogU3luY0VuZ2luZS5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfcmFpc2VXYXRjaFNuYXBzaG90KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLkRfLnN0KHQpO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGluLW1lbW9yeSByZXN1bWUgdG9rZW5zLiBMb2NhbFN0b3JlIHdpbGwgdXBkYXRlIHRoZVxuICAgICAgICAgICAgLy8gcGVyc2lzdGVudCB2aWV3IG9mIHRoZXNlIHdoZW4gYXBwbHlpbmcgdGhlIGNvbXBsZXRlZCBSZW1vdGVFdmVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobi5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBlLnBfLmdldChyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQSB3YXRjaGVkIHRhcmdldCBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCBhbHJlYWR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgJiYgZS5wXy5zZXQociwgaS53aXRoUmVzdW1lVG9rZW4obi5yZXN1bWVUb2tlbiwgdCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKSwgXG4gICAgICAgICAgICAvLyBSZS1lc3RhYmxpc2ggbGlzdGVucyBmb3IgdGhlIHRhcmdldHMgdGhhdCBoYXZlIGJlZW4gaW52YWxpZGF0ZWQgYnlcbiAgICAgICAgICAgIC8vIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2hlcy5cbiAgICAgICAgICAgIG4udGFyZ2V0TWlzbWF0Y2hlcy5mb3JFYWNoKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBlLnBfLmdldCh0KTtcbiAgICAgICAgICAgICAgICBpZiAoIXIpIFxuICAgICAgICAgICAgICAgIC8vIEEgd2F0Y2hlZCB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeS5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIHJlc3VtZSB0b2tlbiBmb3IgdGhlIHRhcmdldCwgc2luY2Ugd2UncmUgaW4gYSBrbm93biBtaXNtYXRjaFxuICAgICAgICAgICAgICAgIC8vIHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnBfLnNldCh0LCByLndpdGhSZXN1bWVUb2tlbihCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HLCByLnNuYXBzaG90VmVyc2lvbikpLCBcbiAgICAgICAgICAgICAgICAvLyBDYXVzZSBhIGhhcmQgcmVzZXQgYnkgdW53YXRjaGluZyBhbmQgcmV3YXRjaGluZyBpbW1lZGlhdGVseSwgYnV0XG4gICAgICAgICAgICAgICAgLy8gZGVsaWJlcmF0ZWx5IGRvbid0IHNlbmQgYSByZXN1bWUgdG9rZW4gc28gdGhhdCB3ZSBnZXQgYSBmdWxsIHVwZGF0ZS5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfc2VuZFVud2F0Y2hSZXF1ZXN0KGUsIHQpO1xuICAgICAgICAgICAgICAgIC8vIE1hcmsgdGhlIHRhcmdldCB3ZSBzZW5kIGFzIGJlaW5nIG9uIGJlaGFsZiBvZiBhbiBleGlzdGVuY2UgZmlsdGVyXG4gICAgICAgICAgICAgICAgLy8gbWlzbWF0Y2gsIGJ1dCBkb24ndCBhY3R1YWxseSByZXRhaW4gdGhhdCBpbiBsaXN0ZW5UYXJnZXRzLiBUaGlzIGVuc3VyZXNcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHdlIGZsYWcgdGhlIGZpcnN0IHJlLWxpc3RlbiB0aGlzIHdheSB3aXRob3V0IGltcGFjdGluZyBmdXR1cmVcbiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5zIG9mIHRoaXMgdGFyZ2V0ICh0aGF0IG1pZ2h0IGhhcHBlbiBlLmcuIG9uIHJlY29ubmVjdCkuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBUYXJnZXREYXRhKHIudGFyZ2V0LCB0LCBuLCByLnNlcXVlbmNlTnVtYmVyKTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfc2VuZFdhdGNoUmVxdWVzdChlLCBpKTtcbiAgICAgICAgICAgIH0pKSwgZS5yZW1vdGVTeW5jZXIuYXBwbHlSZW1vdGVFdmVudChuKTtcbiAgICAgICAgfShlLCBuKTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlJlbW90ZVN0b3JlXCIsIFwiRmFpbGVkIHRvIHJhaXNlIHNuYXBzaG90OlwiLCB0KSwgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeShlLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVjb3ZlcnkgbG9naWMgZm9yIEluZGV4ZWREQiBlcnJvcnMgdGhhdCB0YWtlcyB0aGUgbmV0d29yayBvZmZsaW5lIHVudGlsXG4gKiBgb3BgIHN1Y2NlZWRzLiBSZXRyaWVzIGFyZSBzY2hlZHVsZWQgd2l0aCBiYWNrb2ZmIHVzaW5nXG4gKiBgZW5xdWV1ZVJldHJ5YWJsZSgpYC4gSWYgYG9wKClgIGlzIG5vdCBwcm92aWRlZCwgSW5kZXhlZERCIGFjY2VzcyBpc1xuICogdmFsaWRhdGVkIHZpYSBhIGdlbmVyaWMgb3BlcmF0aW9uLlxuICpcbiAqIFRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQgYW5kIGJlZm9yZVxuICogYW55IHJldHJ5IGF0dGVtcHQuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeShlLCB0LCBuKSB7XG4gICAgaWYgKCFfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKHQpKSB0aHJvdyB0O1xuICAgIGUueV8uYWRkKDEgLyogT2ZmbGluZUNhdXNlLkluZGV4ZWREYkZhaWxlZCAqLyksIFxuICAgIC8vIERpc2FibGUgbmV0d29yayBhbmQgcmFpc2Ugb2ZmbGluZSBzbmFwc2hvdHNcbiAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChlKSwgZS5iXy5zZXQoXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyksIFxuICAgIG4gfHwgKFxuICAgIC8vIFVzZSBhIHNpbXBsZSByZWFkIG9wZXJhdGlvbiB0byBkZXRlcm1pbmUgaWYgSW5kZXhlZERCIHJlY292ZXJlZC5cbiAgICAvLyBJZGVhbGx5LCB3ZSB3b3VsZCBleHBvc2UgYSBoZWFsdGggY2hlY2sgZGlyZWN0bHkgb24gU2ltcGxlRGIsIGJ1dFxuICAgIC8vIFJlbW90ZVN0b3JlIG9ubHkgaGFzIGFjY2VzcyB0byBwZXJzaXN0ZW5jZSB0aHJvdWdoIExvY2FsU3RvcmUuXG4gICAgbiA9ICgpID0+IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlLmxvY2FsU3RvcmUpKSwgXG4gICAgLy8gUHJvYmUgSW5kZXhlZERCIHBlcmlvZGljYWxseSBhbmQgcmUtZW5hYmxlIG5ldHdvcmtcbiAgICBlLmFzeW5jUXVldWUuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJSZW1vdGVTdG9yZVwiLCBcIlJldHJ5aW5nIEluZGV4ZWREQiBhY2Nlc3NcIiksIGF3YWl0IG4oKSwgZS55Xy5kZWxldGUoMSAvKiBPZmZsaW5lQ2F1c2UuSW5kZXhlZERiRmFpbGVkICovKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwoZSk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGBvcGAuIElmIGBvcGAgZmFpbHMsIHRha2VzIHRoZSBuZXR3b3JrIG9mZmxpbmUgdW50aWwgYG9wYFxuICogc3VjY2VlZHMuIFJldHVybnMgYWZ0ZXIgdGhlIGZpcnN0IGF0dGVtcHQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2V4ZWN1dGVXaXRoUmVjb3ZlcnkoZSwgdCkge1xuICAgIHJldHVybiB0KCkuY2F0Y2goKG4gPT4gX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeShlLCBuLCB0KSkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBuID0gX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKHQpO1xuICAgIGxldCByID0gdC5nXy5sZW5ndGggPiAwID8gdC5nX1t0LmdfLmxlbmd0aCAtIDFdLmJhdGNoSWQgOiAtMTtcbiAgICBmb3IgKDtfX1BSSVZBVEVfY2FuQWRkVG9Xcml0ZVBpcGVsaW5lKHQpOyApIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldE5leHRNdXRhdGlvbkJhdGNoKHQubG9jYWxTdG9yZSwgcik7XG4gICAgICAgIGlmIChudWxsID09PSBlKSB7XG4gICAgICAgICAgICAwID09PSB0LmdfLmxlbmd0aCAmJiBuLnpvKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByID0gZS5iYXRjaElkLCBfX1BSSVZBVEVfYWRkVG9Xcml0ZVBpcGVsaW5lKHQsIGUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeSh0LCBlKTtcbiAgICB9XG4gICAgX19QUklWQVRFX3Nob3VsZFN0YXJ0V3JpdGVTdHJlYW0odCkgJiYgX19QUklWQVRFX3N0YXJ0V3JpdGVTdHJlYW0odCk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHdlIGNhbiBhZGQgdG8gdGhlIHdyaXRlIHBpcGVsaW5lIChpLmUuIHRoZSBuZXR3b3JrIGlzXG4gKiBlbmFibGVkIGFuZCB0aGUgd3JpdGUgcGlwZWxpbmUgaXMgbm90IGZ1bGwpLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5BZGRUb1dyaXRlUGlwZWxpbmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY2FuVXNlTmV0d29yayhlKSAmJiBlLmdfLmxlbmd0aCA8IDEwO1xufVxuXG4vKipcbiAqIFF1ZXVlcyBhZGRpdGlvbmFsIHdyaXRlcyB0byBiZSBzZW50IHRvIHRoZSB3cml0ZSBzdHJlYW0sIHNlbmRpbmcgdGhlbVxuICogaW1tZWRpYXRlbHkgaWYgdGhlIHdyaXRlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYWRkVG9Xcml0ZVBpcGVsaW5lKGUsIHQpIHtcbiAgICBlLmdfLnB1c2godCk7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKTtcbiAgICBuLlVvKCkgJiYgbi5fXyAmJiBuLmFfKHQubXV0YXRpb25zKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3Nob3VsZFN0YXJ0V3JpdGVTdHJlYW0oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY2FuVXNlTmV0d29yayhlKSAmJiAhX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpLiRvKCkgJiYgZS5nXy5sZW5ndGggPiAwO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3RhcnRXcml0ZVN0cmVhbShlKSB7XG4gICAgX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpLnN0YXJ0KCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldyaXRlU3RyZWFtT3BlbihlKSB7XG4gICAgX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpLmxfKCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldyaXRlSGFuZHNoYWtlQ29tcGxldGUoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSk7XG4gICAgLy8gU2VuZCB0aGUgd3JpdGUgcGlwZWxpbmUgbm93IHRoYXQgdGhlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZC5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIGUuZ18pIHQuYV8obi5tdXRhdGlvbnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25NdXRhdGlvblJlc3VsdChlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IGUuZ18uc2hpZnQoKSwgaSA9IE11dGF0aW9uQmF0Y2hSZXN1bHQuZnJvbShyLCB0LCBuKTtcbiAgICBhd2FpdCBfX1BSSVZBVEVfZXhlY3V0ZVdpdGhSZWNvdmVyeShlLCAoKCkgPT4gZS5yZW1vdGVTeW5jZXIuYXBwbHlTdWNjZXNzZnVsV3JpdGUoaSkpKSwgXG4gICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHdpdGggdGhlIGNvbXBsZXRpb24gb2YgdGhpcyBtdXRhdGlvbiBhbm90aGVyXG4gICAgLy8gc2xvdCBoYXMgZnJlZWQgdXAuXG4gICAgYXdhaXQgX19QUklWQVRFX2ZpbGxXcml0ZVBpcGVsaW5lKGUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25Xcml0ZVN0cmVhbUNsb3NlKGUsIHQpIHtcbiAgICAvLyBJZiB0aGUgd3JpdGUgc3RyZWFtIGNsb3NlZCBhZnRlciB0aGUgd3JpdGUgaGFuZHNoYWtlIGNvbXBsZXRlcywgYSB3cml0ZVxuICAgIC8vIG9wZXJhdGlvbiBmYWlsZWQgYW5kIHdlIGZhaWwgdGhlIHBlbmRpbmcgb3BlcmF0aW9uLlxuICAgIHQgJiYgX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpLl9fICYmIFxuICAgIC8vIFRoaXMgZXJyb3IgYWZmZWN0cyB0aGUgYWN0dWFsIHdyaXRlLlxuICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9oYW5kbGVXcml0ZUVycm9yKGUsIHQpIHtcbiAgICAgICAgLy8gT25seSBoYW5kbGUgcGVybWFuZW50IGVycm9ycyBoZXJlLiBJZiBpdCdzIHRyYW5zaWVudCwganVzdCBsZXQgdGhlIHJldHJ5XG4gICAgICAgIC8vIGxvZ2ljIGtpY2sgaW4uXG4gICAgICAgIGlmIChmdW5jdGlvbiBfX1BSSVZBVEVfaXNQZXJtYW5lbnRXcml0ZUVycm9yKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfaXNQZXJtYW5lbnRFcnJvcihlKSAmJiBlICE9PSB2LkFCT1JURUQ7XG4gICAgICAgIH0odC5jb2RlKSkge1xuICAgICAgICAgICAgLy8gVGhpcyB3YXMgYSBwZXJtYW5lbnQgZXJyb3IsIHRoZSByZXF1ZXN0IGl0c2VsZiB3YXMgdGhlIHByb2JsZW1cbiAgICAgICAgICAgIC8vIHNvIGl0J3Mgbm90IGdvaW5nIHRvIHN1Y2NlZWQgaWYgd2UgcmVzZW5kIGl0LlxuICAgICAgICAgICAgY29uc3QgbiA9IGUuZ18uc2hpZnQoKTtcbiAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSBpdCdzIGFsc28gdW5saWtlbHkgdGhhdCB0aGUgc2VydmVyIGl0c2VsZiBpcyBtZWx0aW5nXG4gICAgICAgICAgICAvLyBkb3duIC0tIHRoaXMgd2FzIGp1c3QgYSBiYWQgcmVxdWVzdCBzbyBpbmhpYml0IGJhY2tvZmYgb24gdGhlIG5leHRcbiAgICAgICAgICAgIC8vIHJlc3RhcnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkuR28oKSwgYXdhaXQgX19QUklWQVRFX2V4ZWN1dGVXaXRoUmVjb3ZlcnkoZSwgKCgpID0+IGUucmVtb3RlU3luY2VyLnJlamVjdEZhaWxlZFdyaXRlKG4uYmF0Y2hJZCwgdCkpKSwgXG4gICAgICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2l0aCB0aGUgY29tcGxldGlvbiBvZiB0aGlzIG11dGF0aW9uXG4gICAgICAgICAgICAvLyBhbm90aGVyIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX2ZpbGxXcml0ZVBpcGVsaW5lKGUpO1xuICAgICAgICB9XG4gICAgfShlLCB0KSwgXG4gICAgLy8gVGhlIHdyaXRlIHN0cmVhbSBtaWdodCBoYXZlIGJlZW4gc3RhcnRlZCBieSByZWZpbGxpbmcgdGhlIHdyaXRlXG4gICAgLy8gcGlwZWxpbmUgZm9yIGZhaWxlZCB3cml0ZXNcbiAgICBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXcml0ZVN0cmVhbShlKSAmJiBfX1BSSVZBVEVfc3RhcnRXcml0ZVN0cmVhbShlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3JlbW90ZVN0b3JlSGFuZGxlQ3JlZGVudGlhbENoYW5nZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgbi5hc3luY1F1ZXVlLnZlcmlmeU9wZXJhdGlvbkluUHJvZ3Jlc3MoKSwgX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgXCJSZW1vdGVTdG9yZSByZWNlaXZlZCBuZXcgY3JlZGVudGlhbHNcIik7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKG4pO1xuICAgIC8vIFRlYXIgZG93biBhbmQgcmUtY3JlYXRlIG91ciBuZXR3b3JrIHN0cmVhbXMuIFRoaXMgd2lsbCBlbnN1cmUgd2UgZ2V0IGFcbiAgICAvLyBmcmVzaCBhdXRoIHRva2VuIGZvciB0aGUgbmV3IHVzZXIgYW5kIHJlLWZpbGwgdGhlIHdyaXRlIHBpcGVsaW5lIHdpdGhcbiAgICAvLyBuZXcgbXV0YXRpb25zIGZyb20gdGhlIExvY2FsU3RvcmUgKHNpbmNlIG11dGF0aW9ucyBhcmUgcGVyLXVzZXIpLlxuICAgICAgICBuLnlfLmFkZCgzIC8qIE9mZmxpbmVDYXVzZS5DcmVkZW50aWFsQ2hhbmdlICovKSwgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrSW50ZXJuYWwobiksIFxuICAgIHIgJiYgXG4gICAgLy8gRG9uJ3Qgc2V0IHRoZSBuZXR3b3JrIHN0YXR1cyB0byBVbmtub3duIGlmIHdlIGFyZSBvZmZsaW5lLlxuICAgIG4uYl8uc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pLCBhd2FpdCBuLnJlbW90ZVN5bmNlci5oYW5kbGVDcmVkZW50aWFsQ2hhbmdlKHQpLCBcbiAgICBuLnlfLmRlbGV0ZSgzIC8qIE9mZmxpbmVDYXVzZS5DcmVkZW50aWFsQ2hhbmdlICovKSwgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbChuKTtcbn1cblxuLyoqXG4gKiBUb2dnbGVzIHRoZSBuZXR3b3JrIHN0YXRlIHdoZW4gdGhlIGNsaWVudCBnYWlucyBvciBsb3NlcyBpdHMgcHJpbWFyeSBsZWFzZS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVBcHBseVByaW1hcnlTdGF0ZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgdCA/IChuLnlfLmRlbGV0ZSgyIC8qIE9mZmxpbmVDYXVzZS5Jc1NlY29uZGFyeSAqLyksIGF3YWl0IF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwobikpIDogdCB8fCAobi55Xy5hZGQoMiAvKiBPZmZsaW5lQ2F1c2UuSXNTZWNvbmRhcnkgKi8pLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChuKSwgbi5iXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykpO1xufVxuXG4vKipcbiAqIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQsIHJlZ2lzdGVycyB0aGUgV2F0Y2hTdHJlYW0gYW5kIGl0cyBuZXR3b3JrIHN0YXRlXG4gKiBjYWxsYmFjayB3aXRoIGByZW1vdGVTdG9yZUltcGxgLiBSZXR1cm5zIHRoZSBleGlzdGluZyBzdHJlYW0gaWYgb25lIGlzXG4gKiBhbHJlYWR5IGF2YWlsYWJsZS5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IE9uIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdhdGNoU3RyZWFtIGdldHMgcmVnaXN0ZXJlZCBvbiBzdGFydHVwLlxuICogVGhpcyBpcyBub3QgZG9uZSBvbiBXZWIgdG8gYWxsb3cgaXQgdG8gYmUgdHJlZS1zaGFrZW4uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gZS52XyB8fCAoXG4gICAgLy8gQ3JlYXRlIHN0cmVhbSAoYnV0IG5vdGUgdGhhdCBpdCBpcyBub3Qgc3RhcnRlZCB5ZXQpLlxuICAgIGUudl8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UGVyc2lzdGVudFdhdGNoU3RyZWFtKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHJldHVybiByLlBfKCksIG5ldyBfX1BSSVZBVEVfUGVyc2lzdGVudExpc3RlblN0cmVhbSh0LCByLmNvbm5lY3Rpb24sIHIuYXV0aENyZWRlbnRpYWxzLCByLmFwcENoZWNrQ3JlZGVudGlhbHMsIHIuc2VyaWFsaXplciwgbik7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChlLmRhdGFzdG9yZSwgZS5hc3luY1F1ZXVlLCB7XG4gICAgICAgIF9vOiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbU9wZW4uYmluZChudWxsLCBlKSxcbiAgICAgICAgdW86IF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2xvc2UuYmluZChudWxsLCBlKSxcbiAgICAgICAgcl86IF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2hhbmdlLmJpbmQobnVsbCwgZSlcbiAgICB9KSwgZS53Xy5wdXNoKChhc3luYyB0ID0+IHtcbiAgICAgICAgdCA/IChlLnZfLkdvKCksIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKGUpID8gX19QUklWQVRFX3N0YXJ0V2F0Y2hTdHJlYW0oZSkgOiBlLmJfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSkgOiAoYXdhaXQgZS52Xy5zdG9wKCksIFxuICAgICAgICBfX1BSSVZBVEVfY2xlYW5VcFdhdGNoU3RyZWFtU3RhdGUoZSkpO1xuICAgIH0pKSksIGUudl87XG59XG5cbi8qKlxuICogSWYgbm90IHlldCBpbml0aWFsaXplZCwgcmVnaXN0ZXJzIHRoZSBXcml0ZVN0cmVhbSBhbmQgaXRzIG5ldHdvcmsgc3RhdGVcbiAqIGNhbGxiYWNrIHdpdGggYHJlbW90ZVN0b3JlSW1wbGAuIFJldHVybnMgdGhlIGV4aXN0aW5nIHN0cmVhbSBpZiBvbmUgaXNcbiAqIGFscmVhZHkgYXZhaWxhYmxlLlxuICpcbiAqIFBPUlRJTkcgTk9URTogT24gaU9TIGFuZCBBbmRyb2lkLCB0aGUgV3JpdGVTdHJlYW0gZ2V0cyByZWdpc3RlcmVkIG9uIHN0YXJ0dXAuXG4gKiBUaGlzIGlzIG5vdCBkb25lIG9uIFdlYiB0byBhbGxvdyBpdCB0byBiZSB0cmVlLXNoYWtlbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkge1xuICAgIHJldHVybiBlLkNfIHx8IChcbiAgICAvLyBDcmVhdGUgc3RyZWFtIChidXQgbm90ZSB0aGF0IGl0IGlzIG5vdCBzdGFydGVkIHlldCkuXG4gICAgZS5DXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdQZXJzaXN0ZW50V3JpdGVTdHJlYW0oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgcmV0dXJuIHIuUF8oKSwgbmV3IF9fUFJJVkFURV9QZXJzaXN0ZW50V3JpdGVTdHJlYW0odCwgci5jb25uZWN0aW9uLCByLmF1dGhDcmVkZW50aWFscywgci5hcHBDaGVja0NyZWRlbnRpYWxzLCByLnNlcmlhbGl6ZXIsIG4pO1xuICAgIH0oZS5kYXRhc3RvcmUsIGUuYXN5bmNRdWV1ZSwge1xuICAgICAgICBfbzogX19QUklWQVRFX29uV3JpdGVTdHJlYW1PcGVuLmJpbmQobnVsbCwgZSksXG4gICAgICAgIHVvOiBfX1BSSVZBVEVfb25Xcml0ZVN0cmVhbUNsb3NlLmJpbmQobnVsbCwgZSksXG4gICAgICAgIGNfOiBfX1BSSVZBVEVfb25Xcml0ZUhhbmRzaGFrZUNvbXBsZXRlLmJpbmQobnVsbCwgZSksXG4gICAgICAgIHVfOiBfX1BSSVZBVEVfb25NdXRhdGlvblJlc3VsdC5iaW5kKG51bGwsIGUpXG4gICAgfSksIGUud18ucHVzaCgoYXN5bmMgdCA9PiB7XG4gICAgICAgIHQgPyAoZS5DXy5HbygpLCBcbiAgICAgICAgLy8gVGhpcyB3aWxsIHN0YXJ0IHRoZSB3cml0ZSBzdHJlYW0gaWYgbmVjZXNzYXJ5LlxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoZSkpIDogKGF3YWl0IGUuQ18uc3RvcCgpLCBlLmdfLmxlbmd0aCA+IDAgJiYgKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlJlbW90ZVN0b3JlXCIsIGBTdG9wcGluZyB3cml0ZSBzdHJlYW0gd2l0aCAke2UuZ18ubGVuZ3RofSBwZW5kaW5nIHdyaXRlc2ApLCBcbiAgICAgICAgZS5nXyA9IFtdKSk7XG4gICAgfSkpKSwgZS5DXztcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhbiBvcGVyYXRpb24gc2NoZWR1bGVkIHRvIGJlIHJ1biBpbiB0aGUgZnV0dXJlIG9uIGFuIEFzeW5jUXVldWUuXG4gKlxuICogSXQgaXMgY3JlYXRlZCB2aWEgRGVsYXllZE9wZXJhdGlvbi5jcmVhdGVBbmRTY2hlZHVsZSgpLlxuICpcbiAqIFN1cHBvcnRzIGNhbmNlbGxhdGlvbiAodmlhIGNhbmNlbCgpKSBhbmQgZWFybHkgZXhlY3V0aW9uICh2aWEgc2tpcERlbGF5KCkpLlxuICpcbiAqIE5vdGU6IFdlIGltcGxlbWVudCBgUHJvbWlzZUxpa2VgIGluc3RlYWQgb2YgYFByb21pc2VgLCBhcyB0aGUgYFByb21pc2VgIHR5cGVcbiAqIGluIG5ld2VyIHZlcnNpb25zIG9mIFR5cGVTY3JpcHQgZGVmaW5lcyBgZmluYWxseWAsIHdoaWNoIGlzIG5vdCBhdmFpbGFibGUgaW5cbiAqIElFLlxuICovXG5jbGFzcyBEZWxheWVkT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZSA9IGUsIHRoaXMudGltZXJJZCA9IHQsIHRoaXMudGFyZ2V0VGltZU1zID0gbiwgdGhpcy5vcCA9IHIsIHRoaXMucmVtb3ZhbENhbGxiYWNrID0gaSwgXG4gICAgICAgIHRoaXMuZGVmZXJyZWQgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkLCB0aGlzLnRoZW4gPSB0aGlzLmRlZmVycmVkLnByb21pc2UudGhlbi5iaW5kKHRoaXMuZGVmZXJyZWQucHJvbWlzZSksIFxuICAgICAgICAvLyBJdCdzIG5vcm1hbCBmb3IgdGhlIGRlZmVycmVkIHByb21pc2UgdG8gYmUgY2FuY2VsZWQgKGR1ZSB0byBjYW5jZWxsYXRpb24pXG4gICAgICAgIC8vIGFuZCBzbyB3ZSBhdHRhY2ggYSBkdW1teSBjYXRjaCBjYWxsYmFjayB0byBhdm9pZFxuICAgICAgICAvLyAnVW5oYW5kbGVkUHJvbWlzZVJlamVjdGlvbldhcm5pbmcnIGxvZyBzcGFtLlxuICAgICAgICB0aGlzLmRlZmVycmVkLnByb21pc2UuY2F0Y2goKGUgPT4ge30pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIERlbGF5ZWRPcGVyYXRpb24gdGhhdCBoYXMgYmVlbiBzY2hlZHVsZWQgdG8gYmVcbiAgICAgKiBleGVjdXRlZCBvbiB0aGUgcHJvdmlkZWQgYXN5bmNRdWV1ZSBhZnRlciB0aGUgcHJvdmlkZWQgZGVsYXlNcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhc3luY1F1ZXVlIC0gVGhlIHF1ZXVlIHRvIHNjaGVkdWxlIHRoZSBvcGVyYXRpb24gb24uXG4gICAgICogQHBhcmFtIGlkIC0gQSBUaW1lciBJRCBpZGVudGlmeWluZyB0aGUgdHlwZSBvZiBvcGVyYXRpb24gdGhpcyBpcy5cbiAgICAgKiBAcGFyYW0gZGVsYXlNcyAtIFRoZSBkZWxheSAobXMpIGJlZm9yZSB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBzY2hlZHVsZWQuXG4gICAgICogQHBhcmFtIG9wIC0gVGhlIG9wZXJhdGlvbiB0byBydW4uXG4gICAgICogQHBhcmFtIHJlbW92YWxDYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgb25jZSB0aGVcbiAgICAgKiAgIG9wZXJhdGlvbiBpcyBleGVjdXRlZCBvciBjYW5jZWxlZCwgbm90aWZ5aW5nIHRoZSBBc3luY1F1ZXVlIHRvIHJlbW92ZSBpdFxuICAgICAqICAgZnJvbSBpdHMgZGVsYXllZE9wZXJhdGlvbnMgbGlzdC5cbiAgICAgKiAgIFBPUlRJTkcgTk9URTogVGhpcyBleGlzdHMgdG8gcHJldmVudCBtYWtpbmcgcmVtb3ZlRGVsYXllZE9wZXJhdGlvbigpIGFuZFxuICAgICAqICAgdGhlIERlbGF5ZWRPcGVyYXRpb24gY2xhc3MgcHVibGljLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlQW5kU2NoZWR1bGUoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gRGF0ZS5ub3coKSArIG4sIG8gPSBuZXcgRGVsYXllZE9wZXJhdGlvbihlLCB0LCBzLCByLCBpKTtcbiAgICAgICAgcmV0dXJuIG8uc3RhcnQobiksIG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgdGltZXIuIFRoaXMgaXMgY2FsbGVkIGltbWVkaWF0ZWx5IGFmdGVyIGNvbnN0cnVjdGlvbiBieVxuICAgICAqIGNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gICAgICovICAgIHN0YXJ0KGUpIHtcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IHNldFRpbWVvdXQoKCgpID0+IHRoaXMuaGFuZGxlRGVsYXlFbGFwc2VkKCkpLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUXVldWVzIHRoZSBvcGVyYXRpb24gdG8gcnVuIGltbWVkaWF0ZWx5IChpZiBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIHJ1biBvclxuICAgICAqIGNhbmNlbGVkKS5cbiAgICAgKi8gICAgc2tpcERlbGF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxheUVsYXBzZWQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuY2VscyB0aGUgb3BlcmF0aW9uIGlmIGl0IGhhc24ndCBhbHJlYWR5IGJlZW4gZXhlY3V0ZWQgb3IgY2FuY2VsZWQuIFRoZVxuICAgICAqIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZC5cbiAgICAgKlxuICAgICAqIEFzIGxvbmcgYXMgdGhlIG9wZXJhdGlvbiBoYXMgbm90IHlldCBiZWVuIHJ1biwgY2FsbGluZyBjYW5jZWwoKSBwcm92aWRlcyBhXG4gICAgICogZ3VhcmFudGVlIHRoYXQgdGhlIG9wZXJhdGlvbiB3aWxsIG5vdCBiZSBydW4uXG4gICAgICovICAgIGNhbmNlbChlKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMudGltZXJIYW5kbGUgJiYgKHRoaXMuY2xlYXJUaW1lb3V0KCksIHRoaXMuZGVmZXJyZWQucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcih2LkNBTkNFTExFRCwgXCJPcGVyYXRpb24gY2FuY2VsbGVkXCIgKyAoZSA/IFwiOiBcIiArIGUgOiBcIlwiKSkpKTtcbiAgICB9XG4gICAgaGFuZGxlRGVsYXlFbGFwc2VkKCkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gbnVsbCAhPT0gdGhpcy50aW1lckhhbmRsZSA/ICh0aGlzLmNsZWFyVGltZW91dCgpLCBcbiAgICAgICAgdGhpcy5vcCgpLnRoZW4oKGUgPT4gdGhpcy5kZWZlcnJlZC5yZXNvbHZlKGUpKSkpIDogUHJvbWlzZS5yZXNvbHZlKCkpKTtcbiAgICB9XG4gICAgY2xlYXJUaW1lb3V0KCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlICYmICh0aGlzLnJlbW92YWxDYWxsYmFjayh0aGlzKSwgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJIYW5kbGUpLCBcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmlyZXN0b3JlRXJyb3IgdGhhdCBjYW4gYmUgc3VyZmFjZWQgdG8gdGhlIHVzZXIgaWYgdGhlIHByb3ZpZGVkXG4gKiBlcnJvciBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiBSZS10aHJvd3MgdGhlIGVycm9yIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCB0KSB7XG4gICAgaWYgKF9fUFJJVkFURV9sb2dFcnJvcihcIkFzeW5jUXVldWVcIiwgYCR7dH06ICR7ZX1gKSwgX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgcmV0dXJuIG5ldyBGaXJlc3RvcmVFcnJvcih2LlVOQVZBSUxBQkxFLCBgJHt0fTogJHtlfWApO1xuICAgIHRocm93IGU7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50U2V0IGlzIGFuIGltbXV0YWJsZSAoY29weS1vbi13cml0ZSkgY29sbGVjdGlvbiB0aGF0IGhvbGRzIGRvY3VtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLiBXZSBhbHdheXMgYWRkIGEgZG9jdW1lbnQga2V5XG4gKiBjb21wYXJhdG9yIG9uIHRvcCBvZiB3aGF0IGlzIHByb3ZpZGVkIHRvIGd1YXJhbnRlZSBkb2N1bWVudCBlcXVhbGl0eSBiYXNlZCBvblxuICogdGhlIGtleS5cbiAqLyBjbGFzcyBEb2N1bWVudFNldCB7XG4gICAgLyoqIFRoZSBkZWZhdWx0IG9yZGVyaW5nIGlzIGJ5IGtleSBpZiB0aGUgY29tcGFyYXRvciBpcyBvbWl0dGVkICovXG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICAvLyBXZSBhcmUgYWRkaW5nIGRvY3VtZW50IGtleSBjb21wYXJhdG9yIHRvIHRoZSBlbmQgYXMgaXQncyB0aGUgb25seVxuICAgICAgICAvLyBndWFyYW50ZWVkIHVuaXF1ZSBwcm9wZXJ0eSBvZiBhIGRvY3VtZW50LlxuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSBlID8gKHQsIG4pID0+IGUodCwgbikgfHwgRG9jdW1lbnRLZXkuY29tcGFyYXRvcih0LmtleSwgbi5rZXkpIDogKGUsIHQpID0+IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KSwgXG4gICAgICAgIHRoaXMua2V5ZWRNYXAgPSBkb2N1bWVudE1hcCgpLCB0aGlzLnNvcnRlZFNldCA9IG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBlbXB0eSBjb3B5IG9mIHRoZSBleGlzdGluZyBEb2N1bWVudFNldCwgdXNpbmcgdGhlIHNhbWVcbiAgICAgKiBjb21wYXJhdG9yLlxuICAgICAqLyAgICBzdGF0aWMgZW1wdHlTZXQoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50U2V0KGUuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9IHRoaXMua2V5ZWRNYXAuZ2V0KGUpO1xuICAgIH1cbiAgICBnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXllZE1hcC5nZXQoZSk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5tYXhLZXkoKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGVkU2V0LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIHByb3ZpZGVkIGtleSBpbiB0aGUgZG9jdW1lbnQgc2V0LCBvciAtMSBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBrZXkgaXMgbm90IHByZXNlbnQgaW4gdGhlIHNldDtcbiAgICAgKi8gICAgaW5kZXhPZihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmtleWVkTWFwLmdldChlKTtcbiAgICAgICAgcmV0dXJuIHQgPyB0aGlzLnNvcnRlZFNldC5pbmRleE9mKHQpIDogLTE7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQuc2l6ZTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIGRvY3VtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2goZSkge1xuICAgICAgICB0aGlzLnNvcnRlZFNldC5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUodCksICExKSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGEgZG9jdW1lbnQgd2l0aCB0aGUgc2FtZSBrZXkgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgLy8gRmlyc3QgcmVtb3ZlIHRoZSBlbGVtZW50IGlmIHdlIGhhdmUgaXQuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRlbGV0ZShlLmtleSk7XG4gICAgICAgIHJldHVybiB0LmNvcHkodC5rZXllZE1hcC5pbnNlcnQoZS5rZXksIGUpLCB0LnNvcnRlZFNldC5pbnNlcnQoZSwgbnVsbCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhIGRvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCA/IHRoaXMuY29weSh0aGlzLmtleWVkTWFwLnJlbW92ZShlKSwgdGhpcy5zb3J0ZWRTZXQucmVtb3ZlKHQpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRG9jdW1lbnRTZXQpKSByZXR1cm4gITE7XG4gICAgICAgIGlmICh0aGlzLnNpemUgIT09IGUuc2l6ZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5zb3J0ZWRTZXQuZ2V0SXRlcmF0b3IoKSwgbiA9IGUuc29ydGVkU2V0LmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3QuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmdldE5leHQoKS5rZXksIHIgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoIWUuaXNFcXVhbChyKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlLnB1c2godC50b1N0cmluZygpKTtcbiAgICAgICAgfSkpLCAwID09PSBlLmxlbmd0aCA/IFwiRG9jdW1lbnRTZXQgKClcIiA6IFwiRG9jdW1lbnRTZXQgKFxcbiAgXCIgKyBlLmpvaW4oXCIgIFxcblwiKSArIFwiXFxuKVwiO1xuICAgIH1cbiAgICBjb3B5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBEb2N1bWVudFNldDtcbiAgICAgICAgcmV0dXJuIG4uY29tcGFyYXRvciA9IHRoaXMuY29tcGFyYXRvciwgbi5rZXllZE1hcCA9IGUsIG4uc29ydGVkU2V0ID0gdCwgbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50Q2hhbmdlU2V0IGtlZXBzIHRyYWNrIG9mIGEgc2V0IG9mIGNoYW5nZXMgdG8gZG9jcyBpbiBhIHF1ZXJ5LCBtZXJnaW5nXG4gKiBkdXBsaWNhdGUgZXZlbnRzIGZvciB0aGUgc2FtZSBkb2MuXG4gKi8gY2xhc3MgX19QUklWQVRFX0RvY3VtZW50Q2hhbmdlU2V0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5GXyA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIHRyYWNrKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZG9jLmtleSwgbiA9IHRoaXMuRl8uZ2V0KHQpO1xuICAgICAgICBuID8gXG4gICAgICAgIC8vIE1lcmdlIHRoZSBuZXcgY2hhbmdlIHdpdGggdGhlIGV4aXN0aW5nIGNoYW5nZS5cbiAgICAgICAgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovICE9PSBlLnR5cGUgJiYgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovID09PSBuLnR5cGUgPyB0aGlzLkZfID0gdGhpcy5GXy5pbnNlcnQodCwgZSkgOiAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gPT09IGUudHlwZSAmJiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gbi50eXBlID8gdGhpcy5GXyA9IHRoaXMuRl8uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IG4udHlwZSxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IGUudHlwZSAmJiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRl8gPSB0aGlzLkZfLmluc2VydCh0LCB7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBlLmRvY1xuICAgICAgICB9KSA6IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA9PT0gZS50eXBlICYmIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gbi50eXBlID8gdGhpcy5GXyA9IHRoaXMuRl8uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICBkb2M6IGUuZG9jXG4gICAgICAgIH0pIDogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gPT09IGUudHlwZSAmJiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuRl8gPSB0aGlzLkZfLnJlbW92ZSh0KSA6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBlLnR5cGUgJiYgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovID09PSBuLnR5cGUgPyB0aGlzLkZfID0gdGhpcy5GXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBuLmRvY1xuICAgICAgICB9KSA6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gZS50eXBlICYmIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBuLnR5cGUgPyB0aGlzLkZfID0gdGhpcy5GXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiBcbiAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyB0aGVzZSBjYXNlcywgd2hpY2ggZG9uJ3QgbWFrZSBzZW5zZTpcbiAgICAgICAgLy8gQWRkZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPlJlbW92ZWRcbiAgICAgICAgLy8gTW9kaWZpZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPk1vZGlmaWVkXG4gICAgICAgIC8vIE1ldGFkYXRhLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5NZXRhZGF0YVxuICAgICAgICBmYWlsKCkgOiB0aGlzLkZfID0gdGhpcy5GXy5pbnNlcnQodCwgZSk7XG4gICAgfVxuICAgIE1fKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLkZfLmlub3JkZXJUcmF2ZXJzYWwoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBlLnB1c2gobik7XG4gICAgICAgIH0pKSwgZTtcbiAgICB9XG59XG5cbmNsYXNzIFZpZXdTbmFwc2hvdCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSkge1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gZSwgdGhpcy5kb2NzID0gdCwgdGhpcy5vbGREb2NzID0gbiwgdGhpcy5kb2NDaGFuZ2VzID0gciwgdGhpcy5tdXRhdGVkS2V5cyA9IGksIFxuICAgICAgICB0aGlzLmZyb21DYWNoZSA9IHMsIHRoaXMuc3luY1N0YXRlQ2hhbmdlZCA9IG8sIHRoaXMuZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXMgPSBfLCBcbiAgICAgICAgdGhpcy5oYXNDYWNoZWRSZXN1bHRzID0gYTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSB2aWV3IHNuYXBzaG90IGFzIGlmIGFsbCBkb2N1bWVudHMgaW4gdGhlIHNuYXBzaG90IHdlcmUgYWRkZWQuICovICAgIHN0YXRpYyBmcm9tSW5pdGlhbERvY3VtZW50cyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBzLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpLCBuZXcgVmlld1NuYXBzaG90KGUsIHQsIERvY3VtZW50U2V0LmVtcHR5U2V0KHQpLCBzLCBuLCByLCBcbiAgICAgICAgLyogc3luY1N0YXRlQ2hhbmdlZD0gKi8gITAsIFxuICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsIGkpO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLm11dGF0ZWRLZXlzLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIGlmICghKHRoaXMuZnJvbUNhY2hlID09PSBlLmZyb21DYWNoZSAmJiB0aGlzLmhhc0NhY2hlZFJlc3VsdHMgPT09IGUuaGFzQ2FjaGVkUmVzdWx0cyAmJiB0aGlzLnN5bmNTdGF0ZUNoYW5nZWQgPT09IGUuc3luY1N0YXRlQ2hhbmdlZCAmJiB0aGlzLm11dGF0ZWRLZXlzLmlzRXF1YWwoZS5tdXRhdGVkS2V5cykgJiYgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKHRoaXMucXVlcnksIGUucXVlcnkpICYmIHRoaXMuZG9jcy5pc0VxdWFsKGUuZG9jcykgJiYgdGhpcy5vbGREb2NzLmlzRXF1YWwoZS5vbGREb2NzKSkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZG9jQ2hhbmdlcywgbiA9IGUuZG9jQ2hhbmdlcztcbiAgICAgICAgaWYgKHQubGVuZ3RoICE9PSBuLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIGlmICh0W2VdLnR5cGUgIT09IG5bZV0udHlwZSB8fCAhdFtlXS5kb2MuaXNFcXVhbChuW2VdLmRvYykpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSG9sZHMgdGhlIGxpc3RlbmVycyBhbmQgdGhlIGxhc3QgcmVjZWl2ZWQgVmlld1NuYXBzaG90IGZvciBhIHF1ZXJ5IGJlaW5nXG4gKiB0cmFja2VkIGJ5IEV2ZW50TWFuYWdlci5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcnNJbmZvIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy54XyA9IHZvaWQgMCwgdGhpcy5saXN0ZW5lcnMgPSBbXTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9FdmVudE1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5xdWVyaWVzID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlRdWVyeShlKSksIF9fUFJJVkFURV9xdWVyeUVxdWFscyksIFxuICAgICAgICB0aGlzLm9ubGluZVN0YXRlID0gXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyAsIHRoaXMuT18gPSBuZXcgU2V0O1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlckxpc3RlbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSB0LnF1ZXJ5O1xuICAgIGxldCBpID0gITEsIHMgPSBuLnF1ZXJpZXMuZ2V0KHIpO1xuICAgIGlmIChzIHx8IChpID0gITAsIHMgPSBuZXcgX19QUklWQVRFX1F1ZXJ5TGlzdGVuZXJzSW5mbyksIGkpIHRyeSB7XG4gICAgICAgIHMueF8gPSBhd2FpdCBuLm9uTGlzdGVuKHIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIGBJbml0aWFsaXphdGlvbiBvZiBxdWVyeSAnJHtfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodC5xdWVyeSl9JyBmYWlsZWRgKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgdC5vbkVycm9yKG4pO1xuICAgIH1cbiAgICBpZiAobi5xdWVyaWVzLnNldChyLCBzKSwgcy5saXN0ZW5lcnMucHVzaCh0KSwgXG4gICAgLy8gUnVuIGdsb2JhbCBzbmFwc2hvdCBsaXN0ZW5lcnMgaWYgYSBjb25zaXN0ZW50IHNuYXBzaG90IGhhcyBiZWVuIGVtaXR0ZWQuXG4gICAgdC5OXyhuLm9ubGluZVN0YXRlKSwgcy54Xykge1xuICAgICAgICB0LkJfKHMueF8pICYmIF9fUFJJVkFURV9yYWlzZVNuYXBzaG90c0luU3luY0V2ZW50KG4pO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlclVubGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IHQucXVlcnk7XG4gICAgbGV0IGkgPSAhMTtcbiAgICBjb25zdCBzID0gbi5xdWVyaWVzLmdldChyKTtcbiAgICBpZiAocykge1xuICAgICAgICBjb25zdCBlID0gcy5saXN0ZW5lcnMuaW5kZXhPZih0KTtcbiAgICAgICAgZSA+PSAwICYmIChzLmxpc3RlbmVycy5zcGxpY2UoZSwgMSksIGkgPSAwID09PSBzLmxpc3RlbmVycy5sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAoaSkgcmV0dXJuIG4ucXVlcmllcy5kZWxldGUociksIG4ub25Vbmxpc3RlbihyKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCByID0gITE7XG4gICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgY29uc3QgdCA9IGUucXVlcnksIGkgPSBuLnF1ZXJpZXMuZ2V0KHQpO1xuICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGkubGlzdGVuZXJzKSB0LkJfKGUpICYmIChyID0gITApO1xuICAgICAgICAgICAgaS54XyA9IGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgciAmJiBfX1BSSVZBVEVfcmFpc2VTbmFwc2hvdHNJblN5bmNFdmVudChuKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hFcnJvcihlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSByLnF1ZXJpZXMuZ2V0KHQpO1xuICAgIGlmIChpKSBmb3IgKGNvbnN0IGUgb2YgaS5saXN0ZW5lcnMpIGUub25FcnJvcihuKTtcbiAgICAvLyBSZW1vdmUgYWxsIGxpc3RlbmVycy4gTk9URTogV2UgZG9uJ3QgbmVlZCB0byBjYWxsIHN5bmNFbmdpbmUudW5saXN0ZW4oKVxuICAgIC8vIGFmdGVyIGFuIGVycm9yLlxuICAgICAgICByLnF1ZXJpZXMuZGVsZXRlKHQpO1xufVxuXG4vLyBDYWxsIGFsbCBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIHRoYXQgaGF2ZSBiZWVuIHNldC5cbmZ1bmN0aW9uIF9fUFJJVkFURV9yYWlzZVNuYXBzaG90c0luU3luY0V2ZW50KGUpIHtcbiAgICBlLk9fLmZvckVhY2goKGUgPT4ge1xuICAgICAgICBlLm5leHQoKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUXVlcnlMaXN0ZW5lciB0YWtlcyBhIHNlcmllcyBvZiBpbnRlcm5hbCB2aWV3IHNuYXBzaG90cyBhbmQgZGV0ZXJtaW5lc1xuICogd2hlbiB0byByYWlzZSB0aGUgZXZlbnQuXG4gKlxuICogSXQgdXNlcyBhbiBPYnNlcnZlciB0byBkaXNwYXRjaCBldmVudHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1F1ZXJ5TGlzdGVuZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IGUsIHRoaXMuTF8gPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWwgc25hcHNob3RzIChlLmcuIGZyb20gY2FjaGUpIG1heSBub3QgYmUgcHJvcGFnYXRlZCB0byB0aGUgd3JhcHBlZFxuICAgICAgICAgKiBvYnNlcnZlci4gVGhpcyBmbGFnIGlzIHNldCB0byB0cnVlIG9uY2Ugd2UndmUgYWN0dWFsbHkgcmFpc2VkIGFuIGV2ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5rXyA9ICExLCB0aGlzLnFfID0gbnVsbCwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5vcHRpb25zID0gbiB8fCB7fTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyB0aGUgbmV3IFZpZXdTbmFwc2hvdCB0byB0aGlzIGxpc3RlbmVyLCByYWlzaW5nIGEgdXNlci1mYWNpbmcgZXZlbnRcbiAgICAgKiBpZiBhcHBsaWNhYmxlIChkZXBlbmRpbmcgb24gd2hhdCBjaGFuZ2VkLCB3aGV0aGVyIHRoZSB1c2VyIGhhcyBvcHRlZCBpbnRvXG4gICAgICogbWV0YWRhdGEtb25seSBjaGFuZ2VzLCBldGMuKS4gUmV0dXJucyB0cnVlIGlmIGEgdXNlci1mYWNpbmcgZXZlbnQgd2FzXG4gICAgICogaW5kZWVkIHJhaXNlZC5cbiAgICAgKi8gICAgQl8oZSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIG1ldGFkYXRhIG9ubHkgY2hhbmdlcy5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBlLmRvY0NoYW5nZXMpIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyAhPT0gbi50eXBlICYmIHQucHVzaChuKTtcbiAgICAgICAgICAgIGUgPSBuZXcgVmlld1NuYXBzaG90KGUucXVlcnksIGUuZG9jcywgZS5vbGREb2NzLCB0LCBlLm11dGF0ZWRLZXlzLCBlLmZyb21DYWNoZSwgZS5zeW5jU3RhdGVDaGFuZ2VkLCBcbiAgICAgICAgICAgIC8qIGV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzPSAqLyAhMCwgZS5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5rXyA/IHRoaXMuUV8oZSkgJiYgKHRoaXMuTF8ubmV4dChlKSwgdCA9ICEwKSA6IHRoaXMuS18oZSwgdGhpcy5vbmxpbmVTdGF0ZSkgJiYgKHRoaXMuVV8oZSksIFxuICAgICAgICB0ID0gITApLCB0aGlzLnFfID0gZSwgdDtcbiAgICB9XG4gICAgb25FcnJvcihlKSB7XG4gICAgICAgIHRoaXMuTF8uZXJyb3IoZSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgYSBzbmFwc2hvdCB3YXMgcmFpc2VkLiAqLyAgICBOXyhlKSB7XG4gICAgICAgIHRoaXMub25saW5lU3RhdGUgPSBlO1xuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5xXyAmJiAhdGhpcy5rXyAmJiB0aGlzLktfKHRoaXMucV8sIGUpICYmICh0aGlzLlVfKHRoaXMucV8pLCB0ID0gITApLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgS18oZSwgdCkge1xuICAgICAgICAvLyBBbHdheXMgcmFpc2UgdGhlIGZpcnN0IGV2ZW50IHdoZW4gd2UncmUgc3luY2VkXG4gICAgICAgIGlmICghZS5mcm9tQ2FjaGUpIHJldHVybiAhMDtcbiAgICAgICAgLy8gTk9URTogV2UgY29uc2lkZXIgT25saW5lU3RhdGUuVW5rbm93biBhcyBvbmxpbmUgKGl0IHNob3VsZCBiZWNvbWUgT2ZmbGluZVxuICAgICAgICAvLyBvciBPbmxpbmUgaWYgd2Ugd2FpdCBsb25nIGVub3VnaCkuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gIT09IHQ7XG4gICAgICAgIC8vIERvbid0IHJhaXNlIHRoZSBldmVudCBpZiB3ZSdyZSBvbmxpbmUsIGFyZW4ndCBzeW5jZWQgeWV0IChjaGVja2VkXG4gICAgICAgIC8vIGFib3ZlKSBhbmQgYXJlIHdhaXRpbmcgZm9yIGEgc3luYy5cbiAgICAgICAgICAgICAgICByZXR1cm4gKCF0aGlzLm9wdGlvbnMuV18gfHwgIW4pICYmICghZS5kb2NzLmlzRW1wdHkoKSB8fCBlLmhhc0NhY2hlZFJlc3VsdHMgfHwgXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyA9PT0gdCk7XG4gICAgICAgIC8vIFJhaXNlIGRhdGEgZnJvbSBjYWNoZSBpZiB3ZSBoYXZlIGFueSBkb2N1bWVudHMsIGhhdmUgY2FjaGVkIHJlc3VsdHMgYmVmb3JlLFxuICAgICAgICAvLyBvciB3ZSBhcmUgb2ZmbGluZS5cbiAgICAgICAgfVxuICAgIFFfKGUpIHtcbiAgICAgICAgLy8gV2UgZG9uJ3QgbmVlZCB0byBoYW5kbGUgaW5jbHVkZURvY3VtZW50TWV0YWRhdGFDaGFuZ2VzIGhlcmUgYmVjYXVzZVxuICAgICAgICAvLyB0aGUgTWV0YWRhdGEgb25seSBjaGFuZ2VzIGhhdmUgYWxyZWFkeSBiZWVuIHN0cmlwcGVkIG91dCBpZiBuZWVkZWQuXG4gICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgdGhlIG9ubHkgY2hhbmdlcyB3ZSB3aWxsIHNlZSBhcmUgdGhlIG9uZXMgd2Ugc2hvdWxkXG4gICAgICAgIC8vIHByb3BhZ2F0ZS5cbiAgICAgICAgaWYgKGUuZG9jQ2hhbmdlcy5sZW5ndGggPiAwKSByZXR1cm4gITA7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnFfICYmIHRoaXMucV8uaGFzUGVuZGluZ1dyaXRlcyAhPT0gZS5oYXNQZW5kaW5nV3JpdGVzO1xuICAgICAgICByZXR1cm4gISghZS5zeW5jU3RhdGVDaGFuZ2VkICYmICF0KSAmJiAhMCA9PT0gdGhpcy5vcHRpb25zLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXM7XG4gICAgICAgIC8vIEdlbmVyYWxseSB3ZSBzaG91bGQgaGF2ZSBoaXQgb25lIG9mIHRoZSBjYXNlcyBhYm92ZSwgYnV0IGl0J3MgcG9zc2libGVcbiAgICAgICAgLy8gdG8gZ2V0IGhlcmUgaWYgdGhlcmUgd2VyZSBvbmx5IG1ldGFkYXRhIGRvY0NoYW5nZXMgYW5kIHRoZXkgZ290XG4gICAgICAgIC8vIHN0cmlwcGVkIG91dC5cbiAgICAgICAgfVxuICAgIFVfKGUpIHtcbiAgICAgICAgZSA9IFZpZXdTbmFwc2hvdC5mcm9tSW5pdGlhbERvY3VtZW50cyhlLnF1ZXJ5LCBlLmRvY3MsIGUubXV0YXRlZEtleXMsIGUuZnJvbUNhY2hlLCBlLmhhc0NhY2hlZFJlc3VsdHMpLCBcbiAgICAgICAgdGhpcy5rXyA9ICEwLCB0aGlzLkxfLm5leHQoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNvbXBsZXRlIGVsZW1lbnQgaW4gdGhlIGJ1bmRsZSBzdHJlYW0sIHRvZ2V0aGVyIHdpdGggdGhlIGJ5dGUgbGVuZ3RoIGl0XG4gKiBvY2N1cGllcyBpbiB0aGUgc3RyZWFtLlxuICovIGNsYXNzIF9fUFJJVkFURV9TaXplZEJ1bmRsZUVsZW1lbnQge1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8vIEhvdyBtYW55IGJ5dGVzIHRoaXMgZWxlbWVudCB0YWtlcyB0byBzdG9yZSBpbiB0aGUgYnVuZGxlLlxuICAgIHQpIHtcbiAgICAgICAgdGhpcy5HXyA9IGUsIHRoaXMuYnl0ZUxlbmd0aCA9IHQ7XG4gICAgfVxuICAgIHpfKCkge1xuICAgICAgICByZXR1cm4gXCJtZXRhZGF0YVwiIGluIHRoaXMuR187XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBIZWxwZXIgdG8gY29udmVydCBvYmplY3RzIGZyb20gYnVuZGxlcyB0byBtb2RlbCBvYmplY3RzIGluIHRoZSBTREsuXG4gKi8gY2xhc3MgX19QUklWQVRFX0J1bmRsZUNvbnZlcnRlckltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gZTtcbiAgICB9XG4gICAgb3MoZSkge1xuICAgICAgICByZXR1cm4gZnJvbU5hbWUodGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBCdW5kbGVEb2N1bWVudCB0byBhIE11dGFibGVEb2N1bWVudC5cbiAgICAgKi8gICAgX3MoZSkge1xuICAgICAgICByZXR1cm4gZS5tZXRhZGF0YS5leGlzdHMgPyBfX1BSSVZBVEVfZnJvbURvY3VtZW50KHRoaXMuc2VyaWFsaXplciwgZS5kb2N1bWVudCwgITEpIDogTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQodGhpcy5vcyhlLm1ldGFkYXRhLm5hbWUpLCB0aGlzLnVzKGUubWV0YWRhdGEucmVhZFRpbWUpKTtcbiAgICB9XG4gICAgdXMoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2Zyb21WZXJzaW9uKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGNsYXNzIHRvIHByb2Nlc3MgdGhlIGVsZW1lbnRzIGZyb20gYSBidW5kbGUsIGxvYWQgdGhlbSBpbnRvIGxvY2FsXG4gKiBzdG9yYWdlIGFuZCBwcm92aWRlIHByb2dyZXNzIHVwZGF0ZSB3aGlsZSBsb2FkaW5nLlxuICovIGNsYXNzIF9fUFJJVkFURV9CdW5kbGVMb2FkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5qXyA9IGUsIHRoaXMubG9jYWxTdG9yZSA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4sIFxuICAgICAgICAvKiogQmF0Y2hlZCBxdWVyaWVzIHRvIGJlIHNhdmVkIGludG8gc3RvcmFnZSAqL1xuICAgICAgICB0aGlzLnF1ZXJpZXMgPSBbXSwgXG4gICAgICAgIC8qKiBCYXRjaGVkIGRvY3VtZW50cyB0byBiZSBzYXZlZCBpbnRvIHN0b3JhZ2UgKi9cbiAgICAgICAgdGhpcy5kb2N1bWVudHMgPSBbXSwgXG4gICAgICAgIC8qKiBUaGUgY29sbGVjdGlvbiBncm91cHMgYWZmZWN0ZWQgYnkgdGhpcyBidW5kbGUuICovXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbkdyb3VwcyA9IG5ldyBTZXQsIHRoaXMucHJvZ3Jlc3MgPSBfX1BSSVZBVEVfYnVuZGxlSW5pdGlhbFByb2dyZXNzKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGFuIGVsZW1lbnQgZnJvbSB0aGUgYnVuZGxlIHRvIHRoZSBsb2FkZXIuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGEgbmV3IHByb2dyZXNzIGlmIGFkZGluZyB0aGUgZWxlbWVudCBsZWFkcyB0byBhIG5ldyBwcm9ncmVzcyxcbiAgICAgKiBvdGhlcndpc2UgcmV0dXJucyBudWxsLlxuICAgICAqLyAgICBIXyhlKSB7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3MuYnl0ZXNMb2FkZWQgKz0gZS5ieXRlTGVuZ3RoO1xuICAgICAgICBsZXQgdCA9IHRoaXMucHJvZ3Jlc3MuZG9jdW1lbnRzTG9hZGVkO1xuICAgICAgICBpZiAoZS5HXy5uYW1lZFF1ZXJ5KSB0aGlzLnF1ZXJpZXMucHVzaChlLkdfLm5hbWVkUXVlcnkpOyBlbHNlIGlmIChlLkdfLmRvY3VtZW50TWV0YWRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBlLkdfLmRvY3VtZW50TWV0YWRhdGFcbiAgICAgICAgICAgIH0pLCBlLkdfLmRvY3VtZW50TWV0YWRhdGEuZXhpc3RzIHx8ICsrdDtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhlLkdfLmRvY3VtZW50TWV0YWRhdGEubmFtZSk7XG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb25Hcm91cHMuYWRkKG4uZ2V0KG4ubGVuZ3RoIC0gMikpO1xuICAgICAgICB9IGVsc2UgZS5HXy5kb2N1bWVudCAmJiAodGhpcy5kb2N1bWVudHNbdGhpcy5kb2N1bWVudHMubGVuZ3RoIC0gMV0uZG9jdW1lbnQgPSBlLkdfLmRvY3VtZW50LCBcbiAgICAgICAgKyt0KTtcbiAgICAgICAgcmV0dXJuIHQgIT09IHRoaXMucHJvZ3Jlc3MuZG9jdW1lbnRzTG9hZGVkID8gKHRoaXMucHJvZ3Jlc3MuZG9jdW1lbnRzTG9hZGVkID0gdCwgXG4gICAgICAgIE9iamVjdC5hc3NpZ24oe30sIHRoaXMucHJvZ3Jlc3MpKSA6IG51bGw7XG4gICAgfVxuICAgIEpfKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBNYXAsIG4gPSBuZXcgX19QUklWQVRFX0J1bmRsZUNvbnZlcnRlckltcGwodGhpcy5zZXJpYWxpemVyKTtcbiAgICAgICAgZm9yIChjb25zdCByIG9mIGUpIGlmIChyLm1ldGFkYXRhLnF1ZXJpZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuLm9zKHIubWV0YWRhdGEubmFtZSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2Ygci5tZXRhZGF0YS5xdWVyaWVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9ICh0LmdldChuKSB8fCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkuYWRkKGUpO1xuICAgICAgICAgICAgICAgIHQuc2V0KG4sIHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIHByb2dyZXNzIHRvICdTdWNjZXNzJyBhbmQgcmV0dXJuIHRoZSB1cGRhdGVkIHByb2dyZXNzLlxuICAgICAqLyAgICBhc3luYyBjb21wbGV0ZSgpIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlCdW5kbGVkRG9jdW1lbnRzKHRoaXMubG9jYWxTdG9yZSwgbmV3IF9fUFJJVkFURV9CdW5kbGVDb252ZXJ0ZXJJbXBsKHRoaXMuc2VyaWFsaXplciksIHRoaXMuZG9jdW1lbnRzLCB0aGlzLmpfLmlkKSwgdCA9IHRoaXMuSl8odGhpcy5kb2N1bWVudHMpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5xdWVyaWVzKSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVNhdmVOYW1lZFF1ZXJ5KHRoaXMubG9jYWxTdG9yZSwgZSwgdC5nZXQoZS5uYW1lKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2dyZXNzLnRhc2tTdGF0ZSA9IFwiU3VjY2Vzc1wiLCB7XG4gICAgICAgICAgICBwcm9ncmVzczogdGhpcy5wcm9ncmVzcyxcbiAgICAgICAgICAgIFlfOiB0aGlzLmNvbGxlY3Rpb25Hcm91cHMsXG4gICAgICAgICAgICBaXzogZVxuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHJlcHJlc2VudGluZyB0aGUgaW5pdGlhbCBwcm9ncmVzcyBvZlxuICogbG9hZGluZyBhIGJ1bmRsZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYnVuZGxlSW5pdGlhbFByb2dyZXNzKGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0YXNrU3RhdGU6IFwiUnVubmluZ1wiLFxuICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IDAsXG4gICAgICAgIGJ5dGVzTG9hZGVkOiAwLFxuICAgICAgICB0b3RhbERvY3VtZW50czogZS50b3RhbERvY3VtZW50cyxcbiAgICAgICAgdG90YWxCeXRlczogZS50b3RhbEJ5dGVzXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHJlcHJlc2VudGluZyB0aGUgcHJvZ3Jlc3MgdGhhdCB0aGUgbG9hZGluZ1xuICogaGFzIHN1Y2NlZWRlZC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9BZGRlZExpbWJvRG9jdW1lbnQge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX1JlbW92ZWRMaW1ib0RvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2V5ID0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogVmlldyBpcyByZXNwb25zaWJsZSBmb3IgY29tcHV0aW5nIHRoZSBmaW5hbCBtZXJnZWQgdHJ1dGggb2Ygd2hhdCBkb2NzIGFyZSBpblxuICogYSBxdWVyeS4gSXQgZ2V0cyBub3RpZmllZCBvZiBsb2NhbCBhbmQgcmVtb3RlIGNoYW5nZXMgdG8gZG9jcywgYW5kIGFwcGxpZXNcbiAqIHRoZSBxdWVyeSBmaWx0ZXJzIGFuZCBsaW1pdHMgdG8gZGV0ZXJtaW5lIHRoZSBtb3N0IGNvcnJlY3QgcG9zc2libGUgcmVzdWx0cy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfVmlldyB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLyoqIERvY3VtZW50cyBpbmNsdWRlZCBpbiB0aGUgcmVtb3RlIHRhcmdldCAqL1xuICAgIHQpIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IGUsIHRoaXMuWF8gPSB0LCB0aGlzLmVhID0gbnVsbCwgdGhpcy5oYXNDYWNoZWRSZXN1bHRzID0gITEsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBmbGFnIHdoZXRoZXIgdGhlIHZpZXcgaXMgY3VycmVudCB3aXRoIHRoZSBiYWNrZW5kLiBBIHZpZXcgaXMgY29uc2lkZXJlZFxuICAgICAgICAgKiBjdXJyZW50IGFmdGVyIGl0IGhhcyBzZWVuIHRoZSBjdXJyZW50IGZsYWcgZnJvbSB0aGUgYmFja2VuZCBhbmQgZGlkIG5vdFxuICAgICAgICAgKiBsb3NlIGNvbnNpc3RlbmN5IHdpdGhpbiB0aGUgd2F0Y2ggc3RyZWFtIChlLmcuIGJlY2F1c2Ugb2YgYW4gZXhpc3RlbmNlXG4gICAgICAgICAqIGZpbHRlciBtaXNtYXRjaCkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSAhMSwgXG4gICAgICAgIC8qKiBEb2N1bWVudHMgaW4gdGhlIHZpZXcgYnV0IG5vdCBpbiB0aGUgcmVtb3RlIHRhcmdldCAqL1xuICAgICAgICB0aGlzLnRhID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIFxuICAgICAgICAvKiogRG9jdW1lbnQgS2V5cyB0aGF0IGhhdmUgbG9jYWwgY2hhbmdlcyAqL1xuICAgICAgICB0aGlzLm11dGF0ZWRLZXlzID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIHRoaXMubmEgPSBfX1BSSVZBVEVfbmV3UXVlcnlDb21wYXJhdG9yKGUpLCBcbiAgICAgICAgdGhpcy5yYSA9IG5ldyBEb2N1bWVudFNldCh0aGlzLm5hKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiByZW1vdGUgZG9jdW1lbnRzIHRoYXQgdGhlIHNlcnZlciBoYXMgdG9sZCB1cyBiZWxvbmdzIHRvIHRoZSB0YXJnZXQgYXNzb2NpYXRlZCB3aXRoXG4gICAgICogdGhpcyB2aWV3LlxuICAgICAqLyAgICBnZXQgaWEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlhfO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGEgc2V0IG9mIGRvYyBjaGFuZ2VzLCBhcHBsaWVzIHRoZSBxdWVyeSBsaW1pdCwgYW5kIGNvbXB1dGVzXG4gICAgICogd2hhdCB0aGUgbmV3IHJlc3VsdHMgc2hvdWxkIGJlLCB3aGF0IHRoZSBjaGFuZ2VzIHdlcmUsIGFuZCB3aGV0aGVyIHdlIG1heVxuICAgICAqIG5lZWQgdG8gZ28gYmFjayB0byB0aGUgbG9jYWwgY2FjaGUgZm9yIG1vcmUgcmVzdWx0cy4gRG9lcyBub3QgbWFrZSBhbnlcbiAgICAgKiBjaGFuZ2VzIHRvIHRoZSB2aWV3LlxuICAgICAqIEBwYXJhbSBkb2NDaGFuZ2VzIC0gVGhlIGRvYyBjaGFuZ2VzIHRvIGFwcGx5IHRvIHRoaXMgdmlldy5cbiAgICAgKiBAcGFyYW0gcHJldmlvdXNDaGFuZ2VzIC0gSWYgdGhpcyBpcyBiZWluZyBjYWxsZWQgd2l0aCBhIHJlZmlsbCwgdGhlbiBzdGFydFxuICAgICAqICAgICAgICB3aXRoIHRoaXMgc2V0IG9mIGRvY3MgYW5kIGNoYW5nZXMgaW5zdGVhZCBvZiB0aGUgY3VycmVudCB2aWV3LlxuICAgICAqIEByZXR1cm5zIGEgbmV3IHNldCBvZiBkb2NzLCBjaGFuZ2VzLCBhbmQgcmVmaWxsIGZsYWcuXG4gICAgICovICAgIHNhKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQgPyB0Lm9hIDogbmV3IF9fUFJJVkFURV9Eb2N1bWVudENoYW5nZVNldCwgciA9IHQgPyB0LnJhIDogdGhpcy5yYTtcbiAgICAgICAgbGV0IGkgPSB0ID8gdC5tdXRhdGVkS2V5cyA6IHRoaXMubXV0YXRlZEtleXMsIHMgPSByLCBvID0gITE7XG4gICAgICAgIC8vIFRyYWNrIHRoZSBsYXN0IGRvYyBpbiBhIChmdWxsKSBsaW1pdC4gVGhpcyBpcyBuZWNlc3NhcnksIGJlY2F1c2Ugc29tZVxuICAgICAgICAvLyB1cGRhdGUgKGEgZGVsZXRlLCBvciBhbiB1cGRhdGUgbW92aW5nIGEgZG9jIHBhc3QgdGhlIG9sZCBsaW1pdCkgbWlnaHRcbiAgICAgICAgLy8gbWVhbiB0aGVyZSBpcyBzb21lIG90aGVyIGRvY3VtZW50IGluIHRoZSBsb2NhbCBjYWNoZSB0aGF0IGVpdGhlciBzaG91bGRcbiAgICAgICAgLy8gY29tZSAoMSkgYmV0d2VlbiB0aGUgb2xkIGxhc3QgbGltaXQgZG9jIGFuZCB0aGUgbmV3IGxhc3QgZG9jdW1lbnQsIGluIHRoZVxuICAgICAgICAvLyBjYXNlIG9mIHVwZGF0ZXMsIG9yICgyKSBhZnRlciB0aGUgbmV3IGxhc3QgZG9jdW1lbnQsIGluIHRoZSBjYXNlIG9mXG4gICAgICAgIC8vIGRlbGV0ZXMuIFNvIHdlIGtlZXAgdGhpcyBkb2MgYXQgdGhlIG9sZCBsaW1pdCB0byBjb21wYXJlIHRoZSB1cGRhdGVzIHRvLlxuICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBzaG91bGQgbmV2ZXIgZ2V0IHVzZWQgaW4gYSByZWZpbGwgKHdoZW4gcHJldmlvdXNDaGFuZ2VzIGlzXG4gICAgICAgIC8vIHNldCksIGJlY2F1c2UgdGhlcmUgd2lsbCBvbmx5IGJlIGFkZHMgLS0gbm8gZGVsZXRlcyBvciB1cGRhdGVzLlxuICAgICAgICBjb25zdCBfID0gXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSB0aGlzLnF1ZXJ5LmxpbWl0VHlwZSAmJiByLnNpemUgPT09IHRoaXMucXVlcnkubGltaXQgPyByLmxhc3QoKSA6IG51bGwsIGEgPSBcIkxcIiAvKiBMaW1pdFR5cGUuTGFzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgci5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gci5maXJzdCgpIDogbnVsbDtcbiAgICAgICAgLy8gRHJvcCBkb2N1bWVudHMgb3V0IHRvIG1lZXQgbGltaXQvbGltaXRUb0xhc3QgcmVxdWlyZW1lbnQuXG4gICAgICAgIGlmIChlLmlub3JkZXJUcmF2ZXJzYWwoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB1ID0gci5nZXQoZSksIGMgPSBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKHRoaXMucXVlcnksIHQpID8gdCA6IG51bGwsIGwgPSAhIXUgJiYgdGhpcy5tdXRhdGVkS2V5cy5oYXModS5rZXkpLCBoID0gISFjICYmIChjLmhhc0xvY2FsTXV0YXRpb25zIHx8IFxuICAgICAgICAgICAgLy8gV2Ugb25seSBjb25zaWRlciBjb21taXR0ZWQgbXV0YXRpb25zIGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlXG4gICAgICAgICAgICAvLyBtdXRhdGVkIGR1cmluZyB0aGUgbGlmZXRpbWUgb2YgdGhlIHZpZXcuXG4gICAgICAgICAgICB0aGlzLm11dGF0ZWRLZXlzLmhhcyhjLmtleSkgJiYgYy5oYXNDb21taXR0ZWRNdXRhdGlvbnMpO1xuICAgICAgICAgICAgbGV0IFAgPSAhMTtcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBjaGFuZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1ICYmIGMpIHtcbiAgICAgICAgICAgICAgICB1LmRhdGEuaXNFcXVhbChjLmRhdGEpID8gbCAhPT0gaCAmJiAobi50cmFjayh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyAsXG4gICAgICAgICAgICAgICAgICAgIGRvYzogY1xuICAgICAgICAgICAgICAgIH0pLCBQID0gITApIDogdGhpcy5fYSh1LCBjKSB8fCAobi50cmFjayh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyAsXG4gICAgICAgICAgICAgICAgICAgIGRvYzogY1xuICAgICAgICAgICAgICAgIH0pLCBQID0gITAsIChfICYmIHRoaXMubmEoYywgXykgPiAwIHx8IGEgJiYgdGhpcy5uYShjLCBhKSA8IDApICYmIChcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGRvYyBtb3ZlZCBmcm9tIGluc2lkZSB0aGUgbGltaXQgdG8gb3V0c2lkZSB0aGUgbGltaXQuXG4gICAgICAgICAgICAgICAgLy8gVGhhdCBtZWFucyB0aGVyZSBtYXkgYmUgc29tZSBvdGhlciBkb2MgaW4gdGhlIGxvY2FsIGNhY2hlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBzaG91bGQgYmUgaW5jbHVkZWQgaW5zdGVhZC5cbiAgICAgICAgICAgICAgICBvID0gITApKTtcbiAgICAgICAgICAgIH0gZWxzZSAhdSAmJiBjID8gKG4udHJhY2soe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiBjXG4gICAgICAgICAgICB9KSwgUCA9ICEwKSA6IHUgJiYgIWMgJiYgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgIHR5cGU6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovICxcbiAgICAgICAgICAgICAgICBkb2M6IHVcbiAgICAgICAgICAgIH0pLCBQID0gITAsIChfIHx8IGEpICYmIChcbiAgICAgICAgICAgIC8vIEEgZG9jIHdhcyByZW1vdmVkIGZyb20gYSBmdWxsIGxpbWl0IHF1ZXJ5LiBXZSdsbCBuZWVkIHRvXG4gICAgICAgICAgICAvLyByZXF1ZXJ5IGZyb20gdGhlIGxvY2FsIGNhY2hlIHRvIHNlZSBpZiB3ZSBrbm93IGFib3V0IHNvbWUgb3RoZXJcbiAgICAgICAgICAgIC8vIGRvYyB0aGF0IHNob3VsZCBiZSBpbiB0aGUgcmVzdWx0cy5cbiAgICAgICAgICAgIG8gPSAhMCkpO1xuICAgICAgICAgICAgUCAmJiAoYyA/IChzID0gcy5hZGQoYyksIGkgPSBoID8gaS5hZGQoZSkgOiBpLmRlbGV0ZShlKSkgOiAocyA9IHMuZGVsZXRlKGUpLCBpID0gaS5kZWxldGUoZSkpKTtcbiAgICAgICAgfSkpLCBudWxsICE9PSB0aGlzLnF1ZXJ5LmxpbWl0KSBmb3IgKDtzLnNpemUgPiB0aGlzLnF1ZXJ5LmxpbWl0OyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gPT09IHRoaXMucXVlcnkubGltaXRUeXBlID8gcy5sYXN0KCkgOiBzLmZpcnN0KCk7XG4gICAgICAgICAgICBzID0gcy5kZWxldGUoZS5rZXkpLCBpID0gaS5kZWxldGUoZS5rZXkpLCBuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmE6IHMsXG4gICAgICAgICAgICBvYTogbixcbiAgICAgICAgICAgIHppOiBvLFxuICAgICAgICAgICAgbXV0YXRlZEtleXM6IGlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgX2EoZSwgdCkge1xuICAgICAgICAvLyBXZSBzdXBwcmVzcyB0aGUgaW5pdGlhbCBjaGFuZ2UgZXZlbnQgZm9yIGRvY3VtZW50cyB0aGF0IHdlcmUgbW9kaWZpZWQgYXNcbiAgICAgICAgLy8gcGFydCBvZiBhIHdyaXRlIGFja25vd2xlZGdtZW50IChlLmcuIHdoZW4gdGhlIHZhbHVlIG9mIGEgc2VydmVyIHRyYW5zZm9ybVxuICAgICAgICAvLyBpcyBhcHBsaWVkKSBhcyBXYXRjaCB3aWxsIHNlbmQgdXMgdGhlIHNhbWUgZG9jdW1lbnQgYWdhaW4uXG4gICAgICAgIC8vIEJ5IHN1cHByZXNzaW5nIHRoZSBldmVudCwgd2Ugb25seSByYWlzZSB0d28gdXNlciB2aXNpYmxlIGV2ZW50cyAob25lIHdpdGhcbiAgICAgICAgLy8gYGhhc1BlbmRpbmdXcml0ZXNgIGFuZCB0aGUgZmluYWwgc3RhdGUgb2YgdGhlIGRvY3VtZW50KSBpbnN0ZWFkIG9mIHRocmVlXG4gICAgICAgIC8vIChvbmUgd2l0aCBgaGFzUGVuZGluZ1dyaXRlc2AsIHRoZSBtb2RpZmllZCBkb2N1bWVudCB3aXRoXG4gICAgICAgIC8vIGBoYXNQZW5kaW5nV3JpdGVzYCBhbmQgdGhlIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCkuXG4gICAgICAgIHJldHVybiBlLmhhc0xvY2FsTXV0YXRpb25zICYmIHQuaGFzQ29tbWl0dGVkTXV0YXRpb25zICYmICF0Lmhhc0xvY2FsTXV0YXRpb25zO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSB2aWV3IHdpdGggdGhlIGdpdmVuIFZpZXdEb2N1bWVudENoYW5nZXMgYW5kIG9wdGlvbmFsbHkgdXBkYXRlc1xuICAgICAqIGxpbWJvIGRvY3MgYW5kIHN5bmMgc3RhdGUgZnJvbSB0aGUgcHJvdmlkZWQgdGFyZ2V0IGNoYW5nZS5cbiAgICAgKiBAcGFyYW0gZG9jQ2hhbmdlcyAtIFRoZSBzZXQgb2YgY2hhbmdlcyB0byBtYWtlIHRvIHRoZSB2aWV3J3MgZG9jcy5cbiAgICAgKiBAcGFyYW0gdXBkYXRlTGltYm9Eb2N1bWVudHMgLSBXaGV0aGVyIHRvIHVwZGF0ZSBsaW1ibyBkb2N1bWVudHMgYmFzZWQgb25cbiAgICAgKiAgICAgICAgdGhpcyBjaGFuZ2UuXG4gICAgICogQHBhcmFtIHRhcmdldENoYW5nZSAtIEEgdGFyZ2V0IGNoYW5nZSB0byBhcHBseSBmb3IgY29tcHV0aW5nIGxpbWJvIGRvY3MgYW5kXG4gICAgICogICAgICAgIHN5bmMgc3RhdGUuXG4gICAgICogQHJldHVybnMgQSBuZXcgVmlld0NoYW5nZSB3aXRoIHRoZSBnaXZlbiBkb2NzLCBjaGFuZ2VzLCBhbmQgc3luYyBzdGF0ZS5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IFRoZSBpT1MvQW5kcm9pZCBjbGllbnRzIGFsd2F5cyBjb21wdXRlIGxpbWJvIGRvY3VtZW50IGNoYW5nZXMuXG4gICAgYXBwbHlDaGFuZ2VzKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IHRoaXMucmE7XG4gICAgICAgIHRoaXMucmEgPSBlLnJhLCB0aGlzLm11dGF0ZWRLZXlzID0gZS5tdXRhdGVkS2V5cztcbiAgICAgICAgLy8gU29ydCBjaGFuZ2VzIGJhc2VkIG9uIHR5cGUgYW5kIHF1ZXJ5IGNvbXBhcmF0b3JcbiAgICAgICAgY29uc3QgaSA9IGUub2EuTV8oKTtcbiAgICAgICAgaS5zb3J0KCgoZSwgdCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVDaGFuZ2VUeXBlKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA6XG4gICAgICAgICAgICAgICAgICBjYXNlIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyA6XG4gICAgICAgICAgICAgICAgICAgIC8vIEEgbWV0YWRhdGEgY2hhbmdlIGlzIGNvbnZlcnRlZCB0byBhIG1vZGlmaWVkIGNoYW5nZSBhdCB0aGUgcHVibGljXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwaSBsYXllci4gIFNpbmNlIHdlIHNvcnQgYnkgZG9jdW1lbnQga2V5IGFuZCB0aGVuIGNoYW5nZSB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAvLyBtZXRhZGF0YSBhbmQgbW9kaWZpZWQgY2hhbmdlcyBtdXN0IGJlIHNvcnRlZCBlcXVpdmFsZW50bHkuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovIDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBvcmRlcihlKSAtIG9yZGVyKHQpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChlLnR5cGUsIHQudHlwZSkgfHwgdGhpcy5uYShlLmRvYywgdC5kb2MpKSksIHRoaXMuYWEobik7XG4gICAgICAgIGNvbnN0IHMgPSB0ID8gdGhpcy51YSgpIDogW10sIG8gPSAwID09PSB0aGlzLnRhLnNpemUgJiYgdGhpcy5jdXJyZW50ID8gMSAvKiBTeW5jU3RhdGUuU3luY2VkICovIDogMCAvKiBTeW5jU3RhdGUuTG9jYWwgKi8gLCBfID0gbyAhPT0gdGhpcy5lYTtcbiAgICAgICAgaWYgKHRoaXMuZWEgPSBvLCAwICE9PSBpLmxlbmd0aCB8fCBfKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90OiBuZXcgVmlld1NuYXBzaG90KHRoaXMucXVlcnksIGUucmEsIHIsIGksIGUubXV0YXRlZEtleXMsIDAgLyogU3luY1N0YXRlLkxvY2FsICovID09PSBvLCBfLCBcbiAgICAgICAgICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsICEhbiAmJiBuLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDApLFxuICAgICAgICAgICAgICAgIGNhOiBzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vIGNoYW5nZXNcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNhOiBzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYW4gT25saW5lU3RhdGUgY2hhbmdlIHRvIHRoZSB2aWV3LCBwb3RlbnRpYWxseSBnZW5lcmF0aW5nIGFcbiAgICAgKiBWaWV3Q2hhbmdlIGlmIHRoZSB2aWV3J3Mgc3luY1N0YXRlIGNoYW5nZXMgYXMgYSByZXN1bHQuXG4gICAgICovICAgIE5fKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCAmJiBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovID09PSBlID8gKFxuICAgICAgICAvLyBJZiB3ZSdyZSBvZmZsaW5lLCBzZXQgYGN1cnJlbnRgIHRvIGZhbHNlIGFuZCB0aGVuIGNhbGwgYXBwbHlDaGFuZ2VzKClcbiAgICAgICAgLy8gdG8gcmVmcmVzaCBvdXIgc3luY1N0YXRlIGFuZCBnZW5lcmF0ZSBhIFZpZXdDaGFuZ2UgYXMgYXBwcm9wcmlhdGUuIFdlXG4gICAgICAgIC8vIGFyZSBndWFyYW50ZWVkIHRvIGdldCBhIG5ldyBUYXJnZXRDaGFuZ2UgdGhhdCBzZXRzIGBjdXJyZW50YCBiYWNrIHRvXG4gICAgICAgIC8vIHRydWUgb25jZSB0aGUgY2xpZW50IGlzIGJhY2sgb25saW5lLlxuICAgICAgICB0aGlzLmN1cnJlbnQgPSAhMSwgdGhpcy5hcHBseUNoYW5nZXMoe1xuICAgICAgICAgICAgcmE6IHRoaXMucmEsXG4gICAgICAgICAgICBvYTogbmV3IF9fUFJJVkFURV9Eb2N1bWVudENoYW5nZVNldCxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiB0aGlzLm11dGF0ZWRLZXlzLFxuICAgICAgICAgICAgemk6ICExXG4gICAgICAgIH0sIFxuICAgICAgICAvKiB1cGRhdGVMaW1ib0RvY3VtZW50cz0gKi8gITEpKSA6IHtcbiAgICAgICAgICAgIGNhOiBbXVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGRvYyBmb3IgdGhlIGdpdmVuIGtleSBzaG91bGQgYmUgaW4gbGltYm8uXG4gICAgICovICAgIGxhKGUpIHtcbiAgICAgICAgLy8gSWYgdGhlIHJlbW90ZSBlbmQgc2F5cyBpdCdzIHBhcnQgb2YgdGhpcyBxdWVyeSwgaXQncyBub3QgaW4gbGltYm8uXG4gICAgICAgIHJldHVybiAhdGhpcy5YXy5oYXMoZSkgJiYgKFxuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgZG9lc24ndCB0aGluayBpdCdzIGEgcmVzdWx0LCBzbyBpdCBzaG91bGRuJ3QgYmUgaW4gbGltYm8uXG4gICAgICAgICEhdGhpcy5yYS5oYXMoZSkgJiYgIXRoaXMucmEuZ2V0KGUpLmhhc0xvY2FsTXV0YXRpb25zKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBzeW5jZWREb2N1bWVudHMsIGN1cnJlbnQsIGFuZCBsaW1ibyBkb2NzIGJhc2VkIG9uIHRoZSBnaXZlbiBjaGFuZ2UuXG4gICAgICogUmV0dXJucyB0aGUgbGlzdCBvZiBjaGFuZ2VzIHRvIHdoaWNoIGRvY3MgYXJlIGluIGxpbWJvLlxuICAgICAqLyAgICBhYShlKSB7XG4gICAgICAgIGUgJiYgKGUuYWRkZWREb2N1bWVudHMuZm9yRWFjaCgoZSA9PiB0aGlzLlhfID0gdGhpcy5YXy5hZGQoZSkpKSwgZS5tb2RpZmllZERvY3VtZW50cy5mb3JFYWNoKChlID0+IHt9KSksIFxuICAgICAgICBlLnJlbW92ZWREb2N1bWVudHMuZm9yRWFjaCgoZSA9PiB0aGlzLlhfID0gdGhpcy5YXy5kZWxldGUoZSkpKSwgdGhpcy5jdXJyZW50ID0gZS5jdXJyZW50KTtcbiAgICB9XG4gICAgdWEoKSB7XG4gICAgICAgIC8vIFdlIGNhbiBvbmx5IGRldGVybWluZSBsaW1ibyBkb2N1bWVudHMgd2hlbiB3ZSdyZSBpbi1zeW5jIHdpdGggdGhlIHNlcnZlci5cbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnQpIHJldHVybiBbXTtcbiAgICAgICAgLy8gVE9ETyhrbGltdCk6IERvIHRoaXMgaW5jcmVtZW50YWxseSBzbyB0aGF0IGl0J3Mgbm90IHF1YWRyYXRpYyB3aGVuXG4gICAgICAgIC8vIHVwZGF0aW5nIG1hbnkgZG9jdW1lbnRzLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLnRhO1xuICAgICAgICB0aGlzLnRhID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIHRoaXMucmEuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxhKGUua2V5KSAmJiAodGhpcy50YSA9IHRoaXMudGEuYWRkKGUua2V5KSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgLy8gRGlmZiB0aGUgbmV3IGxpbWJvIGRvY3Mgd2l0aCB0aGUgb2xkIGxpbWJvIGRvY3MuXG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRhLmhhcyhlKSB8fCB0LnB1c2gobmV3IF9fUFJJVkFURV9SZW1vdmVkTGltYm9Eb2N1bWVudChlKSk7XG4gICAgICAgIH0pKSwgdGhpcy50YS5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIGUuaGFzKG4pIHx8IHQucHVzaChuZXcgX19QUklWQVRFX0FkZGVkTGltYm9Eb2N1bWVudChuKSk7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBpbi1tZW1vcnkgc3RhdGUgb2YgdGhlIGN1cnJlbnQgdmlldyB3aXRoIHRoZSBzdGF0ZSByZWFkIGZyb21cbiAgICAgKiBwZXJzaXN0ZW5jZS5cbiAgICAgKlxuICAgICAqIFdlIHVwZGF0ZSB0aGUgcXVlcnkgdmlldyB3aGVuZXZlciBhIGNsaWVudCdzIHByaW1hcnkgc3RhdHVzIGNoYW5nZXM6XG4gICAgICogLSBXaGVuIGEgY2xpZW50IHRyYW5zaXRpb25zIGZyb20gcHJpbWFyeSB0byBzZWNvbmRhcnksIGl0IGNhbiBtaXNzXG4gICAgICogICBMb2NhbFN0b3JhZ2UgdXBkYXRlcyBhbmQgaXRzIHF1ZXJ5IHZpZXdzIG1heSB0ZW1wb3JhcmlseSBub3QgYmVcbiAgICAgKiAgIHN5bmNocm9uaXplZCB3aXRoIHRoZSBzdGF0ZSBvbiBkaXNrLlxuICAgICAqIC0gRm9yIHNlY29uZGFyeSB0byBwcmltYXJ5IHRyYW5zaXRpb25zLCB0aGUgY2xpZW50IG5lZWRzIHRvIHVwZGF0ZSB0aGUgbGlzdFxuICAgICAqICAgb2YgYHN5bmNlZERvY3VtZW50c2Agc2luY2Ugc2Vjb25kYXJ5IGNsaWVudHMgdXBkYXRlIHRoZWlyIHF1ZXJ5IHZpZXdzXG4gICAgICogICBiYXNlZCBwdXJlbHkgb24gc3ludGhlc2l6ZWQgUmVtb3RlRXZlbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHF1ZXJ5UmVzdWx0LmRvY3VtZW50cyAtIFRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGUgcXVlcnkgYWNjb3JkaW5nXG4gICAgICogdG8gdGhlIExvY2FsU3RvcmUuXG4gICAgICogQHBhcmFtIHF1ZXJ5UmVzdWx0LnJlbW90ZUtleXMgLSBUaGUga2V5cyBvZiB0aGUgZG9jdW1lbnRzIHRoYXQgbWF0Y2ggdGhlXG4gICAgICogcXVlcnkgYWNjb3JkaW5nIHRvIHRoZSBiYWNrZW5kLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIFZpZXdDaGFuZ2UgdGhhdCByZXN1bHRlZCBmcm9tIHRoaXMgc3luY2hyb25pemF0aW9uLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgaGEoZSkge1xuICAgICAgICB0aGlzLlhfID0gZS5zcywgdGhpcy50YSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5zYShlLmRvY3VtZW50cyk7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGx5Q2hhbmdlcyh0LCAvKnVwZGF0ZUxpbWJvRG9jdW1lbnRzPSovICEwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZpZXcgc25hcHNob3QgYXMgaWYgdGhpcyBxdWVyeSB3YXMganVzdCBsaXN0ZW5lZCB0by4gQ29udGFpbnNcbiAgICAgKiBhIGRvY3VtZW50IGFkZCBmb3IgZXZlcnkgZXhpc3RpbmcgZG9jdW1lbnQgYW5kIHRoZSBgZnJvbUNhY2hlYCBhbmRcbiAgICAgKiBgaGFzUGVuZGluZ1dyaXRlc2Agc3RhdHVzIG9mIHRoZSBhbHJlYWR5IGVzdGFibGlzaGVkIHZpZXcuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBQYSgpIHtcbiAgICAgICAgcmV0dXJuIFZpZXdTbmFwc2hvdC5mcm9tSW5pdGlhbERvY3VtZW50cyh0aGlzLnF1ZXJ5LCB0aGlzLnJhLCB0aGlzLm11dGF0ZWRLZXlzLCAwIC8qIFN5bmNTdGF0ZS5Mb2NhbCAqLyA9PT0gdGhpcy5lYSwgdGhpcy5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICB9XG59XG5cbi8qKlxuICogUXVlcnlWaWV3IGNvbnRhaW5zIGFsbCBvZiB0aGUgZGF0YSB0aGF0IFN5bmNFbmdpbmUgbmVlZHMgdG8ga2VlcCB0cmFjayBvZiBmb3JcbiAqIGEgcGFydGljdWxhciBxdWVyeS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5VmlldyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIHF1ZXJ5IGl0c2VsZi5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgdGFyZ2V0IG51bWJlciBjcmVhdGVkIGJ5IHRoZSBjbGllbnQgdGhhdCBpcyB1c2VkIGluIHRoZSB3YXRjaFxuICAgICAqIHN0cmVhbSB0byBpZGVudGlmeSB0aGlzIHF1ZXJ5LlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSB2aWV3IGlzIHJlc3BvbnNpYmxlIGZvciBjb21wdXRpbmcgdGhlIGZpbmFsIG1lcmdlZCB0cnV0aCBvZiB3aGF0XG4gICAgICogZG9jcyBhcmUgaW4gdGhlIHF1ZXJ5LiBJdCBnZXRzIG5vdGlmaWVkIG9mIGxvY2FsIGFuZCByZW1vdGUgY2hhbmdlcyxcbiAgICAgKiBhbmQgYXBwbGllcyB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0XG4gICAgICogcG9zc2libGUgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBuKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSBlLCB0aGlzLnRhcmdldElkID0gdCwgdGhpcy52aWV3ID0gbjtcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgYSBsaW1ibyByZXNvbHV0aW9uLiAqLyBjbGFzcyBMaW1ib1Jlc29sdXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCB0byB0cnVlIG9uY2Ugd2UndmUgcmVjZWl2ZWQgYSBkb2N1bWVudC4gVGhpcyBpcyB1c2VkIGluXG4gICAgICAgICAqIGdldFJlbW90ZUtleXNGb3JUYXJnZXQoKSBhbmQgdWx0aW1hdGVseSB1c2VkIGJ5IFdhdGNoQ2hhbmdlQWdncmVnYXRvciB0b1xuICAgICAgICAgKiBkZWNpZGUgd2hldGhlciBpdCBuZWVkcyB0byBtYW51ZmFjdHVyZSBhIGRlbGV0ZSBldmVudCBmb3IgdGhlIHRhcmdldCBvbmNlXG4gICAgICAgICAqIHRoZSB0YXJnZXQgaXMgQ1VSUkVOVC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuSWEgPSAhMTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgYFN5bmNFbmdpbmVgIGNvb3JkaW5hdGluZyB3aXRoIG90aGVyIHBhcnRzIG9mIFNESy5cbiAqXG4gKiBUaGUgcGFydHMgb2YgU3luY0VuZ2luZSB0aGF0IGFjdCBhcyBhIGNhbGxiYWNrIHRvIFJlbW90ZVN0b3JlIG5lZWQgdG8gYmVcbiAqIHJlZ2lzdGVyZWQgaW5kaXZpZHVhbGx5LiBUaGlzIGlzIGRvbmUgaW4gYHN5bmNFbmdpbmVXcml0ZSgpYCBhbmRcbiAqIGBzeW5jRW5naW5lTGlzdGVuKClgIChhcyB3ZWxsIGFzIGBhcHBseVByaW1hcnlTdGF0ZSgpYCkgYXMgdGhlc2UgbWV0aG9kc1xuICogc2VydmUgYXMgZW50cnkgcG9pbnRzIHRvIFJlbW90ZVN0b3JlJ3MgZnVuY3Rpb25hbGl0eS5cbiAqXG4gKiBOb3RlOiBzb21lIGZpZWxkIGRlZmluZWQgaW4gdGhpcyBjbGFzcyBtaWdodCBoYXZlIHB1YmxpYyBhY2Nlc3MgbGV2ZWwsIGJ1dFxuICogdGhlIGNsYXNzIGlzIG5vdCBleHBvcnRlZCBzbyB0aGV5IGFyZSBvbmx5IGFjY2Vzc2libGUgZnJvbSB0aGlzIG1vZHVsZS5cbiAqIFRoaXMgaXMgdXNlZnVsIHRvIGltcGxlbWVudCBvcHRpb25hbCBmZWF0dXJlcyAobGlrZSBidW5kbGVzKSBpbiBmcmVlXG4gKiBmdW5jdGlvbnMsIHN1Y2ggdGhhdCB0aGV5IGFyZSB0cmVlLXNoYWtlYWJsZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU3luY0VuZ2luZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIFxuICAgIC8vIFBPUlRJTkcgTk9URTogTWFuYWdlcyBzdGF0ZSBzeW5jaHJvbml6YXRpb24gaW4gbXVsdGktdGFiIGVudmlyb25tZW50cy5cbiAgICByLCBpLCBzKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMucmVtb3RlU3RvcmUgPSB0LCB0aGlzLmV2ZW50TWFuYWdlciA9IG4sIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgPSByLCBcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnMgPSBzLCB0aGlzLlRhID0ge30sIHRoaXMuRWEgPSBuZXcgT2JqZWN0TWFwKChlID0+IF9fUFJJVkFURV9jYW5vbmlmeVF1ZXJ5KGUpKSwgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKSwgXG4gICAgICAgIHRoaXMuZGEgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBrZXlzIG9mIGRvY3VtZW50cyB0aGF0IGFyZSBpbiBsaW1ibyBmb3Igd2hpY2ggd2UgaGF2ZW4ndCB5ZXQgc3RhcnRlZCBhXG4gICAgICAgICAqIGxpbWJvIHJlc29sdXRpb24gcXVlcnkuIFRoZSBzdHJpbmdzIGluIHRoaXMgc2V0IGFyZSB0aGUgcmVzdWx0IG9mIGNhbGxpbmdcbiAgICAgICAgICogYGtleS5wYXRoLmNhbm9uaWNhbFN0cmluZygpYCB3aGVyZSBga2V5YCBpcyBhIGBEb2N1bWVudEtleWAgb2JqZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGUgYFNldGAgdHlwZSB3YXMgY2hvc2VuIGJlY2F1c2UgaXQgcHJvdmlkZXMgZWZmaWNpZW50IGxvb2t1cCBhbmQgcmVtb3ZhbFxuICAgICAgICAgKiBvZiBhcmJpdHJhcnkgZWxlbWVudHMgYW5kIGl0IGFsc28gbWFpbnRhaW5zIGluc2VydGlvbiBvcmRlciwgcHJvdmlkaW5nIHRoZVxuICAgICAgICAgKiBkZXNpcmVkIHF1ZXVlLWxpa2UgRklGTyBzZW1hbnRpY3MuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkFhID0gbmV3IFNldCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgdGFyZ2V0IElEIGZvciBlYWNoIGRvY3VtZW50IHRoYXQgaXMgaW4gbGltYm8gd2l0aCBhblxuICAgICAgICAgKiBhY3RpdmUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5SYSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvciksIFxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcHMgdHJhY2sgb2YgdGhlIGluZm9ybWF0aW9uIGFib3V0IGFuIGFjdGl2ZSBsaW1ibyByZXNvbHV0aW9uIGZvciBlYWNoXG4gICAgICAgICAqIGFjdGl2ZSB0YXJnZXQgSUQgdGhhdCB3YXMgc3RhcnRlZCBmb3IgdGhlIHB1cnBvc2Ugb2YgbGltYm8gcmVzb2x1dGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVmEgPSBuZXcgTWFwLCB0aGlzLm1hID0gbmV3IF9fUFJJVkFURV9SZWZlcmVuY2VTZXQsIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY29tcGxldGlvbiBoYW5kbGVycywgaW5kZXhlZCBieSBVc2VyIGFuZCBCYXRjaElkLiAqL1xuICAgICAgICB0aGlzLmZhID0ge30sIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY2FsbGJhY2tzIHdhaXRpbmcgZm9yIGFsbCBwZW5kaW5nIHdyaXRlcyB0byBiZSBhY2tub3dsZWRnZWQuICovXG4gICAgICAgIHRoaXMuZ2EgPSBuZXcgTWFwLCB0aGlzLnBhID0gX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yLk9uKCksIHRoaXMub25saW5lU3RhdGUgPSBcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovICwgXG4gICAgICAgIC8vIFRoZSBwcmltYXJ5IHN0YXRlIGlzIHNldCB0byBgdHJ1ZWAgb3IgYGZhbHNlYCBpbW1lZGlhdGVseSBhZnRlciBGaXJlc3RvcmVcbiAgICAgICAgLy8gc3RhcnR1cC4gSW4gdGhlIGludGVyaW0sIGEgY2xpZW50IHNob3VsZCBvbmx5IGJlIGNvbnNpZGVyZWQgcHJpbWFyeSBpZlxuICAgICAgICAvLyBgaXNQcmltYXJ5YCBpcyB0cnVlLlxuICAgICAgICB0aGlzLnlhID0gdm9pZCAwO1xuICAgIH1cbiAgICBnZXQgaXNQcmltYXJ5Q2xpZW50KCkge1xuICAgICAgICByZXR1cm4gITAgPT09IHRoaXMueWE7XG4gICAgfVxufVxuXG4vKipcbiAqIEluaXRpYXRlcyB0aGUgbmV3IGxpc3RlbiwgcmVzb2x2ZXMgcHJvbWlzZSB3aGVuIGxpc3RlbiBlbnF1ZXVlZCB0byB0aGVcbiAqIHNlcnZlci4gQWxsIHRoZSBzdWJzZXF1ZW50IHZpZXcgc25hcHNob3RzIG9yIGVycm9ycyBhcmUgc2VudCB0byB0aGVcbiAqIHN1YnNjcmliZWQgaGFuZGxlcnMuIFJldHVybnMgdGhlIGluaXRpYWwgc25hcHNob3QuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lTGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2Vuc3VyZVdhdGNoQ2FsbGJhY2tzKGUpO1xuICAgIGxldCByLCBpO1xuICAgIGNvbnN0IHMgPSBuLkVhLmdldCh0KTtcbiAgICBpZiAocykgXG4gICAgLy8gUE9SVElORyBOT1RFOiBXaXRoIE11bHRpLVRhYiBXZWIsIGl0IGlzIHBvc3NpYmxlIHRoYXQgYSBxdWVyeSB2aWV3XG4gICAgLy8gYWxyZWFkeSBleGlzdHMgd2hlbiBFdmVudE1hbmFnZXIgY2FsbHMgdXMgZm9yIHRoZSBmaXJzdCB0aW1lLiBUaGlzXG4gICAgLy8gaGFwcGVucyB3aGVuIHRoZSBwcmltYXJ5IHRhYiBpcyBhbHJlYWR5IGxpc3RlbmluZyB0byB0aGlzIHF1ZXJ5IG9uXG4gICAgLy8gYmVoYWxmIG9mIGFub3RoZXIgdGFiIGFuZCB0aGUgdXNlciBvZiB0aGUgcHJpbWFyeSBhbHNvIHN0YXJ0cyBsaXN0ZW5pbmdcbiAgICAvLyB0byB0aGUgcXVlcnkuIEV2ZW50TWFuYWdlciB3aWxsIG5vdCBoYXZlIGFuIGFzc2lnbmVkIHRhcmdldCBJRCBpbiB0aGlzXG4gICAgLy8gY2FzZSBhbmQgY2FsbHMgYGxpc3RlbmAgdG8gb2J0YWluIHRoaXMgSUQuXG4gICAgciA9IHMudGFyZ2V0SWQsIG4uc2hhcmVkQ2xpZW50U3RhdGUuYWRkTG9jYWxRdWVyeVRhcmdldChyKSwgaSA9IHMudmlldy5QYSgpOyBlbHNlIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQobi5sb2NhbFN0b3JlLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSksIHMgPSBuLnNoYXJlZENsaWVudFN0YXRlLmFkZExvY2FsUXVlcnlUYXJnZXQoZS50YXJnZXRJZCk7XG4gICAgICAgIHIgPSBlLnRhcmdldElkLCBpID0gYXdhaXQgX19QUklWQVRFX2luaXRpYWxpemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KG4sIHQsIHIsIFwiY3VycmVudFwiID09PSBzLCBlLnJlc3VtZVRva2VuKSwgXG4gICAgICAgIG4uaXNQcmltYXJ5Q2xpZW50ICYmIF9fUFJJVkFURV9yZW1vdGVTdG9yZUxpc3RlbihuLnJlbW90ZVN0b3JlLCBlKTtcbiAgICB9XG4gICAgcmV0dXJuIGk7XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGEgdmlldyBmb3IgYSBwcmV2aW91c2x5IHVua25vd24gcXVlcnkgYW5kIGNvbXB1dGVzIGl0cyBpbml0aWFsXG4gKiBzbmFwc2hvdC5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QoZSwgdCwgbiwgciwgaSkge1xuICAgIC8vIFBPUlRJTkcgTk9URTogT24gV2ViIG9ubHksIHdlIGluamVjdCB0aGUgY29kZSB0aGF0IHJlZ2lzdGVycyBuZXcgTGltYm9cbiAgICAvLyB0YXJnZXRzIGJhc2VkIG9uIHZpZXcgY2hhbmdlcy4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSBkZXBlbmQgb24gTGltYm9cbiAgICAvLyBjaGFuZ2VzIHdoZW4gdXNlciBjb2RlIGluY2x1ZGVzIHF1ZXJpZXMuXG4gICAgZS53YSA9ICh0LCBuLCByKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEb2NDaGFuZ2VzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSB0LnZpZXcuc2Eobik7XG4gICAgICAgIGkuemkgJiYgKFxuICAgICAgICAvLyBUaGUgcXVlcnkgaGFzIGEgbGltaXQgYW5kIHNvbWUgZG9jcyB3ZXJlIHJlbW92ZWQsIHNvIHdlIG5lZWRcbiAgICAgICAgLy8gdG8gcmUtcnVuIHRoZSBxdWVyeSBhZ2FpbnN0IHRoZSBsb2NhbCBzdG9yZSB0byBtYWtlIHN1cmUgd2VcbiAgICAgICAgLy8gZGlkbid0IGxvc2UgYW55IGdvb2QgZG9jcyB0aGF0IGhhZCBiZWVuIHBhc3QgdGhlIGxpbWl0LlxuICAgICAgICBpID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVFeGVjdXRlUXVlcnkoZS5sb2NhbFN0b3JlLCB0LnF1ZXJ5LCBcbiAgICAgICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMSkudGhlbigoKHtkb2N1bWVudHM6IGV9KSA9PiB0LnZpZXcuc2EoZSwgaSkpKSk7XG4gICAgICAgIGNvbnN0IHMgPSByICYmIHIudGFyZ2V0Q2hhbmdlcy5nZXQodC50YXJnZXRJZCksIG8gPSB0LnZpZXcuYXBwbHlDaGFuZ2VzKGksIFxuICAgICAgICAvKiB1cGRhdGVMaW1ib0RvY3VtZW50cz0gKi8gZS5pc1ByaW1hcnlDbGllbnQsIHMpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3VwZGF0ZVRyYWNrZWRMaW1ib3MoZSwgdC50YXJnZXRJZCwgby5jYSksIG8uc25hcHNob3Q7XG4gICAgfShlLCB0LCBuLCByKTtcbiAgICBjb25zdCBzID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVFeGVjdXRlUXVlcnkoZS5sb2NhbFN0b3JlLCB0LCBcbiAgICAvKiB1c2VQcmV2aW91c1Jlc3VsdHM9ICovICEwKSwgbyA9IG5ldyBfX1BSSVZBVEVfVmlldyh0LCBzLnNzKSwgXyA9IG8uc2Eocy5kb2N1bWVudHMpLCBhID0gVGFyZ2V0Q2hhbmdlLmNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZShuLCByICYmIFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gIT09IGUub25saW5lU3RhdGUsIGkpLCB1ID0gby5hcHBseUNoYW5nZXMoXywgXG4gICAgLyogdXBkYXRlTGltYm9Eb2N1bWVudHM9ICovIGUuaXNQcmltYXJ5Q2xpZW50LCBhKTtcbiAgICBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhlLCBuLCB1LmNhKTtcbiAgICBjb25zdCBjID0gbmV3IF9fUFJJVkFURV9RdWVyeVZpZXcodCwgbiwgbyk7XG4gICAgcmV0dXJuIGUuRWEuc2V0KHQsIGMpLCBlLmRhLmhhcyhuKSA/IGUuZGEuZ2V0KG4pLnB1c2godCkgOiBlLmRhLnNldChuLCBbIHQgXSksIHUuc25hcHNob3Q7XG59XG5cbi8qKiBTdG9wcyBsaXN0ZW5pbmcgdG8gdGhlIHF1ZXJ5LiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZVVubGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4uRWEuZ2V0KHQpLCBpID0gbi5kYS5nZXQoci50YXJnZXRJZCk7XG4gICAgaWYgKGkubGVuZ3RoID4gMSkgcmV0dXJuIG4uZGEuc2V0KHIudGFyZ2V0SWQsIGkuZmlsdGVyKChlID0+ICFfX1BSSVZBVEVfcXVlcnlFcXVhbHMoZSwgdCkpKSksIFxuICAgIHZvaWQgbi5FYS5kZWxldGUodCk7XG4gICAgLy8gTm8gb3RoZXIgcXVlcmllcyBhcmUgbWFwcGVkIHRvIHRoZSB0YXJnZXQsIGNsZWFuIHVwIHRoZSBxdWVyeSBhbmQgdGhlIHRhcmdldC5cbiAgICAgICAgaWYgKG4uaXNQcmltYXJ5Q2xpZW50KSB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBsb2NhbCBxdWVyeSB0YXJnZXQgZmlyc3QgdG8gYWxsb3cgdXMgdG8gdmVyaWZ5XG4gICAgICAgIC8vIHdoZXRoZXIgYW55IG90aGVyIGNsaWVudCBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoaXMgdGFyZ2V0LlxuICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoci50YXJnZXRJZCk7XG4gICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUuaXNBY3RpdmVRdWVyeVRhcmdldChyLnRhcmdldElkKSB8fCBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQobi5sb2NhbFN0b3JlLCByLnRhcmdldElkLCBcbiAgICAgICAgLyprZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YT0qLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5jbGVhclF1ZXJ5U3RhdGUoci50YXJnZXRJZCksIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKG4ucmVtb3RlU3RvcmUsIHIudGFyZ2V0SWQpLCBcbiAgICAgICAgICAgIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KG4sIHIudGFyZ2V0SWQpO1xuICAgICAgICB9KSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG4gICAgfSBlbHNlIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KG4sIHIudGFyZ2V0SWQpLCBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQobi5sb2NhbFN0b3JlLCByLnRhcmdldElkLCBcbiAgICAvKmtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhPSovICEwKTtcbn1cblxuLyoqXG4gKiBJbml0aWF0ZXMgdGhlIHdyaXRlIG9mIGxvY2FsIG11dGF0aW9uIGJhdGNoIHdoaWNoIGludm9sdmVzIGFkZGluZyB0aGVcbiAqIHdyaXRlcyB0byB0aGUgbXV0YXRpb24gcXVldWUsIG5vdGlmeWluZyB0aGUgcmVtb3RlIHN0b3JlIGFib3V0IG5ld1xuICogbXV0YXRpb25zIGFuZCByYWlzaW5nIGV2ZW50cyBmb3IgYW55IGNoYW5nZXMgdGhpcyB3cml0ZSBjYXVzZWQuXG4gKlxuICogVGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhpcyBjYWxsIGlzIHJlc29sdmVkIHdoZW4gdGhlIGFib3ZlIHN0ZXBzXG4gKiBoYXZlIGNvbXBsZXRlZCwgKm5vdCogd2hlbiB0aGUgd3JpdGUgd2FzIGFja2VkIGJ5IHRoZSBiYWNrZW5kLiBUaGVcbiAqIHVzZXJDYWxsYmFjayBpcyByZXNvbHZlZCBvbmNlIHRoZSB3cml0ZSB3YXMgYWNrZWQvcmVqZWN0ZWQgYnkgdGhlXG4gKiBiYWNrZW5kIChvciBmYWlsZWQgbG9jYWxseSBmb3IgYW55IG90aGVyIHJlYXNvbikuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVXcml0ZShlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3MoZSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlV3JpdGVMb2NhbGx5KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gVGltZXN0YW1wLm5vdygpLCBpID0gdC5yZWR1Y2UoKChlLCB0KSA9PiBlLmFkZCh0LmtleSkpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgICAgICAgICBsZXQgcywgbztcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiTG9jYWxseSB3cml0ZSBtdXRhdGlvbnNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2gga2V5cyBkbyBub3QgaGF2ZSBhIHJlbW90ZSB2ZXJzaW9uIGluIHRoZSBjYWNoZSwgdGhpc1xuICAgICAgICAgICAgICAgIC8vIGlzIG5lZWRlZCB0byBjcmVhdGUgdGhlIHJpZ2h0IG92ZXJsYXkgbXV0YXRpb246IGlmIG5vIHJlbW90ZSB2ZXJzaW9uXG4gICAgICAgICAgICAgICAgLy8gcHJlc2VudHMsIHdlIGRvIG5vdCBuZWVkIHRvIGNyZWF0ZSBvdmVybGF5cyBhcyBwYXRjaCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhPdmVybGF5KTogSXMgdGhlcmUgYSBiZXR0ZXIgd2F5IHRvIGRldGVybWluZSB0aGlzPyBVc2luZyB0aGVcbiAgICAgICAgICAgICAgICAvLyAgZG9jdW1lbnQgdmVyc2lvbiBkb2VzIG5vdCB3b3JrIGJlY2F1c2UgbG9jYWwgbXV0YXRpb25zIHNldCB0aGVtIGJhY2tcbiAgICAgICAgICAgICAgICAvLyAgdG8gMC5cbiAgICAgICAgICAgICAgICBsZXQgXyA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgYSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLlhpLmdldEVudHJpZXMoZSwgaSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIF8gPSBlLCBfLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzVmFsaWREb2N1bWVudCgpIHx8IChhID0gYS5hZGQoZSkpO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0T3ZlcmxheWVkRG9jdW1lbnRzKGUsIF8pKSkubmV4dCgoaSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHMgPSBpO1xuICAgICAgICAgICAgICAgICAgICAvLyBGb3Igbm9uLWlkZW1wb3RlbnQgbXV0YXRpb25zIChzdWNoIGFzIGBGaWVsZFZhbHVlLmluY3JlbWVudCgpYCksXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIHJlY29yZCB0aGUgYmFzZSBzdGF0ZSBpbiBhIHNlcGFyYXRlIHBhdGNoIG11dGF0aW9uLiBUaGlzIGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGxhdGVyIHVzZWQgdG8gZ3VhcmFudGVlIGNvbnNpc3RlbnQgdmFsdWVzIGFuZCBwcmV2ZW50cyBmbGlja2VyXG4gICAgICAgICAgICAgICAgICAgIC8vIGV2ZW4gaWYgdGhlIGJhY2tlbmQgc2VuZHMgdXMgYW4gdXBkYXRlIHRoYXQgYWxyZWFkeSBpbmNsdWRlcyBvdXJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNmb3JtLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX211dGF0aW9uRXh0cmFjdEJhc2VWYWx1ZShlLCBzLmdldChlLmtleSkub3ZlcmxheWVkRG9jdW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0ICYmIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTk9URTogVGhlIGJhc2Ugc3RhdGUgc2hvdWxkIG9ubHkgYmUgYXBwbGllZCBpZiB0aGVyZSdzIHNvbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4aXN0aW5nIGRvY3VtZW50IHRvIG92ZXJyaWRlLCBzbyB1c2UgYSBQcmVjb25kaXRpb24gb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4aXN0cz10cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnB1c2gobmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUua2V5LCB0LCBfX1BSSVZBVEVfZXh0cmFjdEZpZWxkTWFzayh0LnZhbHVlLm1hcFZhbHVlKSwgUHJlY29uZGl0aW9uLmV4aXN0cyghMCkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5tdXRhdGlvblF1ZXVlLmFkZE11dGF0aW9uQmF0Y2goZSwgciwgbywgdCk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvID0gdDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHQuYXBwbHlUb0xvY2FsRG9jdW1lbnRTZXQocywgYSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmRvY3VtZW50T3ZlcmxheUNhY2hlLnNhdmVPdmVybGF5cyhlLCB0LmJhdGNoSWQsIHIpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKS50aGVuKCgoKSA9PiAoe1xuICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG8uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiBfX1BSSVZBVEVfY29udmVydE92ZXJsYXllZERvY3VtZW50TWFwVG9Eb2N1bWVudE1hcChzKVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfShyLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLmFkZFBlbmRpbmdNdXRhdGlvbihlLmJhdGNoSWQpLCBmdW5jdGlvbiBfX1BSSVZBVEVfYWRkTXV0YXRpb25DYWxsYmFjayhlLCB0LCBuKSB7XG4gICAgICAgICAgICBsZXQgciA9IGUuZmFbZS5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAgICAgICAgIHIgfHwgKHIgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSk7XG4gICAgICAgICAgICByID0gci5pbnNlcnQodCwgbiksIGUuZmFbZS5jdXJyZW50VXNlci50b0tleSgpXSA9IHI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZXNvbHZlcyBvciByZWplY3RzIHRoZSB1c2VyIGNhbGxiYWNrIGZvciB0aGUgZ2l2ZW4gYmF0Y2ggYW5kIHRoZW4gZGlzY2FyZHNcbiAqIGl0LlxuICovIChyLCBlLmJhdGNoSWQsIG4pLCBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUociwgZS5jaGFuZ2VzKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShyLnJlbW90ZVN0b3JlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIElmIHdlIGNhbid0IHBlcnNpc3QgdGhlIG11dGF0aW9uLCB3ZSByZWplY3QgdGhlIHVzZXIgY2FsbGJhY2sgYW5kXG4gICAgICAgIC8vIGRvbid0IHNlbmQgdGhlIG11dGF0aW9uLiBUaGUgdXNlciBjYW4gdGhlbiByZXRyeSB0aGUgd3JpdGUuXG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBcIkZhaWxlZCB0byBwZXJzaXN0IHdyaXRlXCIpO1xuICAgICAgICBuLnJlamVjdCh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBvbmUgcmVtb3RlIGV2ZW50IHRvIHRoZSBzeW5jIGVuZ2luZSwgbm90aWZ5aW5nIGFueSB2aWV3cyBvZiB0aGVcbiAqIGNoYW5nZXMsIGFuZCByZWxlYXNpbmcgYW55IHBlbmRpbmcgbXV0YXRpb24gYmF0Y2hlcyB0aGF0IHdvdWxkIGJlY29tZVxuICogdmlzaWJsZSBiZWNhdXNlIG9mIHRoZSBzbmFwc2hvdCB2ZXJzaW9uIHRoZSByZW1vdGUgZXZlbnQgY29udGFpbnMuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBcHBseVJlbW90ZUV2ZW50VG9Mb2NhbENhY2hlKG4ubG9jYWxTdG9yZSwgdCk7XG4gICAgICAgIC8vIFVwZGF0ZSBgcmVjZWl2ZWREb2N1bWVudGAgYXMgYXBwcm9wcmlhdGUgZm9yIGFueSBsaW1ibyB0YXJnZXRzLlxuICAgICAgICAgICAgICAgIHQudGFyZ2V0Q2hhbmdlcy5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uVmEuZ2V0KHQpO1xuICAgICAgICAgICAgciAmJiAoXG4gICAgICAgICAgICAvLyBTaW5jZSB0aGlzIGlzIGEgbGltYm8gcmVzb2x1dGlvbiBsb29rdXAsIGl0J3MgZm9yIGEgc2luZ2xlIGRvY3VtZW50XG4gICAgICAgICAgICAvLyBhbmQgaXQgY291bGQgYmUgYWRkZWQsIG1vZGlmaWVkLCBvciByZW1vdmVkLCBidXQgbm90IGEgY29tYmluYXRpb24uXG4gICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChlLmFkZGVkRG9jdW1lbnRzLnNpemUgKyBlLm1vZGlmaWVkRG9jdW1lbnRzLnNpemUgKyBlLnJlbW92ZWREb2N1bWVudHMuc2l6ZSA8PSAxKSwgXG4gICAgICAgICAgICBlLmFkZGVkRG9jdW1lbnRzLnNpemUgPiAwID8gci5JYSA9ICEwIDogZS5tb2RpZmllZERvY3VtZW50cy5zaXplID4gMCA/IF9fUFJJVkFURV9oYXJkQXNzZXJ0KHIuSWEpIDogZS5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPiAwICYmIChfX1BSSVZBVEVfaGFyZEFzc2VydChyLklhKSwgXG4gICAgICAgICAgICByLklhID0gITEpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUobiwgZSwgdCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBcHBsaWVzIGFuIE9ubGluZVN0YXRlIGNoYW5nZSB0byB0aGUgc3luYyBlbmdpbmUgYW5kIG5vdGlmaWVzIGFueSB2aWV3cyBvZlxuICogdGhlIGNoYW5nZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5T25saW5lU3RhdGVDaGFuZ2UoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIC8vIElmIHdlIGFyZSB0aGUgc2Vjb25kYXJ5IGNsaWVudCwgd2UgZXhwbGljaXRseSBpZ25vcmUgdGhlIHJlbW90ZSBzdG9yZSdzXG4gICAgLy8gb25saW5lIHN0YXRlICh0aGUgbG9jYWwgY2xpZW50IG1heSBnbyBvZmZsaW5lLCBldmVuIHRob3VnaCB0aGUgcHJpbWFyeVxuICAgIC8vIHRhYiByZW1haW5zIG9ubGluZSkgYW5kIG9ubHkgYXBwbHkgdGhlIHByaW1hcnkgdGFiJ3Mgb25saW5lIHN0YXRlIGZyb21cbiAgICAvLyBTaGFyZWRDbGllbnRTdGF0ZS5cbiAgICAgICAgaWYgKHIuaXNQcmltYXJ5Q2xpZW50ICYmIDAgLyogT25saW5lU3RhdGVTb3VyY2UuUmVtb3RlU3RvcmUgKi8gPT09IG4gfHwgIXIuaXNQcmltYXJ5Q2xpZW50ICYmIDEgLyogT25saW5lU3RhdGVTb3VyY2UuU2hhcmVkQ2xpZW50U3RhdGUgKi8gPT09IG4pIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByLkVhLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gci52aWV3Lk5fKHQpO1xuICAgICAgICAgICAgaS5zbmFwc2hvdCAmJiBlLnB1c2goaS5zbmFwc2hvdCk7XG4gICAgICAgIH0pKSwgZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uT25saW5lU3RhdGVDaGFuZ2UoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICBuLm9ubGluZVN0YXRlID0gdDtcbiAgICAgICAgICAgIGxldCByID0gITE7XG4gICAgICAgICAgICBuLnF1ZXJpZXMuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2Ygbi5saXN0ZW5lcnMpIFxuICAgICAgICAgICAgICAgIC8vIFJ1biBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIGlmIGEgY29uc2lzdGVudCBzbmFwc2hvdCBoYXMgYmVlbiBlbWl0dGVkLlxuICAgICAgICAgICAgICAgIGUuTl8odCkgJiYgKHIgPSAhMCk7XG4gICAgICAgICAgICB9KSksIHIgJiYgX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQobik7XG4gICAgICAgIH0oci5ldmVudE1hbmFnZXIsIHQpLCBlLmxlbmd0aCAmJiByLlRhLnJfKGUpLCByLm9ubGluZVN0YXRlID0gdCwgci5pc1ByaW1hcnlDbGllbnQgJiYgci5zaGFyZWRDbGllbnRTdGF0ZS5zZXRPbmxpbmVTdGF0ZSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVqZWN0cyB0aGUgbGlzdGVuIGZvciB0aGUgZ2l2ZW4gdGFyZ2V0SUQuIFRoaXMgY2FuIGJlIHRyaWdnZXJlZCBieSB0aGVcbiAqIGJhY2tlbmQgZm9yIGFueSBhY3RpdmUgdGFyZ2V0LlxuICpcbiAqIEBwYXJhbSBzeW5jRW5naW5lIC0gVGhlIHN5bmMgZW5naW5lIGltcGxlbWVudGF0aW9uLlxuICogQHBhcmFtIHRhcmdldElkIC0gVGhlIHRhcmdldElEIGNvcnJlc3BvbmRzIHRvIG9uZSBwcmV2aW91c2x5IGluaXRpYXRlZCBieSB0aGVcbiAqIHVzZXIgYXMgcGFydCBvZiBUYXJnZXREYXRhIHBhc3NlZCB0byBsaXN0ZW4oKSBvbiBSZW1vdGVTdG9yZS5cbiAqIEBwYXJhbSBlcnIgLSBBIGRlc2NyaXB0aW9uIG9mIHRoZSBjb25kaXRpb24gdGhhdCBoYXMgZm9yY2VkIHRoZSByZWplY3Rpb24uXG4gKiBOZWFybHkgYWx3YXlzIHRoaXMgd2lsbCBiZSBhbiBpbmRpY2F0aW9uIHRoYXQgdGhlIHVzZXIgaXMgbm8gbG9uZ2VyXG4gKiBhdXRob3JpemVkIHRvIHNlZSB0aGUgZGF0YSBtYXRjaGluZyB0aGUgdGFyZ2V0LlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0TGlzdGVuKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZVF1ZXJ5U3RhdGUodCwgXCJyZWplY3RlZFwiLCBuKTtcbiAgICBjb25zdCBpID0gci5WYS5nZXQodCksIHMgPSBpICYmIGkua2V5O1xuICAgIGlmIChzKSB7XG4gICAgICAgIC8vIFRPRE8oa2xpbXQpOiBXZSByZWFsbHkgb25seSBzaG91bGQgZG8gdGhlIGZvbGxvd2luZyBvbiBwZXJtaXNzaW9uXG4gICAgICAgIC8vIGRlbmllZCBlcnJvcnMsIGJ1dCB3ZSBkb24ndCBoYXZlIHRoZSBjYXVzZSBjb2RlIGhlcmUuXG4gICAgICAgIC8vIEl0J3MgYSBsaW1ibyBkb2MuIENyZWF0ZSBhIHN5bnRoZXRpYyBldmVudCBzYXlpbmcgaXQgd2FzIGRlbGV0ZWQuXG4gICAgICAgIC8vIFRoaXMgaXMga2luZCBvZiBhIGhhY2suIElkZWFsbHksIHdlIHdvdWxkIGhhdmUgYSBtZXRob2QgaW4gdGhlIGxvY2FsXG4gICAgICAgIC8vIHN0b3JlIHRvIHB1cmdlIGEgZG9jdW1lbnQuIEhvd2V2ZXIsIGl0IHdvdWxkIGJlIHRyaWNreSB0byBrZWVwIGFsbCBvZlxuICAgICAgICAvLyB0aGUgbG9jYWwgc3RvcmUncyBpbnZhcmlhbnRzIHdpdGggYW5vdGhlciBtZXRob2QuXG4gICAgICAgIGxldCBlID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbiAgICAgICAgLy8gVE9ETyhiLzIxNzE4OTIxNik6IFRoaXMgbGltYm8gZG9jdW1lbnQgc2hvdWxkIGlkZWFsbHkgaGF2ZSBhIHJlYWQgdGltZSxcbiAgICAgICAgLy8gc28gdGhhdCBpdCBpcyBwaWNrZWQgdXAgYnkgYW55IHJlYWQtdGltZSBiYXNlZCBzY2Fucy4gVGhlIGJhY2tlbmQsXG4gICAgICAgIC8vIGhvd2V2ZXIsIGRvZXMgbm90IHNlbmQgYSByZWFkIHRpbWUgZm9yIHRhcmdldCByZW1vdmFscy5cbiAgICAgICAgICAgICAgICBlID0gZS5pbnNlcnQocywgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQocywgU25hcHNob3RWZXJzaW9uLm1pbigpKSk7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKS5hZGQocyksIGkgPSBuZXcgUmVtb3RlRXZlbnQoU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogdGFyZ2V0Q2hhbmdlcz0gKi8gbmV3IE1hcCwgXG4gICAgICAgIC8qIHRhcmdldE1pc21hdGNoZXM9ICovIG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCBlLCBuKTtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50KHIsIGkpLCBcbiAgICAgICAgLy8gU2luY2UgdGhpcyBxdWVyeSBmYWlsZWQsIHdlIHdvbid0IHdhbnQgdG8gbWFudWFsbHkgdW5saXN0ZW4gdG8gaXQuXG4gICAgICAgIC8vIFdlIG9ubHkgcmVtb3ZlIGl0IGZyb20gYm9va2tlZXBpbmcgYWZ0ZXIgd2Ugc3VjY2Vzc2Z1bGx5IGFwcGxpZWQgdGhlXG4gICAgICAgIC8vIFJlbW90ZUV2ZW50LiBJZiBgYXBwbHlSZW1vdGVFdmVudCgpYCB0aHJvd3MsIHdlIHdhbnQgdG8gcmUtbGlzdGVuIHRvXG4gICAgICAgIC8vIHRoaXMgcXVlcnkgd2hlbiB0aGUgUmVtb3RlU3RvcmUgcmVzdGFydHMgdGhlIFdhdGNoIHN0cmVhbSwgd2hpY2ggc2hvdWxkXG4gICAgICAgIC8vIHJlLXRyaWdnZXIgdGhlIHRhcmdldCBmYWlsdXJlLlxuICAgICAgICByLlJhID0gci5SYS5yZW1vdmUocyksIHIuVmEuZGVsZXRlKHQpLCBfX1BSSVZBVEVfcHVtcEVucXVldWVkTGltYm9SZXNvbHV0aW9ucyhyKTtcbiAgICB9IGVsc2UgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KHIubG9jYWxTdG9yZSwgdCwgXG4gICAgLyoga2VlcFBlcnNpc3RlZFRhcmdldERhdGEgKi8gITEpLnRoZW4oKCgpID0+IF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIHQsIG4pKSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlTdWNjZXNzZnVsV3JpdGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gdC5iYXRjaC5iYXRjaElkO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFja25vd2xlZGdlQmF0Y2gobi5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgLy8gVGhlIGxvY2FsIHN0b3JlIG1heSBvciBtYXkgbm90IGJlIGFibGUgdG8gYXBwbHkgdGhlIHdyaXRlIHJlc3VsdCBhbmRcbiAgICAgICAgLy8gcmFpc2UgZXZlbnRzIGltbWVkaWF0ZWx5IChkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgd2F0Y2hlciBpcyBjYXVnaHRcbiAgICAgICAgLy8gdXApLCBzbyB3ZSByYWlzZSB1c2VyIGNhbGxiYWNrcyBmaXJzdCBzbyB0aGF0IHRoZXkgY29uc2lzdGVudGx5IGhhcHBlblxuICAgICAgICAvLyBiZWZvcmUgbGlzdGVuIGV2ZW50cy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhuLCByLCAvKmVycm9yPSovIG51bGwpLCBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MobiwgciksIFxuICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUociwgXCJhY2tub3dsZWRnZWRcIiksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShuLCBlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3MoZSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZVJlamVjdEZhaWxlZFdyaXRlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVSZWplY3RCYXRjaChlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVqZWN0IGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLm11dGF0aW9uUXVldWUubG9va3VwTXV0YXRpb25CYXRjaChlLCB0KS5uZXh0KCh0ID0+IChfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsICE9PSB0KSwgXG4gICAgICAgICAgICAgICAgciA9IHQua2V5cygpLCBuLm11dGF0aW9uUXVldWUucmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0KSkpKS5uZXh0KCgoKSA9PiBuLm11dGF0aW9uUXVldWUucGVyZm9ybUNvbnNpc3RlbmN5Q2hlY2soZSkpKS5uZXh0KCgoKSA9PiBuLmRvY3VtZW50T3ZlcmxheUNhY2hlLnJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCByLCB0KSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMoZSwgcikpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldERvY3VtZW50cyhlLCByKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyB0aGUgbGFyZ2VzdCAobGF0ZXN0KSBiYXRjaCBpZCBpbiBtdXRhdGlvbiBxdWV1ZSB0aGF0IGlzIHBlbmRpbmdcbiAqIHNlcnZlciByZXNwb25zZS5cbiAqXG4gKiBSZXR1cm5zIGBCQVRDSElEX1VOS05PV05gIGlmIHRoZSBxdWV1ZSBpcyBlbXB0eS5cbiAqLyAoci5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgLy8gVGhlIGxvY2FsIHN0b3JlIG1heSBvciBtYXkgbm90IGJlIGFibGUgdG8gYXBwbHkgdGhlIHdyaXRlIHJlc3VsdCBhbmRcbiAgICAgICAgLy8gcmFpc2UgZXZlbnRzIGltbWVkaWF0ZWx5IChkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgd2F0Y2hlciBpcyBjYXVnaHQgdXApLFxuICAgICAgICAvLyBzbyB3ZSByYWlzZSB1c2VyIGNhbGxiYWNrcyBmaXJzdCBzbyB0aGF0IHRoZXkgY29uc2lzdGVudGx5IGhhcHBlbiBiZWZvcmVcbiAgICAgICAgLy8gbGlzdGVuIGV2ZW50cy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhyLCB0LCBuKSwgX19QUklWQVRFX3RyaWdnZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2tzKHIsIHQpLCBcbiAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS51cGRhdGVNdXRhdGlvblN0YXRlKHQsIFwicmVqZWN0ZWRcIiwgbiksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShyLCBlKTtcbiAgICB9IGNhdGNoIChuKSB7XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3Mobik7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIHVzZXIgY2FsbGJhY2sgdGhhdCByZXNvbHZlcyB3aGVuIGFsbCBwZW5kaW5nIG11dGF0aW9ucyBhdCB0aGUgbW9tZW50IG9mIGNhbGxpbmdcbiAqIGFyZSBhY2tub3dsZWRnZWQgLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lUmVnaXN0ZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2soZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKG4ucmVtb3RlU3RvcmUpIHx8IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJUaGUgbmV0d29yayBpcyBkaXNhYmxlZC4gVGhlIHRhc2sgcmV0dXJuZWQgYnkgJ2F3YWl0UGVuZGluZ1dyaXRlcygpJyB3aWxsIG5vdCBjb21wbGV0ZSB1bnRpbCB0aGUgbmV0d29yayBpcyBlbmFibGVkLlwiKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIHQucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgaGlnaGVzdCB1bmFja25vd2xlZGdlZCBiYXRjaCBpZFwiLCBcInJlYWRvbmx5XCIsIChlID0+IHQubXV0YXRpb25RdWV1ZS5nZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpKSk7XG4gICAgICAgIH0obi5sb2NhbFN0b3JlKTtcbiAgICAgICAgaWYgKC0xID09PSBlKSBcbiAgICAgICAgLy8gVHJpZ2dlciB0aGUgY2FsbGJhY2sgcmlnaHQgYXdheSBpZiB0aGVyZSBpcyBubyBwZW5kaW5nIHdyaXRlcyBhdCB0aGUgbW9tZW50LlxuICAgICAgICByZXR1cm4gdm9pZCB0LnJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgciA9IG4uZ2EuZ2V0KGUpIHx8IFtdO1xuICAgICAgICByLnB1c2godCksIG4uZ2Euc2V0KGUsIHIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIFwiSW5pdGlhbGl6YXRpb24gb2Ygd2FpdEZvclBlbmRpbmdXcml0ZXMoKSBvcGVyYXRpb24gZmFpbGVkXCIpO1xuICAgICAgICB0LnJlamVjdChuKTtcbiAgICB9XG59XG5cbi8qKlxuICogVHJpZ2dlcnMgdGhlIGNhbGxiYWNrcyB0aGF0IGFyZSB3YWl0aW5nIGZvciB0aGlzIGJhdGNoIGlkIHRvIGdldCBhY2tub3dsZWRnZWQgYnkgc2VydmVyLFxuICogaWYgdGhlcmUgYXJlIGFueS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MoZSwgdCkge1xuICAgIChlLmdhLmdldCh0KSB8fCBbXSkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgIGUucmVzb2x2ZSgpO1xuICAgIH0pKSwgZS5nYS5kZWxldGUodCk7XG59XG5cbi8qKiBSZWplY3QgYWxsIG91dHN0YW5kaW5nIGNhbGxiYWNrcyB3YWl0aW5nIGZvciBwZW5kaW5nIHdyaXRlcyB0byBjb21wbGV0ZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3Byb2Nlc3NVc2VyQ2FsbGJhY2soZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCBpID0gci5mYVtyLmN1cnJlbnRVc2VyLnRvS2V5KCldO1xuICAgIC8vIE5PVEU6IE11dGF0aW9ucyByZXN0b3JlZCBmcm9tIHBlcnNpc3RlbmNlIHdvbid0IGhhdmUgY2FsbGJhY2tzLCBzbyBpdCdzXG4gICAgLy8gb2theSBmb3IgdGhlcmUgdG8gYmUgbm8gY2FsbGJhY2sgZm9yIHRoaXMgSUQuXG4gICAgICAgIGlmIChpKSB7XG4gICAgICAgIGNvbnN0IGUgPSBpLmdldCh0KTtcbiAgICAgICAgZSAmJiAobiA/IGUucmVqZWN0KG4pIDogZS5yZXNvbHZlKCksIGkgPSBpLnJlbW92ZSh0KSksIHIuZmFbci5jdXJyZW50VXNlci50b0tleSgpXSA9IGk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlQW5kQ2xlYW51cFRhcmdldChlLCB0LCBuID0gbnVsbCkge1xuICAgIGUuc2hhcmVkQ2xpZW50U3RhdGUucmVtb3ZlTG9jYWxRdWVyeVRhcmdldCh0KTtcbiAgICBmb3IgKGNvbnN0IHIgb2YgZS5kYS5nZXQodCkpIGUuRWEuZGVsZXRlKHIpLCBuICYmIGUuVGEuU2Eociwgbik7XG4gICAgaWYgKGUuZGEuZGVsZXRlKHQpLCBlLmlzUHJpbWFyeUNsaWVudCkge1xuICAgICAgICBlLm1hLkFyKHQpLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5tYS5jb250YWluc0tleSh0KSB8fCBcbiAgICAgICAgICAgIC8vIFdlIHJlbW92ZWQgdGhlIGxhc3QgcmVmZXJlbmNlIGZvciB0aGlzIGtleVxuICAgICAgICAgICAgX19QUklWQVRFX3JlbW92ZUxpbWJvVGFyZ2V0KGUsIHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlTGltYm9UYXJnZXQoZSwgdCkge1xuICAgIGUuQWEuZGVsZXRlKHQucGF0aC5jYW5vbmljYWxTdHJpbmcoKSk7XG4gICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHRoZSB0YXJnZXQgYWxyZWFkeSBnb3QgcmVtb3ZlZCBiZWNhdXNlIHRoZSBxdWVyeSBmYWlsZWQuIEluIHRoYXQgY2FzZSxcbiAgICAvLyB0aGUga2V5IHdvbid0IGV4aXN0IGluIGBsaW1ib1RhcmdldHNCeUtleWAuIE9ubHkgZG8gdGhlIGNsZWFudXAgaWYgd2Ugc3RpbGwgaGF2ZSB0aGUgdGFyZ2V0LlxuICAgIGNvbnN0IG4gPSBlLlJhLmdldCh0KTtcbiAgICBudWxsICE9PSBuICYmIChfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihlLnJlbW90ZVN0b3JlLCBuKSwgZS5SYSA9IGUuUmEucmVtb3ZlKHQpLCBcbiAgICBlLlZhLmRlbGV0ZShuKSwgX19QUklWQVRFX3B1bXBFbnF1ZXVlZExpbWJvUmVzb2x1dGlvbnMoZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhlLCB0LCBuKSB7XG4gICAgZm9yIChjb25zdCByIG9mIG4pIGlmIChyIGluc3RhbmNlb2YgX19QUklWQVRFX0FkZGVkTGltYm9Eb2N1bWVudCkgZS5tYS5hZGRSZWZlcmVuY2Uoci5rZXksIHQpLCBcbiAgICBfX1BSSVZBVEVfdHJhY2tMaW1ib0NoYW5nZShlLCByKTsgZWxzZSBpZiAociBpbnN0YW5jZW9mIF9fUFJJVkFURV9SZW1vdmVkTGltYm9Eb2N1bWVudCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJTeW5jRW5naW5lXCIsIFwiRG9jdW1lbnQgbm8gbG9uZ2VyIGluIGxpbWJvOiBcIiArIHIua2V5KSwgZS5tYS5yZW1vdmVSZWZlcmVuY2Uoci5rZXksIHQpO1xuICAgICAgICBlLm1hLmNvbnRhaW5zS2V5KHIua2V5KSB8fCBcbiAgICAgICAgLy8gV2UgcmVtb3ZlZCB0aGUgbGFzdCByZWZlcmVuY2UgZm9yIHRoaXMga2V5XG4gICAgICAgIF9fUFJJVkFURV9yZW1vdmVMaW1ib1RhcmdldChlLCByLmtleSk7XG4gICAgfSBlbHNlIGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RyYWNrTGltYm9DaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmtleSwgciA9IG4ucGF0aC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICBlLlJhLmdldChuKSB8fCBlLkFhLmhhcyhyKSB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKFwiU3luY0VuZ2luZVwiLCBcIk5ldyBkb2N1bWVudCBpbiBsaW1ibzogXCIgKyBuKSwgXG4gICAgZS5BYS5hZGQociksIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKGUpKTtcbn1cblxuLyoqXG4gKiBTdGFydHMgbGlzdGVucyBmb3IgZG9jdW1lbnRzIGluIGxpbWJvIHRoYXQgYXJlIGVucXVldWVkIGZvciByZXNvbHV0aW9uLFxuICogc3ViamVjdCB0byBhIG1heGltdW0gbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMuXG4gKlxuICogV2l0aG91dCBib3VuZGluZyB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMsIHRoZSBzZXJ2ZXIgY2FuIGZhaWxcbiAqIHdpdGggXCJyZXNvdXJjZSBleGhhdXN0ZWRcIiBlcnJvcnMgd2hpY2ggY2FuIGxlYWQgdG8gcGF0aG9sb2dpY2FsIGNsaWVudFxuICogYmVoYXZpb3IgYXMgc2VlbiBpbiBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy8yNjgzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKGUpIHtcbiAgICBmb3IgKDtlLkFhLnNpemUgPiAwICYmIGUuUmEuc2l6ZSA8IGUubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM7ICkge1xuICAgICAgICBjb25zdCB0ID0gZS5BYS52YWx1ZXMoKS5uZXh0KCkudmFsdWU7XG4gICAgICAgIGUuQWEuZGVsZXRlKHQpO1xuICAgICAgICBjb25zdCBuID0gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQpKSwgciA9IGUucGEubmV4dCgpO1xuICAgICAgICBlLlZhLnNldChyLCBuZXcgTGltYm9SZXNvbHV0aW9uKG4pKSwgZS5SYSA9IGUuUmEuaW5zZXJ0KG4sIHIpLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oZS5yZW1vdGVTdG9yZSwgbmV3IFRhcmdldERhdGEoX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChuLnBhdGgpKSwgciwgXCJUYXJnZXRQdXJwb3NlTGltYm9SZXNvbHV0aW9uXCIgLyogVGFyZ2V0UHVycG9zZS5MaW1ib1Jlc29sdXRpb24gKi8gLCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUpKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSBbXSwgcyA9IFtdLCBvID0gW107XG4gICAgci5FYS5pc0VtcHR5KCkgfHwgKHIuRWEuZm9yRWFjaCgoKGUsIF8pID0+IHtcbiAgICAgICAgby5wdXNoKHIud2EoXywgdCwgbikudGhlbigoZSA9PiB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdmlld3MgaWYgdGhlcmUgYXJlIGFjdHVhbCBjaGFuZ2VzLlxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGNoYW5nZXMsIG9yIHdlIGFyZSBoYW5kbGluZyBhIGdsb2JhbCBzbmFwc2hvdCwgbm90aWZ5XG4gICAgICAgICAgICAvLyBzZWNvbmRhcnkgY2xpZW50cyB0byB1cGRhdGUgcXVlcnkgc3RhdGUuXG4gICAgICAgICAgICAoZSB8fCBuKSAmJiByLmlzUHJpbWFyeUNsaWVudCAmJiByLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZVF1ZXJ5U3RhdGUoXy50YXJnZXRJZCwgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZnJvbUNhY2hlKSA/IFwibm90LWN1cnJlbnRcIiA6IFwiY3VycmVudFwiKSwgXG4gICAgICAgICAgICBlKSB7XG4gICAgICAgICAgICAgICAgaS5wdXNoKGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfTG9jYWxWaWV3Q2hhbmdlcy5xaShfLnRhcmdldElkLCBlKTtcbiAgICAgICAgICAgICAgICBzLnB1c2godCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSk7XG4gICAgfSkpLCBhd2FpdCBQcm9taXNlLmFsbChvKSwgci5UYS5yXyhpKSwgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVOb3RpZnlMb2NhbFZpZXdDaGFuZ2VzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwibm90aWZ5TG9jYWxWaWV3Q2hhbmdlc1wiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LkxpLCAociA9PiBuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmFkZFJlZmVyZW5jZShlLCB0LnRhcmdldElkLCByKSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQua2ksIChyID0+IG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUucmVtb3ZlUmVmZXJlbmNlKGUsIHQudGFyZ2V0SWQsIHIpKSkpKSkpKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmICghX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgdGhyb3cgZTtcbiAgICAgICAgICAgIC8vIElmIGBub3RpZnlMb2NhbFZpZXdDaGFuZ2VzYCBmYWlscywgd2UgZGlkIG5vdCBhZHZhbmNlIHRoZSBzZXF1ZW5jZVxuICAgICAgICAgICAgLy8gbnVtYmVyIGZvciB0aGUgZG9jdW1lbnRzIHRoYXQgd2VyZSBpbmNsdWRlZCBpbiB0aGlzIHRyYW5zYWN0aW9uLlxuICAgICAgICAgICAgLy8gVGhpcyBtaWdodCB0cmlnZ2VyIHRoZW0gdG8gYmUgZGVsZXRlZCBlYXJsaWVyIHRoYW4gdGhleSBvdGhlcndpc2VcbiAgICAgICAgICAgIC8vIHdvdWxkIGhhdmUsIGJ1dCBpdCBzaG91bGQgbm90IGludmFsaWRhdGUgdGhlIGludGVncml0eSBvZiB0aGUgZGF0YS5cbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxvY2FsU3RvcmVcIiwgXCJGYWlsZWQgdG8gdXBkYXRlIHNlcXVlbmNlIG51bWJlcnM6IFwiICsgZSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRhcmdldElkO1xuICAgICAgICAgICAgaWYgKCFlLmZyb21DYWNoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuLkppLmdldCh0KSwgciA9IGUuc25hcHNob3RWZXJzaW9uLCBpID0gZS53aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbihyKTtcbiAgICAgICAgICAgICAgICAvLyBBZHZhbmNlIHRoZSBsYXN0IGxpbWJvIGZyZWUgc25hcHNob3QgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLkppID0gbi5KaS5pbnNlcnQodCwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KHIubG9jYWxTdG9yZSwgcykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmICghbi5jdXJyZW50VXNlci5pc0VxdWFsKHQpKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJVc2VyIGNoYW5nZS4gTmV3IHVzZXI6XCIsIHQudG9LZXkoKSk7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUhhbmRsZVVzZXJDaGFuZ2Uobi5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgbi5jdXJyZW50VXNlciA9IHQsIFxuICAgICAgICAvLyBGYWlscyB0YXNrcyB3YWl0aW5nIGZvciBwZW5kaW5nIHdyaXRlcyByZXF1ZXN0ZWQgYnkgcHJldmlvdXMgdXNlci5cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3JlamVjdE91dHN0YW5kaW5nUGVuZGluZ1dyaXRlc0NhbGxiYWNrcyhlLCB0KSB7XG4gICAgICAgICAgICBlLmdhLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcih2LkNBTkNFTExFRCwgdCkpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKSwgZS5nYS5jbGVhcigpO1xuICAgICAgICB9KG4sIFwiJ3dhaXRGb3JQZW5kaW5nV3JpdGVzJyBwcm9taXNlIGlzIHJlamVjdGVkIGR1ZSB0byBhIHVzZXIgY2hhbmdlLlwiKSwgXG4gICAgICAgIC8vIFRPRE8oYi8xMTQyMjY0MTcpOiBDb25zaWRlciBjYWxsaW5nIHRoaXMgb25seSBpbiB0aGUgcHJpbWFyeSB0YWIuXG4gICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUuaGFuZGxlVXNlckNoYW5nZSh0LCBlLnJlbW92ZWRCYXRjaElkcywgZS5hZGRlZEJhdGNoSWRzKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKG4sIGUudHMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVHZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4uVmEuZ2V0KHQpO1xuICAgIGlmIChyICYmIHIuSWEpIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKS5hZGQoci5rZXkpO1xuICAgIHtcbiAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgY29uc3QgciA9IG4uZGEuZ2V0KHQpO1xuICAgICAgICBpZiAoIXIpIHJldHVybiBlO1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygcikge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uRWEuZ2V0KHQpO1xuICAgICAgICAgICAgZSA9IGUudW5pb25XaXRoKHIudmlldy5pYSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlY29uY2lsZSB0aGUgbGlzdCBvZiBzeW5jZWQgZG9jdW1lbnRzIGluIGFuIGV4aXN0aW5nIHZpZXcgd2l0aCB0aG9zZVxuICogZnJvbSBwZXJzaXN0ZW5jZS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY2hyb25pemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KG4ubG9jYWxTdG9yZSwgdC5xdWVyeSwgXG4gICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIGkgPSB0LnZpZXcuaGEocik7XG4gICAgcmV0dXJuIG4uaXNQcmltYXJ5Q2xpZW50ICYmIF9fUFJJVkFURV91cGRhdGVUcmFja2VkTGltYm9zKG4sIHQudGFyZ2V0SWQsIGkuY2EpLCBcbiAgICBpO1xufVxuXG4vKipcbiAqIFJldHJpZXZlcyBuZXdseSBjaGFuZ2VkIGRvY3VtZW50cyBmcm9tIHJlbW90ZSBkb2N1bWVudCBjYWNoZSBhbmQgcmFpc2VzXG4gKiBzbmFwc2hvdHMgaWYgbmVlZGVkLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVTeW5jaHJvbml6ZVdpdGhDaGFuZ2VkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMobi5sb2NhbFN0b3JlLCB0KS50aGVuKChlID0+IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShuLCBlKSkpO1xufVxuXG4vKiogQXBwbGllcyBhIG11dGF0aW9uIHN0YXRlIHRvIGFuIGV4aXN0aW5nIGJhdGNoLiAgKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5QmF0Y2hTdGF0ZShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHMgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUxvb2t1cE11dGF0aW9uRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KG4ubXV0YXRpb25RdWV1ZSk7XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiTG9va3VwIG11dGF0aW9uIGRvY3VtZW50c1wiLCBcInJlYWRvbmx5XCIsIChlID0+IHIuRG4oZSwgdCkubmV4dCgodCA9PiB0ID8gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudHMoZSwgdCkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKSkpKSk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgKGkubG9jYWxTdG9yZSwgdCk7XG4gICAgbnVsbCAhPT0gcyA/IChcInBlbmRpbmdcIiA9PT0gbiA/IFxuICAgIC8vIElmIHdlIGFyZSB0aGUgcHJpbWFyeSBjbGllbnQsIHdlIG5lZWQgdG8gc2VuZCB0aGlzIHdyaXRlIHRvIHRoZVxuICAgIC8vIGJhY2tlbmQuIFNlY29uZGFyeSBjbGllbnRzIHdpbGwgaWdub3JlIHRoZXNlIHdyaXRlcyBzaW5jZSB0aGVpciByZW1vdGVcbiAgICAvLyBjb25uZWN0aW9uIGlzIGRpc2FibGVkLlxuICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShpLnJlbW90ZVN0b3JlKSA6IFwiYWNrbm93bGVkZ2VkXCIgPT09IG4gfHwgXCJyZWplY3RlZFwiID09PSBuID8gKFxuICAgIC8vIE5PVEU6IEJvdGggdGhlc2UgbWV0aG9kcyBhcmUgbm8tb3BzIGZvciBiYXRjaGVzIHRoYXQgb3JpZ2luYXRlZCBmcm9tXG4gICAgLy8gb3RoZXIgY2xpZW50cy5cbiAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhpLCB0LCByIHx8IG51bGwpLCBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MoaSwgdCksIFxuICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlUmVtb3ZlQ2FjaGVkTXV0YXRpb25CYXRjaE1ldGFkYXRhKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChfX1BSSVZBVEVfZGVidWdDYXN0KGUpLm11dGF0aW9uUXVldWUpLkNuKHQpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgIChpLmxvY2FsU3RvcmUsIHQpKSA6IGZhaWwoKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKGksIHMpKSA6IFxuICAgIC8vIEEgdGhyb3R0bGVkIHRhYiBtYXkgbm90IGhhdmUgc2VlbiB0aGUgbXV0YXRpb24gYmVmb3JlIGl0IHdhcyBjb21wbGV0ZWRcbiAgICAvLyBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBtdXRhdGlvbiBxdWV1ZSwgaW4gd2hpY2ggY2FzZSB3ZSB3b24ndCBoYXZlIGNhY2hlZFxuICAgIC8vIHRoZSBhZmZlY3RlZCBkb2N1bWVudHMuIEluIHRoaXMgY2FzZSB3ZSBjYW4gc2FmZWx5IGlnbm9yZSB0aGUgdXBkYXRlXG4gICAgLy8gc2luY2UgdGhhdCBtZWFucyB3ZSBkaWRuJ3QgYXBwbHkgdGhlIG11dGF0aW9uIGxvY2FsbHkgYXQgYWxsIChpZiB3ZVxuICAgIC8vIGhhZCwgd2Ugd291bGQgaGF2ZSBjYWNoZWQgdGhlIGFmZmVjdGVkIGRvY3VtZW50cyksIGFuZCBzbyB3ZSB3aWxsIGp1c3RcbiAgICAvLyBzZWUgYW55IHJlc3VsdGluZyBkb2N1bWVudCBjaGFuZ2VzIHZpYSBub3JtYWwgcmVtb3RlIGRvY3VtZW50IHVwZGF0ZXNcbiAgICAvLyBhcyBhcHBsaWNhYmxlLlxuICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJDYW5ub3QgYXBwbHkgbXV0YXRpb24gYmF0Y2ggd2l0aCBpZDogXCIgKyB0KTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlQcmltYXJ5U3RhdGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmIChfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MobiksIF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3MobiksIFxuICAgICEwID09PSB0ICYmICEwICE9PSBuLnlhKSB7XG4gICAgICAgIC8vIFNlY29uZGFyeSB0YWJzIG9ubHkgbWFpbnRhaW4gVmlld3MgZm9yIHRoZWlyIGxvY2FsIGxpc3RlbmVycyBhbmQgdGhlXG4gICAgICAgIC8vIFZpZXdzIGludGVybmFsIHN0YXRlIG1heSBub3QgYmUgMTAwJSBwb3B1bGF0ZWQgKGluIHBhcnRpY3VsYXJcbiAgICAgICAgLy8gc2Vjb25kYXJ5IHRhYnMgZG9uJ3QgdHJhY2sgc3luY2VkRG9jdW1lbnRzLCB0aGUgc2V0IG9mIGRvY3VtZW50cyB0aGVcbiAgICAgICAgLy8gc2VydmVyIGNvbnNpZGVycyB0byBiZSBpbiB0aGUgdGFyZ2V0KS4gU28gd2hlbiBhIHNlY29uZGFyeSBiZWNvbWVzXG4gICAgICAgIC8vIHByaW1hcnksIHdlIG5lZWQgdG8gbmVlZCB0byBtYWtlIHN1cmUgdGhhdCBhbGwgdmlld3MgZm9yIGFsbCB0YXJnZXRzXG4gICAgICAgIC8vIG1hdGNoIHRoZSBzdGF0ZSBvbiBkaXNrLlxuICAgICAgICBjb25zdCBlID0gbi5zaGFyZWRDbGllbnRTdGF0ZS5nZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSwgdCA9IGF3YWl0IF9fUFJJVkFURV9zeW5jaHJvbml6ZVF1ZXJ5Vmlld3NBbmRSYWlzZVNuYXBzaG90cyhuLCBlLnRvQXJyYXkoKSk7XG4gICAgICAgIG4ueWEgPSAhMCwgYXdhaXQgX19QUklWQVRFX3JlbW90ZVN0b3JlQXBwbHlQcmltYXJ5U3RhdGUobi5yZW1vdGVTdG9yZSwgITApO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkgX19QUklWQVRFX3JlbW90ZVN0b3JlTGlzdGVuKG4ucmVtb3RlU3RvcmUsIGUpO1xuICAgIH0gZWxzZSBpZiAoITEgPT09IHQgJiYgITEgIT09IG4ueWEpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICBsZXQgdCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBuLmRhLmZvckVhY2goKChyLCBpKSA9PiB7XG4gICAgICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLmlzTG9jYWxRdWVyeVRhcmdldChpKSA/IGUucHVzaChpKSA6IHQgPSB0LnRoZW4oKCgpID0+IChfX1BSSVZBVEVfcmVtb3ZlQW5kQ2xlYW51cFRhcmdldChuLCBpKSwgXG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQobi5sb2NhbFN0b3JlLCBpLCBcbiAgICAgICAgICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITApKSkpLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihuLnJlbW90ZVN0b3JlLCBpKTtcbiAgICAgICAgfSkpLCBhd2FpdCB0LCBhd2FpdCBfX1BSSVZBVEVfc3luY2hyb25pemVRdWVyeVZpZXdzQW5kUmFpc2VTbmFwc2hvdHMobiwgZSksIFxuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfcmVzZXRMaW1ib0RvY3VtZW50cyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHQuVmEuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3Rlbih0LnJlbW90ZVN0b3JlLCBuKTtcbiAgICAgICAgICAgIH0pKSwgdC5tYS5ScigpLCB0LlZhID0gbmV3IE1hcCwgdC5SYSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZWNvbmNpbGUgdGhlIHF1ZXJ5IHZpZXdzIG9mIHRoZSBwcm92aWRlZCBxdWVyeSB0YXJnZXRzIHdpdGggdGhlIHN0YXRlIGZyb21cbiAqIHBlcnNpc3RlbmNlLiBSYWlzZXMgc25hcHNob3RzIGZvciBhbnkgY2hhbmdlcyB0aGF0IGFmZmVjdCB0aGUgbG9jYWxcbiAqIGNsaWVudCBhbmQgcmV0dXJucyB0aGUgdXBkYXRlZCBzdGF0ZSBvZiBhbGwgdGFyZ2V0J3MgcXVlcnkgZGF0YS5cbiAqXG4gKiBAcGFyYW0gc3luY0VuZ2luZSAtIFRoZSBzeW5jIGVuZ2luZSBpbXBsZW1lbnRhdGlvblxuICogQHBhcmFtIHRhcmdldHMgLSB0aGUgbGlzdCBvZiB0YXJnZXRzIHdpdGggdmlld3MgdGhhdCBuZWVkIHRvIGJlIHJlY29tcHV0ZWRcbiAqIEBwYXJhbSB0cmFuc2l0aW9uVG9QcmltYXJ5IC0gYHRydWVgIGlmZiB0aGUgdGFiIHRyYW5zaXRpb25zIGZyb20gYSBzZWNvbmRhcnlcbiAqIHRhYiB0byBhIHByaW1hcnkgdGFiXG4gKi9cbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAgICAgKG4pLCBuLnlhID0gITEsIGF3YWl0IF9fUFJJVkFURV9yZW1vdGVTdG9yZUFwcGx5UHJpbWFyeVN0YXRlKG4ucmVtb3RlU3RvcmUsICExKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jaHJvbml6ZVF1ZXJ5Vmlld3NBbmRSYWlzZVNuYXBzaG90cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSBbXSwgcyA9IFtdO1xuICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgIGxldCB0O1xuICAgICAgICBjb25zdCBuID0gci5kYS5nZXQoZSk7XG4gICAgICAgIGlmIChuICYmIDAgIT09IG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBGb3IgcXVlcmllcyB0aGF0IGhhdmUgYSBsb2NhbCBWaWV3LCB3ZSBmZXRjaCB0aGVpciBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAvLyBmcm9tIExvY2FsU3RvcmUgKGFzIHRoZSByZXN1bWUgdG9rZW4gYW5kIHRoZSBzbmFwc2hvdCB2ZXJzaW9uXG4gICAgICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQpIGFuZCByZWNvbmNpbGUgdGhlaXIgdmlld3Mgd2l0aCB0aGUgcGVyc2lzdGVkXG4gICAgICAgICAgICAvLyBzdGF0ZSAodGhlIGxpc3Qgb2Ygc3luY2VkRG9jdW1lbnRzIG1heSBoYXZlIGdvdHRlbiBvdXQgb2Ygc3luYykuXG4gICAgICAgICAgICB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChyLmxvY2FsU3RvcmUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KG5bMF0pKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHIuRWEuZ2V0KGUpLCBuID0gYXdhaXQgX19QUklWQVRFX3N5bmNocm9uaXplVmlld0FuZENvbXB1dGVTbmFwc2hvdChyLCB0KTtcbiAgICAgICAgICAgICAgICBuLnNuYXBzaG90ICYmIHMucHVzaChuLnNuYXBzaG90KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZvciBxdWVyaWVzIHRoYXQgbmV2ZXIgZXhlY3V0ZWQgb24gdGhpcyBjbGllbnQsIHdlIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIGFsbG9jYXRlIHRoZSB0YXJnZXQgaW4gTG9jYWxTdG9yZSBhbmQgaW5pdGlhbGl6ZSBhIG5ldyBWaWV3LlxuICAgICAgICAgICAgY29uc3QgbiA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0Q2FjaGVkVGFyZ2V0KHIubG9jYWxTdG9yZSwgZSk7XG4gICAgICAgICAgICB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChyLmxvY2FsU3RvcmUsIG4pLCBhd2FpdCBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QociwgX19QUklWQVRFX3N5bnRoZXNpemVUYXJnZXRUb1F1ZXJ5KG4pLCBlLCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgdC5yZXN1bWVUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgaS5wdXNoKHQpO1xuICAgIH1cbiAgICByZXR1cm4gci5UYS5yXyhzKSwgaTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgYFF1ZXJ5YCBvYmplY3QgZnJvbSB0aGUgc3BlY2lmaWVkIGBUYXJnZXRgLiBUaGVyZSBpcyBubyB3YXkgdG9cbiAqIG9idGFpbiB0aGUgb3JpZ2luYWwgYFF1ZXJ5YCwgc28gd2Ugc3ludGhlc2l6ZSBhIGBRdWVyeWAgZnJvbSB0aGUgYFRhcmdldGBcbiAqIG9iamVjdC5cbiAqXG4gKiBUaGUgc3ludGhlc2l6ZWQgcmVzdWx0IG1pZ2h0IGJlIGRpZmZlcmVudCBmcm9tIHRoZSBvcmlnaW5hbCBgUXVlcnlgLCBidXRcbiAqIHNpbmNlIHRoZSBzeW50aGVzaXplZCBgUXVlcnlgIHNob3VsZCByZXR1cm4gdGhlIHNhbWUgcmVzdWx0cyBhcyB0aGVcbiAqIG9yaWdpbmFsIG9uZSAob25seSB0aGUgcHJlc2VudGF0aW9uIG9mIHJlc3VsdHMgbWlnaHQgZGlmZmVyKSwgdGhlIHBvdGVudGlhbFxuICogZGlmZmVyZW5jZSB3aWxsIG5vdCBjYXVzZSBpc3N1ZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3ludGhlc2l6ZVRhcmdldFRvUXVlcnkoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbmV3UXVlcnkoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5vcmRlckJ5LCBlLmZpbHRlcnMsIGUubGltaXQsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyAsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBJRHMgb2YgdGhlIGNsaWVudHMgdGhhdCBhcmUgY3VycmVudGx5IGFjdGl2ZS4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUdldEFjdGl2ZUNsaWVudHMoZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldEFjdGl2ZUNsaWVudHMoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RlYnVnQ2FzdChfX1BSSVZBVEVfZGVidWdDYXN0KGUpLnBlcnNpc3RlbmNlKS5OaSgpO1xuICAgIH0oX19QUklWQVRFX2RlYnVnQ2FzdChlKS5sb2NhbFN0b3JlKTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlUYXJnZXRTdGF0ZShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKGkueWEpIFxuICAgIC8vIElmIHdlIHJlY2VpdmUgYSB0YXJnZXQgc3RhdGUgbm90aWZpY2F0aW9uIHZpYSBXZWJTdG9yYWdlLCB3ZSBhcmVcbiAgICAvLyBlaXRoZXIgYWxyZWFkeSBzZWNvbmRhcnkgb3IgYW5vdGhlciB0YWIgaGFzIHRha2VuIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgIHJldHVybiB2b2lkIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJJZ25vcmluZyB1bmV4cGVjdGVkIHF1ZXJ5IHN0YXRlIG5vdGlmaWNhdGlvbi5cIik7XG4gICAgY29uc3QgcyA9IGkuZGEuZ2V0KHQpO1xuICAgIGlmIChzICYmIHMubGVuZ3RoID4gMCkgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIFwiY3VycmVudFwiOlxuICAgICAgY2FzZSBcIm5vdC1jdXJyZW50XCI6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldE5ld0RvY3VtZW50Q2hhbmdlcyhpLmxvY2FsU3RvcmUsIF9fUFJJVkFURV9xdWVyeUNvbGxlY3Rpb25Hcm91cChzWzBdKSksIHIgPSBSZW1vdGVFdmVudC5jcmVhdGVTeW50aGVzaXplZFJlbW90ZUV2ZW50Rm9yQ3VycmVudENoYW5nZSh0LCBcImN1cnJlbnRcIiA9PT0gbiwgQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORyk7XG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUoaSwgZSwgcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlIFwicmVqZWN0ZWRcIjpcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KGkubG9jYWxTdG9yZSwgdCwgXG4gICAgICAgIC8qIGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhICovICEwKSwgX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQoaSwgdCwgcik7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBmYWlsKCk7XG4gICAgfVxufVxuXG4vKiogQWRkcyBvciByZW1vdmVzIFdhdGNoIHRhcmdldHMgZm9yIHF1ZXJpZXMgZnJvbSBkaWZmZXJlbnQgdGFicy4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseUFjdGl2ZVRhcmdldHNDaGFuZ2UoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSk7XG4gICAgaWYgKHIueWEpIHtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGlmIChyLmRhLmhhcyhlKSkge1xuICAgICAgICAgICAgICAgIC8vIEEgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiBhZGRlZCBpbiBhIHByZXZpb3VzIGF0dGVtcHRcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJTeW5jRW5naW5lXCIsIFwiQWRkaW5nIGFuIGFscmVhZHkgYWN0aXZlIHRhcmdldCBcIiArIGUpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0Q2FjaGVkVGFyZ2V0KHIubG9jYWxTdG9yZSwgZSksIG4gPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFsbG9jYXRlVGFyZ2V0KHIubG9jYWxTdG9yZSwgdCk7XG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QociwgX19QUklWQVRFX3N5bnRoZXNpemVUYXJnZXRUb1F1ZXJ5KHQpLCBuLnRhcmdldElkLCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgbi5yZXN1bWVUb2tlbiksIF9fUFJJVkFURV9yZW1vdGVTdG9yZUxpc3RlbihyLnJlbW90ZVN0b3JlLCBuKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgXG4gICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHRhcmdldCBpcyBzdGlsbCBhY3RpdmUgc2luY2UgdGhlIHRhcmdldCBtaWdodCBoYXZlIGJlZW5cbiAgICAgICAgLy8gcmVtb3ZlZCBpZiBpdCBoYXMgYmVlbiByZWplY3RlZCBieSB0aGUgYmFja2VuZC5cbiAgICAgICAgci5kYS5oYXMoZSkgJiYgXG4gICAgICAgIC8vIFJlbGVhc2UgcXVlcmllcyB0aGF0IGFyZSBzdGlsbCBhY3RpdmUuXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlUmVsZWFzZVRhcmdldChyLmxvY2FsU3RvcmUsIGUsIFxuICAgICAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4oci5yZW1vdGVTdG9yZSwgZSksIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIGUpO1xuICAgICAgICB9KSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5hcHBseVJlbW90ZUV2ZW50ID0gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50LmJpbmQobnVsbCwgdCksIFxuICAgIHQucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQgPSBfX1BSSVZBVEVfc3luY0VuZ2luZUdldFJlbW90ZUtleXNGb3JUYXJnZXQuYmluZChudWxsLCB0KSwgXG4gICAgdC5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIucmVqZWN0TGlzdGVuID0gX19QUklWQVRFX3N5bmNFbmdpbmVSZWplY3RMaXN0ZW4uYmluZChudWxsLCB0KSwgXG4gICAgdC5UYS5yXyA9IF9fUFJJVkFURV9ldmVudE1hbmFnZXJPbldhdGNoQ2hhbmdlLmJpbmQobnVsbCwgdC5ldmVudE1hbmFnZXIpLCB0LlRhLlNhID0gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hFcnJvci5iaW5kKG51bGwsIHQuZXZlbnRNYW5hZ2VyKSwgXG4gICAgdDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVFbnN1cmVXcml0ZUNhbGxiYWNrcyhlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIHQucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlID0gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVN1Y2Nlc3NmdWxXcml0ZS5iaW5kKG51bGwsIHQpLCBcbiAgICB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5yZWplY3RGYWlsZWRXcml0ZSA9IF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0RmFpbGVkV3JpdGUuYmluZChudWxsLCB0KSwgXG4gICAgdDtcbn1cblxuLyoqXG4gKiBMb2FkcyBhIEZpcmVzdG9yZSBidW5kbGUgaW50byB0aGUgU0RLLiBUaGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcyB3aGVuXG4gKiB0aGUgYnVuZGxlIGZpbmlzaGVkIGxvYWRpbmcuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBTeW5jRW5naW5lIHRvIHVzZS5cbiAqIEBwYXJhbSBidW5kbGVSZWFkZXIgLSBCdW5kbGUgdG8gbG9hZCBpbnRvIHRoZSBTREsuXG4gKiBAcGFyYW0gdGFzayAtIExvYWRCdW5kbGVUYXNrIHVzZWQgdG8gdXBkYXRlIHRoZSBsb2FkaW5nIHByb2dyZXNzIHRvIHB1YmxpYyBBUEkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVMb2FkQnVuZGxlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIChcbiAgICAvKiogTG9hZHMgYSBidW5kbGUgYW5kIHJldHVybnMgdGhlIGxpc3Qgb2YgYWZmZWN0ZWQgY29sbGVjdGlvbiBncm91cHMuICovXG4gICAgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvYWRCdW5kbGVJbXBsKGUsIHQsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCB0LmdldE1ldGFkYXRhKCk7XG4gICAgICAgICAgICBpZiAoYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVIYXNOZXdlckJ1bmRsZShlLCB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5jcmVhdGVUaW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcImhhc05ld2VyQnVuZGxlXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5Rci5nZXRCdW5kbGVNZXRhZGF0YShlLCB0LmlkKSkpLnRoZW4oKGUgPT4gISFlICYmIGUuY3JlYXRlVGltZS5jb21wYXJlVG8ocikgPj0gMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBTYXZlcyB0aGUgZ2l2ZW4gYEJ1bmRsZU1ldGFkYXRhYCB0byBsb2NhbCBwZXJzaXN0ZW5jZS5cbiAqLyAoZS5sb2NhbFN0b3JlLCByKSkgcmV0dXJuIGF3YWl0IHQuY2xvc2UoKSwgbi5fY29tcGxldGVXaXRoKGZ1bmN0aW9uIF9fUFJJVkFURV9idW5kbGVTdWNjZXNzUHJvZ3Jlc3MoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0ZTogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50c0xvYWRlZDogZS50b3RhbERvY3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgYnl0ZXNMb2FkZWQ6IGUudG90YWxCeXRlcyxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxEb2N1bWVudHM6IGUudG90YWxEb2N1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXM6IGUudG90YWxCeXRlc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KHIpKSwgUHJvbWlzZS5yZXNvbHZlKG5ldyBTZXQpO1xuICAgICAgICAgICAgbi5fdXBkYXRlUHJvZ3Jlc3MoX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhyKSk7XG4gICAgICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9CdW5kbGVMb2FkZXIociwgZS5sb2NhbFN0b3JlLCB0LnNlcmlhbGl6ZXIpO1xuICAgICAgICAgICAgbGV0IHMgPSBhd2FpdCB0LmJhKCk7XG4gICAgICAgICAgICBmb3IgKDtzOyApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgaS5IXyhzKTtcbiAgICAgICAgICAgICAgICBlICYmIG4uX3VwZGF0ZVByb2dyZXNzKGUpLCBzID0gYXdhaXQgdC5iYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbyA9IGF3YWl0IGkuY29tcGxldGUoKTtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUoZSwgby5aXywgXG4gICAgICAgICAgICAvKiByZW1vdGVFdmVudCAqLyB2b2lkIDApLCBcbiAgICAgICAgICAgIC8vIFNhdmUgbWV0YWRhdGEsIHNvIGxvYWRpbmcgdGhlIHNhbWUgYnVuZGxlIHdpbGwgc2tpcC5cbiAgICAgICAgICAgIGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlU2F2ZUJ1bmRsZShlLCB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIGJ1bmRsZVwiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBuLlFyLnNhdmVCdW5kbGVNZXRhZGF0YShlLCB0KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGBOYW1lZFF1ZXJ5YCBhc3NvY2lhdGVkIHdpdGggZ2l2ZW4gcXVlcnkgbmFtZS4gUHJvbWlzZVxuICogcmVzb2x2ZXMgdG8gdW5kZWZpbmVkIGlmIG5vIHBlcnNpc3RlZCBkYXRhIGNhbiBiZSBmb3VuZC5cbiAqLyAoZS5sb2NhbFN0b3JlLCByKSwgbi5fY29tcGxldGVXaXRoKG8ucHJvZ3Jlc3MpLCBQcm9taXNlLnJlc29sdmUoby5ZXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nV2FybihcIlN5bmNFbmdpbmVcIiwgYExvYWRpbmcgYnVuZGxlIGZhaWxlZCB3aXRoICR7ZX1gKSwgbi5fZmFpbFdpdGgoZSksIFxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKG5ldyBTZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIGluLW1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAqIFVzZXMgRWFnZXJHQyBnYXJiYWdlIGNvbGxlY3Rpb24uXG4gKi8pKHIsIHQsIG4pLnRoZW4oKGUgPT4ge1xuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLm5vdGlmeUJ1bmRsZUxvYWRlZChlKTtcbiAgICB9KSk7XG59XG5cbmNsYXNzIE1lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc3luY2hyb25pemVUYWJzID0gITE7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUoZSkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcihlLmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkKSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHRoaXMuY3JlYXRlU2hhcmVkQ2xpZW50U3RhdGUoZSksIFxuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gdGhpcy5jcmVhdGVQZXJzaXN0ZW5jZShlKSwgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5zdGFydCgpLCB0aGlzLmxvY2FsU3RvcmUgPSB0aGlzLmNyZWF0ZUxvY2FsU3RvcmUoZSksIFxuICAgICAgICB0aGlzLmdjU2NoZWR1bGVyID0gdGhpcy5jcmVhdGVHYXJiYWdlQ29sbGVjdGlvblNjaGVkdWxlcihlLCB0aGlzLmxvY2FsU3RvcmUpLCB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlciA9IHRoaXMuY3JlYXRlSW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyKGUsIHRoaXMubG9jYWxTdG9yZSk7XG4gICAgfVxuICAgIGNyZWF0ZUdhcmJhZ2VDb2xsZWN0aW9uU2NoZWR1bGVyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNyZWF0ZUluZGV4QmFja2ZpbGxlclNjaGVkdWxlcihlLCB0KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjcmVhdGVMb2NhbFN0b3JlKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uZXdMb2NhbFN0b3JlKHRoaXMucGVyc2lzdGVuY2UsIG5ldyBfX1BSSVZBVEVfUXVlcnlFbmdpbmUsIGUuaW5pdGlhbFVzZXIsIHRoaXMuc2VyaWFsaXplcik7XG4gICAgfVxuICAgIGNyZWF0ZVBlcnNpc3RlbmNlKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5UGVyc2lzdGVuY2UoX19QUklWQVRFX01lbW9yeUVhZ2VyRGVsZWdhdGUuenIsIHRoaXMuc2VyaWFsaXplcik7XG4gICAgfVxuICAgIGNyZWF0ZVNoYXJlZENsaWVudFN0YXRlKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5U2hhcmVkQ2xpZW50U3RhdGU7XG4gICAgfVxuICAgIGFzeW5jIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgdGhpcy5nY1NjaGVkdWxlciAmJiB0aGlzLmdjU2NoZWR1bGVyLnN0b3AoKSwgYXdhaXQgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zaHV0ZG93bigpLCBcbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5zaHV0ZG93bigpO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0xydUdjTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIGV4dGVuZHMgTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSBlO1xuICAgIH1cbiAgICBjcmVhdGVHYXJiYWdlQ29sbGVjdGlvblNjaGVkdWxlcihlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KHRoaXMucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfTWVtb3J5THJ1RGVsZWdhdGUpO1xuICAgICAgICBjb25zdCBuID0gdGhpcy5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS5nYXJiYWdlQ29sbGVjdG9yO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9McnVTY2hlZHVsZXIobiwgZS5hc3luY1F1ZXVlLCB0KTtcbiAgICB9XG4gICAgY3JlYXRlUGVyc2lzdGVuY2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdm9pZCAwICE9PSB0aGlzLmNhY2hlU2l6ZUJ5dGVzID8gTHJ1UGFyYW1zLndpdGhDYWNoZVNpemUodGhpcy5jYWNoZVNpemVCeXRlcykgOiBMcnVQYXJhbXMuREVGQVVMVDtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5UGVyc2lzdGVuY2UoKGUgPT4gX19QUklWQVRFX01lbW9yeUxydURlbGVnYXRlLnpyKGUsIHQpKSwgdGhpcy5zZXJpYWxpemVyKTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYWxsIGNvbXBvbmVudHMgbmVlZGVkIGZvciBGaXJlc3RvcmUgd2l0aCBJbmRleGVkREIgcGVyc2lzdGVuY2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYk9mZmxpbmVDb21wb25lbnRQcm92aWRlciBleHRlbmRzIE1lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLkRhID0gZSwgdGhpcy5jYWNoZVNpemVCeXRlcyA9IHQsIHRoaXMuZm9yY2VPd25lcnNoaXAgPSBuLCB0aGlzLnN5bmNocm9uaXplVGFicyA9ICExO1xuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplKGUpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIuaW5pdGlhbGl6ZShlKSwgYXdhaXQgdGhpcy5EYS5pbml0aWFsaXplKHRoaXMsIGUpLCBcbiAgICAgICAgLy8gRW5xdWV1ZSB3cml0ZXMgZnJvbSBhIHByZXZpb3VzIHNlc3Npb25cbiAgICAgICAgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbnN1cmVXcml0ZUNhbGxiYWNrcyh0aGlzLkRhLnN5bmNFbmdpbmUpLCBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUodGhpcy5EYS5yZW1vdGVTdG9yZSksIFxuICAgICAgICAvLyBOT1RFOiBUaGlzIHdpbGwgaW1tZWRpYXRlbHkgY2FsbCB0aGUgbGlzdGVuZXIsIHNvIHdlIG1ha2Ugc3VyZSB0b1xuICAgICAgICAvLyBzZXQgaXQgYWZ0ZXIgbG9jYWxTdG9yZSAvIHJlbW90ZVN0b3JlIGFyZSBzdGFydGVkLlxuICAgICAgICBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLlZpKCgoKSA9PiAodGhpcy5nY1NjaGVkdWxlciAmJiAhdGhpcy5nY1NjaGVkdWxlci5zdGFydGVkICYmIHRoaXMuZ2NTY2hlZHVsZXIuc3RhcnQoKSwgXG4gICAgICAgIHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyICYmICF0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydGVkICYmIHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0YXJ0KCksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKTtcbiAgICB9XG4gICAgY3JlYXRlTG9jYWxTdG9yZShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmV3TG9jYWxTdG9yZSh0aGlzLnBlcnNpc3RlbmNlLCBuZXcgX19QUklWQVRFX1F1ZXJ5RW5naW5lLCBlLmluaXRpYWxVc2VyLCB0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbiAgICBjcmVhdGVHYXJiYWdlQ29sbGVjdGlvblNjaGVkdWxlcihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmdhcmJhZ2VDb2xsZWN0b3I7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0xydVNjaGVkdWxlcihuLCBlLmFzeW5jUXVldWUsIHQpO1xuICAgIH1cbiAgICBjcmVhdGVJbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9JbmRleEJhY2tmaWxsZXIodCwgdGhpcy5wZXJzaXN0ZW5jZSk7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0luZGV4QmFja2ZpbGxlclNjaGVkdWxlcihlLmFzeW5jUXVldWUsIG4pO1xuICAgIH1cbiAgICBjcmVhdGVQZXJzaXN0ZW5jZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfaW5kZXhlZERiU3RvcmFnZVByZWZpeChlLmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkLCBlLmRhdGFiYXNlSW5mby5wZXJzaXN0ZW5jZUtleSksIG4gPSB2b2lkIDAgIT09IHRoaXMuY2FjaGVTaXplQnl0ZXMgPyBMcnVQYXJhbXMud2l0aENhY2hlU2l6ZSh0aGlzLmNhY2hlU2l6ZUJ5dGVzKSA6IExydVBhcmFtcy5ERUZBVUxUO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJQZXJzaXN0ZW5jZSh0aGlzLnN5bmNocm9uaXplVGFicywgdCwgZS5jbGllbnRJZCwgbiwgZS5hc3luY1F1ZXVlLCBfX1BSSVZBVEVfZ2V0V2luZG93KCksIGdldERvY3VtZW50KCksIHRoaXMuc2VyaWFsaXplciwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSwgISF0aGlzLmZvcmNlT3duZXJzaGlwKTtcbiAgICB9XG4gICAgY3JlYXRlU2hhcmVkQ2xpZW50U3RhdGUoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlTaGFyZWRDbGllbnRTdGF0ZTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYWxsIGNvbXBvbmVudHMgbmVlZGVkIGZvciBGaXJlc3RvcmUgd2l0aCBtdWx0aS10YWIgSW5kZXhlZERCXG4gKiBwZXJzaXN0ZW5jZS5cbiAqXG4gKiBJbiB0aGUgbGVnYWN5IGNsaWVudCwgdGhpcyBwcm92aWRlciBpcyB1c2VkIHRvIHByb3ZpZGUgYm90aCBtdWx0aS10YWIgYW5kXG4gKiBub24tbXVsdGktdGFiIHBlcnNpc3RlbmNlIHNpbmNlIHdlIGNhbm5vdCB0ZWxsIGF0IGJ1aWxkIHRpbWUgd2hldGhlclxuICogYHN5bmNocm9uaXplVGFic2Agd2lsbCBiZSBlbmFibGVkLlxuICovIGNsYXNzIF9fUFJJVkFURV9NdWx0aVRhYk9mZmxpbmVDb21wb25lbnRQcm92aWRlciBleHRlbmRzIF9fUFJJVkFURV9JbmRleGVkRGJPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoZSwgdCwgLyogZm9yY2VPd25lcnNoaXA9ICovICExKSwgdGhpcy5EYSA9IGUsIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSB0LCB0aGlzLnN5bmNocm9uaXplVGFicyA9ICEwO1xuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplKGUpIHtcbiAgICAgICAgYXdhaXQgc3VwZXIuaW5pdGlhbGl6ZShlKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuRGEuc3luY0VuZ2luZTtcbiAgICAgICAgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9XZWJTdG9yYWdlU2hhcmVkQ2xpZW50U3RhdGUgJiYgKHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUuc3luY0VuZ2luZSA9IHtcbiAgICAgICAgICAgIEdzOiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5QmF0Y2hTdGF0ZS5iaW5kKG51bGwsIHQpLFxuICAgICAgICAgICAgenM6IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlUYXJnZXRTdGF0ZS5iaW5kKG51bGwsIHQpLFxuICAgICAgICAgICAganM6IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlBY3RpdmVUYXJnZXRzQ2hhbmdlLmJpbmQobnVsbCwgdCksXG4gICAgICAgICAgICBOaTogX19QUklWQVRFX3N5bmNFbmdpbmVHZXRBY3RpdmVDbGllbnRzLmJpbmQobnVsbCwgdCksXG4gICAgICAgICAgICBXczogX19QUklWQVRFX3N5bmNFbmdpbmVTeW5jaHJvbml6ZVdpdGhDaGFuZ2VkRG9jdW1lbnRzLmJpbmQobnVsbCwgdClcbiAgICAgICAgfSwgYXdhaXQgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zdGFydCgpKSwgXG4gICAgICAgIC8vIE5PVEU6IFRoaXMgd2lsbCBpbW1lZGlhdGVseSBjYWxsIHRoZSBsaXN0ZW5lciwgc28gd2UgbWFrZSBzdXJlIHRvXG4gICAgICAgIC8vIHNldCBpdCBhZnRlciBsb2NhbFN0b3JlIC8gcmVtb3RlU3RvcmUgYXJlIHN0YXJ0ZWQuXG4gICAgICAgIGF3YWl0IHRoaXMucGVyc2lzdGVuY2UuVmkoKGFzeW5jIGUgPT4ge1xuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVByaW1hcnlTdGF0ZSh0aGlzLkRhLnN5bmNFbmdpbmUsIGUpLCB0aGlzLmdjU2NoZWR1bGVyICYmIChlICYmICF0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0ZWQgPyB0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0KCkgOiBlIHx8IHRoaXMuZ2NTY2hlZHVsZXIuc3RvcCgpKSwgXG4gICAgICAgICAgICB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlciAmJiAoZSAmJiAhdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RhcnRlZCA/IHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0YXJ0KCkgOiBlIHx8IHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0b3AoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY3JlYXRlU2hhcmVkQ2xpZW50U3RhdGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2dldFdpbmRvdygpO1xuICAgICAgICBpZiAoIV9fUFJJVkFURV9XZWJTdG9yYWdlU2hhcmVkQ2xpZW50U3RhdGUudih0KSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuVU5JTVBMRU1FTlRFRCwgXCJJbmRleGVkREIgcGVyc2lzdGVuY2UgaXMgb25seSBhdmFpbGFibGUgb24gcGxhdGZvcm1zIHRoYXQgc3VwcG9ydCBMb2NhbFN0b3JhZ2UuXCIpO1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4ZWREYlN0b3JhZ2VQcmVmaXgoZS5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCwgZS5kYXRhYmFzZUluZm8ucGVyc2lzdGVuY2VLZXkpO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9XZWJTdG9yYWdlU2hhcmVkQ2xpZW50U3RhdGUodCwgZS5hc3luY1F1ZXVlLCBuLCBlLmNsaWVudElkLCBlLmluaXRpYWxVc2VyKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYW5kIHdpcmVzIHRoZSBjb21wb25lbnRzIHRoYXQgYXJlIG5lZWRlZCB0byBpbnRlcmZhY2Ugd2l0aCB0aGVcbiAqIG5ldHdvcmsuXG4gKi8gY2xhc3MgT25saW5lQ29tcG9uZW50UHJvdmlkZXIge1xuICAgIGFzeW5jIGluaXRpYWxpemUoZSwgdCkge1xuICAgICAgICB0aGlzLmxvY2FsU3RvcmUgfHwgKHRoaXMubG9jYWxTdG9yZSA9IGUubG9jYWxTdG9yZSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IGUuc2hhcmVkQ2xpZW50U3RhdGUsIFxuICAgICAgICB0aGlzLmRhdGFzdG9yZSA9IHRoaXMuY3JlYXRlRGF0YXN0b3JlKHQpLCB0aGlzLnJlbW90ZVN0b3JlID0gdGhpcy5jcmVhdGVSZW1vdGVTdG9yZSh0KSwgXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gdGhpcy5jcmVhdGVFdmVudE1hbmFnZXIodCksIHRoaXMuc3luY0VuZ2luZSA9IHRoaXMuY3JlYXRlU3luY0VuZ2luZSh0LCBcbiAgICAgICAgLyogc3RhcnRBc1ByaW1hcnk9Ki8gIWUuc3luY2hyb25pemVUYWJzKSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5vbmxpbmVTdGF0ZUhhbmRsZXIgPSBlID0+IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlPbmxpbmVTdGF0ZUNoYW5nZSh0aGlzLnN5bmNFbmdpbmUsIGUsIDEgLyogT25saW5lU3RhdGVTb3VyY2UuU2hhcmVkQ2xpZW50U3RhdGUgKi8pLCBcbiAgICAgICAgdGhpcy5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIuaGFuZGxlQ3JlZGVudGlhbENoYW5nZSA9IF9fUFJJVkFURV9zeW5jRW5naW5lSGFuZGxlQ3JlZGVudGlhbENoYW5nZS5iaW5kKG51bGwsIHRoaXMuc3luY0VuZ2luZSksIFxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVBcHBseVByaW1hcnlTdGF0ZSh0aGlzLnJlbW90ZVN0b3JlLCB0aGlzLnN5bmNFbmdpbmUuaXNQcmltYXJ5Q2xpZW50KSk7XG4gICAgfVxuICAgIGNyZWF0ZUV2ZW50TWFuYWdlcihlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3RXZlbnRNYW5hZ2VyKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfRXZlbnRNYW5hZ2VySW1wbDtcbiAgICAgICAgfSgpO1xuICAgIH1cbiAgICBjcmVhdGVEYXRhc3RvcmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZS5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCksIG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3Q29ubmVjdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9XZWJDaGFubmVsQ29ubmVjdGlvbihlKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJuIHRoZSBQbGF0Zm9ybS1zcGVjaWZpYyBjb25uZWN0aXZpdHkgbW9uaXRvci4gKi8gKGUuZGF0YWJhc2VJbmZvKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdEYXRhc3RvcmUoZSwgdCwgbiwgcikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfRGF0YXN0b3JlSW1wbChlLCB0LCBuLCByKTtcbiAgICAgICAgfShlLmF1dGhDcmVkZW50aWFscywgZS5hcHBDaGVja0NyZWRlbnRpYWxzLCBuLCB0KTtcbiAgICB9XG4gICAgY3JlYXRlUmVtb3RlU3RvcmUoZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld1JlbW90ZVN0b3JlKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1JlbW90ZVN0b3JlSW1wbChlLCB0LCBuLCByLCBpKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmUtZW5hYmxlcyB0aGUgbmV0d29yay4gSWRlbXBvdGVudC4gKi8gKHRoaXMubG9jYWxTdG9yZSwgdGhpcy5kYXRhc3RvcmUsIGUuYXN5bmNRdWV1ZSwgKGUgPT4gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseU9ubGluZVN0YXRlQ2hhbmdlKHRoaXMuc3luY0VuZ2luZSwgZSwgMCAvKiBPbmxpbmVTdGF0ZVNvdXJjZS5SZW1vdGVTdG9yZSAqLykpLCBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3Q29ubmVjdGl2aXR5TW9uaXRvcigpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfQnJvd3NlckNvbm5lY3Rpdml0eU1vbml0b3IudigpID8gbmV3IF9fUFJJVkFURV9Ccm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvciA6IG5ldyBfX1BSSVZBVEVfTm9vcENvbm5lY3Rpdml0eU1vbml0b3I7XG4gICAgICAgIH0oKSk7XG4gICAgfVxuICAgIGNyZWF0ZVN5bmNFbmdpbmUoZSwgdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld1N5bmNFbmdpbmUoZSwgdCwgbiwgXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTWFuYWdlcyBzdGF0ZSBzeW5jaHJvbml6YXRpb24gaW4gbXVsdGktdGFiIGVudmlyb25tZW50cy5cbiAgICAgICAgciwgaSwgcywgbykge1xuICAgICAgICAgICAgY29uc3QgXyA9IG5ldyBfX1BSSVZBVEVfU3luY0VuZ2luZUltcGwoZSwgdCwgbiwgciwgaSwgcyk7XG4gICAgICAgICAgICByZXR1cm4gbyAmJiAoXy55YSA9ICEwKSwgXztcbiAgICAgICAgfSh0aGlzLmxvY2FsU3RvcmUsIHRoaXMucmVtb3RlU3RvcmUsIHRoaXMuZXZlbnRNYW5hZ2VyLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLCBlLmluaXRpYWxVc2VyLCBlLm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zLCB0KTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3JlbW90ZVN0b3JlU2h1dGRvd24oZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJSZW1vdGVTdG9yZVwiLCBcIlJlbW90ZVN0b3JlIHNodXR0aW5nIGRvd24uXCIpLCB0LnlfLmFkZCg1IC8qIE9mZmxpbmVDYXVzZS5TaHV0ZG93biAqLyksIFxuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrSW50ZXJuYWwodCksIHQuU18uc2h1dGRvd24oKSwgXG4gICAgICAgICAgICAvLyBTZXQgdGhlIE9ubGluZVN0YXRlIHRvIFVua25vd24gKHJhdGhlciB0aGFuIE9mZmxpbmUpIHRvIGF2b2lkIHBvdGVudGlhbGx5XG4gICAgICAgICAgICAvLyB0cmlnZ2VyaW5nIHNwdXJpb3VzIGxpc3RlbmVyIGV2ZW50cyB3aXRoIGNhY2hlZCBkYXRhLCBldGMuXG4gICAgICAgICAgICB0LmJfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKTtcbiAgICAgICAgfSh0aGlzLnJlbW90ZVN0b3JlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEhvdyBtYW55IGJ5dGVzIHRvIHJlYWQgZWFjaCB0aW1lIHdoZW4gYFJlYWRhYmxlU3RyZWFtUmVhZGVyLnJlYWQoKWAgaXNcbiAqIGNhbGxlZC4gT25seSBhcHBsaWNhYmxlIGZvciBieXRlIHN0cmVhbXMgdGhhdCB3ZSBjb250cm9sIChlLmcuIHRob3NlIGJhY2tlZFxuICogYnkgYW4gVUludDhBcnJheSkuXG4gKi9cbi8qKlxuICogQnVpbGRzIGEgYEJ5dGVTdHJlYW1SZWFkZXJgIGZyb20gYSBVSW50OEFycmF5LlxuICogQHBhcmFtIHNvdXJjZSAtIFRoZSBkYXRhIHNvdXJjZSB0byB1c2UuXG4gKiBAcGFyYW0gYnl0ZXNQZXJSZWFkIC0gSG93IG1hbnkgYnl0ZXMgZWFjaCBgcmVhZCgpYCBmcm9tIHRoZSByZXR1cm5lZCByZWFkZXJcbiAqICAgICAgICB3aWxsIHJlYWQuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0J5dGVTdHJlYW1SZWFkZXJIZWxwZXIoZSwgdCA9IDEwMjQwKSB7XG4gICAgbGV0IG4gPSAwO1xuICAgIC8vIFRoZSBUeXBlU2NyaXB0IGRlZmluaXRpb24gZm9yIFJlYWRhYmxlU3RyZWFtUmVhZGVyIGNoYW5nZWQuIFdlIHVzZVxuICAgIC8vIGBhbnlgIGhlcmUgdG8gYWxsb3cgdGhpcyBjb2RlIHRvIGNvbXBpbGUgd2l0aCBkaWZmZXJlbnQgdmVyc2lvbnMuXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvNDI5NzBcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICBhc3luYyByZWFkKCkge1xuICAgICAgICAgICAgaWYgKG4gPCBlLmJ5dGVMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0ge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZS5zbGljZShuLCBuICsgdCksXG4gICAgICAgICAgICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbiArPSB0LCByO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkb25lOiAhMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgY2FuY2VsKCkge30sXG4gICAgICAgIHJlbGVhc2VMb2NrKCkge30sXG4gICAgICAgIGNsb3NlZDogUHJvbWlzZS5yZXNvbHZlKClcbiAgICB9O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBPbiB3ZWIsIGEgYFJlYWRhYmxlU3RyZWFtYCBpcyB3cmFwcGVkIGFyb3VuZCBieSBhIGBCeXRlU3RyZWFtUmVhZGVyYC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qXG4gKiBBIHdyYXBwZXIgaW1wbGVtZW50YXRpb24gb2YgT2JzZXJ2ZXI8VD4gdGhhdCB3aWxsIGRpc3BhdGNoIGV2ZW50c1xuICogYXN5bmNocm9ub3VzbHkuIFRvIGFsbG93IGltbWVkaWF0ZSBzaWxlbmNpbmcsIGEgbXV0ZSBjYWxsIGlzIGFkZGVkIHdoaWNoXG4gKiBjYXVzZXMgZXZlbnRzIHNjaGVkdWxlZCB0byBubyBsb25nZXIgYmUgcmFpc2VkLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gZSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGVuIHNldCB0byB0cnVlLCB3aWxsIG5vdCByYWlzZSBmdXR1cmUgZXZlbnRzLiBOZWNlc3NhcnkgdG8gZGVhbCB3aXRoXG4gICAgICAgICAqIGFzeW5jIGRldGFjaG1lbnQgb2YgbGlzdGVuZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm11dGVkID0gITE7XG4gICAgfVxuICAgIG5leHQoZSkge1xuICAgICAgICB0aGlzLm9ic2VydmVyLm5leHQgJiYgdGhpcy52YSh0aGlzLm9ic2VydmVyLm5leHQsIGUpO1xuICAgIH1cbiAgICBlcnJvcihlKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIuZXJyb3IgPyB0aGlzLnZhKHRoaXMub2JzZXJ2ZXIuZXJyb3IsIGUpIDogX19QUklWQVRFX2xvZ0Vycm9yKFwiVW5jYXVnaHQgRXJyb3IgaW4gc25hcHNob3QgbGlzdGVuZXI6XCIsIGUudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIENhKCkge1xuICAgICAgICB0aGlzLm11dGVkID0gITA7XG4gICAgfVxuICAgIHZhKGUsIHQpIHtcbiAgICAgICAgdGhpcy5tdXRlZCB8fCBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm11dGVkIHx8IGUodCk7XG4gICAgICAgIH0pLCAwKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgY2xhc3MgcmVwcmVzZW50aW5nIGEgYnVuZGxlLlxuICpcbiAqIFRha2VzIGEgYnVuZGxlIHN0cmVhbSBvciBidWZmZXIsIGFuZCBwcmVzZW50cyBhYnN0cmFjdGlvbnMgdG8gcmVhZCBidW5kbGVkXG4gKiBlbGVtZW50cyBvdXQgb2YgdGhlIHVuZGVybHlpbmcgY29udGVudC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQnVuZGxlUmVhZGVySW1wbCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSByZWFkZXIgdG8gcmVhZCBmcm9tIHVuZGVybHlpbmcgYmluYXJ5IGJ1bmRsZSBkYXRhIHNvdXJjZS4gKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHRoaXMuRmEgPSBlLCB0aGlzLnNlcmlhbGl6ZXIgPSB0LCBcbiAgICAgICAgLyoqIENhY2hlZCBidW5kbGUgbWV0YWRhdGEuICovXG4gICAgICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGJ1ZmZlciB0byBob2xkIGJ1bmRsZSBjb250ZW50LCBhY2N1bXVsYXRpbmcgaW5jb21wbGV0ZSBlbGVtZW50XG4gICAgICAgICAqIGNvbnRlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBVaW50OEFycmF5LCB0aGlzLk1hID0gZnVuY3Rpb24gX19QUklWQVRFX25ld1RleHREZWNvZGVyKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcihcInV0Zi04XCIpO1xuICAgICAgICB9KCksIFxuICAgICAgICAvLyBSZWFkIHRoZSBtZXRhZGF0YSAod2hpY2ggaXMgdGhlIGZpcnN0IGVsZW1lbnQpLlxuICAgICAgICB0aGlzLnhhKCkudGhlbigoZSA9PiB7XG4gICAgICAgICAgICBlICYmIGUuel8oKSA/IHRoaXMubWV0YWRhdGEucmVzb2x2ZShlLkdfLm1ldGFkYXRhKSA6IHRoaXMubWV0YWRhdGEucmVqZWN0KG5ldyBFcnJvcihgVGhlIGZpcnN0IGVsZW1lbnQgb2YgdGhlIGJ1bmRsZSBpcyBub3QgYSBtZXRhZGF0YSwgaXQgaXNcXG4gICAgICAgICAgICAgJHtKU09OLnN0cmluZ2lmeShudWxsID09IGUgPyB2b2lkIDAgOiBlLkdfKX1gKSk7XG4gICAgICAgIH0pLCAoZSA9PiB0aGlzLm1ldGFkYXRhLnJlamVjdChlKSkpO1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRmEuY2FuY2VsKCk7XG4gICAgfVxuICAgIGFzeW5jIGdldE1ldGFkYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5wcm9taXNlO1xuICAgIH1cbiAgICBhc3luYyBiYSgpIHtcbiAgICAgICAgLy8gTWFrZXMgc3VyZSBtZXRhZGF0YSBpcyByZWFkIGJlZm9yZSBwcm9jZWVkaW5nLlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRNZXRhZGF0YSgpLCB0aGlzLnhhKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gdGhlIGhlYWQgb2YgaW50ZXJuYWwgYnVmZmVyLCBhbmQgcHVsbGluZyBtb3JlIGRhdGEgZnJvbVxuICAgICAqIHVuZGVybHlpbmcgc3RyZWFtIGlmIGEgY29tcGxldGUgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQsIHVudGlsIGFuXG4gICAgICogZWxlbWVudChpbmNsdWRpbmcgdGhlIHByZWZpeGVkIGxlbmd0aCBhbmQgdGhlIEpTT04gc3RyaW5nKSBpcyBmb3VuZC5cbiAgICAgKlxuICAgICAqIE9uY2UgYSBjb21wbGV0ZSBlbGVtZW50IGlzIHJlYWQsIGl0IGlzIGRyb3BwZWQgZnJvbSBpbnRlcm5hbCBidWZmZXIuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGVpdGhlciB0aGUgYnVuZGxlZCBlbGVtZW50LCBvciBudWxsIGlmIHdlIGhhdmUgcmVhY2hlZCB0aGUgZW5kIG9mXG4gICAgICogdGhlIHN0cmVhbS5cbiAgICAgKi8gICAgYXN5bmMgeGEoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLk9hKCk7XG4gICAgICAgIGlmIChudWxsID09PSBlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuTWEuZGVjb2RlKGUpLCBuID0gTnVtYmVyKHQpO1xuICAgICAgICBpc05hTihuKSAmJiB0aGlzLk5hKGBsZW5ndGggc3RyaW5nICgke3R9KSBpcyBub3QgdmFsaWQgbnVtYmVyYCk7XG4gICAgICAgIGNvbnN0IHIgPSBhd2FpdCB0aGlzLkJhKG4pO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9TaXplZEJ1bmRsZUVsZW1lbnQoSlNPTi5wYXJzZShyKSwgZS5sZW5ndGggKyBuKTtcbiAgICB9XG4gICAgLyoqIEZpcnN0IGluZGV4IG9mICd7JyBmcm9tIHRoZSB1bmRlcmx5aW5nIGJ1ZmZlci4gKi8gICAgTGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5maW5kSW5kZXgoKGUgPT4gZSA9PT0gXCJ7XCIuY2hhckNvZGVBdCgwKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGludGVybmFsIGJ1ZmZlciwgdW50aWwgdGhlIGZpcnN0ICd7JywgYW5kXG4gICAgICogcmV0dXJuIHRoZSBjb250ZW50LlxuICAgICAqXG4gICAgICogSWYgcmVhY2hlZCBlbmQgb2YgdGhlIHN0cmVhbSwgcmV0dXJucyBhIG51bGwuXG4gICAgICovICAgIGFzeW5jIE9hKCkge1xuICAgICAgICBmb3IgKDt0aGlzLkxhKCkgPCAwOyApIHtcbiAgICAgICAgICAgIGlmIChhd2FpdCB0aGlzLmthKCkpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJyb2tlIG91dCBvZiB0aGUgbG9vcCBiZWNhdXNlIHVuZGVybHlpbmcgc3RyZWFtIGlzIGNsb3NlZCwgYW5kIHRoZXJlXG4gICAgICAgIC8vIGhhcHBlbnMgdG8gYmUgbm8gbW9yZSBkYXRhIHRvIHByb2Nlc3MuXG4gICAgICAgICAgICAgICAgaWYgKDAgPT09IHRoaXMuYnVmZmVyLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLkxhKCk7XG4gICAgICAgIC8vIEJyb2tlIG91dCBvZiB0aGUgbG9vcCBiZWNhdXNlIHVuZGVybHlpbmcgc3RyZWFtIGlzIGNsb3NlZCwgYnV0IHN0aWxsXG4gICAgICAgIC8vIGNhbm5vdCBmaW5kIGFuIG9wZW4gYnJhY2tldC5cbiAgICAgICAgICAgICAgICBlIDwgMCAmJiB0aGlzLk5hKFwiUmVhY2hlZCB0aGUgZW5kIG9mIGJ1bmRsZSB3aGVuIGEgbGVuZ3RoIHN0cmluZyBpcyBleHBlY3RlZC5cIik7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmJ1ZmZlci5zbGljZSgwLCBlKTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnRlcm5hbCBidWZmZXIgdG8gZHJvcCB0aGUgcmVhZCBsZW5ndGguXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuc2xpY2UoZSksIHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gYSBzcGVjaWZpZWQgcG9zaXRpb24gZnJvbSB0aGUgaW50ZXJuYWwgYnVmZmVyLCBmb3IgYSBzcGVjaWZpZWRcbiAgICAgKiBudW1iZXIgb2YgYnl0ZXMsIHB1bGxpbmcgbW9yZSBkYXRhIGZyb20gdGhlIHVuZGVybHlpbmcgc3RyZWFtIGlmIG5lZWRlZC5cbiAgICAgKlxuICAgICAqIFJldHVybnMgYSBzdHJpbmcgZGVjb2RlZCBmcm9tIHRoZSByZWFkIGJ5dGVzLlxuICAgICAqLyAgICBhc3luYyBCYShlKSB7XG4gICAgICAgIGZvciAoO3RoaXMuYnVmZmVyLmxlbmd0aCA8IGU7ICkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5rYSgpICYmIHRoaXMuTmEoXCJSZWFjaGVkIHRoZSBlbmQgb2YgYnVuZGxlIHdoZW4gbW9yZSBpcyBleHBlY3RlZC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdCA9IHRoaXMuTWEuZGVjb2RlKHRoaXMuYnVmZmVyLnNsaWNlKDAsIGUpKTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnRlcm5hbCBidWZmZXIgdG8gZHJvcCB0aGUgcmVhZCBqc29uIHN0cmluZy5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5zbGljZShlKSwgdDtcbiAgICB9XG4gICAgTmEoZSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHRocm93IHRoaXMuRmEuY2FuY2VsKCksIG5ldyBFcnJvcihgSW52YWxpZCBidW5kbGUgZm9ybWF0OiAke2V9YCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFB1bGxzIG1vcmUgZGF0YSBmcm9tIHVuZGVybHlpbmcgc3RyZWFtIHRvIGludGVybmFsIGJ1ZmZlci5cbiAgICAgKiBSZXR1cm5zIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHN0cmVhbSBpcyBmaW5pc2hlZC5cbiAgICAgKi8gICAgYXN5bmMga2EoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLkZhLnJlYWQoKTtcbiAgICAgICAgaWYgKCFlLmRvbmUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlci5sZW5ndGggKyBlLnZhbHVlLmxlbmd0aCk7XG4gICAgICAgICAgICB0LnNldCh0aGlzLmJ1ZmZlciksIHQuc2V0KGUudmFsdWUsIHRoaXMuYnVmZmVyLmxlbmd0aCksIHRoaXMuYnVmZmVyID0gdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZS5kb25lO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW50ZXJuYWwgdHJhbnNhY3Rpb24gb2JqZWN0IHJlc3BvbnNpYmxlIGZvciBhY2N1bXVsYXRpbmcgdGhlIG11dGF0aW9ucyB0b1xuICogcGVyZm9ybSBhbmQgdGhlIGJhc2UgdmVyc2lvbnMgZm9yIGFueSBkb2N1bWVudHMgcmVhZC5cbiAqL1xuY2xhc3MgVHJhbnNhY3Rpb24kMiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmRhdGFzdG9yZSA9IGUsIFxuICAgICAgICAvLyBUaGUgdmVyc2lvbiBvZiBlYWNoIGRvY3VtZW50IHRoYXQgd2FzIHJlYWQgZHVyaW5nIHRoaXMgdHJhbnNhY3Rpb24uXG4gICAgICAgIHRoaXMucmVhZFZlcnNpb25zID0gbmV3IE1hcCwgdGhpcy5tdXRhdGlvbnMgPSBbXSwgdGhpcy5jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGRlZmVycmVkIHVzYWdlIGVycm9yIHRoYXQgb2NjdXJyZWQgcHJldmlvdXNseSBpbiB0aGlzIHRyYW5zYWN0aW9uIHRoYXRcbiAgICAgICAgICogd2lsbCBjYXVzZSB0aGUgdHJhbnNhY3Rpb24gdG8gZmFpbCBvbmNlIGl0IGFjdHVhbGx5IGNvbW1pdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxhc3RXcml0ZUVycm9yID0gbnVsbCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgb2YgZG9jdW1lbnRzIHRoYXQgaGF2ZSBiZWVuIHdyaXR0ZW4gaW4gdGhlIHRyYW5zYWN0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaGVuIHRoZXJlJ3MgbW9yZSB0aGFuIG9uZSB3cml0ZSB0byB0aGUgc2FtZSBrZXkgaW4gYSB0cmFuc2FjdGlvbiwgYW55XG4gICAgICAgICAqIHdyaXRlcyBhZnRlciB0aGUgZmlyc3QgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndyaXR0ZW5Eb2NzID0gbmV3IFNldDtcbiAgICB9XG4gICAgYXN5bmMgbG9va3VwKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuZW5zdXJlQ29tbWl0Tm90Q2FsbGVkKCksIHRoaXMubXV0YXRpb25zLmxlbmd0aCA+IDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiRmlyZXN0b3JlIHRyYW5zYWN0aW9ucyByZXF1aXJlIGFsbCByZWFkcyB0byBiZSBleGVjdXRlZCBiZWZvcmUgYWxsIHdyaXRlcy5cIik7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW52b2tlQmF0Y2hHZXREb2N1bWVudHNScGMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZ2V0RW5jb2RlZERhdGFiYXNlSWQobi5zZXJpYWxpemVyKSArIFwiL2RvY3VtZW50c1wiLCBpID0ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50czogdC5tYXAoKGUgPT4gX19QUklWQVRFX3RvTmFtZShuLnNlcmlhbGl6ZXIsIGUpKSlcbiAgICAgICAgICAgIH0sIHMgPSBhd2FpdCBuLnlvKFwiQmF0Y2hHZXREb2N1bWVudHNcIiwgciwgaSwgdC5sZW5ndGgpLCBvID0gbmV3IE1hcDtcbiAgICAgICAgICAgIHMuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tQmF0Y2hHZXREb2N1bWVudHNSZXNwb25zZShuLnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICAgICAgICAgIG8uc2V0KHQua2V5LnRvU3RyaW5nKCksIHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgXyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IG8uZ2V0KGUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoISF0KSwgXy5wdXNoKHQpO1xuICAgICAgICAgICAgfSkpLCBfO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCBlKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB0aGlzLnJlY29yZFZlcnNpb24oZSkpKSwgdDtcbiAgICB9XG4gICAgc2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy53cml0ZSh0LnRvTXV0YXRpb24oZSwgdGhpcy5wcmVjb25kaXRpb24oZSkpKSwgdGhpcy53cml0dGVuRG9jcy5hZGQoZS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3JpdGUodC50b011dGF0aW9uKGUsIHRoaXMucHJlY29uZGl0aW9uRm9yVXBkYXRlKGUpKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFdyaXRlRXJyb3IgPSBlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MuYWRkKGUudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIHRoaXMud3JpdGUobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLCB0aGlzLnByZWNvbmRpdGlvbihlKSkpLCB0aGlzLndyaXR0ZW5Eb2NzLmFkZChlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBhc3luYyBjb21taXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLmxhc3RXcml0ZUVycm9yKSB0aHJvdyB0aGlzLmxhc3RXcml0ZUVycm9yO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5yZWFkVmVyc2lvbnM7XG4gICAgICAgIC8vIEZvciBlYWNoIG11dGF0aW9uLCBub3RlIHRoYXQgdGhlIGRvYyB3YXMgd3JpdHRlbi5cbiAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUuZGVsZXRlKHQua2V5LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSksIFxuICAgICAgICAvLyBGb3IgZWFjaCBkb2N1bWVudCB0aGF0IHdhcyByZWFkIGJ1dCBub3Qgd3JpdHRlbiB0bywgd2Ugd2FudCB0byBwZXJmb3JtXG4gICAgICAgIC8vIGEgYHZlcmlmeWAgb3BlcmF0aW9uLlxuICAgICAgICBlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gRG9jdW1lbnRLZXkuZnJvbVBhdGgodCk7XG4gICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5wdXNoKG5ldyBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24obiwgdGhpcy5wcmVjb25kaXRpb24obikpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW52b2tlQ29tbWl0UnBjKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gX19QUklWQVRFX2dldEVuY29kZWREYXRhYmFzZUlkKG4uc2VyaWFsaXplcikgKyBcIi9kb2N1bWVudHNcIiwgaSA9IHtcbiAgICAgICAgICAgICAgICB3cml0ZXM6IHQubWFwKChlID0+IHRvTXV0YXRpb24obi5zZXJpYWxpemVyLCBlKSkpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbi5WbyhcIkNvbW1pdFwiLCByLCBpKTtcbiAgICAgICAgfSh0aGlzLmRhdGFzdG9yZSwgdGhpcy5tdXRhdGlvbnMpLCB0aGlzLmNvbW1pdHRlZCA9ICEwO1xuICAgIH1cbiAgICByZWNvcmRWZXJzaW9uKGUpIHtcbiAgICAgICAgbGV0IHQ7XG4gICAgICAgIGlmIChlLmlzRm91bmREb2N1bWVudCgpKSB0ID0gZS52ZXJzaW9uOyBlbHNlIHtcbiAgICAgICAgICAgIGlmICghZS5pc05vRG9jdW1lbnQoKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICAgICAgLy8gUmVwcmVzZW50IGEgZGVsZXRlZCBkb2MgdXNpbmcgU25hcHNob3RWZXJzaW9uLm1pbigpLlxuICAgICAgICAgICAgdCA9IFNuYXBzaG90VmVyc2lvbi5taW4oKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuID0gdGhpcy5yZWFkVmVyc2lvbnMuZ2V0KGUua2V5LnRvU3RyaW5nKCkpO1xuICAgICAgICBpZiAobikge1xuICAgICAgICAgICAgaWYgKCF0LmlzRXF1YWwobikpIFxuICAgICAgICAgICAgLy8gVGhpcyB0cmFuc2FjdGlvbiB3aWxsIGZhaWwgbm8gbWF0dGVyIHdoYXQuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5BQk9SVEVELCBcIkRvY3VtZW50IHZlcnNpb24gY2hhbmdlZCBiZXR3ZWVuIHR3byByZWFkcy5cIik7XG4gICAgICAgIH0gZWxzZSB0aGlzLnJlYWRWZXJzaW9ucy5zZXQoZS5rZXkudG9TdHJpbmcoKSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHZlcnNpb24gb2YgdGhpcyBkb2N1bWVudCB3aGVuIGl0IHdhcyByZWFkIGluIHRoaXMgdHJhbnNhY3Rpb24sXG4gICAgICogYXMgYSBwcmVjb25kaXRpb24sIG9yIG5vIHByZWNvbmRpdGlvbiBpZiBpdCB3YXMgbm90IHJlYWQuXG4gICAgICovICAgIHByZWNvbmRpdGlvbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQoZS50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuICF0aGlzLndyaXR0ZW5Eb2NzLmhhcyhlLnRvU3RyaW5nKCkpICYmIHQgPyB0LmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSA/IFByZWNvbmRpdGlvbi5leGlzdHMoITEpIDogUHJlY29uZGl0aW9uLnVwZGF0ZVRpbWUodCkgOiBQcmVjb25kaXRpb24ubm9uZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBwcmVjb25kaXRpb24gZm9yIGEgZG9jdW1lbnQgaWYgdGhlIG9wZXJhdGlvbiBpcyBhbiB1cGRhdGUuXG4gICAgICovICAgIHByZWNvbmRpdGlvbkZvclVwZGF0ZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQoZS50b1N0cmluZygpKTtcbiAgICAgICAgLy8gVGhlIGZpcnN0IHRpbWUgYSBkb2N1bWVudCBpcyB3cml0dGVuLCB3ZSB3YW50IHRvIHRha2UgaW50byBhY2NvdW50IHRoZVxuICAgICAgICAvLyByZWFkIHRpbWUgYW5kIGV4aXN0ZW5jZVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy53cml0dGVuRG9jcy5oYXMoZS50b1N0cmluZygpKSAmJiB0KSB7XG4gICAgICAgICAgICBpZiAodC5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkpIFxuICAgICAgICAgICAgLy8gVGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QsIHNvIGZhaWwgdGhlIHRyYW5zYWN0aW9uLlxuICAgICAgICAgICAgLy8gVGhpcyBoYXMgdG8gYmUgdmFsaWRhdGVkIGxvY2FsbHkgYmVjYXVzZSB5b3UgY2FuJ3Qgc2VuZCBhXG4gICAgICAgICAgICAvLyBwcmVjb25kaXRpb24gdGhhdCBhIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0IHdpdGhvdXQgY2hhbmdpbmcgdGhlXG4gICAgICAgICAgICAvLyBzZW1hbnRpY3Mgb2YgdGhlIGJhY2tlbmQgd3JpdGUgdG8gYmUgYW4gaW5zZXJ0LiBUaGlzIGlzIHRoZSByZXZlcnNlXG4gICAgICAgICAgICAvLyBvZiB3aGF0IHdlIHdhbnQsIHNpbmNlIHdlIHdhbnQgdG8gYXNzZXJ0IHRoYXQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgIC8vIGV4aXN0IGJ1dCB0aGVuIHNlbmQgdGhlIHVwZGF0ZSBhbmQgaGF2ZSBpdCBmYWlsLiBTaW5jZSB3ZSBjYW4ndFxuICAgICAgICAgICAgLy8gZXhwcmVzcyB0aGF0IHRvIHRoZSBiYWNrZW5kLCB3ZSBoYXZlIHRvIHZhbGlkYXRlIGxvY2FsbHkuXG4gICAgICAgICAgICAvLyBOb3RlOiB0aGlzIGNhbiBjaGFuZ2Ugb25jZSB3ZSBjYW4gc2VuZCBzZXBhcmF0ZSB2ZXJpZnkgd3JpdGVzIGluIHRoZVxuICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIkNhbid0IHVwZGF0ZSBhIGRvY3VtZW50IHRoYXQgZG9lc24ndCBleGlzdC5cIik7XG4gICAgICAgICAgICAvLyBEb2N1bWVudCBleGlzdHMsIGJhc2UgcHJlY29uZGl0aW9uIG9uIGRvY3VtZW50IHVwZGF0ZSB0aW1lLlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByZWNvbmRpdGlvbi51cGRhdGVUaW1lKHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvY3VtZW50IHdhcyBub3QgcmVhZCwgc28gd2UganVzdCB1c2UgdGhlIHByZWNvbmRpdGlvbnMgZm9yIGEgYmxpbmRcbiAgICAgICAgLy8gdXBkYXRlLlxuICAgICAgICByZXR1cm4gUHJlY29uZGl0aW9uLmV4aXN0cyghMCk7XG4gICAgfVxuICAgIHdyaXRlKGUpIHtcbiAgICAgICAgdGhpcy5lbnN1cmVDb21taXROb3RDYWxsZWQoKSwgdGhpcy5tdXRhdGlvbnMucHVzaChlKTtcbiAgICB9XG4gICAgZW5zdXJlQ29tbWl0Tm90Q2FsbGVkKCkge31cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVHJhbnNhY3Rpb25SdW5uZXIgZW5jYXBzdWxhdGVzIHRoZSBsb2dpYyBuZWVkZWQgdG8gcnVuIGFuZCByZXRyeSB0cmFuc2FjdGlvbnNcbiAqIHdpdGggYmFja29mZi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfVHJhbnNhY3Rpb25SdW5uZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy5kYXRhc3RvcmUgPSB0LCB0aGlzLm9wdGlvbnMgPSBuLCB0aGlzLnVwZGF0ZUZ1bmN0aW9uID0gciwgXG4gICAgICAgIHRoaXMuZGVmZXJyZWQgPSBpLCB0aGlzLnFhID0gbi5tYXhBdHRlbXB0cywgdGhpcy5LbyA9IG5ldyBfX1BSSVZBVEVfRXhwb25lbnRpYWxCYWNrb2ZmKHRoaXMuYXN5bmNRdWV1ZSwgXCJ0cmFuc2FjdGlvbl9yZXRyeVwiIC8qIFRpbWVySWQuVHJhbnNhY3Rpb25SZXRyeSAqLyk7XG4gICAgfVxuICAgIC8qKiBSdW5zIHRoZSB0cmFuc2FjdGlvbiBhbmQgc2V0cyB0aGUgcmVzdWx0IG9uIGRlZmVycmVkLiAqLyAgICBydW4oKSB7XG4gICAgICAgIHRoaXMucWEgLT0gMSwgdGhpcy5RYSgpO1xuICAgIH1cbiAgICBRYSgpIHtcbiAgICAgICAgdGhpcy5Lby54bygoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBUcmFuc2FjdGlvbiQyKHRoaXMuZGF0YXN0b3JlKSwgdCA9IHRoaXMuS2EoZSk7XG4gICAgICAgICAgICB0ICYmIHQudGhlbigodCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IGUuY29tbWl0KCkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmVycmVkLnJlc29sdmUodCk7XG4gICAgICAgICAgICAgICAgfSkpLmNhdGNoKChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYShlKTtcbiAgICAgICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgICAgIH0pKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy4kYShlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBLYShlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy51cGRhdGVGdW5jdGlvbihlKTtcbiAgICAgICAgICAgIHJldHVybiAhX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKHQpICYmIHQuY2F0Y2ggJiYgdC50aGVuID8gdCA6ICh0aGlzLmRlZmVycmVkLnJlamVjdChFcnJvcihcIlRyYW5zYWN0aW9uIGNhbGxiYWNrIG11c3QgcmV0dXJuIGEgUHJvbWlzZVwiKSksIFxuICAgICAgICAgICAgbnVsbCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdCByZXRyeSBlcnJvcnMgdGhyb3duIGJ5IHVzZXIgcHJvdmlkZWQgdXBkYXRlRnVuY3Rpb24uXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZWZlcnJlZC5yZWplY3QoZSksIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJGEoZSkge1xuICAgICAgICB0aGlzLnFhID4gMCAmJiB0aGlzLlVhKGUpID8gKHRoaXMucWEgLT0gMSwgdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLlFhKCksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKSkgOiB0aGlzLmRlZmVycmVkLnJlamVjdChlKTtcbiAgICB9XG4gICAgVWEoZSkge1xuICAgICAgICBpZiAoXCJGaXJlYmFzZUVycm9yXCIgPT09IGUubmFtZSkge1xuICAgICAgICAgICAgLy8gSW4gdHJhbnNhY3Rpb25zLCB0aGUgYmFja2VuZCB3aWxsIGZhaWwgb3V0ZGF0ZWQgcmVhZHMgd2l0aCBGQUlMRURfUFJFQ09ORElUSU9OIGFuZFxuICAgICAgICAgICAgLy8gbm9uLW1hdGNoaW5nIGRvY3VtZW50IHZlcnNpb25zIHdpdGggQUJPUlRFRC4gVGhlc2UgZXJyb3JzIHNob3VsZCBiZSByZXRyaWVkLlxuICAgICAgICAgICAgY29uc3QgdCA9IGUuY29kZTtcbiAgICAgICAgICAgIHJldHVybiBcImFib3J0ZWRcIiA9PT0gdCB8fCBcImZhaWxlZC1wcmVjb25kaXRpb25cIiA9PT0gdCB8fCBcImFscmVhZHktZXhpc3RzXCIgPT09IHQgfHwgIV9fUFJJVkFURV9pc1Blcm1hbmVudEVycm9yKHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEZpcmVzdG9yZUNsaWVudCBpcyBhIHRvcC1sZXZlbCBjbGFzcyB0aGF0IGNvbnN0cnVjdHMgYW5kIG93bnMgYWxsIG9mIHRoZSAvL1xuICogcGllY2VzIG9mIHRoZSBjbGllbnQgU0RLIGFyY2hpdGVjdHVyZS4gSXQgaXMgcmVzcG9uc2libGUgZm9yIGNyZWF0aW5nIHRoZSAvL1xuICogYXN5bmMgcXVldWUgdGhhdCBpcyBzaGFyZWQgYnkgYWxsIG9mIHRoZSBvdGhlciBjb21wb25lbnRzIGluIHRoZSBzeXN0ZW0uIC8vXG4gKi9cbmNsYXNzIEZpcmVzdG9yZUNsaWVudCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgXG4gICAgLyoqXG4gICAgICogQXN5bmNocm9ub3VzIHF1ZXVlIHJlc3BvbnNpYmxlIGZvciBhbGwgb2Ygb3VyIGludGVybmFsIHByb2Nlc3NpbmcuIFdoZW5cbiAgICAgKiB3ZSBnZXQgaW5jb21pbmcgd29yayBmcm9tIHRoZSB1c2VyICh2aWEgcHVibGljIEFQSSkgb3IgdGhlIG5ldHdvcmtcbiAgICAgKiAoaW5jb21pbmcgR1JQQyBtZXNzYWdlcyksIHdlIHNob3VsZCBhbHdheXMgc2NoZWR1bGUgb250byB0aGlzIHF1ZXVlLlxuICAgICAqIFRoaXMgZW5zdXJlcyBhbGwgb2Ygb3VyIHdvcmsgaXMgcHJvcGVybHkgc2VyaWFsaXplZCAoZS5nLiB3ZSBkb24ndFxuICAgICAqIHN0YXJ0IHByb2Nlc3NpbmcgYSBuZXcgb3BlcmF0aW9uIHdoaWxlIHRoZSBwcmV2aW91cyBvbmUgaXMgd2FpdGluZyBmb3JcbiAgICAgKiBhbiBhc3luYyBJL08gdG8gY29tcGxldGUpLlxuICAgICAqL1xuICAgIG4sIHIpIHtcbiAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbHMgPSBlLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMgPSB0LCB0aGlzLmFzeW5jUXVldWUgPSBuLCB0aGlzLmRhdGFiYXNlSW5mbyA9IHIsIFxuICAgICAgICB0aGlzLnVzZXIgPSBVc2VyLlVOQVVUSEVOVElDQVRFRCwgdGhpcy5jbGllbnRJZCA9IF9fUFJJVkFURV9BdXRvSWQuVigpLCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIgPSAoKSA9PiBQcm9taXNlLnJlc29sdmUoKSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIgPSAoKSA9PiBQcm9taXNlLnJlc29sdmUoKSwgdGhpcy5hdXRoQ3JlZGVudGlhbHMuc3RhcnQobiwgKGFzeW5jIGUgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiUmVjZWl2ZWQgdXNlcj1cIiwgZS51aWQpLCBhd2FpdCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIoZSksIFxuICAgICAgICAgICAgdGhpcy51c2VyID0gZTtcbiAgICAgICAgfSkpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuc3RhcnQobiwgKGUgPT4gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlJlY2VpdmVkIG5ldyBhcHAgY2hlY2sgdG9rZW49XCIsIGUpLCBcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lcihlLCB0aGlzLnVzZXIpKSkpO1xuICAgIH1cbiAgICBhc3luYyBnZXRDb25maWd1cmF0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXN5bmNRdWV1ZTogdGhpcy5hc3luY1F1ZXVlLFxuICAgICAgICAgICAgZGF0YWJhc2VJbmZvOiB0aGlzLmRhdGFiYXNlSW5mbyxcbiAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgICAgYXV0aENyZWRlbnRpYWxzOiB0aGlzLmF1dGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgIGFwcENoZWNrQ3JlZGVudGlhbHM6IHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscyxcbiAgICAgICAgICAgIGluaXRpYWxVc2VyOiB0aGlzLnVzZXIsXG4gICAgICAgICAgICBtYXhDb25jdXJyZW50TGltYm9SZXNvbHV0aW9uczogMTAwXG4gICAgICAgIH07XG4gICAgfVxuICAgIHNldENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxMaXN0ZW5lciA9IGU7XG4gICAgfVxuICAgIHNldEFwcENoZWNrVG9rZW5DaGFuZ2VMaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVja3MgdGhhdCB0aGUgY2xpZW50IGhhcyBub3QgYmVlbiB0ZXJtaW5hdGVkLiBFbnN1cmVzIHRoYXQgb3RoZXIgbWV0aG9kcyBvbiAvL1xuICAgICAqIHRoaXMgY2xhc3MgY2Fubm90IGJlIGNhbGxlZCBhZnRlciB0aGUgY2xpZW50IGlzIHRlcm1pbmF0ZWQuIC8vXG4gICAgICovICAgIHZlcmlmeU5vdFRlcm1pbmF0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmFzeW5jUXVldWUuaXNTaHV0dGluZ0Rvd24pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnRlclJlc3RyaWN0ZWRNb2RlKCk7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29ubGluZUNvbXBvbmVudHMgJiYgYXdhaXQgdGhpcy5fb25saW5lQ29tcG9uZW50cy50ZXJtaW5hdGUoKSwgdGhpcy5fb2ZmbGluZUNvbXBvbmVudHMgJiYgYXdhaXQgdGhpcy5fb2ZmbGluZUNvbXBvbmVudHMudGVybWluYXRlKCksIFxuICAgICAgICAgICAgICAgIC8vIFRoZSBjcmVkZW50aWFscyBwcm92aWRlciBtdXN0IGJlIHRlcm1pbmF0ZWQgYWZ0ZXIgc2h1dHRpbmcgZG93biB0aGVcbiAgICAgICAgICAgICAgICAvLyBSZW1vdGVTdG9yZSBhcyBpdCB3aWxsIHByZXZlbnQgdGhlIFJlbW90ZVN0b3JlIGZyb20gcmV0cmlldmluZyBhdXRoXG4gICAgICAgICAgICAgICAgLy8gdG9rZW5zLlxuICAgICAgICAgICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzLnNodXRkb3duKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5zaHV0ZG93bigpLCBlLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3dyYXBJblVzZXJFcnJvcklmUmVjb3ZlcmFibGUodCwgXCJGYWlsZWQgdG8gc2h1dGRvd24gcGVyc2lzdGVuY2VcIik7XG4gICAgICAgICAgICAgICAgZS5yZWplY3Qobik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgZS5wcm9taXNlO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3NldE9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlLCB0KSB7XG4gICAgZS5hc3luY1F1ZXVlLnZlcmlmeU9wZXJhdGlvbkluUHJvZ3Jlc3MoKSwgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiSW5pdGlhbGl6aW5nIE9mZmxpbmVDb21wb25lbnRQcm92aWRlclwiKTtcbiAgICBjb25zdCBuID0gYXdhaXQgZS5nZXRDb25maWd1cmF0aW9uKCk7XG4gICAgYXdhaXQgdC5pbml0aWFsaXplKG4pO1xuICAgIGxldCByID0gbi5pbml0aWFsVXNlcjtcbiAgICBlLnNldENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lcigoYXN5bmMgZSA9PiB7XG4gICAgICAgIHIuaXNFcXVhbChlKSB8fCAoYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVIYW5kbGVVc2VyQ2hhbmdlKHQubG9jYWxTdG9yZSwgZSksIHIgPSBlKTtcbiAgICB9KSksIFxuICAgIC8vIFdoZW4gYSB1c2VyIGNhbGxzIGNsZWFyUGVyc2lzdGVuY2UoKSBpbiBvbmUgY2xpZW50LCBhbGwgb3RoZXIgY2xpZW50c1xuICAgIC8vIG5lZWQgdG8gYmUgdGVybWluYXRlZCB0byBhbGxvdyB0aGUgZGVsZXRlIHRvIHN1Y2NlZWQuXG4gICAgdC5wZXJzaXN0ZW5jZS5zZXREYXRhYmFzZURlbGV0ZWRMaXN0ZW5lcigoKCkgPT4gZS50ZXJtaW5hdGUoKSkpLCBlLl9vZmZsaW5lQ29tcG9uZW50cyA9IHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRPbmxpbmVDb21wb25lbnRQcm92aWRlcihlLCB0KSB7XG4gICAgZS5hc3luY1F1ZXVlLnZlcmlmeU9wZXJhdGlvbkluUHJvZ3Jlc3MoKTtcbiAgICBjb25zdCBuID0gYXdhaXQgX19QUklWQVRFX2Vuc3VyZU9mZmxpbmVDb21wb25lbnRzKGUpO1xuICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIkluaXRpYWxpemluZyBPbmxpbmVDb21wb25lbnRQcm92aWRlclwiKTtcbiAgICBjb25zdCByID0gYXdhaXQgZS5nZXRDb25maWd1cmF0aW9uKCk7XG4gICAgYXdhaXQgdC5pbml0aWFsaXplKG4sIHIpLCBcbiAgICAvLyBUaGUgQ3JlZGVudGlhbENoYW5nZUxpc3RlbmVyIG9mIHRoZSBvbmxpbmUgY29tcG9uZW50IHByb3ZpZGVyIHRha2VzXG4gICAgLy8gcHJlY2VkZW5jZSBvdmVyIHRoZSBvZmZsaW5lIGNvbXBvbmVudCBwcm92aWRlci5cbiAgICBlLnNldENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lcigoZSA9PiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVIYW5kbGVDcmVkZW50aWFsQ2hhbmdlKHQucmVtb3RlU3RvcmUsIGUpKSksIFxuICAgIGUuc2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyKCgoZSwgbikgPT4gX19QUklWQVRFX3JlbW90ZVN0b3JlSGFuZGxlQ3JlZGVudGlhbENoYW5nZSh0LnJlbW90ZVN0b3JlLCBuKSkpLCBcbiAgICBlLl9vbmxpbmVDb21wb25lbnRzID0gdDtcbn1cblxuLyoqXG4gKiBEZWNpZGVzIHdoZXRoZXIgdGhlIHByb3ZpZGVkIGVycm9yIGFsbG93cyB1cyB0byBncmFjZWZ1bGx5IGRpc2FibGVcbiAqIHBlcnNpc3RlbmNlIChhcyBvcHBvc2VkIHRvIGNyYXNoaW5nIHRoZSBjbGllbnQpLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5GYWxsYmFja0Zyb21JbmRleGVkRGJFcnJvcihlKSB7XG4gICAgcmV0dXJuIFwiRmlyZWJhc2VFcnJvclwiID09PSBlLm5hbWUgPyBlLmNvZGUgPT09IHYuRkFJTEVEX1BSRUNPTkRJVElPTiB8fCBlLmNvZGUgPT09IHYuVU5JTVBMRU1FTlRFRCA6ICEoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgRE9NRXhjZXB0aW9uICYmIGUgaW5zdGFuY2VvZiBET01FeGNlcHRpb24pIHx8IChcbiAgICAvLyBXaGVuIHRoZSBicm93c2VyIGlzIG91dCBvZiBxdW90YSB3ZSBjb3VsZCBnZXQgZWl0aGVyIHF1b3RhIGV4Y2VlZGVkXG4gICAgLy8gb3IgYW4gYWJvcnRlZCBlcnJvciBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZXJyb3IgaGFwcGVuZWQgZHVyaW5nXG4gICAgLy8gc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAyMiA9PT0gZS5jb2RlIHx8IDIwID09PSBlLmNvZGUgfHwgXG4gICAgLy8gRmlyZWZveCBQcml2YXRlIEJyb3dzaW5nIG1vZGUgZGlzYWJsZXMgSW5kZXhlZERiIGFuZCByZXR1cm5zXG4gICAgLy8gSU5WQUxJRF9TVEFURSBmb3IgYW55IHVzYWdlLlxuICAgIDExID09PSBlLmNvZGUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlT2ZmbGluZUNvbXBvbmVudHMoZSkge1xuICAgIGlmICghZS5fb2ZmbGluZUNvbXBvbmVudHMpIGlmIChlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIHVzZXIgcHJvdmlkZWQgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX3NldE9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyLl9vZmZsaW5lKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQ7XG4gICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9jYW5GYWxsYmFja0Zyb21JbmRleGVkRGJFcnJvcihuKSkgdGhyb3cgbjtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dXYXJuKFwiRXJyb3IgdXNpbmcgdXNlciBwcm92aWRlZCBjYWNoZS4gRmFsbGluZyBiYWNrIHRvIG1lbW9yeSBjYWNoZTogXCIgKyBuKSwgXG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIG5ldyBNZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIGRlZmF1bHQgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIG5ldyBNZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIpO1xuICAgIHJldHVybiBlLl9vZmZsaW5lQ29tcG9uZW50cztcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSkge1xuICAgIHJldHVybiBlLl9vbmxpbmVDb21wb25lbnRzIHx8IChlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIHVzZXIgcHJvdmlkZWQgT25saW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPbmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyLl9vbmxpbmUpKSA6IChfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJVc2luZyBkZWZhdWx0IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T25saW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgbmV3IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyKSkpLCBlLl9vbmxpbmVDb21wb25lbnRzO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0UGVyc2lzdGVuY2UoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5zdXJlT2ZmbGluZUNvbXBvbmVudHMoZSkudGhlbigoZSA9PiBlLnBlcnNpc3RlbmNlKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRMb2NhbFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Vuc3VyZU9mZmxpbmVDb21wb25lbnRzKGUpLnRoZW4oKGUgPT4gZS5sb2NhbFN0b3JlKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRSZW1vdGVTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbnN1cmVPbmxpbmVDb21wb25lbnRzKGUpLnRoZW4oKGUgPT4gZS5yZW1vdGVTdG9yZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0U3luY0VuZ2luZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbnN1cmVPbmxpbmVDb21wb25lbnRzKGUpLnRoZW4oKGUgPT4gZS5zeW5jRW5naW5lKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXREYXRhc3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5zdXJlT25saW5lQ29tcG9uZW50cyhlKS50aGVuKChlID0+IGUuZGF0YXN0b3JlKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRFdmVudE1hbmFnZXIoZSkge1xuICAgIGNvbnN0IHQgPSBhd2FpdCBfX1BSSVZBVEVfZW5zdXJlT25saW5lQ29tcG9uZW50cyhlKSwgbiA9IHQuZXZlbnRNYW5hZ2VyO1xuICAgIHJldHVybiBuLm9uTGlzdGVuID0gX19QUklWQVRFX3N5bmNFbmdpbmVMaXN0ZW4uYmluZChudWxsLCB0LnN5bmNFbmdpbmUpLCBuLm9uVW5saXN0ZW4gPSBfX1BSSVZBVEVfc3luY0VuZ2luZVVubGlzdGVuLmJpbmQobnVsbCwgdC5zeW5jRW5naW5lKSwgXG4gICAgbjtcbn1cblxuLyoqIEVuYWJsZXMgdGhlIG5ldHdvcmsgY29ubmVjdGlvbiBhbmQgcmUtZW5xdWV1ZXMgYWxsIHBlbmRpbmcgb3BlcmF0aW9ucy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEVuYWJsZU5ldHdvcmsoZSkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgX19QUklWQVRFX2dldFBlcnNpc3RlbmNlKGUpLCBuID0gYXdhaXQgX19QUklWQVRFX2dldFJlbW90ZVN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gdC5zZXROZXR3b3JrRW5hYmxlZCghMCksIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZUVuYWJsZU5ldHdvcmsoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICByZXR1cm4gdC55Xy5kZWxldGUoMCAvKiBPZmZsaW5lQ2F1c2UuVXNlckRpc2FibGVkICovKSwgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbCh0KTtcbiAgICAgICAgfShuKTtcbiAgICB9KSk7XG59XG5cbi8qKiBEaXNhYmxlcyB0aGUgbmV0d29yayBjb25uZWN0aW9uLiBQZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBub3QgY29tcGxldGUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnREaXNhYmxlTmV0d29yayhlKSB7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0UGVyc2lzdGVuY2UoZSksIG4gPSBhd2FpdCBfX1BSSVZBVEVfZ2V0UmVtb3RlU3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0LnNldE5ldHdvcmtFbmFibGVkKCExKSwgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3JlbW90ZVN0b3JlRGlzYWJsZU5ldHdvcmsoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICB0LnlfLmFkZCgwIC8qIE9mZmxpbmVDYXVzZS5Vc2VyRGlzYWJsZWQgKi8pLCBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbCh0KSwgXG4gICAgICAgICAgICAvLyBTZXQgdGhlIE9ubGluZVN0YXRlIHRvIE9mZmxpbmUgc28gZ2V0KClzIHJldHVybiBmcm9tIGNhY2hlLCBldGMuXG4gICAgICAgICAgICB0LmJfLnNldChcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovKTtcbiAgICAgICAgfShuKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIGFsbCB3cml0ZXMgdGhhdCB3ZXJlIHBlbmRpbmcgYXQgdGhlIHRpbWVcbiAqIHRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgcmVjZWl2ZWQgc2VydmVyIGFja25vd2xlZGdlbWVudC4gQW4gYWNrbm93bGVkZ2VtZW50XG4gKiBjYW4gYmUgZWl0aGVyIGFjY2VwdGFuY2Ugb3IgcmVqZWN0aW9uLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudEZyb21Mb2NhbENhY2hlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZWFkRG9jdW1lbnRGcm9tQ2FjaGUoZSwgdCwgbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgciA9IGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlUmVhZERvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcInJlYWQgZG9jdW1lbnRcIiwgXCJyZWFkb25seVwiLCAoZSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldERvY3VtZW50KGUsIHQpKSk7XG4gICAgICAgICAgICB9KGUsIHQpO1xuICAgICAgICAgICAgci5pc0ZvdW5kRG9jdW1lbnQoKSA/IG4ucmVzb2x2ZShyKSA6IHIuaXNOb0RvY3VtZW50KCkgPyBuLnJlc29sdmUobnVsbCkgOiBuLnJlamVjdChuZXcgRmlyZXN0b3JlRXJyb3Iodi5VTkFWQUlMQUJMRSwgXCJGYWlsZWQgdG8gZ2V0IGRvY3VtZW50IGZyb20gY2FjaGUuIChIb3dldmVyLCB0aGlzIGRvY3VtZW50IG1heSBleGlzdCBvbiB0aGUgc2VydmVyLiBSdW4gYWdhaW4gd2l0aG91dCBzZXR0aW5nICdzb3VyY2UnIGluIHRoZSBHZXRPcHRpb25zIHRvIGF0dGVtcHQgdG8gcmV0cmlldmUgdGhlIGRvY3VtZW50IGZyb20gdGhlIHNlcnZlci4pXCIpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIGBGYWlsZWQgdG8gZ2V0IGRvY3VtZW50ICcke3R9IGZyb20gY2FjaGVgKTtcbiAgICAgICAgICAgIG4ucmVqZWN0KHIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICogUmV0cmlldmVzIGEgbGF0ZW5jeS1jb21wZW5zYXRlZCBkb2N1bWVudCBmcm9tIHRoZSBiYWNrZW5kIHZpYSBhXG4gKiBTbmFwc2hvdExpc3RlbmVyLlxuICovIChhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSwgdCwgbikpKSwgbi5wcm9taXNlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRWaWFTbmFwc2hvdExpc3RlbmVyKGUsIHQsIG4gPSB7fSkge1xuICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX3JlYWREb2N1bWVudFZpYVNuYXBzaG90TGlzdGVuZXIoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gbmV3IF9fUFJJVkFURV9Bc3luY09ic2VydmVyKHtcbiAgICAgICAgICAgIG5leHQ6IHMgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBxdWVyeSBmaXJzdCBiZWZvcmUgcGFzc2luZyBldmVudCB0byB1c2VyIHRvIGF2b2lkXG4gICAgICAgICAgICAgICAgLy8gdXNlciBhY3Rpb25zIGFmZmVjdGluZyB0aGUgbm93IHN0YWxlIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIHQuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gX19QUklWQVRFX2V2ZW50TWFuYWdlclVubGlzdGVuKGUsIG8pKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgXyA9IHMuZG9jcy5oYXMobik7XG4gICAgICAgICAgICAgICAgIV8gJiYgcy5mcm9tQ2FjaGUgPyBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElmIHdlJ3JlIG9ubGluZSBhbmQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgICAgICAvLyBleGlzdCB0aGVuIHdlIHJlc29sdmUgd2l0aCBhIGRvYy5leGlzdHMgc2V0IHRvIGZhbHNlLiBJZlxuICAgICAgICAgICAgICAgIC8vIHdlJ3JlIG9mZmxpbmUgaG93ZXZlciwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBjYXNlLiBUd28gb3B0aW9uczogMSkgQ2FjaGUgdGhlIG5lZ2F0aXZlIHJlc3BvbnNlIGZyb21cbiAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyIHNvIHdlIGNhbiBkZWxpdmVyIHRoYXQgZXZlbiB3aGVuIHlvdSdyZVxuICAgICAgICAgICAgICAgIC8vIG9mZmxpbmUgMikgQWN0dWFsbHkgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoZSBvbmxpbmUgY2FzZVxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAgICAgICAgICAgIGkucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcih2LlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgZG9jdW1lbnQgYmVjYXVzZSB0aGUgY2xpZW50IGlzIG9mZmxpbmUuXCIpKSA6IF8gJiYgcy5mcm9tQ2FjaGUgJiYgciAmJiBcInNlcnZlclwiID09PSByLnNvdXJjZSA/IGkucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcih2LlVOQVZBSUxBQkxFLCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmcm9tIHNlcnZlci4gKEhvd2V2ZXIsIHRoaXMgZG9jdW1lbnQgZG9lcyBleGlzdCBpbiB0aGUgbG9jYWwgY2FjaGUuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgc291cmNlIHRvIFwic2VydmVyXCIgdG8gcmV0cmlldmUgdGhlIGNhY2hlZCBkb2N1bWVudC4pJykpIDogaS5yZXNvbHZlKHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBlID0+IGkucmVqZWN0KGUpXG4gICAgICAgIH0pLCBvID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyKF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgobi5wYXRoKSwgcywge1xuICAgICAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITAsXG4gICAgICAgICAgICBXXzogITBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyTGlzdGVuKGUsIG8pO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgZS5hc3luY1F1ZXVlLCB0LCBuLCByKSkpLCByLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNGcm9tTG9jYWxDYWNoZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZXhlY3V0ZVF1ZXJ5RnJvbUNhY2hlKGUsIHQsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUV4ZWN1dGVRdWVyeShlLCB0LCBcbiAgICAgICAgICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITApLCBpID0gbmV3IF9fUFJJVkFURV9WaWV3KHQsIHIuc3MpLCBzID0gaS5zYShyLmRvY3VtZW50cyksIG8gPSBpLmFwcGx5Q2hhbmdlcyhzLCBcbiAgICAgICAgICAgIC8qIHVwZGF0ZUxpbWJvRG9jdW1lbnRzPSAqLyAhMSk7XG4gICAgICAgICAgICBuLnJlc29sdmUoby5zbmFwc2hvdCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBgRmFpbGVkIHRvIGV4ZWN1dGUgcXVlcnkgJyR7dH0gYWdhaW5zdCBjYWNoZWApO1xuICAgICAgICAgICAgbi5yZWplY3Qocik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gKiBSZXRyaWV2ZXMgYSBsYXRlbmN5LWNvbXBlbnNhdGVkIHF1ZXJ5IHNuYXBzaG90IGZyb20gdGhlIGJhY2tlbmQgdmlhIGFcbiAqIFNuYXBzaG90TGlzdGVuZXIuXG4gKi8gKGF3YWl0IF9fUFJJVkFURV9nZXRMb2NhbFN0b3JlKGUpLCB0LCBuKSkpLCBuLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyKGUsIHQsIG4gPSB7fSkge1xuICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2V4ZWN1dGVRdWVyeVZpYVNuYXBzaG90TGlzdGVuZXIoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gbmV3IF9fUFJJVkFURV9Bc3luY09ic2VydmVyKHtcbiAgICAgICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBxdWVyeSBmaXJzdCBiZWZvcmUgcGFzc2luZyBldmVudCB0byB1c2VyIHRvIGF2b2lkXG4gICAgICAgICAgICAgICAgLy8gdXNlciBhY3Rpb25zIGFmZmVjdGluZyB0aGUgbm93IHN0YWxlIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIHQuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gX19QUklWQVRFX2V2ZW50TWFuYWdlclVubGlzdGVuKGUsIG8pKSksIG4uZnJvbUNhY2hlICYmIFwic2VydmVyXCIgPT09IHIuc291cmNlID8gaS5yZWplY3QobmV3IEZpcmVzdG9yZUVycm9yKHYuVU5BVkFJTEFCTEUsICdGYWlsZWQgdG8gZ2V0IGRvY3VtZW50cyBmcm9tIHNlcnZlci4gKEhvd2V2ZXIsIHRoZXNlIGRvY3VtZW50cyBtYXkgZXhpc3QgaW4gdGhlIGxvY2FsIGNhY2hlLiBSdW4gYWdhaW4gd2l0aG91dCBzZXR0aW5nIHNvdXJjZSB0byBcInNlcnZlclwiIHRvIHJldHJpZXZlIHRoZSBjYWNoZWQgZG9jdW1lbnRzLiknKSkgOiBpLnJlc29sdmUobik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGUgPT4gaS5yZWplY3QoZSlcbiAgICAgICAgfSksIG8gPSBuZXcgX19QUklWQVRFX1F1ZXJ5TGlzdGVuZXIobiwgcywge1xuICAgICAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITAsXG4gICAgICAgICAgICBXXzogITBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyTGlzdGVuKGUsIG8pO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgZS5hc3luY1F1ZXVlLCB0LCBuLCByKSkpLCByLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRBZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlcih0KTtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9hZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSkuT18uYWRkKHQpLCBcbiAgICAgICAgLy8gSW1tZWRpYXRlbHkgZmlyZSBhbiBpbml0aWFsIGV2ZW50LCBpbmRpY2F0aW5nIGFsbCBleGlzdGluZyBsaXN0ZW5lcnNcbiAgICAgICAgLy8gYXJlIGluLXN5bmMuXG4gICAgICAgIHQubmV4dCgpO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgbikpKSwgKCkgPT4ge1xuICAgICAgICBuLkNhKCksIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlU25hcHNob3RzSW5TeW5jTGlzdGVuZXIoZSwgdCkge1xuICAgICAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChlKS5PXy5kZWxldGUodCk7XG4gICAgICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgbikpKTtcbiAgICB9O1xufVxuXG4vKipcbiAqIFRha2VzIGFuIHVwZGF0ZUZ1bmN0aW9uIGluIHdoaWNoIGEgc2V0IG9mIHJlYWRzIGFuZCB3cml0ZXMgY2FuIGJlIHBlcmZvcm1lZFxuICogYXRvbWljYWxseS4gSW4gdGhlIHVwZGF0ZUZ1bmN0aW9uLCB0aGUgY2xpZW50IGNhbiByZWFkIGFuZCB3cml0ZSB2YWx1ZXNcbiAqIHVzaW5nIHRoZSBzdXBwbGllZCB0cmFuc2FjdGlvbiBvYmplY3QuIEFmdGVyIHRoZSB1cGRhdGVGdW5jdGlvbiwgYWxsXG4gKiBjaGFuZ2VzIHdpbGwgYmUgY29tbWl0dGVkLiBJZiBhIHJldHJ5YWJsZSBlcnJvciBvY2N1cnMgKGV4OiBzb21lIG90aGVyXG4gKiBjbGllbnQgaGFzIGNoYW5nZWQgYW55IG9mIHRoZSBkYXRhIHJlZmVyZW5jZWQpLCB0aGVuIHRoZSB1cGRhdGVGdW5jdGlvblxuICogd2lsbCBiZSBjYWxsZWQgYWdhaW4gYWZ0ZXIgYSBiYWNrb2ZmLiBJZiB0aGUgdXBkYXRlRnVuY3Rpb24gc3RpbGwgZmFpbHNcbiAqIGFmdGVyIGFsbCByZXRyaWVzLCB0aGVuIHRoZSB0cmFuc2FjdGlvbiB3aWxsIGJlIHJlamVjdGVkLlxuICpcbiAqIFRoZSB0cmFuc2FjdGlvbiBvYmplY3QgcGFzc2VkIHRvIHRoZSB1cGRhdGVGdW5jdGlvbiBjb250YWlucyBtZXRob2RzIGZvclxuICogYWNjZXNzaW5nIGRvY3VtZW50cyBhbmQgY29sbGVjdGlvbnMuIFVubGlrZSBvdGhlciBkYXRhc3RvcmUgYWNjZXNzLCBkYXRhXG4gKiBhY2Nlc3NlZCB3aXRoIHRoZSB0cmFuc2FjdGlvbiB3aWxsIG5vdCByZWZsZWN0IGxvY2FsIGNoYW5nZXMgdGhhdCBoYXZlIG5vdFxuICogYmVlbiBjb21taXR0ZWQuIEZvciB0aGlzIHJlYXNvbiwgaXQgaXMgcmVxdWlyZWQgdGhhdCBhbGwgcmVhZHMgYXJlXG4gKiBwZXJmb3JtZWQgYmVmb3JlIGFueSB3cml0ZXMuIFRyYW5zYWN0aW9ucyBtdXN0IGJlIHBlcmZvcm1lZCB3aGlsZSBvbmxpbmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudExvYWRCdW5kbGUoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlQnVuZGxlUmVhZGVyKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIG4gPSBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCkuZW5jb2RlKGUpIDogZTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdCdW5kbGVSZWFkZXIoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfQnVuZGxlUmVhZGVySW1wbChlLCB0KTtcbiAgICAgICAgfShmdW5jdGlvbiBfX1BSSVZBVEVfdG9CeXRlU3RyZWFtUmVhZGVyKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgVWludDhBcnJheSkgcmV0dXJuIF9fUFJJVkFURV90b0J5dGVTdHJlYW1SZWFkZXJIZWxwZXIoZSwgdCk7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSByZXR1cm4gX19QUklWQVRFX3RvQnl0ZVN0cmVhbVJlYWRlckhlbHBlcihuZXcgVWludDhBcnJheShlKSwgdCk7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtKSByZXR1cm4gZS5nZXRSZWFkZXIoKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNvdXJjZSBvZiBgdG9CeXRlU3RyZWFtUmVhZGVyYCBoYXMgdG8gYmUgYSBBcnJheUJ1ZmZlciBvciBSZWFkYWJsZVN0cmVhbVwiKTtcbiAgICAgICAgfShuKSwgdCk7XG4gICAgfShuLCBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcih0KSk7XG4gICAgZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgX19QUklWQVRFX3N5bmNFbmdpbmVMb2FkQnVuZGxlKGF3YWl0IF9fUFJJVkFURV9nZXRTeW5jRW5naW5lKGUpLCBpLCByKTtcbiAgICB9KSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXROYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBuYW1lZCBxdWVyeVwiLCBcInJlYWRvbmx5XCIsIChlID0+IG4uUXIuZ2V0TmFtZWRRdWVyeShlLCB0KSkpO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSksIHQpKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRTZXRJbmRleENvbmZpZ3VyYXRpb24oZSwgdCkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVDb25maWd1cmVGaWVsZEluZGV4ZXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4uaW5kZXhNYW5hZ2VyLCBpID0gW107XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29uZmlndXJlIGluZGV4ZXNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gci5nZXRGaWVsZEluZGV4ZXMoZSkubmV4dCgobiA9PiBcbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLyoqXG4gKiBDb21wYXJlcyB0d28gYXJyYXkgZm9yIGVxdWFsaXR5IHVzaW5nIGNvbXBhcmF0b3IuIFRoZSBtZXRob2QgY29tcHV0ZXMgdGhlXG4gKiBpbnRlcnNlY3Rpb24gYW5kIGludm9rZXMgYG9uQWRkYCBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIGluIGBhZnRlcmAgYnV0IG5vdFxuICogYGJlZm9yZWAuIGBvblJlbW92ZWAgaXMgaW52b2tlZCBmb3IgZXZlcnkgZWxlbWVudCBpbiBgYmVmb3JlYCBidXQgbWlzc2luZ1xuICogZnJvbSBgYWZ0ZXJgLlxuICpcbiAqIFRoZSBtZXRob2QgY3JlYXRlcyBhIGNvcHkgb2YgYm90aCBgYmVmb3JlYCBhbmQgYGFmdGVyYCBhbmQgcnVucyBpbiBPKG4gbG9nXG4gKiBuKSwgd2hlcmUgbiBpcyB0aGUgc2l6ZSBvZiB0aGUgdHdvIGxpc3RzLlxuICpcbiAqIEBwYXJhbSBiZWZvcmUgLSBUaGUgZWxlbWVudHMgdGhhdCBleGlzdCBpbiB0aGUgb3JpZ2luYWwgYXJyYXkuXG4gKiBAcGFyYW0gYWZ0ZXIgLSBUaGUgZWxlbWVudHMgdG8gZGlmZiBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBhcnJheS5cbiAqIEBwYXJhbSBjb21wYXJhdG9yIC0gVGhlIGNvbXBhcmF0b3IgZm9yIHRoZSBlbGVtZW50cyBpbiBiZWZvcmUgYW5kIGFmdGVyLlxuICogQHBhcmFtIG9uQWRkIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mIGBcbiAqIGFmdGVyYCBidXQgbm90IGBiZWZvcmVgLlxuICogQHBhcmFtIG9uUmVtb3ZlIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mXG4gKiBgYmVmb3JlYCBidXQgbm90IGBhZnRlcmAuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2RpZmZBcnJheXMoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICAgICAgZSA9IFsgLi4uZSBdLCB0ID0gWyAuLi50IF0sIGUuc29ydChuKSwgdC5zb3J0KG4pO1xuICAgICAgICAgICAgY29uc3QgcyA9IGUubGVuZ3RoLCBvID0gdC5sZW5ndGg7XG4gICAgICAgICAgICBsZXQgXyA9IDAsIGEgPSAwO1xuICAgICAgICAgICAgZm9yICg7XyA8IG8gJiYgYSA8IHM7ICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuKGVbYV0sIHRbX10pO1xuICAgICAgICAgICAgICAgIHMgPCAwID8gXG4gICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIHJlbW92ZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZFxuICAgICAgICAgICAgICAgIC8vIHdhbGt0aHJvdWdoIGlzIG9ubHkgaW4gYGJlZm9yZWAuXG4gICAgICAgICAgICAgICAgaShlW2ErK10pIDogcyA+IDAgPyBcbiAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgYWRkZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZCB3YWxrdGhyb3VnaFxuICAgICAgICAgICAgICAgIC8vIGlzIG9ubHkgaW4gYGFmdGVyYC5cbiAgICAgICAgICAgICAgICByKHRbXysrXSkgOiAoXysrLCBhKyspO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICg7XyA8IG87ICkgcih0W18rK10pO1xuICAgICAgICAgICAgZm9yICg7YSA8IHM7ICkgaShlW2ErK10pO1xuICAgICAgICB9KG4sIHQsIF9fUFJJVkFURV9maWVsZEluZGV4U2VtYW50aWNDb21wYXJhdG9yLCAodCA9PiB7XG4gICAgICAgICAgICBpLnB1c2goci5hZGRGaWVsZEluZGV4KGUsIHQpKTtcbiAgICAgICAgfSksICh0ID0+IHtcbiAgICAgICAgICAgIGkucHVzaChyLmRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKSkpKSk7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLy8gVGhlIGZvcm1hdCBvZiB0aGUgTG9jYWxTdG9yYWdlIGtleSB0aGF0IHN0b3JlcyB0aGUgY2xpZW50IHN0YXRlIGlzOlxuICAgIC8vICAgICBmaXJlc3RvcmVfY2xpZW50c188cGVyc2lzdGVuY2VfcHJlZml4Pl88aW5zdGFuY2Vfa2V5PlxuICAgIChhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSwgdCkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29tcGFyZXMgdHdvIGBFeHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnNgIG9iamVjdHMgZm9yIGVxdWFsaXR5LlxuICovXG4vKipcbiAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgYEV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9uc2Agd2l0aCB0aGUgc2FtZVxuICogb3B0aW9uIHZhbHVlcyBhcyB0aGUgZ2l2ZW4gaW5zdGFuY2UuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9jbG9uZUxvbmdQb2xsaW5nT3B0aW9ucyhlKSB7XG4gICAgY29uc3QgdCA9IHt9O1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudGltZW91dFNlY29uZHMgJiYgKHQudGltZW91dFNlY29uZHMgPSBlLnRpbWVvdXRTZWNvbmRzKSwgdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgZmUgPSBuZXcgTWFwO1xuXG4vKipcbiAqIEFuIGluc3RhbmNlIG1hcCB0aGF0IGVuc3VyZXMgb25seSBvbmUgRGF0YXN0b3JlIGV4aXN0cyBwZXIgRmlyZXN0b3JlXG4gKiBpbnN0YW5jZS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZU5vbkVtcHR5QXJndW1lbnQoZSwgdCwgbikge1xuICAgIGlmICghbikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7ZX0oKSBjYW5ub3QgYmUgY2FsbGVkIHdpdGggYW4gZW1wdHkgJHt0fS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCB0d28gYm9vbGVhbiBvcHRpb25zIGFyZSBub3Qgc2V0IGF0IHRoZSBzYW1lIHRpbWUuXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlcihlLCB0LCBuLCByKSB7XG4gICAgaWYgKCEwID09PSB0ICYmICEwID09PSByKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgJHtlfSBhbmQgJHtufSBjYW5ub3QgYmUgdXNlZCB0b2dldGhlci5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBgcGF0aGAgcmVmZXJzIHRvIGEgZG9jdW1lbnQgKGluZGljYXRlZCBieSB0aGUgZmFjdCBpdCBjb250YWluc1xuICogYW4gZXZlbiBudW1iZXJzIG9mIHNlZ21lbnRzKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVEb2N1bWVudFBhdGgoZSkge1xuICAgIGlmICghRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgZG9jdW1lbnQgcmVmZXJlbmNlLiBEb2N1bWVudCByZWZlcmVuY2VzIG11c3QgaGF2ZSBhbiBldmVuIG51bWJlciBvZiBzZWdtZW50cywgYnV0ICR7ZX0gaGFzICR7ZS5sZW5ndGh9LmApO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyB0aGF0IGBwYXRoYCByZWZlcnMgdG8gYSBjb2xsZWN0aW9uIChpbmRpY2F0ZWQgYnkgdGhlIGZhY3QgaXRcbiAqIGNvbnRhaW5zIGFuIG9kZCBudW1iZXJzIG9mIHNlZ21lbnRzKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVDb2xsZWN0aW9uUGF0aChlKSB7XG4gICAgaWYgKERvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoZSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGNvbGxlY3Rpb24gcmVmZXJlbmNlLiBDb2xsZWN0aW9uIHJlZmVyZW5jZXMgbXVzdCBoYXZlIGFuIG9kZCBudW1iZXIgb2Ygc2VnbWVudHMsIGJ1dCAke2V9IGhhcyAke2UubGVuZ3RofS5gKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgaXQncyBhIG5vbi1udWxsIG9iamVjdCB3aXRob3V0IGEgY3VzdG9tIHByb3RvdHlwZVxuICogKGkuZS4gZXhjbHVkZXMgQXJyYXksIERhdGUsIGV0Yy4pLlxuICovXG4vKiogUmV0dXJucyBhIHN0cmluZyBkZXNjcmliaW5nIHRoZSB0eXBlIC8gdmFsdWUgb2YgdGhlIHByb3ZpZGVkIGlucHV0LiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24oZSkge1xuICAgIGlmICh2b2lkIDAgPT09IGUpIHJldHVybiBcInVuZGVmaW5lZFwiO1xuICAgIGlmIChudWxsID09PSBlKSByZXR1cm4gXCJudWxsXCI7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHJldHVybiBlLmxlbmd0aCA+IDIwICYmIChlID0gYCR7ZS5zdWJzdHJpbmcoMCwgMjApfS4uLmApLCBcbiAgICBKU09OLnN0cmluZ2lmeShlKTtcbiAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgZSB8fCBcImJvb2xlYW5cIiA9PSB0eXBlb2YgZSkgcmV0dXJuIFwiXCIgKyBlO1xuICAgIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBcImFuIGFycmF5XCI7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgICAgIC8qKiB0cnkgdG8gZ2V0IHRoZSBjb25zdHJ1Y3RvciBuYW1lIGZvciBhbiBvYmplY3QuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdHJ5R2V0Q3VzdG9tT2JqZWN0VHlwZShlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuY29uc3RydWN0b3IpIHJldHVybiBlLmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIENhc3RzIGBvYmpgIHRvIGBUYCwgb3B0aW9uYWxseSB1bndyYXBwaW5nIENvbXBhdCB0eXBlcyB0byBleHBvc2UgdGhlXG4gKiB1bmRlcmx5aW5nIGluc3RhbmNlLiBUaHJvd3MgaWYgIGBvYmpgIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBgVGAuXG4gKlxuICogVGhpcyBjYXN0IGlzIHVzZWQgaW4gdGhlIExpdGUgYW5kIEZ1bGwgU0RLIHRvIHZlcmlmeSBpbnN0YW5jZSB0eXBlcyBmb3JcbiAqIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIHB1YmxpYyBBUEkuXG4gKiBAaW50ZXJuYWxcbiAqLyAoZSk7XG4gICAgICAgICAgICByZXR1cm4gdCA/IGBhIGN1c3RvbSAke3R9IG9iamVjdGAgOiBcImFuIG9iamVjdFwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgPyBcImEgZnVuY3Rpb25cIiA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Nhc3QoZSwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxudCkge1xuICAgIGlmIChcIl9kZWxlZ2F0ZVwiIGluIGUgJiYgKFxuICAgIC8vIFVud3JhcCBDb21wYXQgdHlwZXNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGUgPSBlLl9kZWxlZ2F0ZSksICEoZSBpbnN0YW5jZW9mIHQpKSB7XG4gICAgICAgIGlmICh0Lm5hbWUgPT09IGUuY29uc3RydWN0b3IubmFtZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJUeXBlIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBpbnN0YW5jZS4gRGlkIHlvdSBwYXNzIGEgcmVmZXJlbmNlIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIFNESz9cIik7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdmFsdWVEZXNjcmlwdGlvbihlKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBFeHBlY3RlZCB0eXBlICcke3QubmFtZX0nLCBidXQgaXQgd2FzOiAke259YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGU7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVBvc2l0aXZlTnVtYmVyKGUsIHQpIHtcbiAgICBpZiAodCA8PSAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHtlfSgpIHJlcXVpcmVzIGEgcG9zaXRpdmUgbnVtYmVyLCBidXQgaXQgd2FzOiAke3R9LmApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gc2V0dGluZ3MoKSBkZWZhdWx0czpcbi8qKlxuICogQSBjb25jcmV0ZSB0eXBlIGRlc2NyaWJpbmcgYWxsIHRoZSB2YWx1ZXMgdGhhdCBjYW4gYmUgYXBwbGllZCB2aWEgYVxuICogdXNlci1zdXBwbGllZCBgRmlyZXN0b3JlU2V0dGluZ3NgIG9iamVjdC4gVGhpcyBpcyBhIHNlcGFyYXRlIHR5cGUgc28gdGhhdFxuICogZGVmYXVsdHMgY2FuIGJlIHN1cHBsaWVkIGFuZCB0aGUgdmFsdWUgY2FuIGJlIGNoZWNrZWQgZm9yIGVxdWFsaXR5LlxuICovXG5jbGFzcyBGaXJlc3RvcmVTZXR0aW5nc0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdmFyIHQsIG47XG4gICAgICAgIGlmICh2b2lkIDAgPT09IGUuaG9zdCkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS5zc2wpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgcHJvdmlkZSBzc2wgb3B0aW9uIGlmIGhvc3Qgb3B0aW9uIGlzIG5vdCBzZXRcIik7XG4gICAgICAgICAgICB0aGlzLmhvc3QgPSBcImZpcmVzdG9yZS5nb29nbGVhcGlzLmNvbVwiLCB0aGlzLnNzbCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB0aGlzLmhvc3QgPSBlLmhvc3QsIHRoaXMuc3NsID0gbnVsbCA9PT0gKHQgPSBlLnNzbCkgfHwgdm9pZCAwID09PSB0IHx8IHQ7XG4gICAgICAgIGlmICh0aGlzLmNyZWRlbnRpYWxzID0gZS5jcmVkZW50aWFscywgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzID0gISFlLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIFxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGUgPSBlLmxvY2FsQ2FjaGUsIHZvaWQgMCA9PT0gZS5jYWNoZVNpemVCeXRlcykgdGhpcy5jYWNoZVNpemVCeXRlcyA9IDQxOTQzMDQwOyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gZS5jYWNoZVNpemVCeXRlcyAmJiBlLmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJjYWNoZVNpemVCeXRlcyBtdXN0IGJlIGF0IGxlYXN0IDEwNDg1NzZcIik7XG4gICAgICAgICAgICB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gZS5jYWNoZVNpemVCeXRlcztcbiAgICAgICAgfVxuICAgICAgICBfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlcihcImV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmdcIiwgZS5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nLCBcImV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZ1wiLCBlLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyksIFxuICAgICAgICB0aGlzLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcgPSAhIWUuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZywgdGhpcy5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nID8gdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSAhMSA6IHZvaWQgMCA9PT0gZS5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPyB0aGlzLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyA9IHRydWUgOiBcbiAgICAgICAgLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBjb2VyY2UgdGhlIHZhbHVlIHRvIGJvb2xlYW4gZXZlbiB0aG91Z2hcbiAgICAgICAgLy8gdGhlIFR5cGVTY3JpcHQgY29tcGlsZXIgaGFzIG5hcnJvd2VkIHRoZSB0eXBlIHRvIGJvb2xlYW4gYWxyZWFkeS5cbiAgICAgICAgLy8gbm9pbnNwZWN0aW9uIFBvaW50bGVzc0Jvb2xlYW5FeHByZXNzaW9uSlNcbiAgICAgICAgdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSAhIWUuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nLCBcbiAgICAgICAgdGhpcy5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMgPSBfX1BSSVZBVEVfY2xvbmVMb25nUG9sbGluZ09wdGlvbnMobnVsbCAhPT0gKG4gPSBlLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucykgJiYgdm9pZCAwICE9PSBuID8gbiA6IHt9KSwgXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZUxvbmdQb2xsaW5nT3B0aW9ucyhlKSB7XG4gICAgICAgICAgICBpZiAodm9pZCAwICE9PSBlLnRpbWVvdXRTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKGUudGltZW91dFNlY29uZHMpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgaW52YWxpZCBsb25nIHBvbGxpbmcgdGltZW91dDogJHtlLnRpbWVvdXRTZWNvbmRzfSAobXVzdCBub3QgYmUgTmFOKWApO1xuICAgICAgICAgICAgICAgIGlmIChlLnRpbWVvdXRTZWNvbmRzIDwgNSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYGludmFsaWQgbG9uZyBwb2xsaW5nIHRpbWVvdXQ6ICR7ZS50aW1lb3V0U2Vjb25kc30gKG1pbmltdW0gYWxsb3dlZCB2YWx1ZSBpcyA1KWApO1xuICAgICAgICAgICAgICAgIGlmIChlLnRpbWVvdXRTZWNvbmRzID4gMzApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBpbnZhbGlkIGxvbmcgcG9sbGluZyB0aW1lb3V0OiAke2UudGltZW91dFNlY29uZHN9IChtYXhpbXVtIGFsbG93ZWQgdmFsdWUgaXMgMzApYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi8gKHRoaXMuZXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zKSwgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSAhIWUudXNlRmV0Y2hTdHJlYW1zO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG9zdCA9PT0gZS5ob3N0ICYmIHRoaXMuc3NsID09PSBlLnNzbCAmJiB0aGlzLmNyZWRlbnRpYWxzID09PSBlLmNyZWRlbnRpYWxzICYmIHRoaXMuY2FjaGVTaXplQnl0ZXMgPT09IGUuY2FjaGVTaXplQnl0ZXMgJiYgdGhpcy5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nID09PSBlLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcgJiYgdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPT09IGUuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9sb25nUG9sbGluZ09wdGlvbnNFcXVhbChlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gZS50aW1lb3V0U2Vjb25kcyA9PT0gdC50aW1lb3V0U2Vjb25kcztcbiAgICAgICAgfSh0aGlzLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucywgZS5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMpICYmIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9PT0gZS5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzICYmIHRoaXMudXNlRmV0Y2hTdHJlYW1zID09PSBlLnVzZUZldGNoU3RyZWFtcztcbiAgICB9XG59XG5cbmNsYXNzIEZpcmVzdG9yZSQxIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5fYXV0aENyZWRlbnRpYWxzID0gZSwgdGhpcy5fYXBwQ2hlY2tDcmVkZW50aWFscyA9IHQsIHRoaXMuX2RhdGFiYXNlSWQgPSBuLCBcbiAgICAgICAgdGhpcy5fYXBwID0gciwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGl0J3MgYSBGaXJlc3RvcmUgb3IgRmlyZXN0b3JlIExpdGUgaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcImZpcmVzdG9yZS1saXRlXCIsIHRoaXMuX3BlcnNpc3RlbmNlS2V5ID0gXCIobGl0ZSlcIiwgdGhpcy5fc2V0dGluZ3MgPSBuZXcgRmlyZXN0b3JlU2V0dGluZ3NJbXBsKHt9KSwgXG4gICAgICAgIHRoaXMuX3NldHRpbmdzRnJvemVuID0gITE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gYXNzb2NpYXRlZCB3aXRoIHRoaXMgYEZpcmVzdG9yZWAgc2VydmljZVxuICAgICAqIGluc3RhbmNlLlxuICAgICAqLyAgICBnZXQgYXBwKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2FwcCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgd2FzIG5vdCBpbml0aWFsaXplZCB1c2luZyB0aGUgRmlyZWJhc2UgU0RLLiAnYXBwJyBpcyBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy5fYXBwO1xuICAgIH1cbiAgICBnZXQgX2luaXRpYWxpemVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3NGcm96ZW47XG4gICAgfVxuICAgIGdldCBfdGVybWluYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgX3NldFNldHRpbmdzKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzRnJvemVuKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkZpcmVzdG9yZSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQgYW5kIGl0cyBzZXR0aW5ncyBjYW4gbm8gbG9uZ2VyIGJlIGNoYW5nZWQuIFlvdSBjYW4gb25seSBtb2RpZnkgc2V0dGluZ3MgYmVmb3JlIGNhbGxpbmcgYW55IG90aGVyIG1ldGhvZHMgb24gYSBGaXJlc3RvcmUgb2JqZWN0LlwiKTtcbiAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSBuZXcgRmlyZXN0b3JlU2V0dGluZ3NJbXBsKGUpLCB2b2lkIDAgIT09IGUuY3JlZGVudGlhbHMgJiYgKHRoaXMuX2F1dGhDcmVkZW50aWFscyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9tYWtlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIoZSkge1xuICAgICAgICAgICAgaWYgKCFlKSByZXR1cm4gbmV3IF9fUFJJVkFURV9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyO1xuICAgICAgICAgICAgc3dpdGNoIChlLnR5cGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcImZpcnN0UGFydHlcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9GaXJzdFBhcnR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIoZS5zZXNzaW9uSW5kZXggfHwgXCIwXCIsIGUuaWFtVG9rZW4gfHwgbnVsbCwgZS5hdXRoVG9rZW5GYWN0b3J5IHx8IG51bGwpO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJwcm92aWRlclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBlLmNsaWVudDtcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwibWFrZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIGZhaWxlZCBkdWUgdG8gaW52YWxpZCBjcmVkZW50aWFsIHR5cGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZS5jcmVkZW50aWFscykpO1xuICAgIH1cbiAgICBfZ2V0U2V0dGluZ3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR0aW5ncztcbiAgICB9XG4gICAgX2ZyZWV6ZVNldHRpbmdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3NGcm96ZW4gPSAhMCwgdGhpcy5fc2V0dGluZ3M7XG4gICAgfVxuICAgIF9kZWxldGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90ZXJtaW5hdGVUYXNrIHx8ICh0aGlzLl90ZXJtaW5hdGVUYXNrID0gdGhpcy5fdGVybWluYXRlKCkpLCB0aGlzLl90ZXJtaW5hdGVUYXNrO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYEZpcmVzdG9yZWAgaW5zdGFuY2UuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFwcDogdGhpcy5fYXBwLFxuICAgICAgICAgICAgZGF0YWJhc2VJZDogdGhpcy5fZGF0YWJhc2VJZCxcbiAgICAgICAgICAgIHNldHRpbmdzOiB0aGlzLl9zZXR0aW5nc1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUZXJtaW5hdGVzIGFsbCBjb21wb25lbnRzIHVzZWQgYnkgdGhpcyBjbGllbnQuIFN1YmNsYXNzZXMgY2FuIG92ZXJyaWRlXG4gICAgICogdGhpcyBtZXRob2QgdG8gY2xlYW4gdXAgdGhlaXIgb3duIGRlcGVuZGVuY2llcywgYnV0IG11c3QgYWxzbyBjYWxsIHRoaXNcbiAgICAgKiBtZXRob2QuXG4gICAgICpcbiAgICAgKiBPbmx5IGV2ZXIgY2FsbGVkIG9uY2UuXG4gICAgICovICAgIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIC8qKlxuICogUmVtb3ZlcyBhbGwgY29tcG9uZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIHByb3ZpZGVkIGluc3RhbmNlLiBNdXN0IGJlIGNhbGxlZFxuICogd2hlbiB0aGUgYEZpcmVzdG9yZWAgaW5zdGFuY2UgaXMgdGVybWluYXRlZC5cbiAqL1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3JlbW92ZUNvbXBvbmVudHMoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZlLmdldChlKTtcbiAgICAgICAgICAgIHQgJiYgKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkNvbXBvbmVudFByb3ZpZGVyXCIsIFwiUmVtb3ZpbmcgRGF0YXN0b3JlXCIpLCBmZS5kZWxldGUoZSksIFxuICAgICAgICAgICAgdC50ZXJtaW5hdGUoKSk7XG4gICAgICAgIH0odGhpcyksIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNb2RpZnkgdGhpcyBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBDbG91ZCBGaXJlc3RvcmUgZW11bGF0b3IuXG4gKlxuICogTm90ZTogVGhpcyBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiB1c2VkIHRvIGRvIGFueVxuICogb3BlcmF0aW9ucy5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIGBGaXJlc3RvcmVgIGluc3RhbmNlIHRvIGNvbmZpZ3VyZSB0byBjb25uZWN0IHRvIHRoZVxuICogZW11bGF0b3IuXG4gKiBAcGFyYW0gaG9zdCAtIHRoZSBlbXVsYXRvciBob3N0IChleDogbG9jYWxob3N0KS5cbiAqIEBwYXJhbSBwb3J0IC0gdGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA5MDAwKS5cbiAqIEBwYXJhbSBvcHRpb25zLm1vY2tVc2VyVG9rZW4gLSB0aGUgbW9jayBhdXRoIHRva2VuIHRvIHVzZSBmb3IgdW5pdCB0ZXN0aW5nXG4gKiBTZWN1cml0eSBSdWxlcy5cbiAqLyBmdW5jdGlvbiBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IoZSwgdCwgbiwgciA9IHt9KSB7XG4gICAgdmFyIGk7XG4gICAgY29uc3QgcyA9IChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlJDEpKS5fZ2V0U2V0dGluZ3MoKSwgbyA9IGAke3R9OiR7bn1gO1xuICAgIGlmIChcImZpcmVzdG9yZS5nb29nbGVhcGlzLmNvbVwiICE9PSBzLmhvc3QgJiYgcy5ob3N0ICE9PSBvICYmIF9fUFJJVkFURV9sb2dXYXJuKFwiSG9zdCBoYXMgYmVlbiBzZXQgaW4gYm90aCBzZXR0aW5ncygpIGFuZCBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IoKSwgZW11bGF0b3IgaG9zdCB3aWxsIGJlIHVzZWQuXCIpLCBcbiAgICBlLl9zZXRTZXR0aW5ncyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHMpLCB7XG4gICAgICAgIGhvc3Q6IG8sXG4gICAgICAgIHNzbDogITFcbiAgICB9KSksIHIubW9ja1VzZXJUb2tlbikge1xuICAgICAgICBsZXQgdCwgbjtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHIubW9ja1VzZXJUb2tlbikgdCA9IHIubW9ja1VzZXJUb2tlbiwgbiA9IFVzZXIuTU9DS19VU0VSOyBlbHNlIHtcbiAgICAgICAgICAgIC8vIExldCBjcmVhdGVNb2NrVXNlclRva2VuIHZhbGlkYXRlIGZpcnN0IChjYXRjaGVzIGNvbW1vbiBtaXN0YWtlcyBsaWtlXG4gICAgICAgICAgICAvLyBpbnZhbGlkIGZpZWxkIFwidWlkXCIgYW5kIG1pc3NpbmcgZmllbGQgXCJzdWJcIiAvIFwidXNlcl9pZFwiLilcbiAgICAgICAgICAgIHQgPSBjcmVhdGVNb2NrVXNlclRva2VuKHIubW9ja1VzZXJUb2tlbiwgbnVsbCA9PT0gKGkgPSBlLl9hcHApIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkub3B0aW9ucy5wcm9qZWN0SWQpO1xuICAgICAgICAgICAgY29uc3QgcyA9IHIubW9ja1VzZXJUb2tlbi5zdWIgfHwgci5tb2NrVXNlclRva2VuLnVzZXJfaWQ7XG4gICAgICAgICAgICBpZiAoIXMpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcbiAgICAgICAgICAgIG4gPSBuZXcgVXNlcihzKTtcbiAgICAgICAgfVxuICAgICAgICBlLl9hdXRoQ3JlZGVudGlhbHMgPSBuZXcgX19QUklWQVRFX0VtdWxhdG9yQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIobmV3IF9fUFJJVkFURV9PQXV0aFRva2VuKHQsIG4pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYFF1ZXJ5YCByZWZlcnMgdG8gYSBxdWVyeSB3aGljaCB5b3UgY2FuIHJlYWQgb3IgbGlzdGVuIHRvLiBZb3UgY2FuIGFsc29cbiAqIGNvbnN0cnVjdCByZWZpbmVkIGBRdWVyeWAgb2JqZWN0cyBieSBhZGRpbmcgZmlsdGVycyBhbmQgb3JkZXJpbmcuXG4gKi8gY2xhc3MgUXVlcnkge1xuICAgIC8vIFRoaXMgaXMgdGhlIGxpdGUgdmVyc2lvbiBvZiB0aGUgUXVlcnkgY2xhc3MgaW4gdGhlIG1haW4gU0RLLlxuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yIHByb3RlY3RlZCAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8qKlxuICAgICAqIElmIHByb3ZpZGVkLCB0aGUgYEZpcmVzdG9yZURhdGFDb252ZXJ0ZXJgIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGluc3RhbmNlLlxuICAgICAqL1xuICAgIHQsIG4pIHtcbiAgICAgICAgdGhpcy5jb252ZXJ0ZXIgPSB0LCB0aGlzLl9xdWVyeSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBGaXJlc3RvcmUgcmVmZXJlbmNlLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcInF1ZXJ5XCIsIHRoaXMuZmlyZXN0b3JlID0gZTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkodGhpcy5maXJlc3RvcmUsIGUsIHRoaXMuX3F1ZXJ5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgRG9jdW1lbnRSZWZlcmVuY2VgIHJlZmVycyB0byBhIGRvY3VtZW50IGxvY2F0aW9uIGluIGEgRmlyZXN0b3JlIGRhdGFiYXNlXG4gKiBhbmQgY2FuIGJlIHVzZWQgdG8gd3JpdGUsIHJlYWQsIG9yIGxpc3RlbiB0byB0aGUgbG9jYXRpb24uIFRoZSBkb2N1bWVudCBhdFxuICogdGhlIHJlZmVyZW5jZWQgbG9jYXRpb24gbWF5IG9yIG1heSBub3QgZXhpc3QuXG4gKi8gY2xhc3MgRG9jdW1lbnRSZWZlcmVuY2Uge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLyoqXG4gICAgICogSWYgcHJvdmlkZWQsIHRoZSBgRmlyZXN0b3JlRGF0YUNvbnZlcnRlcmAgYXNzb2NpYXRlZCB3aXRoIHRoaXMgaW5zdGFuY2UuXG4gICAgICovXG4gICAgdCwgbikge1xuICAgICAgICB0aGlzLmNvbnZlcnRlciA9IHQsIHRoaXMuX2tleSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBGaXJlc3RvcmUgcmVmZXJlbmNlLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcImRvY3VtZW50XCIsIHRoaXMuZmlyZXN0b3JlID0gZTtcbiAgICB9XG4gICAgZ2V0IF9wYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fa2V5LnBhdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBkb2N1bWVudCdzIGlkZW50aWZpZXIgd2l0aGluIGl0cyBjb2xsZWN0aW9uLlxuICAgICAqLyAgICBnZXQgaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHBhdGggb2YgdGhlIHJlZmVyZW5jZWQgZG9jdW1lbnQgKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGNvbGxlY3Rpb24gdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGJlbG9uZ3MgdG8uXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvblJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgdGhpcy5jb252ZXJ0ZXIsIHRoaXMuX2tleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50UmVmZXJlbmNlKHRoaXMuZmlyZXN0b3JlLCBlLCB0aGlzLl9rZXkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBDb2xsZWN0aW9uUmVmZXJlbmNlYCBvYmplY3QgY2FuIGJlIHVzZWQgZm9yIGFkZGluZyBkb2N1bWVudHMsIGdldHRpbmdcbiAqIGRvY3VtZW50IHJlZmVyZW5jZXMsIGFuZCBxdWVyeWluZyBmb3IgZG9jdW1lbnRzICh1c2luZyB7QGxpbmsgKHF1ZXJ5OjEpfSkuXG4gKi8gY2xhc3MgQ29sbGVjdGlvblJlZmVyZW5jZSBleHRlbmRzIFF1ZXJ5IHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoZSwgdCwgX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChuKSksIHRoaXMuX3BhdGggPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJjb2xsZWN0aW9uXCI7XG4gICAgfVxuICAgIC8qKiBUaGUgY29sbGVjdGlvbidzIGlkZW50aWZpZXIuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYXRoIG9mIHRoZSByZWZlcmVuY2VkIGNvbGxlY3Rpb24gKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgY29udGFpbmluZyBgRG9jdW1lbnRSZWZlcmVuY2VgIGlmIHRoaXMgaXMgYVxuICAgICAqIHN1YmNvbGxlY3Rpb24uIElmIHRoaXMgaXNuJ3QgYSBzdWJjb2xsZWN0aW9uLCB0aGUgcmVmZXJlbmNlIGlzIG51bGwuXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLl9wYXRoLnBvcExhc3QoKTtcbiAgICAgICAgcmV0dXJuIGUuaXNFbXB0eSgpID8gbnVsbCA6IG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgXG4gICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgbmV3IERvY3VtZW50S2V5KGUpKTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvblJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgZSwgdGhpcy5fcGF0aCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjb2xsZWN0aW9uKGUsIHQsIC4uLm4pIHtcbiAgICBpZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgX19QUklWQVRFX3ZhbGlkYXRlTm9uRW1wdHlBcmd1bWVudChcImNvbGxlY3Rpb25cIiwgXCJwYXRoXCIsIHQpLCBlIGluc3RhbmNlb2YgRmlyZXN0b3JlJDEpIHtcbiAgICAgICAgY29uc3QgciA9IFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQsIC4uLm4pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlQ29sbGVjdGlvblBhdGgociksIG5ldyBDb2xsZWN0aW9uUmVmZXJlbmNlKGUsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgcik7XG4gICAgfVxuICAgIHtcbiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IGUgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJFeHBlY3RlZCBmaXJzdCBhcmd1bWVudCB0byBjb2xsZWN0aW9uKCkgdG8gYmUgYSBDb2xsZWN0aW9uUmVmZXJlbmNlLCBhIERvY3VtZW50UmVmZXJlbmNlIG9yIEZpcmViYXNlRmlyZXN0b3JlXCIpO1xuICAgICAgICBjb25zdCByID0gZS5fcGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0LCAuLi5uKSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVDb2xsZWN0aW9uUGF0aChyKSwgbmV3IENvbGxlY3Rpb25SZWZlcmVuY2UoZS5maXJlc3RvcmUsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHIpO1xuICAgIH1cbn1cblxuLy8gVE9ETyhmaXJlc3RvcmVsaXRlKTogQ29uc2lkZXIgdXNpbmcgRXJyb3JGYWN0b3J5IC1cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvYmxvYi8wMTMxZTFmL3BhY2thZ2VzL3V0aWwvc3JjL2Vycm9ycy50cyNMMTA2XG4vKipcbiAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgYFF1ZXJ5YCBpbnN0YW5jZSB0aGF0IGluY2x1ZGVzIGFsbCBkb2N1bWVudHMgaW4gdGhlXG4gKiBkYXRhYmFzZSB0aGF0IGFyZSBjb250YWluZWQgaW4gYSBjb2xsZWN0aW9uIG9yIHN1YmNvbGxlY3Rpb24gd2l0aCB0aGVcbiAqIGdpdmVuIGBjb2xsZWN0aW9uSWRgLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBBIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBgRmlyZXN0b3JlYCBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWQgLSBJZGVudGlmaWVzIHRoZSBjb2xsZWN0aW9ucyB0byBxdWVyeSBvdmVyLiBFdmVyeVxuICogY29sbGVjdGlvbiBvciBzdWJjb2xsZWN0aW9uIHdpdGggdGhpcyBJRCBhcyB0aGUgbGFzdCBzZWdtZW50IG9mIGl0cyBwYXRoXG4gKiB3aWxsIGJlIGluY2x1ZGVkLiBDYW5ub3QgY29udGFpbiBhIHNsYXNoLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQgYFF1ZXJ5YC5cbiAqLyBmdW5jdGlvbiBjb2xsZWN0aW9uR3JvdXAoZSwgdCkge1xuICAgIGlmIChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlJDEpLCBfX1BSSVZBVEVfdmFsaWRhdGVOb25FbXB0eUFyZ3VtZW50KFwiY29sbGVjdGlvbkdyb3VwXCIsIFwiY29sbGVjdGlvbiBpZFwiLCB0KSwgXG4gICAgdC5pbmRleE9mKFwiL1wiKSA+PSAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBjb2xsZWN0aW9uIElEICcke3R9JyBwYXNzZWQgdG8gZnVuY3Rpb24gY29sbGVjdGlvbkdyb3VwKCkuIENvbGxlY3Rpb24gSURzIG11c3Qgbm90IGNvbnRhaW4gJy8nLmApO1xuICAgIHJldHVybiBuZXcgUXVlcnkoZSwgXG4gICAgLyogY29udmVydGVyPSAqLyBudWxsLCBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlGb3JDb2xsZWN0aW9uR3JvdXAoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoUmVzb3VyY2VQYXRoLmVtcHR5UGF0aCgpLCBlKTtcbiAgICB9KHQpKTtcbn1cblxuZnVuY3Rpb24gZG9jKGUsIHQsIC4uLm4pIHtcbiAgICBpZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgXG4gICAgLy8gV2UgYWxsb3cgb21pc3Npb24gb2YgJ3BhdGhTdHJpbmcnIGJ1dCBleHBsaWNpdGx5IHByb2hpYml0IHBhc3NpbmcgaW4gYm90aFxuICAgIC8vICd1bmRlZmluZWQnIGFuZCAnbnVsbCcuXG4gICAgMSA9PT0gYXJndW1lbnRzLmxlbmd0aCAmJiAodCA9IF9fUFJJVkFURV9BdXRvSWQuVigpKSwgX19QUklWQVRFX3ZhbGlkYXRlTm9uRW1wdHlBcmd1bWVudChcImRvY1wiLCBcInBhdGhcIiwgdCksIFxuICAgIGUgaW5zdGFuY2VvZiBGaXJlc3RvcmUkMSkge1xuICAgICAgICBjb25zdCByID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcodCwgLi4ubik7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVEb2N1bWVudFBhdGgociksIG5ldyBEb2N1bWVudFJlZmVyZW5jZShlLCBcbiAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsLCBuZXcgRG9jdW1lbnRLZXkocikpO1xuICAgIH1cbiAgICB7XG4gICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSB8fCBlIGluc3RhbmNlb2YgQ29sbGVjdGlvblJlZmVyZW5jZSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiRXhwZWN0ZWQgZmlyc3QgYXJndW1lbnQgdG8gY29sbGVjdGlvbigpIHRvIGJlIGEgQ29sbGVjdGlvblJlZmVyZW5jZSwgYSBEb2N1bWVudFJlZmVyZW5jZSBvciBGaXJlYmFzZUZpcmVzdG9yZVwiKTtcbiAgICAgICAgY29uc3QgciA9IGUuX3BhdGguY2hpbGQoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcodCwgLi4ubikpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlRG9jdW1lbnRQYXRoKHIpLCBuZXcgRG9jdW1lbnRSZWZlcmVuY2UoZS5maXJlc3RvcmUsIGUgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlID8gZS5jb252ZXJ0ZXIgOiBudWxsLCBuZXcgRG9jdW1lbnRLZXkocikpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHJlZmVyZW5jZXMgYXJlIGVxdWFsLlxuICpcbiAqIEBwYXJhbSBsZWZ0IC0gQSByZWZlcmVuY2UgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSByaWdodCAtIEEgcmVmZXJlbmNlIHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2VzIHBvaW50IHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBzYW1lXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UuXG4gKi8gZnVuY3Rpb24gcmVmRXF1YWwoZSwgdCkge1xuICAgIHJldHVybiBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpLCB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpLCAoZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IGUgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlKSAmJiAodCBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IHQgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlKSAmJiAoZS5maXJlc3RvcmUgPT09IHQuZmlyZXN0b3JlICYmIGUucGF0aCA9PT0gdC5wYXRoICYmIGUuY29udmVydGVyID09PSB0LmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBxdWVyaWVzIHBvaW50IHRvIHRoZSBzYW1lIGNvbGxlY3Rpb24gYW5kIGFwcGx5XG4gKiB0aGUgc2FtZSBjb25zdHJhaW50cy5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgYFF1ZXJ5YCB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gQSBgUXVlcnlgIHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2VzIHBvaW50IHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBzYW1lXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UuXG4gKi8gZnVuY3Rpb24gcXVlcnlFcXVhbChlLCB0KSB7XG4gICAgcmV0dXJuIGUgPSBnZXRNb2R1bGFySW5zdGFuY2UoZSksIHQgPSBnZXRNb2R1bGFySW5zdGFuY2UodCksIGUgaW5zdGFuY2VvZiBRdWVyeSAmJiB0IGluc3RhbmNlb2YgUXVlcnkgJiYgKGUuZmlyZXN0b3JlID09PSB0LmZpcmVzdG9yZSAmJiBfX1BSSVZBVEVfcXVlcnlFcXVhbHMoZS5fcXVlcnksIHQuX3F1ZXJ5KSAmJiBlLmNvbnZlcnRlciA9PT0gdC5jb252ZXJ0ZXIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQXN5bmNRdWV1ZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBUaGUgbGFzdCBwcm9taXNlIGluIHRoZSBxdWV1ZS5cbiAgICAgICAgdGhpcy5XYSA9IFByb21pc2UucmVzb2x2ZSgpLCBcbiAgICAgICAgLy8gQSBsaXN0IG9mIHJldHJ5YWJsZSBvcGVyYXRpb25zLiBSZXRyeWFibGUgb3BlcmF0aW9ucyBhcmUgcnVuIGluIG9yZGVyIGFuZFxuICAgICAgICAvLyByZXRyaWVkIHdpdGggYmFja29mZi5cbiAgICAgICAgdGhpcy5HYSA9IFtdLCBcbiAgICAgICAgLy8gSXMgdGhpcyBBc3luY1F1ZXVlIGJlaW5nIHNodXQgZG93bj8gT25jZSBpdCBpcyBzZXQgdG8gdHJ1ZSwgaXQgd2lsbCBub3RcbiAgICAgICAgLy8gYmUgY2hhbmdlZCBhZ2Fpbi5cbiAgICAgICAgdGhpcy56YSA9ICExLCBcbiAgICAgICAgLy8gT3BlcmF0aW9ucyBzY2hlZHVsZWQgdG8gYmUgcXVldWVkIGluIHRoZSBmdXR1cmUuIE9wZXJhdGlvbnMgYXJlXG4gICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZCBhZnRlciB0aGV5IGFyZSBydW4gb3IgY2FuY2VsZWQuXG4gICAgICAgIHRoaXMuamEgPSBbXSwgXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgdGhpcy5IYSA9IG51bGwsIFxuICAgICAgICAvLyBGbGFnIHNldCB3aGlsZSB0aGVyZSdzIGFuIG91dHN0YW5kaW5nIEFzeW5jUXVldWUgb3BlcmF0aW9uLCB1c2VkIGZvclxuICAgICAgICAvLyBhc3NlcnRpb24gc2FuaXR5LWNoZWNrcy5cbiAgICAgICAgdGhpcy5KYSA9ICExLCBcbiAgICAgICAgLy8gRW5hYmxlZCBkdXJpbmcgc2h1dGRvd24gb24gU2FmYXJpIHRvIHByZXZlbnQgZnV0dXJlIGFjY2VzcyB0byBJbmRleGVkREIuXG4gICAgICAgIHRoaXMuWWEgPSAhMSwgXG4gICAgICAgIC8vIExpc3Qgb2YgVGltZXJJZHMgdG8gZmFzdC1mb3J3YXJkIGRlbGF5cyBmb3IuXG4gICAgICAgIHRoaXMuWmEgPSBbXSwgXG4gICAgICAgIC8vIEJhY2tvZmYgdGltZXIgdXNlZCB0byBzY2hlZHVsZSByZXRyaWVzIGZvciByZXRyeWFibGUgb3BlcmF0aW9uc1xuICAgICAgICB0aGlzLktvID0gbmV3IF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYodGhpcywgXCJhc3luY19xdWV1ZV9yZXRyeVwiIC8qIFRpbWVySWQuQXN5bmNRdWV1ZVJldHJ5ICovKSwgXG4gICAgICAgIC8vIFZpc2liaWxpdHkgaGFuZGxlciB0aGF0IHRyaWdnZXJzIGFuIGltbWVkaWF0ZSByZXRyeSBvZiBhbGwgcmV0cnlhYmxlXG4gICAgICAgIC8vIG9wZXJhdGlvbnMuIE1lYW50IHRvIHNwZWVkIHVwIHJlY292ZXJ5IHdoZW4gd2UgcmVnYWluIGZpbGUgc3lzdGVtIGFjY2Vzc1xuICAgICAgICAvLyBhZnRlciBwYWdlIGNvbWVzIGludG8gZm9yZWdyb3VuZC5cbiAgICAgICAgdGhpcy5YYSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBnZXREb2N1bWVudCgpO1xuICAgICAgICAgICAgZSAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJBc3luY1F1ZXVlXCIsIFwiVmlzaWJpbGl0eSBzdGF0ZSBjaGFuZ2VkIHRvIFwiICsgZS52aXNpYmlsaXR5U3RhdGUpLCBcbiAgICAgICAgICAgIHRoaXMuS28uTm8oKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZSA9IGdldERvY3VtZW50KCk7XG4gICAgICAgIGUgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlLmFkZEV2ZW50TGlzdGVuZXIgJiYgZS5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCB0aGlzLlhhKTtcbiAgICB9XG4gICAgZ2V0IGlzU2h1dHRpbmdEb3duKCkge1xuICAgICAgICByZXR1cm4gdGhpcy56YTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyBvcGVyYXRpb24gdG8gdGhlIHF1ZXVlIHdpdGhvdXQgd2FpdGluZyBmb3IgaXQgdG8gY29tcGxldGUgKGkuZS5cbiAgICAgKiB3ZSBpZ25vcmUgdGhlIFByb21pc2UgcmVzdWx0KS5cbiAgICAgKi8gICAgZW5xdWV1ZUFuZEZvcmdldChlKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhpcy5lbnF1ZXVlKGUpO1xuICAgIH1cbiAgICBlbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZChlKSB7XG4gICAgICAgIHRoaXMuZXUoKSwgXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhpcy50dShlKTtcbiAgICB9XG4gICAgZW50ZXJSZXN0cmljdGVkTW9kZShlKSB7XG4gICAgICAgIGlmICghdGhpcy56YSkge1xuICAgICAgICAgICAgdGhpcy56YSA9ICEwLCB0aGlzLllhID0gZSB8fCAhMTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBnZXREb2N1bWVudCgpO1xuICAgICAgICAgICAgdCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQucmVtb3ZlRXZlbnRMaXN0ZW5lciAmJiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuWGEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVucXVldWUoZSkge1xuICAgICAgICBpZiAodGhpcy5ldSgpLCB0aGlzLnphKSBcbiAgICAgICAgLy8gUmV0dXJuIGEgUHJvbWlzZSB3aGljaCBuZXZlciByZXNvbHZlcy5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgoKSA9PiB7fSkpO1xuICAgICAgICAvLyBDcmVhdGUgYSBkZWZlcnJlZCBQcm9taXNlIHRoYXQgd2UgY2FuIHJldHVybiB0byB0aGUgY2FsbGVlLiBUaGlzXG4gICAgICAgIC8vIGFsbG93cyB1cyB0byByZXR1cm4gYSBcImhhbmdpbmcgUHJvbWlzZVwiIG9ubHkgdG8gdGhlIGNhbGxlZSBhbmQgc3RpbGxcbiAgICAgICAgLy8gYWR2YW5jZSB0aGUgcXVldWUgZXZlbiB3aGVuIHRoZSBvcGVyYXRpb24gaXMgbm90IHJ1bi5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICAgICAgcmV0dXJuIHRoaXMudHUoKCgpID0+IHRoaXMuemEgJiYgdGhpcy5ZYSA/IFByb21pc2UucmVzb2x2ZSgpIDogKGUoKS50aGVuKHQucmVzb2x2ZSwgdC5yZWplY3QpLCBcbiAgICAgICAgdC5wcm9taXNlKSkpLnRoZW4oKCgpID0+IHQucHJvbWlzZSkpO1xuICAgIH1cbiAgICBlbnF1ZXVlUmV0cnlhYmxlKGUpIHtcbiAgICAgICAgdGhpcy5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy5HYS5wdXNoKGUpLCB0aGlzLm51KCkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJ1bnMgdGhlIG5leHQgb3BlcmF0aW9uIGZyb20gdGhlIHJldHJ5YWJsZSBxdWV1ZS4gSWYgdGhlIG9wZXJhdGlvbiBmYWlscyxcbiAgICAgKiByZXNjaGVkdWxlcyB3aXRoIGJhY2tvZmYuXG4gICAgICovICAgIGFzeW5jIG51KCkge1xuICAgICAgICBpZiAoMCAhPT0gdGhpcy5HYS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5HYVswXSgpLCB0aGlzLkdhLnNoaWZ0KCksIHRoaXMuS28ucmVzZXQoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkpIHRocm93IGU7XG4gLy8gRmFpbHVyZSB3aWxsIGJlIGhhbmRsZWQgYnkgQXN5bmNRdWV1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJBc3luY1F1ZXVlXCIsIFwiT3BlcmF0aW9uIGZhaWxlZCB3aXRoIHJldHJ5YWJsZSBlcnJvcjogXCIgKyBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuR2EubGVuZ3RoID4gMCAmJiBcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBhZGRpdGlvbmFsIG9wZXJhdGlvbnMsIHdlIHJlLXNjaGVkdWxlIGByZXRyeU5leHRPcCgpYC5cbiAgICAgICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIHJ1biByZXRyeWFibGUgb3BlcmF0aW9ucyB0aGF0IGZhaWxlZCBkdXJpbmdcbiAgICAgICAgICAgIC8vIHRoZWlyIGluaXRpYWwgYXR0ZW1wdCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoZXRoZXIgdGhleSBhcmUgYWxyZWFkeVxuICAgICAgICAgICAgLy8gZW5xdWV1ZWQuIElmLCBmb3IgZXhhbXBsZSwgYG9wMWAsIGBvcDJgLCBgb3AzYCBhcmUgZW5xdWV1ZWQgYW5kIGBvcDFgXG4gICAgICAgICAgICAvLyBuZWVkcyB0byAgYmUgcmUtcnVuLCB3ZSB3aWxsIHJ1biBgb3AxYCwgYG9wMWAsIGBvcDJgIHVzaW5nIHRoZVxuICAgICAgICAgICAgLy8gYWxyZWFkeSBlbnF1ZXVlZCBjYWxscyB0byBgcmV0cnlOZXh0T3AoKWAuIGBvcDMoKWAgd2lsbCB0aGVuIHJ1biBpbiB0aGVcbiAgICAgICAgICAgIC8vIGNhbGwgc2NoZWR1bGVkIGhlcmUuXG4gICAgICAgICAgICAvLyBTaW5jZSBgYmFja29mZkFuZFJ1bigpYCBjYW5jZWxzIGFuIGV4aXN0aW5nIGJhY2tvZmYgYW5kIHNjaGVkdWxlcyBhXG4gICAgICAgICAgICAvLyBuZXcgYmFja29mZiBvbiBldmVyeSBjYWxsLCB0aGVyZSBpcyBvbmx5IGV2ZXIgYSBzaW5nbGUgYWRkaXRpb25hbFxuICAgICAgICAgICAgLy8gb3BlcmF0aW9uIGluIHRoZSBxdWV1ZS5cbiAgICAgICAgICAgIHRoaXMuS28ueG8oKCgpID0+IHRoaXMubnUoKSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHR1KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuV2EudGhlbigoKCkgPT4gKHRoaXMuSmEgPSAhMCwgZSgpLmNhdGNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuSGEgPSBlLCB0aGlzLkphID0gITE7XG4gICAgICAgICAgICBjb25zdCB0ID0gXG4gICAgICAgICAgICAvKipcbiAqIENocm9tZSBpbmNsdWRlcyBFcnJvci5tZXNzYWdlIGluIEVycm9yLnN0YWNrLiBPdGhlciBicm93c2VycyBkbyBub3QuXG4gKiBUaGlzIHJldHVybnMgZXhwZWN0ZWQgb3V0cHV0IG9mIG1lc3NhZ2UgKyBzdGFjayB3aGVuIGF2YWlsYWJsZS5cbiAqIEBwYXJhbSBlcnJvciAtIEVycm9yIG9yIEZpcmVzdG9yZUVycm9yXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRNZXNzYWdlT3JTdGFjayhlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHQgPSBlLm1lc3NhZ2UgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBlLnN0YWNrICYmICh0ID0gZS5zdGFjay5pbmNsdWRlcyhlLm1lc3NhZ2UpID8gZS5zdGFjayA6IGUubWVzc2FnZSArIFwiXFxuXCIgKyBlLnN0YWNrKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChlKTtcbiAgICAgICAgICAgIC8vIFJlLXRocm93IHRoZSBlcnJvciBzbyB0aGF0IHRoaXMudGFpbCBiZWNvbWVzIGEgcmVqZWN0ZWQgUHJvbWlzZSBhbmRcbiAgICAgICAgICAgIC8vIGFsbCBmdXJ0aGVyIGF0dGVtcHRzIHRvIGNoYWluICh2aWEgLnRoZW4pIHdpbGwganVzdCBzaG9ydC1jaXJjdWl0XG4gICAgICAgICAgICAvLyBhbmQgcmV0dXJuIHRoZSByZWplY3RlZCBQcm9taXNlLlxuICAgICAgICAgICAgdGhyb3cgX19QUklWQVRFX2xvZ0Vycm9yKFwiSU5URVJOQUwgVU5IQU5ETEVEIEVSUk9SOiBcIiwgdCksIGU7XG4gICAgICAgIH0pKS50aGVuKChlID0+ICh0aGlzLkphID0gITEsIGUpKSkpKSk7XG4gICAgICAgIHJldHVybiB0aGlzLldhID0gdCwgdDtcbiAgICB9XG4gICAgZW5xdWV1ZUFmdGVyRGVsYXkoZSwgdCwgbikge1xuICAgICAgICB0aGlzLmV1KCksIFxuICAgICAgICAvLyBGYXN0LWZvcndhcmQgZGVsYXlzIGZvciB0aW1lcklkcyB0aGF0IGhhdmUgYmVlbiBvdmVycmlkZW4uXG4gICAgICAgIHRoaXMuWmEuaW5kZXhPZihlKSA+IC0xICYmICh0ID0gMCk7XG4gICAgICAgIGNvbnN0IHIgPSBEZWxheWVkT3BlcmF0aW9uLmNyZWF0ZUFuZFNjaGVkdWxlKHRoaXMsIGUsIHQsIG4sIChlID0+IHRoaXMucnUoZSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuamEucHVzaChyKSwgcjtcbiAgICB9XG4gICAgZXUoKSB7XG4gICAgICAgIHRoaXMuSGEgJiYgZmFpbCgpO1xuICAgIH1cbiAgICB2ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCkge31cbiAgICAvKipcbiAgICAgKiBXYWl0cyB1bnRpbCBhbGwgY3VycmVudGx5IHF1ZXVlZCB0YXNrcyBhcmUgZmluaXNoZWQgZXhlY3V0aW5nLiBEZWxheWVkXG4gICAgICogb3BlcmF0aW9ucyBhcmUgbm90IHJ1bi5cbiAgICAgKi8gICAgYXN5bmMgaXUoKSB7XG4gICAgICAgIC8vIE9wZXJhdGlvbnMgaW4gdGhlIHF1ZXVlIHByaW9yIHRvIGRyYWluaW5nIG1heSBoYXZlIGVucXVldWVkIGFkZGl0aW9uYWxcbiAgICAgICAgLy8gb3BlcmF0aW9ucy4gS2VlcCBkcmFpbmluZyB0aGUgcXVldWUgdW50aWwgdGhlIHRhaWwgaXMgbm8gbG9uZ2VyIGFkdmFuY2VkLFxuICAgICAgICAvLyB3aGljaCBpbmRpY2F0ZXMgdGhhdCBubyBtb3JlIG5ldyBvcGVyYXRpb25zIHdlcmUgZW5xdWV1ZWQgYW5kIHRoYXQgYWxsXG4gICAgICAgIC8vIG9wZXJhdGlvbnMgd2VyZSBleGVjdXRlZC5cbiAgICAgICAgbGV0IGU7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGUgPSB0aGlzLldhLCBhd2FpdCBlO1xuICAgICAgICB9IHdoaWxlIChlICE9PSB0aGlzLldhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBEZXRlcm1pbmUgaWYgYSBkZWxheWVkIG9wZXJhdGlvbiB3aXRoIGEgcGFydGljdWxhciBUaW1lcklkXG4gICAgICogZXhpc3RzLlxuICAgICAqLyAgICBzdShlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLmphKSBpZiAodC50aW1lcklkID09PSBlKSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBSdW5zIHNvbWUgb3IgYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucyBlYXJseS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBsYXN0VGltZXJJZCAtIERlbGF5ZWQgb3BlcmF0aW9ucyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoaXMgVGltZXJJZFxuICAgICAqIHdpbGwgYmUgZHJhaW5lZC4gUGFzcyBUaW1lcklkLkFsbCB0byBydW4gYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucy5cbiAgICAgKiBAcmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyBvbmNlIGFsbCBvcGVyYXRpb25zIGhhdmUgYmVlbiBydW4uXG4gICAgICovICAgIG91KGUpIHtcbiAgICAgICAgLy8gTm90ZSB0aGF0IGRyYWluaW5nIG1heSBnZW5lcmF0ZSBtb3JlIGRlbGF5ZWQgb3BzLCBzbyB3ZSBkbyB0aGF0IGZpcnN0LlxuICAgICAgICByZXR1cm4gdGhpcy5pdSgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFJ1biBvcHMgaW4gdGhlIHNhbWUgb3JkZXIgdGhleSdkIHJ1biBpZiB0aGV5IHJhbiBuYXR1cmFsbHkuXG4gICAgICAgICAgICB0aGlzLmphLnNvcnQoKChlLCB0KSA9PiBlLnRhcmdldFRpbWVNcyAtIHQudGFyZ2V0VGltZU1zKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGhpcy5qYSkgaWYgKHQuc2tpcERlbGF5KCksIFwiYWxsXCIgLyogVGltZXJJZC5BbGwgKi8gIT09IGUgJiYgdC50aW1lcklkID09PSBlKSBicmVhaztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml1KCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBTa2lwIGFsbCBzdWJzZXF1ZW50IGRlbGF5cyBmb3IgYSB0aW1lciBpZC5cbiAgICAgKi8gICAgX3UoZSkge1xuICAgICAgICB0aGlzLlphLnB1c2goZSk7XG4gICAgfVxuICAgIC8qKiBDYWxsZWQgb25jZSBhIERlbGF5ZWRPcGVyYXRpb24gaXMgcnVuIG9yIGNhbmNlbGVkLiAqLyAgICBydShlKSB7XG4gICAgICAgIC8vIE5PVEU6IGluZGV4T2YgLyBzbGljZSBhcmUgTyhuKSwgYnV0IGRlbGF5ZWRPcGVyYXRpb25zIGlzIGV4cGVjdGVkIHRvIGJlIHNtYWxsLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5qYS5pbmRleE9mKGUpO1xuICAgICAgICB0aGlzLmphLnNwbGljZSh0LCAxKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1BhcnRpYWxPYnNlcnZlcihlKSB7XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgb2JqIGlzIGFuIG9iamVjdCBhbmQgY29udGFpbnMgYXQgbGVhc3Qgb25lIG9mIHRoZSBzcGVjaWZpZWRcbiAqIG1ldGhvZHMuXG4gKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2ltcGxlbWVudHNBbnlNZXRob2RzKGUsIHQpIHtcbiAgICAgICAgaWYgKFwib2JqZWN0XCIgIT0gdHlwZW9mIGUgfHwgbnVsbCA9PT0gZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gZTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIGlmIChlIGluIG4gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuW2VdKSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAvKipcbiAqIFJlcHJlc2VudHMgdGhlIHRhc2sgb2YgbG9hZGluZyBhIEZpcmVzdG9yZSBidW5kbGUuIEl0IHByb3ZpZGVzIHByb2dyZXNzIG9mIGJ1bmRsZVxuICogbG9hZGluZywgYXMgd2VsbCBhcyB0YXNrIGNvbXBsZXRpb24gYW5kIGVycm9yIGV2ZW50cy5cbiAqXG4gKiBUaGUgQVBJIGlzIGNvbXBhdGlibGUgd2l0aCBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPmAuXG4gKi8gKGUsIFsgXCJuZXh0XCIsIFwiZXJyb3JcIiwgXCJjb21wbGV0ZVwiIF0pO1xufVxuXG5jbGFzcyBMb2FkQnVuZGxlVGFzayB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIgPSB7fSwgdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MgPSB7XG4gICAgICAgICAgICB0YXNrU3RhdGU6IFwiUnVubmluZ1wiLFxuICAgICAgICAgICAgdG90YWxCeXRlczogMCxcbiAgICAgICAgICAgIHRvdGFsRG9jdW1lbnRzOiAwLFxuICAgICAgICAgICAgYnl0ZXNMb2FkZWQ6IDAsXG4gICAgICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IDBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGZ1bmN0aW9ucyB0byBsaXN0ZW4gdG8gYnVuZGxlIGxvYWRpbmcgcHJvZ3Jlc3MgZXZlbnRzLlxuICAgICAqIEBwYXJhbSBuZXh0IC0gQ2FsbGVkIHdoZW4gdGhlcmUgaXMgYSBwcm9ncmVzcyB1cGRhdGUgZnJvbSBidW5kbGUgbG9hZGluZy4gVHlwaWNhbGx5IGBuZXh0YCBjYWxscyBvY2N1clxuICAgICAqICAgZWFjaCB0aW1lIGEgRmlyZXN0b3JlIGRvY3VtZW50IGlzIGxvYWRlZCBmcm9tIHRoZSBidW5kbGUuXG4gICAgICogQHBhcmFtIGVycm9yIC0gQ2FsbGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyBidW5kbGUgbG9hZGluZy4gVGhlIHRhc2sgYWJvcnRzIGFmdGVyIHJlcG9ydGluZyB0aGVcbiAgICAgKiAgIGVycm9yLCBhbmQgdGhlcmUgc2hvdWxkIGJlIG5vIG1vcmUgdXBkYXRlcyBhZnRlciB0aGlzLlxuICAgICAqIEBwYXJhbSBjb21wbGV0ZSAtIENhbGxlZCB3aGVuIHRoZSBsb2FkaW5nIHRhc2sgaXMgY29tcGxldGUuXG4gICAgICovICAgIG9uUHJvZ3Jlc3MoZSwgdCwgbikge1xuICAgICAgICB0aGlzLl9wcm9ncmVzc09ic2VydmVyID0ge1xuICAgICAgICAgICAgbmV4dDogZSxcbiAgICAgICAgICAgIGVycm9yOiB0LFxuICAgICAgICAgICAgY29tcGxldGU6IG5cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50cyB0aGUgYFByb21pc2U8TG9hZEJ1bmRsZVRhc2tQcm9ncmVzcz4uY2F0Y2hgIGludGVyZmFjZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvblJlamVjdGVkIC0gQ2FsbGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyBidW5kbGUgbG9hZGluZy5cbiAgICAgKi8gICAgY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5wcm9taXNlLmNhdGNoKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPi50aGVuYCBpbnRlcmZhY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb25GdWxmaWxsZWQgLSBDYWxsZWQgb24gdGhlIGNvbXBsZXRpb24gb2YgdGhlIGxvYWRpbmcgdGFzayB3aXRoIGEgZmluYWwgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHVwZGF0ZS5cbiAgICAgKiAgIFRoZSB1cGRhdGUgd2lsbCBhbHdheXMgaGF2ZSBpdHMgYHRhc2tTdGF0ZWAgc2V0IHRvIGBcIlN1Y2Nlc3NcImAuXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLlxuICAgICAqLyAgICB0aGVuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucHJvbWlzZS50aGVuKGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOb3RpZmllcyBhbGwgb2JzZXJ2ZXJzIHRoYXQgYnVuZGxlIGxvYWRpbmcgaGFzIGNvbXBsZXRlZCwgd2l0aCBhIHByb3ZpZGVkXG4gICAgICogYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF9jb21wbGV0ZVdpdGgoZSkge1xuICAgICAgICB0aGlzLl91cGRhdGVQcm9ncmVzcyhlKSwgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5jb21wbGV0ZSAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmNvbXBsZXRlKCksIFxuICAgICAgICB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyLnJlc29sdmUoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGFsbCBvYnNlcnZlcnMgdGhhdCBidW5kbGUgbG9hZGluZyBoYXMgZmFpbGVkLCB3aXRoIGEgcHJvdmlkZWRcbiAgICAgKiBgRXJyb3JgIGFzIHRoZSByZWFzb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqLyAgICBfZmFpbFdpdGgoZSkge1xuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MudGFza1N0YXRlID0gXCJFcnJvclwiLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5uZXh0KHRoaXMuX2xhc3RQcm9ncmVzcyksIFxuICAgICAgICB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmVycm9yICYmIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuZXJyb3IoZSksIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucmVqZWN0KGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOb3RpZmllcyBhIHByb2dyZXNzIHVwZGF0ZSBvZiBsb2FkaW5nIGEgYnVuZGxlLlxuICAgICAqIEBwYXJhbSBwcm9ncmVzcyAtIFRoZSBuZXcgcHJvZ3Jlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqLyAgICBfdXBkYXRlUHJvZ3Jlc3MoZSkge1xuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MgPSBlLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5uZXh0KGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29uc3RhbnQgdXNlZCB0byBpbmRpY2F0ZSB0aGUgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbiBzaG91bGQgYmUgZGlzYWJsZWQuXG4gKiBTZXQgdGhpcyB2YWx1ZSBhcyB0aGUgYGNhY2hlU2l6ZUJ5dGVzYCBvbiB0aGUgc2V0dGluZ3MgcGFzc2VkIHRvIHRoZVxuICoge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gY29uc3QgZ2UgPSAtMTtcblxuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi8gY2xhc3MgRmlyZXN0b3JlIGV4dGVuZHMgRmlyZXN0b3JlJDEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICBzdXBlcihlLCB0LCBuLCByKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGl0J3MgYSB7QGxpbmsgRmlyZXN0b3JlfSBvciBGaXJlc3RvcmUgTGl0ZSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlyZXN0b3JlXCIsIHRoaXMuX3F1ZXVlID0gZnVuY3Rpb24gX19QUklWQVRFX25ld0FzeW5jUXVldWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9Bc3luY1F1ZXVlSW1wbDtcbiAgICAgICAgfSgpLCB0aGlzLl9wZXJzaXN0ZW5jZUtleSA9IChudWxsID09IHIgPyB2b2lkIDAgOiByLm5hbWUpIHx8IFwiW0RFRkFVTFRdXCI7XG4gICAgfVxuICAgIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maXJlc3RvcmVDbGllbnQgfHwgXG4gICAgICAgIC8vIFRoZSBjbGllbnQgbXVzdCBiZSBpbml0aWFsaXplZCB0byBlbnN1cmUgdGhhdCBhbGwgc3Vic2VxdWVudCBBUElcbiAgICAgICAgLy8gdXNhZ2UgdGhyb3dzIGFuIGV4Y2VwdGlvbi5cbiAgICAgICAgX19QUklWQVRFX2NvbmZpZ3VyZUZpcmVzdG9yZSh0aGlzKSwgdGhpcy5fZmlyZXN0b3JlQ2xpZW50LnRlcm1pbmF0ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB7QGxpbmsgRmlyZXN0b3JlfSB3aXRoIHRoZSBwcm92aWRlZCBzZXR0aW5ncy5cbiAqIENhbiBvbmx5IGJlIGNhbGxlZCBiZWZvcmUgYW55IG90aGVyIGZ1bmN0aW9uLCBpbmNsdWRpbmdcbiAqIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfS4gSWYgdGhlIGN1c3RvbSBzZXR0aW5ncyBhcmUgZW1wdHksIHRoaXMgZnVuY3Rpb24gaXNcbiAqIGVxdWl2YWxlbnQgdG8gY2FsbGluZyB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKlxuICogQHBhcmFtIGFwcCAtIFRoZSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gd2l0aCB3aGljaCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbFxuICogYmUgYXNzb2NpYXRlZC5cbiAqIEBwYXJhbSBzZXR0aW5ncyAtIEEgc2V0dGluZ3Mgb2JqZWN0IHRvIGNvbmZpZ3VyZSB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gZGF0YWJhc2VJZCAtIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqIEByZXR1cm5zIEEgbmV3bHkgaW5pdGlhbGl6ZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gaW5pdGlhbGl6ZUZpcmVzdG9yZShlLCB0LCBuKSB7XG4gICAgbiB8fCAobiA9IFwiKGRlZmF1bHQpXCIpO1xuICAgIGNvbnN0IHIgPSBfZ2V0UHJvdmlkZXIoZSwgXCJmaXJlc3RvcmVcIik7XG4gICAgaWYgKHIuaXNJbml0aWFsaXplZChuKSkge1xuICAgICAgICBjb25zdCBlID0gci5nZXRJbW1lZGlhdGUoe1xuICAgICAgICAgICAgaWRlbnRpZmllcjogblxuICAgICAgICB9KSwgaSA9IHIuZ2V0T3B0aW9ucyhuKTtcbiAgICAgICAgaWYgKGRlZXBFcXVhbChpLCB0KSkgcmV0dXJuIGU7XG4gICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LkZBSUxFRF9QUkVDT05ESVRJT04sIFwiaW5pdGlhbGl6ZUZpcmVzdG9yZSgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIHdpdGggZGlmZmVyZW50IG9wdGlvbnMuIFRvIGF2b2lkIHRoaXMgZXJyb3IsIGNhbGwgaW5pdGlhbGl6ZUZpcmVzdG9yZSgpIHdpdGggdGhlIHNhbWUgb3B0aW9ucyBhcyB3aGVuIGl0IHdhcyBvcmlnaW5hbGx5IGNhbGxlZCwgb3IgY2FsbCBnZXRGaXJlc3RvcmUoKSB0byByZXR1cm4gdGhlIGFscmVhZHkgaW5pdGlhbGl6ZWQgaW5zdGFuY2UuXCIpO1xuICAgIH1cbiAgICBpZiAodm9pZCAwICE9PSB0LmNhY2hlU2l6ZUJ5dGVzICYmIHZvaWQgMCAhPT0gdC5sb2NhbENhY2hlKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcImNhY2hlIGFuZCBjYWNoZVNpemVCeXRlcyBjYW5ub3QgYmUgc3BlY2lmaWVkIGF0IHRoZSBzYW1lIHRpbWUgYXMgY2FjaGVTaXplQnl0ZXMgd2lsbGJlIGRlcHJlY2F0ZWQuIEluc3RlYWQsIHNwZWNpZnkgdGhlIGNhY2hlIHNpemUgaW4gdGhlIGNhY2hlIG9iamVjdFwiKTtcbiAgICBpZiAodm9pZCAwICE9PSB0LmNhY2hlU2l6ZUJ5dGVzICYmIC0xICE9PSB0LmNhY2hlU2l6ZUJ5dGVzICYmIHQuY2FjaGVTaXplQnl0ZXMgPCAxMDQ4NTc2KSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcImNhY2hlU2l6ZUJ5dGVzIG11c3QgYmUgYXQgbGVhc3QgMTA0ODU3NlwiKTtcbiAgICByZXR1cm4gci5pbml0aWFsaXplKHtcbiAgICAgICAgb3B0aW9uczogdCxcbiAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBuXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldEZpcmVzdG9yZSh0LCBuKSB7XG4gICAgY29uc3QgciA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgPyB0IDogZ2V0QXBwKCksIGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gdCA6IG4gfHwgXCIoZGVmYXVsdClcIiwgcyA9IF9nZXRQcm92aWRlcihyLCBcImZpcmVzdG9yZVwiKS5nZXRJbW1lZGlhdGUoe1xuICAgICAgICBpZGVudGlmaWVyOiBpXG4gICAgfSk7XG4gICAgaWYgKCFzLl9pbml0aWFsaXplZCkge1xuICAgICAgICBjb25zdCBlID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0KFwiZmlyZXN0b3JlXCIpO1xuICAgICAgICBlICYmIGNvbm5lY3RGaXJlc3RvcmVFbXVsYXRvcihzLCAuLi5lKTtcbiAgICB9XG4gICAgcmV0dXJuIHM7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlKSB7XG4gICAgcmV0dXJuIGUuX2ZpcmVzdG9yZUNsaWVudCB8fCBfX1BSSVZBVEVfY29uZmlndXJlRmlyZXN0b3JlKGUpLCBlLl9maXJlc3RvcmVDbGllbnQudmVyaWZ5Tm90VGVybWluYXRlZCgpLCBcbiAgICBlLl9maXJlc3RvcmVDbGllbnQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb25maWd1cmVGaXJlc3RvcmUoZSkge1xuICAgIHZhciB0LCBuLCByO1xuICAgIGNvbnN0IGkgPSBlLl9mcmVlemVTZXR0aW5ncygpLCBzID0gZnVuY3Rpb24gX19QUklWQVRFX21ha2VEYXRhYmFzZUluZm8oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSW5mbyhlLCB0LCBuLCByLmhvc3QsIHIuc3NsLCByLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcsIHIuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nLCBfX1BSSVZBVEVfY2xvbmVMb25nUG9sbGluZ09wdGlvbnMoci5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMpLCByLnVzZUZldGNoU3RyZWFtcyk7XG4gICAgfShlLl9kYXRhYmFzZUlkLCAobnVsbCA9PT0gKHQgPSBlLl9hcHApIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQub3B0aW9ucy5hcHBJZCkgfHwgXCJcIiwgZS5fcGVyc2lzdGVuY2VLZXksIGkpO1xuICAgIGUuX2ZpcmVzdG9yZUNsaWVudCA9IG5ldyBGaXJlc3RvcmVDbGllbnQoZS5fYXV0aENyZWRlbnRpYWxzLCBlLl9hcHBDaGVja0NyZWRlbnRpYWxzLCBlLl9xdWV1ZSwgcyksIFxuICAgIChudWxsID09PSAobiA9IGkubG9jYWxDYWNoZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKSAmJiAobnVsbCA9PT0gKHIgPSBpLmxvY2FsQ2FjaGUpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyKSAmJiAoZS5fZmlyZXN0b3JlQ2xpZW50Ll91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyID0ge1xuICAgICAgICBfb2ZmbGluZUtpbmQ6IGkubG9jYWxDYWNoZS5raW5kLFxuICAgICAgICBfb2ZmbGluZTogaS5sb2NhbENhY2hlLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIsXG4gICAgICAgIF9vbmxpbmU6IGkubG9jYWxDYWNoZS5fb25saW5lQ29tcG9uZW50UHJvdmlkZXJcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS5cbiAqXG4gKiBNdXN0IGJlIGNhbGxlZCBiZWZvcmUgYW55IG90aGVyIGZ1bmN0aW9ucyAob3RoZXIgdGhhblxuICoge0BsaW5rIGluaXRpYWxpemVGaXJlc3RvcmV9LCB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0gb3JcbiAqIHtAbGluayBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlfS5cbiAqXG4gKiBJZiB0aGlzIGZhaWxzLCBgZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2UgaXRcbiAqIHJldHVybnMuIE5vdGUgdGhhdCBldmVuIGFmdGVyIHRoaXMgZmFpbHVyZSwgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIHJlbWFpbiB1c2FibGUsIGhvd2V2ZXIgb2ZmbGluZSBwZXJzaXN0ZW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICpcbiAqIFRoZXJlIGFyZSBzZXZlcmFsIHJlYXNvbnMgd2h5IHRoaXMgY2FuIGZhaWwsIHdoaWNoIGNhbiBiZSBpZGVudGlmaWVkIGJ5XG4gKiB0aGUgYGNvZGVgIG9uIHRoZSBlcnJvci5cbiAqXG4gKiAgICogZmFpbGVkLXByZWNvbmRpdGlvbjogVGhlIGFwcCBpcyBhbHJlYWR5IG9wZW4gaW4gYW5vdGhlciBicm93c2VyIHRhYi5cbiAqICAgKiB1bmltcGxlbWVudGVkOiBUaGUgYnJvd3NlciBpcyBpbmNvbXBhdGlibGUgd2l0aCB0aGUgb2ZmbGluZVxuICogICAgIHBlcnNpc3RlbmNlIGltcGxlbWVudGF0aW9uLlxuICpcbiAqIFBlcnNpc3RlbmNlIGNhbm5vdCBiZSB1c2VkIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGVuYWJsZSBwZXJzaXN0ZW5jZSBmb3IuXG4gKiBAcGFyYW0gcGVyc2lzdGVuY2VTZXR0aW5ncyAtIE9wdGlvbmFsIHNldHRpbmdzIG9iamVjdCB0byBjb25maWd1cmVcbiAqIHBlcnNpc3RlbmNlLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCByZXByZXNlbnRzIHN1Y2Nlc3NmdWxseSBlbmFibGluZyBwZXJzaXN0ZW50IHN0b3JhZ2UuXG4gKiBAZGVwcmVjYXRlZCBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSBtYWpvciByZWxlYXNlLiBJbnN0ZWFkLCBzZXRcbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5sb2NhbENhY2hlYCB0byBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudExvY2FsQ2FjaGVgIHRvXG4gKiB0dXJuIG9uIEluZGV4ZWREYiBjYWNoZS4gQ2FsbGluZyB0aGlzIGZ1bmN0aW9uIHdoZW4gYEZpcmVzdG9yZVNldHRpbmdzLmxvY2FsQ2FjaGVgXG4gKiBpcyBhbHJlYWR5IHNwZWNpZmllZCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi5cbiAqLyBmdW5jdGlvbiBlbmFibGVJbmRleGVkRGJQZXJzaXN0ZW5jZShlLCB0KSB7XG4gICAgX19QUklWQVRFX3ZlcmlmeU5vdEluaXRpYWxpemVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKTtcbiAgICBjb25zdCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlKTtcbiAgICBpZiAobi5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlcikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJTREsgY2FjaGUgaXMgYWxyZWFkeSBzcGVjaWZpZWQuXCIpO1xuICAgIF9fUFJJVkFURV9sb2dXYXJuKFwiZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKSB3aWxsIGJlIGRlcHJlY2F0ZWQgaW4gdGhlIGZ1dHVyZSwgeW91IGNhbiB1c2UgYEZpcmVzdG9yZVNldHRpbmdzLmNhY2hlYCBpbnN0ZWFkLlwiKTtcbiAgICBjb25zdCByID0gZS5fZnJlZXplU2V0dGluZ3MoKSwgaSA9IG5ldyBPbmxpbmVDb21wb25lbnRQcm92aWRlcjtcbiAgICByZXR1cm4gX19QUklWQVRFX3NldFBlcnNpc3RlbmNlUHJvdmlkZXJzKG4sIGksIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGksIHIuY2FjaGVTaXplQnl0ZXMsIG51bGwgPT0gdCA/IHZvaWQgMCA6IHQuZm9yY2VPd25lcnNoaXApKTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgbXVsdGktdGFiIHBlcnNpc3RlbnQgc3RvcmFnZSwgaWYgcG9zc2libGUuIElmIGVuYWJsZWRcbiAqIGFjcm9zcyBhbGwgdGFicywgYWxsIG9wZXJhdGlvbnMgc2hhcmUgYWNjZXNzIHRvIGxvY2FsIHBlcnNpc3RlbmNlLCBpbmNsdWRpbmdcbiAqIHNoYXJlZCBleGVjdXRpb24gb2YgcXVlcmllcyBhbmQgbGF0ZW5jeS1jb21wZW5zYXRlZCBsb2NhbCBkb2N1bWVudCB1cGRhdGVzXG4gKiBhY3Jvc3MgYWxsIGNvbm5lY3RlZCBpbnN0YW5jZXMuXG4gKlxuICogSWYgdGhpcyBmYWlscywgYGVuYWJsZU11bHRpVGFiSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2VcbiAqIGl0IHJldHVybnMuIE5vdGUgdGhhdCBldmVuIGFmdGVyIHRoaXMgZmFpbHVyZSwgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIHJlbWFpbiB1c2FibGUsIGhvd2V2ZXIgb2ZmbGluZSBwZXJzaXN0ZW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICpcbiAqIFRoZXJlIGFyZSBzZXZlcmFsIHJlYXNvbnMgd2h5IHRoaXMgY2FuIGZhaWwsIHdoaWNoIGNhbiBiZSBpZGVudGlmaWVkIGJ5XG4gKiB0aGUgYGNvZGVgIG9uIHRoZSBlcnJvci5cbiAqXG4gKiAgICogZmFpbGVkLXByZWNvbmRpdGlvbjogVGhlIGFwcCBpcyBhbHJlYWR5IG9wZW4gaW4gYW5vdGhlciBicm93c2VyIHRhYiBhbmRcbiAqICAgICBtdWx0aS10YWIgaXMgbm90IGVuYWJsZWQuXG4gKiAgICogdW5pbXBsZW1lbnRlZDogVGhlIGJyb3dzZXIgaXMgaW5jb21wYXRpYmxlIHdpdGggdGhlIG9mZmxpbmVcbiAqICAgICBwZXJzaXN0ZW5jZSBpbXBsZW1lbnRhdGlvbi5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGVuYWJsZSBwZXJzaXN0ZW5jZSBmb3IuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlcHJlc2VudHMgc3VjY2Vzc2Z1bGx5IGVuYWJsaW5nIHBlcnNpc3RlbnRcbiAqIHN0b3JhZ2UuXG4gKiBAZGVwcmVjYXRlZCBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSBtYWpvciByZWxlYXNlLiBJbnN0ZWFkLCBzZXRcbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5sb2NhbENhY2hlYCB0byBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudExvY2FsQ2FjaGVgIHRvXG4gKiB0dXJuIG9uIGluZGV4ZWRkYiBjYWNoZS4gQ2FsbGluZyB0aGlzIGZ1bmN0aW9uIHdoZW4gYEZpcmVzdG9yZVNldHRpbmdzLmxvY2FsQ2FjaGVgXG4gKiBpcyBhbHJlYWR5IHNwZWNpZmllZCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi5cbiAqLyBmdW5jdGlvbiBlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlKGUpIHtcbiAgICBfX1BSSVZBVEVfdmVyaWZ5Tm90SW5pdGlhbGl6ZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpO1xuICAgIGNvbnN0IHQgPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUpO1xuICAgIGlmICh0Ll91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlNESyBjYWNoZSBpcyBhbHJlYWR5IHNwZWNpZmllZC5cIik7XG4gICAgX19QUklWQVRFX2xvZ1dhcm4oXCJlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlKCkgd2lsbCBiZSBkZXByZWNhdGVkIGluIHRoZSBmdXR1cmUsIHlvdSBjYW4gdXNlIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgaW5zdGVhZC5cIik7XG4gICAgY29uc3QgbiA9IGUuX2ZyZWV6ZVNldHRpbmdzKCksIHIgPSBuZXcgT25saW5lQ29tcG9uZW50UHJvdmlkZXI7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9zZXRQZXJzaXN0ZW5jZVByb3ZpZGVycyh0LCByLCBuZXcgX19QUklWQVRFX011bHRpVGFiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHIsIG4uY2FjaGVTaXplQnl0ZXMpKTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYm90aCB0aGUgYE9mZmxpbmVDb21wb25lbnRQcm92aWRlcmAgYW5kIGBPbmxpbmVDb21wb25lbnRQcm92aWRlcmAuXG4gKiBJZiB0aGUgb3BlcmF0aW9uIGZhaWxzIHdpdGggYSByZWNvdmVyYWJsZSBlcnJvciAoc2VlXG4gKiBgY2FuUmVjb3ZlckZyb21JbmRleGVkRGJFcnJvcigpYCBiZWxvdyksIHRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlamVjdGVkXG4gKiBidXQgdGhlIGNsaWVudCByZW1haW5zIHVzYWJsZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0UGVyc2lzdGVuY2VQcm92aWRlcnMoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX3NldE9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBuKSwgYXdhaXQgX19QUklWQVRFX3NldE9ubGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIHQpLCBcbiAgICAgICAgICAgIHIucmVzb2x2ZSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZTtcbiAgICAgICAgICAgIGlmICghX19QUklWQVRFX2NhbkZhbGxiYWNrRnJvbUluZGV4ZWREYkVycm9yKHQpKSB0aHJvdyB0O1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ1dhcm4oXCJFcnJvciBlbmFibGluZyBpbmRleGVkZGIgY2FjaGUuIEZhbGxpbmcgYmFjayB0byBtZW1vcnkgY2FjaGU6IFwiICsgdCksIFxuICAgICAgICAgICAgci5yZWplY3QodCk7XG4gICAgICAgIH1cbiAgICB9KSkudGhlbigoKCkgPT4gci5wcm9taXNlKSk7XG59XG5cbi8qKlxuICogQ2xlYXJzIHRoZSBwZXJzaXN0ZW50IHN0b3JhZ2UuIFRoaXMgaW5jbHVkZXMgcGVuZGluZyB3cml0ZXMgYW5kIGNhY2hlZFxuICogZG9jdW1lbnRzLlxuICpcbiAqIE11c3QgYmUgY2FsbGVkIHdoaWxlIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBpcyBub3Qgc3RhcnRlZCAoYWZ0ZXIgdGhlIGFwcCBpc1xuICogdGVybWluYXRlZCBvciB3aGVuIHRoZSBhcHAgaXMgZmlyc3QgaW5pdGlhbGl6ZWQpLiBPbiBzdGFydHVwLCB0aGlzIGZ1bmN0aW9uXG4gKiBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgb3RoZXIgZnVuY3Rpb25zIChvdGhlciB0aGFuIHtAbGlua1xuICogaW5pdGlhbGl6ZUZpcmVzdG9yZX0gb3Ige0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9KSkuIElmIHRoZSB7QGxpbmsgRmlyZXN0b3JlfVxuICogaW5zdGFuY2UgaXMgc3RpbGwgcnVubmluZywgdGhlIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCB3aXRoIHRoZSBlcnJvciBjb2RlXG4gKiBvZiBgZmFpbGVkLXByZWNvbmRpdGlvbmAuXG4gKlxuICogTm90ZTogYGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgaXMgcHJpbWFyaWx5IGludGVuZGVkIHRvIGhlbHAgd3JpdGVcbiAqIHJlbGlhYmxlIHRlc3RzIHRoYXQgdXNlIENsb3VkIEZpcmVzdG9yZS4gSXQgdXNlcyBhbiBlZmZpY2llbnQgbWVjaGFuaXNtIGZvclxuICogZHJvcHBpbmcgZXhpc3RpbmcgZGF0YSBidXQgZG9lcyBub3QgYXR0ZW1wdCB0byBzZWN1cmVseSBvdmVyd3JpdGUgb3JcbiAqIG90aGVyd2lzZSBtYWtlIGNhY2hlZCBkYXRhIHVucmVjb3ZlcmFibGUuIEZvciBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgc2Vuc2l0aXZlXG4gKiB0byB0aGUgZGlzY2xvc3VyZSBvZiBjYWNoZWQgZGF0YSBpbiBiZXR3ZWVuIHVzZXIgc2Vzc2lvbnMsIHdlIHN0cm9uZ2x5XG4gKiByZWNvbW1lbmQgbm90IGVuYWJsaW5nIHBlcnNpc3RlbmNlIGF0IGFsbC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGNsZWFyIHBlcnNpc3RlbmNlIGZvci5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgcGVyc2lzdGVudCBzdG9yYWdlIGlzXG4gKiBjbGVhcmVkLiBPdGhlcndpc2UsIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkIHdpdGggYW4gZXJyb3IuXG4gKi8gZnVuY3Rpb24gY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZShlKSB7XG4gICAgaWYgKGUuX2luaXRpYWxpemVkICYmICFlLl90ZXJtaW5hdGVkKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlBlcnNpc3RlbmNlIGNhbiBvbmx5IGJlIGNsZWFyZWQgYmVmb3JlIGEgRmlyZXN0b3JlIGluc3RhbmNlIGlzIGluaXRpYWxpemVkIG9yIGFmdGVyIGl0IGlzIHRlcm1pbmF0ZWQuXCIpO1xuICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLl9xdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2luZGV4ZWREYkNsZWFyUGVyc2lzdGVuY2UoZSkge1xuICAgICAgICAgICAgICAgIGlmICghX19QUklWQVRFX1NpbXBsZURiLnYoKSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlICsgXCJtYWluXCI7XG4gICAgICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX1NpbXBsZURiLmRlbGV0ZSh0KTtcbiAgICAgICAgICAgIH0oX19QUklWQVRFX2luZGV4ZWREYlN0b3JhZ2VQcmVmaXgoZS5fZGF0YWJhc2VJZCwgZS5fcGVyc2lzdGVuY2VLZXkpKSwgdC5yZXNvbHZlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHQucmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfSkpLCB0LnByb21pc2U7XG59XG5cbi8qKlxuICogV2FpdHMgdW50aWwgYWxsIGN1cnJlbnRseSBwZW5kaW5nIHdyaXRlcyBmb3IgdGhlIGFjdGl2ZSB1c2VyIGhhdmUgYmVlblxuICogYWNrbm93bGVkZ2VkIGJ5IHRoZSBiYWNrZW5kLlxuICpcbiAqIFRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzIGltbWVkaWF0ZWx5IGlmIHRoZXJlIGFyZSBubyBvdXRzdGFuZGluZyB3cml0ZXMuXG4gKiBPdGhlcndpc2UsIHRoZSBwcm9taXNlIHdhaXRzIGZvciBhbGwgcHJldmlvdXNseSBpc3N1ZWQgd3JpdGVzIChpbmNsdWRpbmdcbiAqIHRob3NlIHdyaXR0ZW4gaW4gYSBwcmV2aW91cyBhcHAgc2Vzc2lvbiksIGJ1dCBpdCBkb2VzIG5vdCB3YWl0IGZvciB3cml0ZXNcbiAqIHRoYXQgd2VyZSBhZGRlZCBhZnRlciB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkLiBJZiB5b3Ugd2FudCB0byB3YWl0IGZvclxuICogYWRkaXRpb25hbCB3cml0ZXMsIGNhbGwgYHdhaXRGb3JQZW5kaW5nV3JpdGVzKClgIGFnYWluLlxuICpcbiAqIEFueSBvdXRzdGFuZGluZyBgd2FpdEZvclBlbmRpbmdXcml0ZXMoKWAgcHJvbWlzZXMgYXJlIHJlamVjdGVkIGR1cmluZyB1c2VyXG4gKiBjaGFuZ2VzLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHdoaWNoIHJlc29sdmVzIHdoZW4gYWxsIGN1cnJlbnRseSBwZW5kaW5nIHdyaXRlcyBoYXZlIGJlZW5cbiAqIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZC5cbiAqLyBmdW5jdGlvbiB3YWl0Rm9yUGVuZGluZ1dyaXRlcyhlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRXYWl0Rm9yUGVuZGluZ1dyaXRlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IF9fUFJJVkFURV9zeW5jRW5naW5lUmVnaXN0ZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2soYXdhaXQgX19QUklWQVRFX2dldFN5bmNFbmdpbmUoZSksIHQpKSksIFxuICAgICAgICB0LnByb21pc2U7XG4gICAgfShlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSk7XG59XG5cbi8qKlxuICogUmUtZW5hYmxlcyB1c2Ugb2YgdGhlIG5ldHdvcmsgZm9yIHRoaXMge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgYWZ0ZXIgYSBwcmlvclxuICogY2FsbCB0byB7QGxpbmsgZGlzYWJsZU5ldHdvcmt9LlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgb25jZSB0aGUgbmV0d29yayBoYXMgYmVlbiBlbmFibGVkLlxuICovIGZ1bmN0aW9uIGVuYWJsZU5ldHdvcmsoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RW5hYmxlTmV0d29yayhlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSk7XG59XG5cbi8qKlxuICogRGlzYWJsZXMgbmV0d29yayB1c2FnZSBmb3IgdGhpcyBpbnN0YW5jZS4gSXQgY2FuIGJlIHJlLWVuYWJsZWQgdmlhIHtAbGlua1xuICogZW5hYmxlTmV0d29ya30uIFdoaWxlIHRoZSBuZXR3b3JrIGlzIGRpc2FibGVkLCBhbnkgc25hcHNob3QgbGlzdGVuZXJzLFxuICogYGdldERvYygpYCBvciBgZ2V0RG9jcygpYCBjYWxscyB3aWxsIHJldHVybiByZXN1bHRzIGZyb20gY2FjaGUsIGFuZCBhbnkgd3JpdGVcbiAqIG9wZXJhdGlvbnMgd2lsbCBiZSBxdWV1ZWQgdW50aWwgdGhlIG5ldHdvcmsgaXMgcmVzdG9yZWQuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCBvbmNlIHRoZSBuZXR3b3JrIGhhcyBiZWVuIGRpc2FibGVkLlxuICovIGZ1bmN0aW9uIGRpc2FibGVOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudERpc2FibGVOZXR3b3JrKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpKTtcbn1cblxuLyoqXG4gKiBUZXJtaW5hdGVzIHRoZSBwcm92aWRlZCB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZS5cbiAqXG4gKiBBZnRlciBjYWxsaW5nIGB0ZXJtaW5hdGUoKWAgb25seSB0aGUgYGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgZnVuY3Rpb25cbiAqIG1heSBiZSB1c2VkLiBBbnkgb3RoZXIgZnVuY3Rpb24gd2lsbCB0aHJvdyBhIGBGaXJlc3RvcmVFcnJvcmAuXG4gKlxuICogVG8gcmVzdGFydCBhZnRlciB0ZXJtaW5hdGlvbiwgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIEZpcmViYXNlRmlyZXN0b3JlIHdpdGhcbiAqIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfS5cbiAqXG4gKiBUZXJtaW5hdGlvbiBkb2VzIG5vdCBjYW5jZWwgYW55IHBlbmRpbmcgd3JpdGVzLCBhbmQgYW55IHByb21pc2VzIHRoYXQgYXJlXG4gKiBhd2FpdGluZyBhIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciB3aWxsIG5vdCBiZSByZXNvbHZlZC4gSWYgeW91IGhhdmVcbiAqIHBlcnNpc3RlbmNlIGVuYWJsZWQsIHRoZSBuZXh0IHRpbWUgeW91IHN0YXJ0IHRoaXMgaW5zdGFuY2UsIGl0IHdpbGwgcmVzdW1lXG4gKiBzZW5kaW5nIHRoZXNlIHdyaXRlcyB0byB0aGUgc2VydmVyLlxuICpcbiAqIE5vdGU6IFVuZGVyIG5vcm1hbCBjaXJjdW1zdGFuY2VzLCBjYWxsaW5nIGB0ZXJtaW5hdGUoKWAgaXMgbm90IHJlcXVpcmVkLiBUaGlzXG4gKiBmdW5jdGlvbiBpcyB1c2VmdWwgb25seSB3aGVuIHlvdSB3YW50IHRvIGZvcmNlIHRoaXMgaW5zdGFuY2UgdG8gcmVsZWFzZSBhbGxcbiAqIG9mIGl0cyByZXNvdXJjZXMgb3IgaW4gY29tYmluYXRpb24gd2l0aCBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB0b1xuICogZW5zdXJlIHRoYXQgYWxsIGxvY2FsIHN0YXRlIGlzIGRlc3Ryb3llZCBiZXR3ZWVuIHRlc3QgcnVucy5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIHdoZW4gdGhlIGluc3RhbmNlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseVxuICogdGVybWluYXRlZC5cbiAqLyBmdW5jdGlvbiB0ZXJtaW5hdGUoZSkge1xuICAgIHJldHVybiBfcmVtb3ZlU2VydmljZUluc3RhbmNlKGUuYXBwLCBcImZpcmVzdG9yZVwiLCBlLl9kYXRhYmFzZUlkLmRhdGFiYXNlKSwgZS5fZGVsZXRlKCk7XG59XG5cbi8qKlxuICogTG9hZHMgYSBGaXJlc3RvcmUgYnVuZGxlIGludG8gdGhlIGxvY2FsIGNhY2hlLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gbG9hZCBidW5kbGVzIGZvci5cbiAqIEBwYXJhbSBidW5kbGVEYXRhIC0gQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYnVuZGxlIHRvIGJlIGxvYWRlZC4gVmFsaWRcbiAqIG9iamVjdHMgYXJlIGBBcnJheUJ1ZmZlcmAsIGBSZWFkYWJsZVN0cmVhbTxVaW50OEFycmF5PmAgb3IgYHN0cmluZ2AuXG4gKlxuICogQHJldHVybnMgQSBgTG9hZEJ1bmRsZVRhc2tgIG9iamVjdCwgd2hpY2ggbm90aWZpZXMgY2FsbGVycyB3aXRoIHByb2dyZXNzXG4gKiB1cGRhdGVzLCBhbmQgY29tcGxldGlvbiBvciBlcnJvciBldmVudHMuIEl0IGNhbiBiZSB1c2VkIGFzIGFcbiAqIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+YC5cbiAqLyBmdW5jdGlvbiBsb2FkQnVuZGxlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSksIHIgPSBuZXcgTG9hZEJ1bmRsZVRhc2s7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRMb2FkQnVuZGxlKG4sIGUuX2RhdGFiYXNlSWQsIHQsIHIpLCByO1xufVxuXG4vKipcbiAqIFJlYWRzIGEgRmlyZXN0b3JlIHtAbGluayBRdWVyeX0gZnJvbSBsb2NhbCBjYWNoZSwgaWRlbnRpZmllZCBieSB0aGUgZ2l2ZW5cbiAqIG5hbWUuXG4gKlxuICogVGhlIG5hbWVkIHF1ZXJpZXMgYXJlIHBhY2thZ2VkICBpbnRvIGJ1bmRsZXMgb24gdGhlIHNlcnZlciBzaWRlIChhbG9uZ1xuICogd2l0aCByZXN1bHRpbmcgZG9jdW1lbnRzKSwgYW5kIGxvYWRlZCB0byBsb2NhbCBjYWNoZSB1c2luZyBgbG9hZEJ1bmRsZWAuIE9uY2VcbiAqIGluIGxvY2FsIGNhY2hlLCB1c2UgdGhpcyBtZXRob2QgdG8gZXh0cmFjdCBhIHtAbGluayBRdWVyeX0gYnkgbmFtZS5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIHJlYWQgdGhlIHF1ZXJ5IGZyb20uXG4gKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBxdWVyeS5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2l0aCB0aGUgUXVlcnkgb3IgYG51bGxgLlxuICovIGZ1bmN0aW9uIG5hbWVkUXVlcnkoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0TmFtZWRRdWVyeShlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSwgdCkudGhlbigodCA9PiB0ID8gbmV3IFF1ZXJ5KGUsIG51bGwsIHQucXVlcnkpIDogbnVsbCkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdmVyaWZ5Tm90SW5pdGlhbGl6ZWQoZSkge1xuICAgIGlmIChlLl9pbml0aWFsaXplZCB8fCBlLl90ZXJtaW5hdGVkKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkZpcmVzdG9yZSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQgYW5kIHBlcnNpc3RlbmNlIGNhbiBubyBsb25nZXIgYmUgZW5hYmxlZC4gWW91IGNhbiBvbmx5IGVuYWJsZSBwZXJzaXN0ZW5jZSBiZWZvcmUgY2FsbGluZyBhbnkgb3RoZXIgbWV0aG9kcyBvbiBhIEZpcmVzdG9yZSBvYmplY3QuXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhbiBhZ2dyZWdhdGlvbiB0aGF0IGNhbiBiZSBwZXJmb3JtZWQgYnkgRmlyZXN0b3JlLlxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG5jbGFzcyBBZ2dyZWdhdGVGaWVsZCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IEFnZ3JlZ2F0ZUZpZWxkPFQ+XG4gICAgICogQHBhcmFtIF9hZ2dyZWdhdGVUeXBlIFNwZWNpZmllcyB0aGUgdHlwZSBvZiBhZ2dyZWdhdGlvbiBvcGVyYXRpb24gdG8gcGVyZm9ybS5cbiAgICAgKiBAcGFyYW0gX2ludGVybmFsRmllbGRQYXRoIE9wdGlvbmFsbHkgc3BlY2lmaWVzIHRoZSBmaWVsZCB0aGF0IGlzIGFnZ3JlZ2F0ZWQuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLy8gVE9ETyAoc3VtL2F2ZykgbWFrZSBhZ2dyZWdhdGVUeXBlIHB1YmxpYyB3aGVuIHRoZSBmZWF0dXJlIGlzIHN1cHBvcnRlZFxuICAgIGUgPSBcImNvdW50XCIsIHQpIHtcbiAgICAgICAgdGhpcy5fYWdncmVnYXRlVHlwZSA9IGUsIHRoaXMuX2ludGVybmFsRmllbGRQYXRoID0gdCwgXG4gICAgICAgIC8qKiBBIHR5cGUgc3RyaW5nIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcIkFnZ3JlZ2F0ZUZpZWxkXCI7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSByZXN1bHRzIG9mIGV4ZWN1dGluZyBhbiBhZ2dyZWdhdGlvbiBxdWVyeS5cbiAqLyBjbGFzcyBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90IHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5fdXNlckRhdGFXcml0ZXIgPSB0LCB0aGlzLl9kYXRhID0gbiwgXG4gICAgICAgIC8qKiBBIHR5cGUgc3RyaW5nIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcIkFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RcIiwgdGhpcy5xdWVyeSA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHJlc3VsdHMgb2YgdGhlIGFnZ3JlZ2F0aW9ucyBwZXJmb3JtZWQgb3ZlciB0aGUgdW5kZXJseWluZ1xuICAgICAqIHF1ZXJ5LlxuICAgICAqXG4gICAgICogVGhlIGtleXMgb2YgdGhlIHJldHVybmVkIG9iamVjdCB3aWxsIGJlIHRoZSBzYW1lIGFzIHRob3NlIG9mIHRoZVxuICAgICAqIGBBZ2dyZWdhdGVTcGVjYCBvYmplY3Qgc3BlY2lmaWVkIHRvIHRoZSBhZ2dyZWdhdGlvbiBtZXRob2QsIGFuZCB0aGUgdmFsdWVzXG4gICAgICogd2lsbCBiZSB0aGUgY29ycmVzcG9uZGluZyBhZ2dyZWdhdGlvbiByZXN1bHQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgcmVzdWx0cyBvZiB0aGUgYWdncmVnYXRpb25zIHBlcmZvcm1lZCBvdmVyIHRoZSB1bmRlcmx5aW5nXG4gICAgICogcXVlcnkuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0T2JqZWN0TWFwKHRoaXMuX2RhdGEpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIG9iamVjdCByZXByZXNlbnRpbmcgYW4gYXJyYXkgb2YgYnl0ZXMuXG4gKi8gY2xhc3MgQnl0ZXMge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLl9ieXRlU3RyaW5nID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBgQnl0ZXNgIG9iamVjdCBmcm9tIHRoZSBnaXZlbiBCYXNlNjQgc3RyaW5nLCBjb252ZXJ0aW5nIGl0IHRvXG4gICAgICogYnl0ZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmFzZTY0IC0gVGhlIEJhc2U2NCBzdHJpbmcgdXNlZCB0byBjcmVhdGUgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICBzdGF0aWMgZnJvbUJhc2U2NFN0cmluZyhlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGVzKEJ5dGVTdHJpbmcuZnJvbUJhc2U2NFN0cmluZyhlKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiRmFpbGVkIHRvIGNvbnN0cnVjdCBkYXRhIGZyb20gQmFzZTY0IHN0cmluZzogXCIgKyBlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGBCeXRlc2Agb2JqZWN0IGZyb20gdGhlIGdpdmVuIFVpbnQ4QXJyYXkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXJyYXkgLSBUaGUgVWludDhBcnJheSB1c2VkIHRvIGNyZWF0ZSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHN0YXRpYyBmcm9tVWludDhBcnJheShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZXMoQnl0ZVN0cmluZy5mcm9tVWludDhBcnJheShlKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHVuZGVybHlpbmcgYnl0ZXMgYXMgYSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgQmFzZTY0LWVuY29kZWQgc3RyaW5nIGNyZWF0ZWQgZnJvbSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvQmFzZTY0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZVN0cmluZy50b0Jhc2U2NCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB1bmRlcmx5aW5nIGJ5dGVzIGluIGEgbmV3IGBVaW50OEFycmF5YC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBVaW50OEFycmF5IGNyZWF0ZWQgZnJvbSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvVWludDhBcnJheSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVTdHJpbmcudG9VaW50OEFycmF5KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiQnl0ZXMoYmFzZTY0OiBcIiArIHRoaXMudG9CYXNlNjQoKSArIFwiKVwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgQnl0ZXNgIG9iamVjdCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBCeXRlc2Agb2JqZWN0IHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEJ5dGVzYCBvYmplY3QgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ieXRlU3RyaW5nLmlzRXF1YWwoZS5fYnl0ZVN0cmluZyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBGaWVsZFBhdGhgIHJlZmVycyB0byBhIGZpZWxkIGluIGEgZG9jdW1lbnQuIFRoZSBwYXRoIG1heSBjb25zaXN0IG9mIGFcbiAqIHNpbmdsZSBmaWVsZCBuYW1lIChyZWZlcnJpbmcgdG8gYSB0b3AtbGV2ZWwgZmllbGQgaW4gdGhlIGRvY3VtZW50KSwgb3IgYVxuICogbGlzdCBvZiBmaWVsZCBuYW1lcyAocmVmZXJyaW5nIHRvIGEgbmVzdGVkIGZpZWxkIGluIHRoZSBkb2N1bWVudCkuXG4gKlxuICogQ3JlYXRlIGEgYEZpZWxkUGF0aGAgYnkgcHJvdmlkaW5nIGZpZWxkIG5hbWVzLiBJZiBtb3JlIHRoYW4gb25lIGZpZWxkXG4gKiBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgcGF0aCB3aWxsIHBvaW50IHRvIGEgbmVzdGVkIGZpZWxkIGluIGEgZG9jdW1lbnQuXG4gKi8gY2xhc3MgRmllbGRQYXRoIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgYEZpZWxkUGF0aGAgZnJvbSB0aGUgcHJvdmlkZWQgZmllbGQgbmFtZXMuIElmIG1vcmUgdGhhbiBvbmUgZmllbGRcbiAgICAgKiBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgcGF0aCB3aWxsIHBvaW50IHRvIGEgbmVzdGVkIGZpZWxkIGluIGEgZG9jdW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmllbGROYW1lcyAtIEEgbGlzdCBvZiBmaWVsZCBuYW1lcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciguLi5lKSB7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgZS5sZW5ndGg7ICsrdCkgaWYgKDAgPT09IGVbdF0ubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWQgZmllbGQgbmFtZSBhdCBhcmd1bWVudCAkKGkgKyAxKS4gRmllbGQgbmFtZXMgbXVzdCBub3QgYmUgZW1wdHkuXCIpO1xuICAgICAgICB0aGlzLl9pbnRlcm5hbFBhdGggPSBuZXcgRmllbGRQYXRoJDEoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBGaWVsZFBhdGhgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYEZpZWxkUGF0aGAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgRmllbGRQYXRoYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ludGVybmFsUGF0aC5pc0VxdWFsKGUuX2ludGVybmFsUGF0aCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHNlbnRpbmVsIGBGaWVsZFBhdGhgIHRvIHJlZmVyIHRvIHRoZSBJRCBvZiBhIGRvY3VtZW50LlxuICogSXQgY2FuIGJlIHVzZWQgaW4gcXVlcmllcyB0byBzb3J0IG9yIGZpbHRlciBieSB0aGUgZG9jdW1lbnQgSUQuXG4gKi8gZnVuY3Rpb24gZG9jdW1lbnRJZCgpIHtcbiAgICByZXR1cm4gbmV3IEZpZWxkUGF0aChcIl9fbmFtZV9fXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTZW50aW5lbCB2YWx1ZXMgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIHdyaXRpbmcgZG9jdW1lbnQgZmllbGRzIHdpdGggYHNldCgpYFxuICogb3IgYHVwZGF0ZSgpYC5cbiAqLyBjbGFzcyBGaWVsZFZhbHVlIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gX21ldGhvZE5hbWUgLSBUaGUgcHVibGljIEFQSSBlbmRwb2ludCB0aGF0IHJldHVybnMgdGhpcyBjbGFzcy5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLl9tZXRob2ROYW1lID0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgZ2VvZ3JhcGhpYyBsb2NhdGlvbiBpbiBGaXJlc3RvcmUuIFRoZVxuICogbG9jYXRpb24gaXMgcmVwcmVzZW50ZWQgYXMgbGF0aXR1ZGUvbG9uZ2l0dWRlIHBhaXIuXG4gKlxuICogTGF0aXR1ZGUgdmFsdWVzIGFyZSBpbiB0aGUgcmFuZ2Ugb2YgWy05MCwgOTBdLlxuICogTG9uZ2l0dWRlIHZhbHVlcyBhcmUgaW4gdGhlIHJhbmdlIG9mIFstMTgwLCAxODBdLlxuICovIGNsYXNzIEdlb1BvaW50IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGltbXV0YWJsZSBgR2VvUG9pbnRgIG9iamVjdCB3aXRoIHRoZSBwcm92aWRlZCBsYXRpdHVkZSBhbmRcbiAgICAgKiBsb25naXR1ZGUgdmFsdWVzLlxuICAgICAqIEBwYXJhbSBsYXRpdHVkZSAtIFRoZSBsYXRpdHVkZSBhcyBudW1iZXIgYmV0d2VlbiAtOTAgYW5kIDkwLlxuICAgICAqIEBwYXJhbSBsb25naXR1ZGUgLSBUaGUgbG9uZ2l0dWRlIGFzIG51bWJlciBiZXR3ZWVuIC0xODAgYW5kIDE4MC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIGlmICghaXNGaW5pdGUoZSkgfHwgZSA8IC05MCB8fCBlID4gOTApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiTGF0aXR1ZGUgbXVzdCBiZSBhIG51bWJlciBiZXR3ZWVuIC05MCBhbmQgOTAsIGJ1dCB3YXM6IFwiICsgZSk7XG4gICAgICAgIGlmICghaXNGaW5pdGUodCkgfHwgdCA8IC0xODAgfHwgdCA+IDE4MCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJMb25naXR1ZGUgbXVzdCBiZSBhIG51bWJlciBiZXR3ZWVuIC0xODAgYW5kIDE4MCwgYnV0IHdhczogXCIgKyB0KTtcbiAgICAgICAgdGhpcy5fbGF0ID0gZSwgdGhpcy5fbG9uZyA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBsYXRpdHVkZSBvZiB0aGlzIGBHZW9Qb2ludGAgaW5zdGFuY2UuXG4gICAgICovICAgIGdldCBsYXRpdHVkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGxvbmdpdHVkZSBvZiB0aGlzIGBHZW9Qb2ludGAgaW5zdGFuY2UuXG4gICAgICovICAgIGdldCBsb25naXR1ZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb25nO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgR2VvUG9pbnRgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYEdlb1BvaW50YCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBHZW9Qb2ludGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sYXQgPT09IGUuX2xhdCAmJiB0aGlzLl9sb25nID09PSBlLl9sb25nO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgR2VvUG9pbnQuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxhdGl0dWRlOiB0aGlzLl9sYXQsXG4gICAgICAgICAgICBsb25naXR1ZGU6IHRoaXMuX2xvbmdcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWN0dWFsbHkgcHJpdmF0ZSB0byBKUyBjb25zdW1lcnMgb2Ygb3VyIEFQSSwgc28gdGhpcyBmdW5jdGlvbiBpcyBwcmVmaXhlZFxuICAgICAqIHdpdGggYW4gdW5kZXJzY29yZS5cbiAgICAgKi8gICAgX2NvbXBhcmVUbyhlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLl9sYXQsIGUuX2xhdCkgfHwgX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IodGhpcy5fbG9uZywgZS5fbG9uZyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBwZSA9IC9eX18uKl9fJC87XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHBhcnNpbmcgZG9jdW1lbnQgZGF0YSAoZS5nLiBmb3IgYSBzZXREYXRhIGNhbGwpLiAqLyBjbGFzcyBQYXJzZWRTZXREYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGUsIHRoaXMuZmllbGRNYXNrID0gdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBuO1xuICAgIH1cbiAgICB0b011dGF0aW9uKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuZmllbGRNYXNrID8gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUsIHRoaXMuZGF0YSwgdGhpcy5maWVsZE1hc2ssIHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zKSA6IG5ldyBfX1BSSVZBVEVfU2V0TXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0LCB0aGlzLmZpZWxkVHJhbnNmb3Jtcyk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBwYXJzaW5nIFwidXBkYXRlXCIgZGF0YSAoaS5lLiBmb3IgYW4gdXBkYXRlRGF0YSBjYWxsKS4gKi8gY2xhc3MgUGFyc2VkVXBkYXRlRGF0YSB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLy8gVGhlIGZpZWxkTWFzayBkb2VzIG5vdCBpbmNsdWRlIGRvY3VtZW50IHRyYW5zZm9ybXMuXG4gICAgdCwgbikge1xuICAgICAgICB0aGlzLmRhdGEgPSBlLCB0aGlzLmZpZWxkTWFzayA9IHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gbjtcbiAgICB9XG4gICAgdG9NdXRhdGlvbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhdGNoTXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0aGlzLmZpZWxkTWFzaywgdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2lzV3JpdGUoZSkge1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSAwIC8qIFVzZXJEYXRhU291cmNlLlNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gOlxuICAgICAgICByZXR1cm4gITA7XG5cbiAgICAgIGNhc2UgMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyA6XG4gICAgICBjYXNlIDQgLyogVXNlckRhdGFTb3VyY2UuQXJyYXlBcmd1bWVudCAqLyA6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqIEEgXCJjb250ZXh0XCIgb2JqZWN0IHBhc3NlZCBhcm91bmQgd2hpbGUgcGFyc2luZyB1c2VyIGRhdGEuICovIGNsYXNzIF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhIFBhcnNlQ29udGV4dCB3aXRoIHRoZSBnaXZlbiBzb3VyY2UgYW5kIHBhdGguXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2V0dGluZ3MgLSBUaGUgc2V0dGluZ3MgZm9yIHRoZSBwYXJzZXIuXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgSUQgb2YgdGhlIEZpcmVzdG9yZSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gc2VyaWFsaXplciAtIFRoZSBzZXJpYWxpemVyIHRvIHVzZSB0byBnZW5lcmF0ZSB0aGUgVmFsdWUgcHJvdG8uXG4gICAgICogQHBhcmFtIGlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgLSBXaGV0aGVyIHRvIGlnbm9yZSB1bmRlZmluZWQgcHJvcGVydGllc1xuICAgICAqIHJhdGhlciB0aGFuIHRocm93LlxuICAgICAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBBIG11dGFibGUgbGlzdCBvZiBmaWVsZCB0cmFuc2Zvcm1zIGVuY291bnRlcmVkXG4gICAgICogd2hpbGUgcGFyc2luZyB0aGUgZGF0YS5cbiAgICAgKiBAcGFyYW0gZmllbGRNYXNrIC0gQSBtdXRhYmxlIGxpc3Qgb2YgZmllbGQgcGF0aHMgZW5jb3VudGVyZWQgd2hpbGUgcGFyc2luZ1xuICAgICAqIHRoZSBkYXRhLlxuICAgICAqXG4gICAgICogVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3csIHNvIHBhdGggY2FuIGJlXG4gICAgICogbnVsbCB0byBpbmRpY2F0ZSB0aGUgY29udGV4dCByZXByZXNlbnRzIGFueSBsb2NhdGlvbiB3aXRoaW4gYW4gYXJyYXkgKGluXG4gICAgICogd2hpY2ggY2FzZSBjZXJ0YWluIGZlYXR1cmVzIHdpbGwgbm90IHdvcmsgYW5kIGVycm9ycyB3aWxsIGJlIHNvbWV3aGF0XG4gICAgICogY29tcHJvbWlzZWQpLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IGUsIHRoaXMuZGF0YWJhc2VJZCA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4sIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHIsIFxuICAgICAgICAvLyBNaW5vciBoYWNrOiBJZiBmaWVsZFRyYW5zZm9ybXMgaXMgdW5kZWZpbmVkLCB3ZSBhc3N1bWUgdGhpcyBpcyBhblxuICAgICAgICAvLyBleHRlcm5hbCBjYWxsIGFuZCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBlbnRpcmUgcGF0aC5cbiAgICAgICAgdm9pZCAwID09PSBpICYmIHRoaXMuYXUoKSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBpIHx8IFtdLCB0aGlzLmZpZWxkTWFzayA9IHMgfHwgW107XG4gICAgfVxuICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5wYXRoO1xuICAgIH1cbiAgICBnZXQgdXUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnV1O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG5ldyBjb250ZXh0IHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncyBvdmVyd3JpdHRlbi4gKi8gICAgY3UoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zZXR0aW5ncyksIGUpLCB0aGlzLmRhdGFiYXNlSWQsIHRoaXMuc2VyaWFsaXplciwgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzLCB0aGlzLmZpZWxkVHJhbnNmb3JtcywgdGhpcy5maWVsZE1hc2spO1xuICAgIH1cbiAgICBsdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLmN1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICBodTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLlB1KGUpLCByO1xuICAgIH1cbiAgICBJdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLmN1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICBodTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLmF1KCksIHI7XG4gICAgfVxuICAgIFR1KGUpIHtcbiAgICAgICAgLy8gVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3c7IHNvIG1ha2UgcGF0aFxuICAgICAgICAvLyB1bmRlZmluZWQuXG4gICAgICAgIHJldHVybiB0aGlzLmN1KHtcbiAgICAgICAgICAgIHBhdGg6IHZvaWQgMCxcbiAgICAgICAgICAgIGh1OiAhMFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgRXUoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NyZWF0ZUVycm9yKGUsIHRoaXMuc2V0dGluZ3MubWV0aG9kTmFtZSwgdGhpcy5zZXR0aW5ncy5kdSB8fCAhMSwgdGhpcy5wYXRoLCB0aGlzLnNldHRpbmdzLkF1KTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgJ3RydWUnIGlmICdmaWVsZFBhdGgnIHdhcyB0cmF2ZXJzZWQgd2hlbiBjcmVhdGluZyB0aGlzIGNvbnRleHQuICovICAgIGNvbnRhaW5zKGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5maWVsZE1hc2suZmluZCgodCA9PiBlLmlzUHJlZml4T2YodCkpKSB8fCB2b2lkIDAgIT09IHRoaXMuZmllbGRUcmFuc2Zvcm1zLmZpbmQoKHQgPT4gZS5pc1ByZWZpeE9mKHQuZmllbGQpKSk7XG4gICAgfVxuICAgIGF1KCkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBSZW1vdmUgbnVsbCBjaGVjayBvbmNlIHdlIGhhdmUgcHJvcGVyIHBhdGhzIGZvciBmaWVsZHNcbiAgICAgICAgLy8gd2l0aGluIGFycmF5cy5cbiAgICAgICAgaWYgKHRoaXMucGF0aCkgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLnBhdGgubGVuZ3RoOyBlKyspIHRoaXMuUHUodGhpcy5wYXRoLmdldChlKSk7XG4gICAgfVxuICAgIFB1KGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSB0aHJvdyB0aGlzLkV1KFwiRG9jdW1lbnQgZmllbGRzIG11c3Qgbm90IGJlIGVtcHR5XCIpO1xuICAgICAgICBpZiAoX19QUklWQVRFX2lzV3JpdGUodGhpcy51dSkgJiYgcGUudGVzdChlKSkgdGhyb3cgdGhpcy5FdSgnRG9jdW1lbnQgZmllbGRzIGNhbm5vdCBiZWdpbiBhbmQgZW5kIHdpdGggXCJfX1wiJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciBmb3IgcGFyc2luZyByYXcgdXNlciBpbnB1dCAocHJvdmlkZWQgdmlhIHRoZSBBUEkpIGludG8gaW50ZXJuYWwgbW9kZWxcbiAqIGNsYXNzZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1VzZXJEYXRhUmVhZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IGUsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4gfHwgX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRvcC1sZXZlbCBwYXJzZSBjb250ZXh0LiAqLyAgICBSdShlLCB0LCBuLCByID0gITEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUGFyc2VDb250ZXh0SW1wbCh7XG4gICAgICAgICAgICB1dTogZSxcbiAgICAgICAgICAgIG1ldGhvZE5hbWU6IHQsXG4gICAgICAgICAgICBBdTogbixcbiAgICAgICAgICAgIHBhdGg6IEZpZWxkUGF0aCQxLmVtcHR5UGF0aCgpLFxuICAgICAgICAgICAgaHU6ICExLFxuICAgICAgICAgICAgZHU6IHJcbiAgICAgICAgfSwgdGhpcy5kYXRhYmFzZUlkLCB0aGlzLnNlcmlhbGl6ZXIsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSkge1xuICAgIGNvbnN0IHQgPSBlLl9mcmVlemVTZXR0aW5ncygpLCBuID0gX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZS5fZGF0YWJhc2VJZCk7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVXNlckRhdGFSZWFkZXIoZS5fZGF0YWJhc2VJZCwgISF0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIG4pO1xufVxuXG4vKiogUGFyc2UgZG9jdW1lbnQgZGF0YSBmcm9tIGEgc2V0KCkgY2FsbC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlU2V0RGF0YShlLCB0LCBuLCByLCBpLCBzID0ge30pIHtcbiAgICBjb25zdCBvID0gZS5SdShzLm1lcmdlIHx8IHMubWVyZ2VGaWVsZHMgPyAyIC8qIFVzZXJEYXRhU291cmNlLk1lcmdlU2V0ICovIDogMCAvKiBVc2VyRGF0YVNvdXJjZS5TZXQgKi8gLCB0LCBuLCBpKTtcbiAgICBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIG8sIHIpO1xuICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfcGFyc2VPYmplY3Qociwgbyk7XG4gICAgbGV0IGEsIHU7XG4gICAgaWYgKHMubWVyZ2UpIGEgPSBuZXcgRmllbGRNYXNrKG8uZmllbGRNYXNrKSwgdSA9IG8uZmllbGRUcmFuc2Zvcm1zOyBlbHNlIGlmIChzLm1lcmdlRmllbGRzKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByIG9mIHMubWVyZ2VGaWVsZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEodCwgciwgbik7XG4gICAgICAgICAgICBpZiAoIW8uY29udGFpbnMoaSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBGaWVsZCAnJHtpfScgaXMgc3BlY2lmaWVkIGluIHlvdXIgZmllbGQgbWFzayBidXQgbWlzc2luZyBmcm9tIHlvdXIgaW5wdXQgZGF0YS5gKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyhlLCBpKSB8fCBlLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgICAgYSA9IG5ldyBGaWVsZE1hc2soZSksIHUgPSBvLmZpZWxkVHJhbnNmb3Jtcy5maWx0ZXIoKGUgPT4gYS5jb3ZlcnMoZS5maWVsZCkpKTtcbiAgICB9IGVsc2UgYSA9IG51bGwsIHUgPSBvLmZpZWxkVHJhbnNmb3JtcztcbiAgICByZXR1cm4gbmV3IFBhcnNlZFNldERhdGEobmV3IE9iamVjdFZhbHVlKF8pLCBhLCB1KTtcbn1cblxuY2xhc3MgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBpZiAoMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyAhPT0gZS51dSkgdGhyb3cgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gPT09IGUudXUgPyBlLkV1KGAke3RoaXMuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwgb2YgeW91ciB1cGRhdGUgZGF0YWApIDogZS5FdShgJHt0aGlzLl9tZXRob2ROYW1lfSgpIGNhbm5vdCBiZSB1c2VkIHdpdGggc2V0KCkgdW5sZXNzIHlvdSBwYXNzIHttZXJnZTp0cnVlfWApO1xuICAgICAgICAvLyBObyB0cmFuc2Zvcm0gdG8gYWRkIGZvciBhIGRlbGV0ZSwgYnV0IHdlIG5lZWQgdG8gYWRkIGl0IHRvIG91clxuICAgICAgICAvLyBmaWVsZE1hc2sgc28gaXQgZ2V0cyBkZWxldGVkLlxuICAgICAgICByZXR1cm4gZS5maWVsZE1hc2sucHVzaChlLnBhdGgpLCBudWxsO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfRGVsZXRlRmllbGRWYWx1ZUltcGw7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBjaGlsZCBjb250ZXh0IGZvciBwYXJzaW5nIFNlcmlhbGl6YWJsZUZpZWxkVmFsdWVzLlxuICpcbiAqIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gY2FsbGluZyBgUGFyc2VDb250ZXh0LmNvbnRleHRXaXRoYCBiZWNhdXNlIGl0IGtlZXBzXG4gKiB0aGUgZmllbGRUcmFuc2Zvcm1zIGFuZCBmaWVsZE1hc2sgc2VwYXJhdGUuXG4gKlxuICogVGhlIGNyZWF0ZWQgY29udGV4dCBoYXMgaXRzIGBkYXRhU291cmNlYCBzZXQgdG8gYFVzZXJEYXRhU291cmNlLkFyZ3VtZW50YC5cbiAqIEFsdGhvdWdoIHRoZXNlIHZhbHVlcyBhcmUgdXNlZCB3aXRoIHdyaXRlcywgYW55IGVsZW1lbnRzIGluIHRoZXNlIEZpZWxkVmFsdWVzXG4gKiBhcmUgbm90IGNvbnNpZGVyZWQgd3JpdGVzIHNpbmNlIHRoZXkgY2Fubm90IGNvbnRhaW4gYW55IEZpZWxkVmFsdWUgc2VudGluZWxzLFxuICogZXRjLlxuICpcbiAqIEBwYXJhbSBmaWVsZFZhbHVlIC0gVGhlIHNlbnRpbmVsIEZpZWxkVmFsdWUgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIGNoaWxkXG4gKiAgICAgY29udGV4dC5cbiAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIHBhcmVudCBjb250ZXh0LlxuICogQHBhcmFtIGFycmF5RWxlbWVudCAtIFdoZXRoZXIgb3Igbm90IHRoZSBGaWVsZFZhbHVlIGhhcyBhbiBhcnJheS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlU2VudGluZWxDaGlsZENvbnRleHQoZSwgdCwgbikge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhcnNlQ29udGV4dEltcGwoe1xuICAgICAgICB1dTogMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyAsXG4gICAgICAgIEF1OiB0LnNldHRpbmdzLkF1LFxuICAgICAgICBtZXRob2ROYW1lOiBlLl9tZXRob2ROYW1lLFxuICAgICAgICBodTogblxuICAgIH0sIHQuZGF0YWJhc2VJZCwgdC5zZXJpYWxpemVyLCB0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpO1xufVxuXG5jbGFzcyBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBfdG9GaWVsZFRyYW5zZm9ybShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0oZS5wYXRoLCBuZXcgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBGaWVsZFZhbHVlSW1wbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9BcnJheVVuaW9uRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUpLCB0aGlzLlZ1ID0gdDtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2NyZWF0ZVNlbnRpbmVsQ2hpbGRDb250ZXh0KHRoaXMsIGUsIFxuICAgICAgICAvKmFycmF5PSovICEwKSwgbiA9IHRoaXMuVnUubWFwKChlID0+IF9fUFJJVkFURV9wYXJzZURhdGEoZSwgdCkpKSwgciA9IG5ldyBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFRyYW5zZm9ybShlLnBhdGgsIHIpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgLy8gVE9ETyhtcnNjaG1pZHQpOiBJbXBsZW1lbnQgaXNFcXVhbHNcbiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGU7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfQXJyYXlSZW1vdmVGaWVsZFZhbHVlSW1wbCBleHRlbmRzIEZpZWxkVmFsdWUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoZSksIHRoaXMuVnUgPSB0O1xuICAgIH1cbiAgICBfdG9GaWVsZFRyYW5zZm9ybShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY3JlYXRlU2VudGluZWxDaGlsZENvbnRleHQodGhpcywgZSwgXG4gICAgICAgIC8qYXJyYXk9Ki8gITApLCBuID0gdGhpcy5WdS5tYXAoKGUgPT4gX19QUklWQVRFX3BhcnNlRGF0YShlLCB0KSkpLCByID0gbmV3IF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFRyYW5zZm9ybShlLnBhdGgsIHIpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgLy8gVE9ETyhtcnNjaG1pZHQpOiBJbXBsZW1lbnQgaXNFcXVhbHNcbiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGU7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudEZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlKSwgdGhpcy5tdSA9IHQ7XG4gICAgfVxuICAgIF90b0ZpZWxkVHJhbnNmb3JtKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbihlLnNlcmlhbGl6ZXIsIHRvTnVtYmVyKGUuc2VyaWFsaXplciwgdGhpcy5tdSkpO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkVHJhbnNmb3JtKGUucGF0aCwgdCk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICAvLyBUT0RPKG1yc2NobWlkdCk6IEltcGxlbWVudCBpc0VxdWFsc1xuICAgICAgICByZXR1cm4gdGhpcyA9PT0gZTtcbiAgICB9XG59XG5cbi8qKiBQYXJzZSB1cGRhdGUgZGF0YSBmcm9tIGFuIHVwZGF0ZSgpIGNhbGwuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZVVwZGF0ZURhdGEoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBlLlJ1KDEgLyogVXNlckRhdGFTb3VyY2UuVXBkYXRlICovICwgdCwgbik7XG4gICAgX19QUklWQVRFX3ZhbGlkYXRlUGxhaW5PYmplY3QoXCJEYXRhIG11c3QgYmUgYW4gb2JqZWN0LCBidXQgaXQgd2FzOlwiLCBpLCByKTtcbiAgICBjb25zdCBzID0gW10sIG8gPSBPYmplY3RWYWx1ZS5lbXB0eSgpO1xuICAgIGZvckVhY2gociwgKChlLCByKSA9PiB7XG4gICAgICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyh0LCBlLCBuKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIHIgPSBnZXRNb2R1bGFySW5zdGFuY2Uocik7XG4gICAgICAgIGNvbnN0IGEgPSBpLkl1KF8pO1xuICAgICAgICBpZiAociBpbnN0YW5jZW9mIF9fUFJJVkFURV9EZWxldGVGaWVsZFZhbHVlSW1wbCkgXG4gICAgICAgIC8vIEFkZCBpdCB0byB0aGUgZmllbGQgbWFzaywgYnV0IGRvbid0IGFkZCBhbnl0aGluZyB0byB1cGRhdGVEYXRhLlxuICAgICAgICBzLnB1c2goXyk7IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9wYXJzZURhdGEociwgYSk7XG4gICAgICAgICAgICBudWxsICE9IGUgJiYgKHMucHVzaChfKSwgby5zZXQoXywgZSkpO1xuICAgICAgICB9XG4gICAgfSkpO1xuICAgIGNvbnN0IF8gPSBuZXcgRmllbGRNYXNrKHMpO1xuICAgIHJldHVybiBuZXcgUGFyc2VkVXBkYXRlRGF0YShvLCBfLCBpLmZpZWxkVHJhbnNmb3Jtcyk7XG59XG5cbi8qKiBQYXJzZSB1cGRhdGUgZGF0YSBmcm9tIGEgbGlzdCBvZiBmaWVsZC92YWx1ZSBhcmd1bWVudHMuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZVVwZGF0ZVZhcmFyZ3MoZSwgdCwgbiwgciwgaSwgcykge1xuICAgIGNvbnN0IG8gPSBlLlJ1KDEgLyogVXNlckRhdGFTb3VyY2UuVXBkYXRlICovICwgdCwgbiksIF8gPSBbIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQkMSh0LCByLCBuKSBdLCBhID0gWyBpIF07XG4gICAgaWYgKHMubGVuZ3RoICUgMiAhPSAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHt0fSgpIG5lZWRzIHRvIGJlIGNhbGxlZCB3aXRoIGFuIGV2ZW4gbnVtYmVyIG9mIGFyZ3VtZW50cyB0aGF0IGFsdGVybmF0ZSBiZXR3ZWVuIGZpZWxkIG5hbWVzIGFuZCB2YWx1ZXMuYCk7XG4gICAgZm9yIChsZXQgZSA9IDA7IGUgPCBzLmxlbmd0aDsgZSArPSAyKSBfLnB1c2goX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKHQsIHNbZV0pKSwgXG4gICAgYS5wdXNoKHNbZSArIDFdKTtcbiAgICBjb25zdCB1ID0gW10sIGMgPSBPYmplY3RWYWx1ZS5lbXB0eSgpO1xuICAgIC8vIFdlIGl0ZXJhdGUgaW4gcmV2ZXJzZSBvcmRlciB0byBwaWNrIHRoZSBsYXN0IHZhbHVlIGZvciBhIGZpZWxkIGlmIHRoZVxuICAgIC8vIHVzZXIgc3BlY2lmaWVkIHRoZSBmaWVsZCBtdWx0aXBsZSB0aW1lcy5cbiAgICBmb3IgKGxldCBlID0gXy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgaWYgKCFfX1BSSVZBVEVfZmllbGRNYXNrQ29udGFpbnModSwgX1tlXSkpIHtcbiAgICAgICAgY29uc3QgdCA9IF9bZV07XG4gICAgICAgIGxldCBuID0gYVtlXTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIG4gPSBnZXRNb2R1bGFySW5zdGFuY2Uobik7XG4gICAgICAgIGNvbnN0IHIgPSBvLkl1KHQpO1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIF9fUFJJVkFURV9EZWxldGVGaWVsZFZhbHVlSW1wbCkgXG4gICAgICAgIC8vIEFkZCBpdCB0byB0aGUgZmllbGQgbWFzaywgYnV0IGRvbid0IGFkZCBhbnl0aGluZyB0byB1cGRhdGVEYXRhLlxuICAgICAgICB1LnB1c2godCk7IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9wYXJzZURhdGEobiwgcik7XG4gICAgICAgICAgICBudWxsICE9IGUgJiYgKHUucHVzaCh0KSwgYy5zZXQodCwgZSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGwgPSBuZXcgRmllbGRNYXNrKHUpO1xuICAgIHJldHVybiBuZXcgUGFyc2VkVXBkYXRlRGF0YShjLCBsLCBvLmZpZWxkVHJhbnNmb3Jtcyk7XG59XG5cbi8qKlxuICogUGFyc2UgYSBcInF1ZXJ5IHZhbHVlXCIgKGUuZy4gdmFsdWUgaW4gYSB3aGVyZSBmaWx0ZXIgb3IgYSB2YWx1ZSBpbiBhIGN1cnNvclxuICogYm91bmQpLlxuICpcbiAqIEBwYXJhbSBhbGxvd0FycmF5cyAtIFdoZXRoZXIgdGhlIHF1ZXJ5IHZhbHVlIGlzIGFuIGFycmF5IHRoYXQgbWF5IGRpcmVjdGx5XG4gKiBjb250YWluIGFkZGl0aW9uYWwgYXJyYXlzIChlLmcuIHRoZSBvcGVyYW5kIG9mIGFuIGBpbmAgcXVlcnkpLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZVF1ZXJ5VmFsdWUoZSwgdCwgbiwgciA9ICExKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9wYXJzZURhdGEobiwgZS5SdShyID8gNCAvKiBVc2VyRGF0YVNvdXJjZS5BcnJheUFyZ3VtZW50ICovIDogMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyAsIHQpKTtcbn1cblxuLyoqXG4gKiBQYXJzZXMgdXNlciBkYXRhIHRvIFByb3RvYnVmIFZhbHVlcy5cbiAqXG4gKiBAcGFyYW0gaW5wdXQgLSBEYXRhIHRvIGJlIHBhcnNlZC5cbiAqIEBwYXJhbSBjb250ZXh0IC0gQSBjb250ZXh0IG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgcGF0aCBiZWluZyBwYXJzZWQsXG4gKiB0aGUgc291cmNlIG9mIHRoZSBkYXRhIGJlaW5nIHBhcnNlZCwgZXRjLlxuICogQHJldHVybnMgVGhlIHBhcnNlZCB2YWx1ZSwgb3IgbnVsbCBpZiB0aGUgdmFsdWUgd2FzIGEgRmllbGRWYWx1ZSBzZW50aW5lbFxuICogdGhhdCBzaG91bGQgbm90IGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHRpbmcgcGFyc2VkIGRhdGEuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlRGF0YShlLCB0KSB7XG4gICAgaWYgKF9fUFJJVkFURV9sb29rc0xpa2VKc29uT2JqZWN0KFxuICAgIC8vIFVud3JhcCB0aGUgQVBJIHR5cGUgZnJvbSB0aGUgQ29tcGF0IFNESy4gVGhpcyB3aWxsIHJldHVybiB0aGUgQVBJIHR5cGVcbiAgICAvLyBmcm9tIGZpcmVzdG9yZS1leHAuXG4gICAgZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSkpIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIlVuc3VwcG9ydGVkIGZpZWxkIHZhbHVlOlwiLCB0LCBlKSwgXG4gICAgX19QUklWQVRFX3BhcnNlT2JqZWN0KGUsIHQpO1xuICAgIGlmIChlIGluc3RhbmNlb2YgRmllbGRWYWx1ZSkgXG4gICAgLy8gRmllbGRWYWx1ZXMgdXN1YWxseSBwYXJzZSBpbnRvIHRyYW5zZm9ybXMgKGV4Y2VwdCBkZWxldGVGaWVsZCgpKVxuICAgIC8vIGluIHdoaWNoIGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gaW5jbHVkZSB0aGlzIGZpZWxkIGluIG91ciBwYXJzZWQgZGF0YVxuICAgIC8vIChhcyBkb2luZyBzbyB3aWxsIG92ZXJ3cml0ZSB0aGUgZmllbGQgZGlyZWN0bHkgcHJpb3IgdG8gdGhlIHRyYW5zZm9ybVxuICAgIC8vIHRyeWluZyB0byB0cmFuc2Zvcm0gaXQpLiBTbyB3ZSBkb24ndCBhZGQgdGhpcyBsb2NhdGlvbiB0b1xuICAgIC8vIGNvbnRleHQuZmllbGRNYXNrIGFuZCB3ZSByZXR1cm4gbnVsbCBhcyBvdXIgcGFyc2luZyByZXN1bHQuXG4gICAgLyoqXG4gKiBcIlBhcnNlc1wiIHRoZSBwcm92aWRlZCBGaWVsZFZhbHVlSW1wbCwgYWRkaW5nIGFueSBuZWNlc3NhcnkgdHJhbnNmb3JtcyB0b1xuICogY29udGV4dC5maWVsZFRyYW5zZm9ybXMuXG4gKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlU2VudGluZWxGaWVsZFZhbHVlKGUsIHQpIHtcbiAgICAgICAgLy8gU2VudGluZWxzIGFyZSBvbmx5IHN1cHBvcnRlZCB3aXRoIHdyaXRlcywgYW5kIG5vdCB3aXRoaW4gYXJyYXlzLlxuICAgICAgICBpZiAoIV9fUFJJVkFURV9pc1dyaXRlKHQudXUpKSB0aHJvdyB0LkV1KGAke2UuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIHVwZGF0ZSgpIGFuZCBzZXQoKWApO1xuICAgICAgICBpZiAoIXQucGF0aCkgdGhyb3cgdC5FdShgJHtlLl9tZXRob2ROYW1lfSgpIGlzIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkIGluc2lkZSBhcnJheXNgKTtcbiAgICAgICAgY29uc3QgbiA9IGUuX3RvRmllbGRUcmFuc2Zvcm0odCk7XG4gICAgICAgIG4gJiYgdC5maWVsZFRyYW5zZm9ybXMucHVzaChuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBIZWxwZXIgdG8gcGFyc2UgYSBzY2FsYXIgdmFsdWUgKGkuZS4gbm90IGFuIE9iamVjdCwgQXJyYXksIG9yIEZpZWxkVmFsdWUpXG4gKlxuICogQHJldHVybnMgVGhlIHBhcnNlZCB2YWx1ZVxuICovIChlLCB0KSwgbnVsbDtcbiAgICBpZiAodm9pZCAwID09PSBlICYmIHQuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcykgXG4gICAgLy8gSWYgdGhlIGlucHV0IGlzIHVuZGVmaW5lZCBpdCBjYW4gbmV2ZXIgcGFydGljaXBhdGUgaW4gdGhlIGZpZWxkTWFzaywgc29cbiAgICAvLyBkb24ndCBoYW5kbGUgdGhpcyBiZWxvdy4gSWYgYGlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXNgIGlzIGZhbHNlLFxuICAgIC8vIGBwYXJzZVNjYWxhclZhbHVlYCB3aWxsIHJlamVjdCBhbiB1bmRlZmluZWQgdmFsdWUuXG4gICAgcmV0dXJuIG51bGw7XG4gICAgaWYgKFxuICAgIC8vIElmIGNvbnRleHQucGF0aCBpcyBudWxsIHdlIGFyZSBpbnNpZGUgYW4gYXJyYXkgYW5kIHdlIGRvbid0IHN1cHBvcnRcbiAgICAvLyBmaWVsZCBtYXNrIHBhdGhzIG1vcmUgZ3JhbnVsYXIgdGhhbiB0aGUgdG9wLWxldmVsIGFycmF5LlxuICAgIHQucGF0aCAmJiB0LmZpZWxkTWFzay5wdXNoKHQucGF0aCksIGUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBJbmNsdWRlIHRoZSBwYXRoIGNvbnRhaW5pbmcgdGhlIGFycmF5IGluIHRoZSBlcnJvclxuICAgICAgICAvLyBtZXNzYWdlLlxuICAgICAgICAvLyBJbiB0aGUgY2FzZSBvZiBJTiBxdWVyaWVzLCB0aGUgcGFyc2VkIGRhdGEgaXMgYW4gYXJyYXkgKHJlcHJlc2VudGluZ1xuICAgICAgICAvLyB0aGUgc2V0IG9mIHZhbHVlcyB0byBiZSBpbmNsdWRlZCBmb3IgdGhlIElOIHF1ZXJ5KSB0aGF0IG1heSBkaXJlY3RseVxuICAgICAgICAvLyBjb250YWluIGFkZGl0aW9uYWwgYXJyYXlzIChlYWNoIHJlcHJlc2VudGluZyBhbiBpbmRpdmlkdWFsIGZpZWxkXG4gICAgICAgIC8vIHZhbHVlKSwgc28gd2UgZGlzYWJsZSB0aGlzIHZhbGlkYXRpb24uXG4gICAgICAgIGlmICh0LnNldHRpbmdzLmh1ICYmIDQgLyogVXNlckRhdGFTb3VyY2UuQXJyYXlBcmd1bWVudCAqLyAhPT0gdC51dSkgdGhyb3cgdC5FdShcIk5lc3RlZCBhcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWRcIik7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VBcnJheShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgZSkge1xuICAgICAgICAgICAgICAgIGxldCBlID0gX19QUklWQVRFX3BhcnNlRGF0YShpLCB0LlR1KHIpKTtcbiAgICAgICAgICAgICAgICBudWxsID09IGUgJiYgKFxuICAgICAgICAgICAgICAgIC8vIEp1c3QgaW5jbHVkZSBudWxscyBpbiB0aGUgYXJyYXkgZm9yIGZpZWxkcyBiZWluZyByZXBsYWNlZCB3aXRoIGFcbiAgICAgICAgICAgICAgICAvLyBzZW50aW5lbC5cbiAgICAgICAgICAgICAgICBlID0ge1xuICAgICAgICAgICAgICAgICAgICBudWxsVmFsdWU6IFwiTlVMTF9WQUxVRVwiXG4gICAgICAgICAgICAgICAgfSksIG4ucHVzaChlKSwgcisrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oZSwgdCk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VTY2FsYXJWYWx1ZShlLCB0KSB7XG4gICAgICAgIGlmIChudWxsID09PSAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSkpIHJldHVybiB7XG4gICAgICAgICAgICBudWxsVmFsdWU6IFwiTlVMTF9WQUxVRVwiXG4gICAgICAgIH07XG4gICAgICAgIGlmIChcIm51bWJlclwiID09IHR5cGVvZiBlKSByZXR1cm4gdG9OdW1iZXIodC5zZXJpYWxpemVyLCBlKTtcbiAgICAgICAgaWYgKFwiYm9vbGVhblwiID09IHR5cGVvZiBlKSByZXR1cm4ge1xuICAgICAgICAgICAgYm9vbGVhblZhbHVlOiBlXG4gICAgICAgIH07XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4ge1xuICAgICAgICAgICAgc3RyaW5nVmFsdWU6IGVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gVGltZXN0YW1wLmZyb21EYXRlKGUpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXBWYWx1ZTogdG9UaW1lc3RhbXAodC5zZXJpYWxpemVyLCBuKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFRpbWVzdGFtcCkge1xuICAgICAgICAgICAgLy8gRmlyZXN0b3JlIGJhY2tlbmQgdHJ1bmNhdGVzIHByZWNpc2lvbiBkb3duIHRvIG1pY3Jvc2Vjb25kcy4gVG8gZW5zdXJlXG4gICAgICAgICAgICAvLyBvZmZsaW5lIG1vZGUgd29ya3MgdGhlIHNhbWUgd2l0aCByZWdhcmRzIHRvIHRydW5jYXRpb24sIHBlcmZvcm0gdGhlXG4gICAgICAgICAgICAvLyB0cnVuY2F0aW9uIGltbWVkaWF0ZWx5IHdpdGhvdXQgd2FpdGluZyBmb3IgdGhlIGJhY2tlbmQgdG8gZG8gdGhhdC5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgVGltZXN0YW1wKGUuc2Vjb25kcywgMWUzICogTWF0aC5mbG9vcihlLm5hbm9zZWNvbmRzIC8gMWUzKSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiB0b1RpbWVzdGFtcCh0LnNlcmlhbGl6ZXIsIG4pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgR2VvUG9pbnQpIHJldHVybiB7XG4gICAgICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgbGF0aXR1ZGU6IGUubGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBlLmxvbmdpdHVkZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEJ5dGVzKSByZXR1cm4ge1xuICAgICAgICAgICAgYnl0ZXNWYWx1ZTogX19QUklWQVRFX3RvQnl0ZXModC5zZXJpYWxpemVyLCBlLl9ieXRlU3RyaW5nKVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5kYXRhYmFzZUlkLCByID0gZS5maXJlc3RvcmUuX2RhdGFiYXNlSWQ7XG4gICAgICAgICAgICBpZiAoIXIuaXNFcXVhbChuKSkgdGhyb3cgdC5FdShgRG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZvciBkYXRhYmFzZSAke3IucHJvamVjdElkfS8ke3IuZGF0YWJhc2V9IGJ1dCBzaG91bGQgYmUgZm9yIGRhdGFiYXNlICR7bi5wcm9qZWN0SWR9LyR7bi5kYXRhYmFzZX1gKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlVmFsdWU6IF9fUFJJVkFURV90b1Jlc291cmNlTmFtZShlLmZpcmVzdG9yZS5fZGF0YWJhc2VJZCB8fCB0LmRhdGFiYXNlSWQsIGUuX2tleS5wYXRoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0LkV1KGBVbnN1cHBvcnRlZCBmaWVsZCB2YWx1ZTogJHtfX1BSSVZBVEVfdmFsdWVEZXNjcmlwdGlvbihlKX1gKTtcbiAgICB9XG4gICAgLyoqXG4gKiBDaGVja3Mgd2hldGhlciBhbiBvYmplY3QgbG9va3MgbGlrZSBhIEpTT04gb2JqZWN0IHRoYXQgc2hvdWxkIGJlIGNvbnZlcnRlZFxuICogaW50byBhIHN0cnVjdC4gTm9ybWFsIGNsYXNzL3Byb3RvdHlwZSBpbnN0YW5jZXMgYXJlIGNvbnNpZGVyZWQgdG8gbG9vayBsaWtlXG4gKiBKU09OIG9iamVjdHMgc2luY2UgdGhleSBzaG91bGQgYmUgY29udmVydGVkIHRvIGEgc3RydWN0IHZhbHVlLiBBcnJheXMsIERhdGVzLFxuICogR2VvUG9pbnRzLCBldGMuIGFyZSBub3QgY29uc2lkZXJlZCB0byBsb29rIGxpa2UgSlNPTiBvYmplY3RzIHNpbmNlIHRoZXkgbWFwXG4gKiB0byBzcGVjaWZpYyBGaWVsZFZhbHVlIHR5cGVzIG90aGVyIHRoYW4gT2JqZWN0VmFsdWUuXG4gKi8gKGUsIHQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VPYmplY3QoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB7fTtcbiAgICByZXR1cm4gaXNFbXB0eShlKSA/IFxuICAgIC8vIElmIHdlIGVuY291bnRlciBhbiBlbXB0eSBvYmplY3QsIHdlIGV4cGxpY2l0bHkgYWRkIGl0IHRvIHRoZSB1cGRhdGVcbiAgICAvLyBtYXNrIHRvIGVuc3VyZSB0aGF0IHRoZSBzZXJ2ZXIgY3JlYXRlcyBhIG1hcCBlbnRyeS5cbiAgICB0LnBhdGggJiYgdC5wYXRoLmxlbmd0aCA+IDAgJiYgdC5maWVsZE1hc2sucHVzaCh0LnBhdGgpIDogZm9yRWFjaChlLCAoKGUsIHIpID0+IHtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9wYXJzZURhdGEociwgdC5sdShlKSk7XG4gICAgICAgIG51bGwgIT0gaSAmJiAobltlXSA9IGkpO1xuICAgIH0pKSwge1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiBuXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9va3NMaWtlSnNvbk9iamVjdChlKSB7XG4gICAgcmV0dXJuICEoXCJvYmplY3RcIiAhPSB0eXBlb2YgZSB8fCBudWxsID09PSBlIHx8IGUgaW5zdGFuY2VvZiBBcnJheSB8fCBlIGluc3RhbmNlb2YgRGF0ZSB8fCBlIGluc3RhbmNlb2YgVGltZXN0YW1wIHx8IGUgaW5zdGFuY2VvZiBHZW9Qb2ludCB8fCBlIGluc3RhbmNlb2YgQnl0ZXMgfHwgZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IGUgaW5zdGFuY2VvZiBGaWVsZFZhbHVlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlUGxhaW5PYmplY3QoZSwgdCwgbikge1xuICAgIGlmICghX19QUklWQVRFX2xvb2tzTGlrZUpzb25PYmplY3QobikgfHwgIWZ1bmN0aW9uIF9fUFJJVkFURV9pc1BsYWluT2JqZWN0KGUpIHtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgJiYgbnVsbCAhPT0gZSAmJiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKGUpID09PSBPYmplY3QucHJvdG90eXBlIHx8IG51bGwgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSk7XG4gICAgfShuKSkge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24obik7XG4gICAgICAgIHRocm93IFwiYW4gb2JqZWN0XCIgPT09IHIgPyB0LkV1KGUgKyBcIiBhIGN1c3RvbSBvYmplY3RcIikgOiB0LkV1KGUgKyBcIiBcIiArIHIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdGhhdCBjYWxscyBmcm9tRG90U2VwYXJhdGVkU3RyaW5nKCkgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKGUsIHQsIG4pIHtcbiAgICBpZiAoKFxuICAgIC8vIElmIHJlcXVpcmVkLCByZXBsYWNlIHRoZSBGaWVsZFBhdGggQ29tcGF0IGNsYXNzIHdpdGggd2l0aCB0aGUgZmlyZXN0b3JlLWV4cFxuICAgIC8vIEZpZWxkUGF0aC5cbiAgICB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSBpbnN0YW5jZW9mIEZpZWxkUGF0aCkgcmV0dXJuIHQuX2ludGVybmFsUGF0aDtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCkgcmV0dXJuIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKGUsIHQpO1xuICAgIHRocm93IF9fUFJJVkFURV9jcmVhdGVFcnJvcihcIkZpZWxkIHBhdGggYXJndW1lbnRzIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcgb3IgXCIsIGUsIFxuICAgIC8qIGhhc0NvbnZlcnRlcj0gKi8gITEsIFxuICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBhbnkgY2hhcmFjdGVycyBpbiBhIGZpZWxkIHBhdGggc3RyaW5nIHRoYXQgYXJlIHJlc2VydmVkLlxuICovIGNvbnN0IHllID0gbmV3IFJlZ0V4cChcIlt+XFxcXCovXFxcXFtcXFxcXV1cIik7XG5cbi8qKlxuICogV3JhcHMgZnJvbURvdFNlcGFyYXRlZFN0cmluZyB3aXRoIGFuIGVycm9yIG1lc3NhZ2UgYWJvdXQgdGhlIG1ldGhvZCB0aGF0XG4gKiB3YXMgdGhyb3duLlxuICogQHBhcmFtIG1ldGhvZE5hbWUgLSBUaGUgcHVibGljbHkgdmlzaWJsZSBtZXRob2QgbmFtZVxuICogQHBhcmFtIHBhdGggLSBUaGUgZG90LXNlcGFyYXRlZCBzdHJpbmcgZm9ybSBvZiBhIGZpZWxkIHBhdGggd2hpY2ggd2lsbCBiZVxuICogc3BsaXQgb24gZG90cy5cbiAqIEBwYXJhbSB0YXJnZXREb2MgLSBUaGUgZG9jdW1lbnQgYWdhaW5zdCB3aGljaCB0aGUgZmllbGQgcGF0aCB3aWxsIGJlXG4gKiBldmFsdWF0ZWQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoZSwgdCwgbikge1xuICAgIGlmICh0LnNlYXJjaCh5ZSkgPj0gMCkgdGhyb3cgX19QUklWQVRFX2NyZWF0ZUVycm9yKGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7dH0pLiBQYXRocyBtdXN0IG5vdCBjb250YWluICd+JywgJyonLCAnLycsICdbJywgb3IgJ10nYCwgZSwgXG4gICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCguLi50LnNwbGl0KFwiLlwiKSkuX2ludGVybmFsUGF0aDtcbiAgICB9IGNhdGNoIChyKSB7XG4gICAgICAgIHRocm93IF9fUFJJVkFURV9jcmVhdGVFcnJvcihgSW52YWxpZCBmaWVsZCBwYXRoICgke3R9KS4gUGF0aHMgbXVzdCBub3QgYmUgZW1wdHksIGJlZ2luIHdpdGggJy4nLCBlbmQgd2l0aCAnLicsIG9yIGNvbnRhaW4gJy4uJ2AsIGUsIFxuICAgICAgICAvKiBoYXNDb252ZXJ0ZXI9ICovICExLCBcbiAgICAgICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVFcnJvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgY29uc3QgcyA9IHIgJiYgIXIuaXNFbXB0eSgpLCBvID0gdm9pZCAwICE9PSBpO1xuICAgIGxldCBfID0gYEZ1bmN0aW9uICR7dH0oKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGRhdGFgO1xuICAgIG4gJiYgKF8gKz0gXCIgKHZpYSBgdG9GaXJlc3RvcmUoKWApXCIpLCBfICs9IFwiLiBcIjtcbiAgICBsZXQgYSA9IFwiXCI7XG4gICAgcmV0dXJuIChzIHx8IG8pICYmIChhICs9IFwiIChmb3VuZFwiLCBzICYmIChhICs9IGAgaW4gZmllbGQgJHtyfWApLCBvICYmIChhICs9IGAgaW4gZG9jdW1lbnQgJHtpfWApLCBcbiAgICBhICs9IFwiKVwiKSwgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXyArIGUgKyBhKTtcbn1cblxuLyoqIENoZWNrcyBgaGF5c3RhY2tgIGlmIEZpZWxkUGF0aCBgbmVlZGxlYCBpcyBwcmVzZW50LiBSdW5zIGluIE8obikuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyhlLCB0KSB7XG4gICAgcmV0dXJuIGUuc29tZSgoZSA9PiBlLmlzRXF1YWwodCkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyIEZpcmVzdG9yZVxuICogZGF0YWJhc2UuIFRoZSBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvXG4gKiBnZXQgYSBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBGb3IgYSBgRG9jdW1lbnRTbmFwc2hvdGAgdGhhdCBwb2ludHMgdG8gYSBub24tZXhpc3RpbmcgZG9jdW1lbnQsIGFueSBkYXRhXG4gKiBhY2Nlc3Mgd2lsbCByZXR1cm4gJ3VuZGVmaW5lZCcuIFlvdSBjYW4gdXNlIHRoZSBgZXhpc3RzKClgIG1ldGhvZCB0b1xuICogZXhwbGljaXRseSB2ZXJpZnkgYSBkb2N1bWVudCdzIGV4aXN0ZW5jZS5cbiAqLyBjbGFzcyBEb2N1bWVudFNuYXBzaG90JDEge1xuICAgIC8vIE5vdGU6IFRoaXMgY2xhc3MgaXMgc3RyaXBwZWQgZG93biB2ZXJzaW9uIG9mIHRoZSBEb2N1bWVudFNuYXBzaG90IGluXG4gICAgLy8gdGhlIGxlZ2FjeSBTREsuIFRoZSBjaGFuZ2VzIGFyZTpcbiAgICAvLyAtIE5vIHN1cHBvcnQgZm9yIFNuYXBzaG90TWV0YWRhdGEuXG4gICAgLy8gLSBObyBzdXBwb3J0IGZvciBTbmFwc2hvdE9wdGlvbnMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSBlLCB0aGlzLl91c2VyRGF0YVdyaXRlciA9IHQsIHRoaXMuX2tleSA9IG4sIHRoaXMuX2RvY3VtZW50ID0gciwgXG4gICAgICAgIHRoaXMuX2NvbnZlcnRlciA9IGk7XG4gICAgfVxuICAgIC8qKiBQcm9wZXJ0eSBvZiB0aGUgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcHJvdmlkZXMgdGhlIGRvY3VtZW50J3MgSUQuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBgRG9jdW1lbnRSZWZlcmVuY2VgIGZvciB0aGUgZG9jdW1lbnQgaW5jbHVkZWQgaW4gdGhlIGBEb2N1bWVudFNuYXBzaG90YC5cbiAgICAgKi8gICAgZ2V0IHJlZigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX2NvbnZlcnRlciwgdGhpcy5fa2V5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2lnbmFscyB3aGV0aGVyIG9yIG5vdCB0aGUgZG9jdW1lbnQgYXQgdGhlIHNuYXBzaG90J3MgbG9jYXRpb24gZXhpc3RzLlxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9kb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgXG4gICAgICogaWYgdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCQxKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIHRoaXMuX2tleSwgdGhpcy5fZG9jdW1lbnQsIFxuICAgICAgICAgICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRlci5mcm9tRmlyZXN0b3JlKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0aGlzLl9kb2N1bWVudC5kYXRhLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldChlKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudChcIkRvY3VtZW50U25hcHNob3QuZ2V0XCIsIGUpKTtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0KSByZXR1cm4gdGhpcy5fdXNlckRhdGFXcml0ZXIuY29udmVydFZhbHVlKHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UgYXMgcGFydCBvZiBhIHF1ZXJ5LiBUaGUgZG9jdW1lbnQgaXMgZ3VhcmFudGVlZCB0byBleGlzdFxuICogYW5kIGl0cyBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvIGdldCBhXG4gKiBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIG9mZmVycyB0aGUgc2FtZSBBUEkgc3VyZmFjZSBhcyBhXG4gKiBgRG9jdW1lbnRTbmFwc2hvdGAuIFNpbmNlIHF1ZXJ5IHJlc3VsdHMgY29udGFpbiBvbmx5IGV4aXN0aW5nIGRvY3VtZW50cywgdGhlXG4gKiBgZXhpc3RzYCBwcm9wZXJ0eSB3aWxsIGFsd2F5cyBiZSB0cnVlIGFuZCBgZGF0YSgpYCB3aWxsIG5ldmVyIHJldHVyblxuICogJ3VuZGVmaW5lZCcuXG4gKi8gY2xhc3MgUXVlcnlEb2N1bWVudFNuYXBzaG90JDEgZXh0ZW5kcyBEb2N1bWVudFNuYXBzaG90JDEge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRoYXQgY2FsbHMgYGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoKWAgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudChlLCB0KSB7XG4gICAgcmV0dXJuIFwic3RyaW5nXCIgPT0gdHlwZW9mIHQgPyBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyhlLCB0KSA6IHQgaW5zdGFuY2VvZiBGaWVsZFBhdGggPyB0Ll9pbnRlcm5hbFBhdGggOiB0Ll9kZWxlZ2F0ZS5faW50ZXJuYWxQYXRoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlKSB7XG4gICAgaWYgKFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovID09PSBlLmxpbWl0VHlwZSAmJiAwID09PSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGgpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LlVOSU1QTEVNRU5URUQsIFwibGltaXRUb0xhc3QoKSBxdWVyaWVzIHJlcXVpcmUgc3BlY2lmeWluZyBhdCBsZWFzdCBvbmUgb3JkZXJCeSgpIGNsYXVzZVwiKTtcbn1cblxuLyoqXG4gKiBBbiBgQXBwbGlhYmxlQ29uc3RyYWludGAgaXMgYW4gYWJzdHJhY3Rpb24gb2YgYSBjb25zdHJhaW50IHRoYXQgY2FuIGJlIGFwcGxpZWRcbiAqIHRvIGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICovIGNsYXNzIEFwcGxpYWJsZUNvbnN0cmFpbnQge31cblxuLyoqXG4gKiBBIGBRdWVyeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5IGFcbiAqIEZpcmVzdG9yZSBxdWVyeS4gYFF1ZXJ5Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayB3aGVyZX0sXG4gKiB7QGxpbmsgb3JkZXJCeX0sIHtAbGluayAoc3RhcnRBdDoxKX0sIHtAbGluayAoc3RhcnRBZnRlcjoxKX0sIHtAbGlua1xuICogKGVuZEJlZm9yZToxKX0sIHtAbGluayAoZW5kQXQ6MSl9LCB7QGxpbmsgbGltaXR9LCB7QGxpbmsgbGltaXRUb0xhc3R9IGFuZFxuICogY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeSBpbnN0YW5jZSB0aGF0XG4gKiBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlDb25zdHJhaW50IGV4dGVuZHMgQXBwbGlhYmxlQ29uc3RyYWludCB7fVxuXG5mdW5jdGlvbiBxdWVyeShlLCB0LCAuLi5uKSB7XG4gICAgbGV0IHIgPSBbXTtcbiAgICB0IGluc3RhbmNlb2YgQXBwbGlhYmxlQ29uc3RyYWludCAmJiByLnB1c2godCksIHIgPSByLmNvbmNhdChuKSwgZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlUXVlcnlDb25zdHJhaW50QXJyYXkoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5maWx0ZXIoKGUgPT4gZSBpbnN0YW5jZW9mIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCkpLmxlbmd0aCwgbiA9IGUuZmlsdGVyKChlID0+IGUgaW5zdGFuY2VvZiBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludCkpLmxlbmd0aDtcbiAgICAgICAgaWYgKHQgPiAxIHx8IHQgPiAwICYmIG4gPiAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWRRdWVyeS4gV2hlbiB1c2luZyBjb21wb3NpdGUgZmlsdGVycywgeW91IGNhbm5vdCB1c2UgbW9yZSB0aGFuIG9uZSBmaWx0ZXIgYXQgdGhlIHRvcCBsZXZlbC4gQ29uc2lkZXIgbmVzdGluZyB0aGUgbXVsdGlwbGUgZmlsdGVycyB3aXRoaW4gYW4gYGFuZCguLi4pYCBzdGF0ZW1lbnQuIEZvciBleGFtcGxlOiBjaGFuZ2UgYHF1ZXJ5KHF1ZXJ5LCB3aGVyZSguLi4pLCBvciguLi4pKWAgdG8gYHF1ZXJ5KHF1ZXJ5LCBhbmQod2hlcmUoLi4uKSwgb3IoLi4uKSkpYC5cIik7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBDb252ZXJ0cyBGaXJlc3RvcmUncyBpbnRlcm5hbCB0eXBlcyB0byB0aGUgSmF2YVNjcmlwdCB0eXBlcyB0aGF0IHdlIGV4cG9zZVxuICogdG8gdGhlIHVzZXIuXG4gKlxuICogQGludGVybmFsXG4gKi8gKHIpO1xuICAgIGZvciAoY29uc3QgdCBvZiByKSBlID0gdC5fYXBwbHkoZSk7XG4gICAgcmV0dXJuIGU7XG59XG5cbi8qKlxuICogQSBgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5XG4gKiBhIEZpcmVzdG9yZSBxdWVyeSBieSBmaWx0ZXJpbmcgb24gb25lIG9yIG1vcmUgZG9jdW1lbnQgZmllbGRzLlxuICogYFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIHdoZXJlfSBhbmQgY2FuIHRoZW5cbiAqIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYSBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zXG4gKiB0aGlzIGBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5fZmllbGQgPSBlLCB0aGlzLl9vcCA9IHQsIHRoaXMuX3ZhbHVlID0gbiwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJ3aGVyZVwiO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQoZSwgdCwgbik7XG4gICAgfVxuICAgIF9hcHBseShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLl9wYXJzZShlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKGUuX3F1ZXJ5LCB0KSwgbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkRmlsdGVyKGUuX3F1ZXJ5LCB0KSk7XG4gICAgfVxuICAgIF9wYXJzZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZS5maXJlc3RvcmUpLCBuID0gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5RmlsdGVyKGUsIHQsIG4sIHIsIGksIHMsIG8pIHtcbiAgICAgICAgICAgIGxldCBfO1xuICAgICAgICAgICAgaWYgKGkuaXNLZXlGaWVsZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gcyB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gcykgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgUXVlcnkuIFlvdSBjYW4ndCBwZXJmb3JtICcke3N9JyBxdWVyaWVzIG9uIGRvY3VtZW50SWQoKS5gKTtcbiAgICAgICAgICAgICAgICBpZiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSBzIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSBzKSB7XG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV92YWxpZGF0ZURpc2p1bmN0aXZlRmlsdGVyRWxlbWVudHMobywgcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIG8pIHQucHVzaChfX1BSSVZBVEVfcGFyc2VEb2N1bWVudElkVmFsdWUociwgZSwgbikpO1xuICAgICAgICAgICAgICAgICAgICBfID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogdFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBfID0gX19QUklWQVRFX3BhcnNlRG9jdW1lbnRJZFZhbHVlKHIsIGUsIG8pO1xuICAgICAgICAgICAgfSBlbHNlIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAhPT0gcyAmJiBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAhPT0gcyAmJiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyAhPT0gcyB8fCBfX1BSSVZBVEVfdmFsaWRhdGVEaXNqdW5jdGl2ZUZpbHRlckVsZW1lbnRzKG8sIHMpLCBcbiAgICAgICAgICAgIF8gPSBfX1BSSVZBVEVfcGFyc2VRdWVyeVZhbHVlKG4sIHQsIG8sIFxuICAgICAgICAgICAgLyogYWxsb3dBcnJheXM9ICovIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gcyB8fCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gcyk7XG4gICAgICAgICAgICByZXR1cm4gRmllbGRGaWx0ZXIuY3JlYXRlKGksIHMsIF8pO1xuICAgICAgICB9KGUuX3F1ZXJ5LCBcIndoZXJlXCIsIHQsIGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCB0aGlzLl9maWVsZCwgdGhpcy5fb3AsIHRoaXMuX3ZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9IHRoYXQgZW5mb3JjZXMgdGhhdCBkb2N1bWVudHNcbiAqIG11c3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIGFuZCB0aGF0IHRoZSB2YWx1ZSBzaG91bGQgc2F0aXNmeSB0aGVcbiAqIHJlbGF0aW9uIGNvbnN0cmFpbnQgcHJvdmlkZWQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIHRvIGNvbXBhcmVcbiAqIEBwYXJhbSBvcFN0ciAtIFRoZSBvcGVyYXRpb24gc3RyaW5nIChlLmcgXCImbHQ7XCIsIFwiJmx0Oz1cIiwgXCI9PVwiLCBcIiZsdDtcIixcbiAqICAgXCImbHQ7PVwiLCBcIiE9XCIpLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIGZvciBjb21wYXJpc29uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIHdoZXJlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gdCwgaSA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJ3aGVyZVwiLCBlKTtcbiAgICByZXR1cm4gUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShpLCByLCBuKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzXG4gKiByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBxdWVyeSBieSBwZXJmb3JtaW5nIHRoZSBsb2dpY2FsIE9SIG9yIEFORCBvZiBtdWx0aXBsZVxuICoge0BsaW5rIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50fXMgb3Ige0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH1zLlxuICogYFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayBvcn0gb3JcbiAqIHtAbGluayBhbmR9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5XG4gKiBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhlIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCBleHRlbmRzIEFwcGxpYWJsZUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX3F1ZXJ5Q29uc3RyYWludHMgPSB0O1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50KGUsIHQpO1xuICAgIH1cbiAgICBfcGFyc2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5fcXVlcnlDb25zdHJhaW50cy5tYXAoKHQgPT4gdC5fcGFyc2UoZSkpKS5maWx0ZXIoKGUgPT4gZS5nZXRGaWx0ZXJzKCkubGVuZ3RoID4gMCkpO1xuICAgICAgICByZXR1cm4gMSA9PT0gdC5sZW5ndGggPyB0WzBdIDogQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZSh0LCB0aGlzLl9nZXRPcGVyYXRvcigpKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuX3BhcnNlKGUpO1xuICAgICAgICByZXR1cm4gMCA9PT0gdC5nZXRGaWx0ZXJzKCkubGVuZ3RoID8gZSA6IChmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVOZXdGaWx0ZXIoZSwgdCkge1xuICAgICAgICAgICAgbGV0IG4gPSBlO1xuICAgICAgICAgICAgY29uc3QgciA9IHQuZ2V0RmxhdHRlbmVkRmlsdGVycygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKG4sIGUpLCBuID0gX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkRmlsdGVyKG4sIGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrcyBpZiBhbnkgb2YgdGhlIHByb3ZpZGVkIGZpbHRlciBvcGVyYXRvcnMgYXJlIGluY2x1ZGVkIGluIHRoZSBnaXZlbiBsaXN0IG9mIGZpbHRlcnMgYW5kXG4gICAgICAgIC8vIHJldHVybnMgdGhlIGZpcnN0IG9uZSB0aGF0IGlzLCBvciBudWxsIGlmIG5vbmUgYXJlLlxuICAgICAgICAoZS5fcXVlcnksIHQpLCBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBfX1BSSVZBVEVfcXVlcnlXaXRoQWRkZWRGaWx0ZXIoZS5fcXVlcnksIHQpKSk7XG4gICAgfVxuICAgIF9nZXRRdWVyeUNvbnN0cmFpbnRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnlDb25zdHJhaW50cztcbiAgICB9XG4gICAgX2dldE9wZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gXCJhbmRcIiA9PT0gdGhpcy50eXBlID8gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8gOiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi87XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0gdGhhdCBpcyBhIGRpc2p1bmN0aW9uIG9mXG4gKiB0aGUgZ2l2ZW4gZmlsdGVyIGNvbnN0cmFpbnRzLiBBIGRpc2p1bmN0aW9uIGZpbHRlciBpbmNsdWRlcyBhIGRvY3VtZW50IGlmIGl0XG4gKiBzYXRpc2ZpZXMgYW55IG9mIHRoZSBnaXZlbiBmaWx0ZXJzLlxuICpcbiAqIEBwYXJhbSBxdWVyeUNvbnN0cmFpbnRzIC0gT3B0aW9uYWwuIFRoZSBsaXN0IG9mXG4gKiB7QGxpbmsgUXVlcnlGaWx0ZXJDb25zdHJhaW50fXMgdG8gcGVyZm9ybSBhIGRpc2p1bmN0aW9uIGZvci4gVGhlc2UgbXVzdCBiZVxuICogY3JlYXRlZCB3aXRoIGNhbGxzIHRvIHtAbGluayB3aGVyZX0sIHtAbGluayBvcn0sIG9yIHtAbGluayBhbmR9LlxuICogQHJldHVybnMgVGhlIG5ld2x5IGNyZWF0ZWQge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gb3IoLi4uZSkge1xuICAgIC8vIE9ubHkgc3VwcG9ydCBRdWVyeUZpbHRlckNvbnN0cmFpbnRzXG4gICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiBfX1BSSVZBVEVfdmFsaWRhdGVRdWVyeUZpbHRlckNvbnN0cmFpbnQoXCJvclwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gLCBlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9IHRoYXQgaXMgYSBjb25qdW5jdGlvbiBvZlxuICogdGhlIGdpdmVuIGZpbHRlciBjb25zdHJhaW50cy4gQSBjb25qdW5jdGlvbiBmaWx0ZXIgaW5jbHVkZXMgYSBkb2N1bWVudCBpZiBpdFxuICogc2F0aXNmaWVzIGFsbCBvZiB0aGUgZ2l2ZW4gZmlsdGVycy5cbiAqXG4gKiBAcGFyYW0gcXVlcnlDb25zdHJhaW50cyAtIE9wdGlvbmFsLiBUaGUgbGlzdCBvZlxuICoge0BsaW5rIFF1ZXJ5RmlsdGVyQ29uc3RyYWludH1zIHRvIHBlcmZvcm0gYSBjb25qdW5jdGlvbiBmb3IuIFRoZXNlIG11c3QgYmVcbiAqIGNyZWF0ZWQgd2l0aCBjYWxscyB0byB7QGxpbmsgd2hlcmV9LCB7QGxpbmsgb3J9LCBvciB7QGxpbmsgYW5kfS5cbiAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGFuZCguLi5lKSB7XG4gICAgLy8gT25seSBzdXBwb3J0IFF1ZXJ5RmlsdGVyQ29uc3RyYWludHNcbiAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5RmlsdGVyQ29uc3RyYWludChcImFuZFwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyAsIGUpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gc29ydCB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieSBhXG4gKiBGaXJlc3RvcmUgcXVlcnkuIGBRdWVyeU9yZGVyQnlDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmdcbiAqIHtAbGluayBvcmRlckJ5fSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeVxuICogaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgLlxuICpcbiAqIE5vdGU6IERvY3VtZW50cyB0aGF0IGRvIG5vdCBjb250YWluIHRoZSBvcmRlckJ5IGZpZWxkIHdpbGwgbm90IGJlIHByZXNlbnQgaW5cbiAqIHRoZSBxdWVyeSByZXN1bHQuXG4gKi8gY2xhc3MgUXVlcnlPcmRlckJ5Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLl9maWVsZCA9IGUsIHRoaXMuX2RpcmVjdGlvbiA9IHQsIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwib3JkZXJCeVwiO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlPcmRlckJ5Q29uc3RyYWludChlLCB0KTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeU9yZGVyQnkoZSwgdCwgbikge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUuc3RhcnRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBzdGFydEF0KCkgb3Igc3RhcnRBZnRlcigpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZS5lbmRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBlbmRBdCgpIG9yIGVuZEJlZm9yZSgpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBjb25zdCByID0gbmV3IE9yZGVyQnkodCwgbik7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlTmV3T3JkZXJCeShlLCB0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IF9fUFJJVkFURV9nZXRGaXJzdE9yZGVyQnlGaWVsZChlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCBvcmRlciBieS4gSXQgbXVzdCBtYXRjaCBhbnkgaW5lcXVhbGl0eS5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9nZXRJbmVxdWFsaXR5RmlsdGVyRmllbGQoZSk7XG4gICAgICAgICAgICAgICAgICAgIG51bGwgIT09IG4gJiYgX19QUklWQVRFX3ZhbGlkYXRlT3JkZXJCeUFuZEluZXF1YWxpdHlNYXRjaChlLCBuLCB0LmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KGUsIHIpLCByO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQ3JlYXRlIGEgYEJvdW5kYCBmcm9tIGEgcXVlcnkgYW5kIGEgZG9jdW1lbnQuXG4gKlxuICogTm90ZSB0aGF0IHRoZSBgQm91bmRgIHdpbGwgYWx3YXlzIGluY2x1ZGUgdGhlIGtleSBvZiB0aGUgZG9jdW1lbnRcbiAqIGFuZCBzbyBvbmx5IHRoZSBwcm92aWRlZCBkb2N1bWVudCB3aWxsIGNvbXBhcmUgZXF1YWwgdG8gdGhlIHJldHVybmVkXG4gKiBwb3NpdGlvbi5cbiAqXG4gKiBXaWxsIHRocm93IGlmIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBjb250YWluIGFsbCBmaWVsZHMgb2YgdGhlIG9yZGVyIGJ5XG4gKiBvZiB0aGUgcXVlcnkgb3IgaWYgYW55IG9mIHRoZSBmaWVsZHMgaW4gdGhlIG9yZGVyIGJ5IGFyZSBhbiB1bmNvbW1pdHRlZFxuICogc2VydmVyIHRpbWVzdGFtcC5cbiAqLyAoZS5fcXVlcnksIHRoaXMuX2ZpZWxkLCB0aGlzLl9kaXJlY3Rpb24pO1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkT3JkZXJCeShlLCB0KSB7XG4gICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IHZhbGlkYXRlIHRoYXQgb3JkZXJCeSBkb2VzIG5vdCBsaXN0IHRoZSBzYW1lIGtleSB0d2ljZS5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmV4cGxpY2l0T3JkZXJCeS5jb25jYXQoWyB0IF0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIG4sIGUuZmlsdGVycy5zbGljZSgpLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgZS5zdGFydEF0LCBlLmVuZEF0KTtcbiAgICAgICAgfShlLl9xdWVyeSwgdCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnR9IHRoYXQgc29ydHMgdGhlIHF1ZXJ5IHJlc3VsdCBieSB0aGVcbiAqIHNwZWNpZmllZCBmaWVsZCwgb3B0aW9uYWxseSBpbiBkZXNjZW5kaW5nIG9yZGVyIGluc3RlYWQgb2YgYXNjZW5kaW5nLlxuICpcbiAqIE5vdGU6IERvY3VtZW50cyB0aGF0IGRvIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgZmllbGQgd2lsbCBub3QgYmUgcHJlc2VudFxuICogaW4gdGhlIHF1ZXJ5IHJlc3VsdC5cbiAqXG4gKiBAcGFyYW0gZmllbGRQYXRoIC0gVGhlIGZpZWxkIHRvIHNvcnQgYnkuXG4gKiBAcGFyYW0gZGlyZWN0aW9uU3RyIC0gT3B0aW9uYWwgZGlyZWN0aW9uIHRvIHNvcnQgYnkgKCdhc2MnIG9yICdkZXNjJykuIElmXG4gKiBub3Qgc3BlY2lmaWVkLCBvcmRlciB3aWxsIGJlIGFzY2VuZGluZy5cbiAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHtAbGluayBRdWVyeU9yZGVyQnlDb25zdHJhaW50fS5cbiAqLyBmdW5jdGlvbiBvcmRlckJ5KGUsIHQgPSBcImFzY1wiKSB7XG4gICAgY29uc3QgbiA9IHQsIHIgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50KFwib3JkZXJCeVwiLCBlKTtcbiAgICByZXR1cm4gUXVlcnlPcmRlckJ5Q29uc3RyYWludC5fY3JlYXRlKHIsIG4pO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5TGltaXRDb25zdHJhaW50YCBpcyB1c2VkIHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5XG4gKiBhIEZpcmVzdG9yZSBxdWVyeS5cbiAqIGBRdWVyeUxpbWl0Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayBsaW1pdH0gb3JcbiAqIHtAbGluayBsaW1pdFRvTGFzdH0gYW5kIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYSBuZXdcbiAqIHF1ZXJ5IGluc3RhbmNlIHRoYXQgYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeUxpbWl0Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlMaW1pdENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX2xpbWl0ID0gdCwgdGhpcy5fbGltaXRUeXBlID0gbjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5TGltaXRDb25zdHJhaW50KGUsIHQsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgX19QUklWQVRFX3F1ZXJ5V2l0aExpbWl0KGUuX3F1ZXJ5LCB0aGlzLl9saW1pdCwgdGhpcy5fbGltaXRUeXBlKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9IHRoYXQgb25seSByZXR1cm5zIHRoZSBmaXJzdCBtYXRjaGluZ1xuICogZG9jdW1lbnRzLlxuICpcbiAqIEBwYXJhbSBsaW1pdCAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyB0byByZXR1cm4uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGxpbWl0KGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlUG9zaXRpdmVOdW1iZXIoXCJsaW1pdFwiLCBlKSwgUXVlcnlMaW1pdENvbnN0cmFpbnQuX2NyZWF0ZShcImxpbWl0XCIsIGUsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBRdWVyeUxpbWl0Q29uc3RyYWludH0gdGhhdCBvbmx5IHJldHVybnMgdGhlIGxhc3QgbWF0Y2hpbmdcbiAqIGRvY3VtZW50cy5cbiAqXG4gKiBZb3UgbXVzdCBzcGVjaWZ5IGF0IGxlYXN0IG9uZSBgb3JkZXJCeWAgY2xhdXNlIGZvciBgbGltaXRUb0xhc3RgIHF1ZXJpZXMsXG4gKiBvdGhlcndpc2UgYW4gZXhjZXB0aW9uIHdpbGwgYmUgdGhyb3duIGR1cmluZyBleGVjdXRpb24uXG4gKlxuICogQHBhcmFtIGxpbWl0IC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHRvIHJldHVybi5cbiAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHtAbGluayBRdWVyeUxpbWl0Q29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gbGltaXRUb0xhc3QoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVQb3NpdGl2ZU51bWJlcihcImxpbWl0VG9MYXN0XCIsIGUpLCBRdWVyeUxpbWl0Q29uc3RyYWludC5fY3JlYXRlKFwibGltaXRUb0xhc3RcIiwgZSwgXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8pO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnRgIGlzIHVzZWQgdG8gZXhjbHVkZSBkb2N1bWVudHMgZnJvbSB0aGUgc3RhcnQgb2YgYVxuICogcmVzdWx0IHNldCByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBxdWVyeS5cbiAqIGBRdWVyeVN0YXJ0QXRDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIChzdGFydEF0OjEpfSBvclxuICoge0BsaW5rIChzdGFydEFmdGVyOjEpfSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhXG4gKiBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX2RvY09yRmllbGRzID0gdCwgdGhpcy5faW5jbHVzaXZlID0gbjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQoZSwgdCwgbik7XG4gICAgfVxuICAgIF9hcHBseShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3UXVlcnlCb3VuZEZyb21Eb2NPckZpZWxkcyhlLCB0aGlzLnR5cGUsIHRoaXMuX2RvY09yRmllbGRzLCB0aGlzLl9pbmNsdXNpdmUpO1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5V2l0aFN0YXJ0QXQoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgdCwgZS5lbmRBdCk7XG4gICAgICAgIH0oZS5fcXVlcnksIHQpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHN0YXJ0QXQoLi4uZSkge1xuICAgIHJldHVybiBRdWVyeVN0YXJ0QXRDb25zdHJhaW50Ll9jcmVhdGUoXCJzdGFydEF0XCIsIGUsIFxuICAgIC8qaW5jbHVzaXZlPSovICEwKTtcbn1cblxuZnVuY3Rpb24gc3RhcnRBZnRlciguLi5lKSB7XG4gICAgcmV0dXJuIFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQuX2NyZWF0ZShcInN0YXJ0QWZ0ZXJcIiwgZSwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITEpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RW5kQXRDb25zdHJhaW50YCBpcyB1c2VkIHRvIGV4Y2x1ZGUgZG9jdW1lbnRzIGZyb20gdGhlIGVuZCBvZiBhXG4gKiByZXN1bHQgc2V0IHJldHVybmVkIGJ5IGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICogYFF1ZXJ5RW5kQXRDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIChlbmRBdDoxKX0gb3JcbiAqIHtAbGluayAoZW5kQmVmb3JlOjEpfSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ld1xuICogcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5RW5kQXRDb25zdHJhaW50YC5cbiAqLyBjbGFzcyBRdWVyeUVuZEF0Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgcXVlcnkgY29uc3RyYWludCAqL1xuICAgIGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy50eXBlID0gZSwgdGhpcy5fZG9jT3JGaWVsZHMgPSB0LCB0aGlzLl9pbmNsdXNpdmUgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlFbmRBdENvbnN0cmFpbnQoZSwgdCwgbik7XG4gICAgfVxuICAgIF9hcHBseShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3UXVlcnlCb3VuZEZyb21Eb2NPckZpZWxkcyhlLCB0aGlzLnR5cGUsIHRoaXMuX2RvY09yRmllbGRzLCB0aGlzLl9pbmNsdXNpdmUpO1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5V2l0aEVuZEF0KGUsIHQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBlLmV4cGxpY2l0T3JkZXJCeS5zbGljZSgpLCBlLmZpbHRlcnMuc2xpY2UoKSwgZS5saW1pdCwgZS5saW1pdFR5cGUsIGUuc3RhcnRBdCwgdCk7XG4gICAgICAgIH0oZS5fcXVlcnksIHQpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGVuZEJlZm9yZSguLi5lKSB7XG4gICAgcmV0dXJuIFF1ZXJ5RW5kQXRDb25zdHJhaW50Ll9jcmVhdGUoXCJlbmRCZWZvcmVcIiwgZSwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITEpO1xufVxuXG5mdW5jdGlvbiBlbmRBdCguLi5lKSB7XG4gICAgcmV0dXJuIFF1ZXJ5RW5kQXRDb25zdHJhaW50Ll9jcmVhdGUoXCJlbmRBdFwiLCBlLCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMCk7XG59XG5cbi8qKiBIZWxwZXIgZnVuY3Rpb24gdG8gY3JlYXRlIGEgYm91bmQgZnJvbSBhIGRvY3VtZW50IG9yIGZpZWxkcyAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlCb3VuZEZyb21Eb2NPckZpZWxkcyhlLCB0LCBuLCByKSB7XG4gICAgaWYgKG5bMF0gPSBnZXRNb2R1bGFySW5zdGFuY2UoblswXSksIG5bMF0gaW5zdGFuY2VvZiBEb2N1bWVudFNuYXBzaG90JDEpIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlCb3VuZEZyb21Eb2N1bWVudChlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGlmICghcikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuTk9UX0ZPVU5ELCBgQ2FuJ3QgdXNlIGEgRG9jdW1lbnRTbmFwc2hvdCB0aGF0IGRvZXNuJ3QgZXhpc3QgZm9yICR7bn0oKS5gKTtcbiAgICAgICAgY29uc3QgcyA9IFtdO1xuICAgICAgICAvLyBCZWNhdXNlIHBlb3BsZSBleHBlY3QgdG8gY29udGludWUvZW5kIGEgcXVlcnkgYXQgdGhlIGV4YWN0IGRvY3VtZW50XG4gICAgICAgIC8vIHByb3ZpZGVkLCB3ZSBuZWVkIHRvIHVzZSB0aGUgaW1wbGljaXQgc29ydCBvcmRlciByYXRoZXIgdGhhbiB0aGUgZXhwbGljaXRcbiAgICAgICAgLy8gc29ydCBvcmRlciwgYmVjYXVzZSBpdCdzIGd1YXJhbnRlZWQgdG8gY29udGFpbiB0aGUgZG9jdW1lbnQga2V5LiBUaGF0IHdheVxuICAgICAgICAvLyB0aGUgcG9zaXRpb24gYmVjb21lcyB1bmFtYmlndW91cyBhbmQgdGhlIHF1ZXJ5IGNvbnRpbnVlcy9lbmRzIGV4YWN0bHkgYXRcbiAgICAgICAgLy8gdGhlIHByb3ZpZGVkIGRvY3VtZW50LiBXaXRob3V0IHRoZSBrZXkgKGJ5IHVzaW5nIHRoZSBleHBsaWNpdCBzb3J0XG4gICAgICAgIC8vIG9yZGVycyksIG11bHRpcGxlIGRvY3VtZW50cyBjb3VsZCBtYXRjaCB0aGUgcG9zaXRpb24sIHlpZWxkaW5nIGR1cGxpY2F0ZVxuICAgICAgICAvLyByZXN1bHRzLlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBfX1BSSVZBVEVfcXVlcnlPcmRlckJ5KGUpKSBpZiAobi5maWVsZC5pc0tleUZpZWxkKCkpIHMucHVzaChfX1BSSVZBVEVfcmVmVmFsdWUodCwgci5rZXkpKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gci5kYXRhLmZpZWxkKG4uZmllbGQpO1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcChlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgJ0ludmFsaWQgcXVlcnkuIFlvdSBhcmUgdHJ5aW5nIHRvIHN0YXJ0IG9yIGVuZCBhIHF1ZXJ5IHVzaW5nIGEgZG9jdW1lbnQgZm9yIHdoaWNoIHRoZSBmaWVsZCBcIicgKyBuLmZpZWxkICsgJ1wiIGlzIGFuIHVuY29tbWl0dGVkIHNlcnZlciB0aW1lc3RhbXAuIChTaW5jZSB0aGUgdmFsdWUgb2YgdGhpcyBmaWVsZCBpcyB1bmtub3duLCB5b3UgY2Fubm90IHN0YXJ0L2VuZCBhIHF1ZXJ5IHdpdGggaXQuKScpO1xuICAgICAgICAgICAgaWYgKG51bGwgPT09IGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbi5maWVsZC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGFyZSB0cnlpbmcgdG8gc3RhcnQgb3IgZW5kIGEgcXVlcnkgdXNpbmcgYSBkb2N1bWVudCBmb3Igd2hpY2ggdGhlIGZpZWxkICcke2V9JyAodXNlZCBhcyB0aGUgb3JkZXJCeSkgZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzLnB1c2goZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChzLCBpKTtcbiAgICB9XG4gICAgLyoqXG4gKiBDb252ZXJ0cyBhIGxpc3Qgb2YgZmllbGQgdmFsdWVzIHRvIGEgYEJvdW5kYCBmb3IgdGhlIGdpdmVuIHF1ZXJ5LlxuICovIChlLl9xdWVyeSwgZS5maXJlc3RvcmUuX2RhdGFiYXNlSWQsIHQsIG5bMF0uX2RvY3VtZW50LCByKTtcbiAgICB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZS5maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRmllbGRzKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgICAgIC8vIFVzZSBleHBsaWNpdCBvcmRlciBieSdzIGJlY2F1c2UgaXQgaGFzIHRvIG1hdGNoIHRoZSBxdWVyeSB0aGUgdXNlciBtYWRlXG4gICAgICAgICAgICBjb25zdCBvID0gZS5leHBsaWNpdE9yZGVyQnk7XG4gICAgICAgICAgICBpZiAoaS5sZW5ndGggPiBvLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYFRvbyBtYW55IGFyZ3VtZW50cyBwcm92aWRlZCB0byAke3J9KCkuIFRoZSBudW1iZXIgb2YgYXJndW1lbnRzIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3JkZXJCeSgpIGNsYXVzZXNgKTtcbiAgICAgICAgICAgIGNvbnN0IF8gPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBpW3NdO1xuICAgICAgICAgICAgICAgIGlmIChvW3NdLmZpZWxkLmlzS2V5RmllbGQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgYSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIEV4cGVjdGVkIGEgc3RyaW5nIGZvciBkb2N1bWVudCBJRCBpbiAke3J9KCksIGJ1dCBnb3QgYSAke3R5cGVvZiBhfWApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9pc0NvbGxlY3Rpb25Hcm91cFF1ZXJ5KGUpICYmIC0xICE9PSBhLmluZGV4T2YoXCIvXCIpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyBhIGNvbGxlY3Rpb24gYW5kIG9yZGVyaW5nIGJ5IGRvY3VtZW50SWQoKSwgdGhlIHZhbHVlIHBhc3NlZCB0byAke3J9KCkgbXVzdCBiZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7YX0nIGNvbnRhaW5zIGEgc2xhc2guYCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLnBhdGguY2hpbGQoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoYSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIURvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkobikpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBncm91cCBhbmQgb3JkZXJpbmcgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcGFzc2VkIHRvICR7cn0oKSBtdXN0IHJlc3VsdCBpbiBhIHZhbGlkIGRvY3VtZW50IHBhdGgsIGJ1dCAnJHtufScgaXMgbm90IGJlY2F1c2UgaXQgY29udGFpbnMgYW4gb2RkIG51bWJlciBvZiBzZWdtZW50cy5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBEb2N1bWVudEtleShuKTtcbiAgICAgICAgICAgICAgICAgICAgXy5wdXNoKF9fUFJJVkFURV9yZWZWYWx1ZSh0LCBpKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9wYXJzZVF1ZXJ5VmFsdWUobiwgciwgYSk7XG4gICAgICAgICAgICAgICAgICAgIF8ucHVzaChlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEJvdW5kKF8sIHMpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUGFyc2VzIHRoZSBnaXZlbiBgZG9jdW1lbnRJZFZhbHVlYCBpbnRvIGEgYFJlZmVyZW5jZVZhbHVlYCwgdGhyb3dpbmdcbiAqIGFwcHJvcHJpYXRlIGVycm9ycyBpZiB0aGUgdmFsdWUgaXMgYW55dGhpbmcgb3RoZXIgdGhhbiBhIGBEb2N1bWVudFJlZmVyZW5jZWBcbiAqIG9yIGBzdHJpbmdgLCBvciBpZiB0aGUgc3RyaW5nIGlzIG1hbGZvcm1lZC5cbiAqLyAoZS5fcXVlcnksIGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCBpLCB0LCBuLCByKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZURvY3VtZW50SWRWYWx1ZShlLCB0LCBuKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIChuID0gZ2V0TW9kdWxhckluc3RhbmNlKG4pKSkge1xuICAgICAgICBpZiAoXCJcIiA9PT0gbikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIHdpdGggZG9jdW1lbnRJZCgpLCB5b3UgbXVzdCBwcm92aWRlIGEgdmFsaWQgZG9jdW1lbnQgSUQsIGJ1dCBpdCB3YXMgYW4gZW1wdHkgc3RyaW5nLlwiKTtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeSh0KSAmJiAtMSAhPT0gbi5pbmRleE9mKFwiL1wiKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGJ5IGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7bn0nIGNvbnRhaW5zIGEgJy8nIGNoYXJhY3Rlci5gKTtcbiAgICAgICAgY29uc3QgciA9IHQucGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhuKSk7XG4gICAgICAgIGlmICghRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShyKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGdyb3VwIGJ5IGRvY3VtZW50SWQoKSwgdGhlIHZhbHVlIHByb3ZpZGVkIG11c3QgcmVzdWx0IGluIGEgdmFsaWQgZG9jdW1lbnQgcGF0aCwgYnV0ICcke3J9JyBpcyBub3QgYmVjYXVzZSBpdCBoYXMgYW4gb2RkIG51bWJlciBvZiBzZWdtZW50cyAoJHtyLmxlbmd0aH0pLmApO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlZlZhbHVlKGUsIG5ldyBEb2N1bWVudEtleShyKSk7XG4gICAgfVxuICAgIGlmIChuIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHJldHVybiBfX1BSSVZBVEVfcmVmVmFsdWUoZSwgbi5fa2V5KTtcbiAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyB3aXRoIGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHZhbGlkIHN0cmluZyBvciBhIERvY3VtZW50UmVmZXJlbmNlLCBidXQgaXQgd2FzOiAke19fUFJJVkFURV92YWx1ZURlc2NyaXB0aW9uKG4pfS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCB0aGUgdmFsdWUgcGFzc2VkIGludG8gYSBkaXNqdW5jdGl2ZSBmaWx0ZXIgc2F0aXNmaWVzIGFsbFxuICogYXJyYXkgcmVxdWlyZW1lbnRzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZURpc2p1bmN0aXZlRmlsdGVyRWxlbWVudHMoZSwgdCkge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShlKSB8fCAwID09PSBlLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgUXVlcnkuIEEgbm9uLWVtcHR5IGFycmF5IGlzIHJlcXVpcmVkIGZvciAnJHt0LnRvU3RyaW5nKCl9JyBmaWx0ZXJzLmApO1xufVxuXG4vKipcbiAqIEdpdmVuIGFuIG9wZXJhdG9yLCByZXR1cm5zIHRoZSBzZXQgb2Ygb3BlcmF0b3JzIHRoYXQgY2Fubm90IGJlIHVzZWQgd2l0aCBpdC5cbiAqXG4gKiBUaGlzIGlzIG5vdCBhIGNvbXByZWhlbnNpdmUgY2hlY2ssIGFuZCB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSByZW1vdmVkIGluIHRoZVxuICogbG9uZyB0ZXJtLiBWYWxpZGF0aW9ucyBzaG91bGQgb2NjdXIgaW4gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLlxuICpcbiAqIE9wZXJhdG9ycyBpbiBhIHF1ZXJ5IG11c3QgYWRoZXJlIHRvIHRoZSBmb2xsb3dpbmcgc2V0IG9mIHJ1bGVzOlxuICogMS4gT25seSBvbmUgaW5lcXVhbGl0eSBwZXIgcXVlcnkuXG4gKiAyLiBgTk9UX0lOYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFycmF5LCBkaXNqdW5jdGl2ZSwgb3IgYE5PVF9FUVVBTGAgb3BlcmF0b3JzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKGUsIHQpIHtcbiAgICBpZiAodC5pc0luZXF1YWxpdHkoKSkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2dldEluZXF1YWxpdHlGaWx0ZXJGaWVsZChlKSwgciA9IHQuZmllbGQ7XG4gICAgICAgIGlmIChudWxsICE9PSBuICYmICFuLmlzRXF1YWwocikpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBBbGwgd2hlcmUgZmlsdGVycyB3aXRoIGFuIGluZXF1YWxpdHkgKDwsIDw9LCAhPSwgbm90LWluLCA+LCBvciA+PSkgbXVzdCBiZSBvbiB0aGUgc2FtZSBmaWVsZC4gQnV0IHlvdSBoYXZlIGluZXF1YWxpdHkgZmlsdGVycyBvbiAnJHtuLnRvU3RyaW5nKCl9JyBhbmQgJyR7ci50b1N0cmluZygpfSdgKTtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9nZXRGaXJzdE9yZGVyQnlGaWVsZChlKTtcbiAgICAgICAgbnVsbCAhPT0gaSAmJiBfX1BSSVZBVEVfdmFsaWRhdGVPcmRlckJ5QW5kSW5lcXVhbGl0eU1hdGNoKGUsIHIsIGkpO1xuICAgIH1cbiAgICBjb25zdCBuID0gZnVuY3Rpb24gX19QUklWQVRFX2ZpbmRPcEluc2lkZUZpbHRlcnMoZSwgdCkge1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkgZm9yIChjb25zdCBlIG9mIG4uZ2V0RmxhdHRlbmVkRmlsdGVycygpKSBpZiAodC5pbmRleE9mKGUub3ApID49IDApIHJldHVybiBlLm9wO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9KGUuZmlsdGVycywgZnVuY3Rpb24gX19QUklWQVRFX2NvbmZsaWN0aW5nT3BzKGUpIHtcbiAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiBbIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyBdO1xuXG4gICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXTtcblxuICAgICAgICAgIGNhc2UgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gXTtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9KHQub3ApKTtcbiAgICBpZiAobnVsbCAhPT0gbikgXG4gICAgLy8gU3BlY2lhbCBjYXNlIHdoZW4gaXQncyBhIGR1cGxpY2F0ZSBvcCB0byBnaXZlIGEgc2xpZ2h0bHkgY2xlYXJlciBlcnJvciBtZXNzYWdlLlxuICAgIHRocm93IG4gPT09IHQub3AgPyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgbW9yZSB0aGFuIG9uZSAnJHt0Lm9wLnRvU3RyaW5nKCl9JyBmaWx0ZXIuYCkgOiBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgJyR7dC5vcC50b1N0cmluZygpfScgZmlsdGVycyB3aXRoICcke24udG9TdHJpbmcoKX0nIGZpbHRlcnMuYCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZU9yZGVyQnlBbmRJbmVxdWFsaXR5TWF0Y2goZSwgdCwgbikge1xuICAgIGlmICghbi5pc0VxdWFsKHQpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGhhdmUgYSB3aGVyZSBmaWx0ZXIgd2l0aCBhbiBpbmVxdWFsaXR5ICg8LCA8PSwgIT0sIG5vdC1pbiwgPiwgb3IgPj0pIG9uIGZpZWxkICcke3QudG9TdHJpbmcoKX0nIGFuZCBzbyB5b3UgbXVzdCBhbHNvIHVzZSAnJHt0LnRvU3RyaW5nKCl9JyBhcyB5b3VyIGZpcnN0IGFyZ3VtZW50IHRvIG9yZGVyQnkoKSwgYnV0IHlvdXIgZmlyc3Qgb3JkZXJCeSgpIGlzIG9uIGZpZWxkICcke24udG9TdHJpbmcoKX0nIGluc3RlYWQuYCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5RmlsdGVyQ29uc3RyYWludChlLCB0KSB7XG4gICAgaWYgKCEodCBpbnN0YW5jZW9mIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50IHx8IHQgaW5zdGFuY2VvZiBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHtlfSgpIHJlcXVpcmVzIEFwcGxpYWJsZUNvbnN0cmFpbnRzIGNyZWF0ZWQgd2l0aCBhIGNhbGwgdG8gJ3doZXJlKC4uLiknLCAnb3IoLi4uKScsIG9yICdhbmQoLi4uKScuYCk7XG59XG5cbmNsYXNzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIge1xuICAgIGNvbnZlcnRWYWx1ZShlLCB0ID0gXCJub25lXCIpIHtcbiAgICAgICAgc3dpdGNoIChfX1BSSVZBVEVfdHlwZU9yZGVyKGUpKSB7XG4gICAgICAgICAgY2FzZSAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZS5ib29sZWFuVmFsdWU7XG5cbiAgICAgICAgICBjYXNlIDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKGUudGltZXN0YW1wVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0U2VydmVyVGltZXN0YW1wKGUsIHQpO1xuXG4gICAgICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZS5zdHJpbmdWYWx1ZTtcblxuICAgICAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRCeXRlcyhfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpKTtcblxuICAgICAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydFJlZmVyZW5jZShlLnJlZmVyZW5jZVZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0R2VvUG9pbnQoZS5nZW9Qb2ludFZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0QXJyYXkoZS5hcnJheVZhbHVlLCB0KTtcblxuICAgICAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRPYmplY3QoZS5tYXBWYWx1ZSwgdCk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnZlcnRPYmplY3QoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0T2JqZWN0TWFwKGUuZmllbGRzLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovICAgIGNvbnZlcnRPYmplY3RNYXAoZSwgdCA9IFwibm9uZVwiKSB7XG4gICAgICAgIGNvbnN0IG4gPSB7fTtcbiAgICAgICAgcmV0dXJuIGZvckVhY2goZSwgKChlLCByKSA9PiB7XG4gICAgICAgICAgICBuW2VdID0gdGhpcy5jb252ZXJ0VmFsdWUociwgdCk7XG4gICAgICAgIH0pKSwgbjtcbiAgICB9XG4gICAgY29udmVydEdlb1BvaW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBHZW9Qb2ludChfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubGF0aXR1ZGUpLCBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubG9uZ2l0dWRlKSk7XG4gICAgfVxuICAgIGNvbnZlcnRBcnJheShlLCB0KSB7XG4gICAgICAgIHJldHVybiAoZS52YWx1ZXMgfHwgW10pLm1hcCgoZSA9PiB0aGlzLmNvbnZlcnRWYWx1ZShlLCB0KSkpO1xuICAgIH1cbiAgICBjb252ZXJ0U2VydmVyVGltZXN0YW1wKGUsIHQpIHtcbiAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgY2FzZSBcInByZXZpb3VzXCI6XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuID8gbnVsbCA6IHRoaXMuY29udmVydFZhbHVlKG4sIHQpO1xuXG4gICAgICAgICAgY2FzZSBcImVzdGltYXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZShlKSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udmVydFRpbWVzdGFtcChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpO1xuICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh0LnNlY29uZHMsIHQubmFub3MpO1xuICAgIH1cbiAgICBjb252ZXJ0RG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZSk7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKG4pKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBEYXRhYmFzZUlkKG4uZ2V0KDEpLCBuLmdldCgzKSksIGkgPSBuZXcgRG9jdW1lbnRLZXkobi5wb3BGaXJzdCg1KSk7XG4gICAgICAgIHJldHVybiByLmlzRXF1YWwodCkgfHwgXG4gICAgICAgIC8vIFRPRE8oYi82NDEzMDIwMik6IFNvbWVob3cgc3VwcG9ydCBmb3JlaWduIHJlZmVyZW5jZXMuXG4gICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihgRG9jdW1lbnQgJHtpfSBjb250YWlucyBhIGRvY3VtZW50IHJlZmVyZW5jZSB3aXRoaW4gYSBkaWZmZXJlbnQgZGF0YWJhc2UgKCR7ci5wcm9qZWN0SWR9LyR7ci5kYXRhYmFzZX0pIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQuIEl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHJlZmVyZW5jZSBpbiB0aGUgY3VycmVudCBkYXRhYmFzZSAoJHt0LnByb2plY3RJZH0vJHt0LmRhdGFiYXNlfSkgaW5zdGVhZC5gKSwgXG4gICAgICAgIGk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb252ZXJ0cyBjdXN0b20gbW9kZWwgb2JqZWN0IG9mIHR5cGUgVCBpbnRvIGBEb2N1bWVudERhdGFgIGJ5IGFwcGx5aW5nIHRoZVxuICogY29udmVydGVyIGlmIGl0IGV4aXN0cy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgd2hlbiBjb252ZXJ0aW5nIHVzZXIgb2JqZWN0cyB0byBgRG9jdW1lbnREYXRhYFxuICogYmVjYXVzZSB3ZSB3YW50IHRvIHByb3ZpZGUgdGhlIHVzZXIgd2l0aCBhIG1vcmUgc3BlY2lmaWMgZXJyb3IgbWVzc2FnZSBpZlxuICogdGhlaXIgYHNldCgpYCBvciBmYWlscyBkdWUgdG8gaW52YWxpZCBkYXRhIG9yaWdpbmF0aW5nIGZyb20gYSBgdG9GaXJlc3RvcmUoKWBcbiAqIGNhbGwuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihlLCB0LCBuKSB7XG4gICAgbGV0IHI7XG4gICAgLy8gQ2FzdCB0byBgYW55YCBpbiBvcmRlciB0byBzYXRpc2Z5IHRoZSB1bmlvbiB0eXBlIGNvbnN0cmFpbnQgb25cbiAgICAvLyB0b0ZpcmVzdG9yZSgpLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgcmV0dXJuIHIgPSBlID8gbiAmJiAobi5tZXJnZSB8fCBuLm1lcmdlRmllbGRzKSA/IGUudG9GaXJlc3RvcmUodCwgbikgOiBlLnRvRmlyZXN0b3JlKHQpIDogdCwgXG4gICAgcjtcbn1cblxuY2xhc3MgX19QUklWQVRFX0xpdGVVc2VyRGF0YVdyaXRlciBleHRlbmRzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICBjb252ZXJ0Qnl0ZXMoZSkge1xuICAgICAgICByZXR1cm4gbmV3IEJ5dGVzKGUpO1xuICAgIH1cbiAgICBjb252ZXJ0UmVmZXJlbmNlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuY29udmVydERvY3VtZW50S2V5KGUsIHRoaXMuZmlyZXN0b3JlLl9kYXRhYmFzZUlkKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgLyogY29udmVydGVyPSAqLyBudWxsLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZSBhbiBBZ2dyZWdhdGVGaWVsZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBjb21wdXRlIHRoZSBzdW0gb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIHN1bSBhY3Jvc3MgdGhlIHJlc3VsdCBzZXQuXG4gKiBAaW50ZXJuYWwgVE9ETyAoc3VtL2F2ZykgcmVtb3ZlIHdoZW4gcHVibGljXG4gKi8gZnVuY3Rpb24gc3VtKGUpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwic3VtXCIsIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQkMShcInN1bVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGF2ZXJhZ2Ugb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIGF2ZXJhZ2UgYWNyb3NzIHRoZSByZXN1bHQgc2V0LlxuICogQGludGVybmFsIFRPRE8gKHN1bS9hdmcpIHJlbW92ZSB3aGVuIHB1YmxpY1xuICovIGZ1bmN0aW9uIGF2ZXJhZ2UoZSkge1xuICAgIHJldHVybiBuZXcgQWdncmVnYXRlRmllbGQoXCJhdmdcIiwgX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKFwiYXZlcmFnZVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGNvdW50IG9mXG4gKiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBpbnRlcm5hbCBUT0RPIChzdW0vYXZnKSByZW1vdmUgd2hlbiBwdWJsaWNcbiAqLyBmdW5jdGlvbiBjb3VudCgpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwiY291bnRcIik7XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvICdBZ2dyZWdhdGVGaWVsZGAgaW5zdGFuY2VzIGZvciBlcXVhbGl0eS5cbiAqXG4gKiBAcGFyYW0gbGVmdCBDb21wYXJlIHRoaXMgQWdncmVnYXRlRmllbGQgdG8gdGhlIGByaWdodGAuXG4gKiBAcGFyYW0gcmlnaHQgQ29tcGFyZSB0aGlzIEFnZ3JlZ2F0ZUZpZWxkIHRvIHRoZSBgbGVmdGAuXG4gKiBAaW50ZXJuYWwgVE9ETyAoc3VtL2F2ZykgcmVtb3ZlIHdoZW4gcHVibGljXG4gKi8gZnVuY3Rpb24gYWdncmVnYXRlRmllbGRFcXVhbChlLCB0KSB7XG4gICAgdmFyIG4sIHI7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBBZ2dyZWdhdGVGaWVsZCAmJiB0IGluc3RhbmNlb2YgQWdncmVnYXRlRmllbGQgJiYgZS5fYWdncmVnYXRlVHlwZSA9PT0gdC5fYWdncmVnYXRlVHlwZSAmJiAobnVsbCA9PT0gKG4gPSBlLl9pbnRlcm5hbEZpZWxkUGF0aCkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5jYW5vbmljYWxTdHJpbmcoKSkgPT09IChudWxsID09PSAociA9IHQuX2ludGVybmFsRmllbGRQYXRoKSB8fCB2b2lkIDAgPT09IHIgPyB2b2lkIDAgOiByLmNhbm9uaWNhbFN0cmluZygpKTtcbn1cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIGluc3RhbmNlcyBmb3IgZXF1YWxpdHkuXG4gKlxuICogVHdvIGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCBpbnN0YW5jZXMgYXJlIGNvbnNpZGVyZWQgXCJlcXVhbFwiIGlmIHRoZXkgaGF2ZVxuICogdW5kZXJseWluZyBxdWVyaWVzIHRoYXQgY29tcGFyZSBlcXVhbCwgYW5kIHRoZSBzYW1lIGRhdGEuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBUaGUgZmlyc3QgYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBUaGUgc2Vjb25kIGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCB0byBjb21wYXJlLlxuICpcbiAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgXCJlcXVhbFwiLCBhcyBkZWZpbmVkIGFib3ZlLCBvciBgZmFsc2VgXG4gKiBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gYWdncmVnYXRlUXVlcnlTbmFwc2hvdEVxdWFsKGUsIHQpIHtcbiAgICByZXR1cm4gcXVlcnlFcXVhbChlLnF1ZXJ5LCB0LnF1ZXJ5KSAmJiBkZWVwRXF1YWwoZS5kYXRhKCksIHQuZGF0YSgpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogTWV0YWRhdGEgYWJvdXQgYSBzbmFwc2hvdCwgZGVzY3JpYmluZyB0aGUgc3RhdGUgb2YgdGhlIHNuYXBzaG90LlxuICovIGNsYXNzIFNuYXBzaG90TWV0YWRhdGEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmhhc1BlbmRpbmdXcml0ZXMgPSBlLCB0aGlzLmZyb21DYWNoZSA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBTbmFwc2hvdE1ldGFkYXRhYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzUGVuZGluZ1dyaXRlcyA9PT0gZS5oYXNQZW5kaW5nV3JpdGVzICYmIHRoaXMuZnJvbUNhY2hlID09PSBlLmZyb21DYWNoZTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyIEZpcmVzdG9yZVxuICogZGF0YWJhc2UuIFRoZSBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvXG4gKiBnZXQgYSBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBGb3IgYSBgRG9jdW1lbnRTbmFwc2hvdGAgdGhhdCBwb2ludHMgdG8gYSBub24tZXhpc3RpbmcgZG9jdW1lbnQsIGFueSBkYXRhXG4gKiBhY2Nlc3Mgd2lsbCByZXR1cm4gJ3VuZGVmaW5lZCcuIFlvdSBjYW4gdXNlIHRoZSBgZXhpc3RzKClgIG1ldGhvZCB0b1xuICogZXhwbGljaXRseSB2ZXJpZnkgYSBkb2N1bWVudCdzIGV4aXN0ZW5jZS5cbiAqLyBjbGFzcyBEb2N1bWVudFNuYXBzaG90IGV4dGVuZHMgRG9jdW1lbnRTbmFwc2hvdCQxIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgICAgIHN1cGVyKGUsIHQsIG4sIHIsIHMpLCB0aGlzLl9maXJlc3RvcmUgPSBlLCB0aGlzLl9maXJlc3RvcmVJbXBsID0gZSwgdGhpcy5tZXRhZGF0YSA9IGk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGRhdGEgZXhpc3RzLiBUcnVlIGlmIHRoZSBkb2N1bWVudCBleGlzdHMuXG4gICAgICovICAgIGV4aXN0cygpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmV4aXN0cygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgYXMgYW4gYE9iamVjdGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdmFsdWVzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW5cbiAgICAgKiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIGJ5IHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbVxuICAgICAqIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzIHRoYXRcbiAgICAgKiBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgb3IgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKi8gICAgZGF0YShlID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29udmVydGVyKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHVzZSB0aGUgY29udmVydGVyIGFuZCBjcmVhdGUgYSBuZXcgRG9jdW1lbnRTbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIGlmIGEgY29udmVydGVyIGhhcyBiZWVuIHByb3ZpZGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgUXVlcnlEb2N1bWVudFNuYXBzaG90KHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIHRoaXMuX2tleSwgdGhpcy5fZG9jdW1lbnQsIHRoaXMubWV0YWRhdGEsIFxuICAgICAgICAgICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRlci5mcm9tRmlyZXN0b3JlKHQsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0aGlzLl9kb2N1bWVudC5kYXRhLnZhbHVlLCBlLnNlcnZlclRpbWVzdGFtcHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgZmllbGQgc3BlY2lmaWVkIGJ5IGBmaWVsZFBhdGhgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIHRoZVxuICAgICAqIGRvY3VtZW50IG9yIGZpZWxkIGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBCeSBkZWZhdWx0LCBhIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdGhhdCBoYXMgbm90IHlldCBiZWVuIHNldCB0b1xuICAgICAqIGl0cyBmaW5hbCB2YWx1ZSB3aWxsIGJlIHJldHVybmVkIGFzIGBudWxsYC4gWW91IGNhbiBvdmVycmlkZSB0aGlzIGJ5XG4gICAgICogcGFzc2luZyBhbiBvcHRpb25zIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWVsZFBhdGggLSBUaGUgcGF0aCAoZm9yIGV4YW1wbGUgJ2Zvbycgb3IgJ2Zvby5iYXInKSB0byBhIHNwZWNpZmljXG4gICAgICogZmllbGQuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgaG93IHRoZSBmaWVsZCBpcyByZXRyaWV2ZWRcbiAgICAgKiBmcm9tIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzXG4gICAgICogdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIFRoZSBkYXRhIGF0IHRoZSBzcGVjaWZpZWQgZmllbGQgbG9jYXRpb24gb3IgdW5kZWZpbmVkIGlmIG5vIHN1Y2hcbiAgICAgKiBmaWVsZCBleGlzdHMgaW4gdGhlIGRvY3VtZW50LlxuICAgICAqL1xuICAgIC8vIFdlIGFyZSB1c2luZyBgYW55YCBoZXJlIHRvIGF2b2lkIGFuIGV4cGxpY2l0IGNhc3QgYnkgb3VyIHVzZXJzLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgZ2V0KGUsIHQgPSB7fSkge1xuICAgICAgICBpZiAodGhpcy5fZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLl9kb2N1bWVudC5kYXRhLmZpZWxkKF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCBlKSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gbikgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShuLCB0LnNlcnZlclRpbWVzdGFtcHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UgYXMgcGFydCBvZiBhIHF1ZXJ5LiBUaGUgZG9jdW1lbnQgaXMgZ3VhcmFudGVlZCB0byBleGlzdFxuICogYW5kIGl0cyBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvIGdldCBhXG4gKiBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIG9mZmVycyB0aGUgc2FtZSBBUEkgc3VyZmFjZSBhcyBhXG4gKiBgRG9jdW1lbnRTbmFwc2hvdGAuIFNpbmNlIHF1ZXJ5IHJlc3VsdHMgY29udGFpbiBvbmx5IGV4aXN0aW5nIGRvY3VtZW50cywgdGhlXG4gKiBgZXhpc3RzYCBwcm9wZXJ0eSB3aWxsIGFsd2F5cyBiZSB0cnVlIGFuZCBgZGF0YSgpYCB3aWxsIG5ldmVyIHJldHVyblxuICogJ3VuZGVmaW5lZCcuXG4gKi8gY2xhc3MgUXVlcnlEb2N1bWVudFNuYXBzaG90IGV4dGVuZHMgRG9jdW1lbnRTbmFwc2hvdCB7XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCwgYHNlcnZlclRpbWVzdGFtcCgpYCB2YWx1ZXMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlblxuICAgICAqIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSB3aWxsIGJlIHJldHVybmVkIGFzIGBudWxsYC4gWW91IGNhbiBvdmVycmlkZVxuICAgICAqIHRoaXMgYnkgcGFzc2luZyBhbiBvcHRpb25zIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIGhvdyBkYXRhIGlzIHJldHJpZXZlZCBmcm9tXG4gICAgICogdGhlIHNuYXBzaG90IChmb3IgZXhhbXBsZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBmb3Igc2VydmVyIHRpbWVzdGFtcHMgdGhhdFxuICAgICAqIGhhdmUgbm90IHlldCBiZWVuIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSkuXG4gICAgICogQHJldHVybnMgQW4gYE9iamVjdGAgY29udGFpbmluZyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBkYXRhKGUgPSB7fSkge1xuICAgICAgICByZXR1cm4gc3VwZXIuZGF0YShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgUXVlcnlTbmFwc2hvdGAgY29udGFpbnMgemVybyBvciBtb3JlIGBEb2N1bWVudFNuYXBzaG90YCBvYmplY3RzXG4gKiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdHMgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50cyBjYW4gYmUgYWNjZXNzZWQgYXMgYW5cbiAqIGFycmF5IHZpYSB0aGUgYGRvY3NgIHByb3BlcnR5IG9yIGVudW1lcmF0ZWQgdXNpbmcgdGhlIGBmb3JFYWNoYCBtZXRob2QuIFRoZVxuICogbnVtYmVyIG9mIGRvY3VtZW50cyBjYW4gYmUgZGV0ZXJtaW5lZCB2aWEgdGhlIGBlbXB0eWAgYW5kIGBzaXplYFxuICogcHJvcGVydGllcy5cbiAqLyBjbGFzcyBRdWVyeVNuYXBzaG90IHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIgPSB0LCB0aGlzLl9zbmFwc2hvdCA9IHIsIHRoaXMubWV0YWRhdGEgPSBuZXcgU25hcHNob3RNZXRhZGF0YShyLmhhc1BlbmRpbmdXcml0ZXMsIHIuZnJvbUNhY2hlKSwgXG4gICAgICAgIHRoaXMucXVlcnkgPSBuO1xuICAgIH1cbiAgICAvKiogQW4gYXJyYXkgb2YgYWxsIHRoZSBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC4gKi8gICAgZ2V0IGRvY3MoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaCgodCA9PiBlLnB1c2godCkpKSwgZTtcbiAgICB9XG4gICAgLyoqIFRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuICovICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc25hcHNob3QuZG9jcy5zaXplO1xuICAgIH1cbiAgICAvKiogVHJ1ZSBpZiB0aGVyZSBhcmUgbm8gZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuICovICAgIGdldCBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIDAgPT09IHRoaXMuc2l6ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW51bWVyYXRlcyBhbGwgb2YgdGhlIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLlxuICAgICAqXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIC0gQSBjYWxsYmFjayB0byBiZSBjYWxsZWQgd2l0aCBhIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGZvclxuICAgICAqIGVhY2ggZG9jdW1lbnQgaW4gdGhlIHNuYXBzaG90LlxuICAgICAqIEBwYXJhbSB0aGlzQXJnIC0gVGhlIGB0aGlzYCBiaW5kaW5nIGZvciB0aGUgY2FsbGJhY2suXG4gICAgICovICAgIGZvckVhY2goZSwgdCkge1xuICAgICAgICB0aGlzLl9zbmFwc2hvdC5kb2NzLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgZS5jYWxsKHQsIG5ldyBRdWVyeURvY3VtZW50U25hcHNob3QodGhpcy5fZmlyZXN0b3JlLCB0aGlzLl91c2VyRGF0YVdyaXRlciwgbi5rZXksIG4sIG5ldyBTbmFwc2hvdE1ldGFkYXRhKHRoaXMuX3NuYXBzaG90Lm11dGF0ZWRLZXlzLmhhcyhuLmtleSksIHRoaXMuX3NuYXBzaG90LmZyb21DYWNoZSksIHRoaXMucXVlcnkuY29udmVydGVyKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiB0aGUgZG9jdW1lbnRzIGNoYW5nZXMgc2luY2UgdGhlIGxhc3Qgc25hcHNob3QuIElmIHRoaXNcbiAgICAgKiBpcyB0aGUgZmlyc3Qgc25hcHNob3QsIGFsbCBkb2N1bWVudHMgd2lsbCBiZSBpbiB0aGUgbGlzdCBhcyAnYWRkZWQnXG4gICAgICogY2hhbmdlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gYFNuYXBzaG90TGlzdGVuT3B0aW9uc2AgdGhhdCBjb250cm9sIHdoZXRoZXIgbWV0YWRhdGEtb25seVxuICAgICAqIGNoYW5nZXMgKGkuZS4gb25seSBgRG9jdW1lbnRTbmFwc2hvdC5tZXRhZGF0YWAgY2hhbmdlZCkgc2hvdWxkIHRyaWdnZXJcbiAgICAgKiBzbmFwc2hvdCBldmVudHMuXG4gICAgICovICAgIGRvY0NoYW5nZXMoZSA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHQgPSAhIWUuaW5jbHVkZU1ldGFkYXRhQ2hhbmdlcztcbiAgICAgICAgaWYgKHQgJiYgdGhpcy5fc25hcHNob3QuZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXMpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiVG8gaW5jbHVkZSBtZXRhZGF0YSBjaGFuZ2VzIHdpdGggeW91ciBkb2N1bWVudCBjaGFuZ2VzLCB5b3UgbXVzdCBhbHNvIHBhc3MgeyBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOnRydWUgfSB0byBvblNuYXBzaG90KCkuXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkQ2hhbmdlcyAmJiB0aGlzLl9jYWNoZWRDaGFuZ2VzSW5jbHVkZU1ldGFkYXRhQ2hhbmdlcyA9PT0gdCB8fCAodGhpcy5fY2FjaGVkQ2hhbmdlcyA9IFxuICAgICAgICAvKiogQ2FsY3VsYXRlcyB0aGUgYXJyYXkgb2YgYERvY3VtZW50Q2hhbmdlYHMgZm9yIGEgZ2l2ZW4gYFZpZXdTbmFwc2hvdGAuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9jaGFuZ2VzRnJvbVNuYXBzaG90KGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChlLl9zbmFwc2hvdC5vbGREb2NzLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5fc25hcHNob3QuZG9jQ2hhbmdlcy5tYXAoKG4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdChlLl9maXJlc3RvcmUsIGUuX3VzZXJEYXRhV3JpdGVyLCBuLmRvYy5rZXksIG4uZG9jLCBuZXcgU25hcHNob3RNZXRhZGF0YShlLl9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXMobi5kb2Mua2V5KSwgZS5fc25hcHNob3QuZnJvbUNhY2hlKSwgZS5xdWVyeS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5kb2MsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYWRkZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYzogcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEluZGV4OiAtMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0luZGV4OiB0KytcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgLy8gQSBgRG9jdW1lbnRTZXRgIHRoYXQgaXMgdXBkYXRlZCBpbmNyZW1lbnRhbGx5IGFzIGNoYW5nZXMgYXJlIGFwcGxpZWQgdG8gdXNlXG4gICAgICAgICAgICAgICAgLy8gdG8gbG9va3VwIHRoZSBpbmRleCBvZiBhIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgIGxldCBuID0gZS5fc25hcHNob3Qub2xkRG9jcztcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5fc25hcHNob3QuZG9jQ2hhbmdlcy5maWx0ZXIoKGUgPT4gdCB8fCAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gIT09IGUudHlwZSkpLm1hcCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgUXVlcnlEb2N1bWVudFNuYXBzaG90KGUuX2ZpcmVzdG9yZSwgZS5fdXNlckRhdGFXcml0ZXIsIHQuZG9jLmtleSwgdC5kb2MsIG5ldyBTbmFwc2hvdE1ldGFkYXRhKGUuX3NuYXBzaG90Lm11dGF0ZWRLZXlzLmhhcyh0LmRvYy5rZXkpLCBlLl9zbmFwc2hvdC5mcm9tQ2FjaGUpLCBlLnF1ZXJ5LmNvbnZlcnRlcik7XG4gICAgICAgICAgICAgICAgICAgIGxldCBpID0gLTEsIHMgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAhPT0gdC50eXBlICYmIChpID0gbi5pbmRleE9mKHQuZG9jLmtleSksIG4gPSBuLmRlbGV0ZSh0LmRvYy5rZXkpKSwgXG4gICAgICAgICAgICAgICAgICAgIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovICE9PSB0LnR5cGUgJiYgKG4gPSBuLmFkZCh0LmRvYyksIHMgPSBuLmluZGV4T2YodC5kb2Mua2V5KSksIFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBfX1BSSVZBVEVfcmVzdWx0Q2hhbmdlVHlwZSh0LnR5cGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jOiByLFxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkSW5kZXg6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJbmRleDogc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSh0aGlzLCB0KSwgdGhpcy5fY2FjaGVkQ2hhbmdlc0luY2x1ZGVNZXRhZGF0YUNoYW5nZXMgPSB0KSwgdGhpcy5fY2FjaGVkQ2hhbmdlcztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9yZXN1bHRDaGFuZ2VUeXBlKGUpIHtcbiAgICBzd2l0Y2ggKGUpIHtcbiAgICAgIGNhc2UgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovIDpcbiAgICAgICAgcmV0dXJuIFwiYWRkZWRcIjtcblxuICAgICAgY2FzZSAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gOlxuICAgICAgY2FzZSAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gOlxuICAgICAgICByZXR1cm4gXCJtb2RpZmllZFwiO1xuXG4gICAgICBjYXNlIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovIDpcbiAgICAgICAgcmV0dXJuIFwicmVtb3ZlZFwiO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuLy8gVE9ETyhmaXJlc3RvcmVleHApOiBBZGQgdGVzdHMgZm9yIHNuYXBzaG90RXF1YWwgd2l0aCBkaWZmZXJlbnQgc25hcHNob3Rcbi8vIG1ldGFkYXRhXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgc25hcHNob3RzIGFyZSBlcXVhbC5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgc25hcHNob3QgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSByaWdodCAtIEEgc25hcHNob3QgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHNuYXBzaG90cyBhcmUgZXF1YWwuXG4gKi8gZnVuY3Rpb24gc25hcHNob3RFcXVhbChlLCB0KSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBEb2N1bWVudFNuYXBzaG90ICYmIHQgaW5zdGFuY2VvZiBEb2N1bWVudFNuYXBzaG90ID8gZS5fZmlyZXN0b3JlID09PSB0Ll9maXJlc3RvcmUgJiYgZS5fa2V5LmlzRXF1YWwodC5fa2V5KSAmJiAobnVsbCA9PT0gZS5fZG9jdW1lbnQgPyBudWxsID09PSB0Ll9kb2N1bWVudCA6IGUuX2RvY3VtZW50LmlzRXF1YWwodC5fZG9jdW1lbnQpKSAmJiBlLl9jb252ZXJ0ZXIgPT09IHQuX2NvbnZlcnRlciA6IGUgaW5zdGFuY2VvZiBRdWVyeVNuYXBzaG90ICYmIHQgaW5zdGFuY2VvZiBRdWVyeVNuYXBzaG90ICYmIChlLl9maXJlc3RvcmUgPT09IHQuX2ZpcmVzdG9yZSAmJiBxdWVyeUVxdWFsKGUucXVlcnksIHQucXVlcnkpICYmIGUubWV0YWRhdGEuaXNFcXVhbCh0Lm1ldGFkYXRhKSAmJiBlLl9zbmFwc2hvdC5pc0VxdWFsKHQuX3NuYXBzaG90KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGlzIGBEb2N1bWVudFJlZmVyZW5jZWAuXG4gKlxuICogTm90ZTogYGdldERvYygpYCBhdHRlbXB0cyB0byBwcm92aWRlIHVwLXRvLWRhdGUgZGF0YSB3aGVuIHBvc3NpYmxlIGJ5IHdhaXRpbmdcbiAqIGZvciBkYXRhIGZyb20gdGhlIHNlcnZlciwgYnV0IGl0IG1heSByZXR1cm4gY2FjaGVkIGRhdGEgb3IgZmFpbCBpZiB5b3UgYXJlXG4gKiBvZmZsaW5lIGFuZCB0aGUgc2VydmVyIGNhbm5vdCBiZSByZWFjaGVkLiBUbyBzcGVjaWZ5IHRoaXMgYmVoYXZpb3IsIGludm9rZVxuICoge0BsaW5rIGdldERvY0Zyb21DYWNoZX0gb3Ige0BsaW5rIGdldERvY0Zyb21TZXJ2ZXJ9LlxuICpcbiAqIEBwYXJhbSByZWZlcmVuY2UgLSBUaGUgcmVmZXJlbmNlIG9mIHRoZSBkb2N1bWVudCB0byBmZXRjaC5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uIGdldERvYyhlKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIERvY3VtZW50UmVmZXJlbmNlKTtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudFZpYVNuYXBzaG90TGlzdGVuZXIoZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh0KSwgZS5fa2V5KS50aGVuKChuID0+IF9fUFJJVkFURV9jb252ZXJ0VG9Eb2NTbmFwc2hvdCh0LCBlLCBuKSkpO1xufVxuXG5jbGFzcyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIgZXh0ZW5kcyBBYnN0cmFjdFVzZXJEYXRhV3JpdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZmlyZXN0b3JlID0gZTtcbiAgICB9XG4gICAgY29udmVydEJ5dGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCeXRlcyhlKTtcbiAgICB9XG4gICAgY29udmVydFJlZmVyZW5jZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmNvbnZlcnREb2N1bWVudEtleShlLCB0aGlzLmZpcmVzdG9yZS5fZGF0YWJhc2VJZCk7XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRSZWZlcmVuY2UodGhpcy5maXJlc3RvcmUsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgdCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGlzIGBEb2N1bWVudFJlZmVyZW5jZWAgZnJvbSBjYWNoZS5cbiAqIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIGRvY3VtZW50IGlzIG5vdCBjdXJyZW50bHkgY2FjaGVkLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHJlc29sdmVkIHdpdGggYSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbmluZyB0aGVcbiAqIGN1cnJlbnQgZG9jdW1lbnQgY29udGVudHMuXG4gKi8gZnVuY3Rpb24gZ2V0RG9jRnJvbUNhY2hlKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIHIgPSBuZXcgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyKHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRGcm9tTG9jYWxDYWNoZShuLCBlLl9rZXkpLnRoZW4oKG4gPT4gbmV3IERvY3VtZW50U25hcHNob3QodCwgciwgZS5fa2V5LCBuLCBuZXcgU25hcHNob3RNZXRhZGF0YShudWxsICE9PSBuICYmIG4uaGFzTG9jYWxNdXRhdGlvbnMsIFxuICAgIC8qIGZyb21DYWNoZT0gKi8gITApLCBlLmNvbnZlcnRlcikpKTtcbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGZyb20gdGhlIHNlcnZlci5cbiAqIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIG5ldHdvcmsgaXMgbm90IGF2YWlsYWJsZS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uIGdldERvY0Zyb21TZXJ2ZXIoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBEb2N1bWVudFJlZmVyZW5jZSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRWaWFTbmFwc2hvdExpc3RlbmVyKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIGUuX2tleSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IF9fUFJJVkFURV9jb252ZXJ0VG9Eb2NTbmFwc2hvdCh0LCBlLCBuKSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBxdWVyeSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0cyBhcyBhIGBRdWVyeVNuYXBzaG90YC5cbiAqXG4gKiBOb3RlOiBgZ2V0RG9jcygpYCBhdHRlbXB0cyB0byBwcm92aWRlIHVwLXRvLWRhdGUgZGF0YSB3aGVuIHBvc3NpYmxlIGJ5XG4gKiB3YWl0aW5nIGZvciBkYXRhIGZyb20gdGhlIHNlcnZlciwgYnV0IGl0IG1heSByZXR1cm4gY2FjaGVkIGRhdGEgb3IgZmFpbCBpZlxuICogeW91IGFyZSBvZmZsaW5lIGFuZCB0aGUgc2VydmVyIGNhbm5vdCBiZSByZWFjaGVkLiBUbyBzcGVjaWZ5IHRoaXMgYmVoYXZpb3IsXG4gKiBpbnZva2Uge0BsaW5rIGdldERvY3NGcm9tQ2FjaGV9IG9yIHtAbGluayBnZXREb2NzRnJvbVNlcnZlcn0uXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LlxuICovIGZ1bmN0aW9uIGdldERvY3MoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBRdWVyeSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh0KSwgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZUhhc0V4cGxpY2l0T3JkZXJCeUZvckxpbWl0VG9MYXN0KGUuX3F1ZXJ5KSwgX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50c1ZpYVNuYXBzaG90TGlzdGVuZXIobiwgZS5fcXVlcnkpLnRoZW4oKG4gPT4gbmV3IFF1ZXJ5U25hcHNob3QodCwgciwgZSwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAgZnJvbSBjYWNoZS5cbiAqIFJldHVybnMgYW4gZW1wdHkgcmVzdWx0IHNldCBpZiBubyBkb2N1bWVudHMgbWF0Y2hpbmcgdGhlIHF1ZXJ5IGFyZSBjdXJyZW50bHlcbiAqIGNhY2hlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgcmVzdWx0cyBvZiB0aGUgcXVlcnkuXG4gKi8gZnVuY3Rpb24gZ2V0RG9jc0Zyb21DYWNoZShlKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIFF1ZXJ5KTtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKHQpLCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50c0Zyb21Mb2NhbENhY2hlKG4sIGUuX3F1ZXJ5KS50aGVuKChuID0+IG5ldyBRdWVyeVNuYXBzaG90KHQsIHIsIGUsIG4pKSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgdGhlIHF1ZXJ5IGFuZCByZXR1cm5zIHRoZSByZXN1bHRzIGFzIGEgYFF1ZXJ5U25hcHNob3RgIGZyb20gdGhlXG4gKiBzZXJ2ZXIuIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIG5ldHdvcmsgaXMgbm90IGF2YWlsYWJsZS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgcmVzdWx0cyBvZiB0aGUgcXVlcnkuXG4gKi8gZnVuY3Rpb24gZ2V0RG9jc0Zyb21TZXJ2ZXIoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBRdWVyeSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh0KSwgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyKG4sIGUuX3F1ZXJ5LCB7XG4gICAgICAgIHNvdXJjZTogXCJzZXJ2ZXJcIlxuICAgIH0pLnRoZW4oKG4gPT4gbmV3IFF1ZXJ5U25hcHNob3QodCwgciwgZSwgbikpKTtcbn1cblxuZnVuY3Rpb24gc2V0RG9jKGUsIHQsIG4pIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgaSA9IF9fUFJJVkFURV9hcHBseUZpcmVzdG9yZURhdGFDb252ZXJ0ZXIoZS5jb252ZXJ0ZXIsIHQsIG4pO1xuICAgIHJldHVybiBleGVjdXRlV3JpdGUociwgWyBfX1BSSVZBVEVfcGFyc2VTZXREYXRhKF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihyKSwgXCJzZXREb2NcIiwgZS5fa2V5LCBpLCBudWxsICE9PSBlLmNvbnZlcnRlciwgbikudG9NdXRhdGlvbihlLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpIF0pO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVEb2MoZSwgdCwgbiwgLi4ucikge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBEb2N1bWVudFJlZmVyZW5jZSk7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBzID0gX19QUklWQVRFX25ld1VzZXJEYXRhUmVhZGVyKGkpO1xuICAgIGxldCBvO1xuICAgIG8gPSBcInN0cmluZ1wiID09IHR5cGVvZiAoXG4gICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgdCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSkgfHwgdCBpbnN0YW5jZW9mIEZpZWxkUGF0aCA/IF9fUFJJVkFURV9wYXJzZVVwZGF0ZVZhcmFyZ3MocywgXCJ1cGRhdGVEb2NcIiwgZS5fa2V5LCB0LCBuLCByKSA6IF9fUFJJVkFURV9wYXJzZVVwZGF0ZURhdGEocywgXCJ1cGRhdGVEb2NcIiwgZS5fa2V5LCB0KTtcbiAgICByZXR1cm4gZXhlY3V0ZVdyaXRlKGksIFsgby50b011dGF0aW9uKGUuX2tleSwgUHJlY29uZGl0aW9uLmV4aXN0cyghMCkpIF0pO1xufVxuXG4vKipcbiAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBzcGVjaWZpZWQgYERvY3VtZW50UmVmZXJlbmNlYC5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGRlbGV0ZS5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSByZXNvbHZlZCBvbmNlIHRoZSBkb2N1bWVudCBoYXMgYmVlbiBzdWNjZXNzZnVsbHlcbiAqIGRlbGV0ZWQgZnJvbSB0aGUgYmFja2VuZCAobm90ZSB0aGF0IGl0IHdvbid0IHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICovIGZ1bmN0aW9uIGRlbGV0ZURvYyhlKSB7XG4gICAgcmV0dXJuIGV4ZWN1dGVXcml0ZShfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgWyBuZXcgX19QUklWQVRFX0RlbGV0ZU11dGF0aW9uKGUuX2tleSwgUHJlY29uZGl0aW9uLm5vbmUoKSkgXSk7XG59XG5cbi8qKlxuICogQWRkIGEgbmV3IGRvY3VtZW50IHRvIHNwZWNpZmllZCBgQ29sbGVjdGlvblJlZmVyZW5jZWAgd2l0aCB0aGUgZ2l2ZW4gZGF0YSxcbiAqIGFzc2lnbmluZyBpdCBhIGRvY3VtZW50IElEIGF1dG9tYXRpY2FsbHkuXG4gKlxuICogQHBhcmFtIHJlZmVyZW5jZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBjb2xsZWN0aW9uIHRvIGFkZCB0aGlzIGRvY3VtZW50IHRvLlxuICogQHBhcmFtIGRhdGEgLSBBbiBPYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSBmb3IgdGhlIG5ldyBkb2N1bWVudC5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHJlc29sdmVkIHdpdGggYSBgRG9jdW1lbnRSZWZlcmVuY2VgIHBvaW50aW5nIHRvIHRoZVxuICogbmV3bHkgY3JlYXRlZCBkb2N1bWVudCBhZnRlciBpdCBoYXMgYmVlbiB3cml0dGVuIHRvIHRoZSBiYWNrZW5kIChOb3RlIHRoYXQgaXRcbiAqIHdvbid0IHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICovIGZ1bmN0aW9uIGFkZERvYyhlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCByID0gZG9jKGUpLCBpID0gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihlLmNvbnZlcnRlciwgdCk7XG4gICAgcmV0dXJuIGV4ZWN1dGVXcml0ZShuLCBbIF9fUFJJVkFURV9wYXJzZVNldERhdGEoX19QUklWQVRFX25ld1VzZXJEYXRhUmVhZGVyKGUuZmlyZXN0b3JlKSwgXCJhZGREb2NcIiwgci5fa2V5LCBpLCBudWxsICE9PSBlLmNvbnZlcnRlciwge30pLnRvTXV0YXRpb24oci5fa2V5LCBQcmVjb25kaXRpb24uZXhpc3RzKCExKSkgXSkudGhlbigoKCkgPT4gcikpO1xufVxuXG5mdW5jdGlvbiBvblNuYXBzaG90KGUsIC4uLnQpIHtcbiAgICB2YXIgbiwgciwgaTtcbiAgICBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpO1xuICAgIGxldCBzID0ge1xuICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiAhMVxuICAgIH0sIG8gPSAwO1xuICAgIFwib2JqZWN0XCIgIT0gdHlwZW9mIHRbb10gfHwgX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKHRbb10pIHx8IChzID0gdFtvXSwgbysrKTtcbiAgICBjb25zdCBfID0ge1xuICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiBzLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXNcbiAgICB9O1xuICAgIGlmIChfX1BSSVZBVEVfaXNQYXJ0aWFsT2JzZXJ2ZXIodFtvXSkpIHtcbiAgICAgICAgY29uc3QgZSA9IHRbb107XG4gICAgICAgIHRbb10gPSBudWxsID09PSAobiA9IGUubmV4dCkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5iaW5kKGUpLCB0W28gKyAxXSA9IG51bGwgPT09IChyID0gZS5lcnJvcikgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5iaW5kKGUpLCBcbiAgICAgICAgdFtvICsgMl0gPSBudWxsID09PSAoaSA9IGUuY29tcGxldGUpIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkuYmluZChlKTtcbiAgICB9XG4gICAgbGV0IGEsIHUsIGM7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSkgdSA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBcbiAgICBjID0gX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChlLl9rZXkucGF0aCksIGEgPSB7XG4gICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgdFtvXSAmJiB0W29dKF9fUFJJVkFURV9jb252ZXJ0VG9Eb2NTbmFwc2hvdCh1LCBlLCBuKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiB0W28gKyAxXSxcbiAgICAgICAgY29tcGxldGU6IHRbbyArIDJdXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2FzdChlLCBRdWVyeSk7XG4gICAgICAgIHUgPSBfX1BSSVZBVEVfY2FzdChuLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgYyA9IG4uX3F1ZXJ5O1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih1KTtcbiAgICAgICAgYSA9IHtcbiAgICAgICAgICAgIG5leHQ6IGUgPT4ge1xuICAgICAgICAgICAgICAgIHRbb10gJiYgdFtvXShuZXcgUXVlcnlTbmFwc2hvdCh1LCByLCBuLCBlKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IHRbbyArIDFdLFxuICAgICAgICAgICAgY29tcGxldGU6IHRbbyArIDJdXG4gICAgICAgIH0sIF9fUFJJVkFURV92YWxpZGF0ZUhhc0V4cGxpY2l0T3JkZXJCeUZvckxpbWl0VG9MYXN0KGUuX3F1ZXJ5KTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRMaXN0ZW4oZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9Bc3luY09ic2VydmVyKHIpLCBzID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyKHQsIGksIG4pO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IF9fUFJJVkFURV9ldmVudE1hbmFnZXJMaXN0ZW4oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgcykpKSwgXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIGkuQ2EoKSwgZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IF9fUFJJVkFURV9ldmVudE1hbmFnZXJVbmxpc3Rlbihhd2FpdCBfX1BSSVZBVEVfZ2V0RXZlbnRNYW5hZ2VyKGUpLCBzKSkpO1xuICAgICAgICB9O1xuICAgIH0oZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh1KSwgYywgXywgYSk7XG59XG5cbmZ1bmN0aW9uIG9uU25hcHNob3RzSW5TeW5jKGUsIHQpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEFkZFNuYXBzaG90c0luU3luY0xpc3RlbmVyKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLCBfX1BSSVZBVEVfaXNQYXJ0aWFsT2JzZXJ2ZXIodCkgPyB0IDoge1xuICAgICAgICBuZXh0OiB0XG4gICAgfSk7XG59XG5cbi8qKlxuICogTG9jYWxseSB3cml0ZXMgYG11dGF0aW9uc2Agb24gdGhlIGFzeW5jIHF1ZXVlLlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gZXhlY3V0ZVdyaXRlKGUsIHQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFdyaXRlKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gX19QUklWQVRFX3N5bmNFbmdpbmVXcml0ZShhd2FpdCBfX1BSSVZBVEVfZ2V0U3luY0VuZ2luZShlKSwgdCwgbikpKSwgXG4gICAgICAgIG4ucHJvbWlzZTtcbiAgICB9KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSksIHQpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGEge0BsaW5rIFZpZXdTbmFwc2hvdH0gdGhhdCBjb250YWlucyB0aGUgc2luZ2xlIGRvY3VtZW50IHNwZWNpZmllZCBieSBgcmVmYFxuICogdG8gYSB7QGxpbmsgRG9jdW1lbnRTbmFwc2hvdH0uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRUb0RvY1NuYXBzaG90KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gbi5kb2NzLmdldCh0Ll9rZXkpLCBpID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcihlKTtcbiAgICByZXR1cm4gbmV3IERvY3VtZW50U25hcHNob3QoZSwgaSwgdC5fa2V5LCByLCBuZXcgU25hcHNob3RNZXRhZGF0YShuLmhhc1BlbmRpbmdXcml0ZXMsIG4uZnJvbUNhY2hlKSwgdC5jb252ZXJ0ZXIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIGluIHRoZSByZXN1bHQgc2V0IG9mIHRoZSBnaXZlbiBxdWVyeSxcbiAqIHdpdGhvdXQgYWN0dWFsbHkgZG93bmxvYWRpbmcgdGhlIGRvY3VtZW50cy5cbiAqXG4gKiBVc2luZyB0aGlzIGZ1bmN0aW9uIHRvIGNvdW50IHRoZSBkb2N1bWVudHMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGNvdW50LCBub3QgdGhlIGRvY3VtZW50cycgZGF0YSwgaXMgZG93bmxvYWRlZC4gVGhpcyBmdW5jdGlvbiBjYW4gZXZlblxuICogY291bnQgdGhlIGRvY3VtZW50cyBpZiB0aGUgcmVzdWx0IHNldCB3b3VsZCBiZSBwcm9oaWJpdGl2ZWx5IGxhcmdlIHRvXG4gKiBkb3dubG9hZCBlbnRpcmVseSAoZS5nLiB0aG91c2FuZHMgb2YgZG9jdW1lbnRzKS5cbiAqXG4gKiBUaGUgcmVzdWx0IHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlciBpcyBwcmVzZW50ZWQsIHVuYWx0ZXJlZCwgd2l0aG91dFxuICogY29uc2lkZXJpbmcgYW55IGxvY2FsIHN0YXRlLiBUaGF0IGlzLCBkb2N1bWVudHMgaW4gdGhlIGxvY2FsIGNhY2hlIGFyZSBub3RcbiAqIHRha2VuIGludG8gY29uc2lkZXJhdGlvbiwgbmVpdGhlciBhcmUgbG9jYWwgbW9kaWZpY2F0aW9ucyBub3QgeWV0XG4gKiBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgc2VydmVyLiBQcmV2aW91c2x5LWRvd25sb2FkZWQgcmVzdWx0cywgaWYgYW55LCBhcmUgbm90XG4gKiB1c2VkOiBldmVyeSByZXF1ZXN0IHVzaW5nIHRoaXMgc291cmNlIG5lY2Vzc2FyaWx5IGludm9sdmVzIGEgcm91bmQgdHJpcCB0b1xuICogdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgd2hvc2UgcmVzdWx0IHNldCBzaXplIHRvIGNhbGN1bGF0ZS5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgY291bnQ7IHRoZSBjb3VudCBjYW4gYmVcbiAqIHJldHJpZXZlZCBmcm9tIGBzbmFwc2hvdC5kYXRhKCkuY291bnRgLCB3aGVyZSBgc25hcHNob3RgIGlzIHRoZVxuICogYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIHdoaWNoIHRoZSByZXR1cm5lZCBQcm9taXNlIHJlc29sdmVzLlxuICovIGZ1bmN0aW9uIGdldENvdW50RnJvbVNlcnZlcihlKSB7XG4gICAgcmV0dXJuIGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIoZSwge1xuICAgICAgICBjb3VudDogY291bnQoKVxuICAgIH0pO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNwZWNpZmllZCBhZ2dyZWdhdGlvbnMgb3ZlciB0aGUgZG9jdW1lbnRzIGluIHRoZSByZXN1bHRcbiAqIHNldCBvZiB0aGUgZ2l2ZW4gcXVlcnksIHdpdGhvdXQgYWN0dWFsbHkgZG93bmxvYWRpbmcgdGhlIGRvY3VtZW50cy5cbiAqXG4gKiBVc2luZyB0aGlzIGZ1bmN0aW9uIHRvIHBlcmZvcm0gYWdncmVnYXRpb25zIGlzIGVmZmljaWVudCBiZWNhdXNlIG9ubHkgdGhlXG4gKiBmaW5hbCBhZ2dyZWdhdGlvbiB2YWx1ZXMsIG5vdCB0aGUgZG9jdW1lbnRzJyBkYXRhLCBpcyBkb3dubG9hZGVkLiBUaGlzXG4gKiBmdW5jdGlvbiBjYW4gZXZlbiBwZXJmb3JtIGFnZ3JlZ2F0aW9ucyBvZiB0aGUgZG9jdW1lbnRzIGlmIHRoZSByZXN1bHQgc2V0XG4gKiB3b3VsZCBiZSBwcm9oaWJpdGl2ZWx5IGxhcmdlIHRvIGRvd25sb2FkIGVudGlyZWx5IChlLmcuIHRob3VzYW5kcyBvZiBkb2N1bWVudHMpLlxuICpcbiAqIFRoZSByZXN1bHQgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyIGlzIHByZXNlbnRlZCwgdW5hbHRlcmVkLCB3aXRob3V0XG4gKiBjb25zaWRlcmluZyBhbnkgbG9jYWwgc3RhdGUuIFRoYXQgaXMsIGRvY3VtZW50cyBpbiB0aGUgbG9jYWwgY2FjaGUgYXJlIG5vdFxuICogdGFrZW4gaW50byBjb25zaWRlcmF0aW9uLCBuZWl0aGVyIGFyZSBsb2NhbCBtb2RpZmljYXRpb25zIG5vdCB5ZXRcbiAqIHN5bmNocm9uaXplZCB3aXRoIHRoZSBzZXJ2ZXIuIFByZXZpb3VzbHktZG93bmxvYWRlZCByZXN1bHRzLCBpZiBhbnksIGFyZSBub3RcbiAqIHVzZWQ6IGV2ZXJ5IHJlcXVlc3QgdXNpbmcgdGhpcyBzb3VyY2UgbmVjZXNzYXJpbHkgaW52b2x2ZXMgYSByb3VuZCB0cmlwIHRvXG4gKiB0aGUgc2VydmVyLlxuICpcbiAqIEBwYXJhbSBxdWVyeSBUaGUgcXVlcnkgd2hvc2UgcmVzdWx0IHNldCB0byBhZ2dyZWdhdGUgb3Zlci5cbiAqIEBwYXJhbSBhZ2dyZWdhdGVTcGVjIEFuIGBBZ2dyZWdhdGVTcGVjYCBvYmplY3QgdGhhdCBzcGVjaWZpZXMgdGhlIGFnZ3JlZ2F0ZXNcbiAqIHRvIHBlcmZvcm0gb3ZlciB0aGUgcmVzdWx0IHNldC4gVGhlIEFnZ3JlZ2F0ZVNwZWMgc3BlY2lmaWVzIGFsaWFzZXMgZm9yIGVhY2hcbiAqIGFnZ3JlZ2F0ZSwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gcmV0cmlldmUgdGhlIGFnZ3JlZ2F0ZSByZXN1bHQuXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogY29uc3QgYWdncmVnYXRlU25hcHNob3QgPSBhd2FpdCBnZXRBZ2dyZWdhdGVGcm9tU2VydmVyKHF1ZXJ5LCB7XG4gKiAgIGNvdW50T2ZEb2NzOiBjb3VudCgpLFxuICogICB0b3RhbEhvdXJzOiBzdW0oJ2hvdXJzJyksXG4gKiAgIGF2ZXJhZ2VTY29yZTogYXZlcmFnZSgnc2NvcmUnKVxuICogfSk7XG4gKlxuICogY29uc3QgY291bnRPZkRvY3M6IG51bWJlciA9IGFnZ3JlZ2F0ZVNuYXBzaG90LmRhdGEoKS5jb3VudE9mRG9jcztcbiAqIGNvbnN0IHRvdGFsSG91cnM6IG51bWJlciA9IGFnZ3JlZ2F0ZVNuYXBzaG90LmRhdGEoKS50b3RhbEhvdXJzO1xuICogY29uc3QgYXZlcmFnZVNjb3JlOiBudW1iZXIgfCBudWxsID0gYWdncmVnYXRlU25hcHNob3QuZGF0YSgpLmF2ZXJhZ2VTY29yZTtcbiAqIGBgYFxuICogQGludGVybmFsIFRPRE8gKHN1bS9hdmcpIHJlbW92ZSB3aGVuIHB1YmxpY1xuICovIGZ1bmN0aW9uIGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgciA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQobiksIGkgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbWFwVG9BcnJheShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByIGluIGUpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCByKSAmJiBuLnB1c2godChlW3JdLCByLCBlKSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH0odCwgKChlLCB0KSA9PiBuZXcgX19QUklWQVRFX0FnZ3JlZ2F0ZUltcGwodCwgZS5fYWdncmVnYXRlVHlwZSwgZS5faW50ZXJuYWxGaWVsZFBhdGgpKSk7XG4gICAgLy8gUnVuIHRoZSBhZ2dyZWdhdGlvbiBhbmQgY29udmVydCB0aGUgcmVzdWx0c1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50UnVuQWdncmVnYXRlUXVlcnkoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICAgICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPIChzdW0vYXZnKSBzaG91bGQgd2UgdXBkYXRlIHRoaXMgdG8gdXNlIHRoZSBldmVudCBtYW5hZ2VyP1xuICAgICAgICAgICAgLy8gSW1wbGVtZW50IGFuZCBjYWxsIGV4ZWN1dGVBZ2dyZWdhdGVRdWVyeVZpYVNuYXBzaG90TGlzdGVuZXIsIHNpbWlsYXJcbiAgICAgICAgICAgIC8vIHRvIHRoZSBpbXBsZW1lbnRhdGlvbiBpbiBmaXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyXG4gICAgICAgICAgICAvLyBhYm92ZVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGIvMjc3NjI4Mzg0KTogY2hlY2sgYGNhblVzZU5ldHdvcmsoKWAgYW5kIGhhbmRsZSBtdWx0aS10YWIuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGF3YWl0IF9fUFJJVkFURV9nZXREYXRhc3RvcmUoZSk7XG4gICAgICAgICAgICAgICAgci5yZXNvbHZlKF9fUFJJVkFURV9pbnZva2VSdW5BZ2dyZWdhdGlvblF1ZXJ5UnBjKGksIHQsIG4pKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByLnJlamVjdChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCByLnByb21pc2U7XG4gICAgfShyLCBlLl9xdWVyeSwgaSkudGhlbigodCA9PiBcbiAgICAvKipcbiAqIENvbnZlcnRzIHRoZSBjb3JlIGFnZ3JlZ3JhdGlvbiByZXN1bHQgdG8gYW4gYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgXG4gKiB0aGF0IGNhbiBiZSByZXR1cm5lZCB0byB0aGUgY29uc3VtZXIuXG4gKiBAcGFyYW0gcXVlcnlcbiAqIEBwYXJhbSBhZ2dyZWdhdGVSZXN1bHQgQ29yZSBhZ2dyZWdhdGlvbiByZXN1bHRcbiAqIEBpbnRlcm5hbFxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRUb0FnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3QoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcihlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90KHQsIHIsIG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAobiwgZSwgdCkpKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeUxvY2FsQ2FjaGVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwibWVtb3J5XCIsIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gbmV3IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLCBcbiAgICAgICAgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZ2FyYmFnZUNvbGxlY3RvcikgPyB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBlLmdhcmJhZ2VDb2xsZWN0b3IuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA6IHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IG5ldyBNZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXI7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZFxuICAgICAgICB9O1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX1BlcnNpc3RlbnRMb2NhbENhY2hlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBsZXQgdDtcbiAgICAgICAgdGhpcy5raW5kID0gXCJwZXJzaXN0ZW50XCIsIChudWxsID09IGUgPyB2b2lkIDAgOiBlLnRhYk1hbmFnZXIpID8gKGUudGFiTWFuYWdlci5faW5pdGlhbGl6ZShlKSwgXG4gICAgICAgIHQgPSBlLnRhYk1hbmFnZXIpIDogKHQgPSBwZXJzaXN0ZW50U2luZ2xlVGFiTWFuYWdlcih2b2lkIDApLCB0Ll9pbml0aWFsaXplKGUpKSwgXG4gICAgICAgIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gdC5fb25saW5lQ29tcG9uZW50UHJvdmlkZXIsIHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IHQuX29mZmxpbmVDb21wb25lbnRQcm92aWRlcjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5RWFnZXJHYWJhZ2VDb2xsZWN0b3JJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5raW5kID0gXCJtZW1vcnlFYWdlclwiLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBuZXcgTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMcnVHYWJhZ2VDb2xsZWN0b3JJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwibWVtb3J5THJ1XCIsIHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IG5ldyBfX1BSSVZBVEVfTHJ1R2NNZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSk7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZFxuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3JgLiBUaGlzIGlzIGFsc28gdGhlXG4gKiBkZWZhdWx0IGdhcmJhZ2UgY29sbGVjdG9yIHVubGVzcyBpdCBpcyBleHBsaWNpdGx5IHNwZWNpZmllZCBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gbWVtb3J5RWFnZXJHYXJiYWdlQ29sbGVjdG9yKCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeUVhZ2VyR2FiYWdlQ29sbGVjdG9ySW1wbDtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9yYC5cbiAqXG4gKiBBIHRhcmdldCBzaXplIGNhbiBiZSBzcGVjaWZpZWQgYXMgcGFydCBvZiB0aGUgc2V0dGluZyBwYXJhbWV0ZXIuIFRoZVxuICogY29sbGVjdG9yIHdpbGwgc3RhcnQgZGVsZXRpbmcgZG9jdW1lbnRzIG9uY2UgdGhlIGNhY2hlIHNpemUgZXhjZWVkc1xuICogdGhlIGdpdmVuIHNpemUuIFRoZSBkZWZhdWx0IGNhY2hlIHNpemUgaXMgNDBNQiAoNDAgKiAxMDI0ICogMTAyNCBieXRlcykuXG4gKi8gZnVuY3Rpb24gbWVtb3J5THJ1R2FyYmFnZUNvbGxlY3RvcihlKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5THJ1R2FiYWdlQ29sbGVjdG9ySW1wbChudWxsID09IGUgPyB2b2lkIDAgOiBlLmNhY2hlU2l6ZUJ5dGVzKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNZW1vcnlMb2NhbENhY2hlYC4gVGhlIGluc3RhbmNlIGNhbiBiZSBzZXQgdG9cbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgdG8gdGVsbCB0aGUgU0RLIHdoaWNoIGNhY2hlIGxheWVyIHRvIHVzZS5cbiAqLyBmdW5jdGlvbiBtZW1vcnlMb2NhbENhY2hlKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBQZXJzaXN0ZW50TG9jYWxDYWNoZWAuIFRoZSBpbnN0YW5jZSBjYW4gYmUgc2V0IHRvXG4gKiBgRmlyZXN0b3JlU2V0dGluZ3MuY2FjaGVgIHRvIHRlbGwgdGhlIFNESyB3aGljaCBjYWNoZSBsYXllciB0byB1c2UuXG4gKlxuICogUGVyc2lzdGVudCBjYWNoZSBjYW5ub3QgYmUgdXNlZCBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudExvY2FsQ2FjaGUoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BlcnNpc3RlbnRMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX1NpbmdsZVRhYk1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZm9yY2VPd25lcnNoaXAgPSBlLCB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRTaW5nbGVUYWJcIjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqLyAgICBfaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gbmV3IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYk9mZmxpbmVDb21wb25lbnRQcm92aWRlcih0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciwgbnVsbCA9PSBlID8gdm9pZCAwIDogZS5jYWNoZVNpemVCeXRlcywgdGhpcy5mb3JjZU93bmVyc2hpcCk7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTXVsdGlUYWJNYW5hZ2VySW1wbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwiUGVyc2lzdGVudE11bHRpcGxlVGFiXCI7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi8gICAgX2luaXRpYWxpemUoZSkge1xuICAgICAgICB0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciA9IG5ldyBPbmxpbmVDb21wb25lbnRQcm92aWRlciwgdGhpcy5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyID0gbmV3IF9fUFJJVkFURV9NdWx0aVRhYk9mZmxpbmVDb21wb25lbnRQcm92aWRlcih0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciwgbnVsbCA9PSBlID8gdm9pZCAwIDogZS5jYWNoZVNpemVCeXRlcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYFBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyYC5cbiAqXG4gKiBAcGFyYW0gc2V0dGluZ3MgQ29uZmlndXJlcyB0aGUgY3JlYXRlZCB0YWIgbWFuYWdlci5cbiAqLyBmdW5jdGlvbiBwZXJzaXN0ZW50U2luZ2xlVGFiTWFuYWdlcihlKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2luZ2xlVGFiTWFuYWdlckltcGwobnVsbCA9PSBlID8gdm9pZCAwIDogZS5mb3JjZU93bmVyc2hpcCk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcmAuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcigpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NdWx0aVRhYk1hbmFnZXJJbXBsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCB3ZSA9IHtcbiAgICBtYXhBdHRlbXB0czogNVxufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSB3cml0ZSBiYXRjaCwgdXNlZCB0byBwZXJmb3JtIG11bHRpcGxlIHdyaXRlcyBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAqXG4gKiBBIGBXcml0ZUJhdGNoYCBvYmplY3QgY2FuIGJlIGFjcXVpcmVkIGJ5IGNhbGxpbmcge0BsaW5rIHdyaXRlQmF0Y2h9LiBJdFxuICogcHJvdmlkZXMgbWV0aG9kcyBmb3IgYWRkaW5nIHdyaXRlcyB0byB0aGUgd3JpdGUgYmF0Y2guIE5vbmUgb2YgdGhlIHdyaXRlc1xuICogd2lsbCBiZSBjb21taXR0ZWQgKG9yIHZpc2libGUgbG9jYWxseSkgdW50aWwge0BsaW5rIFdyaXRlQmF0Y2guY29tbWl0fSBpc1xuICogY2FsbGVkLlxuICovXG5jbGFzcyBXcml0ZUJhdGNoIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fY29tbWl0SGFuZGxlciA9IHQsIHRoaXMuX211dGF0aW9ucyA9IFtdLCB0aGlzLl9jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIHRoaXMuX2RhdGFSZWFkZXIgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSk7XG4gICAgfVxuICAgIHNldChlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeU5vdENvbW1pdHRlZCgpO1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSksIGkgPSBfX1BSSVZBVEVfYXBwbHlGaXJlc3RvcmVEYXRhQ29udmVydGVyKHIuY29udmVydGVyLCB0LCBuKSwgcyA9IF9fUFJJVkFURV9wYXJzZVNldERhdGEodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnNldFwiLCByLl9rZXksIGksIG51bGwgIT09IHIuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihyLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgdGhpcztcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQsIG4sIC4uLnIpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gcyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSB8fCB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyh0aGlzLl9kYXRhUmVhZGVyLCBcIldyaXRlQmF0Y2gudXBkYXRlXCIsIGkuX2tleSwgdCwgbiwgcikgOiBfX1BSSVZBVEVfcGFyc2VVcGRhdGVEYXRhKHRoaXMuX2RhdGFSZWFkZXIsIFwiV3JpdGVCYXRjaC51cGRhdGVcIiwgaS5fa2V5LCB0KSwgXG4gICAgICAgIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihpLl9rZXksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHJldHVybnMgVGhpcyBgV3JpdGVCYXRjaGAgaW5zdGFuY2UuIFVzZWQgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgICAgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucyA9IHRoaXMuX211dGF0aW9ucy5jb25jYXQobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbih0Ll9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbW1pdHMgYWxsIG9mIHRoZSB3cml0ZXMgaW4gdGhpcyB3cml0ZSBiYXRjaCBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAgICAgKlxuICAgICAqIFRoZSByZXN1bHQgb2YgdGhlc2Ugd3JpdGVzIHdpbGwgb25seSBiZSByZWZsZWN0ZWQgaW4gZG9jdW1lbnQgcmVhZHMgdGhhdFxuICAgICAqIG9jY3VyIGFmdGVyIHRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzLiBJZiB0aGUgY2xpZW50IGlzIG9mZmxpbmUsIHRoZVxuICAgICAqIHdyaXRlIGZhaWxzLiBJZiB5b3Ugd291bGQgbGlrZSB0byBzZWUgbG9jYWwgbW9kaWZpY2F0aW9ucyBvciBidWZmZXIgd3JpdGVzXG4gICAgICogdW50aWwgdGhlIGNsaWVudCBpcyBvbmxpbmUsIHVzZSB0aGUgZnVsbCBGaXJlc3RvcmUgU0RLLlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgb25jZSBhbGwgb2YgdGhlIHdyaXRlcyBpbiB0aGUgYmF0Y2ggaGF2ZSBiZWVuXG4gICAgICogc3VjY2Vzc2Z1bGx5IHdyaXR0ZW4gdG8gdGhlIGJhY2tlbmQgYXMgYW4gYXRvbWljIHVuaXQgKG5vdGUgdGhhdCBpdCB3b24ndFxuICAgICAqIHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICAgICAqLyAgICBjb21taXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKSwgdGhpcy5fY29tbWl0dGVkID0gITAsIHRoaXMuX211dGF0aW9ucy5sZW5ndGggPiAwID8gdGhpcy5fY29tbWl0SGFuZGxlcih0aGlzLl9tdXRhdGlvbnMpIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIF92ZXJpZnlOb3RDb21taXR0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb21taXR0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LkZBSUxFRF9QUkVDT05ESVRJT04sIFwiQSB3cml0ZSBiYXRjaCBjYW4gbm8gbG9uZ2VyIGJlIHVzZWQgYWZ0ZXIgY29tbWl0KCkgaGFzIGJlZW4gY2FsbGVkLlwiKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0KSB7XG4gICAgaWYgKChlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKS5maXJlc3RvcmUgIT09IHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcih2LklOVkFMSURfQVJHVU1FTlQsIFwiUHJvdmlkZWQgZG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIGluc3RhbmNlLlwiKTtcbiAgICByZXR1cm4gZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRPRE8obXJzY2htaWR0KSBDb25zaWRlciB1c2luZyBgQmFzZVRyYW5zYWN0aW9uYCBhcyB0aGUgYmFzZSBjbGFzcyBpbiB0aGVcbi8vIGxlZ2FjeSBTREsuXG4vKipcbiAqIEEgcmVmZXJlbmNlIHRvIGEgdHJhbnNhY3Rpb24uXG4gKlxuICogVGhlIGBUcmFuc2FjdGlvbmAgb2JqZWN0IHBhc3NlZCB0byBhIHRyYW5zYWN0aW9uJ3MgYHVwZGF0ZUZ1bmN0aW9uYCBwcm92aWRlc1xuICogdGhlIG1ldGhvZHMgdG8gcmVhZCBhbmQgd3JpdGUgZGF0YSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIGNvbnRleHQuIFNlZVxuICoge0BsaW5rIHJ1blRyYW5zYWN0aW9ufS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gYSB0cmFuc2FjdGlvbi5cbiAqXG4gKiBUaGUgYFRyYW5zYWN0aW9uYCBvYmplY3QgcGFzc2VkIHRvIGEgdHJhbnNhY3Rpb24ncyBgdXBkYXRlRnVuY3Rpb25gIHByb3ZpZGVzXG4gKiB0aGUgbWV0aG9kcyB0byByZWFkIGFuZCB3cml0ZSBkYXRhIHdpdGhpbiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dC4gU2VlXG4gKiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovXG5jbGFzcyBUcmFuc2FjdGlvbiBleHRlbmRzIGNsYXNzIFRyYW5zYWN0aW9uJDEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSBlLCB0aGlzLl90cmFuc2FjdGlvbiA9IHQsIHRoaXMuX2RhdGFSZWFkZXIgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcmVuY2VkIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIHJlYWQuXG4gICAgICogQHJldHVybnMgQSBgRG9jdW1lbnRTbmFwc2hvdGAgd2l0aCB0aGUgcmVhZCBkYXRhLlxuICAgICAqLyAgICBnZXQoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSksIG4gPSBuZXcgX19QUklWQVRFX0xpdGVVc2VyRGF0YVdyaXRlcih0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNhY3Rpb24ubG9va3VwKFsgdC5fa2V5IF0pLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgaWYgKCFlIHx8IDEgIT09IGUubGVuZ3RoKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICAgICAgY29uc3QgciA9IGVbMF07XG4gICAgICAgICAgICBpZiAoci5pc0ZvdW5kRG9jdW1lbnQoKSkgcmV0dXJuIG5ldyBEb2N1bWVudFNuYXBzaG90JDEodGhpcy5fZmlyZXN0b3JlLCBuLCByLmtleSwgciwgdC5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgaWYgKHIuaXNOb0RvY3VtZW50KCkpIHJldHVybiBuZXcgRG9jdW1lbnRTbmFwc2hvdCQxKHRoaXMuX2ZpcmVzdG9yZSwgbiwgdC5fa2V5LCBudWxsLCB0LmNvbnZlcnRlcik7XG4gICAgICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0KGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBpID0gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihyLmNvbnZlcnRlciwgdCwgbiksIHMgPSBfX1BSSVZBVEVfcGFyc2VTZXREYXRhKHRoaXMuX2RhdGFSZWFkZXIsIFwiVHJhbnNhY3Rpb24uc2V0XCIsIHIuX2tleSwgaSwgbnVsbCAhPT0gci5jb252ZXJ0ZXIsIG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNhY3Rpb24uc2V0KHIuX2tleSwgcyksIHRoaXM7XG4gICAgfVxuICAgIHVwZGF0ZShlLCB0LCBuLCAuLi5yKSB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gcyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSB8fCB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnVwZGF0ZVwiLCBpLl9rZXksIHQsIG4sIHIpIDogX19QUklWQVRFX3BhcnNlVXBkYXRlRGF0YSh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnVwZGF0ZVwiLCBpLl9rZXksIHQpLCBcbiAgICAgICAgdGhpcy5fdHJhbnNhY3Rpb24udXBkYXRlKGkuX2tleSwgcyksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHJldHVybnMgVGhpcyBgVHJhbnNhY3Rpb25gIGluc3RhbmNlLiBVc2VkIGZvciBjaGFpbmluZyBtZXRob2QgY2FsbHMuXG4gICAgICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zYWN0aW9uLmRlbGV0ZSh0Ll9rZXkpLCB0aGlzO1xuICAgIH1cbn0ge1xuICAgIC8vIFRoaXMgY2xhc3MgaW1wbGVtZW50cyB0aGUgc2FtZSBsb2dpYyBhcyB0aGUgVHJhbnNhY3Rpb24gQVBJIGluIHRoZSBMaXRlIFNES1xuICAgIC8vIGJ1dCBpcyBzdWJjbGFzc2VkIGluIG9yZGVyIHRvIHJldHVybiBpdHMgb3duIERvY3VtZW50U25hcHNob3QgdHlwZXMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIHQpLCB0aGlzLl9maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJlbmNlZCBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSByZWFkLlxuICAgICAqIEByZXR1cm5zIEEgYERvY3VtZW50U25hcHNob3RgIHdpdGggdGhlIHJlYWQgZGF0YS5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KGUpLnRoZW4oKGUgPT4gbmV3IERvY3VtZW50U25hcHNob3QodGhpcy5fZmlyZXN0b3JlLCBuLCB0Ll9rZXksIGUuX2RvY3VtZW50LCBuZXcgU25hcHNob3RNZXRhZGF0YShcbiAgICAgICAgLyogaGFzUGVuZGluZ1dyaXRlcz0gKi8gITEsIFxuICAgICAgICAvKiBmcm9tQ2FjaGU9ICovICExKSwgdC5jb252ZXJ0ZXIpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBnaXZlbiBgdXBkYXRlRnVuY3Rpb25gIGFuZCB0aGVuIGF0dGVtcHRzIHRvIGNvbW1pdCB0aGUgY2hhbmdlc1xuICogYXBwbGllZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uLiBJZiBhbnkgZG9jdW1lbnQgcmVhZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBoYXMgY2hhbmdlZCwgQ2xvdWQgRmlyZXN0b3JlIHJldHJpZXMgdGhlIGB1cGRhdGVGdW5jdGlvbmAuIElmIGl0IGZhaWxzIHRvXG4gKiBjb21taXQgYWZ0ZXIgNSBhdHRlbXB0cywgdGhlIHRyYW5zYWN0aW9uIGZhaWxzLlxuICpcbiAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB3cml0ZXMgYWxsb3dlZCBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbiBpcyA1MDAuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBGaXJlc3RvcmUgZGF0YWJhc2UgdG8gcnVuIHRoaXNcbiAqIHRyYW5zYWN0aW9uIGFnYWluc3QuXG4gKiBAcGFyYW0gdXBkYXRlRnVuY3Rpb24gLSBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBjb250ZXh0LlxuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgbWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHMgdG9cbiAqIGNvbW1pdC5cbiAqIEByZXR1cm5zIElmIHRoZSB0cmFuc2FjdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IG9yIHdhcyBleHBsaWNpdGx5IGFib3J0ZWRcbiAqICh0aGUgYHVwZGF0ZUZ1bmN0aW9uYCByZXR1cm5lZCBhIGZhaWxlZCBwcm9taXNlKSwgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlXG4gKiBgdXBkYXRlRnVuY3Rpb24gYGlzIHJldHVybmVkIGhlcmUuIE90aGVyd2lzZSwgaWYgdGhlIHRyYW5zYWN0aW9uIGZhaWxlZCwgYVxuICogcmVqZWN0ZWQgcHJvbWlzZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGZhaWx1cmUgZXJyb3IgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpO1xuICAgIGNvbnN0IHIgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHdlKSwgbik7XG4gICAgIWZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVRyYW5zYWN0aW9uT3B0aW9ucyhlKSB7XG4gICAgICAgIGlmIChlLm1heEF0dGVtcHRzIDwgMSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJNYXggYXR0ZW1wdHMgbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgIH0ocik7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRUcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0RGF0YXN0b3JlKGUpO1xuICAgICAgICAgICAgbmV3IF9fUFJJVkFURV9UcmFuc2FjdGlvblJ1bm5lcihlLmFzeW5jUXVldWUsIGksIG4sIHQsIHIpLnJ1bigpO1xuICAgICAgICB9KSksIHIucHJvbWlzZTtcbiAgICB9KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSksIChuID0+IHQobmV3IFRyYW5zYWN0aW9uKGUsIG4pKSksIHIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIGEgc2VudGluZWwgZm9yIHVzZSB3aXRoIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gb3JcbiAqIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHNldERvYzoxKX0gd2l0aCBge21lcmdlOiB0cnVlfWAgdG8gbWFyayBhIGZpZWxkIGZvciBkZWxldGlvbi5cbiAqLyBmdW5jdGlvbiBkZWxldGVGaWVsZCgpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9EZWxldGVGaWVsZFZhbHVlSW1wbChcImRlbGV0ZUZpZWxkXCIpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzZW50aW5lbCB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IHRvXG4gKiBpbmNsdWRlIGEgc2VydmVyLWdlbmVyYXRlZCB0aW1lc3RhbXAgaW4gdGhlIHdyaXR0ZW4gZGF0YS5cbiAqLyBmdW5jdGlvbiBzZXJ2ZXJUaW1lc3RhbXAoKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wRmllbGRWYWx1ZUltcGwoXCJzZXJ2ZXJUaW1lc3RhbXBcIik7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgdmFsdWUgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHNldERvYzoxKX0gb3Ige0BsaW5rXG4gKiBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gdGhhdCB0ZWxscyB0aGUgc2VydmVyIHRvIHVuaW9uIHRoZSBnaXZlbiBlbGVtZW50cyB3aXRoIGFueSBhcnJheVxuICogdmFsdWUgdGhhdCBhbHJlYWR5IGV4aXN0cyBvbiB0aGUgc2VydmVyLiBFYWNoIHNwZWNpZmllZCBlbGVtZW50IHRoYXQgZG9lc24ndFxuICogYWxyZWFkeSBleGlzdCBpbiB0aGUgYXJyYXkgd2lsbCBiZSBhZGRlZCB0byB0aGUgZW5kLiBJZiB0aGUgZmllbGQgYmVpbmdcbiAqIG1vZGlmaWVkIGlzIG5vdCBhbHJlYWR5IGFuIGFycmF5IGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW4gd2l0aCBhbiBhcnJheVxuICogY29udGFpbmluZyBleGFjdGx5IHRoZSBzcGVjaWZpZWQgZWxlbWVudHMuXG4gKlxuICogQHBhcmFtIGVsZW1lbnRzIC0gVGhlIGVsZW1lbnRzIHRvIHVuaW9uIGludG8gdGhlIGFycmF5LlxuICogQHJldHVybnMgVGhlIGBGaWVsZFZhbHVlYCBzZW50aW5lbCBmb3IgdXNlIGluIGEgY2FsbCB0byBgc2V0RG9jKClgIG9yXG4gKiBgdXBkYXRlRG9jKClgLlxuICovIGZ1bmN0aW9uIGFycmF5VW5pb24oLi4uZSkge1xuICAgIC8vIE5PVEU6IFdlIGRvbid0IGFjdHVhbGx5IHBhcnNlIHRoZSBkYXRhIHVudGlsIGl0J3MgdXNlZCBpbiBzZXQoKSBvclxuICAgIC8vIHVwZGF0ZSgpIHNpbmNlIHdlJ2QgbmVlZCB0aGUgRmlyZXN0b3JlIGluc3RhbmNlIHRvIGRvIHRoaXMuXG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfQXJyYXlVbmlvbkZpZWxkVmFsdWVJbXBsKFwiYXJyYXlVbmlvblwiLCBlKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIChzZXREb2M6MSl9IG9yIHtAbGlua1xuICogdXBkYXRlRG9jOjF9IHRoYXQgdGVsbHMgdGhlIHNlcnZlciB0byByZW1vdmUgdGhlIGdpdmVuIGVsZW1lbnRzIGZyb20gYW55XG4gKiBhcnJheSB2YWx1ZSB0aGF0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIuIEFsbCBpbnN0YW5jZXMgb2YgZWFjaCBlbGVtZW50XG4gKiBzcGVjaWZpZWQgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIGFycmF5LiBJZiB0aGUgZmllbGQgYmVpbmcgbW9kaWZpZWQgaXMgbm90XG4gKiBhbHJlYWR5IGFuIGFycmF5IGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW4gd2l0aCBhbiBlbXB0eSBhcnJheS5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgdG8gcmVtb3ZlIGZyb20gdGhlIGFycmF5LlxuICogQHJldHVybnMgVGhlIGBGaWVsZFZhbHVlYCBzZW50aW5lbCBmb3IgdXNlIGluIGEgY2FsbCB0byBgc2V0RG9jKClgIG9yXG4gKiBgdXBkYXRlRG9jKClgXG4gKi8gZnVuY3Rpb24gYXJyYXlSZW1vdmUoLi4uZSkge1xuICAgIC8vIE5PVEU6IFdlIGRvbid0IGFjdHVhbGx5IHBhcnNlIHRoZSBkYXRhIHVudGlsIGl0J3MgdXNlZCBpbiBzZXQoKSBvclxuICAgIC8vIHVwZGF0ZSgpIHNpbmNlIHdlJ2QgbmVlZCB0aGUgRmlyZXN0b3JlIGluc3RhbmNlIHRvIGRvIHRoaXMuXG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfQXJyYXlSZW1vdmVGaWVsZFZhbHVlSW1wbChcImFycmF5UmVtb3ZlXCIsIGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IG9yIHtAbGlua1xuICogQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyh1cGRhdGVEb2M6MSl9IHRoYXQgdGVsbHMgdGhlIHNlcnZlciB0byBpbmNyZW1lbnQgdGhlIGZpZWxkJ3MgY3VycmVudCB2YWx1ZSBieVxuICogdGhlIGdpdmVuIHZhbHVlLlxuICpcbiAqIElmIGVpdGhlciB0aGUgb3BlcmFuZCBvciB0aGUgY3VycmVudCBmaWVsZCB2YWx1ZSB1c2VzIGZsb2F0aW5nIHBvaW50XG4gKiBwcmVjaXNpb24sIGFsbCBhcml0aG1ldGljIGZvbGxvd3MgSUVFRSA3NTQgc2VtYW50aWNzLiBJZiBib3RoIHZhbHVlcyBhcmVcbiAqIGludGVnZXJzLCB2YWx1ZXMgb3V0c2lkZSBvZiBKYXZhU2NyaXB0J3Mgc2FmZSBudW1iZXIgcmFuZ2VcbiAqIChgTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJgIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmApIGFyZSBhbHNvIHN1YmplY3QgdG9cbiAqIHByZWNpc2lvbiBsb3NzLiBGdXJ0aGVybW9yZSwgb25jZSBwcm9jZXNzZWQgYnkgdGhlIEZpcmVzdG9yZSBiYWNrZW5kLCBhbGxcbiAqIGludGVnZXIgb3BlcmF0aW9ucyBhcmUgY2FwcGVkIGJldHdlZW4gLTJeNjMgYW5kIDJeNjMtMS5cbiAqXG4gKiBJZiB0aGUgY3VycmVudCBmaWVsZCB2YWx1ZSBpcyBub3Qgb2YgdHlwZSBgbnVtYmVyYCwgb3IgaWYgdGhlIGZpZWxkIGRvZXMgbm90XG4gKiB5ZXQgZXhpc3QsIHRoZSB0cmFuc2Zvcm1hdGlvbiBzZXRzIHRoZSBmaWVsZCB0byB0aGUgZ2l2ZW4gdmFsdWUuXG4gKlxuICogQHBhcmFtIG4gLSBUaGUgdmFsdWUgdG8gaW5jcmVtZW50IGJ5LlxuICogQHJldHVybnMgVGhlIGBGaWVsZFZhbHVlYCBzZW50aW5lbCBmb3IgdXNlIGluIGEgY2FsbCB0byBgc2V0RG9jKClgIG9yXG4gKiBgdXBkYXRlRG9jKClgXG4gKi8gZnVuY3Rpb24gaW5jcmVtZW50KGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50RmllbGRWYWx1ZUltcGwoXCJpbmNyZW1lbnRcIiwgZSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZXMgYSB3cml0ZSBiYXRjaCwgdXNlZCBmb3IgcGVyZm9ybWluZyBtdWx0aXBsZSB3cml0ZXMgYXMgYSBzaW5nbGVcbiAqIGF0b21pYyBvcGVyYXRpb24uIFRoZSBtYXhpbXVtIG51bWJlciBvZiB3cml0ZXMgYWxsb3dlZCBpbiBhIHNpbmdsZSB7QGxpbmsgV3JpdGVCYXRjaH1cbiAqIGlzIDUwMC5cbiAqXG4gKiBVbmxpa2UgdHJhbnNhY3Rpb25zLCB3cml0ZSBiYXRjaGVzIGFyZSBwZXJzaXN0ZWQgb2ZmbGluZSBhbmQgdGhlcmVmb3JlIGFyZVxuICogcHJlZmVyYWJsZSB3aGVuIHlvdSBkb24ndCBuZWVkIHRvIGNvbmRpdGlvbiB5b3VyIHdyaXRlcyBvbiByZWFkIGRhdGEuXG4gKlxuICogQHJldHVybnMgQSB7QGxpbmsgV3JpdGVCYXRjaH0gdGhhdCBjYW4gYmUgdXNlZCB0byBhdG9taWNhbGx5IGV4ZWN1dGUgbXVsdGlwbGVcbiAqIHdyaXRlcy5cbiAqLyBmdW5jdGlvbiB3cml0ZUJhdGNoKGUpIHtcbiAgICByZXR1cm4gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSksIG5ldyBXcml0ZUJhdGNoKGUsICh0ID0+IGV4ZWN1dGVXcml0ZShlLCB0KSkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBzZXRJbmRleENvbmZpZ3VyYXRpb24oZSwgdCkge1xuICAgIHZhciBuO1xuICAgIGNvbnN0IHIgPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKTtcbiAgICBpZiAoIXIuX3VuaW5pdGlhbGl6ZWRDb21wb25lbnRzUHJvdmlkZXIgfHwgXCJtZW1vcnlcIiA9PT0gKG51bGwgPT09IChuID0gci5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlcikgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5fb2ZmbGluZUtpbmQpKSBcbiAgICAvLyBQT1JUSU5HIE5PVEU6IFdlIGRvbid0IHJldHVybiBhbiBlcnJvciBpZiB0aGUgdXNlciBoYXMgbm90IGVuYWJsZWRcbiAgICAvLyBwZXJzaXN0ZW5jZSBzaW5jZSBgZW5hYmxlSW5kZXhlZGRiUGVyc2lzdGVuY2UoKWAgY2FuIGZhaWwgb24gdGhlIFdlYi5cbiAgICByZXR1cm4gX19QUklWQVRFX2xvZ1dhcm4oXCJDYW5ub3QgZW5hYmxlIGluZGV4ZXMgd2hlbiBwZXJzaXN0ZW5jZSBpcyBkaXNhYmxlZFwiKSwgXG4gICAgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgY29uc3QgaSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZUluZGV4ZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV90cnlQYXJzZUpzb24oZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShlKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3Iodi5JTlZBTElEX0FSR1VNRU5ULCBcIkZhaWxlZCB0byBwYXJzZSBKU09OOiBcIiArIChudWxsID09IGUgPyB2b2lkIDAgOiBlLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfShlKSA6IGUsIG4gPSBbXTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodC5pbmRleGVzKSkgZm9yIChjb25zdCBlIG9mIHQuaW5kZXhlcykge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV90cnlHZXRTdHJpbmcoZSwgXCJjb2xsZWN0aW9uR3JvdXBcIiksIHIgPSBbXTtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUuZmllbGRzKSkgZm9yIChjb25zdCB0IG9mIGUuZmllbGRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKFwic2V0SW5kZXhDb25maWd1cmF0aW9uXCIsIF9fUFJJVkFURV90cnlHZXRTdHJpbmcodCwgXCJmaWVsZFBhdGhcIikpO1xuICAgICAgICAgICAgICAgIFwiQ09OVEFJTlNcIiA9PT0gdC5hcnJheUNvbmZpZyA/IHIucHVzaChuZXcgSW5kZXhTZWdtZW50KGUsIDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovKSkgOiBcIkFTQ0VORElOR1wiID09PSB0Lm9yZGVyID8gci5wdXNoKG5ldyBJbmRleFNlZ21lbnQoZSwgMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovKSkgOiBcIkRFU0NFTkRJTkdcIiA9PT0gdC5vcmRlciAmJiByLnB1c2gobmV3IEluZGV4U2VnbWVudChlLCAxIC8qIEluZGV4S2luZC5ERVNDRU5ESU5HICovKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuLnB1c2gobmV3IEZpZWxkSW5kZXgoRmllbGRJbmRleC5VTktOT1dOX0lELCB0LCByLCBJbmRleFN0YXRlLmVtcHR5KCkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbjtcbiAgICB9KHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50U2V0SW5kZXhDb25maWd1cmF0aW9uKHIsIGkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdHJ5R2V0U3RyaW5nKGUsIHQpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgZVt0XSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgXCJNaXNzaW5nIHN0cmluZyB2YWx1ZSBmb3I6IFwiICsgdCk7XG4gICAgcmV0dXJuIGVbdF07XG59XG5cbi8qKlxuICogQ2xvdWQgRmlyZXN0b3JlXG4gKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKi8gIWZ1bmN0aW9uIF9fUFJJVkFURV9yZWdpc3RlckZpcmVzdG9yZShlLCB0ID0gITApIHtcbiAgICAhZnVuY3Rpb24gX19QUklWQVRFX3NldFNES1ZlcnNpb24oZSkge1xuICAgICAgICBiID0gZTtcbiAgICB9KFNES19WRVJTSU9OKSwgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJmaXJlc3RvcmVcIiwgKChlLCB7aW5zdGFuY2VJZGVudGlmaWVyOiBuLCBvcHRpb25zOiByfSkgPT4ge1xuICAgICAgICBjb25zdCBpID0gZS5nZXRQcm92aWRlcihcImFwcFwiKS5nZXRJbW1lZGlhdGUoKSwgcyA9IG5ldyBGaXJlc3RvcmUobmV3IF9fUFJJVkFURV9GaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKGUuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIpKSwgbmV3IF9fUFJJVkFURV9GaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlcihlLmdldFByb3ZpZGVyKFwiYXBwLWNoZWNrLWludGVybmFsXCIpKSwgZnVuY3Rpb24gX19QUklWQVRFX2RhdGFiYXNlSWRGcm9tQXBwKGUsIHQpIHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5hcHBseShlLm9wdGlvbnMsIFsgXCJwcm9qZWN0SWRcIiBdKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKHYuSU5WQUxJRF9BUkdVTUVOVCwgJ1wicHJvamVjdElkXCIgbm90IHByb3ZpZGVkIGluIGZpcmViYXNlLmluaXRpYWxpemVBcHAuJyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSWQoZS5vcHRpb25zLnByb2plY3RJZCwgdCk7XG4gICAgICAgIH0oaSwgbiksIGkpO1xuICAgICAgICByZXR1cm4gciA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgdXNlRmV0Y2hTdHJlYW1zOiB0XG4gICAgICAgIH0sIHIpLCBzLl9zZXRTZXR0aW5ncyhyKSwgcztcbiAgICB9KSwgXCJQVUJMSUNcIikuc2V0TXVsdGlwbGVJbnN0YW5jZXMoITApKSwgcmVnaXN0ZXJWZXJzaW9uKFMsIFwiNC4xLjBcIiwgZSksIFxuICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXG4gICAgcmVnaXN0ZXJWZXJzaW9uKFMsIFwiNC4xLjBcIiwgXCJlc20yMDE3XCIpO1xufSgpO1xuXG5leHBvcnQgeyBBYnN0cmFjdFVzZXJEYXRhV3JpdGVyLCBBZ2dyZWdhdGVGaWVsZCwgQWdncmVnYXRlUXVlcnlTbmFwc2hvdCwgQnl0ZXMsIGdlIGFzIENBQ0hFX1NJWkVfVU5MSU1JVEVELCBDb2xsZWN0aW9uUmVmZXJlbmNlLCBEb2N1bWVudFJlZmVyZW5jZSwgRG9jdW1lbnRTbmFwc2hvdCwgRmllbGRQYXRoLCBGaWVsZFZhbHVlLCBGaXJlc3RvcmUsIEZpcmVzdG9yZUVycm9yLCBHZW9Qb2ludCwgTG9hZEJ1bmRsZVRhc2ssIFF1ZXJ5LCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQsIFF1ZXJ5Q29uc3RyYWludCwgUXVlcnlEb2N1bWVudFNuYXBzaG90LCBRdWVyeUVuZEF0Q29uc3RyYWludCwgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQsIFF1ZXJ5TGltaXRDb25zdHJhaW50LCBRdWVyeU9yZGVyQnlDb25zdHJhaW50LCBRdWVyeVNuYXBzaG90LCBRdWVyeVN0YXJ0QXRDb25zdHJhaW50LCBTbmFwc2hvdE1ldGFkYXRhLCBUaW1lc3RhbXAsIFRyYW5zYWN0aW9uLCBXcml0ZUJhdGNoLCBCeXRlU3RyaW5nIGFzIF9CeXRlU3RyaW5nLCBEYXRhYmFzZUlkIGFzIF9EYXRhYmFzZUlkLCBEb2N1bWVudEtleSBhcyBfRG9jdW1lbnRLZXksIF9fUFJJVkFURV9FbXB0eUFwcENoZWNrVG9rZW5Qcm92aWRlciBhcyBfRW1wdHlBcHBDaGVja1Rva2VuUHJvdmlkZXIsIF9fUFJJVkFURV9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIGFzIF9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyLCBGaWVsZFBhdGgkMSBhcyBfRmllbGRQYXRoLCBfX1BSSVZBVEVfVGVzdGluZ0hvb2tzIGFzIF9UZXN0aW5nSG9va3MsIF9fUFJJVkFURV9jYXN0IGFzIF9jYXN0LCBfX1BSSVZBVEVfZGVidWdBc3NlcnQgYXMgX2RlYnVnQXNzZXJ0LCBfX1BSSVZBVEVfaXNCYXNlNjRBdmFpbGFibGUgYXMgX2lzQmFzZTY0QXZhaWxhYmxlLCBfX1BSSVZBVEVfbG9nV2FybiBhcyBfbG9nV2FybiwgX19QUklWQVRFX3ZhbGlkYXRlSXNOb3RVc2VkVG9nZXRoZXIgYXMgX3ZhbGlkYXRlSXNOb3RVc2VkVG9nZXRoZXIsIGFkZERvYywgYWdncmVnYXRlRmllbGRFcXVhbCwgYWdncmVnYXRlUXVlcnlTbmFwc2hvdEVxdWFsLCBhbmQsIGFycmF5UmVtb3ZlLCBhcnJheVVuaW9uLCBhdmVyYWdlLCBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlLCBjb2xsZWN0aW9uLCBjb2xsZWN0aW9uR3JvdXAsIGNvbm5lY3RGaXJlc3RvcmVFbXVsYXRvciwgY291bnQsIGRlbGV0ZURvYywgZGVsZXRlRmllbGQsIGRpc2FibGVOZXR3b3JrLCBkb2MsIGRvY3VtZW50SWQsIGVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlLCBlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlLCBlbmFibGVOZXR3b3JrLCBlbmRBdCwgZW5kQmVmb3JlLCBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkLCBleGVjdXRlV3JpdGUsIGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIsIGdldENvdW50RnJvbVNlcnZlciwgZ2V0RG9jLCBnZXREb2NGcm9tQ2FjaGUsIGdldERvY0Zyb21TZXJ2ZXIsIGdldERvY3MsIGdldERvY3NGcm9tQ2FjaGUsIGdldERvY3NGcm9tU2VydmVyLCBnZXRGaXJlc3RvcmUsIGluY3JlbWVudCwgaW5pdGlhbGl6ZUZpcmVzdG9yZSwgbGltaXQsIGxpbWl0VG9MYXN0LCBsb2FkQnVuZGxlLCBtZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3IsIG1lbW9yeUxvY2FsQ2FjaGUsIG1lbW9yeUxydUdhcmJhZ2VDb2xsZWN0b3IsIG5hbWVkUXVlcnksIG9uU25hcHNob3QsIG9uU25hcHNob3RzSW5TeW5jLCBvciwgb3JkZXJCeSwgcGVyc2lzdGVudExvY2FsQ2FjaGUsIHBlcnNpc3RlbnRNdWx0aXBsZVRhYk1hbmFnZXIsIHBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyLCBxdWVyeSwgcXVlcnlFcXVhbCwgcmVmRXF1YWwsIHJ1blRyYW5zYWN0aW9uLCBzZXJ2ZXJUaW1lc3RhbXAsIHNldERvYywgc2V0SW5kZXhDb25maWd1cmF0aW9uLCBzZXRMb2dMZXZlbCwgc25hcHNob3RFcXVhbCwgc3RhcnRBZnRlciwgc3RhcnRBdCwgc3VtLCB0ZXJtaW5hdGUsIHVwZGF0ZURvYywgd2FpdEZvclBlbmRpbmdXcml0ZXMsIHdoZXJlLCB3cml0ZUJhdGNoIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgaW5pdGlhbGl6ZUFwcCB9IGZyb20gXCJmaXJlYmFzZS9hcHBcIjtcbmltcG9ydCB7XG4gIGdldEZpcmVzdG9yZSxcbiAgY29sbGVjdGlvbixcbiAgYWRkRG9jLFxuICBnZXREb2NzLFxuICBxdWVyeSxcbiAgd2hlcmUsXG4gIGRlbGV0ZURvYyxcbn0gZnJvbSBcImZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuLy8gaW1wb3J0IHsgZ2V0QW5hbHl0aWNzIH0gZnJvbSBcImZpcmViYXNlL2FuYWx5dGljc1wiO1xuXG5jb25zdCBmaXJlYmFzZUNvbmZpZyA9IHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5GSVJFQkFTRV9BUElfS0VZLFxuICBhdXRoRG9tYWluOiBcInRoZS1hZ2dyZWdhdG9yLWI1MWJkLmZpcmViYXNlYXBwLmNvbVwiLFxuICBwcm9qZWN0SWQ6IFwidGhlLWFnZ3JlZ2F0b3ItYjUxYmRcIixcbiAgc3RvcmFnZUJ1Y2tldDogXCJ0aGUtYWdncmVnYXRvci1iNTFiZC5hcHBzcG90LmNvbVwiLFxuICBtZXNzYWdpbmdTZW5kZXJJZDogXCIyODAwMjg4NjgzMjJcIixcbiAgYXBwSWQ6IFwiMToyODAwMjg4NjgzMjI6d2ViOmY2NTRhOTI4ZGE5NjI4ZDZjMzc4YmJcIixcbiAgbWVhc3VyZW1lbnRJZDogXCJHLTQwOE5DRlFMQ0ZcIixcbn07XG5cbi8vIEluaXRpYWxpemUgRmlyZWJhc2VcbmNvbnN0IGFwcCA9IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpO1xuLy8gY29uc3QgYW5hbHl0aWNzID0gZ2V0QW5hbHl0aWNzKGFwcCk7XG5cbmNvbnN0IGRiID0gZ2V0RmlyZXN0b3JlKGFwcCk7XG5cbmV4cG9ydCB7IGFwcCwgZGIsIGNvbGxlY3Rpb24sIGFkZERvYywgZ2V0RG9jcywgcXVlcnksIHdoZXJlLCBkZWxldGVEb2MgfTtcbiIsImltcG9ydCB7XG4gIGRiLFxuICBjb2xsZWN0aW9uLFxuICBhZGREb2MsXG4gIGdldERvY3MsXG4gIHF1ZXJ5LFxuICB3aGVyZSxcbiAgZGVsZXRlRG9jLFxufSBmcm9tIFwiLi9maXJlYmFzZVwiO1xuXG5mdW5jdGlvbiBnZXRQcm9taXNlcygpIHtcbiAgY29uc3QgdXJscyA9IFtcbiAgICBcImh0dHBzOi8vd3d3LmRlZXBtaW5kLmNvbS9ibG9nL3Jzcy54bWxcIixcbiAgICBcImh0dHBzOi8vbmV3cy5taXQuZWR1L3RvcGljL21pdG1hY2hpbmUtbGVhcm5pbmctcnNzLnhtbFwiLFxuICBdO1xuICBjb25zdCBhcGkgPSBcImh0dHBzOi8vcnNzLXRvLWpzb24tc2VydmVybGVzcy1hcGkudmVyY2VsLmFwcC9hcGk/ZmVlZFVSTD1cIjtcbiAgY29uc3QgcHJvbWlzZXMgPSB1cmxzLm1hcCgodXJsKSA9PiBmZXRjaChhcGkgKyB1cmwpKTtcbiAgcmV0dXJuIHByb21pc2VzO1xufVxuXG5mdW5jdGlvbiBnZXRPbmVZZWFyQWdvKCkge1xuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZShcbiAgICB0b2RheS5nZXRGdWxsWWVhcigpIC0gMSxcbiAgICB0b2RheS5nZXRNb250aCgpLFxuICAgIHRvZGF5LmdldERhdGUoKVxuICApO1xuICByZXR1cm4gb25lWWVhckFnbztcbn1cblxuZnVuY3Rpb24gcGFyc2UoZGF0YSkge1xuICBjb25zdCBvbmVZZWFyQWdvID0gZ2V0T25lWWVhckFnbygpO1xuICBjb25zdCBwYXJzZWREYXRhID0gZGF0YS5pdGVtc1xuICAgIC5maWx0ZXIoKGl0ZW0pID0+IG5ldyBEYXRlKGl0ZW0ucHVibGlzaGVkKSA+IG9uZVllYXJBZ28pXG4gICAgLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0ZTogbmV3IERhdGUoaXRlbS5wdWJsaXNoZWQpLFxuICAgICAgICB0aXRsZTogaXRlbS50aXRsZSxcbiAgICAgICAgbGluazogaXRlbS5saW5rLFxuICAgICAgICBkZXNjcmlwdGlvbjogaXRlbS5kZXNjcmlwdGlvbiB8fCBcIk5vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZVwiLFxuICAgICAgICBzb3VyY2U6IGRhdGEudGl0bGUsXG4gICAgICB9O1xuICAgIH0pO1xuXG4gIHJldHVybiBwYXJzZWREYXRhO1xufVxuXG5mdW5jdGlvbiBzb3J0KGFycmF5KSB7XG4gIGNvbnN0IGZsYXR0ZW5lZCA9IGFycmF5LmZsYXQoKTtcbiAgY29uc3Qgc29ydGVkID0gZmxhdHRlbmVkLnNvcnQoKGEsIGIpID0+IGIuZGF0ZSAtIGEuZGF0ZSk7XG4gIHJldHVybiBzb3J0ZWQ7XG59XG5cbmNvbnN0IHByb21pc2VzID0gZ2V0UHJvbWlzZXMoKTtcblxuUHJvbWlzZS5hbGwocHJvbWlzZXMpXG4gIC50aGVuKChyZXNwb25zZXMpID0+XG4gICAgUHJvbWlzZS5hbGwocmVzcG9uc2VzLm1hcCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSkpXG4gIClcbiAgLnRoZW4oKGRhdGFBcnJheSkgPT4gZGF0YUFycmF5Lm1hcCgoZGF0YSkgPT4gcGFyc2UoZGF0YSkpKVxuICAudGhlbigocGFyc2VkKSA9PiBzb3J0KHBhcnNlZCkpXG4gIC50aGVuKChzb3J0ZWQpID0+IGNvbnNvbGUubG9nKHNvcnRlZCkpXG4gIC5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBjb25zdCByc3NGZWVkZXIgPSAoKCkgPT4ge1xuLy8gICBsZXQgZXhpc3RpbmdUaXRsZXNTZXQgPSBuZXcgU2V0KCk7XG5cbi8vICAgY29uc3QgZmVlZFVybHMgPSBbXG4vLyAgICAgeyBvcGVuYWk6IFwiaHR0cHM6Ly9vcGVuYWkuY29tL2Jsb2cvcnNzLnhtbFwiIH0sXG4vLyAgICAgeyBkZWVwbWluZDogXCJodHRwczovL3d3dy5kZWVwbWluZC5jb20vYmxvZy9yc3MueG1sXCIgfSxcbi8vICAgICB7IG1pdE5ld3M6IFwiaHR0cHM6Ly9uZXdzLm1pdC5lZHUvdG9waWMvbWl0bWFjaGluZS1sZWFybmluZy1yc3MueG1sXCIgfSxcbi8vICAgXTtcblxuLy8gICBmdW5jdGlvbiBwYXJzZURhdGEoZGF0YSkge1xuLy8gICAgIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZSgpO1xuLy8gICAgIG9uZVllYXJBZ28uc2V0RnVsbFllYXIob25lWWVhckFnby5nZXRGdWxsWWVhcigpIC0gMSk7XG5cbi8vICAgICBjb25zdCBwYXJzZWREYXRhID0gZGF0YS5pdGVtc1xuLy8gICAgICAgLmZpbHRlcigoaXRlbSkgPT4gbmV3IERhdGUoaXRlbS5wdWJsaXNoZWQpID4gb25lWWVhckFnbylcblxuLy8gICAgICAgLm1hcCgoaXRlbSkgPT4ge1xuLy8gICAgICAgICByZXR1cm4ge1xuLy8gICAgICAgICAgIHRpdGxlOiBpdGVtLnRpdGxlLFxuLy8gICAgICAgICAgIGxpbms6IGl0ZW0ubGluayxcbi8vICAgICAgICAgICBkZXNjcmlwdGlvbjogaXRlbS5kZXNjcmlwdGlvbiB8fCBcIk5vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZVwiLFxuLy8gICAgICAgICAgIHNvdXJjZTogZGF0YS50aXRsZSxcbi8vICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZShpdGVtLnB1Ymxpc2hlZCksXG4vLyAgICAgICAgIH07XG4vLyAgICAgICB9KTtcblxuLy8gICAgIHJldHVybiBwYXJzZWREYXRhO1xuLy8gICB9XG5cbi8vICAgZnVuY3Rpb24gZmV0Y2hEYXRhKHVybCkge1xuLy8gICAgIGNvbnN0IGFwaVVybCA9IGBodHRwczovL3Jzcy10by1qc29uLXNlcnZlcmxlc3MtYXBpLnZlcmNlbC5hcHAvYXBpP2ZlZWRVUkw9JHt1cmx9YDtcbi8vICAgICByZXR1cm4gZmV0Y2goYXBpVXJsKVxuLy8gICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKCkpXG4vLyAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbi8vICAgICAgICAgY29uc3QgcGFyc2VkRGF0YSA9IHBhcnNlRGF0YShkYXRhKTtcbi8vICAgICAgICAgY29uc29sZS5sb2cocGFyc2VkRGF0YSk7XG4vLyAgICAgICAgIHJldHVybiBwYXJzZWREYXRhO1xuLy8gICAgICAgfSlcbi8vICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIGZldGNoaW5nIGRhdGE6XCIsIGVycm9yKTtcbi8vICAgICAgICAgdGhyb3cgZXJyb3I7XG4vLyAgICAgICB9KTtcbi8vICAgfVxuXG4vLyAgIGZ1bmN0aW9uIGdldEV4aXN0aW5nVGl0bGVzKCkge1xuLy8gICAgIHJldHVybiBnZXREb2NzKGNvbGxlY3Rpb24oZGIsIFwiYWlcIikpXG4vLyAgICAgICAudGhlbigocXVlcnlTbmFwc2hvdCkgPT4ge1xuLy8gICAgICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4ge1xuLy8gICAgICAgICAgIGV4aXN0aW5nVGl0bGVzU2V0LmFkZChkb2MuZGF0YSgpLnRpdGxlKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKGV4aXN0aW5nVGl0bGVzU2V0KTtcbi8vICAgICAgICAgcmV0dXJuIGV4aXN0aW5nVGl0bGVzU2V0O1xuLy8gICAgICAgfSlcbi8vICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdldHRpbmcgZXhpc3RpbmcgdGl0bGVzOlwiLCBlcnJvcik7XG4vLyAgICAgICAgIHRocm93IGVycm9yO1xuLy8gICAgICAgfSk7XG4vLyAgIH1cblxuLy8gICBmdW5jdGlvbiBhZGRUb0ZpcmVzdG9yZShwYXJzZWREYXRhKSB7XG4vLyAgICAgcmV0dXJuIGdldEV4aXN0aW5nVGl0bGVzKClcbi8vICAgICAgIC50aGVuKCgpID0+IHtcbi8vICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcblxuLy8gICAgICAgICBwYXJzZWREYXRhLmZvckVhY2goKGl0ZW0pID0+IHtcbi8vICAgICAgICAgICBjb25zdCB0aXRsZVRvQ2hlY2sgPSBpdGVtLnRpdGxlO1xuXG4vLyAgICAgICAgICAgaWYgKCFleGlzdGluZ1RpdGxlc1NldC5oYXModGl0bGVUb0NoZWNrKSkge1xuLy8gICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IGFkZERvYyhjb2xsZWN0aW9uKGRiLCBcImFpXCIpLCB7XG4vLyAgICAgICAgICAgICAgIHRpdGxlOiBpdGVtLnRpdGxlLFxuLy8gICAgICAgICAgICAgICBsaW5rOiBpdGVtLmxpbmssXG4vLyAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBpdGVtLmRlc2NyaXB0aW9uLFxuLy8gICAgICAgICAgICAgICBzb3VyY2U6IGl0ZW0uc291cmNlLFxuLy8gICAgICAgICAgICAgICBkYXRlOiBpdGVtLmRhdGUsXG4vLyAgICAgICAgICAgICB9KVxuLy8gICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYERvY3VtZW50ICcke3RpdGxlVG9DaGVja30nIHdyaXR0ZW4gc3VjY2Vzc2Z1bGx5IWApO1xuLy8gICAgICAgICAgICAgICAgIGV4aXN0aW5nVGl0bGVzU2V0LmFkZCh0aXRsZVRvQ2hlY2spO1xuLy8gICAgICAgICAgICAgICB9KVxuLy8gICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGFkZGluZyBkb2N1bWVudCB0byBGaXJlc3RvcmU6XCIsIGVycm9yKTtcbi8vICAgICAgICAgICAgICAgfSk7XG5cbi8vICAgICAgICAgICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7XG4vLyAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuLy8gICAgICAgICAgICAgICBgRG9jdW1lbnQgJyR7dGl0bGVUb0NoZWNrfScgYWxyZWFkeSBleGlzdHMsIHNraXBwaW5nLi4uYFxuLy8gICAgICAgICAgICAgKTtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgIH0pO1xuXG4vLyAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4vLyAgICAgICB9KVxuLy8gICAgICAgLnRoZW4oKCkgPT4ge1xuLy8gICAgICAgICBleGlzdGluZ1RpdGxlc1NldC5jbGVhcigpO1xuLy8gICAgICAgfSlcbi8vICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkFuIGVycm9yIG9jY3VycmVkOlwiLCBlcnJvcik7XG4vLyAgICAgICB9KTtcbi8vICAgfVxuXG4vLyAgIGZ1bmN0aW9uIGRlbGV0ZU9sZERhdGEoKSB7XG4vLyAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuLy8gICAgIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZSgpO1xuLy8gICAgIG9uZVllYXJBZ28uc2V0RnVsbFllYXIodG9kYXkuZ2V0RnVsbFllYXIoKSAtIDEpO1xuXG4vLyAgICAgY29uc29sZS5sb2coXCJUb2RheTpcIiwgdG9kYXkpO1xuLy8gICAgIGNvbnNvbGUubG9nKFwiT25lIFllYXIgQWdvOlwiLCBvbmVZZWFyQWdvKTtcblxuLy8gICAgIGNvbnN0IHEgPSBxdWVyeShjb2xsZWN0aW9uKGRiLCBcImFpXCIpLCB3aGVyZShcImRhdGVcIiwgXCI8XCIsIG9uZVllYXJBZ28pKTtcblxuLy8gICAgIGdldERvY3MocSlcbi8vICAgICAgIC50aGVuKChxdWVyeVNuYXBzaG90KSA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiUXVlcnkgc25hcHNob3QgbGVuZ3RoOlwiLCBxdWVyeVNuYXBzaG90LnNpemUpO1xuLy8gICAgICAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4ge1xuLy8gICAgICAgICAgIGNvbnN0IGRvY3VtZW50RGF0YSA9IGRvYy5kYXRhKCk7XG4vLyAgICAgICAgICAgY29uc29sZS5sb2coXCJEb2N1bWVudCBkYXRhOlwiLCBkb2N1bWVudERhdGEpO1xuLy8gICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVsZXRpbmcgZG9jdW1lbnQ6XCIsIGRvY3VtZW50RGF0YS50aXRsZSk7XG4vLyAgICAgICAgICAgZGVsZXRlRG9jKGRvYy5yZWYpXG4vLyAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4vLyAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRG9jdW1lbnQgZGVsZXRlZCBzdWNjZXNzZnVsbHkhXCIpO1xuLy8gICAgICAgICAgICAgfSlcbi8vICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbi8vICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGRvY3VtZW50OlwiLCBlcnJvcik7XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9KVxuLy8gICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYW5kIGRlbGV0aW5nIGRvY3VtZW50czpcIiwgZXJyb3IpO1xuLy8gICAgICAgfSk7XG4vLyAgIH1cblxuLy8gICByZXR1cm4ge1xuLy8gICAgIGZlZWRVcmxzLFxuLy8gICAgIGZldGNoRGF0YSxcbi8vICAgICBhZGRUb0ZpcmVzdG9yZSxcbi8vICAgICBkZWxldGVPbGREYXRhLFxuLy8gICB9O1xuLy8gfSkoKTtcblxuLy8gcnNzRmVlZGVyLmRlbGV0ZU9sZERhdGEoKTtcblxuLy8gcnNzRmVlZGVyXG4vLyAgIC5mZXRjaERhdGEoXCJodHRwczovL25ld3MubWl0LmVkdS90b3BpYy9taXRtYWNoaW5lLWxlYXJuaW5nLXJzcy54bWxcIilcbi8vICAgLnRoZW4oKHBhcnNlZERhdGEpID0+IHtcbi8vICAgICByZXR1cm4gcnNzRmVlZGVyLmFkZFRvRmlyZXN0b3JlKHBhcnNlZERhdGEpO1xuLy8gICB9KVxuLy8gICAuY2F0Y2goKGVycm9yKSA9PiB7XG4vLyAgICAgY29uc29sZS5lcnJvcihcIkFuIGVycm9yIG9jY3VycmVkOlwiLCBlcnJvcik7XG4vLyAgIH0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZyIsImdsb2JhbFRoaXMiLCJ0aGlzIiwiRnVuY3Rpb24iLCJlIiwid2luZG93Iiwic3RyaW5nVG9CeXRlQXJyYXkkMSIsInN0ciIsIm91dCIsInAiLCJpIiwibGVuZ3RoIiwiYyIsImNoYXJDb2RlQXQiLCJiYXNlNjQiLCJieXRlVG9DaGFyTWFwXyIsImNoYXJUb0J5dGVNYXBfIiwiYnl0ZVRvQ2hhck1hcFdlYlNhZmVfIiwiY2hhclRvQnl0ZU1hcFdlYlNhZmVfIiwiRU5DT0RFRF9WQUxTX0JBU0UiLCJFTkNPREVEX1ZBTFMiLCJFTkNPREVEX1ZBTFNfV0VCU0FGRSIsIkhBU19OQVRJVkVfU1VQUE9SVCIsImF0b2IiLCJlbmNvZGVCeXRlQXJyYXkiLCJpbnB1dCIsIndlYlNhZmUiLCJBcnJheSIsImlzQXJyYXkiLCJFcnJvciIsImluaXRfIiwiYnl0ZVRvQ2hhck1hcCIsIm91dHB1dCIsImJ5dGUxIiwiaGF2ZUJ5dGUyIiwiYnl0ZTIiLCJoYXZlQnl0ZTMiLCJieXRlMyIsIm91dEJ5dGUxIiwib3V0Qnl0ZTIiLCJvdXRCeXRlMyIsIm91dEJ5dGU0IiwicHVzaCIsImpvaW4iLCJlbmNvZGVTdHJpbmciLCJidG9hIiwiZGVjb2RlU3RyaW5nIiwiYnl0ZXMiLCJwb3MiLCJjMSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImMyIiwidSIsImMzIiwiYnl0ZUFycmF5VG9TdHJpbmciLCJkZWNvZGVTdHJpbmdUb0J5dGVBcnJheSIsImNoYXJUb0J5dGVNYXAiLCJjaGFyQXQiLCJieXRlNCIsIkRlY29kZUJhc2U2NFN0cmluZ0Vycm9yIiwiY29uc3RydWN0b3IiLCJzdXBlciIsImFyZ3VtZW50cyIsIm5hbWUiLCJiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyIsInV0ZjhCeXRlcyIsImJhc2U2NEVuY29kZSIsInJlcGxhY2UiLCJnZXREZWZhdWx0cyIsInNlbGYiLCJnZXRHbG9iYWwiLCJfX0ZJUkVCQVNFX0RFRkFVTFRTX18iLCJwcm9jZXNzIiwiZGVmYXVsdHNKc29uU3RyaW5nIiwiSlNPTiIsInBhcnNlIiwiZ2V0RGVmYXVsdHNGcm9tRW52VmFyaWFibGUiLCJkb2N1bWVudCIsIm1hdGNoIiwiY29va2llIiwiZGVjb2RlZCIsImNvbnNvbGUiLCJlcnJvciIsImJhc2U2NERlY29kZSIsImdldERlZmF1bHRzRnJvbUNvb2tpZSIsImluZm8iLCJnZXREZWZhdWx0QXBwQ29uZmlnIiwiX2EiLCJjb25maWciLCJEZWZlcnJlZCIsInJlamVjdCIsInJlc29sdmUiLCJwcm9taXNlIiwiUHJvbWlzZSIsIndyYXBDYWxsYmFjayIsImNhbGxiYWNrIiwidmFsdWUiLCJjYXRjaCIsIkZpcmViYXNlRXJyb3IiLCJjb2RlIiwibWVzc2FnZSIsImN1c3RvbURhdGEiLCJPYmplY3QiLCJzZXRQcm90b3R5cGVPZiIsInByb3RvdHlwZSIsImNhcHR1cmVTdGFja1RyYWNlIiwiRXJyb3JGYWN0b3J5IiwiY3JlYXRlIiwic2VydmljZSIsInNlcnZpY2VOYW1lIiwiZXJyb3JzIiwiZGF0YSIsImZ1bGxDb2RlIiwidGVtcGxhdGUiLCJQQVRURVJOIiwiXyIsImtleSIsInJlcGxhY2VUZW1wbGF0ZSIsImZ1bGxNZXNzYWdlIiwiYSIsImIiLCJhS2V5cyIsImtleXMiLCJiS2V5cyIsImsiLCJpbmNsdWRlcyIsImFQcm9wIiwiYlByb3AiLCJpc09iamVjdCIsInRoaW5nIiwiQ29tcG9uZW50IiwiaW5zdGFuY2VGYWN0b3J5IiwidHlwZSIsIm11bHRpcGxlSW5zdGFuY2VzIiwic2VydmljZVByb3BzIiwiaW5zdGFudGlhdGlvbk1vZGUiLCJvbkluc3RhbmNlQ3JlYXRlZCIsInNldEluc3RhbnRpYXRpb25Nb2RlIiwibW9kZSIsInNldE11bHRpcGxlSW5zdGFuY2VzIiwic2V0U2VydmljZVByb3BzIiwicHJvcHMiLCJzZXRJbnN0YW5jZUNyZWF0ZWRDYWxsYmFjayIsIkRFRkFVTFRfRU5UUllfTkFNRSIsIlByb3ZpZGVyIiwiY29udGFpbmVyIiwiY29tcG9uZW50IiwiaW5zdGFuY2VzIiwiTWFwIiwiaW5zdGFuY2VzRGVmZXJyZWQiLCJpbnN0YW5jZXNPcHRpb25zIiwib25Jbml0Q2FsbGJhY2tzIiwiZ2V0IiwiaWRlbnRpZmllciIsIm5vcm1hbGl6ZWRJZGVudGlmaWVyIiwibm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyIiwiaGFzIiwiZGVmZXJyZWQiLCJzZXQiLCJpc0luaXRpYWxpemVkIiwic2hvdWxkQXV0b0luaXRpYWxpemUiLCJpbnN0YW5jZSIsImdldE9ySW5pdGlhbGl6ZVNlcnZpY2UiLCJpbnN0YW5jZUlkZW50aWZpZXIiLCJnZXRJbW1lZGlhdGUiLCJvcHRpb25zIiwib3B0aW9uYWwiLCJnZXRDb21wb25lbnQiLCJzZXRDb21wb25lbnQiLCJpc0NvbXBvbmVudEVhZ2VyIiwiaW5zdGFuY2VEZWZlcnJlZCIsImVudHJpZXMiLCJjbGVhckluc3RhbmNlIiwiZGVsZXRlIiwic2VydmljZXMiLCJmcm9tIiwidmFsdWVzIiwiYWxsIiwiZmlsdGVyIiwibWFwIiwiSU5URVJOQUwiLCJfZGVsZXRlIiwiaXNDb21wb25lbnRTZXQiLCJnZXRPcHRpb25zIiwiaW5pdGlhbGl6ZSIsIm9wdHMiLCJvbkluaXQiLCJleGlzdGluZ0NhbGxiYWNrcyIsIlNldCIsImFkZCIsImV4aXN0aW5nSW5zdGFuY2UiLCJpbnZva2VPbkluaXRDYWxsYmFja3MiLCJjYWxsYmFja3MiLCJ1bmRlZmluZWQiLCJDb21wb25lbnRDb250YWluZXIiLCJwcm92aWRlcnMiLCJhZGRDb21wb25lbnQiLCJwcm92aWRlciIsImdldFByb3ZpZGVyIiwiYWRkT3JPdmVyd3JpdGVDb21wb25lbnQiLCJnZXRQcm92aWRlcnMiLCJMb2dMZXZlbCIsImxldmVsU3RyaW5nVG9FbnVtIiwiREVCVUciLCJWRVJCT1NFIiwiSU5GTyIsIldBUk4iLCJFUlJPUiIsIlNJTEVOVCIsImRlZmF1bHRMb2dMZXZlbCIsIkNvbnNvbGVNZXRob2QiLCJkZWZhdWx0TG9nSGFuZGxlciIsImxvZ1R5cGUiLCJhcmdzIiwibG9nTGV2ZWwiLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJtZXRob2QiLCJMb2dnZXIiLCJfbG9nTGV2ZWwiLCJfbG9nSGFuZGxlciIsIl91c2VyTG9nSGFuZGxlciIsInZhbCIsIlR5cGVFcnJvciIsInNldExvZ0xldmVsIiwibG9nSGFuZGxlciIsInVzZXJMb2dIYW5kbGVyIiwiZGVidWciLCJsb2ciLCJ3YXJuIiwiaW5zdGFuY2VPZkFueSIsIm9iamVjdCIsImNvbnN0cnVjdG9ycyIsInNvbWUiLCJpZGJQcm94eWFibGVUeXBlcyIsImN1cnNvckFkdmFuY2VNZXRob2RzIiwiY3Vyc29yUmVxdWVzdE1hcCIsIldlYWtNYXAiLCJ0cmFuc2FjdGlvbkRvbmVNYXAiLCJ0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAiLCJ0cmFuc2Zvcm1DYWNoZSIsInJldmVyc2VUcmFuc2Zvcm1DYWNoZSIsImlkYlByb3h5VHJhcHMiLCJ0YXJnZXQiLCJwcm9wIiwicmVjZWl2ZXIiLCJJREJUcmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlTmFtZXMiLCJvYmplY3RTdG9yZSIsInRyYW5zZm9ybUNhY2hhYmxlVmFsdWUiLCJmdW5jIiwiSURCRGF0YWJhc2UiLCJ0cmFuc2FjdGlvbiIsIklEQkN1cnNvciIsImFkdmFuY2UiLCJjb250aW51ZSIsImNvbnRpbnVlUHJpbWFyeUtleSIsImFwcGx5IiwidW53cmFwIiwic3RvcmVOYW1lcyIsInR4IiwiY2FsbCIsInNvcnQiLCJkb25lIiwidW5saXN0ZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY29tcGxldGUiLCJET01FeGNlcHRpb24iLCJhZGRFdmVudExpc3RlbmVyIiwiY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uIiwiSURCT2JqZWN0U3RvcmUiLCJJREJJbmRleCIsIlByb3h5IiwiSURCUmVxdWVzdCIsInJlcXVlc3QiLCJzdWNjZXNzIiwicmVzdWx0IiwidGhlbiIsInByb21pc2lmeVJlcXVlc3QiLCJuZXdWYWx1ZSIsInJlYWRNZXRob2RzIiwid3JpdGVNZXRob2RzIiwiY2FjaGVkTWV0aG9kcyIsImdldE1ldGhvZCIsInRhcmdldEZ1bmNOYW1lIiwidXNlSW5kZXgiLCJpc1dyaXRlIiwiYXN5bmMiLCJzdG9yZU5hbWUiLCJzdG9yZSIsImluZGV4Iiwic2hpZnQiLCJvbGRUcmFwcyIsIlBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwiLCJnZXRQbGF0Zm9ybUluZm9TdHJpbmciLCJpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIiLCJsaWJyYXJ5IiwidmVyc2lvbiIsImxvZ1N0cmluZyIsIm5hbWUkbyIsInZlcnNpb24kMSIsImxvZ2dlciIsIlBMQVRGT1JNX0xPR19TVFJJTkciLCJfYXBwcyIsIl9jb21wb25lbnRzIiwiX2FkZENvbXBvbmVudCIsImFwcCIsIl9yZWdpc3RlckNvbXBvbmVudCIsImNvbXBvbmVudE5hbWUiLCJFUlJPUl9GQUNUT1JZIiwiRmlyZWJhc2VBcHBJbXBsIiwiX2lzRGVsZXRlZCIsIl9vcHRpb25zIiwiYXNzaWduIiwiX2NvbmZpZyIsIl9uYW1lIiwiX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCIsImF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCIsIl9jb250YWluZXIiLCJjaGVja0Rlc3Ryb3llZCIsImlzRGVsZXRlZCIsImFwcE5hbWUiLCJpbml0aWFsaXplQXBwIiwicmF3Q29uZmlnIiwiZXhpc3RpbmdBcHAiLCJuZXdBcHAiLCJyZWdpc3RlclZlcnNpb24iLCJsaWJyYXJ5S2V5T3JOYW1lIiwidmFyaWFudCIsImxpYnJhcnlNaXNtYXRjaCIsInZlcnNpb25NaXNtYXRjaCIsIndhcm5pbmciLCJEQl9OQU1FIiwiREJfVkVSU0lPTiIsIlNUT1JFX05BTUUiLCJkYlByb21pc2UiLCJnZXREYlByb21pc2UiLCJibG9ja2VkIiwidXBncmFkZSIsImJsb2NraW5nIiwidGVybWluYXRlZCIsImluZGV4ZWREQiIsIm9wZW4iLCJvcGVuUHJvbWlzZSIsImV2ZW50Iiwib2xkVmVyc2lvbiIsIm5ld1ZlcnNpb24iLCJkYiIsIm9wZW5EQiIsImNyZWF0ZU9iamVjdFN0b3JlIiwib3JpZ2luYWxFcnJvck1lc3NhZ2UiLCJ3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQiIsImhlYXJ0YmVhdE9iamVjdCIsInB1dCIsImNvbXB1dGVLZXkiLCJpZGJHZXRFcnJvciIsImFwcElkIiwiSGVhcnRiZWF0U2VydmljZUltcGwiLCJfaGVhcnRiZWF0c0NhY2hlIiwiX3N0b3JhZ2UiLCJIZWFydGJlYXRTdG9yYWdlSW1wbCIsIl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlIiwicmVhZCIsInRyaWdnZXJIZWFydGJlYXQiLCJhZ2VudCIsImRhdGUiLCJnZXRVVENEYXRlU3RyaW5nIiwibGFzdFNlbnRIZWFydGJlYXREYXRlIiwiaGVhcnRiZWF0cyIsInNpbmdsZURhdGVIZWFydGJlYXQiLCJoYlRpbWVzdGFtcCIsInZhbHVlT2YiLCJvdmVyd3JpdGUiLCJnZXRIZWFydGJlYXRzSGVhZGVyIiwiaGVhcnRiZWF0c1RvU2VuZCIsInVuc2VudEVudHJpZXMiLCJoZWFydGJlYXRzQ2FjaGUiLCJtYXhTaXplIiwic2xpY2UiLCJoZWFydGJlYXRFbnRyeSIsImZpbmQiLCJoYiIsImRhdGVzIiwiY291bnRCeXRlcyIsInBvcCIsImV4dHJhY3RIZWFydGJlYXRzRm9ySGVhZGVyIiwiaGVhZGVyU3RyaW5nIiwic3RyaW5naWZ5Iiwic3Vic3RyaW5nIiwiX2NhblVzZUluZGV4ZWREQlByb21pc2UiLCJydW5JbmRleGVkREJFbnZpcm9ubWVudENoZWNrIiwicHJlRXhpc3QiLCJEQl9DSEVDS19OQU1FIiwib25zdWNjZXNzIiwiY2xvc2UiLCJkZWxldGVEYXRhYmFzZSIsIm9udXBncmFkZW5lZWRlZCIsIm9uZXJyb3IiLCJpZGJIZWFydGJlYXRPYmplY3QiLCJyZWFkSGVhcnRiZWF0c0Zyb21JbmRleGVkREIiLCJoZWFydGJlYXRzT2JqZWN0IiwiZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0IiwiY29tbW9uanNHbG9iYWwiLCJnbG9iYWwiLCJlc20iLCJnb29nIiwibCIsImFhIiwiY2EiLCJNYXRoIiwicmFuZG9tIiwiZGEiLCJlYSIsImJpbmQiLCJmYSIsImQiLCJ1bnNoaWZ0IiwicSIsInRvU3RyaW5nIiwiaW5kZXhPZiIsImhhIiwiciIsIiQiLCJhYyIsImYiLCJoIiwibiIsInYiLCJzIiwibyIsInNhIiwiTiIsImhhc093blByb3BlcnR5Iiwia2EiLCJtYSIsIm5hIiwidyIsImRlZmF1bHRQcmV2ZW50ZWQiLCJvYSIsImRlZmluZVByb3BlcnR5IiwieCIsInRlc3QiLCJwYSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsInkiLCJxYSIsInphIiwiRGEiLCJ0YSIsInoiLCJ1YSIsInZhIiwid2EiLCJ0b0xvd2VyQ2FzZSIsInhhIiwieWEiLCJkb2N1bWVudE1vZGUiLCJBYSIsIkJhIiwiZXhlYyIsIkNhIiwicGFyc2VGbG9hdCIsInBhcnNlSW50IiwiRmEiLCJBIiwicmVsYXRlZFRhcmdldCIsImJ1dHRvbiIsInNjcmVlblkiLCJzY3JlZW5YIiwiY2xpZW50WSIsImNsaWVudFgiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJhbHRLZXkiLCJjdHJsS2V5Iiwic3RhdGUiLCJwb2ludGVySWQiLCJwb2ludGVyVHlwZSIsImNoYW5nZWRUb3VjaGVzIiwic3JjRWxlbWVudCIsIm5vZGVOYW1lIiwiZnJvbUVsZW1lbnQiLCJ0b0VsZW1lbnQiLCJwYWdlWCIsInBhZ2VZIiwiR2EiLCJwcmV2ZW50RGVmYXVsdCIsInJldHVyblZhbHVlIiwiSGEiLCJJYSIsIkphIiwibGlzdGVuZXIiLCJwcm94eSIsInNyYyIsImNhcHR1cmUiLCJsYSIsImlhIiwiS2EiLCJOYSIsIlBhIiwiUWEiLCJzcGxpdCIsIlJhIiwiU2EiLCJVYSIsInNwbGljZSIsIlRhIiwiVmEiLCJXYSIsIllhIiwib25jZSIsIlphIiwiJGEiLCJPIiwiYWIiLCJiYiIsImViIiwiY2IiLCJhdHRhY2hFdmVudCIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJQIiwiZmIiLCJnYiIsImRldGFjaEV2ZW50IiwiaGFuZGxlRXZlbnQiLCJCIiwiUyIsIkoiLCJDIiwiaWIiLCJjb25jYXQiLCJ0IiwiamIiLCJsYiIsIm1iIiwibmV4dCIsIm9iIiwiaiIsInBiIiwicmVzZXQiLCJxYiIsInJiIiwic2V0VGltZW91dCIsInNiIiwidGIiLCJ2YiIsInViIiwid2IiLCJ4YiIsImdhIiwiVCIsImNsZWFyVGltZW91dCIsInliIiwiTnVtYmVyIiwiemIiLCJtIiwic3RhcnQiLCJBYiIsIkJiIiwiQ2IiLCJEYiIsIkZiIiwiR2IiLCJEIiwiSmIiLCJFYSIsIkUiLCJMYiIsIk1iIiwiTmIiLCJPYiIsIlBiIiwiU1RBVF9FVkVOVCIsInN0YXQiLCJGIiwiUWIiLCJzaXplIiwiUmIiLCJTYiIsIk5PX0VSUk9SIiwiRWIiLCJUSU1FT1VUIiwiSWIiLCJUYiIsIktiIiwiJGIiLCJVYiIsIlZiIiwiV2IiLCJYYiIsIk9QRU4iLCJIYiIsIlliIiwiWmIiLCJiYyIsIlciLCJVIiwiY2MiLCJWIiwiSSIsIkwiLCJHIiwiWSIsIk0iLCJiYSIsIksiLCJkYyIsIlhNTEh0dHBSZXF1ZXN0IiwiZWMiLCJmYyIsImdjIiwiaGMiLCJpYyIsImpjIiwia2MiLCJsYyIsIm5iIiwib2MiLCJyYyIsInVjIiwicWMiLCJ2YyIsInBjIiwiaXNOYU4iLCJ3YyIsIm5jIiwiSCIsInNjIiwiYWJvcnQiLCJ4YyIsInljIiwiemMiLCJBYyIsIkJjIiwicmEiLCJMYSIsIk1hIiwiZ2V0UmVzcG9uc2VIZWFkZXIiLCJDYyIsIkRjIiwiRWMiLCJGYyIsIkdjIiwiSGMiLCJLYyIsImZvckVhY2giLCJaIiwiSmMiLCJJYyIsImphIiwibWMiLCJUZXh0RGVjb2RlciIsImRlY29kZSIsInN0cmVhbSIsImdldEFsbFJlc3BvbnNlSGVhZGVycyIsInRyaW0iLCJPYSIsInRjIiwiY2FuY2VsIiwiTGMiLCJSZWdFeHAiLCJOYyIsIk9jIiwiUGMiLCJRYyIsIlJjIiwiJGMiLCJYYyIsIlNjIiwiWWMiLCJmbG9vciIsImFicyIsImRlY29kZVVSSSIsImRlY29kZVVSSUNvbXBvbmVudCIsImVuY29kZVVSSSIsIlpjIiwiVGMiLCJlbmNvZGVVUklDb21wb25lbnQiLCJVYyIsIlZjIiwiV2MiLCJNYyIsImFkIiwiY2QiLCJkZCIsIlBlcmZvcm1hbmNlTmF2aWdhdGlvblRpbWluZyIsInBlcmZvcm1hbmNlIiwiZ2V0RW50cmllc0J5VHlwZSIsIm5leHRIb3BQcm90b2NvbCIsImVkIiwiZmQiLCJjbGVhciIsImdkIiwiaGQiLCJpZCIsImtkIiwib25sb2FkIiwib25hYm9ydCIsIm9udGltZW91dCIsImxkIiwibWQiLCJyZWFkeVN0YXRlIiwibmQiLCJzdGF0dXMiLCJyZXNwb25zZVR5cGUiLCJyZXNwb25zZVRleHQiLCJyZXNwb25zZSIsInN0YXR1c1RleHQiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJIZWFkZXJzIiwicWQiLCJYYSIsInBkIiwib2QiLCJzZW5kIiwiaGVhZGVycyIsImNyZWRlbnRpYWxzIiwiY2FjaGUiLCJib2R5IiwiZmV0Y2giLCJSZXF1ZXN0IiwiYXJyYXlCdWZmZXIiLCJSZWFkYWJsZVN0cmVhbSIsImdldFJlYWRlciIsInRleHQiLCJVaW50OEFycmF5Iiwic2V0UmVxdWVzdEhlYWRlciIsImFwcGVuZCIsInJkIiwic2QiLCJ0ZCIsInVkIiwidmQiLCJ5ZCIsInpkIiwiQWQiLCJsb2NhdGlvbiIsInByb3RvY29sIiwid2QiLCJtb3pSZXNwb25zZUFycmF5QnVmZmVyIiwiQmQiLCJDZCIsIkRkIiwiaW50ZXJuYWxDaGFubmVsUGFyYW1zIiwiRWQiLCJ4bWxIdHRwRmFjdG9yeSIsInN1cHBvcnRzQ3Jvc3NEb21haW5YaHIiLCJjb25jdXJyZW50UmVxdWVzdExpbWl0IiwiZmFzdEhhbmRzaGFrZSIsImVuY29kZUluaXRNZXNzYWdlSGVhZGVycyIsImZvcmNlTG9uZ1BvbGxpbmciLCJkZXRlY3RCdWZmZXJpbmdQcm94eSIsImxvbmdQb2xsaW5nVGltZW91dCIsIkZkIiwiR2QiLCJzZW5kQmVhY29uIiwiSW1hZ2UiLCJIZCIsIkxkIiwiS2QiLCJyb3VuZCIsIm1pbiIsIm1heCIsIkpkIiwiTWQiLCJJZCIsImlzQWN0aXZlIiwiamQiLCJob3N0bmFtZSIsInBvcnQiLCJOZCIsIk9kIiwiUSIsIm1lc3NhZ2VVcmxQYXJhbXMiLCJtZXNzYWdlSGVhZGVycyIsImNsaWVudFByb3RvY29sSGVhZGVyUmVxdWlyZWQiLCJpbml0TWVzc2FnZUhlYWRlcnMiLCJtZXNzYWdlQ29udGVudFR5cGUiLCJzZW5kUmF3SnNvbiIsImh0dHBTZXNzaW9uSWRQYXJhbSIsIlIiLCJQZCIsIl9faGVhZGVyc19fIiwic3RhdHVzQ29kZSIsIl9fc3RhdHVzX18iLCJfX3NtX18iLCJRZCIsImJsb2NrU2l6ZSIsIlNkIiwidG9VcHBlckNhc2UiLCJnZXRQcm90b3R5cGVPZiIsIkZvcm1EYXRhIiwid2l0aENyZWRlbnRpYWxzIiwidGltZW91dCIsInhkIiwia2IiLCJfX2RhdGFfXyIsIlRkIiwiaXNGaW5pdGUiLCJVZCIsIldkIiwiWGQiLCJYIiwiWmQiLCIkZCIsImFlIiwiWWQiLCJiZSIsImNlaWwiLCJMTjIiLCJwb3ciLCJhbmQiLCJvciIsInhvciIsImNyZWF0ZVdlYkNoYW5uZWwiLCJIVFRQX0VSUk9SIiwiQ09NUExFVEUiLCJFdmVudFR5cGUiLCJDTE9TRSIsIk1FU1NBR0UiLCJsaXN0ZW4iLCJsaXN0ZW5PbmNlIiwiZ2V0TGFzdEVycm9yIiwiZ2V0TGFzdEVycm9yQ29kZSIsImdldFN0YXR1cyIsImdldFJlc3BvbnNlSnNvbiIsImdldFJlc3BvbnNlVGV4dCIsInNldFdpdGhDcmVkZW50aWFscyIsImRpZ2VzdCIsInVwZGF0ZSIsIm11bHRpcGx5IiwibW9kdWxvIiwiY29tcGFyZSIsInRvTnVtYmVyIiwiZ2V0Qml0cyIsImZyb21OdW1iZXIiLCJmcm9tU3RyaW5nIiwiVmQiLCJjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0IiwiZ2V0U3RhdEV2ZW50VGFyZ2V0IiwiRXJyb3JDb2RlIiwiRXZlbnQiLCJTdGF0IiwiUFJPWFkiLCJOT1BST1hZIiwiRmV0Y2hYbWxIdHRwRmFjdG9yeSIsIldlYkNoYW5uZWwiLCJYaHJJbyIsIk1kNSIsIkludGVnZXIiLCJVc2VyIiwidWlkIiwiaXNBdXRoZW50aWNhdGVkIiwidG9LZXkiLCJpc0VxdWFsIiwiVU5BVVRIRU5USUNBVEVEIiwiR09PR0xFX0NSRURFTlRJQUxTIiwiRklSU1RfUEFSVFkiLCJNT0NLX1VTRVIiLCJfX1BSSVZBVEVfbG9nRGVidWciLCJfX1BSSVZBVEVfYXJnVG9TdHJpbmciLCJfX1BSSVZBVEVfbG9nRXJyb3IiLCJmYWlsIiwiX19QUklWQVRFX2hhcmRBc3NlcnQiLCJPSyIsIkNBTkNFTExFRCIsIlVOS05PV04iLCJJTlZBTElEX0FSR1VNRU5UIiwiREVBRExJTkVfRVhDRUVERUQiLCJOT1RfRk9VTkQiLCJBTFJFQURZX0VYSVNUUyIsIlBFUk1JU1NJT05fREVOSUVEIiwiUkVTT1VSQ0VfRVhIQVVTVEVEIiwiRkFJTEVEX1BSRUNPTkRJVElPTiIsIkFCT1JURUQiLCJPVVRfT0ZfUkFOR0UiLCJVTklNUExFTUVOVEVEIiwiVU5BVkFJTEFCTEUiLCJEQVRBX0xPU1MiLCJGaXJlc3RvcmVFcnJvciIsIl9fUFJJVkFURV9EZWZlcnJlZCIsIl9fUFJJVkFURV9PQXV0aFRva2VuIiwidXNlciIsIl9fUFJJVkFURV9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIiwiZ2V0VG9rZW4iLCJpbnZhbGlkYXRlVG9rZW4iLCJlbnF1ZXVlUmV0cnlhYmxlIiwic2h1dGRvd24iLCJfX1BSSVZBVEVfRW11bGF0b3JBdXRoQ3JlZGVudGlhbHNQcm92aWRlciIsInRva2VuIiwiY2hhbmdlTGlzdGVuZXIiLCJfX1BSSVZBVEVfRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlciIsImN1cnJlbnRVc2VyIiwiZm9yY2VSZWZyZXNoIiwiYXV0aCIsIl9fUFJJVkFURV9ndWFyZGVkQ2hhbmdlTGlzdGVuZXIiLCJfX1BSSVZBVEVfYXdhaXROZXh0VG9rZW4iLCJfX1BSSVZBVEVfcmVnaXN0ZXJBdXRoIiwiYWRkQXV0aFRva2VuTGlzdGVuZXIiLCJhY2Nlc3NUb2tlbiIsInJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyIiwiZ2V0VWlkIiwiX19QUklWQVRFX0ZpcnN0UGFydHlUb2tlbiIsIl9fUFJJVkFURV9GaXJzdFBhcnR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIiLCJBcHBDaGVja1Rva2VuIiwiX19QUklWQVRFX0ZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyIiwiYXBwQ2hlY2siLCJvblRva2VuQ2hhbmdlZCIsIl9fUFJJVkFURV9yZWdpc3RlckFwcENoZWNrIiwiYWRkVG9rZW5MaXN0ZW5lciIsInJlbW92ZVRva2VuTGlzdGVuZXIiLCJfX1BSSVZBVEVfcmFuZG9tQnl0ZXMiLCJjcnlwdG8iLCJtc0NyeXB0byIsImdldFJhbmRvbVZhbHVlcyIsIl9fUFJJVkFURV9BdXRvSWQiLCJfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciIsIkJhc2VQYXRoIiwic2VnbWVudHMiLCJvZmZzZXQiLCJsZW4iLCJjb21wYXJhdG9yIiwiY2hpbGQiLCJsaW1pdCIsImNvbnN0cnVjdCIsInBvcEZpcnN0IiwicG9wTGFzdCIsImZpcnN0U2VnbWVudCIsImxhc3RTZWdtZW50IiwiaXNFbXB0eSIsImlzUHJlZml4T2YiLCJpc0ltbWVkaWF0ZVBhcmVudE9mIiwidG9BcnJheSIsIlJlc291cmNlUGF0aCIsImNhbm9uaWNhbFN0cmluZyIsImVtcHR5UGF0aCIsIkRvY3VtZW50S2V5IiwicGF0aCIsImZyb21QYXRoIiwiZnJvbU5hbWUiLCJlbXB0eSIsImNvbGxlY3Rpb25Hcm91cCIsImhhc0NvbGxlY3Rpb25JZCIsImdldENvbGxlY3Rpb25Hcm91cCIsImdldENvbGxlY3Rpb25QYXRoIiwiaXNEb2N1bWVudEtleSIsImZyb21TZWdtZW50cyIsIl9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IiLCJTb3J0ZWRNYXAiLCJyb290IiwiTExSQk5vZGUiLCJFTVBUWSIsImluc2VydCIsImNvcHkiLCJCTEFDSyIsInJlbW92ZSIsImxlZnQiLCJyaWdodCIsIm1pbktleSIsIm1heEtleSIsImlub3JkZXJUcmF2ZXJzYWwiLCJyZXZlcnNlVHJhdmVyc2FsIiwiZ2V0SXRlcmF0b3IiLCJTb3J0ZWRNYXBJdGVyYXRvciIsImdldEl0ZXJhdG9yRnJvbSIsImdldFJldmVyc2VJdGVyYXRvciIsImdldFJldmVyc2VJdGVyYXRvckZyb20iLCJpc1JldmVyc2UiLCJub2RlU3RhY2siLCJnZXROZXh0IiwiaGFzTmV4dCIsInBlZWsiLCJjb2xvciIsIlJFRCIsImZpeFVwIiwicmVtb3ZlTWluIiwiaXNSZWQiLCJtb3ZlUmVkTGVmdCIsInJvdGF0ZVJpZ2h0IiwibW92ZVJlZFJpZ2h0Iiwicm90YXRlTGVmdCIsImNvbG9yRmxpcCIsImNoZWNrTWF4RGVwdGgiLCJjaGVjayIsIlNvcnRlZFNldCIsImZpcnN0IiwibGFzdCIsImZvckVhY2hJblJhbmdlIiwiZm9yRWFjaFdoaWxlIiwiZmlyc3RBZnRlck9yRXF1YWwiLCJTb3J0ZWRTZXRJdGVyYXRvciIsInVuaW9uV2l0aCIsIml0ZXIiLCJfX1BSSVZBVEVfQmFzZTY0RGVjb2RlRXJyb3IiLCJCeXRlU3RyaW5nIiwiYmluYXJ5U3RyaW5nIiwiZnJvbUJhc2U2NFN0cmluZyIsImZyb21VaW50OEFycmF5IiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJ0b0Jhc2U2NCIsInRvVWludDhBcnJheSIsImFwcHJveGltYXRlQnl0ZVNpemUiLCJjb21wYXJlVG8iLCJfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyIiwiRU1QVFlfQllURV9TVFJJTkciLCJEYXRhYmFzZUluZm8iLCJkYXRhYmFzZUlkIiwicGVyc2lzdGVuY2VLZXkiLCJob3N0Iiwic3NsIiwiYXV0b0RldGVjdExvbmdQb2xsaW5nIiwibG9uZ1BvbGxpbmdPcHRpb25zIiwidXNlRmV0Y2hTdHJlYW1zIiwiRGF0YWJhc2VJZCIsInByb2plY3RJZCIsImRhdGFiYXNlIiwiaXNEZWZhdWx0RGF0YWJhc2UiLCJ1ZSIsImNlIiwiX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIiLCJQdCIsIkl0IiwiVHQiLCJFdCIsImR0IiwiYm9vbGVhblZhbHVlIiwiaW50ZWdlclZhbHVlIiwiZG91YmxlVmFsdWUiLCJfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8iLCJ0aW1lc3RhbXBWYWx1ZSIsIkF0Iiwic2Vjb25kcyIsIm5hbm9zIiwiUnQiLCJzdHJpbmdWYWx1ZSIsIlZ0IiwiZnQiLCJfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyIsImJ5dGVzVmFsdWUiLCJndCIsInJlZmVyZW5jZVZhbHVlIiwiZ2VvUG9pbnRWYWx1ZSIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwibWFwVmFsdWUiLCJmaWVsZHMiLCJfX3R5cGVfXyIsIl9fUFJJVkFURV9pc01heFZhbHVlIiwiTUFYX1NBRkVfSU5URUdFUiIsInl0Iiwid3QiLCJhcnJheVZhbHVlIiwiU3QiLCJidCIsIkxydVBhcmFtcyIsImNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQiLCJwZXJjZW50aWxlVG9Db2xsZWN0IiwibWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCIsIndpdGhDYWNoZVNpemUiLCJERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSIsIkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCIsImdldERvY3VtZW50IiwiREVGQVVMVCIsIkRJU0FCTEVEIiwiX19QUklWQVRFX0V4cG9uZW50aWFsQmFja29mZiIsImlpIiwidGltZXJJZCIsIlNvIiwiYm8iLCJEbyIsInZvIiwiQ28iLCJGbyIsIk1vIiwieG8iLCJPbyIsImVucXVldWVBZnRlckRlbGF5IiwiTm8iLCJza2lwRGVsYXkiLCJEZWxheWVkT3BlcmF0aW9uIiwiYXN5bmNRdWV1ZSIsInRhcmdldFRpbWVNcyIsIm9wIiwicmVtb3ZhbENhbGxiYWNrIiwiY3JlYXRlQW5kU2NoZWR1bGUiLCJ0aW1lckhhbmRsZSIsImhhbmRsZURlbGF5RWxhcHNlZCIsImVucXVldWVBbmRGb3JnZXQiLCJGaXJlc3RvcmVDbGllbnQiLCJhdXRoQ3JlZGVudGlhbHMiLCJhcHBDaGVja0NyZWRlbnRpYWxzIiwiZGF0YWJhc2VJbmZvIiwiY2xpZW50SWQiLCJhdXRoQ3JlZGVudGlhbExpc3RlbmVyIiwiYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIiLCJnZXRDb25maWd1cmF0aW9uIiwiaW5pdGlhbFVzZXIiLCJtYXhDb25jdXJyZW50TGltYm9SZXNvbHV0aW9ucyIsInNldENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lciIsInNldEFwcENoZWNrVG9rZW5DaGFuZ2VMaXN0ZW5lciIsInZlcmlmeU5vdFRlcm1pbmF0ZWQiLCJpc1NodXR0aW5nRG93biIsInRlcm1pbmF0ZSIsImVudGVyUmVzdHJpY3RlZE1vZGUiLCJlbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZCIsIl9vbmxpbmVDb21wb25lbnRzIiwiX29mZmxpbmVDb21wb25lbnRzIiwiX19QUklWQVRFX3dyYXBJblVzZXJFcnJvcklmUmVjb3ZlcmFibGUiLCJfX1BSSVZBVEVfY2xvbmVMb25nUG9sbGluZ09wdGlvbnMiLCJ0aW1lb3V0U2Vjb25kcyIsImZlIiwiX19QUklWQVRFX2Nhc3QiLCJfZGVsZWdhdGUiLCJfX1BSSVZBVEVfdmFsdWVEZXNjcmlwdGlvbiIsIkZpcmVzdG9yZVNldHRpbmdzSW1wbCIsImlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMiLCJsb2NhbENhY2hlIiwiY2FjaGVTaXplQnl0ZXMiLCJfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlciIsImV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmciLCJleHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmciLCJleHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMiLCJGaXJlc3RvcmUkMSIsIl9hdXRoQ3JlZGVudGlhbHMiLCJfYXBwQ2hlY2tDcmVkZW50aWFscyIsIl9kYXRhYmFzZUlkIiwiX2FwcCIsIl9wZXJzaXN0ZW5jZUtleSIsIl9zZXR0aW5ncyIsIl9zZXR0aW5nc0Zyb3plbiIsIl9pbml0aWFsaXplZCIsIl90ZXJtaW5hdGVkIiwiX3Rlcm1pbmF0ZVRhc2siLCJfc2V0U2V0dGluZ3MiLCJzZXNzaW9uSW5kZXgiLCJpYW1Ub2tlbiIsImF1dGhUb2tlbkZhY3RvcnkiLCJjbGllbnQiLCJfZ2V0U2V0dGluZ3MiLCJfZnJlZXplU2V0dGluZ3MiLCJfdGVybWluYXRlIiwidG9KU09OIiwic2V0dGluZ3MiLCJjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IiLCJfX1BSSVZBVEVfbG9nV2FybiIsIm1vY2tVc2VyVG9rZW4iLCJwcm9qZWN0IiwiaWF0Iiwic3ViIiwidXNlcl9pZCIsInBheWxvYWQiLCJpc3MiLCJhdWQiLCJleHAiLCJhdXRoX3RpbWUiLCJmaXJlYmFzZSIsInNpZ25faW5fcHJvdmlkZXIiLCJpZGVudGl0aWVzIiwiYWxnIiwiY3JlYXRlTW9ja1VzZXJUb2tlbiIsIl9fUFJJVkFURV9Bc3luY1F1ZXVlSW1wbCIsIktvIiwidmlzaWJpbGl0eVN0YXRlIiwiZW5xdWV1ZSIsImV1IiwidHUiLCJudSIsInN0YWNrIiwicnUiLCJ2ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzIiwiaXUiLCJzdSIsIm91IiwiX3UiLCJGaXJlc3RvcmUiLCJfcXVldWUiLCJfZmlyZXN0b3JlQ2xpZW50IiwiX29mZmxpbmVDb21wb25lbnRQcm92aWRlciIsIl9vbmxpbmVDb21wb25lbnRQcm92aWRlciIsIl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyIiwiX29mZmxpbmVLaW5kIiwia2luZCIsIl9vZmZsaW5lIiwiX29ubGluZSIsIl9fUFJJVkFURV9jb25maWd1cmVGaXJlc3RvcmUiLCJoZWFydGJlYXRDb250cm9sbGVyIiwiZ2V0QXBwIiwicHJvZHVjdE5hbWUiLCJfYiIsImVtdWxhdG9ySG9zdHMiLCJnZXREZWZhdWx0RW11bGF0b3JIb3N0Iiwic2VwYXJhdG9ySW5kZXgiLCJsYXN0SW5kZXhPZiIsImdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCIsImdldEZpcmVzdG9yZSIsImFwaUtleSIsImF1dGhEb21haW4iLCJzdG9yYWdlQnVja2V0IiwibWVzc2FnaW5nU2VuZGVySWQiLCJtZWFzdXJlbWVudElkIiwicHJvbWlzZXMiLCJ1cmwiLCJyZXNwb25zZXMiLCJqc29uIiwiZGF0YUFycmF5Iiwib25lWWVhckFnbyIsInRvZGF5IiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImdldERhdGUiLCJnZXRPbmVZZWFyQWdvIiwiaXRlbXMiLCJpdGVtIiwicHVibGlzaGVkIiwidGl0bGUiLCJsaW5rIiwiZGVzY3JpcHRpb24iLCJzb3VyY2UiLCJwYXJzZWQiLCJhcnJheSIsInNvcnRlZCIsImZsYXQiXSwic291cmNlUm9vdCI6IiJ9